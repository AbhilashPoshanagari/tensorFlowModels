/*! For license information please see main-es2015.630bdc35d63fcce0d82e.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"+8Ar":function(t,e,n){"use strict";var r=n("+aGp"),i=/^ms-/;t.exports=function(t){return r(t).replace(i,"-ms-")}},"+aGp":function(t,e,n){"use strict";var r=/([A-Z])/g;t.exports=function(t){return t.replace(r,"-$1").toLowerCase()}},"/TIM":function(t,e,n){"use strict";n.r(e);var r="http://www.w3.org/1999/xhtml",i={svg:"http://www.w3.org/2000/svg",xhtml:r,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},s=function(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),i.hasOwnProperty(e)?{space:i[e],local:t}:t};function o(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===r&&e.documentElement.namespaceURI===r?e.createElement(t):e.createElementNS(n,t)}}function a(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}var l=function(t){var e=s(t);return(e.local?a:o)(e)};function u(){}var c=function(t){return null==t?u:function(){return this.querySelector(t)}};function h(){return[]}var d=function(t){return null==t?h:function(){return this.querySelectorAll(t)}},f=function(t){return function(){return this.matches(t)}};if("undefined"!=typeof document){var p=document.documentElement;if(!p.matches){var m=p.webkitMatchesSelector||p.msMatchesSelector||p.mozMatchesSelector||p.oMatchesSelector;f=function(t){return function(){return m.call(this,t)}}}}var g=f,y=function(t){return new Array(t.length)};function v(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function b(t,e,n,r,i,s){for(var o,a=0,l=e.length,u=s.length;a<u;++a)(o=e[a])?(o.__data__=s[a],r[a]=o):n[a]=new v(t,s[a]);for(;a<l;++a)(o=e[a])&&(i[a]=o)}function x(t,e,n,r,i,s,o){var a,l,u,c={},h=e.length,d=s.length,f=new Array(h);for(a=0;a<h;++a)(l=e[a])&&(f[a]=u="$"+o.call(l,l.__data__,a,e),u in c?i[a]=l:c[u]=l);for(a=0;a<d;++a)(l=c[u="$"+o.call(t,s[a],a,s)])?(r[a]=l,l.__data__=s[a],c[u]=null):n[a]=new v(t,s[a]);for(a=0;a<h;++a)(l=e[a])&&c[f[a]]===l&&(i[a]=l)}function _(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function w(t){return function(){this.removeAttribute(t)}}function S(t){return function(){this.removeAttributeNS(t.space,t.local)}}function C(t,e){return function(){this.setAttribute(t,e)}}function E(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function k(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function A(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}v.prototype={constructor:v,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var D=function(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView};function N(t){return function(){this.style.removeProperty(t)}}function T(t,e,n){return function(){this.style.setProperty(t,e,n)}}function O(t,e,n){return function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function I(t,e){return t.style.getPropertyValue(e)||D(t).getComputedStyle(t,null).getPropertyValue(e)}function R(t){return function(){delete this[t]}}function F(t,e){return function(){this[t]=e}}function M(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function $(t){return t.trim().split(/^|\s+/)}function P(t){return t.classList||new z(t)}function z(t){this._node=t,this._names=$(t.getAttribute("class")||"")}function L(t,e){for(var n=P(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function B(t,e){for(var n=P(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function j(t){return function(){L(this,t)}}function U(t){return function(){B(this,t)}}function V(t,e){return function(){(e.apply(this,arguments)?L:B)(this,t)}}function W(){this.textContent=""}function q(t){return function(){this.textContent=t}}function H(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function G(){this.innerHTML=""}function Y(t){return function(){this.innerHTML=t}}function K(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function X(){this.nextSibling&&this.parentNode.appendChild(this)}function Z(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Q(){return null}function J(){var t=this.parentNode;t&&t.removeChild(this)}function tt(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function et(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}z.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var nt={},rt=null;function it(t,e,n){return t=st(t,e,n),function(e){var n=e.relatedTarget;n&&(n===this||8&n.compareDocumentPosition(this))||t.call(this,e)}}function st(t,e,n){return function(r){var i=rt;rt=r;try{t.call(this,this.__data__,e,n)}finally{rt=i}}}function ot(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}function at(t){return function(){var e=this.__on;if(e){for(var n,r=0,i=-1,s=e.length;r<s;++r)n=e[r],t.type&&n.type!==t.type||n.name!==t.name?e[++i]=n:this.removeEventListener(n.type,n.listener,n.capture);++i?e.length=i:delete this.__on}}}function lt(t,e,n){var r=nt.hasOwnProperty(t.type)?it:st;return function(i,s,o){var a,l=this.__on,u=r(e,s,o);if(l)for(var c=0,h=l.length;c<h;++c)if((a=l[c]).type===t.type&&a.name===t.name)return this.removeEventListener(a.type,a.listener,a.capture),this.addEventListener(a.type,a.listener=u,a.capture=n),void(a.value=e);this.addEventListener(t.type,u,n),a={type:t.type,name:t.name,value:e,listener:u,capture:n},l?l.push(a):this.__on=[a]}}function ut(t,e,n,r){var i=rt;t.sourceEvent=rt,rt=t;try{return e.apply(n,r)}finally{rt=i}}function ct(t,e,n){var r=D(t),i=r.CustomEvent;"function"==typeof i?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function ht(t,e){return function(){return ct(this,t,e)}}function dt(t,e){return function(){return ct(this,t,e.apply(this,arguments))}}"undefined"!=typeof document&&("onmouseenter"in document.documentElement||(nt={mouseenter:"mouseover",mouseleave:"mouseout"}));var ft=[null];function pt(t,e){this._groups=t,this._parents=e}function mt(){return new pt([[document.documentElement]],ft)}pt.prototype=mt.prototype={constructor:pt,select:function(t){"function"!=typeof t&&(t=c(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s,o,a=e[i],l=a.length,u=r[i]=new Array(l),h=0;h<l;++h)(s=a[h])&&(o=t.call(s,s.__data__,h,a))&&("__data__"in s&&(o.__data__=s.__data__),u[h]=o);return new pt(r,this._parents)},selectAll:function(t){"function"!=typeof t&&(t=d(t));for(var e=this._groups,n=e.length,r=[],i=[],s=0;s<n;++s)for(var o,a=e[s],l=a.length,u=0;u<l;++u)(o=a[u])&&(r.push(t.call(o,o.__data__,u,a)),i.push(o));return new pt(r,i)},filter:function(t){"function"!=typeof t&&(t=g(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s,o=e[i],a=o.length,l=r[i]=[],u=0;u<a;++u)(s=o[u])&&t.call(s,s.__data__,u,o)&&l.push(s);return new pt(r,this._parents)},data:function(t,e){if(!t)return p=new Array(this.size()),c=-1,this.each((function(t){p[++c]=t})),p;var n,r=e?x:b,i=this._parents,s=this._groups;"function"!=typeof t&&(n=t,t=function(){return n});for(var o=s.length,a=new Array(o),l=new Array(o),u=new Array(o),c=0;c<o;++c){var h=i[c],d=s[c],f=d.length,p=t.call(h,h&&h.__data__,c,i),m=p.length,g=l[c]=new Array(m),y=a[c]=new Array(m);r(h,d,g,y,u[c]=new Array(f),p,e);for(var v,_,w=0,S=0;w<m;++w)if(v=g[w]){for(w>=S&&(S=w+1);!(_=y[S])&&++S<m;);v._next=_||null}}return(a=new pt(a,i))._enter=l,a._exit=u,a},enter:function(){return new pt(this._enter||this._groups.map(y),this._parents)},exit:function(){return new pt(this._exit||this._groups.map(y),this._parents)},merge:function(t){for(var e=this._groups,n=t._groups,r=e.length,i=Math.min(r,n.length),s=new Array(r),o=0;o<i;++o)for(var a,l=e[o],u=n[o],c=l.length,h=s[o]=new Array(c),d=0;d<c;++d)(a=l[d]||u[d])&&(h[d]=a);for(;o<r;++o)s[o]=e[o];return new pt(s,this._parents)},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r,i=t[e],s=i.length-1,o=i[s];--s>=0;)(r=i[s])&&(o&&o!==r.nextSibling&&o.parentNode.insertBefore(r,o),o=r);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=_);for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s){for(var o,a=n[s],l=a.length,u=i[s]=new Array(l),c=0;c<l;++c)(o=a[c])&&(u[c]=o);u.sort(e)}return new pt(i,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){var t=new Array(this.size()),e=-1;return this.each((function(){t[++e]=this})),t},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null},size:function(){var t=0;return this.each((function(){++t})),t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i,s=e[n],o=0,a=s.length;o<a;++o)(i=s[o])&&t.call(i,i.__data__,o,s);return this},attr:function(t,e){var n=s(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==e?n.local?S:w:"function"==typeof e?n.local?A:k:n.local?E:C)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?N:"function"==typeof e?O:T)(t,e,null==n?"":n)):I(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?R:"function"==typeof e?M:F)(t,e)):this.node()[t]},classed:function(t,e){var n=$(t+"");if(arguments.length<2){for(var r=P(this.node()),i=-1,s=n.length;++i<s;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof e?V:e?j:U)(n,e))},text:function(t){return arguments.length?this.each(null==t?W:("function"==typeof t?H:q)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?G:("function"==typeof t?K:Y)(t)):this.node().innerHTML},raise:function(){return this.each(X)},lower:function(){return this.each(Z)},append:function(t){var e="function"==typeof t?t:l(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:l(t),r=null==e?Q:"function"==typeof e?e:c(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:function(){return this.each(J)},clone:function(t){return this.select(t?et:tt)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var r,i,s=ot(t+""),o=s.length;if(!(arguments.length<2)){for(a=e?lt:at,null==n&&(n=!1),r=0;r<o;++r)this.each(a(s[r],e,n));return this}var a=this.node().__on;if(a)for(var l,u=0,c=a.length;u<c;++u)for(r=0,l=a[u];r<o;++r)if((i=s[r]).type===l.type&&i.name===l.name)return l.value},dispatch:function(t,e){return this.each(("function"==typeof e?dt:ht)(t,e))}};var gt=mt,yt=function(t){return"string"==typeof t?new pt([[document.querySelector(t)]],[document.documentElement]):new pt([[t]],ft)},vt=function(t){return yt(l(t).call(document.documentElement))},bt=0;function xt(){return new _t}function _t(){this._="@"+(++bt).toString(36)}_t.prototype=xt.prototype={constructor:_t,get:function(t){for(var e=this._;!(e in t);)if(!(t=t.parentNode))return;return t[e]},set:function(t,e){return t[this._]=e},remove:function(t){return this._ in t&&delete t[this._]},toString:function(){return this._}};var wt=function(){for(var t,e=rt;t=e.sourceEvent;)e=t;return e},St=function(t,e){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,[(r=r.matrixTransform(t.getScreenCTM().inverse())).x,r.y]}var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]},Ct=function(t){var e=wt();return e.changedTouches&&(e=e.changedTouches[0]),St(t,e)},Et=function(t){return"string"==typeof t?new pt([document.querySelectorAll(t)],[document.documentElement]):new pt([null==t?[]:t],ft)},kt=function(t,e,n){arguments.length<3&&(n=e,e=wt().changedTouches);for(var r,i=0,s=e?e.length:0;i<s;++i)if((r=e[i]).identifier===n)return St(t,r);return null},At=function(t,e){null==e&&(e=wt().touches);for(var n=0,r=e?e.length:0,i=new Array(r);n<r;++n)i[n]=St(t,e[n]);return i};n.d(e,"create",(function(){return vt})),n.d(e,"creator",(function(){return l})),n.d(e,"local",(function(){return xt})),n.d(e,"matcher",(function(){return g})),n.d(e,"mouse",(function(){return Ct})),n.d(e,"namespace",(function(){return s})),n.d(e,"namespaces",(function(){return i})),n.d(e,"clientPoint",(function(){return St})),n.d(e,"select",(function(){return yt})),n.d(e,"selectAll",(function(){return Et})),n.d(e,"selection",(function(){return gt})),n.d(e,"selector",(function(){return c})),n.d(e,"selectorAll",(function(){return d})),n.d(e,"style",(function(){return I})),n.d(e,"touch",(function(){return kt})),n.d(e,"touches",(function(){return At})),n.d(e,"window",(function(){return D})),n.d(e,"event",(function(){return rt})),n.d(e,"customEvent",(function(){return ut}))},0:function(t,e,n){t.exports=n("zUnb")},"0mDd":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(n("bniK"));function i(t){return t&&t.__esModule?t:{default:t}}i(n("2mcs"));var s=r.default.isUnitlessNumber;e.default=function(t,e,n){return null==e||"boolean"==typeof e||""===e?"":isNaN(e)||0===e||s.hasOwnProperty(t)&&s[t]?""+e:("string"==typeof e&&(e=e.trim()),e+"px")}},1:function(t,e){},2:function(t,e){},"2KGH":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if("string"==typeof e&&!(0,i.default)(e)&&e.indexOf("image-set(")>-1)return s.map((function(t){return e.replace(/image-set\(/g,t+"image-set(")}))};var r,i=(r=n("sUt/"))&&r.__esModule?r:{default:r},s=["-webkit-",""];t.exports=e.default},"2mcs":function(t,e,n){"use strict";var r=n("ohE5");t.exports=r},"2tTC":function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(e){s(e)}}function a(t){try{l(r.throw(t))}catch(e){s(e)}}function l(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(o,a)}l((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const i=n("h1ZQ"),s=n("jke5"),o=n("QUk2");e.valuesDistribution=function(t,e){return r(this,void 0,void 0,(function*(){const n=s.getDrawArea(t),r=yield o.tensorStats(e),a=yield e.data();i.histogram(n,a,{height:150,stats:r})}))}},3:function(t,e){},"3iBx":function(t){t.exports=JSON.parse('{"name":"vega-tooltip","version":"0.19.1","description":"A tooltip plugin for Vega-Lite and Vega visualizations.","main":"build/vega-tooltip.js","module":"build/src/index.js","unpkg":"build/vega-tooltip.min.js","jsdelivr":"build/vega-tooltip.min.js","typings":"build/src/index.d.ts","repository":{"type":"git","url":"https://github.com/vega/vega-tooltip.git"},"keywords":["vega-lite","vega","tooltip"],"author":{"name":"UW Interactive Data Lab","url":"https://idl.cs.washington.edu"},"collaborators":["Dominik Moritz","Sira Horradarn","Zening Qu","Kanit Wongsuphasawat","Yuri Astrakhan","Jeffrey Heer"],"license":"BSD-3-Clause","bugs":{"url":"https://github.com/vega/vega-tooltip/issues"},"homepage":"https://github.com/vega/vega-tooltip#readme","scripts":{"prepare":"beemo create-config --silent","tsc:src":"tsc -b tsconfig.src.json","build":"yarn tsc:src && rollup -c","clean":"rm -rf build examples/data && rm -f src/style.ts","copy:data":"rsync -r node_modules/vega-datasets/data/* examples/data","copy:build":"rsync -r build/* examples/build","deploy:gh":"yarn build && yarn copy:build && gh-pages -d examples && yarn clean","prettierbase":"beemo prettier \'examples/*.{html,scss,css}\'","eslintbase":"beemo eslint \'{src,test,types}/**/*.ts\'","format":"yarn eslintbase --fix && yarn prettierbase --write","lint":"yarn eslintbase && yarn prettierbase --check","postbuild":"terser build/vega-tooltip.js -c -m -o build/vega-tooltip.min.js","prebuild":"mkdir -p build && yarn copy:data && ./build-style.sh","prepublishOnly":"yarn clean && yarn build","preversion":"yarn lint","start":"yarn build && concurrently --kill-others -n Server,Typescript,Rollup \'browser-sync start -s -f build examples --serveStatic examples\' \'yarn tsc:src -w\' \'rollup -c -w\'","pretest":"./build-style.sh","test":"jest"},"devDependencies":{"@types/jest":"^24.0.18","browser-sync":"^2.26.7","concurrently":"^4.1.2","gh-pages":"^2.1.1","jest":"^24.9.0","node-sass":"^4.12.0","path":"^0.12.7","rollup":"^1.20.3","rollup-plugin-commonjs":"^10.1.0","rollup-plugin-json":"^4.0.0","rollup-plugin-node-resolve":"^5.2.0","terser":"^4.2.1","ts-jest":"^24.0.2","typescript":"^3.6.2","vega-datasets":"^1.25.0","vega-lite-dev-config":"^0.2.5","vega-typings":"^0.8.1"},"dependencies":{"vega-util":"^1.11.1"},"beemo":{"module":"vega-lite-dev-config","drivers":["prettier","eslint"]},"jest":{"testURL":"http://localhost/","transform":{"^.+\\\\.tsx?$":"ts-jest"},"testRegex":"(/__tests__/.*|(\\\\.|/)(test|spec))\\\\.(jsx?|tsx?)$","moduleFileExtensions":["ts","tsx","js","jsx","json","node"],"testPathIgnorePatterns":["node_modules","<rootDir>/build","src"]}}')},"3zff":function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(e){s(e)}}function a(t){try{l(r.throw(t))}catch(e){s(e)}}function l(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(o,a)}l((r=r.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i(n("etOl")),o=n("Ewl0"),a=n("jke5");e.confusionMatrix=function(t,e,n={}){return r(this,void 0,void 0,(function*(){const r=Object.assign({},l,n),i=a.getDrawArea(t),u=[],c=e.values,h=e.tickLabels||[],d=0===h.length;let f=!0;for(let t=0;t<c.length;t++){const e=d?"Class "+t:h[t];d&&h.push(e);for(let n=0;n<c[t].length;n++){const i=d?"Class "+n:h[n],s=c[t][n];t!==n||r.shadeDiagonal?(u.push({label:e,prediction:i,count:s,scaleCount:s}),0!==s&&(f=!1)):u.push({label:e,prediction:i,count:s,noFill:!0})}}if(!r.shadeDiagonal&&f)for(const t of u)!0===t.noFill&&(t.noFill=!1,t.scaleCount=t.count);const p={width:r.width||o.getDefaultWidth(i),height:r.height||o.getDefaultHeight(i),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:r.fontSize,titleFontSize:r.fontSize},text:{fontSize:r.fontSize},legend:{labelFontSize:r.fontSize,titleFontSize:r.fontSize}},data:{values:u},encoding:{x:{field:"prediction",type:"ordinal",title:r.xLabel||"prediction",scale:{domain:h}},y:{field:"label",type:"ordinal",title:r.yLabel||"label",scale:{domain:h}}},layer:[{transform:[{filter:"datum.noFill != true"}],mark:{type:"rect"},encoding:{color:{field:"scaleCount",type:"quantitative",scale:{range:r.colorMap}},tooltip:[{field:"label",type:"nominal"},{field:"prediction",type:"nominal"},{field:"count",type:"quantitative"}]}}]};!1===r.shadeDiagonal&&p.layer.push({transform:[{filter:"datum.noFill == true"}],mark:{type:"rect",fill:"white"},encoding:{tooltip:[{field:"label",type:"nominal"},{field:"prediction",type:"nominal"},{field:"count",type:"quantitative"}]}}),r.showTextOverlay&&p.layer.push({mark:{type:"text",baseline:"middle"},encoding:{text:{field:"count",type:"nominal"}}}),p.layer[0].encoding.color.scale.range="string"==typeof r.colorMap?{scheme:r.colorMap}:r.colorMap,yield s.default(i,p,{actions:!1,mode:"vega-lite",defaultStyle:!1})}))};const l={xLabel:null,yLabel:null,xType:"nominal",yType:"nominal",shadeDiagonal:!0,fontSize:12,showTextOverlay:!0,height:400,colorMap:["#f7fbff","#4292c6"]}},4:function(t,e){},"4PpC":function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(e){s(e)}}function a(t){try{l(r.throw(t))}catch(e){s(e)}}function l(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(o,a)}l((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const i=n("zhpP"),s=n("jke5"),o=n("Ewl0");function a(t,e,n,a={}){return r(this,void 0,void 0,(function*(){const r=s.getDrawArea(t),c={};for(const t of n)if(/val_/.test(t)){const r=t.replace("val_","");l(c,r);const i=u(e,t,n.indexOf(t));c[r].series.push(t),c[r].values.push(i)}else{const r=u(e,t,n.indexOf(t));l(c,t),c[t].series.push(t),c[t].values.push(r)}const h=Object.keys(c),d=Object.assign({},{xLabel:"Iteration",yLabel:"Value"},a),f=[];for(const t of h){const e=o.subSurface(r,t),n=c[t].series,s=c[t].values;n.every(t=>Boolean(t.match("acc")))&&(d.zoomToFitAccuracy?d.zoomToFit=!0:(d.yAxisDomain=[0,1],delete d.zoomToFit));const a=i.linechart(e,{values:s,series:n},d);f.push(a)}yield Promise.all(f)}))}function l(t,e){null==t[e]&&(t[e]={series:[],values:[]})}function u(t,e,n){if(Array.isArray(t)){const r=Array.isArray(t[0])?t[n]:t,i=[];for(let t=0;t<r.length;t++)i.push({x:t,y:r[t][e]});return i}return t.history[e].map((t,e)=>({x:e,y:t}))}function c(t,e,n){return null==t[e]&&(t[e]={}),null==t[e][n]&&(t[e][n]=[]),t[e][n]}e.history=a,e.fitCallbacks=function(t,e,n={}){const i={},l=n.callbacks||["onEpochEnd","onBatchEnd"],u=s.getDrawArea(t),h=Object.assign({},n);delete h.callbacks;const d={};return l.forEach(t=>{d[t]=function(t){return(n,l)=>r(this,void 0,void 0,(function*(){/batch/i.test(t)?h.xLabel="Batch":/epoch/i.test(t)&&(h.xLabel="Epoch");const n=[],r=[];for(const s of e)if(null!=l[s]){r.push(s);const e=c(i,t,s);e.push({[s]:l[s]}),n.push(e)}a(o.subSurface(u,t,{title:t}),n,r,h),yield s.nextFrame()}))}(t)}),d}},5:function(t,e){},"6fql":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if("string"==typeof e&&!(0,i.default)(e)&&o.test(e))return s.map((function(t){return t+e}))};var r,i=(r=n("sUt/"))&&r.__esModule?r:{default:r},s=["-webkit-","-moz-",""],o=/linear-gradient|radial-gradient|repeating-linear-gradient|repeating-radial-gradient/;t.exports=e.default},"7ZGM":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if("string"==typeof e&&!(0,i.default)(e)&&e.indexOf("filter(")>-1)return s.map((function(t){return e.replace(/filter\(/g,t+"filter(")}))};var r,i=(r=n("sUt/"))&&r.__esModule?r:{default:r},s=["-webkit-",""];t.exports=e.default},"8BEe":function(t,e,n){"use strict";t.exports=function(t,e){e||(e={}),"function"==typeof e&&(e={cmp:e});var n,r="boolean"==typeof e.cycles&&e.cycles,i=e.cmp&&(n=e.cmp,function(t){return function(e,r){return n({key:e,value:t[e]},{key:r,value:t[r]})}}),s=[];return function t(e){if(e&&e.toJSON&&"function"==typeof e.toJSON&&(e=e.toJSON()),void 0!==e){if("number"==typeof e)return isFinite(e)?""+e:"null";if("object"!=typeof e)return JSON.stringify(e);var n,o;if(Array.isArray(e)){for(o="[",n=0;n<e.length;n++)n&&(o+=","),o+=t(e[n])||"null";return o+"]"}if(null===e)return"null";if(-1!==s.indexOf(e)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var a=s.push(e)-1,l=Object.keys(e).sort(i&&i(e));for(o="",n=0;n<l.length;n++){var u=l[n],c=t(e[u]);c&&(o&&(o+=","),o+=JSON.stringify(u)+":"+c)}return s.splice(a,1),"{"+o+"}"}}(t)}},"8WEG":function(t){t.exports=JSON.parse('{"a":"5.13.0"}')},"9eqh":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if("display"===t&&r.hasOwnProperty(e))return r[e]};var r={flex:["-webkit-box","-moz-box","-ms-flexbox","-webkit-flex","flex"],"inline-flex":["-webkit-inline-box","-moz-inline-box","-ms-inline-flexbox","-webkit-inline-flex","inline-flex"]};t.exports=e.default},A8aI:function(t,e,n){"use strict";function r(t,e){return t.charCodeAt(e++)+(t.charCodeAt(e++)<<8)+(t.charCodeAt(e++)<<16)+(t.charCodeAt(e)<<24)}function i(t,e){return t.charCodeAt(e++)+(t.charCodeAt(e++)<<8)}function s(t,e){return(65535&(t|=0))*(e|=0)+(((t>>>16)*e&65535)<<16)|0}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){for(var n=1540483477,o=e^t.length,a=t.length,l=0;a>=4;){var u=r(t,l);u=s(u,n),u=s(u^=u>>>24,n),o=s(o,n),o^=u,l+=4,a-=4}switch(a){case 3:o^=i(t,l),o=s(o^=t.charCodeAt(l+2)<<16,n);break;case 2:o=s(o^=i(t,l),n);break;case 1:o=s(o^=t.charCodeAt(l),n)}return o=s(o^=o>>>13,n),(o^=o>>>15)>>>0}},Ad6o:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.compose=e.merge=e.$=e.style=e.presets=e.keyframes=e.fontFace=e.insertGlobal=e.insertRule=e.plugins=e.styleSheet=void 0,e.speedy=function(t){return h.speedy(t)},e.simulations=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];p=!!t},e.simulate=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return(e=(0,o.default)(e))?p?e.reduce((function(t,e){return t["data-simulate-"+v(e)]="",t}),{}):(m||(console.warn("can't simulate without once calling simulations(true)"),m=!0),g||(console.warn("don't use simulation outside dev"),g=!0),{}):{}},e.cssLabels=function(t){y=!!t},e.isLikeRule=x,e.idFor=_,e.css=j,e.rehydrate=function(t){(0,r.default)(D,t.reduce((function(t,e){return t[e]=!0,t}),{}))},e.flush=function(){D=h.inserted={},N=h.registered={},O={},h.flush(),h.inject()},e.select=V,e.parent=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return j(c({},t+" &",n))},e.media=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return j(c({},"@media "+t,n))},e.pseudo=W,e.active=function(t){return W(":active",t)},e.any=function(t){return W(":any",t)},e.checked=function(t){return W(":checked",t)},e.disabled=function(t){return W(":disabled",t)},e.empty=function(t){return W(":empty",t)},e.enabled=function(t){return W(":enabled",t)},e._default=function(t){return W(":default",t)},e.first=function(t){return W(":first",t)},e.firstChild=function(t){return W(":first-child",t)},e.firstOfType=function(t){return W(":first-of-type",t)},e.fullscreen=function(t){return W(":fullscreen",t)},e.focus=function(t){return W(":focus",t)},e.hover=function(t){return W(":hover",t)},e.indeterminate=function(t){return W(":indeterminate",t)},e.inRange=function(t){return W(":in-range",t)},e.invalid=function(t){return W(":invalid",t)},e.lastChild=function(t){return W(":last-child",t)},e.lastOfType=function(t){return W(":last-of-type",t)},e.left=function(t){return W(":left",t)},e.link=function(t){return W(":link",t)},e.onlyChild=function(t){return W(":only-child",t)},e.onlyOfType=function(t){return W(":only-of-type",t)},e.optional=function(t){return W(":optional",t)},e.outOfRange=function(t){return W(":out-of-range",t)},e.readOnly=function(t){return W(":read-only",t)},e.readWrite=function(t){return W(":read-write",t)},e.required=function(t){return W(":required",t)},e.right=function(t){return W(":right",t)},e.root=function(t){return W(":root",t)},e.scope=function(t){return W(":scope",t)},e.target=function(t){return W(":target",t)},e.valid=function(t){return W(":valid",t)},e.visited=function(t){return W(":visited",t)},e.dir=function(t,e){return W(":dir("+t+")",e)},e.lang=function(t,e){return W(":lang("+t+")",e)},e.not=function(t,e){var n=t.split(",").map((function(t){return t.trim()})).map((function(t){return":not("+t+")"}));return 1===n.length?W(":not("+t+")",e):V(n.join(""),e)},e.nthChild=function(t,e){return W(":nth-child("+t+")",e)},e.nthLastChild=function(t,e){return W(":nth-last-child("+t+")",e)},e.nthLastOfType=function(t,e){return W(":nth-last-of-type("+t+")",e)},e.nthOfType=function(t,e){return W(":nth-of-type("+t+")",e)},e.after=function(t){return W("::after",t)},e.before=function(t){return W("::before",t)},e.firstLetter=function(t){return W("::first-letter",t)},e.firstLine=function(t){return W("::first-line",t)},e.selection=function(t){return W("::selection",t)},e.backdrop=function(t){return W("::backdrop",t)},e.placeholder=function(t){return j({"::placeholder":t})},e.cssFor=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return(e=(0,o.default)(e))?e.map((function(t){var e={label:[]};return M(e,{src:t}),A(b(e),k(e)).join("")})).join(""):""},e.attribsFor=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=(e=(0,o.default)(e))?e.map((function(t){_(t);var e=Object.keys(t)[0];return e+'="'+(t[e]||"")+'"'})).join(" "):"";return r};var r=u(n("MgzW")),i=n("SDpH"),s=n("msJK"),o=u(n("tduB")),a=n("v20e"),l=u(n("A8aI"));function u(t){return t&&t.__esModule?t:{default:t}}function c(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var h=e.styleSheet=new i.StyleSheet;h.inject();var d=e.plugins=h.plugins=new a.PluginSet([a.prefixes,a.contentWrap,a.fallbacks]);d.media=new a.PluginSet,d.fontFace=new a.PluginSet,d.keyframes=new a.PluginSet([a.prefixes,a.fallbacks]);var f="undefined"!=typeof window,p=!1,m=!1,g=!1,y=!1;function v(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return t.toLowerCase().replace(/[^a-z0-9]/g,e)}function b(t){var e=JSON.stringify(t);return(0,l.default)(e).toString(36)}function x(t){var e=Object.keys(t).filter((function(t){return"toString"!==t}));return 1===e.length&&!!/data\-css\-([a-zA-Z0-9\-_]+)/.exec(e[0])}function _(t){var e=Object.keys(t).filter((function(t){return"toString"!==t}));if(1!==e.length)throw new Error("not a rule");var n=/data\-css\-([a-zA-Z0-9\-_]+)/.exec(e[0]);if(!n)throw new Error("not a rule");return n[1]}var w=/[(),]|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g;function S(t){if(-1===t.indexOf(","))return[t];for(var e,n=[],r=[],i=0;e=w.exec(t);)switch(e[0]){case"(":i++;break;case")":i--;break;case",":if(i)break;n.push(e.index)}for(e=n.length;e--;)r.unshift(t.slice(n[e]+1)),t=t.slice(0,n[e]);return r.unshift(t),r}function C(t,e){if(!t)return e.replace(/\&/g,"");if(!e)return".css-"+t+",[data-css-"+t+"]";var n=S(e).map((function(e){return e.indexOf("&")>=0?[e.replace(/\&/gm,".css-"+t),e.replace(/\&/gm,"[data-css-"+t+"]")].join(","):".css-"+t+e+",[data-css-"+t+"]"+e})).join(",");return p&&/^\&\:/.exec(e)&&!/\s/.exec(e)&&(n+=",.css-"+t+"[data-simulate-"+v(e)+"],[data-css-"+t+"][data-simulate-"+v(e)+"]"),n}function E(t){var e=d.transform({selector:t.selector,style:t.style});return e.selector+"{"+(0,s.createMarkupForStyles)(e.style)+"}"}function k(t){var e=void 0,n=void 0,r=void 0,i=void 0;return Object.keys(t).forEach((function(s){s.indexOf("&")>=0?(n=n||{})[s]=t[s]:0===s.indexOf("@media")?(r=r||{})[s]=k(t[s]):0===s.indexOf("@supports")?(i=i||{})[s]=k(t[s]):"label"===s?t.label.length>0&&((e=e||{}).label=y?t.label.join("."):""):(e=e||{})[s]=t[s]})),{plain:e,selects:n,medias:r,supports:i}}function A(t,e){var n=[],r=e.plain,i=e.selects,s=e.medias,o=e.supports;return r&&n.push(E({style:r,selector:C(t)})),i&&Object.keys(i).forEach((function(e){return n.push(E({style:i[e],selector:C(t,e)}))})),s&&Object.keys(s).forEach((function(e){return n.push(e+"{"+A(t,s[e]).join("")+"}")})),o&&Object.keys(o).forEach((function(e){return n.push(e+"{"+A(t,o[e]).join("")+"}")})),n}var D=h.inserted={},N=h.registered={};function T(t){N[t.id]||(N[t.id]=t)}var O={};function I(t,e){var n=S(t).map((function(t){return t.indexOf("&")>=0?t:"&"+t}));return S(e).map((function(t){return t.indexOf("&")>=0?t:"&"+t})).reduce((function(t,e){return t.concat(n.map((function(t){return e.replace(/\&/g,t)})))}),[]).join(",")}function R(t,e){return t?"@supports "+t.substring(9)+" and "+e.substring(9):e}var F={"::placeholder":["::-webkit-input-placeholder","::-moz-placeholder","::-ms-input-placeholder"],":fullscreen":[":-webkit-full-screen",":-moz-full-screen",":-ms-fullscreen"]};function M(t,e){var n=e.selector,r=void 0===n?"":n,i=e.mq,s=void 0===i?"":i,a=e.supp,l=void 0===a?"":a,u=e.src,c=void 0===u?{}:u;Array.isArray(c)||(c=[c]),(c=function t(e){for(var n=[],r=0;r<e.length;r++)n=Array.isArray(e[r])?n.concat(t(e[r])):n.concat(e[r]);return n}(c)).forEach((function(e){if(x(e)){var n=function(t){if(x(t)){var e=N[_(t)];if(null==e)throw new Error("[glamor] an unexpected rule cache miss occurred. This is probably a sign of multiple glamor instances in your app. See https://github.com/threepointone/glamor/issues/79");return e}return t}(e);if("css"!==n.type)throw new Error("cannot merge this rule");e=n.style}(e=(0,o.default)(e))&&e.composes&&M(t,{selector:r,mq:s,supp:l,src:e.composes}),Object.keys(e||{}).forEach((function(n){if(function(t){for(var e=[":",".","[",">"," "],n=!1,r=t.charAt(0),i=0;i<e.length;i++)if(r===e[i]){n=!0;break}return n||t.indexOf("&")>=0}(n))F[n]&&F[n].forEach((function(i){return M(t,{selector:I(r,i),mq:s,supp:l,src:e[n]})})),M(t,{selector:I(r,n),mq:s,supp:l,src:e[n]});else if(function(t){return 0===t.indexOf("@media")}(n))M(t,{selector:r,mq:(o=s,a=n,o?"@media "+o.substring(6)+" and "+a.substring(6):a),supp:l,src:e[n]});else if(function(t){return 0===t.indexOf("@supports")}(n))M(t,{selector:r,mq:s,supp:R(l,n),src:e[n]});else if("composes"===n);else{var i=t;l&&(i[l]=i[l]||{},i=i[l]),s&&(i[s]=i[s]||{},i=i[s]),r&&(i[r]=i[r]||{},i=i[r]),"label"===n?y&&(t.label=t.label.concat(e.label)):i[n]=e[n]}var o,a}))}))}function $(t){var e={label:[]};return M(e,{src:t}),function(t){if(T(t),function(t){if(!D[t.id]){D[t.id]=!0;var e=k(t.style),n=A(t.id,e);D[t.id]=!!f||n,n.forEach((function(t){return h.insert(t)}))}}(t),O[t.id])return O[t.id];var e=c({},"data-css-"+t.id,y&&t.label||"");return Object.defineProperty(e,"toString",{enumerable:!1,value:function(){return"css-"+t.id}}),O[t.id]=e,e}({id:b(e),style:e,label:y?e.label.join("."):"",type:"css"})}var P,z=function(){var t={};return Object.defineProperty(t,"toString",{enumerable:!1,value:function(){return"css-nil"}}),t}(),L="undefined"!=typeof WeakMap?[z,new WeakMap,new WeakMap,new WeakMap]:[z],B="undefined"!=typeof WeakMap?(P=$,function(t){if(L[t.length]){for(var e=L[t.length],n=0;n<t.length-1;)e.has(t[n])||e.set(t[n],new WeakMap),e=e.get(t[n]),n++;if(e.has(t[t.length-1])){var r=e.get(t[n]);if(N[r.toString().substring(4)])return r}}var i=P(t);if(L[t.length]){for(var s=0,o=L[t.length];s<t.length-1;)o=o.get(t[s]),s++;try{o.set(t[s],i)}catch(a){}}return i}):$;function j(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];if(e[0]&&e[0].length&&e[0].raw)throw new Error("you forgot to include glamor/babel in your babel plugins.");return(e=(0,o.default)(e))?B(e):z}e.insertRule=j.insert=function(t){var e={id:b(t),css:t,type:"raw"};T(e),D[e.id]||(h.insert(e.css),D[e.id]=!!f||[e.css])},e.insertGlobal=j.global=function(t,e){if(e=(0,o.default)(e))return j.insert(E({selector:t,style:e}))},j.keyframes=function(t,e){e||(e=t,t="animation");var n={id:b({name:t,kfs:e=(0,o.default)(e)||{}}),type:"keyframes",name:t,keyframes:e};return T(n),function(t){if(!D[t.id]){var e=Object.keys(t.keyframes).map((function(e){var n=d.keyframes.transform({id:t.id,name:e,style:t.keyframes[e]});return n.name+"{"+(0,s.createMarkupForStyles)(n.style)+"}"})).join(""),n=["-webkit-","-moz-","-o-",""].map((function(n){return"@"+n+"keyframes "+t.name+"_"+t.id+"{"+e+"}"}));n.forEach((function(t){return h.insert(t)})),D[t.id]=!!f||n}}(n),t+"_"+n.id},e.fontFace=j.fontFace=function(t){var e={id:b(t=(0,o.default)(t)),type:"font-face",font:t};return T(e),function(t){if(!D[t.id]){var e="@font-face{"+(0,s.createMarkupForStyles)(t.font)+"}";h.insert(e),D[t.id]=!!f||[e]}}(e),t.fontFamily},e.keyframes=j.keyframes,e.presets={mobile:"(min-width: 400px)",Mobile:"@media (min-width: 400px)",phablet:"(min-width: 550px)",Phablet:"@media (min-width: 550px)",tablet:"(min-width: 750px)",Tablet:"@media (min-width: 750px)",desktop:"(min-width: 1000px)",Desktop:"@media (min-width: 1000px)",hd:"(min-width: 1200px)",Hd:"@media (min-width: 1200px)"};var U=e.style=j;function V(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return t?j(c({},t,n)):U(n)}function W(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return j(c({},t,n))}e.$=V,e.merge=j,e.compose=j},B9Yq:function(t,e){t.exports=function(){throw new Error("define cannot be used indirect")}},CEZr:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(e){s(e)}}function a(t){try{l(r.throw(t))}catch(e){s(e)}}function l(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(o,a)}l((r=r.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i(n("etOl")),o=n("Ewl0"),a=n("YYB2"),l=n("jke5");e.scatterplot=function(t,e,n={}){return r(this,void 0,void 0,(function*(){let r=e.values;const i=null==e.series?[]:e.series;r=Array.isArray(r[0])?r:[r];const c=[];r.forEach((t,e)=>{const n=null!=i[e]?i[e]:"Series "+(e+1),r=t.map(t=>Object.assign({},t,{series:n}));c.push(...r)}),null!=n.seriesColors&&a.assert(n.seriesColors.length===r.length,"Must have an equal number of series colors as there are data series");const h=l.getDrawArea(t),d=Object.assign({},u,n),f={width:d.width||o.getDefaultWidth(h),height:d.height||o.getDefaultHeight(h),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:d.fontSize,titleFontSize:d.fontSize},text:{fontSize:d.fontSize},legend:{labelFontSize:d.fontSize,titleFontSize:d.fontSize}},data:{values:c},mark:{type:"point",clip:!0,tooltip:{content:"data"}},encoding:{x:{field:"x",type:d.xType,title:d.xLabel,scale:d.zoomToFit?{zero:!1}:null!=d.xAxisDomain?{domain:d.xAxisDomain}:void 0},y:{field:"y",type:d.yType,title:d.yLabel,scale:d.zoomToFit?{zero:!1}:null!=d.yAxisDomain?{domain:d.yAxisDomain}:void 0},color:{field:"series",type:"nominal",scale:{range:d.seriesColors}},shape:{field:"series",type:"nominal"}}};return yield s.default(h,f,{actions:!1,mode:"vega-lite",defaultStyle:!1}),Promise.resolve()}))};const u={xLabel:"x",yLabel:"y",xType:"quantitative",yType:"quantitative",zoomToFit:!1,fontSize:11}},DVXx:function(t,e){var n;e=t.exports=h,n="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?function(){var t=Array.prototype.slice.call(arguments,0);t.unshift("SEMVER"),console.log.apply(console,t)}:function(){},e.SEMVER_SPEC_VERSION="2.0.0";var r=Number.MAX_SAFE_INTEGER||9007199254740991,i=e.re=[],s=e.src=[],o=e.tokens={},a=0;function l(t){o[t]=a++}l("NUMERICIDENTIFIER"),s[o.NUMERICIDENTIFIER]="0|[1-9]\\d*",l("NUMERICIDENTIFIERLOOSE"),s[o.NUMERICIDENTIFIERLOOSE]="[0-9]+",l("NONNUMERICIDENTIFIER"),s[o.NONNUMERICIDENTIFIER]="\\d*[a-zA-Z-][a-zA-Z0-9-]*",l("MAINVERSION"),s[o.MAINVERSION]="("+s[o.NUMERICIDENTIFIER]+")\\.("+s[o.NUMERICIDENTIFIER]+")\\.("+s[o.NUMERICIDENTIFIER]+")",l("MAINVERSIONLOOSE"),s[o.MAINVERSIONLOOSE]="("+s[o.NUMERICIDENTIFIERLOOSE]+")\\.("+s[o.NUMERICIDENTIFIERLOOSE]+")\\.("+s[o.NUMERICIDENTIFIERLOOSE]+")",l("PRERELEASEIDENTIFIER"),s[o.PRERELEASEIDENTIFIER]="(?:"+s[o.NUMERICIDENTIFIER]+"|"+s[o.NONNUMERICIDENTIFIER]+")",l("PRERELEASEIDENTIFIERLOOSE"),s[o.PRERELEASEIDENTIFIERLOOSE]="(?:"+s[o.NUMERICIDENTIFIERLOOSE]+"|"+s[o.NONNUMERICIDENTIFIER]+")",l("PRERELEASE"),s[o.PRERELEASE]="(?:-("+s[o.PRERELEASEIDENTIFIER]+"(?:\\."+s[o.PRERELEASEIDENTIFIER]+")*))",l("PRERELEASELOOSE"),s[o.PRERELEASELOOSE]="(?:-?("+s[o.PRERELEASEIDENTIFIERLOOSE]+"(?:\\."+s[o.PRERELEASEIDENTIFIERLOOSE]+")*))",l("BUILDIDENTIFIER"),s[o.BUILDIDENTIFIER]="[0-9A-Za-z-]+",l("BUILD"),s[o.BUILD]="(?:\\+("+s[o.BUILDIDENTIFIER]+"(?:\\."+s[o.BUILDIDENTIFIER]+")*))",l("FULL"),l("FULLPLAIN"),s[o.FULLPLAIN]="v?"+s[o.MAINVERSION]+s[o.PRERELEASE]+"?"+s[o.BUILD]+"?",s[o.FULL]="^"+s[o.FULLPLAIN]+"$",l("LOOSEPLAIN"),s[o.LOOSEPLAIN]="[v=\\s]*"+s[o.MAINVERSIONLOOSE]+s[o.PRERELEASELOOSE]+"?"+s[o.BUILD]+"?",l("LOOSE"),s[o.LOOSE]="^"+s[o.LOOSEPLAIN]+"$",l("GTLT"),s[o.GTLT]="((?:<|>)?=?)",l("XRANGEIDENTIFIERLOOSE"),s[o.XRANGEIDENTIFIERLOOSE]=s[o.NUMERICIDENTIFIERLOOSE]+"|x|X|\\*",l("XRANGEIDENTIFIER"),s[o.XRANGEIDENTIFIER]=s[o.NUMERICIDENTIFIER]+"|x|X|\\*",l("XRANGEPLAIN"),s[o.XRANGEPLAIN]="[v=\\s]*("+s[o.XRANGEIDENTIFIER]+")(?:\\.("+s[o.XRANGEIDENTIFIER]+")(?:\\.("+s[o.XRANGEIDENTIFIER]+")(?:"+s[o.PRERELEASE]+")?"+s[o.BUILD]+"?)?)?",l("XRANGEPLAINLOOSE"),s[o.XRANGEPLAINLOOSE]="[v=\\s]*("+s[o.XRANGEIDENTIFIERLOOSE]+")(?:\\.("+s[o.XRANGEIDENTIFIERLOOSE]+")(?:\\.("+s[o.XRANGEIDENTIFIERLOOSE]+")(?:"+s[o.PRERELEASELOOSE]+")?"+s[o.BUILD]+"?)?)?",l("XRANGE"),s[o.XRANGE]="^"+s[o.GTLT]+"\\s*"+s[o.XRANGEPLAIN]+"$",l("XRANGELOOSE"),s[o.XRANGELOOSE]="^"+s[o.GTLT]+"\\s*"+s[o.XRANGEPLAINLOOSE]+"$",l("COERCE"),s[o.COERCE]="(^|[^\\d])(\\d{1,16})(?:\\.(\\d{1,16}))?(?:\\.(\\d{1,16}))?(?:$|[^\\d])",l("COERCERTL"),i[o.COERCERTL]=new RegExp(s[o.COERCE],"g"),l("LONETILDE"),s[o.LONETILDE]="(?:~>?)",l("TILDETRIM"),s[o.TILDETRIM]="(\\s*)"+s[o.LONETILDE]+"\\s+",i[o.TILDETRIM]=new RegExp(s[o.TILDETRIM],"g"),l("TILDE"),s[o.TILDE]="^"+s[o.LONETILDE]+s[o.XRANGEPLAIN]+"$",l("TILDELOOSE"),s[o.TILDELOOSE]="^"+s[o.LONETILDE]+s[o.XRANGEPLAINLOOSE]+"$",l("LONECARET"),s[o.LONECARET]="(?:\\^)",l("CARETTRIM"),s[o.CARETTRIM]="(\\s*)"+s[o.LONECARET]+"\\s+",i[o.CARETTRIM]=new RegExp(s[o.CARETTRIM],"g"),l("CARET"),s[o.CARET]="^"+s[o.LONECARET]+s[o.XRANGEPLAIN]+"$",l("CARETLOOSE"),s[o.CARETLOOSE]="^"+s[o.LONECARET]+s[o.XRANGEPLAINLOOSE]+"$",l("COMPARATORLOOSE"),s[o.COMPARATORLOOSE]="^"+s[o.GTLT]+"\\s*("+s[o.LOOSEPLAIN]+")$|^$",l("COMPARATOR"),s[o.COMPARATOR]="^"+s[o.GTLT]+"\\s*("+s[o.FULLPLAIN]+")$|^$",l("COMPARATORTRIM"),s[o.COMPARATORTRIM]="(\\s*)"+s[o.GTLT]+"\\s*("+s[o.LOOSEPLAIN]+"|"+s[o.XRANGEPLAIN]+")",i[o.COMPARATORTRIM]=new RegExp(s[o.COMPARATORTRIM],"g"),l("HYPHENRANGE"),s[o.HYPHENRANGE]="^\\s*("+s[o.XRANGEPLAIN]+")\\s+-\\s+("+s[o.XRANGEPLAIN]+")\\s*$",l("HYPHENRANGELOOSE"),s[o.HYPHENRANGELOOSE]="^\\s*("+s[o.XRANGEPLAINLOOSE]+")\\s+-\\s+("+s[o.XRANGEPLAINLOOSE]+")\\s*$",l("STAR"),s[o.STAR]="(<|>)?=?\\s*\\*";for(var u=0;u<a;u++)n(u,s[u]),i[u]||(i[u]=new RegExp(s[u]));function c(t,e){if(e&&"object"==typeof e||(e={loose:!!e,includePrerelease:!1}),t instanceof h)return t;if("string"!=typeof t)return null;if(t.length>256)return null;if(!(e.loose?i[o.LOOSE]:i[o.FULL]).test(t))return null;try{return new h(t,e)}catch(n){return null}}function h(t,e){if(e&&"object"==typeof e||(e={loose:!!e,includePrerelease:!1}),t instanceof h){if(t.loose===e.loose)return t;t=t.version}else if("string"!=typeof t)throw new TypeError("Invalid Version: "+t);if(t.length>256)throw new TypeError("version is longer than 256 characters");if(!(this instanceof h))return new h(t,e);n("SemVer",t,e),this.options=e,this.loose=!!e.loose;var s=t.trim().match(e.loose?i[o.LOOSE]:i[o.FULL]);if(!s)throw new TypeError("Invalid Version: "+t);if(this.raw=t,this.major=+s[1],this.minor=+s[2],this.patch=+s[3],this.major>r||this.major<0)throw new TypeError("Invalid major version");if(this.minor>r||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>r||this.patch<0)throw new TypeError("Invalid patch version");this.prerelease=s[4]?s[4].split(".").map((function(t){if(/^[0-9]+$/.test(t)){var e=+t;if(e>=0&&e<r)return e}return t})):[],this.build=s[5]?s[5].split("."):[],this.format()}e.parse=c,e.valid=function(t,e){var n=c(t,e);return n?n.version:null},e.clean=function(t,e){var n=c(t.trim().replace(/^[=v]+/,""),e);return n?n.version:null},e.SemVer=h,h.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},h.prototype.toString=function(){return this.version},h.prototype.compare=function(t){return n("SemVer.compare",this.version,this.options,t),t instanceof h||(t=new h(t,this.options)),this.compareMain(t)||this.comparePre(t)},h.prototype.compareMain=function(t){return t instanceof h||(t=new h(t,this.options)),f(this.major,t.major)||f(this.minor,t.minor)||f(this.patch,t.patch)},h.prototype.comparePre=function(t){if(t instanceof h||(t=new h(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;var e=0;do{var r=this.prerelease[e],i=t.prerelease[e];if(n("prerelease compare",e,r,i),void 0===r&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===r)return-1;if(r!==i)return f(r,i)}while(++e)},h.prototype.compareBuild=function(t){t instanceof h||(t=new h(t,this.options));var e=0;do{var r=this.build[e],i=t.build[e];if(n("prerelease compare",e,r,i),void 0===r&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===r)return-1;if(r!==i)return f(r,i)}while(++e)},h.prototype.inc=function(t,e){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e),this.inc("pre",e);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",e),this.inc("pre",e);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(var n=this.prerelease.length;--n>=0;)"number"==typeof this.prerelease[n]&&(this.prerelease[n]++,n=-2);-1===n&&this.prerelease.push(0)}e&&(this.prerelease[0]===e?isNaN(this.prerelease[1])&&(this.prerelease=[e,0]):this.prerelease=[e,0]);break;default:throw new Error("invalid increment argument: "+t)}return this.format(),this.raw=this.version,this},e.inc=function(t,e,n,r){"string"==typeof n&&(r=n,n=void 0);try{return new h(t,n).inc(e,r).version}catch(i){return null}},e.diff=function(t,e){if(y(t,e))return null;var n=c(t),r=c(e),i="";if(n.prerelease.length||r.prerelease.length){i="pre";var s="prerelease"}for(var o in n)if(("major"===o||"minor"===o||"patch"===o)&&n[o]!==r[o])return i+o;return s},e.compareIdentifiers=f;var d=/^[0-9]+$/;function f(t,e){var n=d.test(t),r=d.test(e);return n&&r&&(t=+t,e=+e),t===e?0:n&&!r?-1:r&&!n?1:t<e?-1:1}function p(t,e,n){return new h(t,n).compare(new h(e,n))}function m(t,e,n){return p(t,e,n)>0}function g(t,e,n){return p(t,e,n)<0}function y(t,e,n){return 0===p(t,e,n)}function v(t,e,n){return 0!==p(t,e,n)}function b(t,e,n){return p(t,e,n)>=0}function x(t,e,n){return p(t,e,n)<=0}function _(t,e,n,r){switch(e){case"===":return"object"==typeof t&&(t=t.version),"object"==typeof n&&(n=n.version),t===n;case"!==":return"object"==typeof t&&(t=t.version),"object"==typeof n&&(n=n.version),t!==n;case"":case"=":case"==":return y(t,n,r);case"!=":return v(t,n,r);case">":return m(t,n,r);case">=":return b(t,n,r);case"<":return g(t,n,r);case"<=":return x(t,n,r);default:throw new TypeError("Invalid operator: "+e)}}function w(t,e){if(e&&"object"==typeof e||(e={loose:!!e,includePrerelease:!1}),t instanceof w){if(t.loose===!!e.loose)return t;t=t.value}if(!(this instanceof w))return new w(t,e);n("comparator",t,e),this.options=e,this.loose=!!e.loose,this.parse(t),this.value=this.semver===S?"":this.operator+this.semver.version,n("comp",this)}e.rcompareIdentifiers=function(t,e){return f(e,t)},e.major=function(t,e){return new h(t,e).major},e.minor=function(t,e){return new h(t,e).minor},e.patch=function(t,e){return new h(t,e).patch},e.compare=p,e.compareLoose=function(t,e){return p(t,e,!0)},e.compareBuild=function(t,e,n){var r=new h(t,n),i=new h(e,n);return r.compare(i)||r.compareBuild(i)},e.rcompare=function(t,e,n){return p(e,t,n)},e.sort=function(t,n){return t.sort((function(t,r){return e.compareBuild(t,r,n)}))},e.rsort=function(t,n){return t.sort((function(t,r){return e.compareBuild(r,t,n)}))},e.gt=m,e.lt=g,e.eq=y,e.neq=v,e.gte=b,e.lte=x,e.cmp=_,e.Comparator=w;var S={};function C(t,e){if(e&&"object"==typeof e||(e={loose:!!e,includePrerelease:!1}),t instanceof C)return t.loose===!!e.loose&&t.includePrerelease===!!e.includePrerelease?t:new C(t.raw,e);if(t instanceof w)return new C(t.value,e);if(!(this instanceof C))return new C(t,e);if(this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease,this.raw=t,this.set=t.split(/\s*\|\|\s*/).map((function(t){return this.parseRange(t.trim())}),this).filter((function(t){return t.length})),!this.set.length)throw new TypeError("Invalid SemVer Range: "+t);this.format()}function E(t,e){for(var n=!0,r=t.slice(),i=r.pop();n&&r.length;)n=r.every((function(t){return i.intersects(t,e)})),i=r.pop();return n}function k(t){return!t||"x"===t.toLowerCase()||"*"===t}function A(t,e,n,r,i,s,o,a,l,u,c,h,d){return((e=k(n)?"":k(r)?">="+n+".0.0":k(i)?">="+n+"."+r+".0":">="+e)+" "+(a=k(l)?"":k(u)?"<"+(+l+1)+".0.0":k(c)?"<"+l+"."+(+u+1)+".0":h?"<="+l+"."+u+"."+c+"-"+h:"<="+a)).trim()}function D(t,e,r){for(var i=0;i<t.length;i++)if(!t[i].test(e))return!1;if(e.prerelease.length&&!r.includePrerelease){for(i=0;i<t.length;i++)if(n(t[i].semver),t[i].semver!==S&&t[i].semver.prerelease.length>0){var s=t[i].semver;if(s.major===e.major&&s.minor===e.minor&&s.patch===e.patch)return!0}return!1}return!0}function N(t,e,n){try{e=new C(e,n)}catch(r){return!1}return e.test(t)}function T(t,e,n,r){var i,s,o,a,l;switch(t=new h(t,r),e=new C(e,r),n){case">":i=m,s=x,o=g,a=">",l=">=";break;case"<":i=g,s=b,o=m,a="<",l="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(N(t,e,r))return!1;for(var u=0;u<e.set.length;++u){var c=null,d=null;if(e.set[u].forEach((function(t){t.semver===S&&(t=new w(">=0.0.0")),d=d||t,i(t.semver,(c=c||t).semver,r)?c=t:o(t.semver,d.semver,r)&&(d=t)})),c.operator===a||c.operator===l)return!1;if((!d.operator||d.operator===a)&&s(t,d.semver))return!1;if(d.operator===l&&o(t,d.semver))return!1}return!0}w.prototype.parse=function(t){var e=t.match(this.options.loose?i[o.COMPARATORLOOSE]:i[o.COMPARATOR]);if(!e)throw new TypeError("Invalid comparator: "+t);this.operator=void 0!==e[1]?e[1]:"","="===this.operator&&(this.operator=""),this.semver=e[2]?new h(e[2],this.options.loose):S},w.prototype.toString=function(){return this.value},w.prototype.test=function(t){if(n("Comparator.test",t,this.options.loose),this.semver===S||t===S)return!0;if("string"==typeof t)try{t=new h(t,this.options)}catch(e){return!1}return _(t,this.operator,this.semver,this.options)},w.prototype.intersects=function(t,e){if(!(t instanceof w))throw new TypeError("a Comparator is required");var n;if(e&&"object"==typeof e||(e={loose:!!e,includePrerelease:!1}),""===this.operator)return""===this.value||(n=new C(t.value,e),N(this.value,n,e));if(""===t.operator)return""===t.value||(n=new C(this.value,e),N(t.semver,n,e));var r=!(">="!==this.operator&&">"!==this.operator||">="!==t.operator&&">"!==t.operator),i=!("<="!==this.operator&&"<"!==this.operator||"<="!==t.operator&&"<"!==t.operator),s=this.semver.version===t.semver.version,o=!(">="!==this.operator&&"<="!==this.operator||">="!==t.operator&&"<="!==t.operator),a=_(this.semver,"<",t.semver,e)&&(">="===this.operator||">"===this.operator)&&("<="===t.operator||"<"===t.operator),l=_(this.semver,">",t.semver,e)&&("<="===this.operator||"<"===this.operator)&&(">="===t.operator||">"===t.operator);return r||i||s&&o||a||l},e.Range=C,C.prototype.format=function(){return this.range=this.set.map((function(t){return t.join(" ").trim()})).join("||").trim(),this.range},C.prototype.toString=function(){return this.range},C.prototype.parseRange=function(t){var e=this.options.loose;t=(t=t.trim()).replace(e?i[o.HYPHENRANGELOOSE]:i[o.HYPHENRANGE],A),n("hyphen replace",t),t=t.replace(i[o.COMPARATORTRIM],"$1$2$3"),n("comparator trim",t,i[o.COMPARATORTRIM]),t=(t=(t=t.replace(i[o.TILDETRIM],"$1~")).replace(i[o.CARETTRIM],"$1^")).split(/\s+/).join(" ");var r=e?i[o.COMPARATORLOOSE]:i[o.COMPARATOR],s=t.split(" ").map((function(t){return function(t,e){return n("comp",t,e),t=function(t,e){return t.trim().split(/\s+/).map((function(t){return function(t,e){return n("caret",t,e),t.replace(e.loose?i[o.CARETLOOSE]:i[o.CARET],(function(e,r,i,s,o){var a;return n("caret",t,e,r,i,s,o),k(r)?a="":k(i)?a=">="+r+".0.0 <"+(+r+1)+".0.0":k(s)?a="0"===r?">="+r+"."+i+".0 <"+r+"."+(+i+1)+".0":">="+r+"."+i+".0 <"+(+r+1)+".0.0":o?(n("replaceCaret pr",o),a="0"===r?"0"===i?">="+r+"."+i+"."+s+"-"+o+" <"+r+"."+i+"."+(+s+1):">="+r+"."+i+"."+s+"-"+o+" <"+r+"."+(+i+1)+".0":">="+r+"."+i+"."+s+"-"+o+" <"+(+r+1)+".0.0"):(n("no pr"),a="0"===r?"0"===i?">="+r+"."+i+"."+s+" <"+r+"."+i+"."+(+s+1):">="+r+"."+i+"."+s+" <"+r+"."+(+i+1)+".0":">="+r+"."+i+"."+s+" <"+(+r+1)+".0.0"),n("caret return",a),a}))}(t,e)})).join(" ")}(t,e),n("caret",t),t=function(t,e){return t.trim().split(/\s+/).map((function(t){return function(t,e){return t.replace(e.loose?i[o.TILDELOOSE]:i[o.TILDE],(function(e,r,i,s,o){var a;return n("tilde",t,e,r,i,s,o),k(r)?a="":k(i)?a=">="+r+".0.0 <"+(+r+1)+".0.0":k(s)?a=">="+r+"."+i+".0 <"+r+"."+(+i+1)+".0":o?(n("replaceTilde pr",o),a=">="+r+"."+i+"."+s+"-"+o+" <"+r+"."+(+i+1)+".0"):a=">="+r+"."+i+"."+s+" <"+r+"."+(+i+1)+".0",n("tilde return",a),a}))}(t,e)})).join(" ")}(t,e),n("tildes",t),t=function(t,e){return n("replaceXRanges",t,e),t.split(/\s+/).map((function(t){return function(t,e){return(t=t.trim()).replace(e.loose?i[o.XRANGELOOSE]:i[o.XRANGE],(function(r,i,s,o,a,l){n("xRange",t,r,i,s,o,a,l);var u=k(s),c=u||k(o),h=c||k(a);return"="===i&&h&&(i=""),l=e.includePrerelease?"-0":"",u?r=">"===i||"<"===i?"<0.0.0-0":"*":i&&h?(c&&(o=0),a=0,">"===i?(i=">=",c?(s=+s+1,o=0,a=0):(o=+o+1,a=0)):"<="===i&&(i="<",c?s=+s+1:o=+o+1),r=i+s+"."+o+"."+a+l):c?r=">="+s+".0.0"+l+" <"+(+s+1)+".0.0"+l:h&&(r=">="+s+"."+o+".0"+l+" <"+s+"."+(+o+1)+".0"+l),n("xRange return",r),r}))}(t,e)})).join(" ")}(t,e),n("xrange",t),t=function(t,e){return n("replaceStars",t,e),t.trim().replace(i[o.STAR],"")}(t,e),n("stars",t),t}(t,this.options)}),this).join(" ").split(/\s+/);return this.options.loose&&(s=s.filter((function(t){return!!t.match(r)}))),s.map((function(t){return new w(t,this.options)}),this)},C.prototype.intersects=function(t,e){if(!(t instanceof C))throw new TypeError("a Range is required");return this.set.some((function(n){return E(n,e)&&t.set.some((function(t){return E(t,e)&&n.every((function(n){return t.every((function(t){return n.intersects(t,e)}))}))}))}))},e.toComparators=function(t,e){return new C(t,e).set.map((function(t){return t.map((function(t){return t.value})).join(" ").trim().split(" ")}))},C.prototype.test=function(t){if(!t)return!1;if("string"==typeof t)try{t=new h(t,this.options)}catch(n){return!1}for(var e=0;e<this.set.length;e++)if(D(this.set[e],t,this.options))return!0;return!1},e.satisfies=N,e.maxSatisfying=function(t,e,n){var r=null,i=null;try{var s=new C(e,n)}catch(o){return null}return t.forEach((function(t){s.test(t)&&(r&&-1!==i.compare(t)||(i=new h(r=t,n)))})),r},e.minSatisfying=function(t,e,n){var r=null,i=null;try{var s=new C(e,n)}catch(o){return null}return t.forEach((function(t){s.test(t)&&(r&&1!==i.compare(t)||(i=new h(r=t,n)))})),r},e.minVersion=function(t,e){t=new C(t,e);var n=new h("0.0.0");if(t.test(n))return n;if(n=new h("0.0.0-0"),t.test(n))return n;n=null;for(var r=0;r<t.set.length;++r)t.set[r].forEach((function(t){var e=new h(t.semver.version);switch(t.operator){case">":0===e.prerelease.length?e.patch++:e.prerelease.push(0),e.raw=e.format();case"":case">=":n&&!m(n,e)||(n=e);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+t.operator)}}));return n&&t.test(n)?n:null},e.validRange=function(t,e){try{return new C(t,e).range||"*"}catch(n){return null}},e.ltr=function(t,e,n){return T(t,e,"<",n)},e.gtr=function(t,e,n){return T(t,e,">",n)},e.outside=T,e.prerelease=function(t,e){var n=c(t,e);return n&&n.prerelease.length?n.prerelease:null},e.intersects=function(t,e,n){return t=new C(t,n),e=new C(e,n),t.intersects(e)},e.coerce=function(t,e){if(t instanceof h)return t;if("number"==typeof t&&(t=String(t)),"string"!=typeof t)return null;var n=null;if((e=e||{}).rtl){for(var r;(r=i[o.COERCERTL].exec(t))&&(!n||n.index+n[0].length!==t.length);)n&&r.index+r[0].length===n.index+n[0].length||(n=r),i[o.COERCERTL].lastIndex=r.index+r[1].length+r[2].length;i[o.COERCERTL].lastIndex=-1}else n=t.match(i[o.COERCE]);return null===n?null:c(n[2]+"."+(n[3]||"0")+"."+(n[4]||"0"),e)}},EhIR:function(t,e,n){(function(t){var r;!function(t,i,s){function o(t){var e,n=this,r=(e=4022871197,function(t){t=t.toString();for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)});n.next=function(){var t=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=t-(n.c=0|t)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(t),n.s0<0&&(n.s0+=1),n.s1-=r(t),n.s1<0&&(n.s1+=1),n.s2-=r(t),n.s2<0&&(n.s2+=1),r=null}function a(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function l(t,e){var n=new o(t),r=e&&e.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,r&&("object"==typeof r&&a(r,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=l:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return l}).call(e,n,e,i))||(i.exports=r):this.alea=l}(0,t,n("B9Yq"))}).call(this,n("YuTi")(t))},Ewl0:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("Ad6o"),i=n("jke5"),s={prepend:!1};e.subSurface=function(t,e,n={}){const o=i.getDrawArea(t),a=r.css({"& canvas":{display:"block"},marginTop:".5rem",marginBottom:".5rem"}),l=r.css({backgroundColor:"white",display:"inline-block",boxSizing:"border-box",borderBottom:"1px solid #357EDD",lineHeight:"2em",padding:"0 10px 0 10px",marginBottom:"20px",fontWeight:"600",textAlign:"left"}),u=Object.assign({},s,n);let c=o.querySelector(`div[data-name=${e}]`);if(!c){if(c=document.createElement("div"),c.setAttribute("class",""+a),c.dataset.name=e,u.title){const t=document.createElement("div");t.setAttribute("class","subsurface-title "+l),t.innerText=u.title,c.appendChild(t)}u.prepend?o.insertBefore(c,o.firstChild):o.appendChild(c)}return c},e.getDefaultWidth=function(t){let e=0,n=t;for(;n&&0===n.clientWidth;)n=n.parentElement,e=50;return n.clientWidth-e},e.getDefaultHeight=function(t){return 0===t.clientHeight?200:t.clientHeight}},EzSE:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("ML/J"),i=n("Ad6o");e.Tabs=class extends r.Component{render(){const{tabNames:t,activeTab:e,handleClick:n}=this.props,o=t.length>0?t.map(t=>r.h(s,{key:t,id:t,handleClick:n,isActive:t===e},t)):null,a=i.css({overflowX:"scroll",overflowY:"hidden",whiteSpace:"nowrap",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"#eee",paddingBottom:"1rem",marginTop:"1rem"});return r.h("div",{className:a+" visor-tabs"},o)}};class s extends r.Component{render(){const{children:t,isActive:e,handleClick:n,id:s}=this.props,o=i.css({borderBottomColor:e?"#357EDD":"#AAAAAA",borderBottomWidth:"1px",borderBottomStyle:"solid",cursor:"pointer",":hover":{color:"#357EDD"},display:"inline-block",marginRight:"1rem",padding:".5rem",fontSize:"1rem",fontWeight:"bold"});return r.h("a",{className:o+" tf-tab","data-isactive":e,onClick:()=>n(s)},t)}}},JBAE:function(t,e,n){var r=function(){"use strict";function t(t,e){return null!=e&&t instanceof e}var e,n,r;try{e=Map}catch(a){e=function(){}}try{n=Set}catch(a){n=function(){}}try{r=Promise}catch(a){r=function(){}}function i(s,a,l,u,c){"object"==typeof a&&(l=a.depth,u=a.prototype,c=a.includeNonEnumerable,a=a.circular);var h=[],d=[],f="undefined"!=typeof Buffer;return void 0===a&&(a=!0),void 0===l&&(l=1/0),function s(l,p){if(null===l)return null;if(0===p)return l;var m,g;if("object"!=typeof l)return l;if(t(l,e))m=new e;else if(t(l,n))m=new n;else if(t(l,r))m=new r((function(t,e){l.then((function(e){t(s(e,p-1))}),(function(t){e(s(t,p-1))}))}));else if(i.__isArray(l))m=[];else if(i.__isRegExp(l))m=new RegExp(l.source,o(l)),l.lastIndex&&(m.lastIndex=l.lastIndex);else if(i.__isDate(l))m=new Date(l.getTime());else{if(f&&Buffer.isBuffer(l))return m=Buffer.allocUnsafe?Buffer.allocUnsafe(l.length):new Buffer(l.length),l.copy(m),m;t(l,Error)?m=Object.create(l):void 0===u?(g=Object.getPrototypeOf(l),m=Object.create(g)):(m=Object.create(u),g=u)}if(a){var y=h.indexOf(l);if(-1!=y)return d[y];h.push(l),d.push(m)}for(var v in t(l,e)&&l.forEach((function(t,e){var n=s(e,p-1),r=s(t,p-1);m.set(n,r)})),t(l,n)&&l.forEach((function(t){var e=s(t,p-1);m.add(e)})),l){var b;g&&(b=Object.getOwnPropertyDescriptor(g,v)),b&&null==b.set||(m[v]=s(l[v],p-1))}if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(l);for(v=0;v<x.length;v++){var _=x[v];(!(S=Object.getOwnPropertyDescriptor(l,_))||S.enumerable||c)&&(m[_]=s(l[_],p-1),S.enumerable||Object.defineProperty(m,_,{enumerable:!1}))}}if(c){var w=Object.getOwnPropertyNames(l);for(v=0;v<w.length;v++){var S,C=w[v];(S=Object.getOwnPropertyDescriptor(l,C))&&S.enumerable||(m[C]=s(l[C],p-1),Object.defineProperty(m,C,{enumerable:!1}))}}return m}(s,l)}function s(t){return Object.prototype.toString.call(t)}function o(t){var e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),e}return i.clonePrototype=function(t){if(null===t)return null;var e=function(){};return e.prototype=t,new e},i.__objToStr=s,i.__isDate=function(t){return"object"==typeof t&&"[object Date]"===s(t)},i.__isArray=function(t){return"object"==typeof t&&"[object Array]"===s(t)},i.__isRegExp=function(t){return"object"==typeof t&&"[object RegExp]"===s(t)},i.__getRegExpFlags=o,i}();t.exports&&(t.exports=r)},LwnN:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("rtRu");let i;e.visor=function(){if("undefined"==typeof document)throw new Error("No document defined. This library needs a browser/dom to work");if(document.getElementById("tfjs-visor-container")&&null!=i)return i;let t,e=document.getElementById("tfjs-visor-container");function n(e,n){let i=null;return t=r.VisorComponent.render(e,t,{ref:t=>i=t,surfaceList:Array.from(n.values())}),i}null==e&&(e=document.createElement("div"),e.id="tfjs-visor-container",document.body.appendChild(e));const o=new Map,a=n(e,o);return i=new s(a,e,o,n),i};class s{constructor(t,e,n,r){this.visorComponent=t,this.el=e,this.surfaceList=n,this.renderVisor=r}surface(t){const{name:e}=t,n=null==t.tab?"Visor":t.tab;if(null==e||!("string"==typeof e||e instanceof String))throw new Error("You must pass a config object with a 'name' property to create or retrieve a surface");const r=Object.assign({},t,{tab:n}),i=`${e}-${n}`;return this.surfaceList.has(i)||this.surfaceList.set(i,r),this.renderVisor(this.el,this.surfaceList),this.visorComponent.getSurface(e,n)}isFullscreen(){return this.visorComponent.isFullscreen()}isOpen(){return this.visorComponent.isOpen()}close(){return this.visorComponent.close()}open(){return this.visorComponent.open()}toggle(){return this.visorComponent.toggle()}toggleFullScreen(){return this.visorComponent.toggleFullScreen()}bindKeys(){return this.visorComponent.bindKeys()}unbindKeys(){return this.visorComponent.unbindKeys()}setActiveTab(t){if(!this.visorComponent.state.tabs.has(t))throw new Error(`Tab '${t}' does not exist`);this.visorComponent.setState({activeTab:t})}}e.Visor=s},MAmL:function(t,e,n){"use strict";n.r(e);var r=/[A-Z]/g,i=/^ms-/,s={};function o(t){return"-"+t.toLowerCase()}e.default=function(t){if(s.hasOwnProperty(t))return s[t];var e=t.replace(r,o);return s[t]=i.test(e)?"-"+e:e}},"ML/J":function(t,e,n){"use strict";function r(){}n.r(e),n.d(e,"h",(function(){return a})),n.d(e,"createElement",(function(){return a})),n.d(e,"cloneElement",(function(){return c})),n.d(e,"Component",(function(){return M})),n.d(e,"render",(function(){return $})),n.d(e,"rerender",(function(){return p})),n.d(e,"options",(function(){return i}));var i={},s=[],o=[];function a(t,e){var n,a,l,u,c=o;for(u=arguments.length;u-- >2;)s.push(arguments[u]);for(e&&null!=e.children&&(s.length||s.push(e.children),delete e.children);s.length;)if((a=s.pop())&&void 0!==a.pop)for(u=a.length;u--;)s.push(a[u]);else"boolean"==typeof a&&(a=null),(l="function"!=typeof t)&&(null==a?a="":"number"==typeof a?a=String(a):"string"!=typeof a&&(l=!1)),l&&n?c[c.length-1]+=a:c===o?c=[a]:c.push(a),n=l;var h=new r;return h.nodeName=t,h.children=c,h.attributes=null==e?void 0:e,h.key=null==e?void 0:e.key,void 0!==i.vnode&&i.vnode(h),h}function l(t,e){for(var n in e)t[n]=e[n];return t}var u="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout;function c(t,e){return a(t.nodeName,l(l({},t.attributes),e),arguments.length>2?[].slice.call(arguments,2):t.children)}var h=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,d=[];function f(t){!t._dirty&&(t._dirty=!0)&&1==d.push(t)&&(i.debounceRendering||u)(p)}function p(){var t,e=d;for(d=[];t=e.pop();)t._dirty&&R(t)}function m(t,e,n){return"string"==typeof e||"number"==typeof e?void 0!==t.splitText:"string"==typeof e.nodeName?!t._componentConstructor&&g(t,e.nodeName):n||t._componentConstructor===e.nodeName}function g(t,e){return t.normalizedNodeName===e||t.nodeName.toLowerCase()===e.toLowerCase()}function y(t){var e=l({},t.attributes);e.children=t.children;var n=t.nodeName.defaultProps;if(void 0!==n)for(var r in n)void 0===e[r]&&(e[r]=n[r]);return e}function v(t){var e=t.parentNode;e&&e.removeChild(t)}function b(t,e,n,r,i){if("className"===e&&(e="class"),"key"===e);else if("ref"===e)n&&n(null),r&&r(t);else if("class"!==e||i)if("style"===e){if(r&&"string"!=typeof r&&"string"!=typeof n||(t.style.cssText=r||""),r&&"object"==typeof r){if("string"!=typeof n)for(var s in n)s in r||(t.style[s]="");for(var s in r)t.style[s]="number"==typeof r[s]&&!1===h.test(s)?r[s]+"px":r[s]}}else if("dangerouslySetInnerHTML"===e)r&&(t.innerHTML=r.__html||"");else if("o"==e[0]&&"n"==e[1]){var o=e!==(e=e.replace(/Capture$/,""));e=e.toLowerCase().substring(2),r?n||t.addEventListener(e,x,o):t.removeEventListener(e,x,o),(t._listeners||(t._listeners={}))[e]=r}else if("list"!==e&&"type"!==e&&!i&&e in t)!function(t,e,n){try{t[e]=n}catch(r){}}(t,e,null==r?"":r),null!=r&&!1!==r||t.removeAttribute(e);else{var a=i&&e!==(e=e.replace(/^xlink:?/,""));null==r||!1===r?a?t.removeAttributeNS("http://www.w3.org/1999/xlink",e.toLowerCase()):t.removeAttribute(e):"function"!=typeof r&&(a?t.setAttributeNS("http://www.w3.org/1999/xlink",e.toLowerCase(),r):t.setAttribute(e,r))}else t.className=r||""}function x(t){return this._listeners[t.type](i.event&&i.event(t)||t)}var _=[],w=0,S=!1,C=!1;function E(){for(var t;t=_.pop();)i.afterMount&&i.afterMount(t),t.componentDidMount&&t.componentDidMount()}function k(t,e,n,r,i,s){w++||(S=null!=i&&void 0!==i.ownerSVGElement,C=null!=t&&!("__preactattr_"in t));var o=function t(e,n,r,i,s){var o=e,a=S;if(null!=n&&"boolean"!=typeof n||(n=""),"string"==typeof n||"number"==typeof n)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||s)?e.nodeValue!=n&&(e.nodeValue=n):(o=document.createTextNode(n),e&&(e.parentNode&&e.parentNode.replaceChild(o,e),A(e,!0))),o.__preactattr_=!0,o;var l,u,c=n.nodeName;if("function"==typeof c)return function(t,e,n,r){for(var i=t&&t._component,s=i,o=t,a=i&&t._componentConstructor===e.nodeName,l=a,u=y(e);i&&!l&&(i=i._parentComponent);)l=i.constructor===e.nodeName;return i&&l&&(!r||i._component)?(I(i,u,3,n,r),t=i.base):(s&&!a&&(F(s),t=o=null),i=T(e.nodeName,u,n),t&&!i.nextBase&&(i.nextBase=t,o=null),I(i,u,1,n,r),t=i.base,o&&t!==o&&(o._component=null,A(o,!1))),t}(e,n,r,i);if(S="svg"===c||"foreignObject"!==c&&S,c=String(c),(!e||!g(e,c))&&(l=c,(u=S?document.createElementNS("http://www.w3.org/2000/svg",l):document.createElement(l)).normalizedNodeName=l,o=u,e)){for(;e.firstChild;)o.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(o,e),A(e,!0)}var h=o.firstChild,d=o.__preactattr_,f=n.children;if(null==d){d=o.__preactattr_={};for(var p=o.attributes,x=p.length;x--;)d[p[x].name]=p[x].value}return!C&&f&&1===f.length&&"string"==typeof f[0]&&null!=h&&void 0!==h.splitText&&null==h.nextSibling?h.nodeValue!=f[0]&&(h.nodeValue=f[0]):(f&&f.length||null!=h)&&function(e,n,r,i,s){var o,a,l,u,c,h=e.childNodes,d=[],f={},p=0,g=0,y=h.length,b=0,x=n?n.length:0;if(0!==y)for(var _=0;_<y;_++){var w=h[_],S=w.__preactattr_;null!=(C=x&&S?w._component?w._component.__key:S.key:null)?(p++,f[C]=w):(S||(void 0!==w.splitText?!s||w.nodeValue.trim():s))&&(d[b++]=w)}if(0!==x)for(_=0;_<x;_++){var C;if(c=null,null!=(C=(u=n[_]).key))p&&void 0!==f[C]&&(c=f[C],f[C]=void 0,p--);else if(!c&&g<b)for(o=g;o<b;o++)if(void 0!==d[o]&&m(a=d[o],u,s)){c=a,d[o]=void 0,o===b-1&&b--,o===g&&g++;break}c=t(c,u,r,i),l=h[_],c&&c!==e&&c!==l&&(null==l?e.appendChild(c):c===l.nextSibling?v(l):e.insertBefore(c,l))}if(p)for(var _ in f)void 0!==f[_]&&A(f[_],!1);for(;g<=b;)void 0!==(c=d[b--])&&A(c,!1)}(o,f,r,i,C||null!=d.dangerouslySetInnerHTML),function(t,e,n){var r;for(r in n)e&&null!=e[r]||null==n[r]||b(t,r,n[r],n[r]=void 0,S);for(r in e)"children"===r||"innerHTML"===r||r in n&&e[r]===("value"===r||"checked"===r?t[r]:n[r])||b(t,r,n[r],n[r]=e[r],S)}(o,n.attributes,d),S=a,o}(t,e,n,r,s);return i&&o.parentNode!==i&&i.appendChild(o),--w||(C=!1,s||E()),o}function A(t,e){var n=t._component;n?F(n):(null!=t.__preactattr_&&t.__preactattr_.ref&&t.__preactattr_.ref(null),!1!==e&&null!=t.__preactattr_||v(t),D(t))}function D(t){for(t=t.lastChild;t;){var e=t.previousSibling;A(t,!0),t=e}}var N={};function T(t,e,n){var r,i=N[t.name];if(t.prototype&&t.prototype.render?(r=new t(e,n),M.call(r,e,n)):((r=new M(e,n)).constructor=t,r.render=O),i)for(var s=i.length;s--;)if(i[s].constructor===t){r.nextBase=i[s].nextBase,i.splice(s,1);break}return r}function O(t,e,n){return this.constructor(t,n)}function I(t,e,n,r,s){t._disable||(t._disable=!0,(t.__ref=e.ref)&&delete e.ref,(t.__key=e.key)&&delete e.key,!t.base||s?t.componentWillMount&&t.componentWillMount():t.componentWillReceiveProps&&t.componentWillReceiveProps(e,r),r&&r!==t.context&&(t.prevContext||(t.prevContext=t.context),t.context=r),t.prevProps||(t.prevProps=t.props),t.props=e,t._disable=!1,0!==n&&(1!==n&&!1===i.syncComponentUpdates&&t.base?f(t):R(t,1,s)),t.__ref&&t.__ref(t))}function R(t,e,n,r){if(!t._disable){var s,o,a,u=t.props,c=t.state,h=t.context,d=t.prevProps||u,f=t.prevState||c,p=t.prevContext||h,m=t.base,g=t.nextBase,v=m||g,b=t._component,x=!1;if(m&&(t.props=d,t.state=f,t.context=p,2!==e&&t.shouldComponentUpdate&&!1===t.shouldComponentUpdate(u,c,h)?x=!0:t.componentWillUpdate&&t.componentWillUpdate(u,c,h),t.props=u,t.state=c,t.context=h),t.prevProps=t.prevState=t.prevContext=t.nextBase=null,t._dirty=!1,!x){s=t.render(u,c,h),t.getChildContext&&(h=l(l({},h),t.getChildContext()));var S,C,D=s&&s.nodeName;if("function"==typeof D){var N=y(s);(o=b)&&o.constructor===D&&N.key==o.__key?I(o,N,1,h,!1):(S=o,t._component=o=T(D,N,h),o.nextBase=o.nextBase||g,o._parentComponent=t,I(o,N,0,h,!1),R(o,1,n,!0)),C=o.base}else a=v,(S=b)&&(a=t._component=null),(v||1===e)&&(a&&(a._component=null),C=k(a,s,h,n||!m,v&&v.parentNode,!0));if(v&&C!==v&&o!==b){var O=v.parentNode;O&&C!==O&&(O.replaceChild(C,v),S||(v._component=null,A(v,!1)))}if(S&&F(S),t.base=C,C&&!r){for(var M=t,$=t;$=$._parentComponent;)(M=$).base=C;C._component=M,C._componentConstructor=M.constructor}}if(!m||n?_.unshift(t):x||(t.componentDidUpdate&&t.componentDidUpdate(d,f,p),i.afterUpdate&&i.afterUpdate(t)),null!=t._renderCallbacks)for(;t._renderCallbacks.length;)t._renderCallbacks.pop().call(t);w||r||E()}}function F(t){i.beforeUnmount&&i.beforeUnmount(t);var e=t.base;t._disable=!0,t.componentWillUnmount&&t.componentWillUnmount(),t.base=null;var n=t._component;n?F(n):e&&(e.__preactattr_&&e.__preactattr_.ref&&e.__preactattr_.ref(null),t.nextBase=e,v(e),function(t){var e=t.constructor.name;(N[e]||(N[e]=[])).push(t)}(t),D(e)),t.__ref&&t.__ref(null)}function M(t,e){this._dirty=!0,this.context=e,this.props=t,this.state=this.state||{}}function $(t,e,n){return k(n,t,{},!1,e,!1)}l(M.prototype,{setState:function(t,e){var n=this.state;this.prevState||(this.prevState=l({},n)),l(n,"function"==typeof t?t(n,this.props):t),e&&(this._renderCallbacks=this._renderCallbacks||[]).push(e),f(this)},forceUpdate:function(t){t&&(this._renderCallbacks=this._renderCallbacks||[]).push(t),R(this,2)},render:function(){}}),e.default={h:a,createElement:a,cloneElement:c,Component:M,render:$,rerender:p,options:i}},MgzW:function(t,e,n){"use strict";var r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;function o(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(t){r[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(i){return!1}}()?Object.assign:function(t,e){for(var n,a,l=o(t),u=1;u<arguments.length;u++){for(var c in n=Object(arguments[u]))i.call(n,c)&&(l[c]=n[c]);if(r){a=r(n);for(var h=0;h<a.length;h++)s.call(n,a[h])&&(l[a[h]]=n[a[h]])}}return l}},NgHg:function(t,e,n){"use strict";var r=/-(.)/g;t.exports=function(t){return t.replace(r,(function(t,e){return e.toUpperCase()}))}},PDX0:function(t,e){(function(e){t.exports=e}).call(this,{})},PE4B:function(t,e,n){"use strict";var r=function(t){return function(t){return!!t&&"object"==typeof t}(t)&&!function(t){var e=Object.prototype.toString.call(t);return"[object RegExp]"===e||"[object Date]"===e||function(t){return t.$$typeof===i}(t)}(t)},i="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function s(t,e){return!1!==e.clone&&e.isMergeableObject(t)?u(Array.isArray(t)?[]:{},t,e):t}function o(t,e,n){return t.concat(e).map((function(t){return s(t,n)}))}function a(t){return Object.keys(t).concat(function(t){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(t).filter((function(e){return t.propertyIsEnumerable(e)})):[]}(t))}function l(t,e){try{return e in t}catch(n){return!1}}function u(t,e,n){(n=n||{}).arrayMerge=n.arrayMerge||o,n.isMergeableObject=n.isMergeableObject||r,n.cloneUnlessOtherwiseSpecified=s;var i=Array.isArray(e);return i===Array.isArray(t)?i?n.arrayMerge(t,e,n):function(t,e,n){var r={};return n.isMergeableObject(t)&&a(t).forEach((function(e){r[e]=s(t[e],n)})),a(e).forEach((function(i){(function(t,e){return l(t,e)&&!(Object.hasOwnProperty.call(t,e)&&Object.propertyIsEnumerable.call(t,e))})(t,i)||(r[i]=l(t,i)&&n.isMergeableObject(e[i])?function(t,e){if(!e.customMerge)return u;var n=e.customMerge(t);return"function"==typeof n?n:u}(i,n)(t[i],e[i],n):s(e[i],n))})),r}(t,e,n):s(e,n)}u.all=function(t,e){if(!Array.isArray(t))throw new Error("first argument should be an array");return t.reduce((function(t,n){return u(t,n,e)}),{})},t.exports=u},Pp8E:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n,r,i){for(var s=0,o=t.length;s<o;++s){var a=t[s](e,n,r,i);if(a)return a}},t.exports=e.default},QUk2:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(e){s(e)}}function a(t){try{l(r.throw(t))}catch(e){s(e)}}function l(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(o,a)}l((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const i=n("zhpf"),s=n("YYB2");e.arrayStats=function(t){if(!Array.isArray(t))throw new Error("input must be an array");if(0===t.length)return{numVals:0,numNans:0,numZeros:0,max:void 0,min:void 0};const e=t.length;let n=-1/0,r=1/0,i=0,s=0,o=0;for(let l=0;l<e;l++){const e=t[l];e>n&&(n=e),e<r&&(r=e),0===e&&(i+=1),isNaN(e)?s+=1:isFinite(e)||(o+=1)}const a={numVals:e,numZeros:i,numNans:s,max:n,min:r,numInfs:o};return a.max===-1/0&&(a.max=NaN),a.min===1/0&&(a.min=NaN),a},e.tensorStats=function(t){return r(this,void 0,void 0,(function*(){const[e,n,r]=i.tidy(()=>{const e=i.scalar(0,t.dtype);return[t.min(),t.max(),t.equal(e).sum()]});return Promise.all([t.data(),e.data(),n.data(),r.data()]).then(([t,e,n,r])=>{const i=t.length;let s=0,o=0;for(let u=0;u<i;u++){const e=t[u];isNaN(e)?s+=1:isFinite(e)||(o+=1)}let a=e[0],l=n[0];return s===i&&(a=NaN,l=NaN),{numVals:i,numZeros:r[0],numNans:s,min:a,max:l,numInfs:o}})}))},e.confusionMatrix=function(t,e,n,o){return r(this,void 0,void 0,(function*(){s.assert(1===t.rank,"labels must be a 1D tensor"),s.assert(1===e.rank,"predictions must be a 1D tensor"),s.assert(t.size===e.size,"labels and predictions must be the same length"),null!=o&&s.assert(o.size===e.size,"labels and predictions must be the same length");const r=t.cast("int32"),a=e.cast("int32");null==n&&(n=i.tidy(()=>i.maximum(r.max(),a.max()).cast("int32").dataSync()[0]+1));let l=Promise.resolve(null);return null!=o&&(l=o.data()),Promise.all([r.data(),a.data(),l]).then(([t,e,r])=>{const i=Array(n).fill(0);for(let s=0;s<n;s++)i[s]=Array(n).fill(0);for(let n=0;n<t.length;n++)i[t[n]][e[n]]+=null!=r?r[n]:1;return i})}))},e.accuracy=function(t,e){return r(this,void 0,void 0,(function*(){s.assertShapesMatch(t.shape,e.shape,"Error computing accuracy.");const n=t.equal(e),r=n.mean(),o=(yield r.data())[0];return i.dispose([n,r]),o}))},e.perClassAccuracy=function(t,e,n){return r(this,void 0,void 0,(function*(){return s.assert(1===t.rank,"labels must be a 1D tensor"),s.assert(1===e.rank,"predictions must be a 1D tensor"),s.assert(t.size===e.size,"labels and predictions must be the same length"),null==n&&(n=i.tidy(()=>i.maximum(t.max(),e.max()).dataSync()[0]+1)),Promise.all([t.data(),e.data()]).then(([t,e])=>{const r=Array(n).fill(0),i=Array(n).fill(0);for(let n=0;n<t.length;n++){const s=t[n],o=e[n];r[s]+=1,s===o&&(i[s]+=1)}const s=[];for(let n=0;n<r.length;n++)s.push({count:r[n],accuracy:0===r[n]?0:i[n]/r[n]});return s})}))}},Rq1Q:function(t,e,n){"use strict";t.exports=function t(e,n){if(e===n)return!0;if(e&&n&&"object"==typeof e&&"object"==typeof n){if(e.constructor!==n.constructor)return!1;var r,i,s;if(Array.isArray(e)){if((r=e.length)!=n.length)return!1;for(i=r;0!=i--;)if(!t(e[i],n[i]))return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if((r=(s=Object.keys(e)).length)!==Object.keys(n).length)return!1;for(i=r;0!=i--;)if(!Object.prototype.hasOwnProperty.call(n,s[i]))return!1;for(i=r;0!=i--;){var o=s[i];if(!t(e[o],n[o]))return!1}return!0}return e!=e&&n!=n}},"Rz+p":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return(0,i.default)(t)};var r,i=(r=n("MAmL"))&&r.__esModule?r:{default:r};t.exports=e.default},SDpH:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.StyleSheet=c;var r,i=(r=n("MgzW"))&&r.__esModule?r:{default:r};function s(t){return t[t.length-1]}function o(t){if(t.sheet)return t.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===t)return document.styleSheets[e]}var a="undefined"!=typeof window,l=function(){if(a){var t=document.createElement("div");return t.innerHTML="\x3c!--[if lt IE 10]><i></i><![endif]--\x3e",1===t.getElementsByTagName("i").length}}();function u(){var t=document.createElement("style");return t.type="text/css",t.setAttribute("data-glamor",""),t.appendChild(document.createTextNode("")),(document.head||document.getElementsByTagName("head")[0]).appendChild(t),t}function c(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.speedy,n=void 0===e||e,r=t.maxLength,i=void 0===r?a&&l?4e3:65e3:r;this.isSpeedy=n,this.sheet=void 0,this.tags=[],this.maxLength=i,this.ctr=0}(0,i.default)(c.prototype,{getSheet:function(){return o(s(this.tags))},inject:function(){var t=this;if(this.injected)throw new Error("already injected stylesheet!");a?this.tags[0]=u():this.sheet={cssRules:[],insertRule:function(e){t.sheet.cssRules.push({cssText:e})}},this.injected=!0},speedy:function(t){if(0!==this.ctr)throw new Error("cannot change speedy mode after inserting any rule to sheet. Either call speedy("+t+") earlier in your app, or call flush() before speedy("+t+")");this.isSpeedy=!!t},_insert:function(t){try{var e=this.getSheet();e.insertRule(t,-1!==t.indexOf("@import")?0:e.cssRules.length)}catch(n){}},insert:function(t){if(a)if(this.isSpeedy&&this.getSheet().insertRule)this._insert(t);else if(-1!==t.indexOf("@import")){var e=s(this.tags);e.insertBefore(document.createTextNode(t),e.firstChild)}else s(this.tags).appendChild(document.createTextNode(t));else this.sheet.insertRule(t,-1!==t.indexOf("@import")?0:this.sheet.cssRules.length);return this.ctr++,a&&this.ctr%this.maxLength==0&&this.tags.push(u()),this.ctr-1},delete:function(t){return this.replace(t,"")},flush:function(){a?(this.tags.forEach((function(t){return t.parentNode.removeChild(t)})),this.tags=[],this.sheet=null,this.ctr=0):this.sheet.cssRules=[],this.injected=!1},rules:function(){if(!a)return this.sheet.cssRules;var t=[];return this.tags.forEach((function(e){return t.splice.apply(t,[t.length,0].concat(function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(Array.from(o(e).cssRules))))})),t}})},SFYy:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},t.exports=e.default},Vinz:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("rWgG"),i=n("/TIM"),s=n("Ad6o"),o=n("jke5");e.table=function(t,e,n={}){if(e&&null==e.headers)throw new Error('Data to render must have a "headers" property');if(e&&null==e.values)throw new Error('Data to render must have a "values" property');const l=o.getDrawArea(t),u=Object.assign({},a,n);let c=i.select(l).select("table.tf-table");const h=s.css({fontSize:u.fontSize||".875rem",width:"100%",maxWidth:"64rem",marginRight:"auto",marginLeft:"auto"});if(0===c.size()&&(c=i.select(l).append("table"),c.attr("class",` ${h} tf-table`),c.append("thead").append("tr"),c.append("tbody")),1!==c.size())throw new Error("Error inserting table");const d=s.css({fontWeight:"600",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba( 0, 0, 0, .2 )",textAlign:"left",paddingBottom:"1rem",paddingRight:"1rem",backgroundColor:"#fff"}),f=c.select("thead").select("tr").selectAll("th").data(e.headers),p=f.enter().append("th").attr("class",""+d);f.merge(p).html(t=>t),f.exit().remove();const m=r.format(",.4~f"),g=c.select("tbody").selectAll("tr").data(e.values),y=g.enter().append("tr"),v=s.css({padding:"0.25rem",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba( 0, 0, 0, .2 )"}),b=g.merge(y).selectAll("td").data(t=>t),x=b.enter().append("td").attr("class",""+v);b.merge(x).html(t=>"number"==typeof t?m(t):t),b.exit().remove(),g.exit().remove()};const a={fontSize:14}},YSVl:function(t,e,n){var r=n("EhIR"),i=n("uDiL"),s=n("pJ6O"),o=n("yuCN"),a=n("euyF"),l=n("ie1u"),u=n("pJ3+");u.alea=r,u.xor128=i,u.xorwow=s,u.xorshift7=o,u.xor4096=a,u.tychei=l,t.exports=u},YYB2:function(t,e,n){"use strict";function r(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function i(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}Object.defineProperty(e,"__esModule",{value:!0}),e.assert=r,e.assertShapesMatch=function(t,e,n=""){r(i(t,e),n+` Shapes ${t} and ${e} must match`)},e.arraysEqual=i,e.DECIMAL_PLACES_TO_CHECK=4},YuTi:function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},Z6Kp:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(e){s(e)}}function a(t){try{l(r.throw(t))}catch(e){s(e)}}function l(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(o,a)}l((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const i=n("h1ZQ"),s=n("jke5"),o=n("Vinz"),a=n("Ewl0"),l=n("QUk2");function u(t){let e;return e=Array.isArray(t.outputShape[0])?`[${t.outputShape.map(t=>c(t)).join(", ")}]`:c(t.outputShape),{name:t.name,trainable:t.trainable,parameters:t.countParams(),outputShape:e}}function c(t){const e=t.slice();return 0===e.length?"Scalar":(null===e[0]&&(e[0]="batch"),`[${e.join(",")}]`)}e.modelSummary=function(t,e){return r(this,void 0,void 0,(function*(){const n=s.getDrawArea(t),r=function(t){return{layers:t.layers.map(u)}}(e).layers.map(t=>[t.name,t.outputShape,t.parameters,t.trainable]);o.table(n,{headers:["Layer Name","Output Shape","# Of Params","Trainable"],values:r})}))},e.layer=function(t,e){return r(this,void 0,void 0,(function*(){const n=s.getDrawArea(t),u=yield function(t){return r(this,void 0,void 0,(function*(){const e=t.getWeights(),n=t.weights,r=e.map(l.tensorStats),i=yield Promise.all(r),s=e.map(t=>t.shape);return e.map((t,e)=>({name:n[e].name,stats:i[e],shape:c(s[e]),weight:t}))}))}(e),h=a.subSurface(n,"layer-weights-info"),d=u.map(t=>[t.name,t.shape,t.stats.min,t.stats.max,t.weight.size,t.stats.numZeros,t.stats.numNans,t.stats.numInfs]);o.table(h,{headers:["Weight Name","Shape","Min","Max","# Params","# Zeros","# NaNs","# Infinity"],values:d});const f=a.subSurface(n,"select-layer"),p=a.subSurface(n,"param-distribution");!function(t,e,n){const r=`\n    <select>\n      ${t.map(t=>`<option value=${t}>${t}</option>`)}\n    </select>\n  `;e.innerHTML=`<div><button>Show Values Distribution for:</button>${r}</div>`;const i=e.querySelector("button"),s=e.querySelector("select");i.addEventListener("click",()=>{n(s.selectedOptions[0].label)})}(u.map(t=>t.name),f,t=>r(this,void 0,void 0,(function*(){const e=u.filter(e=>e.name===t)[0],n=yield e.weight.data();i.histogram(p,n,{height:150,width:460,stats:!1})})))}))}},ZYJ9:function(t,e,n){"use strict";var r=/("(?:[^\\"]|\\.)*")|[:,]/g;t.exports=function(t,e){var n,i,s;return e=e||{},n=JSON.stringify([1],void 0,void 0===e.indent?2:e.indent).slice(2,-3),i=""===n?1/0:void 0===e.maxLength?80:e.maxLength,s=e.replacer,function t(e,o,a){var l,u,c,h,d,f,p,m,g,y,v,b;if(e&&"function"==typeof e.toJSON&&(e=e.toJSON()),void 0===(v=JSON.stringify(e,s)))return v;if(v.length<=(p=i-o.length-a)&&(g=v.replace(r,(function(t,e){return e||t+" "}))).length<=p)return g;if(null!=s&&(e=JSON.parse(v),s=void 0),"object"==typeof e&&null!==e){if(m=o+n,c=[],u=0,Array.isArray(e))for(y="[",l="]",p=e.length;u<p;u++)c.push(t(e[u],m,u===p-1?0:1)||"null");else for(y="{",l="}",p=(f=Object.keys(e)).length;u<p;u++)h=f[u],d=JSON.stringify(h)+": ",void 0!==(b=t(e[h],m,d.length+(u===p-1?0:1)))&&c.push(d+b);if(c.length>0)return[y,n+c.join(",\n"+m),l].join("\n"+o)}return v}(t,"",0)}},a2uh:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(e){s(e)}}function a(t){try{l(r.throw(t))}catch(e){s(e)}}function l(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(o,a)}l((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const i=n("jke5"),s=n("Vinz");e.showPerClassAccuracy=function(t,e,n){return r(this,void 0,void 0,(function*(){const r=i.getDrawArea(t),o=[];for(let t=0;t<e.length;t++){const r=n?n[t]:t.toString(),i=e[t];o.push([r,i.accuracy,i.count])}return s.table(r,{headers:["Class","Accuracy","# Samples"],values:o})}))}},a9XK:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.version="1.4.0"},bniK:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowStart:!0,gridRowEnd:!0,gridColumn:!0,gridColumnStart:!0,gridColumnEnd:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},i=["Webkit","ms","Moz","O"];Object.keys(r).forEach((function(t){i.forEach((function(e){r[function(t,e){return t+e.charAt(0).toUpperCase()+e.substring(1)}(e,t)]=r[t]}))})),e.default={isUnitlessNumber:r,shorthandPropertyExpansions:{background:{backgroundAttachment:!0,backgroundColor:!0,backgroundImage:!0,backgroundPositionX:!0,backgroundPositionY:!0,backgroundRepeat:!0},backgroundPosition:{backgroundPositionX:!0,backgroundPositionY:!0},border:{borderWidth:!0,borderStyle:!0,borderColor:!0},borderBottom:{borderBottomWidth:!0,borderBottomStyle:!0,borderBottomColor:!0},borderLeft:{borderLeftWidth:!0,borderLeftStyle:!0,borderLeftColor:!0},borderRight:{borderRightWidth:!0,borderRightStyle:!0,borderRightColor:!0},borderTop:{borderTopWidth:!0,borderTopStyle:!0,borderTopColor:!0},font:{fontStyle:!0,fontVariant:!0,fontWeight:!0,fontSize:!0,lineHeight:!0,fontFamily:!0},outline:{outlineWidth:!0,outlineStyle:!0,outlineColor:!0}}}},c0yS:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n,o){if("string"==typeof e&&a.hasOwnProperty(t)){var u=function(t,e){if((0,i.default)(t))return t;for(var n=t.split(/,(?![^()]*(?:\([^()]*\))?\))/g),s=0,o=n.length;s<o;++s){var a=n[s],u=[a];for(var c in e){var h=(0,r.default)(c);if(a.indexOf(h)>-1&&"order"!==h)for(var d=e[c],f=0,p=d.length;f<p;++f)u.unshift(a.replace(h,l[d[f]]+h))}n[s]=u.join(",")}return n.join(",")}(e,o),c=u.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter((function(t){return!/-moz-|-ms-/.test(t)})).join(",");if(t.indexOf("Webkit")>-1)return c;var h=u.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter((function(t){return!/-webkit-|-ms-/.test(t)})).join(",");return t.indexOf("Moz")>-1?h:(n["Webkit"+(0,s.default)(t)]=c,n["Moz"+(0,s.default)(t)]=h,u)}};var r=o(n("Rz+p")),i=o(n("sUt/")),s=o(n("SFYy"));function o(t){return t&&t.__esModule?t:{default:t}}var a={transition:!0,transitionProperty:!0,WebkitTransition:!0,WebkitTransitionProperty:!0,MozTransition:!0,MozTransitionProperty:!0},l={Webkit:"-webkit-",Moz:"-moz-",ms:"-ms-"};t.exports=e.default},dfBD:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("tNsn"),i=n("3zff"),s=n("vWdZ"),o=n("h1ZQ"),a=n("zhpP"),l=n("CEZr"),u=n("Vinz"),c=n("4PpC"),h=n("Z6Kp"),d=n("a2uh"),f=n("2tTC"),p=n("QUk2"),m=n("a9XK");e.version_vis=m.version,e.render={barchart:r.barchart,table:u.table,histogram:o.histogram,linechart:a.linechart,scatterplot:l.scatterplot,confusionMatrix:i.confusionMatrix,heatmap:s.heatmap},e.metrics={accuracy:p.accuracy,perClassAccuracy:p.perClassAccuracy,confusionMatrix:p.confusionMatrix},e.show={history:c.history,fitCallbacks:c.fitCallbacks,perClassAccuracy:d.showPerClassAccuracy,valuesDistribution:f.valuesDistribution,layer:h.layer,modelSummary:h.modelSummary};var g=n("LwnN");e.visor=g.visor,function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n("t+T0"))},djh3:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n){if(t.hasOwnProperty(e))for(var r=t[e],s=0,o=r.length;s<o;++s)n[r[s]+(0,i.default)(e)]=n[e]};var r,i=(r=n("SFYy"))&&r.__esModule?r:{default:r};t.exports=e.default},e575:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=["Webkit"],i=["Moz"],s=["ms"],o=["Webkit","Moz"],a=["Webkit","ms"],l=["Webkit","Moz","ms"];e.default={plugins:[],prefixMap:{appearance:o,userSelect:l,textEmphasisPosition:r,textEmphasis:r,textEmphasisStyle:r,textEmphasisColor:r,boxDecorationBreak:r,clipPath:r,maskImage:r,maskMode:r,maskRepeat:r,maskPosition:r,maskClip:r,maskOrigin:r,maskSize:r,maskComposite:r,mask:r,maskBorderSource:r,maskBorderMode:r,maskBorderSlice:r,maskBorderWidth:r,maskBorderOutset:r,maskBorderRepeat:r,maskBorder:r,maskType:r,textDecorationStyle:r,textDecorationSkip:r,textDecorationLine:r,textDecorationColor:r,filter:r,fontFeatureSettings:r,breakAfter:l,breakBefore:l,breakInside:l,columnCount:o,columnFill:o,columnGap:o,columnRule:o,columnRuleColor:o,columnRuleStyle:o,columnRuleWidth:o,columns:o,columnSpan:o,columnWidth:o,writingMode:a,flex:r,flexBasis:r,flexDirection:r,flexGrow:r,flexFlow:r,flexShrink:r,flexWrap:r,alignContent:r,alignItems:r,alignSelf:r,justifyContent:r,order:r,transform:r,transformOrigin:r,transformOriginX:r,transformOriginY:r,backfaceVisibility:r,perspective:r,perspectiveOrigin:r,transformStyle:r,transformOriginZ:r,animation:r,animationDelay:r,animationDirection:r,animationFillMode:r,animationDuration:r,animationIterationCount:r,animationName:r,animationPlayState:r,animationTimingFunction:r,backdropFilter:r,fontKerning:r,scrollSnapType:a,scrollSnapPointsX:a,scrollSnapPointsY:a,scrollSnapDestination:a,scrollSnapCoordinate:a,shapeImageThreshold:r,shapeImageMargin:r,shapeImageOutside:r,hyphens:l,flowInto:a,flowFrom:a,regionFragment:a,textAlignLast:i,tabSize:i,wrapFlow:s,wrapThrough:s,wrapMargin:s,gridTemplateColumns:s,gridTemplateRows:s,gridTemplateAreas:s,gridTemplate:s,gridAutoColumns:s,gridAutoRows:s,gridAutoFlow:s,grid:s,gridRowStart:s,gridColumnStart:s,gridRowEnd:s,gridRow:s,gridColumn:s,gridColumnEnd:s,gridColumnGap:s,gridRowGap:s,gridArea:s,gridGap:s,textSizeAdjust:a,borderImage:r,borderImageOutset:r,borderImageRepeat:r,borderImageSlice:r,borderImageSource:r,borderImageWidth:r,transitionDelay:r,transitionDuration:r,transitionProperty:r,transitionTimingFunction:r}},t.exports=e.default},etOl:function(t,e,n){"use strict";n.r(e);var r={};n.r(r),n.d(r,"aggregate",(function(){return Ll})),n.d(r,"bin",(function(){return jl})),n.d(r,"collect",(function(){return Wl})),n.d(r,"compare",(function(){return ql})),n.d(r,"countpattern",(function(){return Gl})),n.d(r,"cross",(function(){return Kl})),n.d(r,"density",(function(){return Zl})),n.d(r,"dotbin",(function(){return eu})),n.d(r,"expression",(function(){return nu})),n.d(r,"extent",(function(){return iu})),n.d(r,"facet",(function(){return au})),n.d(r,"field",(function(){return uu})),n.d(r,"filter",(function(){return hu})),n.d(r,"flatten",(function(){return du})),n.d(r,"fold",(function(){return fu})),n.d(r,"formula",(function(){return pu})),n.d(r,"generate",(function(){return mu})),n.d(r,"impute",(function(){return vu})),n.d(r,"joinaggregate",(function(){return bu})),n.d(r,"kde",(function(){return _u})),n.d(r,"key",(function(){return wu})),n.d(r,"load",(function(){return Cu})),n.d(r,"lookup",(function(){return ku})),n.d(r,"multiextent",(function(){return Au})),n.d(r,"multivalues",(function(){return Nu})),n.d(r,"params",(function(){return Ou})),n.d(r,"pivot",(function(){return Iu})),n.d(r,"prefacet",(function(){return Fu})),n.d(r,"project",(function(){return Mu})),n.d(r,"proxy",(function(){return $u})),n.d(r,"quantile",(function(){return zu})),n.d(r,"relay",(function(){return Lu})),n.d(r,"sample",(function(){return Bu})),n.d(r,"sequence",(function(){return ju})),n.d(r,"sieve",(function(){return Uu})),n.d(r,"subflow",(function(){return su})),n.d(r,"timeunit",(function(){return Vu})),n.d(r,"tupleindex",(function(){return Hu})),n.d(r,"values",(function(){return Gu})),n.d(r,"window",(function(){return Qu}));var i={};n.r(i),n.d(i,"interpolate",(function(){return cg})),n.d(i,"interpolateArray",(function(){return ng})),n.d(i,"interpolateBasis",(function(){return Wm})),n.d(i,"interpolateBasisClosed",(function(){return qm})),n.d(i,"interpolateDate",(function(){return ig})),n.d(i,"interpolateDiscrete",(function(){return uy})),n.d(i,"interpolateHue",(function(){return cy})),n.d(i,"interpolateNumber",(function(){return sg})),n.d(i,"interpolateNumberArray",(function(){return tg})),n.d(i,"interpolateObject",(function(){return og})),n.d(i,"interpolateRound",(function(){return hg})),n.d(i,"interpolateString",(function(){return ug})),n.d(i,"interpolateTransformCss",(function(){return my})),n.d(i,"interpolateTransformSvg",(function(){return gy})),n.d(i,"interpolateZoom",(function(){return by})),n.d(i,"interpolateRgb",(function(){return Xm})),n.d(i,"interpolateRgbBasis",(function(){return Qm})),n.d(i,"interpolateRgbBasisClosed",(function(){return Jm})),n.d(i,"interpolateHsl",(function(){return _y})),n.d(i,"interpolateHslLong",(function(){return wy})),n.d(i,"interpolateLab",(function(){return $y})),n.d(i,"interpolateHcl",(function(){return zy})),n.d(i,"interpolateHclLong",(function(){return Ly})),n.d(i,"interpolateCubehelix",(function(){return Yy})),n.d(i,"interpolateCubehelixLong",(function(){return Ky})),n.d(i,"piecewise",(function(){return qg})),n.d(i,"quantize",(function(){return Xy}));var s={};n.r(s),n.d(s,"bound",(function(){return db})),n.d(s,"identifier",(function(){return pb})),n.d(s,"mark",(function(){return mb})),n.d(s,"overlap",(function(){return gb})),n.d(s,"render",(function(){return Cb})),n.d(s,"viewlayout",(function(){return qb}));var o={};n.r(o),n.d(o,"axisticks",(function(){return Hb})),n.d(o,"datajoin",(function(){return Gb})),n.d(o,"encode",(function(){return Kb})),n.d(o,"legendentries",(function(){return Xb})),n.d(o,"linkpath",(function(){return nx})),n.d(o,"pie",(function(){return ax})),n.d(o,"scale",(function(){return cx})),n.d(o,"sortitems",(function(){return px})),n.d(o,"stack",(function(){return gx}));var a={};n.r(a),n.d(a,"contour",(function(){return zx})),n.d(a,"geojson",(function(){return Lx})),n.d(a,"geopath",(function(){return JS})),n.d(a,"geopoint",(function(){return tC})),n.d(a,"geoshape",(function(){return eC})),n.d(a,"graticule",(function(){return iC})),n.d(a,"heatmap",(function(){return sC})),n.d(a,"isocontour",(function(){return Ax})),n.d(a,"kde2d",(function(){return Fx})),n.d(a,"projection",(function(){return aC}));var l={};n.r(l),n.d(l,"force",(function(){return tE}));var u={};n.r(u),n.d(u,"nest",(function(){return fE})),n.d(u,"pack",(function(){return LE})),n.d(u,"partition",(function(){return WE})),n.d(u,"stratify",(function(){return ZE})),n.d(u,"tree",(function(){return uk})),n.d(u,"treelinks",(function(){return hk})),n.d(u,"treemap",(function(){return bk}));var c={};n.r(c),n.d(c,"loess",(function(){return wk})),n.d(c,"regression",(function(){return Ck}));var h={};n.r(h),n.d(h,"voronoi",(function(){return Hk}));var d={};n.r(d),n.d(d,"wordcloud",(function(){return sA}));var f={};n.r(f),n.d(f,"crossfilter",(function(){return dA})),n.d(f,"resolvefilter",(function(){return pA}));var p={};n.r(p),n.d(p,"version",(function(){return mA.a})),n.d(p,"accessor",(function(){return Tt})),n.d(p,"accessorName",(function(){return Ot})),n.d(p,"accessorFields",(function(){return It})),n.d(p,"id",(function(){return Bt})),n.d(p,"identity",(function(){return jt})),n.d(p,"zero",(function(){return Ut})),n.d(p,"one",(function(){return Vt})),n.d(p,"truthy",(function(){return Wt})),n.d(p,"falsy",(function(){return qt})),n.d(p,"logger",(function(){return Qt})),n.d(p,"None",(function(){return Gt})),n.d(p,"Error",(function(){return Yt})),n.d(p,"Warn",(function(){return Kt})),n.d(p,"Info",(function(){return Xt})),n.d(p,"Debug",(function(){return Zt})),n.d(p,"mergeConfig",(function(){return ne})),n.d(p,"writeConfig",(function(){return re})),n.d(p,"panLinear",(function(){return fe})),n.d(p,"panLog",(function(){return pe})),n.d(p,"panPow",(function(){return me})),n.d(p,"panSymlog",(function(){return ge})),n.d(p,"zoomLinear",(function(){return ve})),n.d(p,"zoomLog",(function(){return be})),n.d(p,"zoomPow",(function(){return xe})),n.d(p,"zoomSymlog",(function(){return _e})),n.d(p,"quarter",(function(){return we})),n.d(p,"utcquarter",(function(){return Se})),n.d(p,"array",(function(){return Ce})),n.d(p,"clampRange",(function(){return Ee})),n.d(p,"compare",(function(){return Ae})),n.d(p,"constant",(function(){return Ie})),n.d(p,"debounce",(function(){return Re})),n.d(p,"error",(function(){return $t})),n.d(p,"extend",(function(){return Fe})),n.d(p,"extent",(function(){return Me})),n.d(p,"extentIndex",(function(){return $e})),n.d(p,"fastmap",(function(){return Be})),n.d(p,"field",(function(){return zt})),n.d(p,"flush",(function(){return je})),n.d(p,"hasOwnProperty",(function(){return ze})),n.d(p,"inherits",(function(){return Ue})),n.d(p,"inrange",(function(){return Ve})),n.d(p,"isArray",(function(){return Jt})),n.d(p,"isBoolean",(function(){return We})),n.d(p,"isDate",(function(){return qe})),n.d(p,"isFunction",(function(){return ke})),n.d(p,"isNumber",(function(){return He})),n.d(p,"isObject",(function(){return te})),n.d(p,"isRegExp",(function(){return Ge})),n.d(p,"isString",(function(){return Ye})),n.d(p,"key",(function(){return Ke})),n.d(p,"lerp",(function(){return Xe})),n.d(p,"lruCache",(function(){return Ze})),n.d(p,"merge",(function(){return Qe})),n.d(p,"pad",(function(){return tn})),n.d(p,"peek",(function(){return se})),n.d(p,"repeat",(function(){return Je})),n.d(p,"span",(function(){return en})),n.d(p,"splitAccessPath",(function(){return Pt})),n.d(p,"stringValue",(function(){return nn})),n.d(p,"toBoolean",(function(){return rn})),n.d(p,"toDate",(function(){return on})),n.d(p,"toNumber",(function(){return oe})),n.d(p,"toString",(function(){return an})),n.d(p,"toSet",(function(){return ln})),n.d(p,"truncate",(function(){return un})),n.d(p,"visitArray",(function(){return cn})),n.d(p,"Dataflow",(function(){return ga})),n.d(p,"EventStream",(function(){return Fn})),n.d(p,"Parameters",(function(){return kn})),n.d(p,"Pulse",(function(){return oa})),n.d(p,"MultiPulse",(function(){return ha})),n.d(p,"Operator",(function(){return Tn})),n.d(p,"Transform",(function(){return ba})),n.d(p,"changeset",(function(){return Cn})),n.d(p,"ingest",(function(){return vn})),n.d(p,"isTuple",(function(){return mn})),n.d(p,"definition",(function(){return wa})),n.d(p,"transform",(function(){return Sa})),n.d(p,"transforms",(function(){return _a})),n.d(p,"tupleid",(function(){return gn})),n.d(p,"scale",(function(){return Xg})),n.d(p,"scheme",(function(){return ov})),n.d(p,"interpolate",(function(){return nv})),n.d(p,"interpolateColors",(function(){return Jy})),n.d(p,"interpolateRange",(function(){return Qy})),n.d(p,"quantizeInterpolator",(function(){return tv})),n.d(p,"projection",(function(){return KS})),n.d(p,"View",(function(){return qT})),n.d(p,"formatLocale",(function(){return qr})),n.d(p,"timeFormatLocale",(function(){return Ko})),n.d(p,"locale",(function(){return Zo})),n.d(p,"defaultLocale",(function(){return Qo})),n.d(p,"resetDefaultLocale",(function(){return Jo})),n.d(p,"expressionFunction",(function(){return wT})),n.d(p,"parse",(function(){return rF})),n.d(p,"runtimeContext",(function(){return FT})),n.d(p,"bandwidthNRD",(function(){return qa})),n.d(p,"bin",(function(){return Ha})),n.d(p,"bootstrapCI",(function(){return Ka})),n.d(p,"dotbin",(function(){return Xa})),n.d(p,"quantiles",(function(){return Va})),n.d(p,"quartiles",(function(){return Wa})),n.d(p,"random",(function(){return Ga})),n.d(p,"setRandom",(function(){return Ya})),n.d(p,"randomLCG",(function(){return Za})),n.d(p,"randomInteger",(function(){return Qa})),n.d(p,"randomKDE",(function(){return al})),n.d(p,"randomLogNormal",(function(){return dl})),n.d(p,"sampleLogNormal",(function(){return ll})),n.d(p,"densityLogNormal",(function(){return ul})),n.d(p,"cumulativeLogNormal",(function(){return cl})),n.d(p,"quantileLogNormal",(function(){return hl})),n.d(p,"randomMixture",(function(){return fl})),n.d(p,"randomNormal",(function(){return ol})),n.d(p,"sampleNormal",(function(){return nl})),n.d(p,"densityNormal",(function(){return rl})),n.d(p,"cumulativeNormal",(function(){return il})),n.d(p,"quantileNormal",(function(){return sl})),n.d(p,"randomUniform",(function(){return vl})),n.d(p,"sampleUniform",(function(){return pl})),n.d(p,"densityUniform",(function(){return ml})),n.d(p,"cumulativeUniform",(function(){return gl})),n.d(p,"quantileUniform",(function(){return yl})),n.d(p,"regressionLinear",(function(){return Sl})),n.d(p,"regressionLog",(function(){return Cl})),n.d(p,"regressionExp",(function(){return El})),n.d(p,"regressionPow",(function(){return kl})),n.d(p,"regressionQuad",(function(){return Al})),n.d(p,"regressionPoly",(function(){return Dl})),n.d(p,"regressionLoess",(function(){return Ol})),n.d(p,"sampleCurve",(function(){return Ml})),n.d(p,"TIME_UNITS",(function(){return ri})),n.d(p,"YEAR",(function(){return Hr})),n.d(p,"QUARTER",(function(){return Gr})),n.d(p,"MONTH",(function(){return Yr})),n.d(p,"WEEK",(function(){return Kr})),n.d(p,"DATE",(function(){return Xr})),n.d(p,"DAY",(function(){return Zr})),n.d(p,"DAYOFYEAR",(function(){return Qr})),n.d(p,"HOURS",(function(){return Jr})),n.d(p,"MINUTES",(function(){return ti})),n.d(p,"SECONDS",(function(){return ei})),n.d(p,"MILLISECONDS",(function(){return ni})),n.d(p,"timeUnitSpecifier",(function(){return ai})),n.d(p,"timeUnits",(function(){return si})),n.d(p,"dayofyear",(function(){return Si})),n.d(p,"week",(function(){return Ci})),n.d(p,"utcdayofyear",(function(){return Ni})),n.d(p,"utcweek",(function(){return Ti})),n.d(p,"timeFloor",(function(){return Li})),n.d(p,"utcFloor",(function(){return Ui})),n.d(p,"timeInterval",(function(){return is})),n.d(p,"timeOffset",(function(){return as})),n.d(p,"timeSequence",(function(){return cs})),n.d(p,"utcInterval",(function(){return ss})),n.d(p,"utcOffset",(function(){return ls})),n.d(p,"utcSequence",(function(){return hs})),n.d(p,"timeBin",(function(){return ws})),n.d(p,"loader",(function(){return ea})),n.d(p,"read",(function(){return ta})),n.d(p,"inferType",(function(){return Kn})),n.d(p,"inferTypes",(function(){return Xn})),n.d(p,"typeParsers",(function(){return Hn})),n.d(p,"format",(function(){return gr})),n.d(p,"formats",(function(){return yr})),n.d(p,"responseType",(function(){return vr})),n.d(p,"Bounds",(function(){return gd})),n.d(p,"Gradient",(function(){return dc})),n.d(p,"GroupItem",(function(){return bd})),n.d(p,"ResourceLoader",(function(){return wd})),n.d(p,"Item",(function(){return vd})),n.d(p,"Scenegraph",(function(){return fp})),n.d(p,"Handler",(function(){return wp})),n.d(p,"Renderer",(function(){return Ep})),n.d(p,"CanvasHandler",(function(){return $p})),n.d(p,"CanvasRenderer",(function(){return Up})),n.d(p,"SVGHandler",(function(){return qp})),n.d(p,"SVGRenderer",(function(){return $v})),n.d(p,"SVGStringRenderer",(function(){return Xv})),n.d(p,"RenderType",(function(){return tb})),n.d(p,"renderModule",(function(){return nb})),n.d(p,"intersect",(function(){return rb})),n.d(p,"Marks",(function(){return op})),n.d(p,"boundClip",(function(){return lb})),n.d(p,"boundContext",(function(){return Od})),n.d(p,"boundStroke",(function(){return Nd})),n.d(p,"boundItem",(function(){return ap})),n.d(p,"boundMark",(function(){return up})),n.d(p,"pathCurves",(function(){return oh})),n.d(p,"pathSymbols",(function(){return Ch})),n.d(p,"pathRectangle",(function(){return Lh})),n.d(p,"pathTrail",(function(){return Bh})),n.d(p,"pathParse",(function(){return uh})),n.d(p,"pathRender",(function(){return xh})),n.d(p,"point",(function(){return _p})),n.d(p,"domCreate",(function(){return gp})),n.d(p,"domFind",(function(){return yp})),n.d(p,"domChild",(function(){return vp})),n.d(p,"domClear",(function(){return bp})),n.d(p,"openTag",(function(){return Ov})),n.d(p,"closeTag",(function(){return Iv})),n.d(p,"font",(function(){return tp})),n.d(p,"fontFamily",(function(){return Jf})),n.d(p,"fontSize",(function(){return Yf})),n.d(p,"lineHeight",(function(){return Kf})),n.d(p,"multiLineOffset",(function(){return Zf})),n.d(p,"textMetrics",(function(){return Uf})),n.d(p,"sceneEqual",(function(){return ub})),n.d(p,"pathEqual",(function(){return cb})),n.d(p,"sceneToJSON",(function(){return hp})),n.d(p,"sceneFromJSON",(function(){return dp})),n.d(p,"intersectPath",(function(){return Ud})),n.d(p,"intersectPoint",(function(){return Vd})),n.d(p,"intersectRule",(function(){return qd})),n.d(p,"intersectBoxLine",(function(){return Hd})),n.d(p,"sceneZOrder",(function(){return ef})),n.d(p,"sceneVisit",(function(){return nf})),n.d(p,"scenePickVisit",(function(){return rf})),n.d(p,"resetSVGClipId",(function(){return pd})),n.d(p,"resetSVGDefIds",(function(){return hb}));var m={};n.r(m),n.d(m,"invalidSpec",(function(){return R$})),n.d(m,"FIT_NON_SINGLE",(function(){return F$})),n.d(m,"containerSizeNonSingle",(function(){return M$})),n.d(m,"containerSizeNotCompatibleWithAutosize",(function(){return $$})),n.d(m,"droppingFit",(function(){return P$})),n.d(m,"unknownField",(function(){return z$})),n.d(m,"cannotProjectOnChannelWithoutField",(function(){return L$})),n.d(m,"cannotProjectAggregate",(function(){return B$})),n.d(m,"nearestNotSupportForContinuous",(function(){return j$})),n.d(m,"selectionNotSupported",(function(){return U$})),n.d(m,"selectionNotFound",(function(){return V$})),n.d(m,"SCALE_BINDINGS_CONTINUOUS",(function(){return W$})),n.d(m,"LEGEND_BINDINGS_MUST_HAVE_PROJECTION",(function(){return q$})),n.d(m,"noSameUnitLookup",(function(){return H$})),n.d(m,"NEEDS_SAME_SELECTION",(function(){return G$})),n.d(m,"INTERVAL_INITIALIZED_WITH_X_Y",(function(){return Y$})),n.d(m,"noSuchRepeatedValue",(function(){return K$})),n.d(m,"columnsNotSupportByRowCol",(function(){return X$})),n.d(m,"CONCAT_CANNOT_SHARE_AXIS",(function(){return Z$})),n.d(m,"unrecognizedParse",(function(){return Q$})),n.d(m,"differentParse",(function(){return J$})),n.d(m,"ADD_SAME_CHILD_TWICE",(function(){return tP})),n.d(m,"invalidTransformIgnored",(function(){return eP})),n.d(m,"NO_FIELDS_NEEDS_AS",(function(){return nP})),n.d(m,"customFormatTypeNotAllowed",(function(){return rP})),n.d(m,"projectionOverridden",(function(){return iP})),n.d(m,"REPLACE_ANGLE_WITH_THETA",(function(){return sP})),n.d(m,"primitiveChannelDef",(function(){return oP})),n.d(m,"invalidFieldType",(function(){return aP})),n.d(m,"invalidFieldTypeForCountAggregate",(function(){return lP})),n.d(m,"invalidAggregate",(function(){return uP})),n.d(m,"missingFieldType",(function(){return cP})),n.d(m,"droppingColor",(function(){return hP})),n.d(m,"emptyFieldDef",(function(){return dP})),n.d(m,"latLongDeprecated",(function(){return fP})),n.d(m,"LINE_WITH_VARYING_SIZE",(function(){return pP})),n.d(m,"incompatibleChannel",(function(){return mP})),n.d(m,"invalidEncodingChannel",(function(){return gP})),n.d(m,"facetChannelShouldBeDiscrete",(function(){return yP})),n.d(m,"facetChannelDropped",(function(){return vP})),n.d(m,"discreteChannelCannotEncode",(function(){return bP})),n.d(m,"lineWithRange",(function(){return xP})),n.d(m,"orientOverridden",(function(){return _P})),n.d(m,"CANNOT_UNION_CUSTOM_DOMAIN_WITH_FIELD_DOMAIN",(function(){return wP})),n.d(m,"RANGE_STEP_DEPRECATED",(function(){return SP})),n.d(m,"cannotUseScalePropertyWithNonColor",(function(){return CP})),n.d(m,"unaggregateDomainHasNoEffectForRawField",(function(){return EP})),n.d(m,"unaggregateDomainWithNonSharedDomainOp",(function(){return kP})),n.d(m,"unaggregatedDomainWithLogScale",(function(){return AP})),n.d(m,"cannotApplySizeToNonOrientedMark",(function(){return DP})),n.d(m,"scaleTypeNotWorkWithChannel",(function(){return NP})),n.d(m,"scaleTypeNotWorkWithFieldDef",(function(){return TP})),n.d(m,"scalePropertyNotWorkWithScaleType",(function(){return OP})),n.d(m,"scaleTypeNotWorkWithMark",(function(){return IP})),n.d(m,"stepDropped",(function(){return RP})),n.d(m,"mergeConflictingProperty",(function(){return FP})),n.d(m,"mergeConflictingDomainProperty",(function(){return MP})),n.d(m,"independentScaleMeansIndependentGuide",(function(){return $P})),n.d(m,"domainSortDropped",(function(){return PP})),n.d(m,"MORE_THAN_ONE_SORT",(function(){return zP})),n.d(m,"FACETED_INDEPENDENT_DIFFERENT_SOURCES",(function(){return LP})),n.d(m,"FACETED_INDEPENDENT_SAME_FIELDS_DIFFERENT_SOURCES",(function(){return BP})),n.d(m,"FACETED_INDEPENDENT_SAME_SOURCE",(function(){return jP})),n.d(m,"INVALID_CHANNEL_FOR_AXIS",(function(){return UP})),n.d(m,"cannotStackRangedMark",(function(){return VP})),n.d(m,"cannotStackNonLinearScale",(function(){return WP})),n.d(m,"stackNonSummativeAggregate",(function(){return qP})),n.d(m,"invalidTimeUnit",(function(){return HP})),n.d(m,"droppedDay",(function(){return GP})),n.d(m,"errorBarCenterAndExtentAreNotNeeded",(function(){return YP})),n.d(m,"errorBarCenterIsUsedWithWrongExtent",(function(){return KP})),n.d(m,"errorBarContinuousAxisHasCustomizedAggregate",(function(){return XP})),n.d(m,"errorBand1DNotSupport",(function(){return ZP})),n.d(m,"channelRequiredForBinned",(function(){return QP})),n.d(m,"channelShouldNotBeUsedForBinned",(function(){return JP})),n.d(m,"domainRequiredForThresholdScale",(function(){return tz}));var g={};n.r(g),n.d(g,"compile",(function(){return oG})),n.d(g,"normalize",(function(){return sU})),n.d(g,"version",(function(){return iF.a}));var y={};n.r(y),n.d(y,"dark",(function(){return cG})),n.d(y,"excel",(function(){return hG})),n.d(y,"fivethirtyeight",(function(){return dG})),n.d(y,"ggplot2",(function(){return fG})),n.d(y,"latimes",(function(){return gG})),n.d(y,"quartz",(function(){return yG})),n.d(y,"vox",(function(){return vG})),n.d(y,"urbaninstitute",(function(){return xG})),n.d(y,"googlecharts",(function(){return _G})),n.d(y,"version",(function(){return wG}));var v=n("mrSG");function b(){}var x=function(t){return null==t?b:function(){return this.querySelector(t)}};function _(){return[]}var w=function(t){return new Array(t.length)};function S(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function C(t,e,n,r,i,s){for(var o,a=0,l=e.length,u=s.length;a<u;++a)(o=e[a])?(o.__data__=s[a],r[a]=o):n[a]=new S(t,s[a]);for(;a<l;++a)(o=e[a])&&(i[a]=o)}function E(t,e,n,r,i,s,o){var a,l,u,c={},h=e.length,d=s.length,f=new Array(h);for(a=0;a<h;++a)(l=e[a])&&(f[a]=u="$"+o.call(l,l.__data__,a,e),u in c?i[a]=l:c[u]=l);for(a=0;a<d;++a)(l=c[u="$"+o.call(t,s[a],a,s)])?(r[a]=l,l.__data__=s[a],c[u]=null):n[a]=new S(t,s[a]);for(a=0;a<h;++a)(l=e[a])&&c[f[a]]===l&&(i[a]=l)}function k(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}S.prototype={constructor:S,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var A="http://www.w3.org/1999/xhtml",D={svg:"http://www.w3.org/2000/svg",xhtml:A,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},N=function(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),D.hasOwnProperty(e)?{space:D[e],local:t}:t};function T(t){return function(){this.removeAttribute(t)}}function O(t){return function(){this.removeAttributeNS(t.space,t.local)}}function I(t,e){return function(){this.setAttribute(t,e)}}function R(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function F(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function M(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}var $=function(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView};function P(t){return function(){this.style.removeProperty(t)}}function z(t,e,n){return function(){this.style.setProperty(t,e,n)}}function L(t,e,n){return function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function B(t,e){return t.style.getPropertyValue(e)||$(t).getComputedStyle(t,null).getPropertyValue(e)}function j(t){return function(){delete this[t]}}function U(t,e){return function(){this[t]=e}}function V(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function W(t){return t.trim().split(/^|\s+/)}function q(t){return t.classList||new H(t)}function H(t){this._node=t,this._names=W(t.getAttribute("class")||"")}function G(t,e){for(var n=q(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function Y(t,e){for(var n=q(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function K(t){return function(){G(this,t)}}function X(t){return function(){Y(this,t)}}function Z(t,e){return function(){(e.apply(this,arguments)?G:Y)(this,t)}}function Q(){this.textContent=""}function J(t){return function(){this.textContent=t}}function tt(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function et(){this.innerHTML=""}function nt(t){return function(){this.innerHTML=t}}function rt(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function it(){this.nextSibling&&this.parentNode.appendChild(this)}function st(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function ot(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===A&&e.documentElement.namespaceURI===A?e.createElement(t):e.createElementNS(n,t)}}function at(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}H.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var lt=function(t){var e=N(t);return(e.local?at:ot)(e)};function ut(){return null}function ct(){var t=this.parentNode;t&&t.removeChild(this)}function ht(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function dt(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}var ft={},pt=null;function mt(t,e,n){return t=gt(t,e,n),function(e){var n=e.relatedTarget;n&&(n===this||8&n.compareDocumentPosition(this))||t.call(this,e)}}function gt(t,e,n){return function(r){var i=pt;pt=r;try{t.call(this,this.__data__,e,n)}finally{pt=i}}}function yt(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}function vt(t){return function(){var e=this.__on;if(e){for(var n,r=0,i=-1,s=e.length;r<s;++r)n=e[r],t.type&&n.type!==t.type||n.name!==t.name?e[++i]=n:this.removeEventListener(n.type,n.listener,n.capture);++i?e.length=i:delete this.__on}}}function bt(t,e,n){var r=ft.hasOwnProperty(t.type)?mt:gt;return function(i,s,o){var a,l=this.__on,u=r(e,s,o);if(l)for(var c=0,h=l.length;c<h;++c)if((a=l[c]).type===t.type&&a.name===t.name)return this.removeEventListener(a.type,a.listener,a.capture),this.addEventListener(a.type,a.listener=u,a.capture=n),void(a.value=e);this.addEventListener(t.type,u,n),a={type:t.type,name:t.name,value:e,listener:u,capture:n},l?l.push(a):this.__on=[a]}}function xt(t,e,n){var r=$(t),i=r.CustomEvent;"function"==typeof i?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function _t(t,e){return function(){return xt(this,t,e)}}function wt(t,e){return function(){return xt(this,t,e.apply(this,arguments))}}"undefined"!=typeof document&&("onmouseenter"in document.documentElement||(ft={mouseenter:"mouseover",mouseleave:"mouseout"}));var St=[null];function Ct(t,e){this._groups=t,this._parents=e}Ct.prototype=(function(){return new Ct([[document.documentElement]],St)}).prototype={constructor:Ct,select:function(t){"function"!=typeof t&&(t=x(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s,o,a=e[i],l=a.length,u=r[i]=new Array(l),c=0;c<l;++c)(s=a[c])&&(o=t.call(s,s.__data__,c,a))&&("__data__"in s&&(o.__data__=s.__data__),u[c]=o);return new Ct(r,this._parents)},selectAll:function(t){var e;"function"!=typeof t&&(t=null==(e=t)?_:function(){return this.querySelectorAll(e)});for(var n=this._groups,r=n.length,i=[],s=[],o=0;o<r;++o)for(var a,l=n[o],u=l.length,c=0;c<u;++c)(a=l[c])&&(i.push(t.call(a,a.__data__,c,l)),s.push(a));return new Ct(i,s)},filter:function(t){var e;"function"!=typeof t&&(e=t,t=function(){return this.matches(e)});for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s)for(var o,a=n[s],l=a.length,u=i[s]=[],c=0;c<l;++c)(o=a[c])&&t.call(o,o.__data__,c,a)&&u.push(o);return new Ct(i,this._parents)},data:function(t,e){if(!t)return p=new Array(this.size()),c=-1,this.each((function(t){p[++c]=t})),p;var n,r=e?E:C,i=this._parents,s=this._groups;"function"!=typeof t&&(n=t,t=function(){return n});for(var o=s.length,a=new Array(o),l=new Array(o),u=new Array(o),c=0;c<o;++c){var h=i[c],d=s[c],f=d.length,p=t.call(h,h&&h.__data__,c,i),m=p.length,g=l[c]=new Array(m),y=a[c]=new Array(m);r(h,d,g,y,u[c]=new Array(f),p,e);for(var v,b,x=0,_=0;x<m;++x)if(v=g[x]){for(x>=_&&(_=x+1);!(b=y[_])&&++_<m;);v._next=b||null}}return(a=new Ct(a,i))._enter=l,a._exit=u,a},enter:function(){return new Ct(this._enter||this._groups.map(w),this._parents)},exit:function(){return new Ct(this._exit||this._groups.map(w),this._parents)},join:function(t,e,n){var r=this.enter(),i=this,s=this.exit();return r="function"==typeof t?t(r):r.append(t+""),null!=e&&(i=e(i)),null==n?s.remove():n(s),r&&i?r.merge(i).order():i},merge:function(t){for(var e=this._groups,n=t._groups,r=e.length,i=Math.min(r,n.length),s=new Array(r),o=0;o<i;++o)for(var a,l=e[o],u=n[o],c=l.length,h=s[o]=new Array(c),d=0;d<c;++d)(a=l[d]||u[d])&&(h[d]=a);for(;o<r;++o)s[o]=e[o];return new Ct(s,this._parents)},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r,i=t[e],s=i.length-1,o=i[s];--s>=0;)(r=i[s])&&(o&&4^r.compareDocumentPosition(o)&&o.parentNode.insertBefore(r,o),o=r);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=k);for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s){for(var o,a=n[s],l=a.length,u=i[s]=new Array(l),c=0;c<l;++c)(o=a[c])&&(u[c]=o);u.sort(e)}return new Ct(i,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){var t=new Array(this.size()),e=-1;return this.each((function(){t[++e]=this})),t},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null},size:function(){var t=0;return this.each((function(){++t})),t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i,s=e[n],o=0,a=s.length;o<a;++o)(i=s[o])&&t.call(i,i.__data__,o,s);return this},attr:function(t,e){var n=N(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==e?n.local?O:T:"function"==typeof e?n.local?M:F:n.local?R:I)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?P:"function"==typeof e?L:z)(t,e,null==n?"":n)):B(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?j:"function"==typeof e?V:U)(t,e)):this.node()[t]},classed:function(t,e){var n=W(t+"");if(arguments.length<2){for(var r=q(this.node()),i=-1,s=n.length;++i<s;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof e?Z:e?K:X)(n,e))},text:function(t){return arguments.length?this.each(null==t?Q:("function"==typeof t?tt:J)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?et:("function"==typeof t?rt:nt)(t)):this.node().innerHTML},raise:function(){return this.each(it)},lower:function(){return this.each(st)},append:function(t){var e="function"==typeof t?t:lt(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:lt(t),r=null==e?ut:"function"==typeof e?e:x(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:function(){return this.each(ct)},clone:function(t){return this.select(t?dt:ht)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var r,i,s=yt(t+""),o=s.length;if(!(arguments.length<2)){for(a=e?bt:vt,null==n&&(n=!1),r=0;r<o;++r)this.each(a(s[r],e,n));return this}var a=this.node().__on;if(a)for(var l,u=0,c=a.length;u<c;++u)for(r=0,l=a[u];r<o;++r)if((i=s[r]).type===l.type&&i.name===l.name)return l.value},dispatch:function(t,e){return this.each(("function"==typeof e?wt:_t)(t,e))}};var Et=n("PE4B"),kt=n.n(Et),At=n("ZYJ9"),Dt=n.n(At),Nt=n("DVXx"),Tt=function(t,e,n){return t.fields=e||[],t.fname=n,t};function Ot(t){return null==t?null:t.fname}function It(t){return null==t?null:t.fields}var Rt=function(t){return 1===t.length?Ft(t[0]):Mt(t)};const Ft=t=>function(e){return e[t]},Mt=t=>{const e=t.length;return function(n){for(let r=0;r<e;++r)n=n[t[r]];return n}};var $t=function(t){throw Error(t)},Pt=function(t){var e,n,r,i=[],s=null,o=0,a=t.length,l="";function u(){i.push(l+t.substring(e,n)),l="",e=n+1}for(t+="",e=n=0;n<a;++n)if("\\"===(r=t[n]))l+=t.substring(e,n),l+=t.substring(++n,++n),e=n;else if(r===s)u(),s=null,o=-1;else{if(s)continue;e===o&&'"'===r||e===o&&"'"===r?(e=n+1,s=r):"."!==r||o?"["===r?(n>e&&u(),o=e=n+1):"]"===r&&(o||$t("Access path missing open bracket: "+t),o>0&&u(),o=0,e=n+1):n>e?u():e=n+1}return o&&$t("Access path missing closing bracket: "+t),s&&$t("Access path missing closing quote: "+t),n>e&&(n++,u()),i},zt=function(t,e,n){const r=Pt(t);return t=1===r.length?r[0]:t,Tt((n&&n.get||Rt)(r),[t],e||t)},Lt=[],Bt=zt("id"),jt=Tt((function(t){return t}),Lt,"identity"),Ut=Tt((function(){return 0}),Lt,"zero"),Vt=Tt((function(){return 1}),Lt,"one"),Wt=Tt((function(){return!0}),Lt,"true"),qt=Tt((function(){return!1}),Lt,"false");function Ht(t,e,n){var r=[e].concat([].slice.call(n));console[t].apply(console,r)}var Gt=0,Yt=1,Kt=2,Xt=3,Zt=4,Qt=function(t,e){var n=t||Gt;return{level:function(t){return arguments.length?(n=+t,this):n},error:function(){return n>=Yt&&Ht(e||"error","ERROR",arguments),this},warn:function(){return n>=Kt&&Ht(e||"warn","WARN",arguments),this},info:function(){return n>=Xt&&Ht(e||"log","INFO",arguments),this},debug:function(){return n>=Zt&&Ht(e||"log","DEBUG",arguments),this}}},Jt=Array.isArray,te=function(t){return t===Object(t)};const ee=t=>"__proto__"!==t;function ne(...t){return t.reduce((t,e)=>{for(var n in e)"signals"===n?t.signals=ie(t.signals,e.signals):re(t,n,e[n],"legend"===n?{layout:1}:"style"===n||null);return t},{})}function re(t,e,n,r){var i,s;if(ee(e))if(te(n)&&!Jt(n))for(i in s=te(t[e])?t[e]:t[e]={},n)r&&(!0===r||r[i])?re(s,i,n[i]):ee(i)&&(s[i]=n[i]);else t[e]=n}function ie(t,e){if(null==t)return e;const n={},r=[];function i(t){n[t.name]||(n[t.name]=1,r.push(t))}return e.forEach(i),t.forEach(i),r}var se=function(t){return t[t.length-1]},oe=function(t){return null==t||""===t?null:+t};function ae(t){return function(e){return t*Math.exp(e)}}function le(t){return function(e){return Math.log(t*e)}}function ue(t){return function(e){return Math.sign(e)*Math.log1p(Math.abs(e/t))}}function ce(t){return function(e){return Math.sign(e)*Math.expm1(Math.abs(e))*t}}function he(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function de(t,e,n,r){var i=n(t[0]),s=n(se(t)),o=(s-i)*e;return[r(i-o),r(s-o)]}function fe(t,e){return de(t,e,oe,jt)}function pe(t,e){var n=Math.sign(t[0]);return de(t,e,le(n),ae(n))}function me(t,e,n){return de(t,e,he(n),he(1/n))}function ge(t,e,n){return de(t,e,ue(n),ce(n))}function ye(t,e,n,r,i){var s=r(t[0]),o=r(se(t)),a=null!=e?r(e):(s+o)/2;return[i(a+(s-a)*n),i(a+(o-a)*n)]}function ve(t,e,n){return ye(t,e,n,oe,jt)}function be(t,e,n){var r=Math.sign(t[0]);return ye(t,e,n,le(r),ae(r))}function xe(t,e,n,r){return ye(t,e,n,he(r),he(1/r))}function _e(t,e,n,r){return ye(t,e,n,ue(r),ce(r))}function we(t){return 1+~~(new Date(t).getMonth()/3)}function Se(t){return 1+~~(new Date(t).getUTCMonth()/3)}var Ce=function(t){return null!=t?Jt(t)?t:[t]:[]},Ee=function(t,e,n){var r,i=t[0],s=t[1];return s<i&&(r=s,s=i,i=r),(r=s-i)>=n-e?[e,n]:[i=Math.min(Math.max(i,e),n-r),i+r]},ke=function(t){return"function"==typeof t},Ae=function(t,e,n){n=n||{},e=Ce(e)||[];const r=[],i=[],s={},o=n.comparator||Ne;return Ce(t).forEach((t,o)=>{null!=t&&(r.push("descending"===e[o]?-1:1),i.push(t=ke(t)?t:zt(t,null,n)),(It(t)||[]).forEach(t=>s[t]=1))}),0===i.length?null:Tt(o(i,r),Object.keys(s))};const De=(t,e)=>(t<e||null==t)&&null!=e?-1:(t>e||null==e)&&null!=t?1:(e=e instanceof Date?+e:e,(t=t instanceof Date?+t:t)!==t&&e==e?-1:e!=e&&t==t?1:0),Ne=(t,e)=>1===t.length?Te(t[0],e[0]):Oe(t,e,t.length),Te=(t,e)=>function(n,r){return De(t(n),t(r))*e},Oe=(t,e,n)=>(e.push(0),function(r,i){let s,o=0,a=-1;for(;0===o&&++a<n;)s=t[a],o=De(s(r),s(i));return o*e[a]});var Ie=function(t){return ke(t)?t:function(){return t}},Re=function(t,e){var n,r;function i(){e(r),n=r=null}return function(e){r=e,n&&clearTimeout(n),n=setTimeout(i,t)}},Fe=function(t){for(var e,n,r=1,i=arguments.length;r<i;++r)for(n in e=arguments[r])t[n]=e[n];return t},Me=function(t,e){var n,r,i,s,o=0;if(t&&(n=t.length))if(null==e){for(r=t[o];o<n&&(null==r||r!=r);r=t[++o]);for(i=s=r;o<n;++o)null!=(r=t[o])&&(r<i&&(i=r),r>s&&(s=r))}else{for(r=e(t[o]);o<n&&(null==r||r!=r);r=e(t[++o]));for(i=s=r;o<n;++o)null!=(r=e(t[o]))&&(r<i&&(i=r),r>s&&(s=r))}return[i,s]},$e=function(t,e){var n,r,i,s,o,a=-1,l=t.length;if(null==e){for(;++a<l;)if(null!=(r=t[a])&&r>=r){n=i=r;break}if(a===l)return[-1,-1];for(s=o=a;++a<l;)null!=(r=t[a])&&(n>r&&(n=r,s=a),i<r&&(i=r,o=a))}else{for(;++a<l;)if(null!=(r=e(t[a],a,t))&&r>=r){n=i=r;break}if(a===l)return[-1,-1];for(s=o=a;++a<l;)null!=(r=e(t[a],a,t))&&(n>r&&(n=r,s=a),i<r&&(i=r,o=a))}return[s,o]};const Pe=Object.prototype.hasOwnProperty;var ze=function(t,e){return Pe.call(t,e)},Le={},Be=function(t){var e,n,r={};function i(t){return ze(r,t)&&r[t]!==Le}return e={size:0,empty:0,object:r,has:i,get:t=>i(t)?r[t]:void 0,set(t,n){return i(t)||(++e.size,r[t]===Le&&--e.empty),r[t]=n,this},delete(t){return i(t)&&(--e.size,++e.empty,r[t]=Le),this},clear(){e.size=e.empty=0,e.object=r={}},test(t){return arguments.length?(n=t,e):n},clean(){var t,i,s={},o=0;for(t in r)(i=r[t])===Le||n&&n(i)||(s[t]=i,++o);e.size=o,e.empty=0,e.object=r=s}},t&&Object.keys(t).forEach((function(n){e.set(n,t[n])})),e},je=function(t,e,n,r,i,s){if(!n&&0!==n)return s;var o,a,l=t[0],u=se(t),c=+n;return u<l&&(o=l,l=u,u=o),(o=Math.abs(e-l))<(a=Math.abs(u-e))&&o<=c?r:a<=c?i:s},Ue=function(t,e){var n=t.prototype=Object.create(e.prototype);return n.constructor=t,n},Ve=function(t,e,n,r){var i,s=e[0],o=e[e.length-1];return s>o&&(i=s,s=o,o=i),r=void 0===r||r,((n=void 0===n||n)?s<=t:s<t)&&(r?t<=o:t<o)},We=function(t){return"boolean"==typeof t},qe=function(t){return"[object Date]"===Object.prototype.toString.call(t)},He=function(t){return"number"==typeof t},Ge=function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},Ye=function(t){return"string"==typeof t},Ke=function(t,e,n){t&&(t=e?Ce(t).map(t=>t.replace(/\\(.)/g,"$1")):Ce(t));const r=t&&t.length,i=n&&n.get||Rt,s=t=>i(e?[t]:Pt(t));let o;if(r)if(1===r){const e=s(t[0]);o=function(t){return""+e(t)}}else{const e=t.map(s);o=function(t){let n=""+e[0](t),i=0;for(;++i<r;)n+="|"+e[i](t);return n}}else o=function(){return""};return Tt(o,t,"key")},Xe=function(t,e){const n=t[0],r=se(t),i=+e;return i?1===i?r:n+i*(r-n):n},Ze=function(t){let e,n,r;t=+t||1e4;const i=()=>{e={},n={},r=0},s=(i,s)=>(++r>t&&(n=e,e={},r=1),e[i]=s);return i(),{clear:i,has:t=>ze(e,t)||ze(n,t),get:t=>ze(e,t)?e[t]:ze(n,t)?s(t,n[t]):void 0,set:(t,n)=>ze(e,t)?e[t]=n:s(t,n)}},Qe=function(t,e,n,r){var i=e.length,s=n.length;if(!s)return e;if(!i)return n;for(var o=r||new e.constructor(i+s),a=0,l=0,u=0;a<i&&l<s;++u)o[u]=t(e[a],n[l])>0?n[l++]:e[a++];for(;a<i;++a,++u)o[u]=e[a];for(;l<s;++l,++u)o[u]=n[l];return o},Je=function(t,e){for(var n="";--e>=0;)n+=t;return n},tn=function(t,e,n,r){var i=n||" ",s=t+"",o=e-s.length;return o<=0?s:"left"===r?Je(i,o)+s:"center"===r?Je(i,~~(o/2))+s+Je(i,Math.ceil(o/2)):s+Je(i,o)},en=function(t){return t&&se(t)-t[0]||0};function nn(t){return Jt(t)?"["+t.map(nn)+"]":te(t)||Ye(t)?JSON.stringify(t).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):t}var rn=function(t){return null==t||""===t?null:!(!t||"false"===t||"0"===t||!t)};function sn(t){return He(t)||qe(t)?t:Date.parse(t)}var on=function(t,e){return e=e||sn,null==t||""===t?null:e(t)},an=function(t){return null==t||""===t?null:t+""},ln=function(t){for(var e={},n=0,r=t.length;n<r;++n)e[t[n]]=!0;return e},un=function(t,e,n,r){var i=null!=r?r:"\u2026",s=t+"",o=s.length,a=Math.max(0,e-i.length);return o<=e?s:"left"===n?i+s.slice(o-a):"center"===n?s.slice(0,Math.ceil(a/2))+i+s.slice(o-~~(a/2)):s.slice(0,a)+i},cn=function(t,e,n){if(t)if(e)for(var r,i=0,s=t.length;i<s;++i)(r=e(t[i]))&&n(r,i,t);else t.forEach(n)};function hn(t){var e=t||jt,n=[],r={};return n.add=function(t){var i=e(t);return r[i]||(r[i]=1,n.push(t)),n},n.remove=function(t){var i,s=e(t);return r[s]&&(r[s]=0,(i=n.indexOf(t))>=0&&n.splice(i,1)),n},n}var dn=async function(t,e){try{await e(t)}catch(n){t.error(n)}},fn=Symbol("vega_id"),pn=1;function mn(t){return!(!t||!gn(t))}function gn(t){return t[fn]}function yn(t,e){return t[fn]=e,t}function vn(t){var e=t===Object(t)?t:{data:t};return gn(e)?e:yn(e,pn++)}function bn(t){return xn(t,vn({}))}function xn(t,e){for(var n in t)e[n]=t[n];return e}function _n(t,e){return yn(e,gn(t))}function wn(t,e){return t?e?(n,r)=>t(n,r)||gn(e(n))-gn(e(r)):(e,n)=>t(e,n)||gn(e)-gn(n):null}function Sn(t){return t&&t.constructor===Cn}function Cn(){var t=[],e=[],n=[],r=[],i=[],s=null,o=!1;return{constructor:Cn,insert:function(e){for(var n=Ce(e),r=0,i=n.length;r<i;++r)t.push(n[r]);return this},remove:function(t){for(var n=ke(t)?r:e,i=Ce(t),s=0,o=i.length;s<o;++s)n.push(i[s]);return this},modify:function(t,e,r){var s={field:e,value:Ie(r)};return ke(t)?(s.filter=t,i.push(s)):(s.tuple=t,n.push(s)),this},encode:function(t,e){return ke(t)?i.push({filter:t,field:e}):n.push({tuple:t,field:e}),this},clean:function(t){return s=t,this},reflow:function(){return o=!0,this},pulse:function(a,l){var u,c,h,d,f,p,m={},g={};for(u=0,c=l.length;u<c;++u)m[gn(l[u])]=1;for(u=0,c=e.length;u<c;++u)m[gn(f=e[u])]=-1;for(u=0,c=r.length;u<c;++u)d=r[u],l.forEach((function(t){d(t)&&(m[gn(t)]=-1)}));for(u=0,c=t.length;u<c;++u)p=gn(f=t[u]),m[p]?m[p]=1:a.add.push(vn(t[u]));for(u=0,c=l.length;u<c;++u)m[gn(f=l[u])]<0&&a.rem.push(f);function y(t,e,n){n?t[e]=n(t):a.encode=e,o||(g[gn(t)]=t)}for(u=0,c=n.length;u<c;++u)d=(h=n[u]).field,(p=m[gn(f=h.tuple)])>0&&(y(f,d,h.value),a.modifies(d));for(u=0,c=i.length;u<c;++u)d=(h=i[u]).filter,l.forEach((function(t){d(t)&&m[gn(t)]>0&&y(t,h.field,h.value)})),a.modifies(h.field);if(o)a.mod=e.length||r.length?l.filter((function(t){return m[gn(t)]>0})):l.slice();else for(p in g)a.mod.push(g[p]);return(s||null==s&&(e.length||r.length))&&a.clean(!0),a}}}var En="_:mod:_";function kn(){Object.defineProperty(this,En,{writable:!0,value:{}})}var An=kn.prototype;An.set=function(t,e,n,r){var i=this,s=i[t],o=i[En];return null!=e&&e>=0?(s[e]!==n||r)&&(s[e]=n,o[e+":"+t]=-1,o[t]=-1):(s!==n||r)&&(i[t]=n,o[t]=Jt(n)?1+n.length:-1),i},An.modified=function(t,e){var n,r=this[En];if(!arguments.length){for(n in r)if(r[n])return!0;return!1}if(Jt(t)){for(n=0;n<t.length;++n)if(r[t[n]])return!0;return!1}return null!=e&&e>=0?e+1<r[t]||!!r[e+":"+t]:!!r[t]},An.clear=function(){return this[En]={},this};var Dn=0,Nn=new kn;function Tn(t,e,n,r){this.id=++Dn,this.value=t,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,e&&(this._update=e),n&&this.parameters(n,r)}var On=Tn.prototype;function In(t){return function(e){var n=this.flags;return 0===arguments.length?!!(n&t):(this.flags=e?n|t:n&~t,this)}}On.targets=function(){return this._targets||(this._targets=hn(Bt))},On.set=function(t){return this.value!==t?(this.value=t,1):0},On.skip=In(1),On.modified=In(2),On.parameters=function(t,e,n){e=!1!==e;var r,i,s,o,a=this,l=a._argval=a._argval||new kn,u=a._argops=a._argops||[],c=[];function h(t,n,r){r instanceof Tn?(r!==a&&(e&&r.targets().add(a),c.push(r)),u.push({op:r,name:t,index:n})):l.set(t,n,r)}for(r in t)if(i=t[r],"pulse"===r)Ce(i).forEach((function(t){t instanceof Tn?t!==a&&(t.targets().add(a),c.push(t)):$t("Pulse parameters must be operator instances.")})),a.source=i;else if(Jt(i))for(l.set(r,-1,Array(s=i.length)),o=0;o<s;++o)h(r,o,i[o]);else h(r,-1,i);return this.marshall().clear(),n&&(u.initonly=!0),c},On.marshall=function(t){var e,n,r,i,s,o=this._argval||Nn,a=this._argops;if(a){for(n=0,r=a.length;n<r;++n)s=(i=(e=a[n]).op).modified()&&i.stamp===t,o.set(e.name,e.index,i.value,s);if(a.initonly){for(n=0;n<r;++n)(e=a[n]).op.targets().remove(this);this._argops=null,this._update=null}}return o},On.detach=function(){var t,e,n,r=this._argops;if(r)for(t=0,e=r.length;t<e;++t)(n=r[t].op)._targets&&n._targets.remove(this)},On.evaluate=function(t){var e=this._update;if(e){var n=this.marshall(t.stamp),r=e.call(this,n,t);if(n.clear(),r!==this.value)this.value=r;else if(!this.modified())return t.StopPropagation}},On.run=function(t){return t.stamp<this.stamp?t.StopPropagation:(this.skip()?(this.skip(!1),e=0):e=this.evaluate(t),this.pulse=e||t);var e};var Rn=0;function Fn(t,e,n){this.id=++Rn,this.value=null,n&&(this.receive=n),t&&(this._filter=t),e&&(this._apply=e)}function Mn(t,e,n){return new Fn(t,e,n)}var $n=Fn.prototype;$n._filter=Wt,$n._apply=jt,$n.targets=function(){return this._targets||(this._targets=hn(Bt))},$n.consume=function(t){return arguments.length?(this._consume=!!t,this):!!this._consume},$n.receive=function(t){if(this._filter(t)){for(var e=this.value=this._apply(t),n=this._targets,r=n?n.length:0,i=0;i<r;++i)n[i].receive(e);this._consume&&(t.preventDefault(),t.stopPropagation())}},$n.filter=function(t){var e=Mn(t);return this.targets().add(e),e},$n.apply=function(t){var e=Mn(null,t);return this.targets().add(e),e},$n.merge=function(){var t=Mn();this.targets().add(t);for(var e=0,n=arguments.length;e<n;++e)arguments[e].targets().add(t);return t},$n.throttle=function(t){var e=-1;return this.filter((function(){var n=Date.now();return n-e>t?(e=n,1):0}))},$n.debounce=function(t){var e=Mn();return this.targets().add(Mn(null,null,Re(t,(function(t){var n=t.dataflow;e.receive(t),n&&n.run&&n.run()})))),e},$n.between=function(t,e){var n=!1;return t.targets().add(Mn(null,null,(function(){n=!0}))),e.targets().add(Mn(null,null,(function(){n=!1}))),this.filter((function(){return n}))};const Pn=/^([A-Za-z]+:)?\/\//,zn=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,Ln=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g;async function Bn(t,e){const n=await this.sanitize(t,e),r=n.href;return n.localFile?this.file(r):this.http(r,e)}async function jn(t,e){e=Fe({},this.options,e);const n=this.fileAccess,r={href:null};let i,s,o;const a=zn.test(t.replace(Ln,""));null!=t&&"string"==typeof t&&a||$t("Sanitize failure, invalid URI: "+nn(t));const l=Pn.test(t);return(o=e.baseURL)&&!l&&(t.startsWith("/")||"/"===o[o.length-1]||(t="/"+t),t=o+t),s=(i=t.startsWith("file://"))||"file"===e.mode||"http"!==e.mode&&!l&&n,i?t=t.slice("file://".length):t.startsWith("//")&&("file"===e.defaultProtocol?(t=t.slice(2),s=!0):t=(e.defaultProtocol||"http")+":"+t),Object.defineProperty(r,"localFile",{value:!!s}),r.href=t,e.target&&(r.target=e.target+""),e.rel&&(r.rel=e.rel+""),"image"===e.context&&e.crossOrigin&&(r.crossOrigin=e.crossOrigin+""),r}function Un(t){return t?function(e){return new Promise((function(n,r){t.readFile(e,(function(t,e){t?r(t):n(e)}))}))}:Vn}async function Vn(){$t("No file system access.")}function Wn(t){return t?async function(e,n){const r=Fe({},this.options.http,n),i=n&&n.response,s=await t(e,r);return s.ok?ke(s[i])?s[i]():s.text():$t(s.status+""+s.statusText)}:qn}async function qn(){$t("No HTTP fetch method available.")}var Hn={boolean:rn,integer:oe,number:oe,date:on,string:an,unknown:jt},Gn=[function(t){return"true"===t||"false"===t||!0===t||!1===t},function(t){return Zn(t)&&Number.isInteger(+t)},Zn,function(t){return!Number.isNaN(Date.parse(t))}],Yn=["boolean","integer","number","date"];function Kn(t,e){if(!t||!t.length)return"unknown";const n=t.length,r=Gn.length,i=Gn.map((t,e)=>e+1);for(let o,a,l=0,u=0;l<n;++l)for(a=e?t[l][e]:t[l],o=0;o<r;++o)if(i[o]&&null!=(s=a)&&s==s&&!Gn[o](a)&&(i[o]=0,++u,u===Gn.length))return"string";var s;return Yn[i.reduce((t,e)=>0===t?e:t,0)-1]}function Xn(t,e){return e.reduce((function(e,n){return e[n]=Kn(t,n),e}),{})}function Zn(t){return!(Number.isNaN(+t)||t instanceof Date)}var Qn={},Jn={};function tr(t){return new Function("d","return {"+t.map((function(t,e){return JSON.stringify(t)+": d["+e+'] || ""'})).join(",")+"}")}function er(t){var e=Object.create(null),n=[];return t.forEach((function(t){for(var r in t)r in e||n.push(e[r]=r)})),n}function nr(t,e){var n=t+"",r=n.length;return r<e?new Array(e-r+1).join(0)+n:n}function rr(t){const e=function(e,n){const r={delimiter:t};return ir(e,n?Fe(n,r):r)};return e.responseType="text",e}function ir(t,e){return e.header&&(t=e.header.map(nn).join(e.delimiter)+"\n"+t),function(t){var e=new RegExp('["'+t+"\n\r]"),n=t.charCodeAt(0);function r(t,e){var r,i=[],s=t.length,o=0,a=0,l=s<=0,u=!1;function c(){if(l)return Jn;if(u)return u=!1,Qn;var e,r,i=o;if(34===t.charCodeAt(i)){for(;o++<s&&34!==t.charCodeAt(o)||34===t.charCodeAt(++o););return(e=o)>=s?l=!0:10===(r=t.charCodeAt(o++))?u=!0:13===r&&(u=!0,10===t.charCodeAt(o)&&++o),t.slice(i+1,e-1).replace(/""/g,'"')}for(;o<s;){if(10===(r=t.charCodeAt(e=o++)))u=!0;else if(13===r)u=!0,10===t.charCodeAt(o)&&++o;else if(r!==n)continue;return t.slice(i,e)}return l=!0,t.slice(i,s)}for(10===t.charCodeAt(s-1)&&--s,13===t.charCodeAt(s-1)&&--s;(r=c())!==Jn;){for(var h=[];r!==Qn&&r!==Jn;)h.push(r),r=c();e&&null==(h=e(h,a++))||i.push(h)}return i}function i(e,n){return e.map((function(e){return n.map((function(t){return o(e[t])})).join(t)}))}function s(e){return e.map(o).join(t)}function o(t){return null==t?"":t instanceof Date?(i=(n=t).getUTCHours(),s=n.getUTCMinutes(),o=n.getUTCSeconds(),a=n.getUTCMilliseconds(),isNaN(n)?"Invalid Date":((r=n.getUTCFullYear())<0?"-"+nr(-r,6):r>9999?"+"+nr(r,6):nr(r,4))+"-"+nr(n.getUTCMonth()+1,2)+"-"+nr(n.getUTCDate(),2)+(a?"T"+nr(i,2)+":"+nr(s,2)+":"+nr(o,2)+"."+nr(a,3)+"Z":o?"T"+nr(i,2)+":"+nr(s,2)+":"+nr(o,2)+"Z":s||i?"T"+nr(i,2)+":"+nr(s,2)+"Z":"")):e.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t;var n,r,i,s,o,a}return{parse:function(t,e){var n,i,s=r(t,(function(t,r){if(n)return n(t,r-1);i=t,n=e?function(t,e){var n=tr(t);return function(r,i){return e(n(r),i,t)}}(t,e):tr(t)}));return s.columns=i||[],s},parseRows:r,format:function(e,n){return null==n&&(n=er(e)),[n.map(o).join(t)].concat(i(e,n)).join("\n")},formatBody:function(t,e){return null==e&&(e=er(t)),i(t,e).join("\n")},formatRows:function(t){return t.map(s).join("\n")},formatRow:s,formatValue:o}}(e.delimiter).parse(t+"")}function sr(t,e){const n=e&&e.property?zt(e.property):jt;return!te(t)||(r=t,"function"==typeof Buffer&&ke(Buffer.isBuffer)&&Buffer.isBuffer(r))?n(JSON.parse(t)):function(t,e){return t}(n(t));var r}ir.responseType="text",sr.responseType="json";var or=function(t){return t},ar=function(t,e){return"string"==typeof e&&(e=t.objects[e]),"GeometryCollection"===e.type?{type:"FeatureCollection",features:e.geometries.map((function(e){return lr(t,e)}))}:lr(t,e)};function lr(t,e){var n=e.id,r=e.bbox,i=null==e.properties?{}:e.properties,s=ur(t,e);return null==n&&null==r?{type:"Feature",properties:i,geometry:s}:null==r?{type:"Feature",id:n,properties:i,geometry:s}:{type:"Feature",id:n,bbox:r,properties:i,geometry:s}}function ur(t,e){var n=function(t){if(null==t)return or;var e,n,r=t.scale[0],i=t.scale[1],s=t.translate[0],o=t.translate[1];return function(t,a){a||(e=n=0);var l=2,u=t.length,c=new Array(u);for(c[0]=(e+=t[0])*r+s,c[1]=(n+=t[1])*i+o;l<u;)c[l]=t[l],++l;return c}}(t.transform),r=t.arcs;function i(t,e){e.length&&e.pop();for(var i=r[t<0?~t:t],s=0,o=i.length;s<o;++s)e.push(n(i[s],s));t<0&&function(t,e){for(var n,r=t.length,i=r-e;i<--r;)n=t[i],t[i++]=t[r],t[r]=n}(e,o)}function s(t){return n(t)}function o(t){for(var e=[],n=0,r=t.length;n<r;++n)i(t[n],e);return e.length<2&&e.push(e[0]),e}function a(t){for(var e=o(t);e.length<4;)e.push(e[0]);return e}function l(t){return t.map(a)}return function t(e){var n,r=e.type;switch(r){case"GeometryCollection":return{type:r,geometries:e.geometries.map(t)};case"Point":n=s(e.coordinates);break;case"MultiPoint":n=e.coordinates.map(s);break;case"LineString":n=o(e.arcs);break;case"MultiLineString":n=e.arcs.map(o);break;case"Polygon":n=l(e.arcs);break;case"MultiPolygon":n=e.arcs.map(l);break;default:return null}return{type:r,coordinates:n}}(e)}var cr=function(t,e){var n={},r={},i={},s=[],o=-1;function a(t,e){for(var r in t){var i=t[r];delete e[i.start],delete i.start,delete i.end,i.forEach((function(t){n[t<0?~t:t]=1})),s.push(i)}}return e.forEach((function(n,r){var i,s=t.arcs[n<0?~n:n];s.length<3&&!s[1][0]&&!s[1][1]&&(i=e[++o],e[o]=n,e[r]=i)})),e.forEach((function(e){var n,s,o=function(e){var n,r=t.arcs[e<0?~e:e],i=r[0];return t.transform?(n=[0,0],r.forEach((function(t){n[0]+=t[0],n[1]+=t[1]}))):n=r[r.length-1],e<0?[n,i]:[i,n]}(e),a=o[0],l=o[1];if(n=i[a])if(delete i[n.end],n.push(e),n.end=l,s=r[l]){delete r[s.start];var u=s===n?n:n.concat(s);r[u.start=n.start]=i[u.end=s.end]=u}else r[n.start]=i[n.end]=n;else if(n=r[l])if(delete r[n.start],n.unshift(e),n.start=a,s=i[a]){delete i[s.end];var c=s===n?n:s.concat(n);r[c.start=s.start]=i[c.end=n.end]=c}else r[n.start]=i[n.end]=n;else r[(n=[e]).start=a]=i[n.end=l]=n})),a(i,r),a(r,i),e.forEach((function(t){n[t<0?~t:t]||s.push([t])})),s},hr=function(t){return ur(t,dr.apply(this,arguments))};function dr(t,e,n){var r,i,s;if(arguments.length>1)r=fr(0,e,n);else for(i=0,r=new Array(s=t.arcs.length);i<s;++i)r[i]=i;return{type:"MultiLineString",arcs:cr(t,r)}}function fr(t,e,n){var r,i=[],s=[];function o(t){var e=t<0?~t:t;(s[e]||(s[e]=[])).push({i:t,g:r})}function a(t){t.forEach(o)}function l(t){t.forEach(a)}return function t(e){switch(r=e,e.type){case"GeometryCollection":e.geometries.forEach(t);break;case"LineString":a(e.arcs);break;case"MultiLineString":case"Polygon":l(e.arcs);break;case"MultiPolygon":!function(t){t.forEach(l)}(e.arcs)}}(e),s.forEach(null==n?function(t){i.push(t[0].i)}:function(t){n(t[0].g,t[t.length-1].g)&&i.push(t[0].i)}),i}const pr={interior:(t,e)=>t!==e,exterior:(t,e)=>t===e};function mr(t,e){let n,r,i,s;return t=sr(t,e),e&&e.feature?(n=ar,i=e.feature):e&&e.mesh?(n=hr,i=e.mesh,s=pr[e.filter]):$t("Missing TopoJSON feature or mesh parameter."),r=(r=t.objects[i])?n(t,r,s):$t("Invalid TopoJSON object: "+i),r&&r.features||[r]}mr.responseType="json";const gr={dsv:ir,csv:rr(","),tsv:rr("\t"),json:sr,topojson:mr};function yr(t,e){return arguments.length>1?(gr[t]=e,this):ze(gr,t)?gr[t]:null}function vr(t){const e=yr(t);return e&&e.responseType||"text"}var br=function(t){const e={};return n=>e[n]||(e[n]=t(n))},xr=Math.sqrt(50),_r=Math.sqrt(10),wr=Math.sqrt(2),Sr=function(t,e,n){var r,i,s,o,a=-1;if(n=+n,(t=+t)==(e=+e)&&n>0)return[t];if((r=e<t)&&(i=t,t=e,e=i),0===(o=Cr(t,e,n))||!isFinite(o))return[];if(o>0)for(t=Math.ceil(t/o),e=Math.floor(e/o),s=new Array(i=Math.ceil(e-t+1));++a<i;)s[a]=(t+a)*o;else for(o=-o,t=Math.floor(t*o),e=Math.ceil(e*o),s=new Array(i=Math.ceil(e-t+1));++a<i;)s[a]=(t+a)/o;return r&&s.reverse(),s};function Cr(t,e,n){var r=(e-t)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),s=r/Math.pow(10,i);return i>=0?(s>=xr?10:s>=_r?5:s>=wr?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(s>=xr?10:s>=_r?5:s>=wr?2:1)}function Er(t,e,n){var r=Math.abs(e-t)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),s=r/i;return s>=xr?i*=10:s>=_r?i*=5:s>=wr&&(i*=2),e<t?-i:i}var kr=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ar(t){if(!(e=kr.exec(t)))throw new Error("invalid format: "+t);var e;return new Dr({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function Dr(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}Ar.prototype=Dr.prototype,Dr.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var Nr,Tr,Or,Ir,Rr=function(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]},Fr=function(t){return(t=Rr(Math.abs(t)))?t[1]:NaN},Mr=function(t,e){var n=Rr(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")},$r={"%":function(t,e){return(100*t).toFixed(e)},b:function(t){return Math.round(t).toString(2)},c:function(t){return t+""},d:function(t){return Math.round(t).toString(10)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},g:function(t,e){return t.toPrecision(e)},o:function(t){return Math.round(t).toString(8)},p:function(t,e){return Mr(100*t,e)},r:Mr,s:function(t,e){var n=Rr(t,e);if(!n)return t+"";var r=n[0],i=n[1],s=i-(Nr=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,o=r.length;return s===o?r:s>o?r+new Array(s-o+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+Rr(t,Math.max(0,e+s-1))[0]},X:function(t){return Math.round(t).toString(16).toUpperCase()},x:function(t){return Math.round(t).toString(16)}},Pr=function(t){return t},zr=Array.prototype.map,Lr=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"],Br=function(t){var e,n,r=void 0===t.grouping||void 0===t.thousands?Pr:(e=zr.call(t.grouping,Number),n=t.thousands+"",function(t,r){for(var i=t.length,s=[],o=0,a=e[0],l=0;i>0&&a>0&&(l+a+1>r&&(a=Math.max(1,r-l)),s.push(t.substring(i-=a,i+a)),!((l+=a+1)>r));)a=e[o=(o+1)%e.length];return s.reverse().join(n)}),i=void 0===t.currency?"":t.currency[0]+"",s=void 0===t.currency?"":t.currency[1]+"",o=void 0===t.decimal?".":t.decimal+"",a=void 0===t.numerals?Pr:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(zr.call(t.numerals,String)),l=void 0===t.percent?"%":t.percent+"",u=void 0===t.minus?"-":t.minus+"",c=void 0===t.nan?"NaN":t.nan+"";function h(t){var e=(t=Ar(t)).fill,n=t.align,h=t.sign,d=t.symbol,f=t.zero,p=t.width,m=t.comma,g=t.precision,y=t.trim,v=t.type;"n"===v?(m=!0,v="g"):$r[v]||(void 0===g&&(g=12),y=!0,v="g"),(f||"0"===e&&"="===n)&&(f=!0,e="0",n="=");var b="$"===d?i:"#"===d&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",x="$"===d?s:/[%p]/.test(v)?l:"",_=$r[v],w=/[defgprs%]/.test(v);function S(t){var i,s,l,d=b,S=x;if("c"===v)S=_(t)+S,t="";else{var C=(t=+t)<0||1/t<0;if(t=isNaN(t)?c:_(Math.abs(t),g),y&&(t=function(t){t:for(var e,n=t.length,r=1,i=-1;r<n;++r)switch(t[r]){case".":i=e=r;break;case"0":0===i&&(i=r),e=r;break;default:if(!+t[r])break t;i>0&&(i=0)}return i>0?t.slice(0,i)+t.slice(e+1):t}(t)),C&&0==+t&&"+"!==h&&(C=!1),d=(C?"("===h?h:u:"-"===h||"("===h?"":h)+d,S=("s"===v?Lr[8+Nr/3]:"")+S+(C&&"("===h?")":""),w)for(i=-1,s=t.length;++i<s;)if(48>(l=t.charCodeAt(i))||l>57){S=(46===l?o+t.slice(i+1):t.slice(i))+S,t=t.slice(0,i);break}}m&&!f&&(t=r(t,1/0));var E=d.length+t.length+S.length,k=E<p?new Array(p-E+1).join(e):"";switch(m&&f&&(t=r(k+t,k.length?p-S.length:1/0),k=""),n){case"<":t=d+t+S+k;break;case"=":t=d+k+t+S;break;case"^":t=k.slice(0,E=k.length>>1)+d+t+S+k.slice(E);break;default:t=k+d+t+S}return a(t)}return g=void 0===g?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),S.toString=function(){return t+""},S}return{format:h,formatPrefix:function(t,e){var n=h(((t=Ar(t)).type="f",t)),r=3*Math.max(-8,Math.min(8,Math.floor(Fr(e)/3))),i=Math.pow(10,-r),s=Lr[8+r/3];return function(t){return n(i*t)+s}}}};function jr(t){const e=br(t.format),n=t.formatPrefix;return{format:e,formatPrefix:n,formatFloat(t){var n=Ar(t||",");if(null==n.precision){switch(n.precision=12,n.type){case"%":n.precision-=2;break;case"e":n.precision-=1}return function(t,e){return n=>{var r,i,s=t(n),o=s.indexOf(e);if(o<0)return s;for(i=(r=function(t,e){var n,r=t.lastIndexOf("e");if(r>0)return r;for(r=t.length;--r>e;)if((n=t.charCodeAt(r))>=48&&n<=57)return r+1}(s,o))<s.length?s.slice(r):"";--r>o;)if("0"!==s[r]){++r;break}return s.slice(0,r)+i}}(e(n),e(".1f")(1)[1])}return e(n)},formatSpan(t,r,i,s){s=Ar(null==s?",f":s);const o=Er(t,r,i),a=Math.max(Math.abs(t),Math.abs(r));let l;if(null==s.precision)switch(s.type){case"s":return isNaN(l=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Fr(e)/3)))-Fr(Math.abs(t)))}(o,a))||(s.precision=l),n(s,a);case"":case"e":case"g":case"p":case"r":isNaN(l=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Fr(e)-Fr(t))+1}(o,a))||(s.precision=l-("e"===s.type));break;case"f":case"%":isNaN(l=function(t){return Math.max(0,-Fr(Math.abs(t)))}(o))||(s.precision=l-2*("%"===s.type))}return e(s)}}}let Ur;function Vr(){return Ur=jr({format:Or,formatPrefix:Ir})}function Wr(t){return jr(Br(t))}function qr(t){return arguments.length?Ur=Wr(t):Ur}Tr=Br({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"}),Or=Tr.format,Ir=Tr.formatPrefix,Vr();const Hr="year",Gr="quarter",Yr="month",Kr="week",Xr="date",Zr="day",Qr="dayofyear",Jr="hours",ti="minutes",ei="seconds",ni="milliseconds",ri=[Hr,Gr,Yr,Kr,Xr,Zr,Qr,Jr,ti,ei,ni],ii=ri.reduce((t,e,n)=>(t[e]=1+n,t),{});function si(t){const e=Ce(t).slice(),n={};return e.length||$t("Missing time unit."),e.forEach(t=>{ze(ii,t)?n[t]=1:$t(`Invalid time unit: ${t}.`)}),(n[Kr]||n[Zr]?1:0)+(n[Gr]||n[Yr]||n[Xr]?1:0)+(n[Qr]?1:0)>1&&$t("Incompatible time units: "+t),e.sort((t,e)=>ii[t]-ii[e]),e}const oi={[Hr]:"%Y ",[Gr]:"Q%q ",[Yr]:"%b ",[Xr]:"%d ",[Kr]:"W%U ",[Zr]:"%a ",[Qr]:"%j ",[Jr]:"%H:00",[ti]:"00:%M",[ei]:":%S",[ni]:".%L",[`${Hr}-${Yr}`]:"%Y-%m ",[`${Hr}-${Yr}-${Xr}`]:"%Y-%m-%d ",[`${Jr}-${ti}`]:"%H:%M"};function ai(t,e){const n=Fe({},oi,e),r=si(t),i=r.length;let s,o,a="",l=0;for(l=0;l<i;)for(s=r.length;s>l;--s)if(o=r.slice(l,s).join("-"),null!=n[o]){a+=n[o],l=s;break}return a.trim()}var li=new Date,ui=new Date;function ci(t,e,n,r){function i(e){return t(e=0===arguments.length?new Date:new Date(+e)),e}return i.floor=function(e){return t(e=new Date(+e)),e},i.ceil=function(n){return t(n=new Date(n-1)),e(n,1),t(n),n},i.round=function(t){var e=i(t),n=i.ceil(t);return t-e<n-t?e:n},i.offset=function(t,n){return e(t=new Date(+t),null==n?1:Math.floor(n)),t},i.range=function(n,r,s){var o,a=[];if(n=i.ceil(n),s=null==s?1:Math.floor(s),!(n<r&&s>0))return a;do{a.push(o=new Date(+n)),e(n,s),t(n)}while(o<n&&n<r);return a},i.filter=function(n){return ci((function(e){if(e>=e)for(;t(e),!n(e);)e.setTime(e-1)}),(function(t,r){if(t>=t)if(r<0)for(;++r<=0;)for(;e(t,-1),!n(t););else for(;--r>=0;)for(;e(t,1),!n(t););}))},n&&(i.count=function(e,r){return li.setTime(+e),ui.setTime(+r),t(li),t(ui),Math.floor(n(li,ui))},i.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?i.filter(r?function(e){return r(e)%t==0}:function(e){return i.count(0,e)%t==0}):i:null}),i}var hi=ci((function(t){t.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+e)}),(function(t,e){return(e-t-6e4*(e.getTimezoneOffset()-t.getTimezoneOffset()))/864e5}),(function(t){return t.getDate()-1}));function di(t){return ci((function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+7*e)}),(function(t,e){return(e-t-6e4*(e.getTimezoneOffset()-t.getTimezoneOffset()))/6048e5}))}var fi=di(0),pi=di(1),mi=(di(2),di(3),di(4)),gi=(di(5),di(6),ci((function(t){t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+e)}),(function(t,e){return(e-t)/864e5}),(function(t){return t.getUTCDate()-1})));function yi(t){return ci((function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+7*e)}),(function(t,e){return(e-t)/6048e5}))}var vi=yi(0),bi=yi(1),xi=(yi(2),yi(3),yi(4));yi(5),yi(6);const _i=new Date;function wi(t){return _i.setFullYear(t),_i.setMonth(0),_i.setDate(1),_i.setHours(0,0,0,0),_i}function Si(t){return Ei(new Date(t))}function Ci(t){return ki(new Date(t))}function Ei(t){return hi.count(wi(t.getFullYear())-1,t)}function ki(t){return fi.count(wi(t.getFullYear())-1,t)}function Ai(t){return wi(t).getDay()}function Di(t,e,n,r,i,s,o){if(0<=t&&t<100){var a=new Date(-1,e,n,r,i,s,o);return a.setFullYear(t),a}return new Date(t,e,n,r,i,s,o)}function Ni(t){return Oi(new Date(t))}function Ti(t){return Ii(new Date(t))}function Oi(t){const e=Date.UTC(t.getUTCFullYear(),0,1);return gi.count(e-1,t)}function Ii(t){const e=Date.UTC(t.getUTCFullYear(),0,1);return vi.count(e-1,t)}function Ri(t){return _i.setTime(Date.UTC(t,0,1)),_i.getUTCDay()}function Fi(t,e,n,r,i,s,o){if(0<=t&&t<100){var a=new Date(Date.UTC(-1,e,n,r,i,s,o));return a.setUTCFullYear(n.y),a}return new Date(Date.UTC(t,e,n,r,i,s,o))}function Mi(t,e,n,r,i){const s=e||1,o=se(t),a=(t,e,i)=>function(t,e,n,r){const i=n<=1?t:r?(e,i)=>r+n*Math.floor((t(e,i)-r)/n):(e,r)=>n*Math.floor(t(e,r)/n);return e?(t,n)=>e(i(t,n),n):i}(n[i=i||t],r[i],t===o&&s,e),l=new Date,u=ln(t),c=u[Hr]?a(Hr):Ie(2012),h=u[Yr]?a(Yr):u[Gr]?a(Gr):Ut,d=u[Kr]&&u[Zr]?a(Zr,1,Kr+Zr):u[Kr]?a(Kr,1):u[Zr]?a(Zr,1):u[Xr]?a(Xr,1):u[Qr]?a(Qr,1):Vt,f=u[Jr]?a(Jr):Ut,p=u[ti]?a(ti):Ut,m=u[ei]?a(ei):Ut,g=u[ni]?a(ni):Ut;return function(t){l.setTime(+t);const e=c(l);return i(e,h(l),d(l,e),f(l),p(l),m(l),g(l))}}function $i(t,e,n){return e+7*t-(n+6)%7}const Pi={[Hr]:t=>t.getFullYear(),[Gr]:t=>Math.floor(t.getMonth()/3),[Yr]:t=>t.getMonth(),[Xr]:t=>t.getDate(),[Jr]:t=>t.getHours(),[ti]:t=>t.getMinutes(),[ei]:t=>t.getSeconds(),[ni]:t=>t.getMilliseconds(),[Qr]:t=>Ei(t),[Kr]:t=>ki(t),[Kr+Zr]:(t,e)=>$i(ki(t),t.getDay(),Ai(e)),[Zr]:(t,e)=>$i(1,t.getDay(),Ai(e))},zi={[Gr]:t=>3*t,[Kr]:(t,e)=>$i(t,0,Ai(e))};function Li(t,e){return Mi(t,e||1,Pi,zi,Di)}const Bi={[Hr]:t=>t.getUTCFullYear(),[Gr]:t=>Math.floor(t.getUTCMonth()/3),[Yr]:t=>t.getUTCMonth(),[Xr]:t=>t.getUTCDate(),[Jr]:t=>t.getUTCHours(),[ti]:t=>t.getUTCMinutes(),[ei]:t=>t.getUTCSeconds(),[ni]:t=>t.getUTCMilliseconds(),[Qr]:t=>Oi(t),[Kr]:t=>Ii(t),[Zr]:(t,e)=>$i(1,t.getUTCDay(),Ri(e)),[Kr+Zr]:(t,e)=>$i(Ii(t),t.getUTCDay(),Ri(e))},ji={[Gr]:t=>3*t,[Kr]:(t,e)=>$i(t,0,Ri(e))};function Ui(t,e){return Mi(t,e||1,Bi,ji,Fi)}var Vi=ci((function(t){t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,e){t.setFullYear(t.getFullYear()+e)}),(function(t,e){return e.getFullYear()-t.getFullYear()}),(function(t){return t.getFullYear()}));Vi.every=function(t){return isFinite(t=Math.floor(t))&&t>0?ci((function(e){e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,n){e.setFullYear(e.getFullYear()+n*t)})):null};var Wi=Vi,qi=ci((function(t){t.setDate(1),t.setHours(0,0,0,0)}),(function(t,e){t.setMonth(t.getMonth()+e)}),(function(t,e){return e.getMonth()-t.getMonth()+12*(e.getFullYear()-t.getFullYear())}),(function(t){return t.getMonth()})),Hi=ci((function(t){t.setTime(t-t.getMilliseconds()-1e3*t.getSeconds()-6e4*t.getMinutes())}),(function(t,e){t.setTime(+t+36e5*e)}),(function(t,e){return(e-t)/36e5}),(function(t){return t.getHours()})),Gi=ci((function(t){t.setTime(t-t.getMilliseconds()-1e3*t.getSeconds())}),(function(t,e){t.setTime(+t+6e4*e)}),(function(t,e){return(e-t)/6e4}),(function(t){return t.getMinutes()})),Yi=ci((function(t){t.setTime(t-t.getMilliseconds())}),(function(t,e){t.setTime(+t+1e3*e)}),(function(t,e){return(e-t)/1e3}),(function(t){return t.getUTCSeconds()})),Ki=ci((function(){}),(function(t,e){t.setTime(+t+e)}),(function(t,e){return e-t}));Ki.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?ci((function(e){e.setTime(Math.floor(e/t)*t)}),(function(e,n){e.setTime(+e+n*t)}),(function(e,n){return(n-e)/t})):Ki:null};var Xi=Ki,Zi=ci((function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCFullYear(t.getUTCFullYear()+e)}),(function(t,e){return e.getUTCFullYear()-t.getUTCFullYear()}),(function(t){return t.getUTCFullYear()}));Zi.every=function(t){return isFinite(t=Math.floor(t))&&t>0?ci((function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,n){e.setUTCFullYear(e.getUTCFullYear()+n*t)})):null};var Qi=Zi,Ji=ci((function(t){t.setUTCDate(1),t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCMonth(t.getUTCMonth()+e)}),(function(t,e){return e.getUTCMonth()-t.getUTCMonth()+12*(e.getUTCFullYear()-t.getUTCFullYear())}),(function(t){return t.getUTCMonth()})),ts=ci((function(t){t.setUTCMinutes(0,0,0)}),(function(t,e){t.setTime(+t+36e5*e)}),(function(t,e){return(e-t)/36e5}),(function(t){return t.getUTCHours()})),es=ci((function(t){t.setUTCSeconds(0,0)}),(function(t,e){t.setTime(+t+6e4*e)}),(function(t,e){return(e-t)/6e4}),(function(t){return t.getUTCMinutes()}));const ns={[Hr]:Wi,[Gr]:qi.every(3),[Yr]:qi,[Kr]:fi,[Xr]:hi,[Zr]:hi,[Qr]:hi,[Jr]:Hi,[ti]:Gi,[ei]:Yi,[ni]:Xi},rs={[Hr]:Qi,[Gr]:Ji.every(3),[Yr]:Ji,[Kr]:vi,[Xr]:gi,[Zr]:gi,[Qr]:gi,[Jr]:ts,[ti]:es,[ei]:Yi,[ni]:Xi};function is(t){return ns[t]}function ss(t){return rs[t]}function os(t,e,n){return t?t.offset(e,n):void 0}function as(t,e,n){return os(is(t),e,n)}function ls(t,e,n){return os(ss(t),e,n)}function us(t,e,n,r){return t?t.range(e,n,r):void 0}function cs(t,e,n,r){return us(is(t),e,n,r)}function hs(t,e,n,r){return us(ss(t),e,n,r)}var ds=function(t,e){return t<e?-1:t>e?1:t>=e?0:NaN},fs=function(t){var e;return 1===t.length&&(e=t,t=function(t,n){return ds(e(t),n)}),{left:function(e,n,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var s=r+i>>>1;t(e[s],n)<0?r=s+1:i=s}return r},right:function(e,n,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){var s=r+i>>>1;t(e[s],n)>0?i=s:r=s+1}return r}}};const ps=[Hr,Yr,Xr,Jr,ti,ei,ni],ms=ps.slice(0,-1),gs=ms.slice(0,-1),ys=gs.slice(0,-1),vs=ys.slice(0,-1),bs=[Hr,Yr],xs=[Hr],_s=[[ms,1,1e3],[ms,5,5e3],[ms,15,15e3],[ms,30,3e4],[gs,1,6e4],[gs,5,3e5],[gs,15,9e5],[gs,30,18e5],[ys,1,36e5],[ys,3,108e5],[ys,6,216e5],[ys,12,432e5],[vs,1,864e5],[[Hr,Kr],1,6048e5],[bs,1,2592e6],[bs,3,7776e6],[xs,1,31536e6]];var ws=function(t){const e=t.extent,n=t.maxbins||40,r=Math.abs(en(e))/n;let i,s,o=fs(t=>t[2]).right(_s,r);return o===_s.length?(i=xs,s=Er(e[0]/31536e6,e[1]/31536e6,n)):o?(o=_s[r/_s[o-1][2]<_s[o][2]/r?o-1:o],i=o[0],s=o[1]):(i=ps,s=Math.max(Er(e[0],e[1],n),1)),{units:i,step:s}};function Ss(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function Cs(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function Es(t,e,n){return{y:t,m:e,d:n,H:0,M:0,S:0,L:0}}function ks(t){var e=t.dateTime,n=t.date,r=t.time,i=t.periods,s=t.days,o=t.shortDays,a=t.months,l=t.shortMonths,u=zs(i),c=Ls(i),h=zs(s),d=Ls(s),f=zs(o),p=Ls(o),m=zs(a),g=Ls(a),y=zs(l),v=Ls(l),b={a:function(t){return o[t.getDay()]},A:function(t){return s[t.getDay()]},b:function(t){return l[t.getMonth()]},B:function(t){return a[t.getMonth()]},c:null,d:oo,e:oo,f:ho,H:ao,I:lo,j:uo,L:co,m:fo,M:po,p:function(t){return i[+(t.getHours()>=12)]},q:function(t){return 1+~~(t.getMonth()/3)},Q:Uo,s:Vo,S:mo,u:go,U:yo,V:vo,w:bo,W:xo,x:null,X:null,y:_o,Y:wo,Z:So,"%":jo},x={a:function(t){return o[t.getUTCDay()]},A:function(t){return s[t.getUTCDay()]},b:function(t){return l[t.getUTCMonth()]},B:function(t){return a[t.getUTCMonth()]},c:null,d:Co,e:Co,f:No,H:Eo,I:ko,j:Ao,L:Do,m:To,M:Oo,p:function(t){return i[+(t.getUTCHours()>=12)]},q:function(t){return 1+~~(t.getUTCMonth()/3)},Q:Uo,s:Vo,S:Io,u:Ro,U:Fo,V:Mo,w:$o,W:Po,x:null,X:null,y:zo,Y:Lo,Z:Bo,"%":jo},_={a:function(t,e,n){var r=f.exec(e.slice(n));return r?(t.w=p[r[0].toLowerCase()],n+r[0].length):-1},A:function(t,e,n){var r=h.exec(e.slice(n));return r?(t.w=d[r[0].toLowerCase()],n+r[0].length):-1},b:function(t,e,n){var r=y.exec(e.slice(n));return r?(t.m=v[r[0].toLowerCase()],n+r[0].length):-1},B:function(t,e,n){var r=m.exec(e.slice(n));return r?(t.m=g[r[0].toLowerCase()],n+r[0].length):-1},c:function(t,n,r){return C(t,e,n,r)},d:Xs,e:Xs,f:no,H:Qs,I:Qs,j:Zs,L:eo,m:Ks,M:Js,p:function(t,e,n){var r=u.exec(e.slice(n));return r?(t.p=c[r[0].toLowerCase()],n+r[0].length):-1},q:Ys,Q:io,s:so,S:to,u:js,U:Us,V:Vs,w:Bs,W:Ws,x:function(t,e,r){return C(t,n,e,r)},X:function(t,e,n){return C(t,r,e,n)},y:Hs,Y:qs,Z:Gs,"%":ro};function w(t,e){return function(n){var r,i,s,o=[],a=-1,l=0,u=t.length;for(n instanceof Date||(n=new Date(+n));++a<u;)37===t.charCodeAt(a)&&(o.push(t.slice(l,a)),null!=(i=Is[r=t.charAt(++a)])?r=t.charAt(++a):i="e"===r?" ":"0",(s=e[r])&&(r=s(n,i)),o.push(r),l=a+1);return o.push(t.slice(l,a)),o.join("")}}function S(t,e){return function(n){var r,i,s=Es(1900,void 0,1);if(C(s,t,n+="",0)!=n.length)return null;if("Q"in s)return new Date(s.Q);if("s"in s)return new Date(1e3*s.s+("L"in s?s.L:0));if(e&&!("Z"in s)&&(s.Z=0),"p"in s&&(s.H=s.H%12+12*s.p),void 0===s.m&&(s.m="q"in s?s.q:0),"V"in s){if(s.V<1||s.V>53)return null;"w"in s||(s.w=1),"Z"in s?(i=(r=Cs(Es(s.y,0,1))).getUTCDay(),r=i>4||0===i?bi.ceil(r):bi(r),r=gi.offset(r,7*(s.V-1)),s.y=r.getUTCFullYear(),s.m=r.getUTCMonth(),s.d=r.getUTCDate()+(s.w+6)%7):(i=(r=Ss(Es(s.y,0,1))).getDay(),r=i>4||0===i?pi.ceil(r):pi(r),r=hi.offset(r,7*(s.V-1)),s.y=r.getFullYear(),s.m=r.getMonth(),s.d=r.getDate()+(s.w+6)%7)}else("W"in s||"U"in s)&&("w"in s||(s.w="u"in s?s.u%7:"W"in s?1:0),i="Z"in s?Cs(Es(s.y,0,1)).getUTCDay():Ss(Es(s.y,0,1)).getDay(),s.m=0,s.d="W"in s?(s.w+6)%7+7*s.W-(i+5)%7:s.w+7*s.U-(i+6)%7);return"Z"in s?(s.H+=s.Z/100|0,s.M+=s.Z%100,Cs(s)):Ss(s)}}function C(t,e,n,r){for(var i,s,o=0,a=e.length,l=n.length;o<a;){if(r>=l)return-1;if(37===(i=e.charCodeAt(o++))){if(i=e.charAt(o++),!(s=_[i in Is?e.charAt(o++):i])||(r=s(t,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return b.x=w(n,b),b.X=w(r,b),b.c=w(e,b),x.x=w(n,x),x.X=w(r,x),x.c=w(e,x),{format:function(t){var e=w(t+="",b);return e.toString=function(){return t},e},parse:function(t){var e=S(t+="",!1);return e.toString=function(){return t},e},utcFormat:function(t){var e=w(t+="",x);return e.toString=function(){return t},e},utcParse:function(t){var e=S(t+="",!0);return e.toString=function(){return t},e}}}var As,Ds,Ns,Ts,Os,Is={"-":"",_:" ",0:"0"},Rs=/^\s*\d+/,Fs=/^%/,Ms=/[\\^$*+?|[\]().{}]/g;function $s(t,e,n){var r=t<0?"-":"",i=(r?-t:t)+"",s=i.length;return r+(s<n?new Array(n-s+1).join(e)+i:i)}function Ps(t){return t.replace(Ms,"\\$&")}function zs(t){return new RegExp("^(?:"+t.map(Ps).join("|")+")","i")}function Ls(t){for(var e={},n=-1,r=t.length;++n<r;)e[t[n].toLowerCase()]=n;return e}function Bs(t,e,n){var r=Rs.exec(e.slice(n,n+1));return r?(t.w=+r[0],n+r[0].length):-1}function js(t,e,n){var r=Rs.exec(e.slice(n,n+1));return r?(t.u=+r[0],n+r[0].length):-1}function Us(t,e,n){var r=Rs.exec(e.slice(n,n+2));return r?(t.U=+r[0],n+r[0].length):-1}function Vs(t,e,n){var r=Rs.exec(e.slice(n,n+2));return r?(t.V=+r[0],n+r[0].length):-1}function Ws(t,e,n){var r=Rs.exec(e.slice(n,n+2));return r?(t.W=+r[0],n+r[0].length):-1}function qs(t,e,n){var r=Rs.exec(e.slice(n,n+4));return r?(t.y=+r[0],n+r[0].length):-1}function Hs(t,e,n){var r=Rs.exec(e.slice(n,n+2));return r?(t.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function Gs(t,e,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return r?(t.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function Ys(t,e,n){var r=Rs.exec(e.slice(n,n+1));return r?(t.q=3*r[0]-3,n+r[0].length):-1}function Ks(t,e,n){var r=Rs.exec(e.slice(n,n+2));return r?(t.m=r[0]-1,n+r[0].length):-1}function Xs(t,e,n){var r=Rs.exec(e.slice(n,n+2));return r?(t.d=+r[0],n+r[0].length):-1}function Zs(t,e,n){var r=Rs.exec(e.slice(n,n+3));return r?(t.m=0,t.d=+r[0],n+r[0].length):-1}function Qs(t,e,n){var r=Rs.exec(e.slice(n,n+2));return r?(t.H=+r[0],n+r[0].length):-1}function Js(t,e,n){var r=Rs.exec(e.slice(n,n+2));return r?(t.M=+r[0],n+r[0].length):-1}function to(t,e,n){var r=Rs.exec(e.slice(n,n+2));return r?(t.S=+r[0],n+r[0].length):-1}function eo(t,e,n){var r=Rs.exec(e.slice(n,n+3));return r?(t.L=+r[0],n+r[0].length):-1}function no(t,e,n){var r=Rs.exec(e.slice(n,n+6));return r?(t.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function ro(t,e,n){var r=Fs.exec(e.slice(n,n+1));return r?n+r[0].length:-1}function io(t,e,n){var r=Rs.exec(e.slice(n));return r?(t.Q=+r[0],n+r[0].length):-1}function so(t,e,n){var r=Rs.exec(e.slice(n));return r?(t.s=+r[0],n+r[0].length):-1}function oo(t,e){return $s(t.getDate(),e,2)}function ao(t,e){return $s(t.getHours(),e,2)}function lo(t,e){return $s(t.getHours()%12||12,e,2)}function uo(t,e){return $s(1+hi.count(Wi(t),t),e,3)}function co(t,e){return $s(t.getMilliseconds(),e,3)}function ho(t,e){return co(t,e)+"000"}function fo(t,e){return $s(t.getMonth()+1,e,2)}function po(t,e){return $s(t.getMinutes(),e,2)}function mo(t,e){return $s(t.getSeconds(),e,2)}function go(t){var e=t.getDay();return 0===e?7:e}function yo(t,e){return $s(fi.count(Wi(t)-1,t),e,2)}function vo(t,e){var n=t.getDay();return t=n>=4||0===n?mi(t):mi.ceil(t),$s(mi.count(Wi(t),t)+(4===Wi(t).getDay()),e,2)}function bo(t){return t.getDay()}function xo(t,e){return $s(pi.count(Wi(t)-1,t),e,2)}function _o(t,e){return $s(t.getFullYear()%100,e,2)}function wo(t,e){return $s(t.getFullYear()%1e4,e,4)}function So(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+$s(e/60|0,"0",2)+$s(e%60,"0",2)}function Co(t,e){return $s(t.getUTCDate(),e,2)}function Eo(t,e){return $s(t.getUTCHours(),e,2)}function ko(t,e){return $s(t.getUTCHours()%12||12,e,2)}function Ao(t,e){return $s(1+gi.count(Qi(t),t),e,3)}function Do(t,e){return $s(t.getUTCMilliseconds(),e,3)}function No(t,e){return Do(t,e)+"000"}function To(t,e){return $s(t.getUTCMonth()+1,e,2)}function Oo(t,e){return $s(t.getUTCMinutes(),e,2)}function Io(t,e){return $s(t.getUTCSeconds(),e,2)}function Ro(t){var e=t.getUTCDay();return 0===e?7:e}function Fo(t,e){return $s(vi.count(Qi(t)-1,t),e,2)}function Mo(t,e){var n=t.getUTCDay();return t=n>=4||0===n?xi(t):xi.ceil(t),$s(xi.count(Qi(t),t)+(4===Qi(t).getUTCDay()),e,2)}function $o(t){return t.getUTCDay()}function Po(t,e){return $s(bi.count(Qi(t)-1,t),e,2)}function zo(t,e){return $s(t.getUTCFullYear()%100,e,2)}function Lo(t,e){return $s(t.getUTCFullYear()%1e4,e,4)}function Bo(){return"+0000"}function jo(){return"%"}function Uo(t){return+t}function Vo(t){return Math.floor(+t/1e3)}function Wo(t,e,n){te(n=n||{})||$t("Invalid time multi-format specifier: "+n);const r=e(ei),i=e(ti),s=e(Jr),o=e(Xr),a=e(Kr),l=e(Yr),u=e(Gr),c=e(Hr),h=t(n[ni]||".%L"),d=t(n[ei]||":%S"),f=t(n[ti]||"%I:%M"),p=t(n[Jr]||"%I %p"),m=t(n[Xr]||n[Zr]||"%a %d"),g=t(n[Kr]||"%b %d"),y=t(n[Yr]||"%B"),v=t(n[Gr]||"%B"),b=t(n[Hr]||"%Y");return t=>(r(t)<t?h:i(t)<t?d:s(t)<t?f:o(t)<t?p:l(t)<t?a(t)<t?m:g:c(t)<t?u(t)<t?y:v:b)(t)}function qo(t){const e=br(t.format),n=br(t.utcFormat);return{timeFormat:t=>Ye(t)?e(t):Wo(e,is,t),utcFormat:t=>Ye(t)?n(t):Wo(n,ss,t),timeParse:br(t.parse),utcParse:br(t.utcParse)}}let Ho;function Go(){return Ho=qo({format:Ds,parse:Ns,utcFormat:Ts,utcParse:Os})}function Yo(t){return qo(ks(t))}function Ko(t){return arguments.length?Ho=Yo(t):Ho}As=ks({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),Ds=As.format,Ns=As.parse,Ts=As.utcFormat,Os=As.utcParse,Go();const Xo=(t,e)=>Fe({},t,e);function Zo(t,e){const n=t?Wr(t):qr(),r=e?Yo(e):Ko();return Xo(n,r)}function Qo(t,e){const n=arguments.length;return n&&2!==n&&$t("defaultLocale expects either zero or two arguments."),n?Xo(qr(t),Ko(e)):Xo(qr(),Ko())}function Jo(){return Vr(),Go(),Qo()}var ta=function(t,e,n,r){const i=yr((e=e||{}).type||"json");return i||$t("Unknown data format type: "+e.type),t=i(t,e),e.parse&&function(t,e,n,r){if(!t.length)return;const i=Ko();n=n||i.timeParse,r=r||i.utcParse;var s,o,a,l,u,c,h,d=t.columns||Object.keys(t[0]);for("auto"===e&&(e=Xn(t,d)),s=(d=Object.keys(e)).map((function(t){var i,s,o=e[t];if(o&&(o.startsWith("date:")||o.startsWith("utc:")))return("'"===(s=(i=o.split(/:(.+)?/,2))[1])[0]&&"'"===s[s.length-1]||'"'===s[0]&&'"'===s[s.length-1])&&(s=s.slice(1,-1)),("utc"===i[0]?r:n)(s);if(!Hn[o])throw Error("Illegal format pattern: "+t+":"+o);return Hn[o]})),l=0,c=t.length,h=d.length;l<c;++l)for(o=t[l],u=0;u<h;++u)o[a=d[u]]=s[u](o[a])}(t,e.parse,n,r),ze(t,"columns")&&delete t.columns,t},ea=function(t,e){return function(e){return{options:e||{},sanitize:jn,load:Bn,fileAccess:!1,file:Un(null),http:Wn(t)}}}("undefined"!=typeof fetch&&fetch),na={skip:!0};function ra(t,e,n,r,i,s){var o,a,l=Fe({},s,na);ke(n)||(n=Ie(n)),void 0===r?o=e=>t.touch(n(e)):ke(r)?(a=new Tn(null,r,i,!1),o=e=>{a.evaluate(e);const r=n(e),i=a.value;Sn(i)?t.pulse(r,i,s):t.update(r,i,l)}):o=e=>t.update(n(e),r,l),e.apply(o)}function ia(t,e,n,r,i,s){if(void 0===r)e.targets().add(n);else{const o=s||{},a=new Tn(null,function(t,e){return e=ke(e)?e:Ie(e),t?function(n,r){const i=e(n,r);return t.skip()||(t.skip(i!==this.value).value=i),i}:e}(n,r),i,!1);a.modified(o.force),a.rank=e.rank,e.targets().add(a),n&&(a.skip(!0),a.value=n.value,a.targets().add(n),t.connect(n,[a]))}}const sa={};function oa(t,e,n){this.dataflow=t,this.stamp=null==e?-1:e,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}const aa=oa.prototype;function la(t,e){return t?(n,r)=>t(n,r)&&e(n,r):e}function ua(t,e){var n=[];return cn(t,e,t=>n.push(t)),n}function ca(t,e){var n={};return t.visit(e,(function(t){n[gn(t)]=1})),t=>n[gn(t)]?null:t}function ha(t,e,n,r){var i,s,o,a,l,u=this,c=0;for(this.dataflow=t,this.stamp=e,this.fields=null,this.encode=r||null,this.pulses=n,o=0,a=n.length;o<a;++o)if((i=n[o]).stamp===e){if(i.fields)for(l in s=u.fields||(u.fields={}),i.fields)s[l]=1;i.changed(u.ADD)&&(c|=u.ADD),i.changed(u.REM)&&(c|=u.REM),i.changed(u.MOD)&&(c|=u.MOD)}this.changes=c}aa.StopPropagation=sa,aa.ADD=1,aa.REM=2,aa.MOD=4,aa.ADD_REM=3,aa.ADD_MOD=5,aa.ALL=7,aa.REFLOW=8,aa.SOURCE=16,aa.NO_SOURCE=32,aa.NO_FIELDS=64,aa.fork=function(t){return new oa(this.dataflow).init(this,t)},aa.clone=function(){const t=this.fork(7);return t.add=t.add.slice(),t.rem=t.rem.slice(),t.mod=t.mod.slice(),t.source&&(t.source=t.source.slice()),t.materialize(23)},aa.addAll=function(){let t=this;return t.source&&t.source.length!==t.add.length?(t=new oa(this.dataflow).init(this),t.add=t.source,t):t},aa.init=function(t,e){const n=this;return n.stamp=t.stamp,n.encode=t.encode,!t.fields||64&e||(n.fields=t.fields),1&e?(n.addF=t.addF,n.add=t.add):(n.addF=null,n.add=[]),2&e?(n.remF=t.remF,n.rem=t.rem):(n.remF=null,n.rem=[]),4&e?(n.modF=t.modF,n.mod=t.mod):(n.modF=null,n.mod=[]),32&e?(n.srcF=null,n.source=null):(n.srcF=t.srcF,n.source=t.source,t.cleans&&(n.cleans=t.cleans)),n},aa.runAfter=function(t){this.dataflow.runAfter(t)},aa.changed=function(t){var e=t||7;return 1&e&&this.add.length||2&e&&this.rem.length||4&e&&this.mod.length},aa.reflow=function(t){if(t)return this.fork(7).reflow();var e=this.add.length,n=this.source&&this.source.length;return n&&n!==e&&(this.mod=this.source,e&&this.filter(4,ca(this,1))),this},aa.clean=function(t){return arguments.length?(this.cleans=!!t,this):this.cleans},aa.modifies=function(t){var e=this.fields||(this.fields={});return Jt(t)?t.forEach(t=>e[t]=!0):e[t]=!0,this},aa.modified=function(t,e){var n=this.fields;return!(!e&&!this.mod.length||!n)&&(arguments.length?Jt(t)?t.some(t=>n[t]):n[t]:!!n)},aa.filter=function(t,e){var n=this;return 1&t&&(n.addF=la(n.addF,e)),2&t&&(n.remF=la(n.remF,e)),4&t&&(n.modF=la(n.modF,e)),16&t&&(n.srcF=la(n.srcF,e)),n},aa.materialize=function(t){var e=this;return 1&(t=t||7)&&e.addF&&(e.add=ua(e.add,e.addF),e.addF=null),2&t&&e.remF&&(e.rem=ua(e.rem,e.remF),e.remF=null),4&t&&e.modF&&(e.mod=ua(e.mod,e.modF),e.modF=null),16&t&&e.srcF&&(e.source=e.source.filter(e.srcF),e.srcF=null),e},aa.visit=function(t,e){var n,r,i=this,s=e;return 16&t?(cn(i.source,i.srcF,s),i):(1&t&&cn(i.add,i.addF,s),2&t&&cn(i.rem,i.remF,s),4&t&&cn(i.mod,i.modF,s),8&t&&(n=i.source)&&((r=i.add.length+i.mod.length)===n.length||cn(n,r?ca(i,5):i.srcF,s)),i)};var da=Ue(ha,oa);function fa(t){return t.error("Dataflow already running. Use runAsync() to chain invocations."),t}da.fork=function(t){var e=new oa(this.dataflow).init(this,t&this.NO_FIELDS);return void 0!==t&&(t&e.ADD&&this.visit(e.ADD,(function(t){return e.add.push(t)})),t&e.REM&&this.visit(e.REM,(function(t){return e.rem.push(t)})),t&e.MOD&&this.visit(e.MOD,(function(t){return e.mod.push(t)}))),e},da.changed=function(t){return this.changes&t},da.modified=function(t){var e=this,n=e.fields;return n&&e.changes&e.MOD?Jt(t)?t.some((function(t){return n[t]})):n[t]:0},da.filter=function(){$t("MultiPulse does not support filtering.")},da.materialize=function(){$t("MultiPulse does not support materialization.")},da.visit=function(t,e){var n=this,r=n.pulses,i=r.length,s=0;if(t&n.SOURCE)for(;s<i;++s)r[s].visit(t,e);else for(;s<i;++s)r[s].stamp===n.stamp&&r[s].visit(t,e);return n};var pa={skip:!1,force:!1};function ma(t,e,n,r){var i,s,o;for(i=t[n];n>e&&r(i,s=t[o=n-1>>1])<0;)t[n]=s,n=o;return t[n]=i}function ga(){this.logger(Qt()),this.logLevel(Yt),this._clock=0,this._rank=0,this._locale=Qo();try{this._loader=ea()}catch(n){}var t,e;this._touched=hn(Bt),this._input={},this._pulse=null,this._heap=(t=(t,e)=>t.qrank-e.qrank,e=[],{clear:()=>e=[],size:()=>e.length,peek:()=>e[0],push:n=>(e.push(n),ma(e,0,e.length-1,t)),pop:()=>{var n,r=e.pop();return e.length?(n=e[0],e[0]=r,function(t,e,n){for(var r,i=e,s=t.length,o=t[e],a=1+(e<<1);a<s;)(r=a+1)<s&&n(t[a],t[r])>=0&&(a=r),t[e]=t[a],a=1+((e=a)<<1);t[e]=o,ma(t,i,e,n)}(e,0,t)):n=r,n}}),this._postrun=[]}var ya=ga.prototype;function va(t){return function(){return this._log[t].apply(this,arguments)}}function ba(t,e){Tn.call(this,t,null,e)}ya.stamp=function(){return this._clock},ya.loader=function(t){return arguments.length?(this._loader=t,this):this._loader},ya.locale=function(t){return arguments.length?(this._locale=t,this):this._locale},ya.cleanThreshold=1e4,ya.add=function(t,e,n,r){var i,s=1;return t instanceof Tn?i=t:t&&t.prototype instanceof Tn?i=new t:ke(t)?i=new Tn(null,t):(s=0,i=new Tn(t,e)),this.rank(i),s&&(r=n,n=e),n&&this.connect(i,i.parameters(n,r)),this.touch(i),i},ya.connect=function(t,e){var n,r,i=t.rank;for(n=0,r=e.length;n<r;++n)if(i<e[n].rank)return void this.rerank(t)},ya.rank=function(t){t.rank=++this._rank},ya.rerank=function(t){for(var e,n,r,i=[t];i.length;)if(this.rank(e=i.pop()),n=e._targets)for(r=n.length;--r>=0;)i.push(e=n[r]),e===t&&$t("Cycle detected in dataflow graph.")},ya.pulse=function(t,e,n){this.touch(t,n||pa);var r=new oa(this,this._clock+(this._pulse?0:1)),i=t.pulse&&t.pulse.source||[];return r.target=t,this._input[t.id]=e.pulse(r,i),this},ya.touch=function(t,e){var n=e||pa;return this._pulse?this._enqueue(t):this._touched.add(t),n.skip&&t.skip(!0),this},ya.update=function(t,e,n){var r=n||pa;return(t.set(e)||r.force)&&this.touch(t,r),this},ya.changeset=Cn,ya.ingest=function(t,e,n){return e=this.parse(e,n),this.pulse(t,this.changeset().insert(e))},ya.parse=function(t,e){const n=this.locale();return ta(t,e,n.timeParse,n.utcParse)},ya.preload=async function(t,e,n){const r=this,i=r._pending||function(t){var e,n=new Promise((function(t){e=t}));return n.requests=0,n.done=function(){0==--n.requests&&(t._pending=null,e(t))},t._pending=n}(r);i.requests+=1;const s=await r.request(e,n);return r.pulse(t,r.changeset().remove(Wt).insert(s.data||[])),i.done(),s},ya.request=async function(t,e){const n=this;let r,i=0;try{r=await n.loader().load(t,{context:"dataflow",response:vr(e&&e.type)});try{r=n.parse(r,e)}catch(s){i=-2,n.warn("Data ingestion failed",t,s)}}catch(s){i=-1,n.warn("Loading failed",t,s)}return{data:r,status:i}},ya.events=function(t,e,n,r){for(var i,s=this,o=Mn(n,r),a=function(t){t.dataflow=s;try{o.receive(t)}catch(e){s.error(e)}finally{s.run()}},l=0,u=(i="string"==typeof t&&"undefined"!=typeof document?document.querySelectorAll(t):Ce(t)).length;l<u;++l)i[l].addEventListener(e,a);return o},ya.on=function(t,e,n,r,i){return(t instanceof Tn?ia:ra)(this,t,e,n,r,i),this},ya.evaluate=async function(t,e,n){const r=this,i=[];if(r._pulse)return fa(r);if(r._pending&&await r._pending,e&&await dn(r,e),!r._touched.length)return r.debug("Dataflow invoked, but nothing to do."),r;const s=++r._clock;r._pulse=new oa(r,s,t),r._touched.forEach(t=>r._enqueue(t,!0)),r._touched=hn(Bt);let o,a,l,u=0;try{for(;r._heap.size()>0;)o=r._heap.pop(),o.rank===o.qrank?(a=o.run(r._getPulse(o,t)),a.then?a=await a:a.async&&(i.push(a.async),a=sa),a!==sa&&o._targets&&o._targets.forEach(t=>r._enqueue(t)),++u):r._enqueue(o,!0)}catch(c){r._heap.clear(),l=c}if(r._input={},r._pulse=null,r.debug(`Pulse ${s}: ${u} operators`),l&&(r._postrun=[],r.error(l)),r._postrun.length){const t=r._postrun.sort((t,e)=>e.priority-t.priority);r._postrun=[];for(let e=0;e<t.length;++e)await dn(r,t[e].callback)}return n&&await dn(r,n),i.length&&Promise.all(i).then(t=>r.runAsync(null,()=>{t.forEach(t=>{try{t(r)}catch(c){r.error(c)}})})),r},ya.run=function(t,e,n){return this._pulse?fa(this):(this.evaluate(t,e,n),this)},ya.runAsync=async function(t,e,n){for(;this._running;)await this._running;const r=()=>this._running=null;return(this._running=this.evaluate(t,e,n)).then(r,r),this._running},ya.runAfter=function(t,e,n){if(this._pulse||e)this._postrun.push({priority:n||0,callback:t});else try{t(this)}catch(r){this.error(r)}},ya._enqueue=function(t,e){var n=t.stamp<this._clock;n&&(t.stamp=this._clock),(n||e)&&(t.qrank=t.rank,this._heap.push(t))},ya._getPulse=function(t,e){var n=t.source,r=this._clock;return n&&Jt(n)?new ha(this,r,n.map(t=>t.pulse),e):this._input[t.id]||function(t,e){return e&&e.stamp===t.stamp?e:(t=t.fork(),e&&e!==sa&&(t.source=e.source),t)}(this._pulse,n&&n.pulse)},ya.logger=function(t){return arguments.length?(this._log=t,this):this._log},ya.error=va("error"),ya.warn=va("warn"),ya.info=va("info"),ya.debug=va("debug"),ya.logLevel=va("level");var xa=Ue(ba,Tn);xa.run=function(t){return t.stamp<this.stamp?t.StopPropagation:(this.skip()?this.skip(!1):e=this.evaluate(t),(e=e||t).then?e=e.then(t=>this.pulse=t):e!==t.StopPropagation&&(this.pulse=e),e);var e},xa.evaluate=function(t){var e=this.marshall(t.stamp),n=this.transform(e,t);return e.clear(),n},xa.transform=function(){};var _a={};function wa(t){var e=Sa(t);return e&&e.Definition||null}function Sa(t){return t=t&&t.toLowerCase(),ze(_a,t)?_a[t]:null}function Ca(t){return t&&t.length?1===t.length?t[0]:(e=t,function(t){for(var n=e.length,r=1,i=String(e[0](t));r<n;++r)i+="|"+e[r](t);return i}):function(){return""};var e}function Ea(t,e,n){return n||t+(e?"_"+e:"")}const ka=()=>{},Aa={init:ka,add:ka,rem:ka,idx:0},Da={values:{init:t=>t.cell.store=!0,value:t=>t.cell.data.values(),idx:-1},count:{value:t=>t.cell.num},__count__:{value:t=>t.missing+t.valid},missing:{value:t=>t.missing},valid:{value:t=>t.valid},sum:{init:t=>t.sum=0,value:t=>t.sum,add:(t,e)=>t.sum+=+e,rem:(t,e)=>t.sum-=e},product:{init:t=>t.product=1,value:t=>t.valid?t.product:void 0,add:(t,e)=>t.product*=e,rem:(t,e)=>t.product/=e},mean:{init:t=>t.mean=0,value:t=>t.valid?t.mean:void 0,add:(t,e)=>(t.mean_d=e-t.mean,t.mean+=t.mean_d/t.valid),rem:(t,e)=>(t.mean_d=e-t.mean,t.mean-=t.valid?t.mean_d/t.valid:t.mean)},average:{value:t=>t.valid?t.mean:void 0,req:["mean"],idx:1},variance:{init:t=>t.dev=0,value:t=>t.valid>1?t.dev/(t.valid-1):void 0,add:(t,e)=>t.dev+=t.mean_d*(e-t.mean),rem:(t,e)=>t.dev-=t.mean_d*(e-t.mean),req:["mean"],idx:1},variancep:{value:t=>t.valid>1?t.dev/t.valid:void 0,req:["variance"],idx:2},stdev:{value:t=>t.valid>1?Math.sqrt(t.dev/(t.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:t=>t.valid>1?Math.sqrt(t.dev/t.valid):void 0,req:["variance"],idx:2},stderr:{value:t=>t.valid>1?Math.sqrt(t.dev/(t.valid*(t.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:t=>t.cell.data.distinct(t.get),req:["values"],idx:3},ci0:{value:t=>t.cell.data.ci0(t.get),req:["values"],idx:3},ci1:{value:t=>t.cell.data.ci1(t.get),req:["values"],idx:3},median:{value:t=>t.cell.data.q2(t.get),req:["values"],idx:3},q1:{value:t=>t.cell.data.q1(t.get),req:["values"],idx:3},q3:{value:t=>t.cell.data.q3(t.get),req:["values"],idx:3},min:{init:t=>t.min=void 0,value:t=>t.min=Number.isNaN(t.min)?t.cell.data.min(t.get):t.min,add:(t,e)=>{(e<t.min||void 0===t.min)&&(t.min=e)},rem:(t,e)=>{e<=t.min&&(t.min=NaN)},req:["values"],idx:4},max:{init:t=>t.max=void 0,value:t=>t.max=Number.isNaN(t.max)?t.cell.data.max(t.get):t.max,add:(t,e)=>{(e>t.max||void 0===t.max)&&(t.max=e)},rem:(t,e)=>{e>=t.max&&(t.max=NaN)},req:["values"],idx:4},argmin:{init:t=>t.argmin=void 0,value:t=>t.argmin||t.cell.data.argmin(t.get),add:(t,e,n)=>{e<t.min&&(t.argmin=n)},rem:(t,e)=>{e<=t.min&&(t.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:t=>t.argmax=void 0,value:t=>t.argmax||t.cell.data.argmax(t.get),add:(t,e,n)=>{e>t.max&&(t.argmax=n)},rem:(t,e)=>{e>=t.max&&(t.argmax=void 0)},req:["max","values"],idx:3}},Na=Object.keys(Da);function Ta(t,e){return Da[t](e)}function Oa(t,e){return t.idx-e.idx}function Ia(){this.valid=0,this.missing=0,this._ops.forEach(t=>t.init(this))}function Ra(t,e){null!=t&&""!==t?t==t&&(++this.valid,this._ops.forEach(n=>n.add(this,t,e))):++this.missing}function Fa(t,e){null!=t&&""!==t?t==t&&(--this.valid,this._ops.forEach(n=>n.rem(this,t,e))):--this.missing}function Ma(t){return this._out.forEach(e=>t[e.out]=e.value(this)),t}function $a(t,e){var n=e||jt,r=function(t){const e={};t.forEach(t=>e[t.name]=t);const n=t=>{t.req&&t.req.forEach(t=>{e[t]||n(e[t]=Da[t]())})};return t.forEach(n),Object.values(e).sort(Oa)}(t),i=t.slice().sort(Oa);function s(t){this._ops=r,this._out=i,this.cell=t,this.init()}return s.prototype.init=Ia,s.prototype.add=Ra,s.prototype.rem=Fa,s.prototype.set=Ma,s.prototype.get=n,s.fields=t.map(t=>t.out),s}Na.forEach(t=>{Da[t]=function(t,e){return n=>Fe({name:t,out:n||t},Aa,e)}(t,Da[t])});var Pa=function*(t,e){if(null==e)for(let n of t)null!=n&&""!==n&&(n=+n)>=n&&(yield n);else{let n=-1;for(let r of t)r=e(r,++n,t),null!=r&&""!==r&&(r=+r)>=r&&(yield r)}};function za(t,e){let n;if(void 0===e)for(const r of t)null!=r&&(n<r||void 0===n&&r>=r)&&(n=r);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(n<i||void 0===n&&i>=i)&&(n=i)}return n}function La(t,e){let n;if(void 0===e)for(const r of t)null!=r&&(n>r||void 0===n&&r>=r)&&(n=r);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}function Ba(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}var ja=function(t){return null===t?NaN:+t};function Ua(t,e,n){if(r=(t=Float64Array.from(function*(t,e){if(void 0===e)for(let n of t)null!=n&&(n=+n)>=n&&(yield n);else{let n=-1;for(let r of t)null!=(r=e(r,++n,t))&&(r=+r)>=r&&(yield r)}}(t,n))).length){if((e=+e)<=0||r<2)return La(t);if(e>=1)return za(t);var r,i=(r-1)*e,s=Math.floor(i),o=za(function t(e,n,r=0,i=e.length-1,s=ds){for(;i>r;){if(i-r>600){const o=i-r+1,a=n-r+1,l=Math.log(o),u=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*u*(o-u)/o)*(a-o/2<0?-1:1);t(e,n,Math.max(r,Math.floor(n-a*u/o+c)),Math.min(i,Math.floor(n+(o-a)*u/o+c)),s)}const o=e[n];let a=r,l=i;for(Ba(e,r,n),s(e[i],o)>0&&Ba(e,r,i);a<l;){for(Ba(e,a,l),++a,--l;s(e[a],o)<0;)++a;for(;s(e[l],o)>0;)--l}0===s(e[r],o)?Ba(e,r,l):(++l,Ba(e,l,i)),l<=n&&(r=l+1),n<=l&&(i=l-1)}return e}(t,s).subarray(0,s+1));return o+(La(t.subarray(s+1))-o)*(i-s)}}var Va=function(t,e,n){var r=Float64Array.from(Pa(t,n));return r.sort(ds),e.map(t=>function(t,e,n=ja){if(r=t.length){if((e=+e)<=0||r<2)return+n(t[0],0,t);if(e>=1)return+n(t[r-1],r-1,t);var r,i=(r-1)*e,s=Math.floor(i),o=+n(t[s],s,t);return o+(+n(t[s+1],s+1,t)-o)*(i-s)}}(r,t))},Wa=function(t,e){return Va(t,[.25,.5,.75],e)},qa=function(t,e){var n=t.length,r=function(t,e){const n=function(t,e){let n,r=0,i=0,s=0;if(void 0===e)for(let o of t)null!=o&&(o=+o)>=o&&(n=o-i,i+=n/++r,s+=n*(o-i));else{let o=-1;for(let a of t)null!=(a=e(a,++o,t))&&(a=+a)>=a&&(n=a-i,i+=n/++r,s+=n*(a-i))}if(r>1)return s/(r-1)}(t,e);return n?Math.sqrt(n):n}(t,e),i=Wa(t,e);return 1.06*(r=Math.min(r,(i[2]-i[0])/1.34)||r||Math.abs(i[0])||1)*Math.pow(n,-.2)},Ha=function(t){var e,n,r,i,s,o,a,l=t.maxbins||20,u=t.base||10,c=Math.log(u),h=t.divide||[5,2],d=t.extent[0],f=t.extent[1],p=t.span||f-d||Math.abs(d)||1;if(t.step)e=t.step;else if(t.steps){for(i=p/l,s=0,o=t.steps.length;s<o&&t.steps[s]<i;++s);e=t.steps[Math.max(0,s-1)]}else{for(n=Math.ceil(Math.log(l)/c),r=t.minstep||0,e=Math.max(r,Math.pow(u,Math.round(Math.log(p)/c)-n));Math.ceil(p/e)>l;)e*=u;for(s=0,o=h.length;s<o;++s)(i=e/h[s])>=r&&p/i<=l&&(e=i)}return i=Math.log(e),a=Math.pow(u,-(i>=0?0:1+~~(-i/c))-1),(t.nice||void 0===t.nice)&&(d=d<(i=Math.floor(d/e+a)*e)?i-e:i,f=Math.ceil(f/e)*e),{start:d,stop:f===d?d+e:f,step:e}},Ga=Math.random;function Ya(t){Ga=t}var Ka=function(t,e,n,r){if(!t.length)return[void 0,void 0];var i,s,o,a,l=Float64Array.from(Pa(t,r)),u=l.length,c=e;for(o=0,a=Array(c);o<c;++o){for(i=0,s=0;s<u;++s)i+=l[~~(Ga()*u)];a[o]=i/u}return a.sort(ds),[Ua(a,n/2),Ua(a,1-n/2)]},Xa=function(t,e,n,r){r=r||(t=>t);let i,s=0,o=1,a=t.length,l=new Float64Array(a),u=r(t[0]),c=u,h=u+e;for(;o<a;++o){if(i=r(t[o]),i>=h){for(c=(u+c)/2;s<o;++s)l[s]=c;h=i+e,u=i}c=i}for(c=(u+c)/2;s<o;++s)l[s]=c;return n?function(t,e){let n,r,i=t.length,s=0,o=1;for(;t[s]===t[o];)++o;for(;o<i;){for(n=o+1;t[o]===t[n];)++n;if(t[o]-t[o-1]<e){for(r=o+(s+n-o-o>>1);r<o;)t[r++]=t[o];for(;r>o;)t[r--]=t[s]}s=o,o=n}return t}(l,e+e/4):l},Za=function(t){return function(){return(t=(1103515245*t+12345)%2147483647)/2147483647}},Qa=function(t,e){null==e&&(e=t,t=0);var n,r,i,s={min:function(t){return arguments.length?(i=r-(n=t||0),s):n},max:function(t){return arguments.length?(i=(r=t||0)-n,s):r},sample:function(){return n+Math.floor(i*Ga())},pdf:function(t){return t===Math.floor(t)&&t>=n&&t<r?1/i:0},cdf:function(t){var e=Math.floor(t);return e<n?0:e>=r?1:(e-n+1)/i},icdf:function(t){return t>=0&&t<=1?n-1+Math.floor(t*i):NaN}};return s.min(t).max(e)};const Ja=Math.sqrt(2*Math.PI),tl=Math.SQRT2;let el=NaN;function nl(t,e){t=t||0,e=null==e?1:e;let n,r,i=0,s=0;if(el==el)i=el,el=NaN;else{do{i=2*Ga()-1,s=2*Ga()-1,n=i*i+s*s}while(0===n||n>1);r=Math.sqrt(-2*Math.log(n)/n),i*=r,el=s*r}return t+i*e}function rl(t,e,n){const r=(t-(e||0))/(n=null==n?1:n);return Math.exp(-.5*r*r)/(n*Ja)}function il(t,e,n){let r,i=(t-(e=e||0))/(n=null==n?1:n),s=Math.abs(i);if(s>37)r=0;else{let t,e=Math.exp(-s*s/2);s<7.07106781186547?(t=.0352624965998911*s+.700383064443688,t=t*s+6.37396220353165,t=t*s+33.912866078383,t=t*s+112.079291497871,t=t*s+221.213596169931,t=t*s+220.206867912376,r=e*t,t=.0883883476483184*s+1.75566716318264,t=t*s+16.064177579207,t=t*s+86.7807322029461,t=t*s+296.564248779674,t=t*s+637.333633378831,t=t*s+793.826512519948,t=t*s+440.413735824752,r/=t):(t=s+.65,t=s+4/t,t=s+3/t,t=s+2/t,t=s+1/t,r=e/t/2.506628274631)}return i>0?1-r:r}function sl(t,e,n){return t<0||t>1?NaN:(e||0)+(null==n?1:n)*tl*function(t){let e,n=-Math.log((1-t)*(1+t));return n<6.25?(n-=3.125,e=-364441206401782e-35,e=e*n-16850591381820166e-35,e=128584807152564e-32+e*n,e=11157877678025181e-33+e*n,e=e*n-1333171662854621e-31,e=20972767875968562e-33+e*n,e=6637638134358324e-30+e*n,e=e*n-4054566272975207e-29,e=e*n-8151934197605472e-29,e=26335093153082323e-28+e*n,e=e*n-12975133253453532e-27,e=e*n-5415412054294628e-26,e=1.0512122733215323e-9+e*n,e=e*n-4.112633980346984e-9,e=e*n-2.9070369957882005e-8,e=4.2347877827932404e-7+e*n,e=e*n-13654692000834679e-22,e=e*n-13882523362786469e-21,e=.00018673420803405714+e*n,e=e*n-.000740702534166267,e=e*n-.006033670871430149,e=.24015818242558962+e*n,e=1.6536545626831027+e*n):n<16?(n=Math.sqrt(n)-3.25,e=2.2137376921775787e-9,e=9.075656193888539e-8+e*n,e=e*n-2.7517406297064545e-7,e=1.8239629214389228e-8+e*n,e=15027403968909828e-22+e*n,e=e*n-4013867526981546e-21,e=29234449089955446e-22+e*n,e=12475304481671779e-21+e*n,e=e*n-47318229009055734e-21,e=6828485145957318e-20+e*n,e=24031110387097894e-21+e*n,e=e*n-.0003550375203628475,e=.0009532893797373805+e*n,e=e*n-.0016882755560235047,e=.002491442096107851+e*n,e=e*n-.003751208507569241,e=.005370914553590064+e*n,e=1.0052589676941592+e*n,e=3.0838856104922208+e*n):Number.isFinite(n)?(n=Math.sqrt(n)-5,e=-27109920616438573e-27,e=e*n-2.555641816996525e-10,e=1.5076572693500548e-9+e*n,e=e*n-3.789465440126737e-9,e=7.61570120807834e-9+e*n,e=e*n-1.496002662714924e-8,e=2.914795345090108e-8+e*n,e=e*n-6.771199775845234e-8,e=2.2900482228026655e-7+e*n,e=e*n-9.9298272942317e-7,e=4526062597223154e-21+e*n,e=e*n-1968177810553167e-20,e=7599527703001776e-20+e*n,e=e*n-.00021503011930044477,e=e*n-.00013871931833623122,e=1.0103004648645344+e*n,e=4.849906401408584+e*n):e=1/0,e*t}(2*t-1)}var ol=function(t,e){var n,r,i={mean:function(t){return arguments.length?(n=t||0,i):n},stdev:function(t){return arguments.length?(r=null==t?1:t,i):r},sample:()=>nl(n,r),pdf:t=>rl(t,n,r),cdf:t=>il(t,n,r),icdf:t=>sl(t,n,r)};return i.mean(t).stdev(e)},al=function(t,e){var n=ol(),r={},i=0;return r.data=function(n){return arguments.length?(t=n,i=n?n.length:0,r.bandwidth(e)):t},r.bandwidth=function(n){return arguments.length?(!(e=n)&&t&&(e=qa(t)),r):e},r.sample=function(){return t[~~(Ga()*i)]+e*n.sample()},r.pdf=function(r){for(var s=0,o=0;o<i;++o)s+=n.pdf((r-t[o])/e);return s/e/i},r.cdf=function(r){for(var s=0,o=0;o<i;++o)s+=n.cdf((r-t[o])/e);return s/i},r.icdf=function(){throw Error("KDE icdf not supported.")},r.data(t)};function ll(t,e){return t=t||0,e=null==e?1:e,Math.exp(t+nl()*e)}function ul(t,e,n){if(t<=0)return 0;e=e||0,n=null==n?1:n;const r=(Math.log(t)-e)/n;return Math.exp(-.5*r*r)/(n*Ja*t)}function cl(t,e,n){return il(Math.log(t),e,n)}function hl(t,e,n){return Math.exp(sl(t,e,n))}var dl=function(t,e){var n,r,i={mean:function(t){return arguments.length?(n=t||0,i):n},stdev:function(t){return arguments.length?(r=null==t?1:t,i):r},sample:()=>ll(n,r),pdf:t=>ul(t,n,r),cdf:t=>cl(t,n,r),icdf:t=>hl(t,n,r)};return i.mean(t).stdev(e)},fl=function(t,e){var n,r={},i=0;function s(t){var e,n=[],r=0;for(e=0;e<i;++e)r+=n[e]=null==t[e]?1:+t[e];for(e=0;e<i;++e)n[e]/=r;return n}return r.weights=function(t){return arguments.length?(n=s(e=t||[]),r):e},r.distributions=function(n){return arguments.length?(n?(i=n.length,t=n):(i=0,t=[]),r.weights(e)):t},r.sample=function(){for(var e=Ga(),r=t[i-1],s=n[0],o=0;o<i-1;s+=n[++o])if(e<s){r=t[o];break}return r.sample()},r.pdf=function(e){for(var r=0,s=0;s<i;++s)r+=n[s]*t[s].pdf(e);return r},r.cdf=function(e){for(var r=0,s=0;s<i;++s)r+=n[s]*t[s].cdf(e);return r},r.icdf=function(){throw Error("Mixture icdf not supported.")},r.distributions(t).weights(e)};function pl(t,e){return null==e&&(e=null==t?1:t,t=0),t+(e-t)*Ga()}function ml(t,e,n){return null==n&&(n=null==e?1:e,e=0),t>=e&&t<=n?1/(n-e):0}function gl(t,e,n){return null==n&&(n=null==e?1:e,e=0),t<e?0:t>n?1:(t-e)/(n-e)}function yl(t,e,n){return null==n&&(n=null==e?1:e,e=0),t>=0&&t<=1?e+t*(n-e):NaN}var vl=function(t,e){var n,r,i={min:function(t){return arguments.length?(n=t||0,i):n},max:function(t){return arguments.length?(r=null==t?1:t,i):r},sample:()=>pl(n,r),pdf:t=>ml(t,n,r),cdf:t=>gl(t,n,r),icdf:t=>yl(t,n,r)};return null==e&&(e=null==t?1:t,t=0),i.min(t).max(e)},bl=function(t,e,n,r){const i=r-t*t,s=Math.abs(i)<1e-24?0:(n-t*e)/i;return[e-s*t,s]};function xl(t,e,n,r){t=t.filter(t=>{let r=e(t),i=n(t);return null!=r&&(r=+r)>=r&&null!=i&&(i=+i)>=i}),r&&t.sort((t,n)=>e(t)-e(n));const i=t.length,s=new Float64Array(i),o=new Float64Array(i);let a,l,u,c=0,h=0,d=0;for(u of t)s[c]=a=+e(u),o[c]=l=+n(u),++c,h+=(a-h)/c,d+=(l-d)/c;for(c=0;c<i;++c)s[c]-=h,o[c]-=d;return[s,o,h,d]}function _l(t,e,n,r){let i,s,o=-1;for(let a of t)i=e(a),s=n(a),null!=i&&(i=+i)>=i&&null!=s&&(s=+s)>=s&&r(i,s,++o)}var wl=function(t,e,n,r,i){let s=0,o=0;return _l(t,e,n,(t,e)=>{const n=e-i(t),a=e-r;s+=n*n,o+=a*a}),1-s/o},Sl=function(t,e,n){let r=0,i=0,s=0,o=0,a=0;_l(t,e,n,(t,e)=>{++a,r+=(t-r)/a,i+=(e-i)/a,s+=(t*e-s)/a,o+=(t*t-o)/a});const l=bl(r,i,s,o),u=t=>l[0]+l[1]*t;return{coef:l,predict:u,rSquared:wl(t,e,n,i,u)}},Cl=function(t,e,n){let r=0,i=0,s=0,o=0,a=0;_l(t,e,n,(t,e)=>{++a,t=Math.log(t),r+=(t-r)/a,i+=(e-i)/a,s+=(t*e-s)/a,o+=(t*t-o)/a});const l=bl(r,i,s,o),u=t=>l[0]+l[1]*Math.log(t);return{coef:l,predict:u,rSquared:wl(t,e,n,i,u)}},El=function(t,e,n){const[r,i,s,o]=xl(t,e,n);let a,l,u,c=0,h=0,d=0,f=0,p=0;_l(t,e,n,(t,e)=>{a=r[p++],l=Math.log(e),u=a*e,c+=(e*l-c)/p,h+=(u-h)/p,d+=(u*l-d)/p,f+=(a*u-f)/p});const[m,g]=bl(h/o,c/o,d/o,f/o),y=t=>Math.exp(m+g*(t-s));return{coef:[Math.exp(m-g*s),g],predict:y,rSquared:wl(t,e,n,o,y)}},kl=function(t,e,n){let r=0,i=0,s=0,o=0,a=0,l=0;_l(t,e,n,(t,e)=>{const n=Math.log(t),u=Math.log(e);++l,r+=(n-r)/l,i+=(u-i)/l,s+=(n*u-s)/l,o+=(n*n-o)/l,a+=(e-a)/l});const u=bl(r,i,s,o),c=t=>u[0]*Math.pow(t,u[1]);return u[0]=Math.exp(u[0]),{coef:u,predict:c,rSquared:wl(t,e,n,a,c)}},Al=function(t,e,n){const[r,i,s,o]=xl(t,e,n),a=r.length;let l,u,c,h,d=0,f=0,p=0,m=0,g=0;for(l=0;l<a;)u=r[l],c=i[l++],h=u*u,d+=(h-d)/l,f+=(h*u-f)/l,p+=(h*h-p)/l,m+=(u*c-m)/l,g+=(h*c-g)/l;const y=p-d*d,v=d*y-f*f,b=(g*d-m*f)/v,x=(m*y-g*f)/v,_=-b*d,w=t=>b*(t-=s)*t+x*t+_+o;return{coef:[_-x*s+b*s*s+o,x-2*b*s,b],predict:w,rSquared:wl(t,e,n,o,w)}},Dl=function(t,e,n,r){if(1===r)return Sl(t,e,n);if(2===r)return Al(t,e,n);const[i,s,o,a]=xl(t,e,n),l=i.length,u=[],c=[],h=r+1;let d,f,p,m,g;for(d=0;d<h;++d){for(p=0,m=0;p<l;++p)m+=Math.pow(i[p],d)*s[p];for(u.push(m),g=new Float64Array(h),f=0;f<h;++f){for(p=0,m=0;p<l;++p)m+=Math.pow(i[p],d+f);g[f]=m}c.push(g)}c.push(u);const y=function(t){const e=t.length-1,n=[];let r,i,s,o,a;for(r=0;r<e;++r){for(o=r,i=r+1;i<e;++i)Math.abs(t[r][i])>Math.abs(t[r][o])&&(o=i);for(s=r;s<e+1;++s)a=t[s][r],t[s][r]=t[s][o],t[s][o]=a;for(i=r+1;i<e;++i)for(s=e;s>=r;s--)t[s][i]-=t[s][r]*t[r][i]/t[r][r]}for(i=e-1;i>=0;--i){for(a=0,s=i+1;s<e;++s)a+=t[s][i]*n[s];n[i]=(t[e][i]-a)/t[i][i]}return n}(c),v=t=>{let e=a+y[0]+y[1]*(t-=o)+y[2]*t*t;for(d=3;d<h;++d)e+=y[d]*Math.pow(t,d);return e};return{coef:Nl(h,y,-o,a),predict:v,rSquared:wl(t,e,n,a,v)}};function Nl(t,e,n,r){const i=Array(t);let s,o,a,l;for(s=0;s<t;++s)i[s]=0;for(s=t-1;s>=0;--s)for(a=e[s],l=1,i[s]+=a,o=1;o<=s;++o)l*=(s+1-o)/o,i[s-o]+=a*Math.pow(n,o)*l;return i[0]+=r,i}var Tl=function(t,e){return Ua(t,.5,e)},Ol=function(t,e,n,r){const[i,s,o,a]=xl(t,e,n,!0),l=i.length,u=Math.max(2,~~(r*l)),c=new Float64Array(l),h=new Float64Array(l),d=new Float64Array(l).fill(1);for(let f=-1;++f<=2;){const t=[0,u-1];for(let n=0;n<l;++n){const e=i[n],r=t[0],o=t[1];let a=0,l=0,u=0,f=0,p=0,m=1/Math.abs(i[e-i[r]>i[o]-e?r:o]-e||1);for(let t=r;t<=o;++t){const n=i[t],r=s[t],o=Il(Math.abs(e-n)*m)*d[t],c=n*o;a+=o,l+=c,u+=r*o,f+=r*c,p+=n*c}const[g,y]=bl(l/a,u/a,f/a,p/a);c[n]=g+y*e,h[n]=Math.abs(s[n]-c[n]),Rl(i,n+1,t)}if(2===f)break;const e=Tl(h);if(Math.abs(e)<1e-12)break;for(let n,r,i=0;i<l;++i)n=h[i]/(6*e),d[i]=n>=1?1e-12:(r=1-n*n)*r}return function(t,e,n,r){const i=t.length,s=[];let o,a=0,l=0,u=[];for(;a<i;++a)o=t[a]+n,u[0]===o?u[1]+=(e[a]-u[1])/++l:(l=0,u[1]+=r,u=[o,e[a]],s.push(u));return u[1]+=r,s}(i,c,o,a)};function Il(t){return(t=1-t*t*t)*t*t}function Rl(t,e,n){let r=t[e],i=n[0],s=n[1]+1;if(!(s>=t.length))for(;e>i&&t[s]-r<=r-t[i];)n[0]=++i,n[1]=s,++s}const Fl=.1*Math.PI/180;var Ml=function(t,e,n,r){n=n||25,r=Math.max(n,r||200);const i=e=>[e,t(e)],s=e[0],o=e[1],a=o-s,l=a/r,u=[i(s)],c=[];if(n===r){for(let t=1;t<r;++t)u.push(i(s+t/n*a));return u.push(i(o)),u}c.push(i(o));for(let f=n;--f>0;)c.push(i(s+f/n*a));let h=u[0],d=c[c.length-1];for(;d;){const t=i((h[0]+d[0])/2);t[0]-h[0]>=l&&$l(h,t,d)>Fl?c.push(t):(h=d,u.push(d),c.pop()),d=c[c.length-1]}return u};function $l(t,e,n){const r=Math.atan2(n[1]-t[1],n[0]-t[0]),i=Math.atan2(e[1]-t[1],e[0]-t[0]);return Math.abs(r-i)}function Pl(t){this._key=t?zt(t):gn,this.reset()}var zl=Pl.prototype;function Ll(t){ba.call(this,null,t),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}zl.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},zl.add=function(t){this._add.push(t)},zl.rem=function(t){this._rem.push(t)},zl.values=function(){if(this._get=null,0===this._rem.length)return this._add;var t,e,n,r=this._add,i=this._rem,s=this._key,o=r.length,a=i.length,l=Array(o-a),u={};for(t=0;t<a;++t)u[s(i[t])]=1;for(t=0,e=0;t<o;++t)u[s(n=r[t])]?u[s(n)]=0:l[e++]=n;return this._rem=[],this._add=l},zl.distinct=function(t){for(var e,n=this.values(),r=n.length,i={},s=0;--r>=0;)e=t(n[r])+"",ze(i,e)||(i[e]=1,++s);return s},zl.extent=function(t){if(this._get!==t||!this._ext){var e=this.values(),n=$e(e,t);this._ext=[e[n[0]],e[n[1]]],this._get=t}return this._ext},zl.argmin=function(t){return this.extent(t)[0]||{}},zl.argmax=function(t){return this.extent(t)[1]||{}},zl.min=function(t){var e=this.extent(t)[0];return null!=e?t(e):void 0},zl.max=function(t){var e=this.extent(t)[1];return null!=e?t(e):void 0},zl.quartile=function(t){return this._get===t&&this._q||(this._q=Wa(this.values(),t),this._get=t),this._q},zl.q1=function(t){return this.quartile(t)[0]},zl.q2=function(t){return this.quartile(t)[1]},zl.q3=function(t){return this.quartile(t)[2]},zl.ci=function(t){return this._get===t&&this._ci||(this._ci=Ka(this.values(),1e3,.05,t),this._get=t),this._ci},zl.ci0=function(t){return this.ci(t)[0]},zl.ci1=function(t){return this.ci(t)[1]},Ll.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Na},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]};var Bl=Ue(Ll,ba);function jl(t){ba.call(this,null,t)}Bl.transform=function(t,e){var n=this,r=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=t.modified();return n.stamp=r.stamp,n.value&&(i||e.modified(n._inputs,!0))?(n._prev=n.value,n.value=i?n.init(t):{},e.visit(e.SOURCE,t=>n.add(t))):(n.value=n.value||n.init(t),e.visit(e.REM,t=>n.rem(t)),e.visit(e.ADD,t=>n.add(t))),r.modifies(n._outputs),n._drop=!1!==t.drop,t.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),e.clean()&&n._drop&&r.clean(!0).runAfter(()=>this.clean()),n.changes(r)},Bl.cross=function(){var t=this,e=t.value,n=t._dnames,r=n.map((function(){return{}})),i=n.length;function s(t){var e,s,o,a;for(e in t)for(o=t[e].tuple,s=0;s<i;++s)r[s][a=o[n[s]]]=a}s(t._prev),s(e),function s(o,a,l){var u,c,h=n[l],d=r[l++];for(u in d)a[h]=d[u],c=o?o+"|"+u:u,l<i?s(c,a,l):e[c]||t.cell(c,a)}("",{},0)},Bl.init=function(t){var e=this._inputs=[],n=this._outputs=[],r={};function i(t){for(var n,i=Ce(It(t)),s=0,o=i.length;s<o;++s)r[n=i[s]]||(r[n]=1,e.push(n))}this._dims=Ce(t.groupby),this._dnames=this._dims.map((function(t){var e=Ot(t);return i(t),n.push(e),e})),this.cellkey=t.key?t.key:Ca(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];var s,o,a,l,u,c,h=t.fields||[null],d=t.ops||["count"],f=t.as||[],p=h.length,m={};for(p!==d.length&&$t("Unmatched number of fields and aggregate ops."),c=0;c<p;++c)o=d[c],null==(s=h[c])&&"count"!==o&&$t("Null aggregate field specified."),u=Ea(o,l=Ot(s),f[c]),n.push(u),"count"!==o?((a=m[l])||(i(s),(a=m[l]=[]).field=s,this._measures.push(a)),"count"!==o&&(this._countOnly=!1),a.push(Ta(o,u))):this._counts.push(u);return this._measures=this._measures.map((function(t){return $a(t,t.field)})),{}},Bl.cellkey=Ca(),Bl.cell=function(t,e){var n=this.value[t];return n?0===n.num&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[t]=this.newcell(t,e),this._adds[this._alen++]=n),n},Bl.newcell=function(t,e){var n={key:t,num:0,agg:null,tuple:this.newtuple(e,this._prev&&this._prev[t]),stamp:this.stamp,store:!1};if(!this._countOnly){var r,i=this._measures,s=i.length;for(n.agg=Array(s),r=0;r<s;++r)n.agg[r]=new i[r](n)}return n.store&&(n.data=new Pl),n},Bl.newtuple=function(t,e){var n,r,i=this._dnames,s=this._dims,o={};for(n=0,r=s.length;n<r;++n)o[i[n]]=s[n](t);return e?_n(e.tuple,o):vn(o)},Bl.clean=function(){const t=this.value;for(const e in t)0===t[e].num&&delete t[e]},Bl.add=function(t){var e,n,r,i=this.cellkey(t),s=this.cell(i,t);if(s.num+=1,!this._countOnly)for(s.store&&s.data.add(t),n=0,r=(e=s.agg).length;n<r;++n)e[n].add(e[n].get(t),t)},Bl.rem=function(t){var e,n,r,i=this.cellkey(t),s=this.cell(i,t);if(s.num-=1,!this._countOnly)for(s.store&&s.data.rem(t),n=0,r=(e=s.agg).length;n<r;++n)e[n].rem(e[n].get(t),t)},Bl.celltuple=function(t){var e,n,r,i=t.tuple,s=this._counts;for(t.store&&t.data.values(),n=0,r=s.length;n<r;++n)i[s[n]]=t.num;if(!this._countOnly)for(n=0,r=(e=t.agg).length;n<r;++n)e[n].set(i);return i},Bl.changes=function(t){var e,n,r,i,s=this._adds,o=this._mods,a=this._prev,l=this._drop,u=t.add,c=t.rem,h=t.mod;if(a)for(n in a)e=a[n],l&&!e.num||c.push(e.tuple);for(r=0,i=this._alen;r<i;++r)u.push(this.celltuple(s[r])),s[r]=null;for(r=0,i=this._mlen;r<i;++r)(0===(e=o[r]).num&&l?c:h).push(this.celltuple(e)),o[r]=null;return this._alen=this._mlen=0,this._prev=null,t},jl.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]};var Ul=Ue(jl,ba);Ul.transform=function(t,e){var n,r=!1!==t.interval,i=this._bins(t),s=i.start,o=i.step,a=t.as||["bin0","bin1"],l=a[0],u=a[1];return n=t.modified()?(e=e.reflow(!0)).SOURCE:e.modified(It(t.field))?e.ADD_MOD:e.ADD,e.visit(n,r?function(t){var e=i(t);t[l]=e,t[u]=null==e?null:s+o*(1+(e-s)/o)}:function(t){t[l]=i(t)}),e.modifies(r?a:l)},Ul._bins=function(t){if(this.value&&!t.modified())return this.value;var e,n,r=t.field,i=Ha(t),s=i.step,o=i.start,a=o+Math.ceil((i.stop-o)/s)*s;null!=(e=t.anchor)&&(n=e-(o+s*Math.floor((e-o)/s)),o+=n,a+=n);var l=function(t){var e=oe(r(t));return null==e?null:e<o?-1/0:e>a?1/0:(e=Math.max(o,Math.min(e,a-s)),o+s*Math.floor(1e-14+(e-o)/s))};return l.start=o,l.stop=i.stop,l.step=s,this.value=Tt(l,It(r),t.name||"bin_"+Ot(r))};var Vl=function(t,e,n){var r=t,i=e||[],s=n||[],o={},a=0;return{add:function(t){s.push(t)},remove:function(t){o[r(t)]=++a},size:function(){return i.length},data:function(t,e){return a&&(i=i.filter((function(t){return!o[r(t)]})),o={},a=0),e&&t&&i.sort(t),s.length&&(i=t?Qe(t,i,s.sort(t)):i.concat(s),s=[]),i}}};function Wl(t){ba.call(this,[],t)}function ql(t){Tn.call(this,null,Hl,t)}function Hl(t){return this.value&&!t.modified()?this.value:Ae(t.fields,t.orders)}function Gl(t){ba.call(this,null,t)}Wl.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]},Ue(Wl,ba).transform=function(t,e){var n=e.fork(e.ALL),r=Vl(gn,this.value,n.materialize(n.ADD).add),i=t.sort,s=e.changed()||i&&(t.modified("sort")||e.modified(i.fields));return n.visit(n.REM,r.remove),this.modified(s),this.value=n.source=r.data(wn(i),s),e.source&&e.source.root&&(this.value.root=e.source.root),n},Ue(ql,Tn),Gl.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]};var Yl=Ue(Gl,ba);function Kl(t){ba.call(this,null,t)}Yl.transform=function(t,e){function n(e){return function(n){for(var r,i=function(t,e,n){switch(e){case"upper":t=t.toUpperCase();break;case"lower":t=t.toLowerCase()}return t.match(n)}(a(n),t.case,s)||[],l=0,u=i.length;l<u;++l)o.test(r=i[l])||e(r)}}var r=this._parameterCheck(t,e),i=this._counts,s=this._match,o=this._stop,a=t.field,l=t.as||["text","count"],u=n((function(t){i[t]=1+(i[t]||0)})),c=n((function(t){i[t]-=1}));return r?e.visit(e.SOURCE,u):(e.visit(e.ADD,u),e.visit(e.REM,c)),this._finish(e,l)},Yl._parameterCheck=function(t,e){var n=!1;return!t.modified("stopwords")&&this._stop||(this._stop=new RegExp("^"+(t.stopwords||"")+"$","i"),n=!0),!t.modified("pattern")&&this._match||(this._match=new RegExp(t.pattern||"[\\w']+","g"),n=!0),(t.modified("field")||e.modified(t.field.fields))&&(n=!0),n&&(this._counts={}),n},Yl._finish=function(t,e){var n,r,i,s=this._counts,o=this._tuples||(this._tuples={}),a=e[0],l=e[1],u=t.fork(t.NO_SOURCE|t.NO_FIELDS);for(n in s)i=s[n]||0,!(r=o[n])&&i?(o[n]=r=vn({}),r[a]=n,r[l]=i,u.add.push(r)):0===i?(r&&u.rem.push(r),s[n]=null,o[n]=null):r[l]!==i&&(r[l]=i,u.mod.push(r));return u.modifies(e)},Kl.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]},Ue(Kl,ba).transform=function(t,e){var n=e.fork(e.NO_SOURCE),r=this.value,i=t.as||["a","b"],s=i[0],o=i[1];return!r||e.changed(e.ADD_REM)||t.modified("as")||t.modified("filter")?(r&&(n.rem=r),r=e.materialize(e.SOURCE).source,n.add=this.value=function(t,e,n,r){for(var i,s,o=[],a={},l=t.length,u=0;u<l;++u)for(a[e]=s=t[u],i=0;i<l;++i)a[n]=t[i],r(a)&&(o.push(vn(a)),(a={})[e]=s);return o}(r,s,o,t.filter||Wt)):n.mod=r,n.source=this.value,n.modifies(i)};var Xl={kde:al,mixture:fl,normal:ol,lognormal:dl,uniform:vl};function Zl(t){ba.call(this,null,t)}var Ql=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}];function Jl(t,e){return t?t.map((function(t,n){return e[n]||Ot(t)})):null}function tu(t,e,n){var r,i,s,o,a,l,u=[],c=function(t){return t(o)};if(null==e)u.push(t.map(n));else for(r={},i=0,s=t.length;i<s;++i)o=t[i],(l=r[a=e.map(c)])||(r[a]=l=[],l.dims=a,u.push(l)),l.push(n(o));return u}function eu(t){ba.call(this,null,t)}function nu(t){Tn.call(this,null,ru,t),this.modified(!0)}function ru(t){var e=t.expr;return this.value&&!t.modified("expr")?this.value:Tt(n=>e(n,t),It(e),Ot(e))}function iu(t){ba.call(this,[void 0,void 0],t)}function su(t,e){Tn.call(this,t),this.parent=e,this.count=0}Zl.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:Ql.concat({key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:Ql},{name:"weights",type:"number",array:!0}]})},{name:"as",type:"string",array:!0,default:["value","density"]}]},Ue(Zl,ba).transform=function(t,e){var n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){var r=function t(e,n){var r=e.function;ze(Xl,r)||$t("Unknown distribution function: "+r);var i=Xl[r]();for(var s in e)"field"===s?i.data((e.from||n()).map(e[s])):"distributions"===s?i[s](e[s].map((function(e){return t(e,n)}))):"function"==typeof i[s]&&i[s](e[s]);return i}(t.distribution,function(t){return function(){return t.materialize(t.SOURCE).source}}(e)),i=t.steps||t.minsteps||25,s=t.steps||t.maxsteps||200,o=t.method||"pdf";"pdf"!==o&&"cdf"!==o&&$t("Invalid density method: "+o),t.extent||r.data||$t("Missing density extent parameter."),o=r[o];var a=t.as||["value","density"],l=t.extent||Me(r.data()),u=Ml(o,l,i,s).map(t=>{var e={};return e[a[0]]=t[0],e[a[1]]=t[1],vn(e)});this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n},eu.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:"bin"}]},Ue(eu,ba).transform=function(t,e){if(this.value&&!t.modified()&&!e.changed())return e;const n=e.materialize(e.SOURCE).source,r=tu(e.source,t.groupby,jt),i=t.smooth||!1,s=t.field,o=t.step||function(t,e){return en(Me(t,e))/30}(n,s),a=wn((t,e)=>s(t)-s(e)),l=t.as||"bin",u=r.length;let c,h=1/0,d=-1/0,f=0;for(;f<u;++f){const t=r[f].sort(a);c=-1;for(const e of Xa(t,o,i,s))e<h&&(h=e),e>d&&(d=e),t[++c][l]=e}return this.value={start:h,stop:d,step:o},e.reflow(!0).modifies(l)},Ue(nu,Tn),iu.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]},Ue(iu,ba).transform=function(t,e){var n,r=this.value,i=t.field,s=r[0],o=r[1];if(((n=e.changed()||e.modified(i.fields)||t.modified("field"))||null==s)&&(s=1/0,o=-1/0),e.visit(n?e.SOURCE:e.ADD,(function(t){var e=oe(i(t));null!=e&&(e<s&&(s=e),e>o&&(o=e))})),!Number.isFinite(s)||!Number.isFinite(o)){let t=Ot(i);t&&(t=` for field "${t}"`),e.dataflow.warn(`Infinite extent${t}: [${s}, ${o}]`),s=o=void 0}this.value=[s,o]};var ou=Ue(su,Tn);function au(t){ba.call(this,{},t),this._keys=Be();const e=this._targets=[];e.active=0,e.forEach=t=>{for(let n=0,r=e.active;n<r;++n)t(e[n],n,e)}}ou.connect=function(t){return this.detachSubflow=t.detachSubflow,this.targets().add(t),t.source=this},ou.add=function(t){this.count+=1,this.value.add.push(t)},ou.rem=function(t){this.count-=1,this.value.rem.push(t)},ou.mod=function(t){this.value.mod.push(t)},ou.init=function(t){this.value.init(t,t.NO_SOURCE)},ou.evaluate=function(){return this.value};const lu=Ue(au,ba);function uu(t){Tn.call(this,null,cu,t)}function cu(t){return this.value&&!t.modified()?this.value:Jt(t.name)?Ce(t.name).map((function(t){return zt(t)})):zt(t.name,t.as)}function hu(t){ba.call(this,Be(),t)}function du(t){ba.call(this,[],t)}function fu(t){ba.call(this,[],t)}function pu(t){ba.call(this,null,t)}function mu(t){ba.call(this,[],t)}lu.activate=function(t){this._targets[this._targets.active++]=t},lu.subflow=function(t,e,n,r){let i,s,o=this.value,a=ze(o,t)&&o[t];return a?a.value.stamp<n.stamp&&(a.init(n),this.activate(a)):(s=r||(s=this._group[t])&&s.tuple,i=n.dataflow,a=new su(n.fork(n.NO_SOURCE),this),i.add(a).connect(e(i,t,s)),o[t]=a,this.activate(a)),a},lu.clean=function(){const t=this.value;for(const e in t)if(0===t[e].count){const n=t[e].detachSubflow;n&&n(),delete t[e]}},lu.initTargets=function(){const t=this._targets,e=t.length;for(let n=0;n<e&&null!=t[n];++n)t[n]=null;t.active=0},lu.transform=function(t,e){const n=e.dataflow,r=t.key,i=t.subflow,s=this._keys,o=t.modified("key"),a=t=>this.subflow(t,i,e);return this._group=t.group||{},this.initTargets(),e.visit(e.REM,t=>{const e=gn(t),n=s.get(e);void 0!==n&&(s.delete(e),a(n).rem(t))}),e.visit(e.ADD,t=>{const e=r(t);s.set(gn(t),e),a(e).add(t)}),o||e.modified(r.fields)?e.visit(e.MOD,t=>{const e=gn(t),n=s.get(e),i=r(t);n===i?a(i).mod(t):(s.set(e,i),a(n).rem(t),a(i).add(t))}):e.changed(e.MOD)&&e.visit(e.MOD,t=>{a(s.get(gn(t))).mod(t)}),o&&e.visit(e.REFLOW,t=>{const e=gn(t),n=s.get(e),i=r(t);n!==i&&(s.set(e,i),a(n).rem(t),a(i).add(t))}),e.clean()?n.runAfter(()=>{this.clean(),s.clean()}):s.empty>n.cleanThreshold&&n.runAfter(s.clean),e},Ue(uu,Tn),hu.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]},Ue(hu,ba).transform=function(t,e){var n=e.dataflow,r=this.value,i=e.fork(),s=i.add,o=i.rem,a=i.mod,l=t.expr,u=!0;function c(e){var n=gn(e),i=l(e,t),c=r.get(n);i&&c?(r.delete(n),s.push(e)):i||c?u&&i&&!c&&a.push(e):(r.set(n,1),o.push(e))}return e.visit(e.REM,(function(t){var e=gn(t);r.has(e)?r.delete(e):o.push(t)})),e.visit(e.ADD,(function(e){l(e,t)?s.push(e):r.set(gn(e),1)})),e.visit(e.MOD,c),t.modified()&&(u=!1,e.visit(e.REFLOW,c)),r.empty>n.cleanThreshold&&n.runAfter(r.clean),i},du.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]},Ue(du,ba).transform=function(t,e){var n=e.fork(e.NO_SOURCE),r=t.fields,i=Jl(r,t.as||[]),s=t.index||null,o=i.length;return n.rem=this.value,e.visit(e.SOURCE,(function(t){for(var e,a,l,u=r.map(e=>e(t)),c=u.reduce((t,e)=>Math.max(t,e.length),0),h=0;h<c;++h){for(a=bn(t),e=0;e<o;++e)a[i[e]]=null==(l=u[e][h])?null:l;s&&(a[s]=h),n.add.push(a)}})),this.value=n.source=n.add,s&&n.modifies(s),n.modifies(i)},fu.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]},Ue(fu,ba).transform=function(t,e){var n=e.fork(e.NO_SOURCE),r=t.fields,i=r.map(Ot),s=t.as||["key","value"],o=s[0],a=s[1],l=r.length;return n.rem=this.value,e.visit(e.SOURCE,(function(t){for(var e,s=0;s<l;++s)(e=bn(t))[o]=i[s],e[a]=r[s](t),n.add.push(e)})),this.value=n.source=n.add,n.modifies(s)},pu.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]},Ue(pu,ba).transform=function(t,e){var n=t.expr,r=t.as,i=t.modified(),s=t.initonly?e.ADD:i?e.SOURCE:e.modified(n.fields)||e.modified(r)?e.ADD_MOD:e.ADD;return i&&(e=e.materialize().reflow(!0)),t.initonly||e.modifies(r),e.visit(s,e=>e[r]=n(e,t))},Ue(mu,ba).transform=function(t,e){var n,r,i,s=this.value,o=e.fork(e.ALL),a=t.size-s.length,l=t.generator;if(a>0){for(n=[];--a>=0;)n.push(i=vn(l(t))),s.push(i);o.add=o.add.length?o.materialize(o.ADD).add.concat(n):n}else r=s.slice(0,-a),o.rem=o.rem.length?o.materialize(o.REM).rem.concat(r):r,s=s.slice(-a);return o.source=this.value=s,o};var gu={value:"value",median:Tl,mean:function(t,e){let n=0,r=0;if(void 0===e)for(let i of t)null!=i&&(i=+i)>=i&&(++n,r+=i);else{let i=-1;for(let s of t)null!=(s=e(s,++i,t))&&(s=+s)>=s&&(++n,r+=s)}if(n)return r/n},min:La,max:za},yu=[];function vu(t){ba.call(this,[],t)}function bu(t){Ll.call(this,t)}vu.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]},Ue(vu,ba).transform=function(t,e){var n,r,i,s,o,a,l,u,c,h,d=e.fork(e.ALL),f=function(t){var e,n=t.method||gu.value;if(null!=gu[n])return n===gu.value?(e=void 0!==t.value?t.value:0,function(){return e}):gu[n];$t("Unrecognized imputation method: "+n)}(t),p=function(t){var e=t.field;return function(t){return t?e(t):NaN}}(t),m=Ot(t.field),g=Ot(t.key),y=(t.groupby||[]).map(Ot),v=function(t,e,n,r){var i,s,o,a,l,u,c,h,d=function(t){return t(h)},f=[],p=r?r.slice():[],m={},g={};for(p.forEach((function(t,e){m[t]=e+1})),a=0,c=t.length;a<c;++a)u=n(h=t[a]),l=m[u]||(m[u]=p.push(u)),(o=g[s=(i=e?e.map(d):yu)+""])||(o=g[s]=[],f.push(o),o.values=i),o[l-1]=h;return f.domain=p,f}(e.source,t.groupby,t.key,t.keyvals),b=[],x=this.value,_=v.domain.length;for(o=0,u=v.length;o<u;++o)for(i=(n=v[o]).values,r=NaN,l=0;l<_;++l)if(null==n[l]){for(s=v.domain[l],h={_impute:!0},a=0,c=i.length;a<c;++a)h[y[a]]=i[a];h[g]=s,h[m]=Number.isNaN(r)?r=f(n,p):r,b.push(vn(h))}return b.length&&(d.add=d.materialize(d.ADD).add.concat(b)),x.length&&(d.rem=d.materialize(d.REM).rem.concat(x)),this.value=b,d},bu.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:Na},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]};var xu=Ue(bu,Ll);function _u(t){ba.call(this,null,t)}function wu(t){Tn.call(this,null,Su,t)}function Su(t){return this.value&&!t.modified()?this.value:Ke(t.fields,t.flat)}function Cu(t){ba.call(this,[],t),this._pending=null}function Eu(t,e,n){n.forEach(vn);const r=e.fork(e.NO_FIELDS&e.NO_SOURCE);return r.rem=t.value,t.value=r.source=r.add=n,t._pending=null,r.rem.length&&r.clean(!0),r}function ku(t){ba.call(this,{},t)}function Au(t){Tn.call(this,null,Du,t)}function Du(t){if(this.value&&!t.modified())return this.value;var e,n,r,i=1/0,s=-1/0,o=t.extents;for(e=0,n=o.length;e<n;++e)(r=o[e])[0]<i&&(i=r[0]),r[1]>s&&(s=r[1]);return[i,s]}function Nu(t){Tn.call(this,null,Tu,t)}function Tu(t){return this.value&&!t.modified()?this.value:t.values.reduce((function(t,e){return t.concat(e)}),[])}function Ou(t){ba.call(this,null,t)}function Iu(t){Ll.call(this,t)}xu.transform=function(t,e){var n,r=this,i=t.modified();return r.value&&(i||e.modified(r._inputs,!0))?(n=r.value=i?r.init(t):{},e.visit(e.SOURCE,(function(t){r.add(t)}))):(n=r.value=r.value||this.init(t),e.visit(e.REM,(function(t){r.rem(t)})),e.visit(e.ADD,(function(t){r.add(t)}))),r.changes(),e.visit(e.SOURCE,(function(t){Fe(t,n[r.cellkey(t)].tuple)})),e.reflow(i).modifies(this._outputs)},xu.changes=function(){var t,e,n=this._adds,r=this._mods;for(t=0,e=this._alen;t<e;++t)this.celltuple(n[t]),n[t]=null;for(t=0,e=this._mlen;t<e;++t)this.celltuple(r[t]),r[t]=null;this._alen=this._mlen=0},_u.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]},Ue(_u,ba).transform=function(t,e){var n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const r=e.materialize(e.SOURCE).source,i=tu(r,t.groupby,t.field),s=(t.groupby||[]).map(Ot),o=t.bandwidth,a=t.cumulative?"cdf":"pdf",l=t.as||["value","density"],u=[];let c=t.extent,h=t.steps||t.minsteps||25,d=t.steps||t.maxsteps||200;"pdf"!==a&&"cdf"!==a&&$t("Invalid density method: "+a),"shared"===t.resolve&&(c||(c=Me(r,t.field)),h=d=t.steps||d),i.forEach(e=>{const n=al(e,o)[a],r=t.counts?e.length:1,i=c||Me(e);Ml(n,i,h,d).forEach(t=>{const n={};for(let r=0;r<s.length;++r)n[s[r]]=e.dims[r];n[l[0]]=t[0],n[l[1]]=t[1]*r,u.push(vn(n))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n},Ue(wu,Tn),Ue(Cu,ba).transform=function(t,e){const n=e.dataflow;return this._pending?Eu(this,e,this._pending):function(t){return t.modified("async")&&!(t.modified("values")||t.modified("url")||t.modified("format"))}(t)?e.StopPropagation:t.values?Eu(this,e,n.parse(t.values,t.format)):t.async?{async:n.request(t.url,t.format).then(t=>(this._pending=Ce(t.data),t=>t.touch(this)))}:n.request(t.url,t.format).then(t=>Eu(this,e,Ce(t.data)))},ku.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]},Ue(ku,ba).transform=function(t,e){var n,r,i=e,s=t.as,o=t.fields,a=t.index,l=t.values,u=null==t.default?null:t.default,c=t.modified(),h=c?e.SOURCE:e.ADD,d=o.length;return l?(r=l.length,d>1&&!s&&$t('Multi-field lookup requires explicit "as" parameter.'),s&&s.length!==d*r&&$t('The "as" parameter has too few output field names.'),s=s||l.map(Ot),n=function(t){for(var e,n,i=0,c=0;i<d;++i)if(null==(n=a.get(o[i](t))))for(e=0;e<r;++e,++c)t[s[c]]=u;else for(e=0;e<r;++e,++c)t[s[c]]=l[e](n)}):(s||$t("Missing output field names."),n=function(t){for(var e,n=0;n<d;++n)e=a.get(o[n](t)),t[s[n]]=null==e?u:e}),c?i=e.reflow(!0):h|=o.some((function(t){return e.modified(t.fields)}))?e.MOD:0,e.visit(h,n),i.modifies(s)},Ue(Au,Tn),Ue(Nu,Tn),Ue(Ou,ba),Ou.prototype.transform=function(t,e){return this.modified(t.modified()),this.value=t,e.fork(e.NO_SOURCE|e.NO_FIELDS)},Iu.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:Na,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]};var Ru=Ue(Iu,Ll);function Fu(t){au.call(this,t)}function Mu(t){ba.call(this,null,t)}function $u(t){ba.call(this,null,t)}Ru._transform=Ru.transform,Ru.transform=function(t,e){return this._transform(function(t,e){var n=t.field,r=t.value,i=("count"===t.op?"__count__":t.op)||"sum",s=It(n).concat(It(r)),o=function(t,e,n){var r={},i=[];return n.visit(n.SOURCE,(function(e){var n=t(e);r[n]||(r[n]=1,i.push(n))})),i.sort((function(t,e){return(t<e||null==t)&&null!=e?-1:(t>e||null==e)&&null!=t?1:(e=e instanceof Date?+e:e,(t=t instanceof Date?+t:t)!==t&&e==e?-1:e!=e&&t==t?1:0)})),e?i.slice(0,e):i}(n,t.limit||0,e);return e.changed()&&t.set("__pivot__",null,null,!0),{key:t.key,groupby:t.groupby,ops:o.map((function(){return i})),fields:o.map((function(t){return function(t,e,n,r){return Tt((function(r){return e(r)===t?n(r):NaN}),r,t+"")}(t,n,r,s)})),as:o.map((function(t){return t+""})),modified:t.modified.bind(t)}}(t,e),e)},Ue(Fu,au).transform=function(t,e){const n=t.subflow,r=t.field,i=t=>this.subflow(gn(t),n,e,t);return(t.modified("field")||r&&e.modified(It(r)))&&$t("PreFacet does not support field modification."),this.initTargets(),r?(e.visit(e.MOD,t=>{const e=i(t);r(t).forEach(t=>e.mod(t))}),e.visit(e.ADD,t=>{const e=i(t);r(t).forEach(t=>e.add(vn(t)))}),e.visit(e.REM,t=>{const e=i(t);r(t).forEach(t=>e.rem(t))})):(e.visit(e.MOD,t=>i(t).mod(t)),e.visit(e.ADD,t=>i(t).add(t)),e.visit(e.REM,t=>i(t).rem(t))),e.clean()&&e.runAfter(()=>this.clean()),e},Mu.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]},Ue(Mu,ba).transform=function(t,e){var n,r,i=t.fields,s=Jl(t.fields,t.as||[]),o=i?function(t,e){return function(t,e,n,r){for(var i=0,s=n.length;i<s;++i)e[r[i]]=n[i](t);return e}(t,e,i,s)}:xn;return this.value?r=this.value:(e=e.addAll(),r=this.value={}),n=e.fork(e.NO_SOURCE),e.visit(e.REM,(function(t){var e=gn(t);n.rem.push(r[e]),r[e]=null})),e.visit(e.ADD,(function(t){var e=o(t,vn({}));r[gn(t)]=e,n.add.push(e)})),e.visit(e.MOD,(function(t){n.mod.push(o(t,r[gn(t)]))})),n},Ue($u,ba).transform=function(t,e){return this.value=t.value,t.modified("value")?e.fork(e.NO_SOURCE|e.NO_FIELDS):e.StopPropagation};var Pu=function(t,e,n){t=+t,e=+e,n=(i=arguments.length)<2?(e=t,t=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((e-t)/n)),s=new Array(i);++r<i;)s[r]=t+r*n;return s};function zu(t){ba.call(this,null,t)}function Lu(t){ba.call(this,null,t)}function Bu(t){ba.call(this,[],t),this.count=0}function ju(t){ba.call(this,null,t)}function Uu(t){ba.call(this,null,t),this.modified(!0)}function Vu(t){ba.call(this,null,t)}zu.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]},Ue(zu,ba).transform=function(t,e){var n=e.fork(e.NO_SOURCE|e.NO_FIELDS),r=t.as||["prob","value"];if(this.value&&!t.modified()&&!e.changed())return n.source=this.value,n;const i=tu(e.materialize(e.SOURCE).source,t.groupby,t.field),s=(t.groupby||[]).map(Ot),o=[],a=t.step||.01,l=t.probs||Pu(a/2,1-1e-14,a),u=l.length;return i.forEach(t=>{const e=Va(t,l);for(let n=0;n<u;++n){const i={};for(let e=0;e<s.length;++e)i[s[e]]=t.dims[e];i[r[0]]=l[n],i[r[1]]=e[n],o.push(vn(i))}}),this.value&&(n.rem=this.value),this.value=n.add=n.source=o,n},Ue(Lu,ba).transform=function(t,e){var n,r;return this.value?r=this.value:(n=e=e.addAll(),r=this.value={}),t.derive&&(n=e.fork(e.NO_SOURCE),e.visit(e.REM,t=>{var e=gn(t);n.rem.push(r[e]),r[e]=null}),e.visit(e.ADD,t=>{var e=bn(t);r[gn(t)]=e,n.add.push(e)}),e.visit(e.MOD,t=>{var e,i=r[gn(t)];for(e in t)i[e]=t[e],n.modifies(e);n.mod.push(i)})),n},Bu.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]},Ue(Bu,ba).transform=function(t,e){var n=e.fork(e.NO_SOURCE),r=t.modified("size"),i=t.size,s=this.value,o=this.count,a=0,l=s.reduce((function(t,e){return t[gn(e)]=1,t}),{});function u(t){var e,r;s.length<i?s.push(t):(r=~~((o+1)*Ga()))<s.length&&r>=a&&(l[gn(e=s[r])]&&n.rem.push(e),s[r]=t),++o}if(e.rem.length&&(e.visit(e.REM,(function(t){var e=gn(t);l[e]&&(l[e]=-1,n.rem.push(t)),--o})),s=s.filter((function(t){return-1!==l[gn(t)]}))),(e.rem.length||r)&&s.length<i&&e.source&&(a=o=s.length,e.visit(e.SOURCE,(function(t){l[gn(t)]||u(t)})),a=-1),r&&s.length>i){for(var c=0,h=s.length-i;c<h;++c)l[gn(s[c])]=-1,n.rem.push(s[c]);s=s.slice(h)}return e.mod.length&&e.visit(e.MOD,(function(t){l[gn(t)]&&n.mod.push(t)})),e.add.length&&e.visit(e.ADD,u),(e.add.length||a<0)&&(n.add=s.filter((function(t){return!l[gn(t)]}))),this.count=o,this.value=n.source=s,n},ju.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]},Ue(ju,ba).transform=function(t,e){if(!this.value||t.modified()){var n=e.materialize().fork(e.MOD),r=t.as||"data";return n.rem=this.value?e.rem.concat(this.value):e.rem,this.value=Pu(t.start,t.stop,t.step||1).map((function(t){var e={};return e[r]=t,vn(e)})),n.add=e.add.concat(this.value),n}},Ue(Uu,ba).transform=function(t,e){return this.value=e.source,e.changed()?e.fork(e.NO_SOURCE|e.NO_FIELDS):e.StopPropagation};const Wu=["unit0","unit1"];Vu.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:ri,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:Wu}]};var qu=Ue(Vu,ba);function Hu(t){ba.call(this,Be(),t)}function Gu(t){ba.call(this,null,t)}qu.transform=function(t,e){var n=t.field,r=!1!==t.interval,i="utc"===t.timezone,s=this._floor(t,e),o=(i?ss:is)(s.unit).offset,a=t.as||Wu,l=a[0],u=a[1],c=s.start||1/0,h=s.stop||-1/0,d=s.step,f=e.ADD;return(t.modified()||e.modified(It(n)))&&(f=(e=e.reflow(!0)).SOURCE,c=1/0,h=-1/0),e.visit(f,(function(t){var e,i,a=n(t);null==a?(t[l]=null,r&&(t[u]=null)):(t[l]=e=i=s(a),r&&(t[u]=i=o(e,d)),e<c&&(c=e),i>h&&(h=i))})),s.start=c,s.stop=h,e.modifies(r?a:l)},qu._floor=function(t,e){const n="utc"===t.timezone;let{units:r,step:i}=t.units?{units:t.units,step:t.step||1}:ws({extent:t.extent||Me(e.materialize(e.SOURCE).source,t.field),maxbins:t.maxbins});r=si(r);const s=this.value||{},o=(n?Ui:Li)(r,i);return o.unit=se(r),o.units=r,o.step=i,o.start=s.start,o.stop=s.stop,this.value=o},Ue(Hu,ba).transform=function(t,e){var n=e.dataflow,r=t.field,i=this.value,s=!0;function o(t){i.set(r(t),t)}return t.modified("field")||e.modified(r.fields)?(i.clear(),e.visit(e.SOURCE,o)):e.changed()?(e.visit(e.REM,(function(t){i.delete(r(t))})),e.visit(e.ADD,o)):s=!1,this.modified(s),i.empty>n.cleanThreshold&&n.runAfter(i.clean),e.fork()},Ue(Gu,ba).transform=function(t,e){(!this.value||t.modified("field")||t.modified("sort")||e.changed()||t.sort&&e.modified(t.sort.fields))&&(this.value=(t.sort?e.source.slice().sort(wn(t.sort)):e.source).map(t.field))};const Yu={row_number:function(){return{next:t=>t.index+1}},rank:function(){let t;return{init:()=>t=1,next:e=>{let n=e.index,r=e.data;return n&&e.compare(r[n-1],r[n])?t=n+1:t}}},dense_rank:function(){let t;return{init:()=>t=1,next:e=>{let n=e.index,r=e.data;return n&&e.compare(r[n-1],r[n])?++t:t}}},percent_rank:function(){let t=Yu.rank(),e=t.next;return{init:t.init,next:t=>(e(t)-1)/(t.data.length-1)}},cume_dist:function(){let t;return{init:()=>t=0,next:e=>{let n=e.index,r=e.data,i=e.compare;if(t<n){for(;n+1<r.length&&!i(r[n],r[n+1]);)++n;t=n}return(1+t)/r.length}}},ntile:function(t,e){(e=+e)>0||$t("ntile num must be greater than zero.");let n=Yu.cume_dist(),r=n.next;return{init:n.init,next:t=>Math.ceil(e*r(t))}},lag:function(t,e){return e=+e||1,{next:n=>{let r=n.index-e;return r>=0?t(n.data[r]):null}}},lead:function(t,e){return e=+e||1,{next:n=>{let r=n.index+e,i=n.data;return r<i.length?t(i[r]):null}}},first_value:function(t){return{next:e=>t(e.data[e.i0])}},last_value:function(t){return{next:e=>t(e.data[e.i1-1])}},nth_value:function(t,e){return(e=+e)>0||$t("nth_value nth must be greater than zero."),{next:n=>{let r=n.i0+(e-1);return r<n.i1?t(n.data[r]):null}}},prev_value:function(t){let e;return{init:()=>e=null,next:n=>{let r=t(n.data[n.index]);return null!=r?e=r:e}}},next_value:function(t){let e,n;return{init:()=>(e=null,n=-1),next:r=>{let i=r.data;return r.index<=n?e:(n=function(t,e,n){for(let r=e.length;n<r;++n)if(null!=t(e[n]))return n;return-1}(t,i,r.index))<0?(n=i.length,e=null):e=t(i[n])}}}};var Ku=Object.keys(Yu);function Xu(t){let e=Ce(t.ops),n=Ce(t.fields),r=Ce(t.params),i=Ce(t.as),s=this.outputs=[],o=this.windows=[],a={},l={},u=!0,c=[],h=[];function d(t){Ce(It(t)).forEach(t=>a[t]=1)}d(t.sort),e.forEach((function(t,e){let a=n[e],f=Ot(a),p=Ea(t,f,i[e]);if(d(a),s.push(p),ze(Yu,t))o.push(function(t,e,n,r){let i=Yu[t](e,n);return{init:i.init||Ut,update:function(t,e){e[r]=i.next(t)}}}(t,n[e],r[e],p));else{if(null==a&&"count"!==t&&$t("Null aggregate field specified."),"count"===t)return void c.push(p);u=!1;let e=l[f];e||(e=l[f]=[],e.field=a,h.push(e)),e.push(Ta(t,p))}})),(c.length||h.length)&&(this.cell=function(t,e,n){t=t.map(t=>$a(t,t.field));let r={num:0,agg:null,store:!1,count:e};if(!n)for(var i=t.length,s=r.agg=Array(i),o=0;o<i;++o)s[o]=new t[o](r);if(r.store)var a=r.data=new Pl;return r.add=function(t){if(r.num+=1,!n){a&&a.add(t);for(let e=0;e<i;++e)s[e].add(s[e].get(t),t)}},r.rem=function(t){if(r.num-=1,!n){a&&a.rem(t);for(let e=0;e<i;++e)s[e].rem(s[e].get(t),t)}},r.set=function(t){let i,o;for(a&&a.values(),i=0,o=e.length;i<o;++i)t[e[i]]=r.num;if(!n)for(i=0,o=s.length;i<o;++i)s[i].set(t)},r.init=function(){r.num=0,a&&a.reset();for(let t=0;t<i;++t)s[t].init()},r}(h,c,u)),this.inputs=Object.keys(a)}const Zu=Xu.prototype;function Qu(t){ba.call(this,{},t),this._mlen=0,this._mods=[]}Zu.init=function(){this.windows.forEach(t=>t.init()),this.cell&&this.cell.init()},Zu.update=function(t,e){let n,r=this.cell,i=this.windows,s=t.data,o=i&&i.length;if(r){for(n=t.p0;n<t.i0;++n)r.rem(s[n]);for(n=t.p1;n<t.i1;++n)r.add(s[n]);r.set(e)}for(n=0;n<o;++n)i[n].update(t,e)},Qu.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Ku.concat(Na)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]};var Ju=Ue(Qu,ba);function tc(t,e,n,r){var i=r.sort,s=i&&!r.ignorePeers,o=r.frame||[null,0],a=t.data(n),l=a.length,u=0,c=s?fs(i):null,h={i0:0,i1:0,p0:0,p1:0,index:0,data:a,compare:i||Ie(-1)};for(e.init();u<l;++u)ec(h,o,u,l),s&&nc(h,c),e.update(h,a[u])}function ec(t,e,n,r){t.p0=t.i0,t.p1=t.i1,t.i0=null==e[0]?0:Math.max(0,n-Math.abs(e[0])),t.i1=null==e[1]?r:Math.min(r,n+Math.abs(e[1])+1),t.index=n}function nc(t,e){var n=t.i0,r=t.i1-1,i=t.compare,s=t.data,o=s.length-1;n>0&&!i(s[n],s[n-1])&&(t.i0=e.left(s,s[n])),r<o&&!i(s[r],s[r+1])&&(t.i1=e.right(s,s[r]))}Ju.transform=function(t,e){var n,r,i=this,s=i.state,o=t.modified(),a=wn(t.sort);this.stamp=e.stamp,s&&!o||(s=i.state=new Xu(t));var l=Ca(t.groupby);function u(t){return i.group(l(t))}for(o||e.modified(s.inputs)?(i.value={},e.visit(e.SOURCE,(function(t){u(t).add(t)}))):(e.visit(e.REM,(function(t){u(t).remove(t)})),e.visit(e.ADD,(function(t){u(t).add(t)}))),n=0,r=i._mlen;n<r;++n)tc(i._mods[n],s,a,t);return i._mlen=0,i._mods=[],e.reflow(o).modifies(s.outputs)},Ju.group=function(t){var e=this.value[t];return e||((e=this.value[t]=Vl(gn)).stamp=-1),e.stamp<this.stamp&&(e.stamp=this.stamp,this._mods[this._mlen++]=e),e};const rc="top",ic="left",sc="right",oc="end",ac="row";var lc=0;function uc(t){return t&&t.gradient}function cc(t,e,n){let r=t.id,i=t.gradient,s="radial"===i?"p_":"";return r||(r=t.id="gradient_"+lc++,"radial"===i?(t.x1=hc(t.x1,.5),t.y1=hc(t.y1,.5),t.r1=hc(t.r1,0),t.x2=hc(t.x2,.5),t.y2=hc(t.y2,.5),t.r2=hc(t.r2,.5),s="p_"):(t.x1=hc(t.x1,0),t.y1=hc(t.y1,0),t.x2=hc(t.x2,1),t.y2=hc(t.y2,0))),e[r]=t,"url("+(n||"")+"#"+s+r+")"}function hc(t,e){return null!=t?t:e}var dc=function(t,e){var n,r=[];return n={gradient:"linear",x1:t?t[0]:0,y1:t?t[1]:0,x2:e?e[0]:1,y2:e?e[1]:0,stops:r,stop:function(t,e){return r.push({offset:t,color:e}),n}}};function fc(t,e,n){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+n)/6)}function pc(t){this._context=t}pc.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:fc(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:fc(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};var mc=function(){};function gc(t){this._context=t}function yc(t){this._context=t}function vc(t,e){this._basis=new pc(t),this._beta=e}gc.prototype={areaStart:mc,areaEnd:mc,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x2=t,this._y2=e;break;case 1:this._point=2,this._x3=t,this._y3=e;break;case 2:this._point=3,this._x4=t,this._y4=e,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+e)/6);break;default:fc(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}},yc.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+t)/6,r=(this._y0+4*this._y1+e)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:fc(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}},vc.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,e=this._y,n=t.length-1;if(n>0)for(var r,i=t[0],s=e[0],o=t[n]-i,a=e[n]-s,l=-1;++l<=n;)this._basis.point(this._beta*t[l]+(1-this._beta)*(i+(r=l/n)*o),this._beta*e[l]+(1-this._beta)*(s+r*a));this._x=this._y=null,this._basis.lineEnd()},point:function(t,e){this._x.push(+t),this._y.push(+e)}};var bc=function t(e){function n(t){return 1===e?new pc(t):new vc(t,e)}return n.beta=function(e){return t(+e)},n}(.85);function xc(t,e,n){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-e),t._y2+t._k*(t._y1-n),t._x2,t._y2)}function _c(t,e){this._context=t,this._k=(1-e)/6}_c.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:xc(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2,this._x1=t,this._y1=e;break;case 2:this._point=3;default:xc(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var wc=function t(e){function n(t){return new _c(t,e)}return n.tension=function(e){return t(+e)},n}(0);function Sc(t,e){this._context=t,this._k=(1-e)/6}Sc.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:xc(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var Cc=function t(e){function n(t){return new Sc(t,e)}return n.tension=function(e){return t(+e)},n}(0);function Ec(t,e){this._context=t,this._k=(1-e)/6}Ec.prototype={areaStart:mc,areaEnd:mc,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:xc(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var kc=function t(e){function n(t){return new Ec(t,e)}return n.tension=function(e){return t(+e)},n}(0),Ac=Math.abs,Dc=Math.atan2,Nc=Math.cos,Tc=Math.max,Oc=Math.min,Ic=Math.sin,Rc=Math.sqrt,Fc=Math.PI,Mc=Fc/2,$c=2*Fc;function Pc(t){return t>1?0:t<-1?Fc:Math.acos(t)}function zc(t){return t>=1?Mc:t<=-1?-Mc:Math.asin(t)}function Lc(t,e,n){var r=t._x1,i=t._y1,s=t._x2,o=t._y2;if(t._l01_a>1e-12){var a=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,l=3*t._l01_a*(t._l01_a+t._l12_a);r=(r*a-t._x0*t._l12_2a+t._x2*t._l01_2a)/l,i=(i*a-t._y0*t._l12_2a+t._y2*t._l01_2a)/l}if(t._l23_a>1e-12){var u=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,c=3*t._l23_a*(t._l23_a+t._l12_a);s=(s*u+t._x1*t._l23_2a-e*t._l12_2a)/c,o=(o*u+t._y1*t._l23_2a-n*t._l12_2a)/c}t._context.bezierCurveTo(r,i,s,o,t._x2,t._y2)}function Bc(t,e){this._context=t,this._alpha=e}Bc.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;default:Lc(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var jc=function t(e){function n(t){return e?new Bc(t,e):new _c(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function Uc(t,e){this._context=t,this._alpha=e}Uc.prototype={areaStart:mc,areaEnd:mc,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:Lc(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var Vc=function t(e){function n(t){return e?new Uc(t,e):new Ec(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function Wc(t,e){this._context=t,this._alpha=e}Wc.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Lc(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var qc=function t(e){function n(t){return e?new Wc(t,e):new Sc(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function Hc(t){this._context=t}Hc.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}};var Gc=function(t){return new Hc(t)};function Yc(t){this._context=t}function Kc(t){return t<0?-1:1}function Xc(t,e,n){var r=t._x1-t._x0,i=e-t._x1,s=(t._y1-t._y0)/(r||i<0&&-0),o=(n-t._y1)/(i||r<0&&-0),a=(s*i+o*r)/(r+i);return(Kc(s)+Kc(o))*Math.min(Math.abs(s),Math.abs(o),.5*Math.abs(a))||0}function Zc(t,e){var n=t._x1-t._x0;return n?(3*(t._y1-t._y0)/n-e)/2:e}function Qc(t,e,n){var r=t._x0,i=t._x1,s=t._y1,o=(i-r)/3;t._context.bezierCurveTo(r+o,t._y0+o*e,i-o,s-o*n,i,s)}function Jc(t){this._context=t}function th(t){this._context=new eh(t)}function eh(t){this._context=t}function nh(t){this._context=t}function rh(t){var e,n,r=t.length-1,i=new Array(r),s=new Array(r),o=new Array(r);for(i[0]=0,s[0]=2,o[0]=t[0]+2*t[1],e=1;e<r-1;++e)i[e]=1,s[e]=4,o[e]=4*t[e]+2*t[e+1];for(i[r-1]=2,s[r-1]=7,o[r-1]=8*t[r-1]+t[r],e=1;e<r;++e)s[e]-=n=i[e]/s[e-1],o[e]-=n*o[e-1];for(i[r-1]=o[r-1]/s[r-1],e=r-2;e>=0;--e)i[e]=(o[e]-i[e+1])/s[e];for(s[r-1]=(t[r]+i[r-1])/2,e=0;e<r-1;++e)s[e]=2*t[e+1]-i[e+1];return[i,s]}function ih(t,e){this._context=t,this._t=e}Yc.prototype={areaStart:mc,areaEnd:mc,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,e){t=+t,e=+e,this._point?this._context.lineTo(t,e):(this._point=1,this._context.moveTo(t,e))}},Jc.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Qc(this,this._t0,Zc(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var n=NaN;if(e=+e,(t=+t)!==this._x1||e!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,Qc(this,Zc(this,n=Xc(this,t,e)),n);break;default:Qc(this,this._t0,n=Xc(this,t,e))}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=n}}},(th.prototype=Object.create(Jc.prototype)).point=function(t,e){Jc.prototype.point.call(this,e,t)},eh.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,n,r,i,s){this._context.bezierCurveTo(e,t,r,n,s,i)}},nh.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,e=this._y,n=t.length;if(n)if(this._line?this._context.lineTo(t[0],e[0]):this._context.moveTo(t[0],e[0]),2===n)this._context.lineTo(t[1],e[1]);else for(var r=rh(t),i=rh(e),s=0,o=1;o<n;++s,++o)this._context.bezierCurveTo(r[0][s],i[0][s],r[1][s],i[1][s],t[o],e[o]);(this._line||0!==this._line&&1===n)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,e){this._x.push(+t),this._y.push(+e)}},ih.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,e),this._context.lineTo(t,e);else{var n=this._x*(1-this._t)+t*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,e)}}this._x=t,this._y=e}};var sh={basis:{curve:function(t){return new pc(t)}},"basis-closed":{curve:function(t){return new gc(t)}},"basis-open":{curve:function(t){return new yc(t)}},bundle:{curve:bc,tension:"beta",value:.85},cardinal:{curve:wc,tension:"tension",value:0},"cardinal-open":{curve:Cc,tension:"tension",value:0},"cardinal-closed":{curve:kc,tension:"tension",value:0},"catmull-rom":{curve:jc,tension:"alpha",value:.5},"catmull-rom-closed":{curve:Vc,tension:"alpha",value:.5},"catmull-rom-open":{curve:qc,tension:"alpha",value:.5},linear:{curve:Gc},"linear-closed":{curve:function(t){return new Yc(t)}},monotone:{horizontal:function(t){return new th(t)},vertical:function(t){return new Jc(t)}},natural:{curve:function(t){return new nh(t)}},step:{curve:function(t){return new ih(t,.5)}},"step-after":{curve:function(t){return new ih(t,1)}},"step-before":{curve:function(t){return new ih(t,0)}}};function oh(t,e,n){var r=ze(sh,t)&&sh[t],i=null;return r&&(i=r.curve||r[e||"vertical"],r.tension&&null!=n&&(i=i[r.tension](n))),i}var ah={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},lh=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\d)([-+])/g,/\s|,|###/],uh=function(t){var e,n,r,i,s,o,a,l,u,c,h,d=[];for(l=0,c=(e=t.slice().replace(lh[0],"###$1").split(lh[1]).slice(1)).length;l<c;++l){for(r=(n=e[l]).slice(1).trim().replace(lh[2],"$1###$2").split(lh[3]),i=[o=n.charAt(0)],u=0,h=r.length;u<h;++u)(s=+r[u])===s&&i.push(s);if(a=ah[o.toLowerCase()],i.length-1>a)for(u=1,h=i.length;u<h;u+=a)d.push([o].concat(i.slice(u,u+a)));else d.push(i)}return d};const ch=Math.PI/180,hh=Math.PI/2,dh=2*Math.PI,fh=Math.sqrt(3)/2;var ph={},mh={},gh=[].join;function yh(t){var e=gh.call(t);if(mh[e])return mh[e];var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],l=t[6],u=t[7],c=u*o,h=-l*a,d=l*o,f=u*a,p=Math.cos(i),m=Math.sin(i),g=Math.cos(s),y=Math.sin(s),v=.5*(s-i),b=Math.sin(.5*v),x=8/3*b*b/Math.sin(v),_=n+p-x*m,w=r+m+x*p,S=n+g,C=r+y,E=S+x*y,k=C-x*g;return mh[e]=[c*_+h*w,d*_+f*w,c*E+h*k,d*E+f*k,c*S+h*C,d*S+f*C]}var vh=["l",0,0,0,0,0,0,0];function bh(t,e,n){var r=vh[0]=t[0];if("a"===r||"A"===r)vh[1]=e*t[1],vh[2]=n*t[2],vh[3]=t[3],vh[4]=t[4],vh[5]=t[5],vh[6]=e*t[6],vh[7]=n*t[7];else if("h"===r||"H"===r)vh[1]=e*t[1];else if("v"===r||"V"===r)vh[1]=n*t[1];else for(var i=1,s=t.length;i<s;++i)vh[i]=(i%2==1?e:n)*t[i];return vh}var xh=function(t,e,n,r,i,s){var o,a,l,u,c,h=null,d=0,f=0,p=0,m=0;null==n&&(n=0),null==r&&(r=0),null==i&&(i=1),null==s&&(s=i),t.beginPath&&t.beginPath();for(var g=0,y=e.length;g<y;++g){switch(o=e[g],1===i&&1===s||(o=bh(o,i,s)),o[0]){case"l":t.lineTo((d+=o[1])+n,(f+=o[2])+r);break;case"L":t.lineTo((d=o[1])+n,(f=o[2])+r);break;case"h":t.lineTo((d+=o[1])+n,f+r);break;case"H":t.lineTo((d=o[1])+n,f+r);break;case"v":t.lineTo(d+n,(f+=o[1])+r);break;case"V":t.lineTo(d+n,(f=o[1])+r);break;case"m":t.moveTo((d+=o[1])+n,(f+=o[2])+r);break;case"M":t.moveTo((d=o[1])+n,(f=o[2])+r);break;case"c":t.bezierCurveTo(d+o[1]+n,f+o[2]+r,(p=d+o[3])+n,(m=f+o[4])+r,(a=d+o[5])+n,(l=f+o[6])+r),d=a,f=l;break;case"C":t.bezierCurveTo(o[1]+n,o[2]+r,(p=o[3])+n,(m=o[4])+r,(d=o[5])+n,(f=o[6])+r);break;case"s":t.bezierCurveTo((p=2*d-p)+n,(m=2*f-m)+r,d+o[1]+n,f+o[2]+r,(a=d+o[3])+n,(l=f+o[4])+r),p=d+o[1],m=f+o[2],d=a,f=l;break;case"S":t.bezierCurveTo((p=2*d-p)+n,(m=2*f-m)+r,o[1]+n,o[2]+r,(a=o[3])+n,(l=o[4])+r),d=a,f=l,p=o[1],m=o[2];break;case"q":t.quadraticCurveTo((p=d+o[1])+n,(m=f+o[2])+r,(a=d+o[3])+n,(l=f+o[4])+r),d=a,f=l;break;case"Q":t.quadraticCurveTo(o[1]+n,o[2]+r,(a=o[3])+n,(l=o[4])+r),d=a,f=l,p=o[1],m=o[2];break;case"t":a=d+o[1],l=f+o[2],null===h[0].match(/[QqTt]/)?(p=d,m=f):"t"===h[0]?(p=2*d-u,m=2*f-c):"q"===h[0]&&(p=2*d-p,m=2*f-m),u=p,c=m,t.quadraticCurveTo(p+n,m+r,a+n,l+r),p=(d=a)+o[1],m=(f=l)+o[2];break;case"T":t.quadraticCurveTo((p=2*d-p)+n,(m=2*f-m)+r,(a=o[1])+n,(l=o[2])+r),d=a,f=l;break;case"a":_h(t,d+n,f+r,[o[1],o[2],o[3],o[4],o[5],o[6]+d+n,o[7]+f+r]),d+=o[6],f+=o[7];break;case"A":_h(t,d+n,f+r,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+r]),d=o[6],f=o[7];break;case"z":case"Z":t.closePath()}h=o}};function _h(t,e,n,r){for(var i=function(t,e,n,r,i,s,o,a,l){var u=gh.call(arguments);if(ph[u])return ph[u];var c=o*ch,h=Math.sin(c),d=Math.cos(c),f=d*(a-t)*.5+h*(l-e)*.5,p=d*(l-e)*.5-h*(a-t)*.5,m=f*f/((n=Math.abs(n))*n)+p*p/((r=Math.abs(r))*r);m>1&&(n*=m=Math.sqrt(m),r*=m);var g=d/n,y=h/n,v=-h/r,b=d/r,x=g*a+y*l,_=v*a+b*l,w=g*t+y*e,S=v*t+b*e,C=(w-x)*(w-x)+(S-_)*(S-_),E=1/C-.25;E<0&&(E=0);var k=Math.sqrt(E);s==i&&(k=-k);var A=.5*(x+w)-k*(S-_),D=.5*(_+S)+k*(w-x),N=Math.atan2(_-D,x-A),T=Math.atan2(S-D,w-A),O=T-N;O<0&&1===s?O+=dh:O>0&&0===s&&(O-=dh);for(var I=Math.ceil(Math.abs(O/(hh+.001))),R=[],F=0;F<I;++F){var M=N+F*O/I,$=N+(F+1)*O/I;R[F]=[A,D,M,$,n,r,h,d]}return ph[u]=R}(r[5],r[6],r[0],r[1],r[3],r[4],r[2],e,n),s=0;s<i.length;++s){var o=yh(i[s]);t.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5])}}var wh=.5773502691896257,Sh={circle:{draw:function(t,e){var n=Math.sqrt(e)/2;t.moveTo(n,0),t.arc(0,0,n,0,dh)}},cross:{draw:function(t,e){var n=Math.sqrt(e)/2,r=n/2.5;t.moveTo(-n,-r),t.lineTo(-n,r),t.lineTo(-r,r),t.lineTo(-r,n),t.lineTo(r,n),t.lineTo(r,r),t.lineTo(n,r),t.lineTo(n,-r),t.lineTo(r,-r),t.lineTo(r,-n),t.lineTo(-r,-n),t.lineTo(-r,-r),t.closePath()}},diamond:{draw:function(t,e){var n=Math.sqrt(e)/2;t.moveTo(-n,0),t.lineTo(0,-n),t.lineTo(n,0),t.lineTo(0,n),t.closePath()}},square:{draw:function(t,e){var n=Math.sqrt(e),r=-n/2;t.rect(r,r,n,n)}},arrow:{draw:function(t,e){var n=Math.sqrt(e)/2,r=n/7,i=n/2.5,s=n/8;t.moveTo(-r,n),t.lineTo(r,n),t.lineTo(r,-s),t.lineTo(i,-s),t.lineTo(0,-n),t.lineTo(-i,-s),t.lineTo(-r,-s),t.closePath()}},wedge:{draw:function(t,e){var n=Math.sqrt(e)/2,r=fh*n,i=r-n*wh,s=n/4;t.moveTo(0,-r-i),t.lineTo(-s,r-i),t.lineTo(s,r-i),t.closePath()}},triangle:{draw:function(t,e){var n=Math.sqrt(e)/2,r=fh*n,i=r-n*wh;t.moveTo(0,-r-i),t.lineTo(-n,r-i),t.lineTo(n,r-i),t.closePath()}},"triangle-up":{draw:function(t,e){var n=Math.sqrt(e)/2,r=fh*n;t.moveTo(0,-r),t.lineTo(-n,r),t.lineTo(n,r),t.closePath()}},"triangle-down":{draw:function(t,e){var n=Math.sqrt(e)/2,r=fh*n;t.moveTo(0,r),t.lineTo(-n,-r),t.lineTo(n,-r),t.closePath()}},"triangle-right":{draw:function(t,e){var n=Math.sqrt(e)/2,r=fh*n;t.moveTo(r,0),t.lineTo(-r,-n),t.lineTo(-r,n),t.closePath()}},"triangle-left":{draw:function(t,e){var n=Math.sqrt(e)/2,r=fh*n;t.moveTo(-r,0),t.lineTo(r,-n),t.lineTo(r,n),t.closePath()}},stroke:{draw:function(t,e){var n=Math.sqrt(e)/2;t.moveTo(-n,0),t.lineTo(n,0)}}};function Ch(t){return ze(Sh,t)?Sh[t]:function(t){if(!ze(Eh,t)){var e=uh(t);Eh[t]={draw:function(t,n){xh(t,e,0,0,Math.sqrt(n)/2)}}}return Eh[t]}(t)}var Eh={},kh=Math.PI,Ah=2*kh,Dh=Ah-1e-6;function Nh(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function Th(){return new Nh}Nh.prototype=Th.prototype={constructor:Nh,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,n,r){this._+="Q"+ +t+","+ +e+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(t,e,n,r,i,s){this._+="C"+ +t+","+ +e+","+ +n+","+ +r+","+(this._x1=+i)+","+(this._y1=+s)},arcTo:function(t,e,n,r,i){var s=this._x1,o=this._y1,a=(n=+n)-(t=+t),l=(r=+r)-(e=+e),u=s-t,c=o-e,h=u*u+c*c;if((i=+i)<0)throw new Error("negative radius: "+i);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(h>1e-6)if(Math.abs(c*a-l*u)>1e-6&&i){var d=n-s,f=r-o,p=a*a+l*l,m=d*d+f*f,g=Math.sqrt(p),y=Math.sqrt(h),v=i*Math.tan((kh-Math.acos((p+h-m)/(2*g*y)))/2),b=v/y,x=v/g;Math.abs(b-1)>1e-6&&(this._+="L"+(t+b*u)+","+(e+b*c)),this._+="A"+i+","+i+",0,0,"+ +(c*d>u*f)+","+(this._x1=t+x*a)+","+(this._y1=e+x*l)}else this._+="L"+(this._x1=t)+","+(this._y1=e)},arc:function(t,e,n,r,i,s){t=+t,e=+e,s=!!s;var o=(n=+n)*Math.cos(r),a=n*Math.sin(r),l=t+o,u=e+a,c=1^s,h=s?r-i:i-r;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+l+","+u:(Math.abs(this._x1-l)>1e-6||Math.abs(this._y1-u)>1e-6)&&(this._+="L"+l+","+u),n&&(h<0&&(h=h%Ah+Ah),h>Dh?this._+="A"+n+","+n+",0,1,"+c+","+(t-o)+","+(e-a)+"A"+n+","+n+",0,1,"+c+","+(this._x1=l)+","+(this._y1=u):h>1e-6&&(this._+="A"+n+","+n+",0,"+ +(h>=kh)+","+c+","+(this._x1=t+n*Math.cos(i))+","+(this._y1=e+n*Math.sin(i))))},rect:function(t,e,n,r){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};var Oh=Th;const Ih=.448084975506;function Rh(t){return t.x}function Fh(t){return t.y}function Mh(t){return t.width}function $h(t){return t.height}function Ph(t){return"function"==typeof t?t:()=>+t}function zh(t,e,n){return Math.max(e,Math.min(t,n))}var Lh=function(){var t=Rh,e=Fh,n=Mh,r=$h,i=Ph(0),s=i,o=i,a=i,l=null;function u(u,c,h){var d,f=null!=c?c:+t.call(this,u),p=null!=h?h:+e.call(this,u),m=+n.call(this,u),g=+r.call(this,u),y=Math.min(m,g)/2,v=zh(+i.call(this,u),0,y),b=zh(+s.call(this,u),0,y),x=zh(+o.call(this,u),0,y),_=zh(+a.call(this,u),0,y);if(l||(l=d=Oh()),v<=0&&b<=0&&x<=0&&_<=0)l.rect(f,p,m,g);else{var w=f+m,S=p+g;l.moveTo(f+v,p),l.lineTo(w-b,p),l.bezierCurveTo(w-Ih*b,p,w,p+Ih*b,w,p+b),l.lineTo(w,S-_),l.bezierCurveTo(w,S-Ih*_,w-Ih*_,S,w-_,S),l.lineTo(f+x,S),l.bezierCurveTo(f+Ih*x,S,f,S-Ih*x,f,S-x),l.lineTo(f,p+v),l.bezierCurveTo(f,p+Ih*v,f+Ih*v,p,f+v,p),l.closePath()}if(d)return l=null,d+""||null}return u.x=function(e){return arguments.length?(t=Ph(e),u):t},u.y=function(t){return arguments.length?(e=Ph(t),u):e},u.width=function(t){return arguments.length?(n=Ph(t),u):n},u.height=function(t){return arguments.length?(r=Ph(t),u):r},u.cornerRadius=function(t,e,n,r){return arguments.length?(i=Ph(t),s=null!=e?Ph(e):i,a=null!=n?Ph(n):i,o=null!=r?Ph(r):s,u):i},u.context=function(t){return arguments.length?(l=null==t?null:t,u):l},u},Bh=function(){var t,e,n,r,i,s,o,a,l=null;function u(t,e,n){var r=n/2;if(i){var u=o-e,c=t-s;if(u||c){var h=Math.sqrt(u*u+c*c),d=(u/=h)*a,f=(c/=h)*a,p=Math.atan2(c,u);l.moveTo(s-d,o-f),l.lineTo(t-u*r,e-c*r),l.arc(t,e,r,p-Math.PI,p),l.lineTo(s+d,o+f),l.arc(s,o,a,p,p+Math.PI)}else l.arc(t,e,r,0,dh);l.closePath()}else i=1;s=t,o=e,a=r}function c(s){var o,a,c,h=s.length,d=!1;for(null==l&&(l=c=Oh()),o=0;o<=h;++o)!(o<h&&r(a=s[o],o,s))===d&&(d=!d)&&(i=0),d&&u(+t(a,o,s),+e(a,o,s),+n(a,o,s));if(c)return l=null,c+""||null}return c.x=function(e){return arguments.length?(t=e,c):t},c.y=function(t){return arguments.length?(e=t,c):e},c.size=function(t){return arguments.length?(n=t,c):n},c.defined=function(t){return arguments.length?(r=t,c):r},c.context=function(t){return arguments.length?(l=null==t?null:t,c):l},c},jh=function(t){return function(){return t}};function Uh(t){return t.innerRadius}function Vh(t){return t.outerRadius}function Wh(t){return t.startAngle}function qh(t){return t.endAngle}function Hh(t){return t&&t.padAngle}function Gh(t,e,n,r,i,s,o,a){var l=n-t,u=r-e,c=o-i,h=a-s,d=h*l-c*u;if(!(d*d<1e-12))return[t+(d=(c*(e-s)-h*(t-i))/d)*l,e+d*u]}function Yh(t,e,n,r,i,s,o){var a=t-n,l=e-r,u=(o?s:-s)/Rc(a*a+l*l),c=u*l,h=-u*a,d=t+c,f=e+h,p=n+c,m=r+h,g=(d+p)/2,y=(f+m)/2,v=p-d,b=m-f,x=v*v+b*b,_=i-s,w=d*m-p*f,S=(b<0?-1:1)*Rc(Tc(0,_*_*x-w*w)),C=(w*b-v*S)/x,E=(-w*v-b*S)/x,k=(w*b+v*S)/x,A=(-w*v+b*S)/x,D=C-g,N=E-y,T=k-g,O=A-y;return D*D+N*N>T*T+O*O&&(C=k,E=A),{cx:C,cy:E,x01:-c,y01:-h,x11:C*(i/_-1),y11:E*(i/_-1)}}function Kh(t){return t[0]}function Xh(t){return t[1]}var Zh=function(){var t=Kh,e=Xh,n=jh(!0),r=null,i=Gc,s=null;function o(o){var a,l,u,c=o.length,h=!1;for(null==r&&(s=i(u=Oh())),a=0;a<=c;++a)!(a<c&&n(l=o[a],a,o))===h&&((h=!h)?s.lineStart():s.lineEnd()),h&&s.point(+t(l,a,o),+e(l,a,o));if(u)return s=null,u+""||null}return o.x=function(e){return arguments.length?(t="function"==typeof e?e:jh(+e),o):t},o.y=function(t){return arguments.length?(e="function"==typeof t?t:jh(+t),o):e},o.defined=function(t){return arguments.length?(n="function"==typeof t?t:jh(!!t),o):n},o.curve=function(t){return arguments.length?(i=t,null!=r&&(s=i(r)),o):i},o.context=function(t){return arguments.length?(null==t?r=s=null:s=i(r=t),o):r},o},Qh=function(){var t=Kh,e=null,n=jh(0),r=Xh,i=jh(!0),s=null,o=Gc,a=null;function l(l){var u,c,h,d,f,p=l.length,m=!1,g=new Array(p),y=new Array(p);for(null==s&&(a=o(f=Oh())),u=0;u<=p;++u){if(!(u<p&&i(d=l[u],u,l))===m)if(m=!m)c=u,a.areaStart(),a.lineStart();else{for(a.lineEnd(),a.lineStart(),h=u-1;h>=c;--h)a.point(g[h],y[h]);a.lineEnd(),a.areaEnd()}m&&(g[u]=+t(d,u,l),y[u]=+n(d,u,l),a.point(e?+e(d,u,l):g[u],r?+r(d,u,l):y[u]))}if(f)return a=null,f+""||null}function u(){return Zh().defined(i).curve(o).context(s)}return l.x=function(n){return arguments.length?(t="function"==typeof n?n:jh(+n),e=null,l):t},l.x0=function(e){return arguments.length?(t="function"==typeof e?e:jh(+e),l):t},l.x1=function(t){return arguments.length?(e=null==t?null:"function"==typeof t?t:jh(+t),l):e},l.y=function(t){return arguments.length?(n="function"==typeof t?t:jh(+t),r=null,l):n},l.y0=function(t){return arguments.length?(n="function"==typeof t?t:jh(+t),l):n},l.y1=function(t){return arguments.length?(r=null==t?null:"function"==typeof t?t:jh(+t),l):r},l.lineX0=l.lineY0=function(){return u().x(t).y(n)},l.lineY1=function(){return u().x(t).y(r)},l.lineX1=function(){return u().x(e).y(n)},l.defined=function(t){return arguments.length?(i="function"==typeof t?t:jh(!!t),l):i},l.curve=function(t){return arguments.length?(o=t,null!=s&&(a=o(s)),l):o},l.context=function(t){return arguments.length?(null==t?s=a=null:a=o(s=t),l):s},l},Jh={draw:function(t,e){var n=Math.sqrt(e/Fc);t.moveTo(n,0),t.arc(0,0,n,0,$c)}};function td(t,e){return null!=t?t:e}Math.sqrt(1/3),Math.sin(Fc/10),Math.sin(7*Fc/10),Math.sin($c/10),Math.cos($c/10),Math.sqrt(3),Math.sqrt(3),Math.sqrt(12);const ed=t=>t.x||0,nd=t=>t.y||0,rd=t=>!(!1===t.defined),id=function(){var t=Uh,e=Vh,n=jh(0),r=null,i=Wh,s=qh,o=Hh,a=null;function l(){var l,u,c=+t.apply(this,arguments),h=+e.apply(this,arguments),d=i.apply(this,arguments)-Mc,f=s.apply(this,arguments)-Mc,p=Ac(f-d),m=f>d;if(a||(a=l=Oh()),h<c&&(u=h,h=c,c=u),h>1e-12)if(p>$c-1e-12)a.moveTo(h*Nc(d),h*Ic(d)),a.arc(0,0,h,d,f,!m),c>1e-12&&(a.moveTo(c*Nc(f),c*Ic(f)),a.arc(0,0,c,f,d,m));else{var g,y,v=d,b=f,x=d,_=f,w=p,S=p,C=o.apply(this,arguments)/2,E=C>1e-12&&(r?+r.apply(this,arguments):Rc(c*c+h*h)),k=Oc(Ac(h-c)/2,+n.apply(this,arguments)),A=k,D=k;if(E>1e-12){var N=zc(E/c*Ic(C)),T=zc(E/h*Ic(C));(w-=2*N)>1e-12?(x+=N*=m?1:-1,_-=N):(w=0,x=_=(d+f)/2),(S-=2*T)>1e-12?(v+=T*=m?1:-1,b-=T):(S=0,v=b=(d+f)/2)}var O=h*Nc(v),I=h*Ic(v),R=c*Nc(_),F=c*Ic(_);if(k>1e-12){var M,$=h*Nc(b),P=h*Ic(b),z=c*Nc(x),L=c*Ic(x);if(p<Fc&&(M=Gh(O,I,z,L,$,P,R,F))){var B=O-M[0],j=I-M[1],U=$-M[0],V=P-M[1],W=1/Ic(Pc((B*U+j*V)/(Rc(B*B+j*j)*Rc(U*U+V*V)))/2),q=Rc(M[0]*M[0]+M[1]*M[1]);A=Oc(k,(c-q)/(W-1)),D=Oc(k,(h-q)/(W+1))}}S>1e-12?D>1e-12?(g=Yh(z,L,O,I,h,D,m),y=Yh($,P,R,F,h,D,m),a.moveTo(g.cx+g.x01,g.cy+g.y01),D<k?a.arc(g.cx,g.cy,D,Dc(g.y01,g.x01),Dc(y.y01,y.x01),!m):(a.arc(g.cx,g.cy,D,Dc(g.y01,g.x01),Dc(g.y11,g.x11),!m),a.arc(0,0,h,Dc(g.cy+g.y11,g.cx+g.x11),Dc(y.cy+y.y11,y.cx+y.x11),!m),a.arc(y.cx,y.cy,D,Dc(y.y11,y.x11),Dc(y.y01,y.x01),!m))):(a.moveTo(O,I),a.arc(0,0,h,v,b,!m)):a.moveTo(O,I),c>1e-12&&w>1e-12?A>1e-12?(g=Yh(R,F,$,P,c,-A,m),y=Yh(O,I,z,L,c,-A,m),a.lineTo(g.cx+g.x01,g.cy+g.y01),A<k?a.arc(g.cx,g.cy,A,Dc(g.y01,g.x01),Dc(y.y01,y.x01),!m):(a.arc(g.cx,g.cy,A,Dc(g.y01,g.x01),Dc(g.y11,g.x11),!m),a.arc(0,0,c,Dc(g.cy+g.y11,g.cx+g.x11),Dc(y.cy+y.y11,y.cx+y.x11),m),a.arc(y.cx,y.cy,A,Dc(y.y11,y.x11),Dc(y.y01,y.x01),!m))):a.arc(0,0,c,_,x,m):a.lineTo(R,F)}else a.moveTo(0,0);if(a.closePath(),l)return a=null,l+""||null}return l.centroid=function(){var n=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,r=(+i.apply(this,arguments)+ +s.apply(this,arguments))/2-Fc/2;return[Nc(r)*n,Ic(r)*n]},l.innerRadius=function(e){return arguments.length?(t="function"==typeof e?e:jh(+e),l):t},l.outerRadius=function(t){return arguments.length?(e="function"==typeof t?t:jh(+t),l):e},l.cornerRadius=function(t){return arguments.length?(n="function"==typeof t?t:jh(+t),l):n},l.padRadius=function(t){return arguments.length?(r=null==t?null:"function"==typeof t?t:jh(+t),l):r},l.startAngle=function(t){return arguments.length?(i="function"==typeof t?t:jh(+t),l):i},l.endAngle=function(t){return arguments.length?(s="function"==typeof t?t:jh(+t),l):s},l.padAngle=function(t){return arguments.length?(o="function"==typeof t?t:jh(+t),l):o},l.context=function(t){return arguments.length?(a=null==t?null:t,l):a},l}().startAngle(t=>t.startAngle||0).endAngle(t=>t.endAngle||0).padAngle(t=>t.padAngle||0).innerRadius(t=>t.innerRadius||0).outerRadius(t=>t.outerRadius||0).cornerRadius(t=>t.cornerRadius||0),sd=Qh().x(ed).y1(nd).y0(t=>(t.y||0)+(t.height||0)).defined(rd),od=Qh().y(nd).x1(ed).x0(t=>(t.x||0)+(t.width||0)).defined(rd),ad=Zh().x(ed).y(nd).defined(rd),ld=Lh().x(ed).y(nd).width(t=>t.width||0).height(t=>t.height||0).cornerRadius(t=>td(t.cornerRadiusTopLeft,t.cornerRadius)||0,t=>td(t.cornerRadiusTopRight,t.cornerRadius)||0,t=>td(t.cornerRadiusBottomRight,t.cornerRadius)||0,t=>td(t.cornerRadiusBottomLeft,t.cornerRadius)||0),ud=function(){var t=jh(Jh),e=jh(64),n=null;function r(){var r;if(n||(n=r=Oh()),t.apply(this,arguments).draw(n,+e.apply(this,arguments)),r)return n=null,r+""||null}return r.type=function(e){return arguments.length?(t="function"==typeof e?e:jh(e),r):t},r.size=function(t){return arguments.length?(e="function"==typeof t?t:jh(+t),r):e},r.context=function(t){return arguments.length?(n=null==t?null:t,r):n},r}().type(t=>Ch(t.shape||"circle")).size(t=>td(t.size,64)),cd=Bh().x(ed).y(nd).defined(rd).size(t=>t.size||1);function hd(t){return t.cornerRadius||t.cornerRadiusTopLeft||t.cornerRadiusTopRight||t.cornerRadiusBottomRight||t.cornerRadiusBottomLeft}function dd(t,e,n,r){return ld.context(t)(e,n,r)}var fd=1;function pd(){fd=1}var md=function(t,e,n){var r=e.clip,i=t._defs,s=e.clip_id||(e.clip_id="clip"+fd++),o=i.clipping[s]||(i.clipping[s]={id:s});return ke(r)?o.path=r(null):hd(n)?o.path=dd(null,n,0,0):(o.width=n.width||0,o.height=n.height||0),"url(#"+s+")"};function gd(t){this.clear(),t&&this.union(t)}var yd=gd.prototype;function vd(t){this.mark=t,this.bounds=this.bounds||new gd}function bd(t){vd.call(this,t),this.items=this.items||[]}function xd(t,e){if("undefined"!=typeof document&&document.createElement){var n=document.createElement("canvas");if(n&&n.getContext)return n.width=t,n.height=e,n}return null}function _d(){return"undefined"!=typeof Image?Image:null}function wd(t){this._pending=0,this._loader=t||ea()}yd.clone=function(){return new gd(this)},yd.clear=function(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},yd.empty=function(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},yd.equals=function(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2},yd.set=function(t,e,n,r){return n<t?(this.x2=t,this.x1=n):(this.x1=t,this.x2=n),r<e?(this.y2=e,this.y1=r):(this.y1=e,this.y2=r),this},yd.add=function(t,e){return t<this.x1&&(this.x1=t),e<this.y1&&(this.y1=e),t>this.x2&&(this.x2=t),e>this.y2&&(this.y2=e),this},yd.expand=function(t){return this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t,this},yd.round=function(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},yd.scale=function(t){return this.x1*=t,this.y1*=t,this.x2*=t,this.y2*=t,this},yd.translate=function(t,e){return this.x1+=t,this.x2+=t,this.y1+=e,this.y2+=e,this},yd.rotate=function(t,e,n){const r=this.rotatedPoints(t,e,n);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])},yd.rotatedPoints=function(t,e,n){var{x1:r,y1:i,x2:s,y2:o}=this,a=Math.cos(t),l=Math.sin(t),u=e-e*a+n*l,c=n-e*l-n*a;return[a*r-l*i+u,l*r+a*i+c,a*r-l*o+u,l*r+a*o+c,a*s-l*i+u,l*s+a*i+c,a*s-l*o+u,l*s+a*o+c]},yd.union=function(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this},yd.intersect=function(t){return t.x1>this.x1&&(this.x1=t.x1),t.y1>this.y1&&(this.y1=t.y1),t.x2<this.x2&&(this.x2=t.x2),t.y2<this.y2&&(this.y2=t.y2),this},yd.encloses=function(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2},yd.alignsWith=function(t){return t&&(this.x1==t.x1||this.x2==t.x2||this.y1==t.y1||this.y2==t.y2)},yd.intersects=function(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)},yd.contains=function(t,e){return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)},yd.width=function(){return this.x2-this.x1},yd.height=function(){return this.y2-this.y1},Ue(bd,vd);var Sd=wd.prototype;function Cd(t){t._pending+=1}function Ed(t){t._pending-=1}Sd.pending=function(){return this._pending},Sd.sanitizeURL=function(t){var e=this;return Cd(e),e._loader.sanitize(t,{context:"href"}).then((function(t){return Ed(e),t})).catch((function(){return Ed(e),null}))},Sd.loadImage=function(t){const e=this,n=_d();return Cd(e),e._loader.sanitize(t,{context:"image"}).then((function(t){const r=t.href;if(!r||!n)throw{url:r};const i=new n,s=ze(t,"crossOrigin")?t.crossOrigin:"anonymous";return null!=s&&(i.crossOrigin=s),i.onload=()=>Ed(e),i.onerror=()=>Ed(e),i.src=r,i})).catch((function(t){return Ed(e),{complete:!1,width:0,height:0,src:t&&t.url||""}}))},Sd.ready=function(){var t=this;return new Promise((function(e){!function n(r){t.pending()?setTimeout((function(){n(!0)}),10):e(r)}(!1)}))};var kd,Ad,Dd,Nd=function(t,e,n){if(e.stroke&&0!==e.opacity&&0!==e.strokeOpacity){const r=null!=e.strokeWidth?+e.strokeWidth:1;t.expand(r+(n?function(t,e){return t.strokeJoin&&"miter"!==t.strokeJoin?0:e}(e,r):0))}return t},Td=dh-1e-8;function Od(t){return kd=t,Od}function Id(){}function Rd(t,e){kd.add(t,e)}function Fd(t,e){Rd(Ad=t,Dd=e)}function Md(t){Rd(t,kd.y1)}function $d(t){Rd(kd.x1,t)}function Pd(t,e,n,r){const i=(t-e)/(t+n-2*e);0<i&&i<1&&r(t+(e-t)*i)}function zd(t,e,n,r,i){const s=r-t+3*e-3*n,o=t+n-2*e,a=t-e;let l,u=0,c=0;Math.abs(s)>1e-14?(l=o*o+a*s,l>=0&&(l=Math.sqrt(l),u=(-o+l)/s,c=(-o-l)/s)):u=.5*a/o,0<u&&u<1&&i(Ld(u,t,e,n,r)),0<c&&c<1&&i(Ld(c,t,e,n,r))}function Ld(t,e,n,r,i){const s=1-t,o=s*s,a=t*t;return o*s*e+3*o*t*n+3*s*a*r+a*t*i}Od.beginPath=Id,Od.closePath=Id,Od.moveTo=Fd,Od.lineTo=Fd,Od.rect=function(t,e,n,r){Rd(t+n,e+r),Fd(t,e)},Od.quadraticCurveTo=function(t,e,n,r){Pd(Ad,t,n,Md),Pd(Dd,e,r,$d),Fd(n,r)},Od.bezierCurveTo=function(t,e,n,r,i,s){zd(Ad,t,n,i,Md),zd(Dd,e,r,s,$d),Fd(i,s)},Od.arc=function(t,e,n,r,i,s){if(Ad=n*Math.cos(i)+t,Dd=n*Math.sin(i)+e,Math.abs(i-r)>Td)Rd(t-n,e-n),Rd(t+n,e+n);else{const o=r=>Rd(n*Math.cos(r)+t,n*Math.sin(r)+e);let a,l;if(o(r),o(i),i!==r)if((r%=dh)<0&&(r+=dh),(i%=dh)<0&&(i+=dh),i<r&&(s=!s,a=r,r=i,i=a),s)for(i-=dh,a=r-r%hh,l=0;l<4&&a>i;++l,a-=hh)o(a);else for(a=r-r%hh+hh,l=0;l<4&&a<i;++l,a+=hh)o(a)}};var Bd=(Bd=xd(1,1))?Bd.getContext("2d"):null;const jd=new gd;function Ud(t){return function(e,n){if(!Bd)return!0;t(Bd,e),jd.clear().union(e.bounds).intersect(n).round();const{x1:r,y1:i,x2:s,y2:o}=jd;for(let t=i;t<=o;++t)for(let e=r;e<=s;++e)if(Bd.isPointInPath(e,t))return!0;return!1}}function Vd(t,e){return e.contains(t.x||0,t.y||0)}function Wd(t,e){const n=t.x||0,r=t.y||0;return e.intersects(jd.set(n,r,n+(t.width||0),r+(t.height||0)))}function qd(t,e){const n=t.x||0,r=t.y||0;return Hd(e,n,r,null!=t.x2?t.x2:n,null!=t.y2?t.y2:r)}function Hd(t,e,n,r,i){const{x1:s,y1:o,x2:a,y2:l}=t,u=r-e,c=i-n;let h,d,f,p,m=0,g=1;for(p=0;p<4;++p){if(0===p&&(h=-u,d=-(s-e)),1===p&&(h=u,d=a-e),2===p&&(h=-c,d=-(o-n)),3===p&&(h=c,d=l-n),Math.abs(h)<1e-10&&d<0)return!1;if(f=d/h,h<0){if(f>g)return!1;f>m&&(m=f)}else if(h>0){if(f<m)return!1;f<g&&(g=f)}}return!0}var Gd=function(t,e){t.globalCompositeOperation=e.blend||"source-over"},Yd=function(t,e){return null==t?e:t};function Kd(t,e){const n=e.length;for(let r=0;r<n;++r)t.addColorStop(e[r].offset,e[r].color);return t}var Xd=function(t,e,n){return uc(n)?function(t,e,n){const r=n.width(),i=n.height();let s;if("radial"===e.gradient)s=t.createRadialGradient(n.x1+Yd(e.x1,.5)*r,n.y1+Yd(e.y1,.5)*i,Math.max(r,i)*Yd(e.r1,0),n.x1+Yd(e.x2,.5)*r,n.y1+Yd(e.y2,.5)*i,Math.max(r,i)*Yd(e.r2,.5));else{const o=Yd(e.x1,0),a=Yd(e.y1,0),l=Yd(e.x2,1),u=Yd(e.y2,0);if(o!==l&&a!==u&&r!==i){const n=xd(Math.ceil(r),Math.ceil(i)),s=n.getContext("2d");return s.scale(r,i),s.fillStyle=Kd(s.createLinearGradient(o,a,l,u),e.stops),s.fillRect(0,0,r,i),t.createPattern(n,"no-repeat")}s=t.createLinearGradient(n.x1+o*r,n.y1+a*i,n.x1+l*r,n.y1+u*i)}return Kd(s,e.stops)}(t,n,e.bounds):n},Zd=function(t,e,n){return(n*=null==e.fillOpacity?1:e.fillOpacity)>0&&(t.globalAlpha=n,t.fillStyle=Xd(t,e,e.fill),!0)},Qd=[],Jd=function(t,e,n){var r=null!=(r=e.strokeWidth)?r:1;return!(r<=0)&&(n*=null==e.strokeOpacity?1:e.strokeOpacity)>0&&(t.globalAlpha=n,t.strokeStyle=Xd(t,e,e.stroke),t.lineWidth=r,t.lineCap=e.strokeCap||"butt",t.lineJoin=e.strokeJoin||"miter",t.miterLimit=e.strokeMiterLimit||10,t.setLineDash&&(t.setLineDash(e.strokeDash||Qd),t.lineDashOffset=e.strokeDashOffset||0),!0)};function tf(t,e){return t.zindex-e.zindex||t.index-e.index}function ef(t){if(!t.zdirty)return t.zitems;var e,n,r,i=t.items,s=[];for(n=0,r=i.length;n<r;++n)(e=i[n]).index=n,e.zindex&&s.push(e);return t.zdirty=!1,t.zitems=s.sort(tf)}function nf(t,e){var n,r,i=t.items;if(i&&i.length){var s=ef(t);if(s&&s.length){for(n=0,r=i.length;n<r;++n)i[n].zindex||e(i[n]);i=s}for(n=0,r=i.length;n<r;++n)e(i[n])}}function rf(t,e){var n,r,i=t.items;if(!i||!i.length)return null;var s=ef(t);for(s&&s.length&&(i=s),r=i.length;--r>=0;)if(n=e(i[r]))return n;if(i===s)for(r=(i=t.items).length;--r>=0;)if(!i[r].zindex&&(n=e(i[r])))return n;return null}function sf(t){return function(e,n,r){nf(n,(function(n){r&&!r.intersects(n.bounds)||of(t,e,n,n)}))}}function of(t,e,n,r){var i=null==n.opacity?1:n.opacity;0!==i&&(t(e,r)||(Gd(e,n),n.fill&&Zd(e,n,i)&&e.fill(),n.stroke&&Jd(e,n,i)&&e.stroke()))}function af(t){return t=t||Wt,function(e,n,r,i,s,o){return r*=e.pixelRatio,i*=e.pixelRatio,rf(n,(function(n){var a=n.bounds;if((!a||a.contains(s,o))&&a)return t(e,n,r,i,s,o)?n:void 0}))}}function lf(t,e){return function(n,r,i,s){var o,a,l=Array.isArray(r)?r[0]:r,u=null==e?l.fill:e,c=l.stroke&&n.isPointInStroke;return c&&(a=l.strokeCap,n.lineWidth=null!=(o=l.strokeWidth)?o:1,n.lineCap=null!=a?a:"butt"),!t(n,r)&&(u&&n.isPointInPath(i,s)||c&&n.isPointInStroke(i,s))}}function uf(t){return af(lf(t))}function cf(t,e){return"translate("+t+","+e+")"}function hf(t){return"rotate("+t+")"}function df(t){return cf(t.x||0,t.y||0)}function ff(t){return cf(t.x||0,t.y||0)+(t.angle?" "+hf(t.angle):"")+(t.scaleX||t.scaleY?" scale("+(t.scaleX||1)+","+(t.scaleY||1)+")":"")}var pf=function(t,e,n){function r(t,n){var r=n.x||0,i=n.y||0,s=n.angle||0;t.translate(r,i),s&&t.rotate(s*=ch),t.beginPath(),e(t,n),s&&t.rotate(-s),t.translate(-r,-i)}return{type:t,tag:"path",nested:!1,attr:function(t,n){t("transform",ff(n)),t("d",e(null,n))},bound:function(t,n){var r=n.x||0,i=n.y||0;return e(Od(t),n),Nd(t,n).translate(r,i),n.angle&&t.rotate(n.angle*ch,r,i),t},draw:sf(r),pick:uf(r),isect:n||Ud(r)}},mf=pf("arc",(function(t,e){return id.context(t)(e)})),gf=function(t,e,n){function r(t,n){t.beginPath(),e(t,n)}var i,s=lf(r);return{type:t,tag:"path",nested:!0,attr:function(t,n){var r=n.mark.items;r.length&&t("d",e(null,r))},bound:function(t,n){var r=n.items;return 0===r.length?t:(e(Od(t),r),Nd(t,r[0]))},draw:(i=r,function(t,e,n){!e.items.length||n&&!n.intersects(e.bounds)||of(i,t,e.items[0],e.items)}),pick:function(t,e,n,r,i,o){var a=e.items,l=e.bounds;return!a||!a.length||l&&!l.contains(i,o)?null:s(t,a,n*=t.pixelRatio,r*=t.pixelRatio)?a[0]:null},isect:Vd,tip:n}},yf=gf("area",(function(t,e){var n=e[0];return("horizontal"===n.orient?od:sd).curve(oh(n.interpolate||"linear",n.orient,n.tension)).context(t)(e)}),(function(t,e){for(var n,r,i="horizontal"===t[0].orient?e[1]:e[0],s="horizontal"===t[0].orient?"y":"x",o=t.length,a=1/0;--o>=0;)!1!==t[o].defined&&(r=Math.abs(t[o][s]-i))<a&&(a=r,n=t[o]);return n}));function vf(t,e){t.beginPath(),hd(e)?dd(t,e,0,0):t.rect(0,0,e.width||0,e.height||0),t.clip()}function bf(t){const e=Yd(t.strokeWidth,1);return null!=t.strokeOffset?t.strokeOffset:t.stroke&&e>.5&&e<1.5?.5-Math.abs(e-1):0}function xf(t,e){const n=bf(e);t("d",dd(null,e,n,n))}function _f(t,e,n,r){const i=bf(e);t.beginPath(),dd(t,e,(n||0)+i,(r||0)+i)}const wf=lf(_f),Sf=lf(_f,!1);var Cf={type:"group",tag:"g",nested:!1,attr:function(t,e){t("transform",df(e))},bound:function(t,e){if(!e.clip&&e.items){const n=e.items,r=n.length;for(let e=0;e<r;++e)t.union(n[e].bounds)}return(e.clip||e.width||e.height)&&!e.noBound&&t.add(0,0).add(e.width||0,e.height||0),Nd(t,e),t.translate(e.x||0,e.y||0)},draw:function(t,e,n){nf(e,e=>{const r=e.x||0,i=e.y||0,s=e.strokeForeground,o=null==e.opacity?1:e.opacity;(e.stroke||e.fill)&&o&&(_f(t,e,r,i),Gd(t,e),e.fill&&Zd(t,e,o)&&t.fill(),e.stroke&&!s&&Jd(t,e,o)&&t.stroke()),t.save(),t.translate(r,i),e.clip&&vf(t,e),n&&n.translate(-r,-i),nf(e,e=>{this.draw(t,e,n)}),n&&n.translate(r,i),t.restore(),s&&e.stroke&&o&&(_f(t,e,r,i),Gd(t,e),Jd(t,e,o)&&t.stroke())})},pick:function(t,e,n,r,i,s){if(e.bounds&&!e.bounds.contains(i,s)||!e.items)return null;const o=n*t.pixelRatio,a=r*t.pixelRatio;return rf(e,l=>{let u,c,h,d,f,p,m,g,y;if(g=l.bounds,(!g||g.contains(i,s))&&(d=l.x||0,f=l.y||0,p=d+(l.width||0),m=f+(l.height||0),y=l.clip,!y||!(i<d||i>p||s<f||s>m)))return t.save(),t.translate(d,f),d=i-d,f=s-f,y&&hd(l)&&!wf(t,l,o,a)?(t.restore(),null):(c=l.strokeForeground,h=!1!==e.interactive,h&&c&&l.stroke&&Sf(t,l,o,a)?(t.restore(),l):(u=rf(l,t=>function(t,e,n){return(!1!==t.interactive||"group"===t.marktype)&&t.bounds&&t.bounds.contains(e,n)}(t,d,f)?this.pick(t,n,r,d,f):null),!u&&h&&(l.fill||!c&&l.stroke)&&wf(t,l,o,a)&&(u=l),t.restore(),u||null))})},isect:Wd,content:function(t,e,n){t("clip-path",e.clip?md(n,e,e):null)},background:function(t,e){t("class","background"),t("aria-hidden",!0),xf(t,e)},foreground:function(t,e){t("class","foreground"),t("aria-hidden",!0),e.strokeForeground?xf(t,e):t("d","")}},Ef={version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"};function kf(t,e){var n=t.image;return(!n||t.url&&t.url!==n.url)&&(n={complete:!1,width:0,height:0},e.loadImage(t.url).then(e=>{t.image=e,t.image.url=t.url})),n}function Af(t,e){return null!=t.width?t.width:e&&e.width?!1!==t.aspect&&t.height?t.height*e.width/e.height:e.width:0}function Df(t,e){return null!=t.height?t.height:e&&e.height?!1!==t.aspect&&t.width?t.width*e.height/e.width:e.height:0}function Nf(t,e){return"center"===t?e/2:"right"===t?e:0}function Tf(t,e){return"middle"===t?e/2:"bottom"===t?e:0}var Of={type:"image",tag:"image",nested:!1,attr:function(t,e,n){const r=kf(e,n),i=Af(e,r),s=Df(e,r),o=(e.x||0)-Nf(e.align,i),a=(e.y||0)-Tf(e.baseline,s);t("href",!r.src&&r.toDataURL?r.toDataURL():r.src||"",Ef["xmlns:xlink"],"xlink:href"),t("transform",cf(o,a)),t("width",i),t("height",s),t("preserveAspectRatio",!1===e.aspect?"none":"xMidYMid")},bound:function(t,e){const n=e.image,r=Af(e,n),i=Df(e,n),s=(e.x||0)-Nf(e.align,r),o=(e.y||0)-Tf(e.baseline,i);return t.set(s,o,s+r,o+i)},draw:function(t,e,n){nf(e,e=>{if(n&&!n.intersects(e.bounds))return;let r,i,s,o,a=kf(e,this),l=Af(e,a),u=Df(e,a),c=(e.x||0)-Nf(e.align,l),h=(e.y||0)-Tf(e.baseline,u);!1!==e.aspect&&(i=a.width/a.height,s=e.width/e.height,i==i&&s==s&&i!==s&&(s<i?(o=l/i,h+=(u-o)/2,u=o):(o=u*i,c+=(l-o)/2,l=o))),(a.complete||a.toDataURL)&&(Gd(t,e),t.globalAlpha=null!=(r=e.opacity)?r:1,t.imageSmoothingEnabled=!1!==e.smooth,t.drawImage(a,c,h,l,u))})},pick:af(),isect:Wt,get:kf,xOffset:Nf,yOffset:Tf},If=gf("line",(function(t,e){var n=e[0];return ad.curve(oh(n.interpolate||"linear",n.orient,n.tension)).context(t)(e)}),(function(t,e){for(var n,r,i=Math.pow(t[0].strokeWidth||1,2),s=t.length;--s>=0;)if(!1!==t[s].defined&&(n=t[s].x-e[0])*n+(r=t[s].y-e[1])*r<i)return t[s];return null}));function Rf(t,e){var n=e.path;if(null==n)return!0;var r=e.x||0,i=e.y||0,s=e.scaleX||1,o=e.scaleY||1,a=(e.angle||0)*ch,l=e.pathCache;l&&l.path===n||((e.pathCache=l=uh(n)).path=n),a&&t.rotate&&t.translate?(t.translate(r,i),t.rotate(a),xh(t,l,0,0,s,o),t.rotate(-a),t.translate(-r,-i)):xh(t,l,r,i,s,o)}var Ff={type:"path",tag:"path",nested:!1,attr:function(t,e){1===(e.scaleX||1)&&1===(e.scaleY||1)||t("vector-effect","non-scaling-stroke"),t("transform",ff(e)),t("d",e.path)},bound:function(t,e){return Rf(Od(t),e)?t.set(0,0,0,0):Nd(t,e,!0),e.angle&&t.rotate(e.angle*ch,e.x||0,e.y||0),t},draw:sf(Rf),pick:uf(Rf),isect:Ud(Rf)};function Mf(t,e){t.beginPath(),dd(t,e)}var $f={type:"rect",tag:"path",nested:!1,attr:function(t,e){t("d",dd(null,e))},bound:function(t,e){var n,r;return Nd(t.set(n=e.x||0,r=e.y||0,n+e.width||0,r+e.height||0),e)},draw:sf(Mf),pick:uf(Mf),isect:Wd};function Pf(t,e,n){var r,i,s,o;return!(!e.stroke||!Jd(t,e,n)||(r=e.x||0,i=e.y||0,s=null!=e.x2?e.x2:r,o=null!=e.y2?e.y2:i,t.beginPath(),t.moveTo(r,i),t.lineTo(s,o),0))}var zf={type:"rule",tag:"line",nested:!1,attr:function(t,e){t("transform",df(e)),t("x2",null!=e.x2?e.x2-(e.x||0):0),t("y2",null!=e.y2?e.y2-(e.y||0):0)},bound:function(t,e){var n,r;return Nd(t.set(n=e.x||0,r=e.y||0,null!=e.x2?e.x2:n,null!=e.y2?e.y2:r),e)},draw:function(t,e,n){nf(e,(function(e){if(!n||n.intersects(e.bounds)){var r=null==e.opacity?1:e.opacity;r&&Pf(t,e,r)&&(Gd(t,e),t.stroke())}}))},pick:af((function(t,e,n,r){return!!t.isPointInStroke&&Pf(t,e,1)&&t.isPointInStroke(n,r)})),isect:qd},Lf=pf("shape",(function(t,e){return(e.mark.shape||e.shape).context(t)(e)})),Bf=pf("symbol",(function(t,e){return ud.context(t)(e)}),Vd);const jf=Ze();var Uf={height:Yf,measureWidth:Hf,estimateWidth:Wf,width:Wf,canvas:Vf};function Vf(t){Uf.width=t&&Bd?Hf:Wf}function Wf(t,e){return qf(Qf(t,e),Yf(t))}function qf(t,e){return~~(.8*t.length*e)}function Hf(t,e){return Yf(t)<=0||!(e=Qf(t,e))?0:Gf(e,tp(t))}function Gf(t,e){const n=`(${e}) ${t}`;let r=jf.get(n);return void 0===r&&(Bd.font=e,r=Bd.measureText(t).width,jf.set(n,r)),r}function Yf(t){return null!=t.fontSize?+t.fontSize||0:11}function Kf(t){return null!=t.lineHeight?t.lineHeight:Yf(t)+2}function Xf(t){return e=t.lineBreak&&t.text&&!Jt(t.text)?t.text.split(t.lineBreak):t.text,Jt(e)?e.length>1?e:e[0]:e;var e}function Zf(t){const e=Xf(t);return(Jt(e)?e.length-1:0)*Kf(t)}function Qf(t,e){const n=null==e?"":(e+"").trim();return t.limit>0&&n.length?function(t,e){var n=+t.limit,r=function(t){if(Uf.width===Hf){const e=tp(t);return t=>Gf(t,e)}{const e=Yf(t);return t=>qf(t,e)}}(t);if(r(e)<n)return e;var i,s=t.ellipsis||"\u2026",o="rtl"===t.dir,a=0,l=e.length;if(n-=r(s),o){for(;a<l;)r(e.slice(i=a+l>>>1))>n?a=i+1:l=i;return s+e.slice(a)}for(;a<l;)r(e.slice(0,i=1+(a+l>>>1)))<n?a=i:l=i-1;return e.slice(0,a)+s}(t,n):n}function Jf(t,e){var n=t.font;return(e&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function tp(t,e){return(t.fontStyle?t.fontStyle+" ":"")+(t.fontVariant?t.fontVariant+" ":"")+(t.fontWeight?t.fontWeight+" ":"")+Yf(t)+"px "+Jf(t,e)}function ep(t){var e=t.baseline,n=Yf(t);return Math.round("top"===e?.79*n:"middle"===e?.3*n:"bottom"===e?-.21*n:"line-top"===e?.29*n+.5*Kf(t):"line-bottom"===e?.29*n-.5*Kf(t):0)}Vf(!0);var np={left:"start",center:"middle",right:"end"},rp=new gd;function ip(t){var e,n=t.x||0,r=t.y||0,i=t.radius||0;return i&&(e=(t.theta||0)-hh,n+=i*Math.cos(e),r+=i*Math.sin(e)),rp.x1=n,rp.y1=r,rp}function sp(t,e,n){var r,i=Uf.height(e),s=e.align,o=ip(e),a=o.x1,l=o.y1,u=e.dx||0,c=(e.dy||0)+ep(e)-Math.round(.8*i),h=Xf(e);if(Jt(h)?(i+=Kf(e)*(h.length-1),r=h.reduce((t,n)=>Math.max(t,Uf.width(e,n)),0)):r=Uf.width(e,h),"center"===s?u-=r/2:"right"===s&&(u-=r),t.set(u+=a,c+=l,u+r,c+i),e.angle&&!n)t.rotate(e.angle*ch,a,l);else if(2===n)return t.rotatedPoints(e.angle*ch,a,l);return t}var op={arc:mf,area:yf,group:Cf,image:Of,line:If,path:Ff,rect:$f,rule:zf,shape:Lf,symbol:Bf,text:{type:"text",tag:"text",nested:!1,attr:function(t,e){var n,r=e.dx||0,i=(e.dy||0)+ep(e),s=ip(e),o=s.x1,a=s.y1,l=e.angle||0;t("text-anchor",np[e.align]||"start"),l?(n=cf(o,a)+" "+hf(l),(r||i)&&(n+=" "+cf(r,i))):n=cf(o+r,a+i),t("transform",n)},bound:sp,draw:function(t,e,n){nf(e,(function(e){var r,i,s,o,a,l,u,c=null==e.opacity?1:e.opacity;if(!(n&&!n.intersects(e.bounds)||0===c||e.fontSize<=0||null==e.text||0===e.text.length)){if(t.font=tp(e),t.textAlign=e.align||"left",i=(r=ip(e)).x1,s=r.y1,e.angle&&(t.save(),t.translate(i,s),t.rotate(e.angle*ch),i=s=0),i+=e.dx||0,s+=(e.dy||0)+ep(e),l=Xf(e),Gd(t,e),Jt(l))for(a=Kf(e),o=0;o<l.length;++o)u=Qf(e,l[o]),e.fill&&Zd(t,e,c)&&t.fillText(u,i,s),e.stroke&&Jd(t,e,c)&&t.strokeText(u,i,s),s+=a;else u=Qf(e,l),e.fill&&Zd(t,e,c)&&t.fillText(u,i,s),e.stroke&&Jd(t,e,c)&&t.strokeText(u,i,s);e.angle&&t.restore()}}))},pick:af((function(t,e,n,r,i,s){if(e.fontSize<=0)return!1;if(!e.angle)return!0;var o=ip(e),a=o.x1,l=o.y1,u=sp(rp,e,1),c=-e.angle*ch,h=Math.cos(c),d=Math.sin(c);return u.contains(h*i-d*s+(a-h*a+d*l),d*i+h*s+(l-d*a-h*l))})),isect:function(t,e){var n=sp(rp,t,2);return Hd(e,n[0],n[1],n[2],n[3])||Hd(e,n[0],n[1],n[4],n[5])||Hd(e,n[4],n[5],n[6],n[7])||Hd(e,n[2],n[3],n[6],n[7])}},trail:gf("trail",(function(t,e){return cd.context(t)(e)}),(function(t,e){for(var n,r,i=t.length;--i>=0;)if(!1!==t[i].defined&&(n=t[i].x-e[0])*n+(r=t[i].y-e[1])*r<(n=t[i].size||1)*n)return t[i];return null}))},ap=function(t,e,n){var r=op[t.mark.marktype];return r.nested&&(t=t.mark),(e||r.bound)(t.bounds||(t.bounds=new gd),t,n)},lp={mark:null},up=function(t,e,n){var r,i,s,o,a=op[t.marktype],l=a.bound,u=t.items,c=u&&u.length;if(a.nested)return c?s=u[0]:(lp.mark=t,s=lp),o=ap(s,l,n),e&&e.union(o)||o;if(e=e||t.bounds&&t.bounds.clear()||new gd,c)for(r=0,i=u.length;r<i;++r)e.union(ap(u[r],l,n));return t.bounds=e},cp=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function hp(t,e){return JSON.stringify(t,cp,e)}function dp(t){return function t(e){var n,r,i,s=e.marktype,o=e.items;if(o)for(r=0,i=o.length;r<i;++r)o[r][n=s?"mark":"group"]=e,o[r].zindex&&(o[r][n].zdirty=!0),"group"===(s||n)&&t(o[r]);return s&&up(e),e}("string"==typeof t?JSON.parse(t):t)}function fp(t){arguments.length?this.root=dp(t):(this.root=mp({marktype:"group",name:"root",role:"frame"}),this.root.items=[new bd(this.root)])}var pp=fp.prototype;function mp(t,e){const n={bounds:new gd,clip:!!t.clip,group:e,interactive:!1!==t.interactive,items:[],marktype:t.marktype,name:t.name||void 0,role:t.role||void 0,zindex:t.zindex||0};return null!=t.aria&&(n.aria=t.aria),t.description&&(n.description=t.description),n}function gp(t,e,n){return!t&&"undefined"!=typeof document&&document.createElement&&(t=document),t?n?t.createElementNS(n,e):t.createElement(e):null}function yp(t,e){e=e.toLowerCase();for(var n=t.childNodes,r=0,i=n.length;r<i;++r)if(n[r].tagName.toLowerCase()===e)return n[r]}function vp(t,e,n,r){var i,s=t.childNodes[e];return s&&s.tagName.toLowerCase()===n.toLowerCase()||(i=s||null,s=gp(t.ownerDocument,n,r),t.insertBefore(s,i)),s}function bp(t,e){for(var n=t.childNodes,r=n.length;r>e;)t.removeChild(n[--r]);return t}function xp(t){return"mark-"+t.marktype+(t.role?" role-"+t.role:"")+(t.name?" "+t.name:"")}pp.toJSON=function(t){return hp(this.root,t||0)},pp.mark=function(t,e,n){var r=mp(t,e=e||this.root.items[0]);return e.items[n]=r,r.zindex&&(r.group.zdirty=!0),r};var _p=function(t,e){var n=e.getBoundingClientRect();return[t.clientX-n.left-(e.clientLeft||0),t.clientY-n.top-(e.clientTop||0)]};function wp(t,e){this._active=null,this._handlers={},this._loader=t||ea(),this._tooltip=e||Sp}function Sp(t,e,n,r){t.element().setAttribute("title",r||"")}const Cp=wp.prototype;function Ep(t){this._el=null,this._bgcolor=null,this._loader=new wd(t)}Cp.initialize=function(t,e,n){return this._el=t,this._obj=n||null,this.origin(e)},Cp.element=function(){return this._el},Cp.canvas=function(){return this._el&&this._el.firstChild},Cp.origin=function(t){return arguments.length?(this._origin=t||[0,0],this):this._origin.slice()},Cp.scene=function(t){return arguments.length?(this._scene=t,this):this._scene},Cp.on=function(){},Cp.off=function(){},Cp._handlerIndex=function(t,e,n){for(let r=t?t.length:0;--r>=0;)if(t[r].type===e&&(!n||t[r].handler===n))return r;return-1},Cp.handlers=function(t){const e=this._handlers,n=[];if(t)n.push.apply(n,e[this.eventName(t)]);else for(const r in e)n.push.apply(n,e[r]);return n},Cp.eventName=function(t){const e=t.indexOf(".");return e<0?t:t.slice(0,e)},Cp.handleHref=function(t,e,n){this._loader.sanitize(n,{context:"href"}).then(e=>{const n=new MouseEvent(t.type,t),r=gp(null,"a");for(const t in e)r.setAttribute(t,e[t]);r.dispatchEvent(n)}).catch((function(){}))},Cp.handleTooltip=function(t,e,n){e&&null!=e.tooltip&&(e=function(t,e,n,r){var i,s,o=t&&t.mark;if(o&&(i=op[o.marktype]).tip){for((s=_p(e,n))[0]-=r[0],s[1]-=r[1];t=t.mark.group;)s[0]-=t.x||0,s[1]-=t.y||0;t=i.tip(o.items,s)}return t}(e,t,this.canvas(),this._origin),this._tooltip.call(this._obj,this,t,e,n&&e&&e.tooltip||null))},Cp.getItemBoundingClientRect=function(t){const e=this.canvas();if(!e)return;const n=e.getBoundingClientRect(),r=this._origin,i=t.bounds,s=i.width(),o=i.height();let a=i.x1+r[0]+n.left,l=i.y1+r[1]+n.top;for(;t.mark&&(t=t.mark.group);)a+=t.x||0,l+=t.y||0;return{x:a,y:l,width:s,height:o,left:a,top:l,right:a+s,bottom:l+o}};var kp=Ep.prototype;kp.initialize=function(t,e,n,r,i){return this._el=t,this.resize(e,n,r,i)},kp.element=function(){return this._el},kp.canvas=function(){return this._el&&this._el.firstChild},kp.background=function(t){return 0===arguments.length?this._bgcolor:(this._bgcolor=t,this)},kp.resize=function(t,e,n,r){return this._width=t,this._height=e,this._origin=n||[0,0],this._scale=r||1,this},kp.dirty=function(){},kp.render=function(t){var e=this;return e._call=function(){e._render(t)},e._call(),e._call=null,e},kp._render=function(){},kp.renderAsync=function(t){var e=this.render(t);return this._ready?this._ready.then((function(){return e})):Promise.resolve(e)},kp._load=function(t,e){var n=this,r=n._loader[t](e);if(!n._ready){var i=n._call;n._ready=n._loader.ready().then((function(t){t&&i(),n._ready=null}))}return r},kp.sanitizeURL=function(t){return this._load("sanitizeURL",t)},kp.loadImage=function(t){return this._load("loadImage",t)};const Ap="dragleave",Dp="mousedown",Np="mousemove",Tp="mouseout",Op="click",Ip=["keydown","keypress","keyup","dragenter",Ap,"dragover",Dp,"mouseup",Np,Tp,"mouseover",Op,"dblclick","wheel","mousewheel","touchstart","touchmove","touchend"],Rp=Np,Fp=Tp,Mp=Op;function $p(t,e){wp.call(this,t,e),this._down=null,this._touch=null,this._first=!0,this._events={}}const Pp=Ue($p,wp);function zp(t,e){(t=>"touchstart"===t||"touchmove"===t||"touchend"===t?["touchstart","touchmove","touchend"]:[t])(e).forEach(e=>function(t,e){const n=t.canvas();n&&!t._events[e]&&(t._events[e]=1,n.addEventListener(e,t[e]?n=>t[e](n):n=>t.fire(e,n)))}(t,e))}function Lp(t,e,n){return function(r){const i=this._active,s=this.pickEvent(r);s===i||(i&&i.exit||this.fire(n,r),this._active=s,this.fire(e,r)),this.fire(t,r)}}function Bp(t){return function(e){this.fire(t,e),this._active=null}}Pp.initialize=function(t,e,n){return this._canvas=t&&yp(t,"canvas"),[Op,Dp,Np,Tp,Ap].forEach(t=>zp(this,t)),wp.prototype.initialize.call(this,t,e,n)},Pp.canvas=function(){return this._canvas},Pp.context=function(){return this._canvas.getContext("2d")},Pp.events=Ip,Pp.DOMMouseScroll=function(t){this.fire("mousewheel",t)},Pp.mousemove=Lp(Np,"mouseover",Tp),Pp.dragover=Lp("dragover","dragenter",Ap),Pp.mouseout=Bp(Tp),Pp.dragleave=Bp(Ap),Pp.mousedown=function(t){this._down=this._active,this.fire(Dp,t)},Pp.click=function(t){this._down===this._active&&(this.fire(Op,t),this._down=null)},Pp.touchstart=function(t){this._touch=this.pickEvent(t.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire("touchstart",t,!0)},Pp.touchmove=function(t){this.fire("touchmove",t,!0)},Pp.touchend=function(t){this.fire("touchend",t,!0),this._touch=null},Pp.fire=function(t,e,n){const r=n?this._touch:this._active,i=this._handlers[t];if(e.vegaType=t,t===Mp&&r&&r.href?this.handleHref(e,r,r.href):t!==Rp&&t!==Fp||this.handleTooltip(e,r,t!==Fp),i)for(let s=0,o=i.length;s<o;++s)i[s].handler.call(this._obj,e,r)},Pp.on=function(t,e){const n=this.eventName(t),r=this._handlers;return this._handlerIndex(r[n],t,e)<0&&(zp(this,t),(r[n]||(r[n]=[])).push({type:t,handler:e})),this},Pp.off=function(t,e){const n=this.eventName(t),r=this._handlers[n],i=this._handlerIndex(r,t,e);return i>=0&&r.splice(i,1),this},Pp.pickEvent=function(t){const e=_p(t,this._canvas),n=this._origin;return this.pick(this._scene,e[0],e[1],e[0]-n[0],e[1]-n[1])},Pp.pick=function(t,e,n,r,i){const s=this.context();return op[t.marktype].pick.call(this,s,t,e,n,r,i)};var jp="undefined"!=typeof window&&window.devicePixelRatio||1;function Up(t){Ep.call(this,t),this._options={},this._redraw=!1,this._dirty=new gd,this._tempb=new gd}const Vp=Ue(Up,Ep),Wp=Ep.prototype;function qp(t,e){wp.call(this,t,e);const n=this;n._hrefHandler=Gp(n,(t,e)=>{e&&e.href&&n.handleHref(t,e,e.href)}),n._tooltipHandler=Gp(n,(t,e)=>{n.handleTooltip(t,e,t.type!==Fp)})}Vp.initialize=function(t,e,n,r,i,s){return this._options=s||{},this._canvas=this._options.externalContext?null:xd(1,1),t&&this._canvas&&(bp(t,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),Wp.initialize.call(this,t,e,n,r,i)},Vp.resize=function(t,e,n,r){if(Wp.resize.call(this,t,e,n,r),this._canvas)!function(t,e,n,r,i,s){const o="undefined"!=typeof HTMLElement&&t instanceof HTMLElement&&null!=t.parentNode,a=t.getContext("2d"),l=o?jp:i;t.width=e*l,t.height=n*l;for(const u in s)a[u]=s[u];o&&1!==l&&(t.style.width=e+"px",t.style.height=n+"px"),a.pixelRatio=l,a.setTransform(l,0,0,l,l*r[0],l*r[1])}(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const t=this._options.externalContext;t||$t("CanvasRenderer is missing a valid canvas or context"),t.scale(this._scale,this._scale),t.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},Vp.canvas=function(){return this._canvas},Vp.context=function(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},Vp.dirty=function(t){let e=this._tempb.clear().union(t.bounds),n=t.mark.group;for(;n;)e.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(e)},Vp._render=function(t){const e=this.context(),n=this._origin,r=this._width,i=this._height,s=this._dirty,o=(a=n,l=r,u=i,(new gd).set(0,0,l,u).translate(-a[0],-a[1]));var a,l,u;e.save();const c=this._redraw||s.empty()?(this._redraw=!1,o.expand(1)):function(t,e,n){return e.expand(1).round(),t.pixelRatio%1&&e.scale(t.pixelRatio).round().scale(1/t.pixelRatio),e.translate(-n[0]%1,-n[1]%1),t.beginPath(),t.rect(e.x1,e.y1,e.width(),e.height()),t.clip(),e}(e,o.intersect(s),n);return this.clear(-n[0],-n[1],r,i),this.draw(e,t,c),e.restore(),s.clear(),this},Vp.draw=function(t,e,n){const r=op[e.marktype];e.clip&&function(t,e){var n=e.clip;t.save(),ke(n)?(t.beginPath(),n(t),t.clip()):vf(t,e.group)}(t,e),r.draw.call(this,t,e,n),e.clip&&t.restore()},Vp.clear=function(t,e,n,r){const i=this._options,s=this.context();"pdf"===i.type||i.externalContext||s.clearRect(t,e,n,r),null!=this._bgcolor&&(s.fillStyle=this._bgcolor,s.fillRect(t,e,n,r))};const Hp=Ue(qp,wp);Hp.initialize=function(t,e,n){let r=this._svg;return r&&(r.removeEventListener(Mp,this._hrefHandler),r.removeEventListener(Rp,this._tooltipHandler),r.removeEventListener(Fp,this._tooltipHandler)),this._svg=r=t&&yp(t,"svg"),r&&(r.addEventListener(Mp,this._hrefHandler),r.addEventListener(Rp,this._tooltipHandler),r.addEventListener(Fp,this._tooltipHandler)),wp.prototype.initialize.call(this,t,e,n)},Hp.canvas=function(){return this._svg};const Gp=(t,e)=>n=>{let r=n.target.__data__;r=Array.isArray(r)?r[0]:r,n.vegaType=n.type,e.call(t._obj,n,r)};Hp.on=function(t,e){const n=this.eventName(t),r=this._handlers;if(this._handlerIndex(r[n],t,e)<0){const i={type:t,handler:e,listener:Gp(this,e)};(r[n]||(r[n]=[])).push(i),this._svg&&this._svg.addEventListener(n,i.listener)}return this},Hp.off=function(t,e){const n=this.eventName(t),r=this._handlers[n],i=this._handlerIndex(r,t,e);return i>=0&&(this._svg&&this._svg.removeEventListener(n,r[i].listener),r.splice(i,1)),this};var Yp=function(t,e,n){var r=t-e+2*n;return t?r>0?r:1:0};const Kp="log",Xp="time",Zp="utc",Qp="continuous";var Jp=fs(ds),tm=Jp.right,em=Jp.left,nm=tm;function rm(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}function im(t,e){switch(arguments.length){case 0:break;case 1:"function"==typeof t?this.interpolator(t):this.range(t);break;default:this.domain(t),"function"==typeof e?this.interpolator(e):this.range(e)}return this}const sm=Symbol("implicit");function om(){var t=new Map,e=[],n=[],r=sm;function i(i){var s=i+"",o=t.get(s);if(!o){if(r!==sm)return r;t.set(s,o=e.push(i))}return n[(o-1)%n.length]}return i.domain=function(n){if(!arguments.length)return e.slice();e=[],t=new Map;for(const r of n){const n=r+"";t.has(n)||t.set(n,e.push(r))}return i},i.range=function(t){return arguments.length?(n=Array.from(t),i):n.slice()},i.unknown=function(t){return arguments.length?(r=t,i):r},i.copy=function(){return om(e,n).unknown(r)},rm.apply(i,arguments),i}function am(){var t,e,n=om().unknown(void 0),r=n.domain,i=n.range,s=[0,1],o=!1,a=0,l=0,u=.5;function c(){var n=r().length,c=s[1]<s[0],h=s[c-0],d=s[1-c],f=Yp(n,a,l);t=(d-h)/(f||1),o&&(t=Math.floor(t)),h+=(d-h-t*(n-a))*u,e=t*(1-a),o&&(h=Math.round(h),e=Math.round(e));var p=Pu(n).map((function(e){return h+t*e}));return i(c?p.reverse():p)}return delete n.unknown,n.domain=function(t){return arguments.length?(r(t),c()):r()},n.range=function(t){return arguments.length?(s=[+t[0],+t[1]],c()):s.slice()},n.rangeRound=function(t){return s=[+t[0],+t[1]],o=!0,c()},n.bandwidth=function(){return e},n.step=function(){return t},n.round=function(t){return arguments.length?(o=!!t,c()):o},n.padding=function(t){return arguments.length?(l=Math.max(0,Math.min(1,t)),a=l,c()):a},n.paddingInner=function(t){return arguments.length?(a=Math.max(0,Math.min(1,t)),c()):a},n.paddingOuter=function(t){return arguments.length?(l=Math.max(0,Math.min(1,t)),c()):l},n.align=function(t){return arguments.length?(u=Math.max(0,Math.min(1,t)),c()):u},n.invertRange=function(t){if(null!=t[0]&&null!=t[1]){var n,o,a,l=+t[0],u=+t[1],c=s[1]<s[0],h=c?i().reverse():i(),d=h.length-1;if(l==l&&u==u&&(u<l&&(a=l,l=u,u=a),!(u<h[0]||l>s[1-c])))return n=Math.max(0,tm(h,l)-1),o=l===u?n:tm(h,u)-1,l-h[n]>e+1e-10&&++n,c&&(a=n,n=d-o,o=d-a),n>o?void 0:r().slice(n,o+1)}},n.invert=function(t){var e=n.invertRange([t,t]);return e?e[0]:e},n.copy=function(){return am().domain(r()).range(s).round(o).paddingInner(a).paddingOuter(l).align(u)},c()}var lm=n("rWgG"),um=function(t,e,n,r){var i,s=Er(t,e,n);switch((r=Object(lm.formatSpecifier)(null==r?",f":r)).type){case"s":var o=Math.max(Math.abs(t),Math.abs(e));return null!=r.precision||isNaN(i=Object(lm.precisionPrefix)(s,o))||(r.precision=i),Object(lm.formatPrefix)(r,o);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=Object(lm.precisionRound)(s,Math.max(Math.abs(t),Math.abs(e))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=Object(lm.precisionFixed)(s))||(r.precision=i-2*("%"===r.type))}return Object(lm.format)(r)},cm=Array.prototype.map;function hm(t){return cm.call(t,(function(t){return+t}))}var dm=Array.prototype.slice,fm=function(t,e,n){t.prototype=e.prototype=n,n.constructor=t};function pm(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function mm(){}var gm="\\s*([+-]?\\d+)\\s*",ym="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",vm="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",bm=/^#([0-9a-f]{3,8})$/,xm=new RegExp("^rgb\\("+[gm,gm,gm]+"\\)$"),_m=new RegExp("^rgb\\("+[vm,vm,vm]+"\\)$"),wm=new RegExp("^rgba\\("+[gm,gm,gm,ym]+"\\)$"),Sm=new RegExp("^rgba\\("+[vm,vm,vm,ym]+"\\)$"),Cm=new RegExp("^hsl\\("+[ym,vm,vm]+"\\)$"),Em=new RegExp("^hsla\\("+[ym,vm,vm,ym]+"\\)$"),km={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Am(){return this.rgb().formatHex()}function Dm(){return this.rgb().formatRgb()}function Nm(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=bm.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?Tm(e):3===n?new Fm(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?Om(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?Om(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=xm.exec(t))?new Fm(e[1],e[2],e[3],1):(e=_m.exec(t))?new Fm(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=wm.exec(t))?Om(e[1],e[2],e[3],e[4]):(e=Sm.exec(t))?Om(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=Cm.exec(t))?zm(e[1],e[2]/100,e[3]/100,1):(e=Em.exec(t))?zm(e[1],e[2]/100,e[3]/100,e[4]):km.hasOwnProperty(t)?Tm(km[t]):"transparent"===t?new Fm(NaN,NaN,NaN,0):null}function Tm(t){return new Fm(t>>16&255,t>>8&255,255&t,1)}function Om(t,e,n,r){return r<=0&&(t=e=n=NaN),new Fm(t,e,n,r)}function Im(t){return t instanceof mm||(t=Nm(t)),t?new Fm((t=t.rgb()).r,t.g,t.b,t.opacity):new Fm}function Rm(t,e,n,r){return 1===arguments.length?Im(t):new Fm(t,e,n,null==r?1:r)}function Fm(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function Mm(){return"#"+Pm(this.r)+Pm(this.g)+Pm(this.b)}function $m(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function Pm(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function zm(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new jm(t,e,n,r)}function Lm(t){if(t instanceof jm)return new jm(t.h,t.s,t.l,t.opacity);if(t instanceof mm||(t=Nm(t)),!t)return new jm;if(t instanceof jm)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),s=Math.max(e,n,r),o=NaN,a=s-i,l=(s+i)/2;return a?(o=e===s?(n-r)/a+6*(n<r):n===s?(r-e)/a+2:(e-n)/a+4,a/=l<.5?s+i:2-s-i,o*=60):a=l>0&&l<1?0:o,new jm(o,a,l,t.opacity)}function Bm(t,e,n,r){return 1===arguments.length?Lm(t):new jm(t,e,n,null==r?1:r)}function jm(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function Um(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}function Vm(t,e,n,r,i){var s=t*t,o=s*t;return((1-3*t+3*s-o)*e+(4-6*s+3*o)*n+(1+3*t+3*s-3*o)*r+o*i)/6}fm(mm,Nm,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:Am,formatHex:Am,formatHsl:function(){return Lm(this).formatHsl()},formatRgb:Dm,toString:Dm}),fm(Fm,Rm,pm(mm,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new Fm(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new Fm(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Mm,formatHex:Mm,formatRgb:$m,toString:$m})),fm(jm,Bm,pm(mm,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new jm(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new jm(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new Fm(Um(t>=240?t-240:t+120,i,r),Um(t,i,r),Um(t<120?t+240:t-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));var Wm=function(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),i=t[r],s=t[r+1];return Vm((n-r/e)*e,r>0?t[r-1]:2*i-s,i,s,r<e-1?t[r+2]:2*s-i)}},qm=function(t){var e=t.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*e);return Vm((n-r/e)*e,t[(r+e-1)%e],t[r%e],t[(r+1)%e],t[(r+2)%e])}},Hm=function(t){return function(){return t}};function Gm(t,e){return function(n){return t+n*e}}function Ym(t,e){var n=e-t;return n?Gm(t,n>180||n<-180?n-360*Math.round(n/360):n):Hm(isNaN(t)?e:t)}function Km(t,e){var n=e-t;return n?Gm(t,n):Hm(isNaN(t)?e:t)}var Xm=function t(e){var n=function(t){return 1==(t=+t)?Km:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}(e,n,t):Hm(isNaN(e)?n:e)}}(e);function r(t,e){var r=n((t=Rm(t)).r,(e=Rm(e)).r),i=n(t.g,e.g),s=n(t.b,e.b),o=Km(t.opacity,e.opacity);return function(e){return t.r=r(e),t.g=i(e),t.b=s(e),t.opacity=o(e),t+""}}return r.gamma=t,r}(1);function Zm(t){return function(e){var n,r,i=e.length,s=new Array(i),o=new Array(i),a=new Array(i);for(n=0;n<i;++n)r=Rm(e[n]),s[n]=r.r||0,o[n]=r.g||0,a[n]=r.b||0;return s=t(s),o=t(o),a=t(a),r.opacity=1,function(t){return r.r=s(t),r.g=o(t),r.b=a(t),r+""}}}var Qm=Zm(Wm),Jm=Zm(qm),tg=function(t,e){e||(e=[]);var n,r=t?Math.min(e.length,t.length):0,i=e.slice();return function(s){for(n=0;n<r;++n)i[n]=t[n]*(1-s)+e[n]*s;return i}};function eg(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}var ng=function(t,e){return(eg(e)?tg:rg)(t,e)};function rg(t,e){var n,r=e?e.length:0,i=t?Math.min(r,t.length):0,s=new Array(i),o=new Array(r);for(n=0;n<i;++n)s[n]=cg(t[n],e[n]);for(;n<r;++n)o[n]=e[n];return function(t){for(n=0;n<i;++n)o[n]=s[n](t);return o}}var ig=function(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}},sg=function(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}},og=function(t,e){var n,r={},i={};for(n in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)n in t?r[n]=cg(t[n],e[n]):i[n]=e[n];return function(t){for(n in r)i[n]=r[n](t);return i}},ag=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,lg=new RegExp(ag.source,"g"),ug=function(t,e){var n,r,i,s=ag.lastIndex=lg.lastIndex=0,o=-1,a=[],l=[];for(t+="",e+="";(n=ag.exec(t))&&(r=lg.exec(e));)(i=r.index)>s&&(i=e.slice(s,i),a[o]?a[o]+=i:a[++o]=i),(n=n[0])===(r=r[0])?a[o]?a[o]+=r:a[++o]=r:(a[++o]=null,l.push({i:o,x:sg(n,r)})),s=lg.lastIndex;return s<e.length&&(i=e.slice(s),a[o]?a[o]+=i:a[++o]=i),a.length<2?l[0]?function(t){return function(e){return t(e)+""}}(l[0].x):function(t){return function(){return t}}(e):(e=l.length,function(t){for(var n,r=0;r<e;++r)a[(n=l[r]).i]=n.x(t);return a.join("")})},cg=function(t,e){var n,r=typeof e;return null==e||"boolean"===r?Hm(e):("number"===r?sg:"string"===r?(n=Nm(e))?(e=n,Xm):ug:e instanceof Nm?Xm:e instanceof Date?ig:eg(e)?tg:Array.isArray(e)?rg:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?og:sg)(t,e)},hg=function(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}},dg=function(t){return+t},fg=[0,1];function pg(t){return t}function mg(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:(n=isNaN(e)?NaN:.5,function(){return n});var n}function gg(t,e,n){var r=t[0],i=t[1],s=e[0],o=e[1];return i<r?(r=mg(i,r),s=n(o,s)):(r=mg(r,i),s=n(s,o)),function(t){return s(r(t))}}function yg(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),s=new Array(r),o=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<r;)i[o]=mg(t[o],t[o+1]),s[o]=n(e[o],e[o+1]);return function(e){var n=nm(t,e,1,r)-1;return s[n](i[n](e))}}function vg(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function bg(){var t,e,n,r,i,s,o=fg,a=fg,l=cg,u=pg;function c(){var t,e,n,l=Math.min(o.length,a.length);return u!==pg&&((t=o[0])>(e=o[l-1])&&(n=t,t=e,e=n),u=function(n){return Math.max(t,Math.min(e,n))}),r=l>2?yg:gg,i=s=null,h}function h(e){return isNaN(e=+e)?n:(i||(i=r(o.map(t),a,l)))(t(u(e)))}return h.invert=function(n){return u(e((s||(s=r(a,o.map(t),sg)))(n)))},h.domain=function(t){return arguments.length?(o=Array.from(t,dg),c()):o.slice()},h.range=function(t){return arguments.length?(a=Array.from(t),c()):a.slice()},h.rangeRound=function(t){return a=Array.from(t),l=hg,c()},h.clamp=function(t){return arguments.length?(u=!!t||pg,c()):u!==pg},h.interpolate=function(t){return arguments.length?(l=t,c()):l},h.unknown=function(t){return arguments.length?(n=t,h):n},function(n,r){return t=n,e=r,c()}}function xg(){return bg()(pg,pg)}function _g(t){var e=t.domain;return t.ticks=function(t){var n=e();return Sr(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var r=e();return um(r[0],r[r.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var r,i=e(),s=0,o=i.length-1,a=i[s],l=i[o];return l<a&&(r=a,a=l,l=r,r=s,s=o,o=r),(r=Cr(a,l,n))>0?r=Cr(a=Math.floor(a/r)*r,l=Math.ceil(l/r)*r,n):r<0&&(r=Cr(a=Math.ceil(a*r)/r,l=Math.floor(l*r)/r,n)),r>0?(i[s]=Math.floor(a/r)*r,i[o]=Math.ceil(l/r)*r,e(i)):r<0&&(i[s]=Math.ceil(a*r)/r,i[o]=Math.floor(l*r)/r,e(i)),t},t}var wg=function(t,e){var n,r=0,i=(t=t.slice()).length-1,s=t[r],o=t[i];return o<s&&(n=r,r=i,i=n,n=s,s=o,o=n),t[r]=e.floor(s),t[i]=e.ceil(o),t};function Sg(t){return Math.log(t)}function Cg(t){return Math.exp(t)}function Eg(t){return-Math.log(-t)}function kg(t){return-Math.exp(-t)}function Ag(t){return isFinite(t)?+("1e"+t):t<0?0:t}function Dg(t){return function(e){return-t(-e)}}function Ng(t){var e,n,r=t(Sg,Cg),i=r.domain,s=10;function o(){return e=function(t){return t===Math.E?Math.log:10===t&&Math.log10||2===t&&Math.log2||(t=Math.log(t),function(e){return Math.log(e)/t})}(s),n=function(t){return 10===t?Ag:t===Math.E?Math.exp:function(e){return Math.pow(t,e)}}(s),i()[0]<0?(e=Dg(e),n=Dg(n),t(Eg,kg)):t(Sg,Cg),r}return r.base=function(t){return arguments.length?(s=+t,o()):s},r.domain=function(t){return arguments.length?(i(t),o()):i()},r.ticks=function(t){var r,o=i(),a=o[0],l=o[o.length-1];(r=l<a)&&(d=a,a=l,l=d);var u,c,h,d=e(a),f=e(l),p=null==t?10:+t,m=[];if(!(s%1)&&f-d<p){if(d=Math.floor(d),f=Math.ceil(f),a>0){for(;d<=f;++d)for(c=1,u=n(d);c<s;++c)if(!((h=u*c)<a)){if(h>l)break;m.push(h)}}else for(;d<=f;++d)for(c=s-1,u=n(d);c>=1;--c)if(!((h=u*c)<a)){if(h>l)break;m.push(h)}2*m.length<p&&(m=Sr(a,l,p))}else m=Sr(d,f,Math.min(f-d,p)).map(n);return r?m.reverse():m},r.tickFormat=function(t,i){if(null==i&&(i=10===s?".0e":","),"function"!=typeof i&&(i=Object(lm.format)(i)),t===1/0)return i;null==t&&(t=10);var o=Math.max(1,s*t/r.ticks().length);return function(t){var r=t/n(Math.round(e(t)));return r*s<s-.5&&(r*=s),r<=o?i(t):""}},r.nice=function(){return i(wg(i(),{floor:function(t){return n(Math.floor(e(t)))},ceil:function(t){return n(Math.ceil(e(t)))}}))},r}function Tg(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function Og(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function Ig(t){return t<0?-t*t:t*t}function Rg(t){var e=t(pg,pg),n=1;function r(){return 1===n?t(pg,pg):.5===n?t(Og,Ig):t(Tg(n),Tg(1/n))}return e.exponent=function(t){return arguments.length?(n=+t,r()):n},_g(e)}function Fg(){var t=Rg(bg());return t.copy=function(){return vg(t,Fg()).exponent(t.exponent())},rm.apply(t,arguments),t}function Mg(t){return function(e){return Math.sign(e)*Math.log1p(Math.abs(e/t))}}function $g(t){return function(e){return Math.sign(e)*Math.expm1(Math.abs(e))*t}}function Pg(t){var e=1,n=t(Mg(e),$g(e));return n.constant=function(n){return arguments.length?t(Mg(e=+n),$g(e)):e},_g(n)}function zg(t){return new Date(t)}function Lg(t){return t instanceof Date?+t:+new Date(+t)}function Bg(t,e,n,r,i,s,o,a,l){var u=xg(),c=u.invert,h=u.domain,d=l(".%L"),f=l(":%S"),p=l("%I:%M"),m=l("%I %p"),g=l("%a %d"),y=l("%b %d"),v=l("%B"),b=l("%Y"),x=[[o,1,1e3],[o,5,5e3],[o,15,15e3],[o,30,3e4],[s,1,6e4],[s,5,3e5],[s,15,9e5],[s,30,18e5],[i,1,36e5],[i,3,108e5],[i,6,216e5],[i,12,432e5],[r,1,864e5],[r,2,1728e5],[n,1,6048e5],[e,1,2592e6],[e,3,7776e6],[t,1,31536e6]];function _(a){return(o(a)<a?d:s(a)<a?f:i(a)<a?p:r(a)<a?m:e(a)<a?n(a)<a?g:y:t(a)<a?v:b)(a)}function w(e,n,r){if(null==e&&(e=10),"number"==typeof e){var i,s=Math.abs(r-n)/e,o=fs((function(t){return t[2]})).right(x,s);return o===x.length?(i=Er(n/31536e6,r/31536e6,e),e=t):o?(i=(o=x[s/x[o-1][2]<x[o][2]/s?o-1:o])[1],e=o[0]):(i=Math.max(Er(n,r,e),1),e=a),e.every(i)}return e}return u.invert=function(t){return new Date(c(t))},u.domain=function(t){return arguments.length?h(Array.from(t,Lg)):h().map(zg)},u.ticks=function(t){var e,n=h(),r=n[0],i=n[n.length-1],s=i<r;return s&&(e=r,r=i,i=e),e=(e=w(t,r,i))?e.range(r,i+1):[],s?e.reverse():e},u.tickFormat=function(t,e){return null==e?_:l(e)},u.nice=function(t){var e=h();return(t=w(t,e[0],e[e.length-1]))?h(wg(e,t)):u},u.copy=function(){return vg(u,Bg(t,e,n,r,i,s,o,a,l))},u}function jg(){var t,e,n,r,i,s=0,o=1,a=pg,l=!1;function u(e){return isNaN(e=+e)?i:a(0===n?.5:(e=(r(e)-t)*n,l?Math.max(0,Math.min(1,e)):e))}function c(t){return function(e){var n,r;return arguments.length?([n,r]=e,a=t(n,r),u):[a(0),a(1)]}}return u.domain=function(i){return arguments.length?([s,o]=i,t=r(s=+s),e=r(o=+o),n=t===e?0:1/(e-t),u):[s,o]},u.clamp=function(t){return arguments.length?(l=!!t,u):l},u.interpolator=function(t){return arguments.length?(a=t,u):a},u.range=c(cg),u.rangeRound=c(hg),u.unknown=function(t){return arguments.length?(i=t,u):i},function(i){return r=i,t=i(s),e=i(o),n=t===e?0:1/(e-t),u}}function Ug(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function Vg(){var t=_g(jg()(pg));return t.copy=function(){return Ug(t,Vg())},im.apply(t,arguments)}function Wg(){var t=Rg(jg());return t.copy=function(){return Ug(t,Wg()).exponent(t.exponent())},im.apply(t,arguments)}function qg(t,e){for(var n=0,r=e.length-1,i=e[0],s=new Array(r<0?0:r);n<r;)s[n]=t(i,i=e[++n]);return function(t){var e=Math.max(0,Math.min(r-1,Math.floor(t*=r)));return s[e](t-e)}}function Hg(){var t,e,n,r,i,s,o,a=0,l=.5,u=1,c=1,h=pg,d=!1;function f(t){return isNaN(t=+t)?o:(t=.5+((t=+s(t))-e)*(c*t<c*e?r:i),h(d?Math.max(0,Math.min(1,t)):t))}function p(t){return function(e){var n,r,i;return arguments.length?([n,r,i]=e,h=qg(t,[n,r,i]),f):[h(0),h(.5),h(1)]}}return f.domain=function(o){return arguments.length?([a,l,u]=o,t=s(a=+a),e=s(l=+l),n=s(u=+u),r=t===e?0:.5/(e-t),i=e===n?0:.5/(n-e),c=e<t?-1:1,f):[a,l,u]},f.clamp=function(t){return arguments.length?(d=!!t,f):d},f.interpolator=function(t){return arguments.length?(h=t,f):h},f.range=p(cg),f.rangeRound=p(hg),f.unknown=function(t){return arguments.length?(o=t,f):o},function(o){return s=o,t=o(a),e=o(l),n=o(u),r=t===e?0:.5/(e-t),i=e===n?0:.5/(n-e),c=e<t?-1:1,f}}function Gg(){var t=Rg(Hg());return t.copy=function(){return Ug(t,Gg()).exponent(t.exponent())},im.apply(t,arguments)}const Yg={};function Kg(t,e,n){const r=function(){var n,r=e();return r.invertRange||(r.invertRange=r.invert?(n=r,function(t){var e,r=t[0],i=t[1];return i<r&&(e=r,r=i,i=e),[n.invert(r),n.invert(i)]}):r.invertExtent?function(t){return function(e){var n,r,i,s,o=t.range(),a=e[0],l=e[1],u=-1;for(l<a&&(r=a,a=l,l=r),i=0,s=o.length;i<s;++i)o[i]>=a&&o[i]<=l&&(u<0&&(u=i),n=i);if(!(u<0))return a=t.invertExtent(o[u]),l=t.invertExtent(o[n]),[void 0===a[0]?a[1]:a[0],void 0===l[1]?l[0]:l[1]]}}(r):void 0),r.type=t,r};return r.metadata=ln(Ce(n)),r}function Xg(t,e,n){return arguments.length>1?(Yg[t]=Kg(t,e,n),this):Zg(t)?Yg[t]:void 0}function Zg(t){return ze(Yg,t)}function Qg(t,e){const n=Yg[t];return n&&n.metadata[e]}function Jg(t){return Qg(t,Qp)}function ty(t){return Qg(t,"discrete")}function ey(t){return Qg(t,"discretizing")}function ny(t){return Qg(t,Kp)}function ry(t){return Qg(t,"interpolating")}function iy(t){return Qg(t,"quantile")}Xg("identity",(function t(e){var n;function r(t){return isNaN(t=+t)?n:t}return r.invert=r,r.domain=r.range=function(t){return arguments.length?(e=Array.from(t,dg),r):e.slice()},r.unknown=function(t){return arguments.length?(n=t,r):n},r.copy=function(){return t(e).unknown(n)},e=arguments.length?Array.from(e,dg):[0,1],_g(r)})),Xg("linear",(function t(){var e=xg();return e.copy=function(){return vg(e,t())},rm.apply(e,arguments),_g(e)}),Qp),Xg(Kp,(function t(){var e=Ng(bg()).domain([1,10]);return e.copy=function(){return vg(e,t()).base(e.base())},rm.apply(e,arguments),e}),[Qp,Kp]),Xg("pow",Fg,Qp),Xg("sqrt",(function(){return Fg.apply(null,arguments).exponent(.5)}),Qp),Xg("symlog",(function t(){var e=Pg(bg());return e.copy=function(){return vg(e,t()).constant(e.constant())},rm.apply(e,arguments)}),Qp),Xg(Xp,(function(){return rm.apply(Bg(Wi,qi,fi,hi,Hi,Gi,Yi,Xi,Ds).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}),[Qp,"temporal"]),Xg(Zp,(function(){return rm.apply(Bg(Qi,Ji,vi,gi,ts,es,Yi,Xi,Ts).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}),[Qp,"temporal"]),Xg("sequential",Vg,[Qp,"interpolating"]),Xg("sequential-linear",Vg,[Qp,"interpolating"]),Xg("sequential-log",(function t(){var e=Ng(jg()).domain([1,10]);return e.copy=function(){return Ug(e,t()).base(e.base())},im.apply(e,arguments)}),[Qp,"interpolating",Kp]),Xg("sequential-pow",Wg,[Qp,"interpolating"]),Xg("sequential-sqrt",(function(){return Wg.apply(null,arguments).exponent(.5)}),[Qp,"interpolating"]),Xg("sequential-symlog",(function t(){var e=Pg(jg());return e.copy=function(){return Ug(e,t()).constant(e.constant())},im.apply(e,arguments)}),[Qp,"interpolating"]),Xg("diverging-linear",(function t(){var e=_g(Hg()(pg));return e.copy=function(){return Ug(e,t())},im.apply(e,arguments)}),[Qp,"interpolating"]),Xg("diverging-log",(function t(){var e=Ng(Hg()).domain([.1,1,10]);return e.copy=function(){return Ug(e,t()).base(e.base())},im.apply(e,arguments)}),[Qp,"interpolating",Kp]),Xg("diverging-pow",Gg,[Qp,"interpolating"]),Xg("diverging-sqrt",(function(){return Gg.apply(null,arguments).exponent(.5)}),[Qp,"interpolating"]),Xg("diverging-symlog",(function t(){var e=Pg(Hg());return e.copy=function(){return Ug(e,t()).constant(e.constant())},im.apply(e,arguments)}),[Qp,"interpolating"]),Xg("quantile",(function t(){var e,n=[],r=[],i=[];function s(){var t=0,e=Math.max(1,r.length);for(i=new Array(e-1);++t<e;)i[t-1]=Ua(n,t/e);return o}function o(t){return isNaN(t=+t)?e:r[nm(i,t)]}return o.invertExtent=function(t){var e=r.indexOf(t);return e<0?[NaN,NaN]:[e>0?i[e-1]:n[0],e<i.length?i[e]:n[n.length-1]]},o.domain=function(t){if(!arguments.length)return n.slice();n=[];for(let e of t)null==e||isNaN(e=+e)||n.push(e);return n.sort(ds),s()},o.range=function(t){return arguments.length?(r=Array.from(t),s()):r.slice()},o.unknown=function(t){return arguments.length?(e=t,o):e},o.quantiles=function(){return i.slice()},o.copy=function(){return t().domain(n).range(r).unknown(e)},rm.apply(o,arguments)}),["discretizing","quantile"]),Xg("quantize",(function t(){var e,n=0,r=1,i=1,s=[.5],o=[0,1];function a(t){return t<=t?o[nm(s,t,0,i)]:e}function l(){var t=-1;for(s=new Array(i);++t<i;)s[t]=((t+1)*r-(t-i)*n)/(i+1);return a}return a.domain=function(t){return arguments.length?([n,r]=t,n=+n,r=+r,l()):[n,r]},a.range=function(t){return arguments.length?(i=(o=Array.from(t)).length-1,l()):o.slice()},a.invertExtent=function(t){var e=o.indexOf(t);return e<0?[NaN,NaN]:e<1?[n,s[0]]:e>=i?[s[i-1],r]:[s[e-1],s[e]]},a.unknown=function(t){return arguments.length?(e=t,a):a},a.thresholds=function(){return s.slice()},a.copy=function(){return t().domain([n,r]).range(o).unknown(e)},rm.apply(_g(a),arguments)}),"discretizing"),Xg("threshold",(function t(){var e,n=[.5],r=[0,1],i=1;function s(t){return t<=t?r[nm(n,t,0,i)]:e}return s.domain=function(t){return arguments.length?(n=Array.from(t),i=Math.min(n.length,r.length-1),s):n.slice()},s.range=function(t){return arguments.length?(r=Array.from(t),i=Math.min(n.length,r.length-1),s):r.slice()},s.invertExtent=function(t){var e=r.indexOf(t);return[n[e-1],n[e]]},s.unknown=function(t){return arguments.length?(e=t,s):e},s.copy=function(){return t().domain(n).range(r).unknown(e)},rm.apply(s,arguments)}),"discretizing"),Xg("bin-ordinal",(function t(){var e=[],n=[];function r(t){return null==t||t!=t?void 0:n[(nm(e,t)-1)%n.length]}return r.domain=function(t){return arguments.length?(e=hm(t),r):e.slice()},r.range=function(t){return arguments.length?(n=dm.call(t),r):n.slice()},r.tickFormat=function(t,n){return um(e[0],se(e),null==t?10:t,n)},r.copy=function(){return t().domain(r.domain()).range(r.range())},r}),["discrete","discretizing"]),Xg("ordinal",om,"discrete"),Xg("band",am,"discrete"),Xg("point",(function(){return function t(e){var n=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return t(n())},e}(am().paddingInner(1))}),"discrete");var sy,oy,ay,ly,uy=function(t){var e=t.length;return function(n){return t[Math.max(0,Math.min(e-1,Math.floor(n*e)))]}},cy=function(t,e){var n=Ym(+t,+e);return function(t){var e=n(t);return e-360*Math.floor(e/360)}},hy=180/Math.PI,dy={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1},fy=function(t,e,n,r,i,s){var o,a,l;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(l=t*n+e*r)&&(n-=t*l,r-=e*l),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,l/=a),t*r<e*n&&(t=-t,e=-e,l=-l,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(e,t)*hy,skewX:Math.atan(l)*hy,scaleX:o,scaleY:a}};function py(t,e,n,r){function i(t){return t.length?t.pop()+" ":""}return function(s,o){var a=[],l=[];return s=t(s),o=t(o),function(t,r,i,s,o,a){if(t!==i||r!==s){var l=o.push("translate(",null,e,null,n);a.push({i:l-4,x:sg(t,i)},{i:l-2,x:sg(r,s)})}else(i||s)&&o.push("translate("+i+e+s+n)}(s.translateX,s.translateY,o.translateX,o.translateY,a,l),function(t,e,n,s){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),s.push({i:n.push(i(n)+"rotate(",null,r)-2,x:sg(t,e)})):e&&n.push(i(n)+"rotate("+e+r)}(s.rotate,o.rotate,a,l),function(t,e,n,s){t!==e?s.push({i:n.push(i(n)+"skewX(",null,r)-2,x:sg(t,e)}):e&&n.push(i(n)+"skewX("+e+r)}(s.skewX,o.skewX,a,l),function(t,e,n,r,s,o){if(t!==n||e!==r){var a=s.push(i(s)+"scale(",null,",",null,")");o.push({i:a-4,x:sg(t,n)},{i:a-2,x:sg(e,r)})}else 1===n&&1===r||s.push(i(s)+"scale("+n+","+r+")")}(s.scaleX,s.scaleY,o.scaleX,o.scaleY,a,l),s=o=null,function(t){for(var e,n=-1,r=l.length;++n<r;)a[(e=l[n]).i]=e.x(t);return a.join("")}}}var my=py((function(t){return"none"===t?dy:(sy||(sy=document.createElement("DIV"),oy=document.documentElement,ay=document.defaultView),sy.style.transform=t,t=ay.getComputedStyle(oy.appendChild(sy),null).getPropertyValue("transform"),oy.removeChild(sy),t=t.slice(7,-1).split(","),fy(+t[0],+t[1],+t[2],+t[3],+t[4],+t[5]))}),"px, ","px)","deg)"),gy=py((function(t){return null==t?dy:(ly||(ly=document.createElementNS("http://www.w3.org/2000/svg","g")),ly.setAttribute("transform",t),(t=ly.transform.baseVal.consolidate())?fy((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):dy)}),", ",")",")"),yy=Math.SQRT2;function vy(t){return((t=Math.exp(t))+1/t)/2}var by=function(t,e){var n,r,i=t[0],s=t[1],o=t[2],a=e[2],l=e[0]-i,u=e[1]-s,c=l*l+u*u;if(c<1e-12)r=Math.log(a/o)/yy,n=function(t){return[i+t*l,s+t*u,o*Math.exp(yy*t*r)]};else{var h=Math.sqrt(c),d=(a*a-o*o+4*c)/(2*o*2*h),f=(a*a-o*o-4*c)/(2*a*2*h),p=Math.log(Math.sqrt(d*d+1)-d),m=Math.log(Math.sqrt(f*f+1)-f);r=(m-p)/yy,n=function(t){var e,n=t*r,a=vy(p),c=o/(2*h)*(a*(e=yy*n+p,((e=Math.exp(2*e))-1)/(e+1))-function(t){return((t=Math.exp(t))-1/t)/2}(p));return[i+c*l,s+c*u,o*a/vy(yy*n+p)]}}return n.duration=1e3*r,n};function xy(t){return function(e,n){var r=t((e=Bm(e)).h,(n=Bm(n)).h),i=Km(e.s,n.s),s=Km(e.l,n.l),o=Km(e.opacity,n.opacity);return function(t){return e.h=r(t),e.s=i(t),e.l=s(t),e.opacity=o(t),e+""}}}var _y=xy(Ym),wy=xy(Km),Sy=Math.PI/180,Cy=180/Math.PI;function Ey(t){if(t instanceof Ay)return new Ay(t.l,t.a,t.b,t.opacity);if(t instanceof Fy)return My(t);t instanceof Fm||(t=Im(t));var e,n,r=Oy(t.r),i=Oy(t.g),s=Oy(t.b),o=Dy((.2225045*r+.7168786*i+.0606169*s)/1);return r===i&&i===s?e=n=o:(e=Dy((.4360747*r+.3850649*i+.1430804*s)/.96422),n=Dy((.0139322*r+.0971045*i+.7141733*s)/.82521)),new Ay(116*o-16,500*(e-o),200*(o-n),t.opacity)}function ky(t,e,n,r){return 1===arguments.length?Ey(t):new Ay(t,e,n,null==r?1:r)}function Ay(t,e,n,r){this.l=+t,this.a=+e,this.b=+n,this.opacity=+r}function Dy(t){return t>6/29*(6/29)*(6/29)?Math.pow(t,1/3):t/(6/29*3*(6/29))+4/29}function Ny(t){return t>6/29?t*t*t:6/29*3*(6/29)*(t-4/29)}function Ty(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Oy(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Iy(t){if(t instanceof Fy)return new Fy(t.h,t.c,t.l,t.opacity);if(t instanceof Ay||(t=Ey(t)),0===t.a&&0===t.b)return new Fy(NaN,0<t.l&&t.l<100?0:NaN,t.l,t.opacity);var e=Math.atan2(t.b,t.a)*Cy;return new Fy(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}function Ry(t,e,n,r){return 1===arguments.length?Iy(t):new Fy(t,e,n,null==r?1:r)}function Fy(t,e,n,r){this.h=+t,this.c=+e,this.l=+n,this.opacity=+r}function My(t){if(isNaN(t.h))return new Ay(t.l,0,0,t.opacity);var e=t.h*Sy;return new Ay(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}function $y(t,e){var n=Km((t=ky(t)).l,(e=ky(e)).l),r=Km(t.a,e.a),i=Km(t.b,e.b),s=Km(t.opacity,e.opacity);return function(e){return t.l=n(e),t.a=r(e),t.b=i(e),t.opacity=s(e),t+""}}function Py(t){return function(e,n){var r=t((e=Ry(e)).h,(n=Ry(n)).h),i=Km(e.c,n.c),s=Km(e.l,n.l),o=Km(e.opacity,n.opacity);return function(t){return e.h=r(t),e.c=i(t),e.l=s(t),e.opacity=o(t),e+""}}}fm(Ay,ky,pm(mm,{brighter:function(t){return new Ay(this.l+18*(null==t?1:t),this.a,this.b,this.opacity)},darker:function(t){return new Ay(this.l-18*(null==t?1:t),this.a,this.b,this.opacity)},rgb:function(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return new Fm(Ty(3.1338561*(e=.96422*Ny(e))-1.6168667*(t=1*Ny(t))-.4906146*(n=.82521*Ny(n))),Ty(-.9787684*e+1.9161415*t+.033454*n),Ty(.0719453*e-.2289914*t+1.4052427*n),this.opacity)}})),fm(Fy,Ry,pm(mm,{brighter:function(t){return new Fy(this.h,this.c,this.l+18*(null==t?1:t),this.opacity)},darker:function(t){return new Fy(this.h,this.c,this.l-18*(null==t?1:t),this.opacity)},rgb:function(){return My(this).rgb()}}));var zy=Py(Ym),Ly=Py(Km),By=1.97294,jy=-.90649*By,Uy=1.78277*By,Vy=-.6557636667999999;function Wy(t){if(t instanceof Hy)return new Hy(t.h,t.s,t.l,t.opacity);t instanceof Fm||(t=Im(t));var e=t.g/255,n=t.b/255,r=(Vy*n+jy*(t.r/255)-Uy*e)/(Vy+jy-Uy),i=n-r,s=(By*(e-r)- -.29227*i)/-.90649,o=Math.sqrt(s*s+i*i)/(By*r*(1-r)),a=o?Math.atan2(s,i)*Cy-120:NaN;return new Hy(a<0?a+360:a,o,r,t.opacity)}function qy(t,e,n,r){return 1===arguments.length?Wy(t):new Hy(t,e,n,null==r?1:r)}function Hy(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function Gy(t){return function e(n){function r(e,r){var i=t((e=qy(e)).h,(r=qy(r)).h),s=Km(e.s,r.s),o=Km(e.l,r.l),a=Km(e.opacity,r.opacity);return function(t){return e.h=i(t),e.s=s(t),e.l=o(Math.pow(t,n)),e.opacity=a(t),e+""}}return n=+n,r.gamma=e,r}(1)}fm(Hy,qy,pm(mm,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new Hy(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new Hy(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=isNaN(this.h)?0:(this.h+120)*Sy,e=+this.l,n=isNaN(this.s)?0:this.s*e*(1-e),r=Math.cos(t),i=Math.sin(t);return new Fm(255*(e+n*(-.14861*r+1.78277*i)),255*(e+n*(-.29227*r+-.90649*i)),255*(e+n*(By*r)),this.opacity)}}));var Yy=Gy(Ym),Ky=Gy(Km),Xy=function(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t(r/(e-1));return n};const Zy=["clamp","base","constant","exponent"];function Qy(t,e){var n=e[0],r=se(e)-n;return function(e){return t(n+e*r)}}function Jy(t,e,n){return qg(nv(e||"rgb",n),t)}function tv(t,e){for(var n=new Array(e),r=e+1,i=0;i<e;)n[i]=t(++i/r);return n}function ev(t,e,n){var r,i,s,o=n-e;return o&&Number.isFinite(o)?(r=(i=t.type).indexOf("-"),i=r<0?i:i.slice(r+1),s=Xg(i)().domain([e,n]).range([0,1]),Zy.forEach(e=>t[e]?s[e](t[e]()):0),s):Ie(.5)}function nv(t,e){var n=i[function(t){return"interpolate"+t.toLowerCase().split("-").map((function(t){return t[0].toUpperCase()+t.slice(1)})).join("")}(t)];return null!=e&&n&&n.gamma?n.gamma(e):n}function rv(t){for(var e=t.length/6|0,n=new Array(e),r=0;r<e;)n[r]="#"+t.slice(6*r,6*++r);return n}function iv(t,e){for(let n in t)ov(n,e(t[n]))}const sv={};function ov(t,e){return t=t&&t.toLowerCase(),arguments.length>1?(sv[t]=e,this):sv[t]}iv({category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"},rv),iv({blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},t=>Jy(rv(t)));const av=t=>Jt(t)?t.map(t=>String(t)):String(t),lv=(t,e)=>t[1]-e[1],uv=(t,e)=>e[1]-t[1];function cv(t,e,n){var r;return He(e)&&(t.bins&&(e=Math.max(e,t.bins.length)),null!=n&&(e=Math.min(e,Math.floor(en(t.domain())/n||1)))),te(e)&&(r=e.step,e=e.interval),Ye(e)&&(e=t.type===Xp?is(e):t.type==Zp?ss(e):$t("Only time and utc scales accept interval strings."),r&&(e=e.every(r))),e}function hv(t,e,n){let r=t.range(),i=r[0],s=se(r),o=lv;if(i>s&&(r=s,s=i,i=r,o=uv),i=Math.floor(i),s=Math.ceil(s),e=e.map(e=>[e,t(e)]).filter(t=>i<=t[1]&&t[1]<=s).sort(o).map(t=>t[0]),n>0&&e.length>1){const t=[e[0],se(e)];for(;e.length>n&&e.length>=3;)e=e.filter((t,e)=>!(e%2));e.length<3&&(e=t)}return e}function dv(t,e){return t.bins?hv(t,t.bins):t.ticks?t.ticks(e):t.domain()}function fv(t,e,n,r,i,s){var o=e.type;let a=av;if(o===Xp||i===Xp)a=t.timeFormat(r);else if(o===Zp||i===Zp)a=t.utcFormat(r);else if(ny(o)){const i=t.formatFloat(r);if(s||e.bins)a=i;else{const t=pv(e,n,!1);a=e=>t(e)?i(e):""}}else if(e.tickFormat){const i=e.domain();a=t.formatSpan(i[0],i[i.length-1],n,r)}else r&&(a=t.format(r));return a}function pv(t,e,n){const r=dv(t,e),i=t.base(),s=Math.log(i),o=Math.max(1,i*e/r.length),a=t=>{let e=t/Math.pow(i,Math.round(Math.log(t)/s));return e*i<i-.5&&(e*=i),e<=o};return n?r.filter(a):a}const mv={quantile:"quantiles",quantize:"thresholds",threshold:"domain"},gv={quantile:"quantiles",quantize:"domain"};function yv(t,e){return t.bins?function(t){const e=t.slice(0,-1);return e.max=se(t),e}(t.bins):t.type===Kp?pv(t,e,!0):mv[t.type]?function(t){const e=[-1/0].concat(t);return e.max=1/0,e}(t[mv[t.type]]()):dv(t,e)}function vv(t,e,n,r,i,s,o){const a=gv[e.type]&&s!==Xp&&s!==Zp?function(t,e,n){var r,i=e[gv[e.type]](),s=i.length,o=s>1?i[1]-i[0]:i[0];for(r=1;r<s;++r)o=Math.min(o,i[r]-i[r-1]);return t.formatSpan(0,o,30,n)}(t,e,i):fv(t,e,n,i,s,o);return"symbol"===r&&function(t){return mv[t.type]||t.bins}(e)?function(t){return(e,n,r)=>{var i=bv(r[n+1],bv(r.max,1/0)),s=xv(e,t),o=xv(i,t);return s&&o?s+" \u2013 "+o:o?"< "+o:"\u2265 "+s}}(a):"discrete"===r?function(t){return(e,n)=>n?t(e):null}(a):function(t){return e=>t(e)}(a)}function bv(t,e){return null!=t?t:e}function xv(t,e){return Number.isFinite(t)?e(t):null}function _v(t,e,n){n=n||{};const r=Math.max(3,n.maxlen||7),i=function(t,e,n,r){const i=r||e.type;return Ye(n)&&Qg(i,"temporal")&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),n||i!==Xp?n||i!==Zp?vv(t,e,5,null,n,r,!0):t.utcFormat("%A, %d %B %Y, %X UTC"):t.timeFormat("%A, %d %B %Y, %X")}(t,e,n.format,n.formatType);if(ey(e.type)){const t=yv(e).slice(1).map(i),n=t.length;return`${n} boundar${1===n?"y":"ies"}: ${t.join(", ")}`}if(ty(e.type)){const t=e.domain(),n=t.length;return`${n} value${1===n?"":"s"}: ${n>r?t.slice(0,r-2).map(i).join(", ")+", ending with "+t.slice(-1).map(i):t.map(i).join(", ")}`}{const t=e.domain();return`values from ${i(t[0])} to ${i(se(t))}`}}const wv=(t,e,n)=>({role:t,"aria-roledescription":e,"aria-label":n||void 0}),Sv=ln(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),Cv={axis:{desc:"axis",caption:function(t){const e=t.datum,n=t.orient,r=e.title?Nv(t):null,i=t.context,s=i.scales[e.scale].value,o=i.dataflow.locale(),a=s.type;return("left"===n||"right"===n?"Y":"X")+"-axis"+(r?` titled '${r}'`:"")+` for a ${ty(a)?"discrete":a} scale with `+_v(o,s,t)}},legend:{desc:"legend",caption:function(t){const e=t.datum,n=e.title?Nv(t):null,r=((e.type||"")+" legend").trim(),i=e.scales,s=Object.keys(i),o=t.context,a=o.scales[i[s[0]]].value,l=o.dataflow.locale();return((u=r).length?u[0].toUpperCase()+u.slice(1):u)+(n?` titled '${n}'`:"")+" for "+function(t){return(t=t.map(t=>t+("fill"===t||"stroke"===t?" color":""))).length<2?t[0]:t.slice(0,-1).join(", ")+" and "+se(t)}(s)+" with "+_v(l,a,t);var u}},"title-text":{desc:"title",caption:t=>`Title text '${Dv(t)}'`},"title-subtitle":{desc:"subtitle",caption:t=>`Subtitle text '${Dv(t)}'`}},Ev={ariaRole:"role",ariaRoleDescription:"aria-roledescription",description:"aria-label"};function kv(t,e){const n=!1===e.aria;if(t("aria-hidden",n||void 0),n||null==e.description)for(const r in Ev)t(Ev[r],void 0);else{const n=e.mark.marktype;t("aria-label",e.description),t("role",e.ariaRole||("group"===n?"graphics-object":"graphics-symbol")),t("aria-roledescription",e.ariaRoleDescription||n+" mark")}}function Av(t){return!1===t.aria?{"aria-hidden":!0}:Sv[t.role]?null:Cv[t.role]?function(t,e){try{const n=t.items[0],r=e.caption||(()=>"");return wv(e.role||"graphics-symbol",e.desc,n.description||r(n))}catch(n){return null}}(t,Cv[t.role]):function(t){const e=t.marktype,n="group"===e||"text"===e||t.items.some(t=>null!=t.description&&!1!==t.aria);return wv(n?"graphics-object":"graphics-symbol",e+" mark container",t.description)}(t)}function Dv(t){return Ce(t.text).join(" ")}function Nv(t){try{return Ce(se(t.items).items[0].text).join(" ")}catch(e){return null}}const Tv=t=>(t+"").replace(/&/g,"&amp;").replace(/"/g,"&quot;");function Ov(t,e,n){var r,i,s="<"+t;if(e)for(r in e)null!=(i=e[r])&&(s+=" "+r+'="'+Tv(i)+'"');return n&&(s+=" "+n),s+">"}function Iv(t){return"</"+t+">"}const Rv={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},Fv={fill:"none","stroke-miterlimit":10},Mv=Ef.xmlns;function $v(t){Ep.call(this,t),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}var Pv=Ue($v,Ep),zv=Ep.prototype;function Lv(t,e,n){var r,i,s;if("radial"===e.gradient){var o=vp(t,n++,"pattern",Mv);o.setAttribute("id","p_"+e.id),o.setAttribute("viewBox","0,0,1,1"),o.setAttribute("width","100%"),o.setAttribute("height","100%"),o.setAttribute("preserveAspectRatio","xMidYMid slice"),(o=vp(o,0,"rect",Mv)).setAttribute("width","1"),o.setAttribute("height","1"),o.setAttribute("fill","url("+Kv()+"#"+e.id+")"),(t=vp(t,n++,"radialGradient",Mv)).setAttribute("id",e.id),t.setAttribute("fx",e.x1),t.setAttribute("fy",e.y1),t.setAttribute("fr",e.r1),t.setAttribute("cx",e.x2),t.setAttribute("cy",e.y2),t.setAttribute("r",e.r2)}else(t=vp(t,n++,"linearGradient",Mv)).setAttribute("id",e.id),t.setAttribute("x1",e.x1),t.setAttribute("x2",e.x2),t.setAttribute("y1",e.y1),t.setAttribute("y2",e.y2);for(r=0,i=e.stops.length;r<i;++r)(s=vp(t,r,"stop",Mv)).setAttribute("offset",e.stops[r].offset),s.setAttribute("stop-color",e.stops[r].color);return bp(t,r),n}function Bv(t,e,n){var r;return(t=vp(t,n,"clipPath",Mv)).setAttribute("id",e.id),e.path?(r=vp(t,0,"path",Mv)).setAttribute("d",e.path):((r=vp(t,0,"rect",Mv)).setAttribute("x",0),r.setAttribute("y",0),r.setAttribute("width",e.width),r.setAttribute("height",e.height)),bp(t,1),n+1}function jv(t,e){for(;t&&t.dirty!==e;t=t.mark.group){if(t.dirty=e,!t.mark||t.mark.dirty===e)return;t.mark.dirty=e}}function Uv(t,e,n,r,i){let s,o=t._svg;if(!o&&(s=e.ownerDocument,o=gp(s,r,Mv),t._svg=o,t.mark&&(o.__data__=t,o.__values__={fill:"default"},"g"===r))){const e=gp(s,"path",Mv);o.appendChild(e),e.__data__=t;const n=gp(s,"g",Mv);o.appendChild(n),n.__data__=t;const r=gp(s,"path",Mv);o.appendChild(r),r.__data__=t,r.__values__={fill:"default"}}return(o.ownerSVGElement!==i||function(t,e){return t.parentNode&&t.parentNode.childNodes.length>1&&t.previousSibling!=e}(o,n))&&e.insertBefore(o,n?n.nextSibling:e.firstChild),o}Pv.initialize=function(t,e,n,r){if(this._defs={gradient:{},clipping:{}},t){this._svg=vp(t,0,"svg",Mv),this._svg.setAttribute("class","marks"),bp(t,1),this._root=vp(this._svg,0,"g",Mv);for(const t in Fv)this._root.setAttribute(t,Fv[t]);bp(this._svg,1)}return this.background(this._bgcolor),zv.initialize.call(this,t,e,n,r)},Pv.background=function(t){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",t),zv.background.apply(this,arguments)},Pv.resize=function(t,e,n,r){return zv.resize.call(this,t,e,n,r),this._svg&&(this._svg.setAttribute("width",this._width*this._scale),this._svg.setAttribute("height",this._height*this._scale),this._svg.setAttribute("viewBox","0 0 "+this._width+" "+this._height),this._root.setAttribute("transform","translate("+this._origin+")")),this._dirty=[],this},Pv.canvas=function(){return this._svg},Pv.svg=function(){if(!this._svg)return null;var t={class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height};for(var e in Ef)t[e]=Ef[e];var n=this._bgcolor?Ov("rect",{width:this._width,height:this._height,fill:this._bgcolor})+Iv("rect"):"";return Ov("svg",t)+(this._defs.el?this._defs.el.outerHTML:"")+n+this._root.outerHTML+Iv("svg")},Pv._render=function(t){return this._dirtyCheck()&&(this._dirtyAll&&this._resetDefs(),this.draw(this._root,t),bp(this._root,1)),this.updateDefs(),this._dirty=[],++this._dirtyID,this},Pv.updateDefs=function(){const t=this._svg,e=this._defs;let n=e.el,r=0;for(const i in e.gradient)n||(e.el=n=vp(t,0,"defs",Mv)),r=Lv(n,e.gradient[i],r);for(const i in e.clipping)n||(e.el=n=vp(t,0,"defs",Mv)),r=Bv(n,e.clipping[i],r);n&&(0===r?(t.removeChild(n),e.el=null):bp(n,r))},Pv._resetDefs=function(){var t=this._defs;t.gradient={},t.clipping={}},Pv.dirty=function(t){t.dirty!==this._dirtyID&&(t.dirty=this._dirtyID,this._dirty.push(t))},Pv.isDirty=function(t){return this._dirtyAll||!t._svg||t.dirty===this._dirtyID},Pv._dirtyCheck=function(){this._dirtyAll=!0;var t=this._dirty;if(!t.length||!this._dirtyID)return!0;var e,n,r,i,s,o,a,l=++this._dirtyID;for(s=0,o=t.length;s<o;++s)(n=(e=t[s]).mark).marktype!==r&&(i=op[r=n.marktype]),n.zdirty&&n.dirty!==l&&(this._dirtyAll=!1,jv(e,l),n.items.forEach((function(t){t.dirty=l}))),n.zdirty||(e.exit?(i.nested&&n.items.length?(a=n.items[0])._svg&&this._update(i,a._svg,a):e._svg&&(a=e._svg.parentNode)&&a.removeChild(e._svg),e._svg=null):(e=i.nested?n.items[0]:e)._update!==l&&(e._svg&&e._svg.ownerSVGElement?this._update(i,e._svg,e):(this._dirtyAll=!1,jv(e,l)),e._update=l));return!this._dirtyAll},Pv.draw=function(t,e,n){if(!this.isDirty(e))return e._svg;var r,i=this._svg,s=op[e.marktype],o=!1===e.interactive?"none":null,a="g"===s.tag,l=null,u=0;(r=Uv(e,t,n,"g",i)).setAttribute("class",xp(e));const c=Av(e);for(const d in c)Yv(r,d,c[d]);a||Yv(r,"pointer-events",o),Yv(r,"clip-path",e.clip?md(this,e,e.group):null);const h=t=>{const e=this.isDirty(t),n=Uv(t,r,l,s.tag,i);e&&(this._update(s,n,t),a&&function(t,e,n){e=e.lastChild.previousSibling;let r,i=0;nf(n,n=>{r=t.draw(e,n,r),++i}),bp(e,1+i)}(this,n,t)),l=n,++u};return s.nested?e.items.length&&h(e.items[0]):nf(e,h),bp(r,u),r};var Vv=null,Wv=null,qv={group:function(t,e,n){const r=Vv=e.childNodes[2];Wv=r.__values__,t.foreground(Gv,n,this),Wv=e.__values__,Vv=e.childNodes[1],t.content(Gv,n,this);const i=Vv=e.childNodes[0];t.background(Gv,n,this);const s=!1===n.mark.interactive?"none":null;if(s!==Wv.events&&(Yv(r,"pointer-events",s),Yv(i,"pointer-events",s),Wv.events=s),n.strokeForeground&&n.stroke){const t=n.fill;Yv(r,"display",null),this.style(i,n),Yv(i,"stroke",null),t&&(n.fill=null),Wv=r.__values__,this.style(r,n),t&&(n.fill=t),Vv=null}else Yv(r,"display","none")},image:function(t,e,n){!1===n.smooth?(Hv(e,"image-rendering","optimizeSpeed"),Hv(e,"image-rendering","pixelated")):Hv(e,"image-rendering",null)},text:function(t,e,n){let r,i,s,o,a=Xf(n);Jt(a)?(i=a.map(t=>Qf(n,t)),r=i.join("\n"),r!==Wv.text&&(bp(e,0),s=e.ownerDocument,o=Kf(n),i.forEach((t,r)=>{const i=gp(s,"tspan",Mv);i.__data__=n,i.textContent=t,r&&(i.setAttribute("x",0),i.setAttribute("dy",o)),e.appendChild(i)}),Wv.text=r)):(i=Qf(n,a),i!==Wv.text&&(e.textContent=i,Wv.text=i)),Yv(e,"font-family",Jf(n)),Yv(e,"font-size",Yf(n)+"px"),Yv(e,"font-style",n.fontStyle),Yv(e,"font-variant",n.fontVariant),Yv(e,"font-weight",n.fontWeight)}};function Hv(t,e,n){n!==Wv[e]&&(null==n?t.style.removeProperty(e):t.style.setProperty(e,n+""),Wv[e]=n)}function Gv(t,e,n){e!==Wv[t]&&(n?function(t,e,n,r){null!=n?t.setAttributeNS(r,e,n):t.removeAttributeNS(r,e)}(Vv,t,e,n):Yv(Vv,t,e),Wv[t]=e)}function Yv(t,e,n){null!=n?t.setAttribute(e,n):t.removeAttribute(e)}function Kv(){let t;return"undefined"==typeof window?"":(t=window.location).hash?t.href.slice(0,-t.hash.length):t.href}function Xv(t){Ep.call(this,t),this._text={head:"",bg:"",root:"",foot:"",defs:"",body:""},this._defs={gradient:{},clipping:{}}}Pv._update=function(t,e,n){Vv=e,Wv=e.__values__,kv(Gv,n),t.attr(Gv,n,this);const r=qv[t.type];r&&r.call(this,t,e,n),Vv&&this.style(Vv,n)},Pv.style=function(t,e){if(null!=e)for(const n in Rv){let r="font"===n?Jf(e):e[n];if(r===Wv[n])continue;const i=Rv[n];null==r?t.removeAttribute(i):(uc(r)&&(r=cc(r,this._defs.gradient,Kv())),t.setAttribute(i,r+"")),Wv[n]=r}};var Zv=Ue(Xv,Ep),Qv=Ep.prototype;function Jv(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}Zv.resize=function(t,e,n,r){Qv.resize.call(this,t,e,n,r);var i=this._origin,s=this._text,o={class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 "+this._width+" "+this._height};for(var a in Ef)o[a]=Ef[a];s.head=Ov("svg",o);var l=this._bgcolor;return"transparent"!==l&&"none"!==l||(l=null),s.bg=l?Ov("rect",{width:this._width,height:this._height,fill:l})+Iv("rect"):"",s.root=Ov("g",Fe({},Fv,{transform:"translate("+i+")"})),s.foot=Iv("g")+Iv("svg"),this},Zv.background=function(){var t=Qv.background.apply(this,arguments);return arguments.length&&this._text.head&&this.resize(this._width,this._height,this._origin,this._scale),t},Zv.svg=function(){var t=this._text;return t.head+t.defs+t.bg+t.root+t.body+t.foot},Zv._render=function(t){return this._text.body=this.mark(t),this._text.defs=this.buildDefs(),this},Zv.buildDefs=function(){let t,e="";for(const n in this._defs.gradient){const r=this._defs.gradient[n],i=r.stops;"radial"===r.gradient?(e+=Ov(t="pattern",{id:"p_"+n,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e+=Ov("rect",{width:"1",height:"1",fill:"url(#"+n+")"})+Iv("rect"),e+=Iv(t),e+=Ov(t="radialGradient",{id:n,fx:r.x1,fy:r.y1,fr:r.r1,cx:r.x2,cy:r.y2,r:r.r2})):e+=Ov(t="linearGradient",{id:n,x1:r.x1,x2:r.x2,y1:r.y1,y2:r.y2});for(let t=0;t<i.length;++t)e+=Ov("stop",{offset:i[t].offset,"stop-color":i[t].color})+Iv("stop");e+=Iv(t)}for(const n in this._defs.clipping){const t=this._defs.clipping[n];e+=Ov("clipPath",{id:n}),e+=t.path?Ov("path",{d:t.path})+Iv("path"):Ov("rect",{x:0,y:0,width:t.width,height:t.height})+Iv("rect"),e+=Iv("clipPath")}return e?Ov("defs")+e+Iv("defs"):""},Zv.attr=function(t,e,n,r){const i={},s=(t,e,n,r)=>{i[r||t]=e};return Array.isArray(n)?n.forEach(t=>t(s,e,this)):n(s,e,this),r&&function(t,e,n,r,i){if(null==e)return t;if("bgrect"===r&&!1===n.interactive&&(t["pointer-events"]="none"),"bgfore"===r&&(!1===n.interactive&&(t["pointer-events"]="none"),t.display="none",null!==e.fill))return t;"image"===r&&!1===e.smooth&&(t.style="image-rendering: optimizeSpeed; image-rendering: pixelated;"),"text"===r&&(t["font-family"]=Jf(e),t["font-size"]=Yf(e)+"px",e.fontStyle&&(t["font-style"]=e.fontStyle),e.fontVariant&&(t["font-variant"]=e.fontVariant),e.fontWeight&&(t["font-weight"]=e.fontWeight));for(const s in Rv){let n=e[s];const r=Rv[s];("transparent"!==n||"fill"!==r&&"stroke"!==r)&&null!=n&&(uc(n)&&(n=cc(n,i.gradient,"")),t[r]=n)}}(i,e,t,r,this._defs),i},Zv.href=function(t){var e,n=this,r=t.href;if(r){if(e=n._hrefs&&n._hrefs[r])return e;n.sanitizeURL(r).then(t=>{t["xlink:href"]=t.href,t.href=null,(n._hrefs||(n._hrefs={}))[r]=t})}return null},Zv.mark=function(t){const e=op[t.marktype],n=e.tag,r=[kv,e.attr];let i="";i+=Ov("g",Fe({class:xp(t),"clip-path":t.clip?md(this,t,t.group):null},Av(t),{"pointer-events":"g"!==n&&!1===t.interactive?"none":null}));const s=s=>{const o=this.href(s);if(o&&(i+=Ov("a",o)),i+=Ov(n,this.attr(t,s,r,"g"!==n?n:null)),"text"===n){const t=Xf(s);if(Jt(t)){const e={x:0,dy:Kf(s)};for(let n=0;n<t.length;++n)i+=Ov("tspan",n?e:null)+Jv(Qf(s,t[n]))+Iv("tspan")}else i+=Jv(Qf(s,t))}else if("g"===n){const n=s.strokeForeground,r=s.fill,o=s.stroke;n&&o&&(s.stroke=null),i+=Ov("path",this.attr(t,s,e.background,"bgrect"))+Iv("path"),i+=Ov("g",this.attr(t,s,e.content))+this.markGroup(s)+Iv("g"),n&&o?(r&&(s.fill=null),s.stroke=o,i+=Ov("path",this.attr(t,s,e.foreground,"bgrect"))+Iv("path"),r&&(s.fill=r)):i+=Ov("path",this.attr(t,s,e.foreground,"bgfore"))+Iv("path")}i+=Iv(n),o&&(i+=Iv("a"))};return e.nested?t.items&&t.items.length&&s(t.items[0]):nf(t,s),i+Iv("g")},Zv.markGroup=function(t){let e="";return nf(t,t=>{e+=this.mark(t)}),e};var tb={Canvas:"canvas",PNG:"png",SVG:"svg",None:"none"},eb={};function nb(t,e){return t=String(t||"").toLowerCase(),arguments.length>1?(eb[t]=e,this):eb[t]}function rb(t,e,n){const r=[],i=(new gd).union(e),s=t.marktype;return s?ib(t,i,n,r):"group"===s?sb(t,i,n,r):$t("Intersect scene must be mark node or group item.")}function ib(t,e,n,r){if(function(t,e,n){return t.bounds&&e.intersects(t.bounds)&&("group"===t.marktype||!1!==t.interactive&&(!n||n(t)))}(t,e,n)){const i=t.items,s=t.marktype,o=i.length;let a=0;if("group"===s)for(;a<o;++a)sb(i[a],e,n,r);else for(const t=op[s].isect;a<o;++a){let n=i[a];ob(n,e,t)&&r.push(n)}}return r}function sb(t,e,n,r){n&&n(t.mark)&&ob(t,e,op.group.isect)&&r.push(t);const i=t.items,s=i&&i.length;if(s){const o=t.x||0,a=t.y||0;e.translate(-o,-a);for(let t=0;t<s;++t)ib(i[t],e,n,r);e.translate(o,a)}return r}function ob(t,e,n){const r=t.bounds;return e.encloses(r)||e.intersects(r)&&n(t,e)}eb.canvas=eb.png={renderer:Up,headless:Up,handler:$p},eb.svg={renderer:$v,headless:Xv,handler:qp},eb.none={};var ab=new gd,lb=function(t){var e=t.clip;if(ke(e))e(Od(ab.clear()));else{if(!e)return;ab.set(0,0,t.group.width,t.group.height)}t.bounds.intersect(ab)};function ub(t,e,n){return t===e||("path"===n?cb(t,e):t instanceof Date&&e instanceof Date?+t==+e:He(t)&&He(e)?Math.abs(t-e)<=1e-9:t&&e&&(te(t)||te(e))?null!=t&&null!=e&&function(t,e){var n,r,i=Object.keys(t),s=Object.keys(e);if(i.length!==s.length)return!1;for(i.sort(),s.sort(),r=i.length-1;r>=0;r--)if(i[r]!=s[r])return!1;for(r=i.length-1;r>=0;r--)if(!ub(t[n=i[r]],e[n],n))return!1;return typeof t==typeof e}(t,e):t==e)}function cb(t,e){return ub(uh(t),uh(e))}function hb(){pd(),lc=0}function db(t){ba.call(this,null,t)}function fb(t,e,n){return e(t.bounds.clear(),t,n)}function pb(t){ba.call(this,0,t)}function mb(t){ba.call(this,null,t)}function gb(t){ba.call(this,null,t)}Ue(db,ba).transform=function(t,e){var n,r=e.dataflow,i=t.mark,s=i.marktype,o=op[s],a=o.bound,l=i.bounds;if(o.nested)i.items.length&&r.dirty(i.items[0]),l=fb(i,a),i.items.forEach((function(t){t.bounds.clear().union(l)}));else if("group"===s||t.modified())switch(e.visit(e.MOD,t=>r.dirty(t)),l.clear(),i.items.forEach(t=>l.union(fb(t,a))),i.role){case"axis":case"legend":case"title":e.reflow()}else n=e.changed(e.REM),e.visit(e.ADD,t=>{l.union(fb(t,a))}),e.visit(e.MOD,t=>{n=n||l.alignsWith(t.bounds),r.dirty(t),l.union(fb(t,a))}),n&&(l.clear(),i.items.forEach(t=>l.union(t.bounds)));return lb(i),e.modifies("bounds")},pb.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},Ue(pb,ba).transform=function(t,e){var n=function(t){var e=t._signals[":vega_identifier:"];return e||(t._signals[":vega_identifier:"]=e=t.add(0)),e}(e.dataflow),r=n.value,i=t.as;return e.visit(e.ADD,t=>{t[i]||(t[i]=++r)}),n.set(this.value=r),e},Ue(mb,ba).transform=function(t,e){var n=this.value;n||((n=e.dataflow.scenegraph().mark(t.markdef,function(t){var e=t.groups,n=t.parent;return e&&1===e.size?e.get(Object.keys(e.object)[0]):e&&n?e.lookup(n):null}(t),t.index)).group.context=t.context,t.context.group||(t.context.group=n.group),n.source=this.source,n.clip=t.clip,n.interactive=t.interactive,this.value=n);var r="group"===n.marktype?bd:vd;return e.visit(e.ADD,t=>r.call(t,n)),(t.modified("clip")||t.modified("interactive"))&&(n.clip=t.clip,n.interactive=!!t.interactive,n.zdirty=!0,e.reflow()),n.items=e.source,e};var yb=Ue(gb,ba),vb={parity:t=>t.filter((t,e)=>e%2?t.opacity=0:1),greedy:(t,e)=>{var n;return t.filter((t,r)=>r&&bb(n.bounds,t.bounds,e)?t.opacity=0:(n=t,1))}};function bb(t,e,n){return n>Math.max(e.x1-t.x2,t.x1-e.x2,e.y1-t.y2,t.y1-e.y2)}function xb(t,e){for(var n,r=1,i=t.length,s=t[0].bounds;r<i;s=n,++r)if(bb(s,n=t[r].bounds,e))return!0}function _b(t){var e=t.bounds;return e.width()>1&&e.height()>1}function wb(t){return t.forEach(t=>t.opacity=1),t}function Sb(t,e){return t.reflow(e.modified()).modifies("opacity")}function Cb(t){ba.call(this,null,t)}yb.transform=function(t,e){var n,r,i,s=vb[t.method]||vb.parity,o=e.materialize(e.SOURCE).source,a=t.separation||0;if(o&&o.length){if(!t.method)return t.modified("method")&&(wb(o),e=Sb(e,t)),e;if((o=o.filter(_b)).length){if(t.sort&&(o=o.slice().sort(t.sort)),n=wb(o),e=Sb(e,t),n.length>=3&&xb(n,a)){do{n=s(n,a)}while(n.length>=3&&xb(n,a));n.length<3&&!se(o).opacity&&(n.length>1&&(se(n).opacity=0),se(o).opacity=1)}var l,u,c,h;return t.boundScale&&t.boundTolerance>=0&&(l=t.boundOrient,u=+t.boundTolerance,c=t.boundScale.range(),h=new gd,l===rc||"bottom"===l?h.set(c[0],-1/0,c[1],1/0):h.set(-1/0,c[0],1/0,c[1]),h.expand(u||1),r=t=>h.encloses(t.bounds),o.forEach(t=>{r(t)||(t.opacity=0)})),i=n[0].mark.bounds.clear(),o.forEach(t=>{t.opacity&&i.union(t.bounds)}),e}}},Ue(Cb,ba).transform=function(t,e){var n=e.dataflow;if(e.visit(e.ALL,t=>n.dirty(t)),e.fields&&e.fields.zindex){var r=e.source&&e.source[0];r&&(r.mark.zdirty=!0)}};const Eb=new gd;function kb(t,e,n){return t[e]===n?0:(t[e]=n,1)}function Ab(t){var e=t.items[0].orient;return e===ic||e===sc}function Db(t,e,n,r){var i,s,o=e.items[0],a=o.datum,l=null!=o.translate?o.translate:.5,u=o.orient,c=function(t){var e=+t.grid;return[t.ticks?e++:-1,t.labels?e++:-1,e+ +t.domain]}(a),h=o.range,d=o.offset,f=o.position,p=o.minExtent,m=o.maxExtent,g=a.title&&o.items[c[2]].items[0],y=o.titlePadding,v=o.bounds,b=g&&Zf(g),x=0,_=0;switch(Eb.clear().union(v),v.clear(),(i=c[0])>-1&&v.union(o.items[i].bounds),(i=c[1])>-1&&v.union(o.items[i].bounds),u){case rc:x=f||0,_=-d,s=Math.max(p,Math.min(m,-v.y1)),v.add(0,-s).add(h,0),g&&Nb(t,g,s,y,b,0,-1,v);break;case ic:x=-d,_=f||0,s=Math.max(p,Math.min(m,-v.x1)),v.add(-s,0).add(0,h),g&&Nb(t,g,s,y,b,1,-1,v);break;case sc:x=n+d,_=f||0,s=Math.max(p,Math.min(m,v.x2)),v.add(0,0).add(s,h),g&&Nb(t,g,s,y,b,1,1,v);break;case"bottom":x=f||0,_=r+d,s=Math.max(p,Math.min(m,v.y2)),v.add(0,0).add(h,s),g&&Nb(t,g,s,y,0,0,1,v);break;default:x=o.x,_=o.y}return Nd(v.translate(x,_),o),kb(o,"x",x+l)|kb(o,"y",_+l)&&(o.bounds=Eb,t.dirty(o),o.bounds=v,t.dirty(o)),o.mark.bounds.clear().union(v)}function Nb(t,e,n,r,i,s,o,a){const l=e.bounds;if(e.auto){const a=o*(n+i+r);let u=0,c=0;t.dirty(e),s?u=(e.x||0)-(e.x=a):c=(e.y||0)-(e.y=a),e.mark.bounds.clear().union(l.translate(-u,-c)),t.dirty(e)}a.union(l)}const Tb=(t,e)=>Math.floor(Math.min(t,e)),Ob=(t,e)=>Math.ceil(Math.max(t,e));function Ib(t){return(new gd).set(0,0,t.width||0,t.height||0)}function Rb(t){var e=t.bounds.clone();return e.empty()?e.set(0,0,0,0):e.translate(-(t.x||0),-(t.y||0))}function Fb(t,e,n){var r=te(t)?t[e]:t;return null!=r?r:void 0!==n?n:0}function Mb(t){return t<0?Math.ceil(-t):0}function $b(t,e,n){var r,i,s,o,a,l,u,c,h,d,f,p=!n.nodirty,m="flush"===n.bounds?Ib:Rb,g=Eb.set(0,0,0,0),y=Fb(n.align,"column"),v=Fb(n.align,ac),b=Fb(n.padding,"column"),x=Fb(n.padding,ac),_=n.columns||e.length,w=_<=0?1:Math.ceil(e.length/_),S=e.length,C=Array(S),E=Array(_),k=0,A=Array(S),D=Array(w),N=0,T=Array(S),O=Array(S),I=Array(S);for(i=0;i<_;++i)E[i]=0;for(i=0;i<w;++i)D[i]=0;for(i=0;i<S;++i)a=I[i]=m(l=e[i]),l.x=l.x||0,T[i]=0,l.y=l.y||0,O[i]=0,s=i%_,o=~~(i/_),k=Math.max(k,u=Math.ceil(a.x2)),N=Math.max(N,c=Math.ceil(a.y2)),E[s]=Math.max(E[s],u),D[o]=Math.max(D[o],c),C[i]=b+Mb(a.x1),A[i]=x+Mb(a.y1),p&&t.dirty(e[i]);for(i=0;i<S;++i)i%_==0&&(C[i]=0),i<_&&(A[i]=0);if("each"===y)for(s=1;s<_;++s){for(f=0,i=s;i<S;i+=_)f<C[i]&&(f=C[i]);for(i=s;i<S;i+=_)C[i]=f+E[s-1]}else if("all"===y){for(f=0,i=0;i<S;++i)i%_&&f<C[i]&&(f=C[i]);for(i=0;i<S;++i)i%_&&(C[i]=f+k)}else for(y=!1,s=1;s<_;++s)for(i=s;i<S;i+=_)C[i]+=E[s-1];if("each"===v)for(o=1;o<w;++o){for(f=0,r=(i=o*_)+_;i<r;++i)f<A[i]&&(f=A[i]);for(i=o*_;i<r;++i)A[i]=f+D[o-1]}else if("all"===v){for(f=0,i=_;i<S;++i)f<A[i]&&(f=A[i]);for(i=_;i<S;++i)A[i]=f+N}else for(v=!1,o=1;o<w;++o)for(r=(i=o*_)+_;i<r;++i)A[i]+=D[o-1];for(h=0,i=0;i<S;++i)T[i]+=(h=C[i]+(i%_?h:0))-e[i].x;for(s=0;s<_;++s)for(d=0,i=s;i<S;i+=_)O[i]+=(d+=A[i])-e[i].y;if(y&&Fb(n.center,"column")&&w>1)for(i=0;i<S;++i)(h=(a="all"===y?k:E[i%_])-I[i].x2-e[i].x-T[i])>0&&(T[i]+=h/2);if(v&&Fb(n.center,ac)&&1!==_)for(i=0;i<S;++i)(d=(a="all"===v?N:D[~~(i/_)])-I[i].y2-e[i].y-O[i])>0&&(O[i]+=d/2);for(i=0;i<S;++i)g.union(I[i].translate(T[i],O[i]));switch(h=Fb(n.anchor,"x"),d=Fb(n.anchor,"y"),Fb(n.anchor,"column")){case oc:h-=g.width();break;case"middle":h-=g.width()/2}switch(Fb(n.anchor,ac)){case oc:d-=g.height();break;case"middle":d-=g.height()/2}for(h=Math.round(h),d=Math.round(d),g.clear(),i=0;i<S;++i)e[i].mark.bounds.clear();for(i=0;i<S;++i)(l=e[i]).x+=T[i]+=h,l.y+=O[i]+=d,g.union(l.mark.bounds.union(l.bounds.translate(T[i],O[i]))),p&&t.dirty(l);return g}function Pb(t,e){return"x1"===e?t.x||0:"y1"===e?t.y||0:"x2"===e?(t.x||0)+(t.width||0):"y2"===e?(t.y||0)+(t.height||0):void 0}function zb(t,e){return t.bounds[e]}function Lb(t,e,n,r,i,s,o,a,l,u,c,h,d,f){var p,m,g,y,v,b,x,_,w,S=n.length,C=0,E=0;if(!S)return C;for(p=c;p<S;p+=h)n[p]&&(C=o(C,l(n[p],u)));if(!e.length)return C;for(e.length>i&&(t.warn("Grid headers exceed limit: "+i),e=e.slice(0,i)),C+=s,m=0,y=e.length;m<y;++m)t.dirty(e[m]),e[m].mark.bounds.clear();for(p=c,m=0,y=e.length;m<y;++m,p+=h){for(v=(b=e[m]).mark.bounds,g=p;g>=0&&null==(x=n[g]);g-=d);a?(_=null==f?x.x:Math.round(x.bounds.x1+f*x.bounds.width()),w=C):(_=C,w=null==f?x.y:Math.round(x.bounds.y1+f*x.bounds.height())),v.union(b.bounds.translate(_-(b.x||0),w-(b.y||0))),b.x=_,b.y=w,t.dirty(b),E=o(E,v[u])}return E}function Bb(t,e,n,r,i,s){if(e){t.dirty(e);var o=n,a=n;r?o=Math.round(i.x1+s*i.width()):a=Math.round(i.y1+s*i.height()),e.bounds.translate(o-(e.x||0),a-(e.y||0)),e.mark.bounds.clear().union(e.bounds),e.x=o,e.y=a,t.dirty(e)}}function jb(t,e,n,r,i,s,o){const a=function(t,e){const n=t[e]||{};return(e,r)=>null!=n[e]?n[e]:null!=t[e]?t[e]:r}(n,e),l=(h=t,d=a("offset",0),f=-1/0,h.forEach(t=>{null!=t.offset&&(f=Math.max(f,t.offset))}),f>-1/0?f:d),u=a("anchor","start"),c=u===oc?1:"middle"===u?.5:0;var h,d,f;const p={align:"each",bounds:a("bounds","flush"),columns:"vertical"===a("direction")?1:t.length,padding:a("margin",8),center:a("center"),nodirty:!0};switch(e){case ic:p.anchor={x:Math.floor(r.x1)-l,column:oc,y:c*(o||r.height()+2*r.y1),row:u};break;case sc:p.anchor={x:Math.ceil(r.x2)+l,y:c*(o||r.height()+2*r.y1),row:u};break;case rc:p.anchor={y:Math.floor(i.y1)-l,row:oc,x:c*(s||i.width()+2*i.x1),column:u};break;case"bottom":p.anchor={y:Math.ceil(i.y2)+l,x:c*(s||i.width()+2*i.x1),column:u};break;case"top-left":p.anchor={x:l,y:l};break;case"top-right":p.anchor={x:s-l,y:l,column:oc};break;case"bottom-left":p.anchor={x:l,y:o-l,row:oc};break;case"bottom-right":p.anchor={x:s-l,y:o-l,column:oc,row:oc}}return p}function Ub(t,e){var n,r,i,s,o=e.items[0],a=o.datum,l=o.orient,u=o.bounds,c=o.x,h=o.y;return o._bounds?o._bounds.clear().union(u):o._bounds=u.clone(),u.clear(),function(t,e,n){var r=e.padding,i=r-n.x,s=r-n.y;if(e.datum.title){var o=e.items[1].items[0],a=o.anchor,l=e.titlePadding||0,u=r-o.x,c=r-o.y;switch(o.orient){case ic:i+=Math.ceil(o.bounds.width())+l;break;case sc:case"bottom":break;default:s+=o.bounds.height()+l}switch((i||s)&&Wb(t,n,i,s),o.orient){case ic:c+=Vb(e,n,o,a,1,1);break;case sc:u+=Vb(e,n,o,oc,0,0)+l,c+=Vb(e,n,o,a,1,1);break;case"bottom":u+=Vb(e,n,o,a,0,0),c+=Vb(e,n,o,oc,-1,0,1)+l;break;default:u+=Vb(e,n,o,a,0,0)}(u||c)&&Wb(t,o,u,c),(u=Math.round(o.bounds.x1-r))<0&&(Wb(t,n,-u,0),Wb(t,o,-u,0))}else(i||s)&&Wb(t,n,i,s)}(t,o,o.items[0].items[0]),u=function(t,e){return t.items.forEach(t=>e.union(t.bounds)),e.x1=t.padding,e.y1=t.padding,e}(o,u),n=2*o.padding,r=2*o.padding,u.empty()||(n=Math.ceil(u.width()+n),r=Math.ceil(u.height()+r)),"symbol"===a.type&&(s=(i=o.items[0].items[0].items[0].items).reduce((t,e)=>(t[e.column]=Math.max(e.bounds.x2-e.x,t[e.column]||0),t),{}),i.forEach(t=>{t.width=s[t.column],t.height=t.bounds.y2-t.y})),"none"!==l&&(o.x=c=0,o.y=h=0),o.width=n,o.height=r,Nd(u.set(c,h,c+n,h+r),o),o.mark.bounds.clear().union(u),o}function Vb(t,e,n,r,i,s,o){const a=n.datum.vgrad,l=("symbol"===t.datum.type||!s&&a||o?e:e.items[0]).bounds[i?"y2":"x2"]-t.padding,u=a&&s?l:0,c=a&&s?0:l,h=i<=0?0:Zf(n);return Math.round("start"===r?u:r===oc?c-h:.5*(l-h))}function Wb(t,e,n,r){e.x+=n,e.y+=r,e.bounds.translate(n,r),e.mark.bounds.translate(n,r),t.dirty(e)}function qb(t){ba.call(this,null,t)}function Hb(t){ba.call(this,null,t)}function Gb(t){ba.call(this,null,t)}function Yb(){return vn({})}function Kb(t){ba.call(this,null,t)}function Xb(t){ba.call(this,[],t)}Ue(qb,ba).transform=function(t,e){var n,r=e.dataflow;return t.mark.items.forEach(e=>{t.layout&&function(t,e,n){var r,i,s,o,a,l,u,c=function(t){for(var e,n,r=t.items,i=r.length,s=0,o={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};s<i;++s)if(n=(e=r[s]).items,"group"===e.marktype)switch(e.role){case"axis":case"legend":case"title":break;case"row-header":o.rowheaders.push(...n);break;case"row-footer":o.rowfooters.push(...n);break;case"column-header":o.colheaders.push(...n);break;case"column-footer":o.colfooters.push(...n);break;case"row-title":o.rowtitle=n[0];break;case"column-title":o.coltitle=n[0];break;default:o.marks.push(...n)}return o}(e),h=c.marks,d="flush"===n.bounds?Pb:zb,f=n.offset,p=n.columns||h.length,m=p<=0?1:Math.ceil(h.length/p),g=m*p;const y=$b(t,h,n);y.empty()&&y.set(0,0,0,0),c.rowheaders&&(l=Fb(n.headerBand,ac,null),r=Lb(t,c.rowheaders,h,0,m,-Fb(f,"rowHeader"),Tb,0,d,"x1",0,p,1,l)),c.colheaders&&(l=Fb(n.headerBand,"column",null),i=Lb(t,c.colheaders,h,0,p,-Fb(f,"columnHeader"),Tb,1,d,"y1",0,1,p,l)),c.rowfooters&&(l=Fb(n.footerBand,ac,null),s=Lb(t,c.rowfooters,h,0,m,Fb(f,"rowFooter"),Ob,0,d,"x2",p-1,p,1,l)),c.colfooters&&(l=Fb(n.footerBand,"column",null),o=Lb(t,c.colfooters,h,0,p,Fb(f,"columnFooter"),Ob,1,d,"y2",g-p,1,p,l)),c.rowtitle&&(a=Fb(n.titleAnchor,ac),u=Fb(f,"rowTitle"),u=a===oc?s+u:r-u,l=Fb(n.titleBand,ac,.5),Bb(t,c.rowtitle,u,0,y,l)),c.coltitle&&(a=Fb(n.titleAnchor,"column"),u=Fb(f,"columnTitle"),u=a===oc?o+u:i-u,l=Fb(n.titleBand,"column",.5),Bb(t,c.coltitle,u,1,y,l))}(r,e,t.layout),function(t,e,n){var r,i,s,o,a,l=e.items,u=Math.max(0,e.width||0),c=Math.max(0,e.height||0),h=(new gd).set(0,0,u,c),d=h.clone(),f=h.clone(),p=[];for(o=0,a=l.length;o<a;++o)switch((i=l[o]).role){case"axis":(Ab(i)?d:f).union(Db(t,i,u,c));break;case"title":r=i;break;case"legend":p.push(Ub(t,i));break;case"frame":case"scope":case"row-header":case"row-footer":case"row-title":case"column-header":case"column-footer":case"column-title":d.union(i.bounds),f.union(i.bounds);break;default:h.union(i.bounds)}if(p.length){const e={};p.forEach(t=>{"none"!==(s=t.orient||sc)&&(e[s]||(e[s]=[])).push(t)});for(let r in e){const i=e[r];$b(t,i,jb(i,r,n.legends,d,f,u,c))}p.forEach(e=>{const r=e.bounds;if(r.equals(e._bounds)||(e.bounds=e._bounds,t.dirty(e),e.bounds=r,t.dirty(e)),n.autosize&&"fit"===n.autosize.type)switch(e.orient){case ic:case sc:h.add(r.x1,0).add(r.x2,0);break;case rc:case"bottom":h.add(0,r.y1).add(0,r.y2)}else h.union(r)})}h.union(d).union(f),r&&h.union(function(t,e,n,r,i){var s,o=e.items[0],a=o.orient,l=o.anchor,u=o.offset,c=o.padding,h=o.items[0].items[0],d=o.items[1]&&o.items[1].items[0],f=a===ic||a===sc?r:n,p=0,m=0,g=0,y=0,v=0;if("group"!==o.frame?a===ic?(p=i.y2,f=i.y1):a===sc?(p=i.y1,f=i.y2):(p=i.x1,f=i.x2):a===ic&&(p=r,f=0),s="start"===l?p:l===oc?f:(p+f)/2,d&&d.text){switch(a){case rc:case"bottom":v=h.bounds.height()+c;break;case ic:y=h.bounds.width()+c;break;case sc:y=-h.bounds.width()-c}Eb.clear().union(d.bounds),Eb.translate(y-(d.x||0),v-(d.y||0)),kb(d,"x",y)|kb(d,"y",v)&&(t.dirty(d),d.bounds.clear().union(Eb),d.mark.bounds.clear().union(Eb),t.dirty(d)),Eb.clear().union(d.bounds)}else Eb.clear();switch(Eb.union(h.bounds),a){case rc:m=s,g=i.y1-Eb.height()-u;break;case ic:m=i.x1-Eb.width()-u,g=s;break;case sc:m=i.x2+Eb.width()+u,g=s;break;case"bottom":m=s,g=i.y2+u;break;default:m=o.x,g=o.y}return kb(o,"x",m)|kb(o,"y",g)&&(Eb.translate(m,g),t.dirty(o),o.bounds.clear().union(Eb),e.bounds.clear().union(Eb),t.dirty(o)),o.bounds}(t,r,u,c,h)),e.clip&&h.set(0,0,e.width||0,e.height||0),function(t,e,n,r){const i=r.autosize||{},s=i.type;if(t._autosize<1||!s)return;let o=t._width,a=t._height,l=Math.max(0,e.width||0),u=Math.max(0,Math.ceil(-n.x1)),c=Math.max(0,Math.ceil(n.x2-l)),h=Math.max(0,e.height||0),d=Math.max(0,Math.ceil(-n.y1)),f=Math.max(0,Math.ceil(n.y2-h));if("padding"===i.contains){const e=t.padding();o-=e.left+e.right,a-=e.top+e.bottom}"none"===s?(u=0,d=0,l=o,h=a):"fit"===s?(l=Math.max(0,o-u-c),h=Math.max(0,a-d-f)):"fit-x"===s?(l=Math.max(0,o-u-c),a=h+d+f):"fit-y"===s?(o=l+u+c,h=Math.max(0,a-d-f)):"pad"===s&&(o=l+u+c,a=h+d+f),t._resizeView(o,a,l,h,[u,d],i.resize)}(t,e,h,n)}(r,e,t)}),(n=t.mark.group)&&"legend-entry"!==n.mark.role?e.reflow():e},Ue(Hb,ba).transform=function(t,e){if(this.value&&!t.modified())return e.StopPropagation;var n=e.dataflow.locale(),r=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=this.value,s=t.scale,o=cv(s,null==t.count?t.values?t.values.length:10:t.count,t.minstep),a=t.format||fv(n,s,o,t.formatSpecifier,t.formatType,!!t.values),l=t.values?hv(s,t.values,o):dv(s,o);return i&&(r.rem=i),i=l.map((function(t,e){return vn({index:e/(l.length-1||1),value:t,label:a(t)})})),t.extra&&i.length&&i.push(vn({index:-1,extra:{value:i[0].value},label:""})),r.source=i,r.add=i,this.value=i,r},Ue(Gb,ba).transform=function(t,e){var n=e.dataflow,r=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=t.item||Yb,s=t.key||gn,o=this.value;return Jt(r.encode)&&(r.encode=null),o&&(t.modified("key")||e.modified(s))&&$t("DataJoin does not support modified key function or fields."),o||(e=e.addAll(),this.value=o=function(t){const e=Be().test(t=>t.exit);return e.lookup=n=>e.get(t(n)),e}(s)),e.visit(e.ADD,t=>{const e=s(t);let n=o.get(e);n?n.exit?(o.empty--,r.add.push(n)):r.mod.push(n):(n=i(t),o.set(e,n),r.add.push(n)),n.datum=t,n.exit=!1}),e.visit(e.MOD,t=>{const e=s(t),n=o.get(e);n&&(n.datum=t,r.mod.push(n))}),e.visit(e.REM,t=>{const e=s(t),n=o.get(e);t!==n.datum||n.exit||(r.rem.push(n),n.exit=!0,++o.empty)}),e.changed(e.ADD_MOD)&&r.modifies("datum"),(e.clean()||t.clean&&o.empty>n.cleanThreshold)&&n.runAfter(o.clean),r},Ue(Kb,ba).transform=function(t,e){var n=e.fork(e.ADD_REM),r=t.mod||!1,i=t.encoders,s=e.encode;if(Jt(s)){if(!n.changed()&&!s.every((function(t){return i[t]})))return e.StopPropagation;s=s[0],n.encode=null}var o="enter"===s,a=i.update||qt,l=i.enter||qt,u=i.exit||qt,c=(s&&!o?i[s]:a)||qt;if(e.changed(e.ADD)&&(e.visit(e.ADD,(function(e){l(e,t),a(e,t)})),n.modifies(l.output),n.modifies(a.output),c!==qt&&c!==a&&(e.visit(e.ADD,(function(e){c(e,t)})),n.modifies(c.output))),e.changed(e.REM)&&u!==qt&&(e.visit(e.REM,(function(e){u(e,t)})),n.modifies(u.output)),o||c!==qt){var h=e.MOD|(t.modified()?e.REFLOW:0);o?(e.visit(h,(function(e){var i=l(e,t)||r;(c(e,t)||i)&&n.mod.push(e)})),n.mod.length&&n.modifies(l.output)):e.visit(h,(function(e){(c(e,t)||r)&&n.mod.push(e)})),n.mod.length&&n.modifies(c.output)}return n.changed()?n:e.StopPropagation},Ue(Xb,ba).transform=function(t,e){if(null!=this.value&&!t.modified())return e.StopPropagation;var n,r,i,s,o,a=e.dataflow.locale(),l=e.fork(e.NO_SOURCE|e.NO_FIELDS),u=this.value,c=t.type||"symbol",h=t.scale,d=+t.limit,f=cv(h,null==t.count?5:t.count,t.minstep),p=t.format||vv(a,h,f,c,t.formatSpecifier,t.formatType,!!t.values||"symbol"===c),m=t.values||yv(h,f);return u&&(l.rem=u),"symbol"===c?(d&&m.length>d?(e.dataflow.warn("Symbol legend count exceeds limit, filtering items."),u=m.slice(0,d-1),o=!0):u=m,ke(i=t.size)?(t.values||0!==h(u[0])||(u=u.slice(1)),s=u.reduce((function(e,n){return Math.max(e,i(n,t))}),0)):i=Ie(s=i||8),u=u.map((function(e,n){return vn({index:n,label:p(e,n,u),value:e,offset:s,size:i(e,t)})})),o&&u.push(vn({index:u.length,label:`\u2026${m.length-u.length} entries`,value:o=m[u.length],offset:s,size:i(o,t)}))):"gradient"===c?(n=h.domain(),r=ev(h,n[0],se(n)),m.length<3&&!t.values&&n[0]!==se(n)&&(m=[n[0],se(n)]),u=m.map((function(t,e){return vn({index:e,label:p(t,e,m),value:t,perc:r(t)})}))):(i=m.length-1,r=function(t){var e=t.domain(),n=e.length-1,r=+e[0],i=+se(e),s=i-r;if("threshold"===t.type){const t=n?s/n:.1;s=(i+=t)-(r-=t)}return t=>(t-r)/s}(h),u=m.map((function(t,e){return vn({index:e,label:p(t,e,m),value:t,perc:e?r(t):0,perc2:e===i?1:r(m[e+1])})}))),l.source=u,l.add=u,this.value=u,l};var Zb=Be({line:rx,"line-radial":function(t,e,n,r){return rx(e*Math.cos(t),e*Math.sin(t),r*Math.cos(n),r*Math.sin(n))},arc:ix,"arc-radial":function(t,e,n,r){return ix(e*Math.cos(t),e*Math.sin(t),r*Math.cos(n),r*Math.sin(n))},curve:sx,"curve-radial":function(t,e,n,r){return sx(e*Math.cos(t),e*Math.sin(t),r*Math.cos(n),r*Math.sin(n))},"orthogonal-horizontal":function(t,e,n,r){return"M"+t+","+e+"V"+r+"H"+n},"orthogonal-vertical":function(t,e,n,r){return"M"+t+","+e+"H"+n+"V"+r},"orthogonal-radial":function(t,e,n,r){var i=Math.cos(t),s=Math.sin(t),o=Math.cos(n),a=Math.sin(n);return"M"+e*i+","+e*s+"A"+e+","+e+" 0 0,"+((Math.abs(n-t)>Math.PI?n<=t:n>t)?1:0)+" "+e*o+","+e*a+"L"+r*o+","+r*a},"diagonal-horizontal":function(t,e,n,r){var i=(t+n)/2;return"M"+t+","+e+"C"+i+","+e+" "+i+","+r+" "+n+","+r},"diagonal-vertical":function(t,e,n,r){var i=(e+r)/2;return"M"+t+","+e+"C"+t+","+i+" "+n+","+i+" "+n+","+r},"diagonal-radial":function(t,e,n,r){var i=Math.cos(t),s=Math.sin(t),o=Math.cos(n),a=Math.sin(n),l=(e+r)/2;return"M"+e*i+","+e*s+"C"+l*i+","+l*s+" "+l*o+","+l*a+" "+r*o+","+r*a}});function Qb(t){return t.source.x}function Jb(t){return t.source.y}function tx(t){return t.target.x}function ex(t){return t.target.y}function nx(t){ba.call(this,{},t)}function rx(t,e,n,r){return"M"+t+","+e+"L"+n+","+r}function ix(t,e,n,r){var i=n-t,s=r-e,o=Math.sqrt(i*i+s*s)/2;return"M"+t+","+e+"A"+o+","+o+" "+180*Math.atan2(s,i)/Math.PI+" 0 1 "+n+","+r}function sx(t,e,n,r){var i=n-t,s=r-e,o=.2*(i+s),a=.2*(s-i);return"M"+t+","+e+"C"+(t+o)+","+(e+a)+" "+(n+a)+","+(r-o)+" "+n+","+r}function ox(t,e){let n=0;if(void 0===e)for(let r of t)(r=+r)&&(n+=r);else{let r=-1;for(let i of t)(i=+e(i,++r,t))&&(n+=i)}return n}function ax(t){ba.call(this,null,t)}function lx(t){return Jg(t)&&"sequential"!==t}nx.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]},Ue(nx,ba).transform=function(t,e){var n=t.sourceX||Qb,r=t.sourceY||Jb,i=t.targetX||tx,s=t.targetY||ex,o=t.as||"path",a=t.shape||"line",l=Zb.get(a+"-"+(t.orient||"vertical"))||Zb.get(a);return l||$t("LinkPath unsupported type: "+t.shape+(t.orient?"-"+t.orient:"")),e.visit(e.SOURCE,(function(t){t[o]=l(n(t),r(t),i(t),s(t))})),e.reflow(t.modified()).modifies(o)},ax.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]},Ue(ax,ba).transform=function(t,e){var n,r,i,s=t.as||["startAngle","endAngle"],o=s[0],a=s[1],l=t.startAngle||0,u=null!=t.endAngle?t.endAngle:2*Math.PI,c=e.source,h=c.map(t.field||Vt),d=h.length,f=l,p=(u-l)/ox(h),m=Pu(d);for(t.sort&&m.sort((function(t,e){return h[t]-h[e]})),n=0;n<d;++n)i=h[m[n]],(r=c[m[n]])[o]=f,r[a]=f+=i*p;return this.value=h,e.reflow(t.modified()).modifies(s)};var ux=ln(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function cx(t){ba.call(this,null,t),this.modified(!0)}function hx(t,e,n){return ny(t)&&Math.abs(e.reduce((function(t,e){return t+(e<0?-1:e>0?1:0)}),0))!==e.length&&n.warn("Log scale domain includes zero: "+nn(e)),e}function dx(t,e,n){return ke(t)&&(e||n)?Qy(t,fx(e||[0,1],n)):t}function fx(t,e){return e?t.slice().reverse():t}function px(t){ba.call(this,null,t)}Ue(cx,ba).transform=function(t,e){var n=e.dataflow,r=this.value,i=function(t){var e,n=t.type,r="";return"sequential"===n?"sequential-linear":(function(t){const e=t.type;return Jg(e)&&e!==Xp&&e!==Zp&&(t.scheme||t.range&&t.range.length&&t.range.every(Ye))}(t)&&(r=2===(e=t.rawDomain?t.rawDomain.length:t.domain?t.domain.length+ +(null!=t.domainMid):0)?"sequential-":3===e?"diverging-":""),(r+n||"linear").toLowerCase())}(t);for(i in r&&i===r.type||(this.value=r=Xg(i)()),t)if(!ux[i]){if("padding"===i&&lx(r.type))continue;ke(r[i])?r[i](t[i]):n.warn("Unsupported scale property: "+i)}return function(t,e,n){var r=t.type,i=e.round||!1,s=e.range;if(null!=e.rangeStep)s=function(t,e,n){return"band"!==t&&"point"!==t&&$t("Only band and point scales support rangeStep."),[0,e.rangeStep*Yp(n,"point"===t?1:(null!=e.paddingInner?e.paddingInner:e.padding)||0,(null!=e.paddingOuter?e.paddingOuter:e.padding)||0)]}(r,e,n);else if(e.scheme&&(s=function(t,e,n){var r,i=e.schemeExtent;return Jt(e.scheme)?r=Jy(e.scheme,e.interpolate,e.interpolateGamma):(r=ov(e.scheme.toLowerCase()))||$t("Unrecognized scheme name: "+e.scheme),n="threshold"===t?n+1:"bin-ordinal"===t?n-1:"quantile"===t||"quantize"===t?+e.schemeCount||5:n,ry(t)?dx(r,i,e.reverse):ke(r)?tv(dx(r,i),n):"ordinal"===t?r:r.slice(0,n)}(r,e,n),ke(s))){if(t.interpolator)return t.interpolator(s);$t(`Scale type ${r} does not support interpolating color schemes.`)}if(s&&ry(r))return t.interpolator(Jy(fx(s,e.reverse),e.interpolate,e.interpolateGamma));s&&e.interpolate&&t.interpolate?t.interpolate(nv(e.interpolate,e.interpolateGamma)):ke(t.round)?t.round(i):ke(t.rangeRound)&&t.interpolate(i?hg:cg),s&&t.range(fx(s,e.reverse))}(r,t,function(t,e,n){let r=e.bins;if(r&&!Jt(r)){let e=t.domain(),n=e[0],i=se(e),s=null==r.start?n:r.start,o=null==r.stop?i:r.stop,a=r.step;a||$t("Scale bins parameter missing step property."),s<n&&(s=a*Math.ceil(n/a)),o>i&&(o=a*Math.floor(i/a)),r=Pu(s,o+a/2,a)}return r?t.bins=r:t.bins&&delete t.bins,"bin-ordinal"===t.type&&(r?e.domain||e.domainRaw||(t.domain(r),n=r.length):t.bins=t.domain()),n}(r,t,function(t,e,n){var r=function(t,e,n){return e?(t.domain(hx(t.type,e,n)),e.length):-1}(t,e.domainRaw,n);if(r>-1)return r;var i,s,o=e.domain,a=t.type,l=e.zero||void 0===e.zero&&function(t){const e=t.type;return!t.bins&&("linear"===e||"pow"===e||"sqrt"===e)}(t);if(!o)return 0;if(lx(a)&&e.padding&&o[0]!==se(o)&&(o=function(t,e,n,r,i,s){var o=Math.abs(se(n)-n[0]),a=o/(o-2*r),l=t===Kp?be(e,null,a):"sqrt"===t?xe(e,null,a,.5):"pow"===t?xe(e,null,a,i||1):"symlog"===t?_e(e,null,a,s||1):ve(e,null,a);return(e=e.slice())[0]=l[0],e[e.length-1]=l[1],e}(a,o,e.range,e.padding,e.exponent,e.constant)),(l||null!=e.domainMin||null!=e.domainMax||null!=e.domainMid)&&(i=(o=o.slice()).length-1||1,l&&(o[0]>0&&(o[0]=0),o[i]<0&&(o[i]=0)),null!=e.domainMin&&(o[0]=e.domainMin),null!=e.domainMax&&(o[i]=e.domainMax),null!=e.domainMid)){const t=(s=e.domainMid)>o[i]?i+1:s<o[0]?0:i;t!==i&&n.warn("Scale domainMid exceeds domain min or max.",s),o.splice(t,0,s)}return t.domain(hx(a,o,n)),"ordinal"===a&&t.unknown(e.domainImplicit?sm:void 0),e.nice&&t.nice&&t.nice(!0!==e.nice&&cv(t,e.nice)||null),o.length}(r,t,n))),e.fork(e.NO_SOURCE|e.NO_FIELDS)},Ue(px,ba).transform=function(t,e){var n=t.modified("sort")||e.changed(e.ADD)||e.modified(t.sort.fields)||e.modified("datum");return n&&e.source.sort(wn(t.sort)),this.modified(n),e};var mx=["y0","y1"];function gx(t){ba.call(this,null,t)}function yx(t,e,n,r,i){for(var s,o=(e-t.sum)/2,a=t.length,l=0;l<a;++l)(s=t[l])[r]=o,s[i]=o+=Math.abs(n(s))}function vx(t,e,n,r,i){for(var s,o=1/t.sum,a=0,l=t.length,u=0,c=0;u<l;++u)(s=t[u])[r]=a,s[i]=a=o*(c+=Math.abs(n(s)))}function bx(t,e,n,r,i){for(var s,o,a=0,l=0,u=t.length,c=0;c<u;++c)(s=+n(o=t[c]))<0?(o[r]=l,o[i]=l+=s):(o[r]=a,o[i]=a+=s)}function xx(){}gx.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:"zero",values:["zero","center","normalize"]},{name:"as",type:"string",array:!0,length:2,default:mx}]},Ue(gx,ba).transform=function(t,e){var n,r,i,s,o=t.as||mx,a=o[0],l=o[1],u=wn(t.sort),c=t.field||Vt,h="center"===t.offset?yx:"normalize"===t.offset?vx:bx;for(n=function(t,e,n,r){var i,s,o,a,l,u,c,h,d,f=[],p=function(t){return t(l)};if(null==e)f.push(t.slice());else for(i={},s=0,o=t.length;s<o;++s)l=t[s],(c=i[u=e.map(p)])||(i[u]=c=[],f.push(c)),c.push(l);for(u=0,d=0,a=f.length;u<a;++u){for(s=0,h=0,o=(c=f[u]).length;s<o;++s)h+=Math.abs(r(c[s]));c.sum=h,h>d&&(d=h),n&&c.sort(n)}return f.max=d,f}(e.source,t.groupby,u,c),r=0,i=n.length,s=n.max;r<i;++r)h(n[r],s,c,a,l);return e.reflow(t.modified()).modifies(o)};const _x=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];var wx=function(){var t=1,e=1,n=o;function r(t,e){return e.map(e=>i(t,e))}function i(r,i){var o=[],a=[];return function(n,r,i){var o,a,l,u,c,h=new Array,d=new Array;for(o=a=-1,_x[(l=n[0]>=r)<<1].forEach(f);++o<t-1;)_x[l|(l=n[o+1]>=r)<<1].forEach(f);for(_x[l<<0].forEach(f);++a<e-1;){for(o=-1,_x[(l=n[a*t+t]>=r)<<1|(u=n[a*t]>=r)<<2].forEach(f);++o<t-1;)c=u,_x[l|(l=n[a*t+t+o+1]>=r)<<1|(u=n[a*t+o+1]>=r)<<2|c<<3].forEach(f);_x[l|u<<3].forEach(f)}for(o=-1,_x[(u=n[a*t]>=r)<<2].forEach(f);++o<t-1;)c=u,_x[(u=n[a*t+o+1]>=r)<<2|c<<3].forEach(f);function f(t){var e,n,r=[t[0][0]+o,t[0][1]+a],l=[t[1][0]+o,t[1][1]+a],u=s(r),c=s(l);(e=d[u])?(n=h[c])?(delete d[e.end],delete h[n.start],e===n?(e.ring.push(l),i(e.ring)):h[e.start]=d[n.end]={start:e.start,end:n.end,ring:e.ring.concat(n.ring)}):(delete d[e.end],e.ring.push(l),d[e.end=c]=e):(e=h[c])?(n=d[u])?(delete h[e.start],delete d[n.end],e===n?(e.ring.push(l),i(e.ring)):h[n.start]=d[e.end]={start:n.start,end:e.end,ring:n.ring.concat(e.ring)}):(delete h[e.start],e.ring.unshift(r),h[e.start=u]=e):h[u]=d[c]={start:u,end:c,ring:[r,l]}}_x[u<<3].forEach(f)}(r,i,(function(t){n(t,r,i),function(t){for(var e=0,n=t.length,r=t[n-1][1]*t[0][0]-t[n-1][0]*t[0][1];++e<n;)r+=t[e-1][1]*t[e][0]-t[e-1][0]*t[e][1];return r}(t)>0?o.push([t]):a.push(t)})),a.forEach((function(t){for(var e,n=0,r=o.length;n<r;++n)if(-1!==Sx((e=o[n])[0],t))return void e.push(t)})),{type:"MultiPolygon",value:i,coordinates:o}}function s(e){return 2*e[0]+e[1]*(t+1)*4}function o(n,r,i){n.forEach((function(n){var s,o=n[0],a=n[1],l=0|o,u=0|a,c=r[u*t+l];o>0&&o<t&&l===o&&(n[0]=o+(i-(s=r[u*t+l-1]))/(c-s)-.5),a>0&&a<e&&u===a&&(n[1]=a+(i-(s=r[(u-1)*t+l]))/(c-s)-.5)}))}return r.contour=i,r.size=function(n){if(!arguments.length)return[t,e];var i=Math.floor(n[0]),s=Math.floor(n[1]);return i>=0&&s>=0||$t("invalid size"),t=i,e=s,r},r.smooth=function(t){return arguments.length?(n=t?o:xx,r):n===o},r};function Sx(t,e){for(var n,r=-1,i=e.length;++r<i;)if(n=Cx(t,e[r]))return n;return 0}function Cx(t,e){for(var n=e[0],r=e[1],i=-1,s=0,o=t.length,a=o-1;s<o;a=s++){var l=t[s],u=l[0],c=l[1],h=t[a],d=h[0],f=h[1];if(Ex(l,h,e))return 0;c>r!=f>r&&n<(d-u)*(r-c)/(f-c)+u&&(i=-i)}return i}function Ex(t,e,n){var r,i,s,o;return function(t,e,n){return(e[0]-t[0])*(n[1]-t[1])==(n[0]-t[0])*(e[1]-t[1])}(t,e,n)&&(i=t[r=+(t[0]===e[0])],o=e[r],i<=(s=n[r])&&s<=o||o<=s&&s<=i)}var kx=function(t,e,n){return function(r){var i=Me(r),s=n?Math.min(i[0],0):i[0],o=i[1],a=o-s,l=e?Er(s,o,t):a/(t+1);return Pu(l,o,l)}};function Ax(t){ba.call(this,null,t)}function Dx(t,e,n,r,i){const s=t.x1||0,o=t.y1||0,a=e*n<0;function l(t){t.forEach(u)}function u(t){a&&t.reverse(),t.forEach(c)}function c(t){t[0]=(t[0]-s)*e+r,t[1]=(t[1]-o)*n+i}return function(t){return t.coordinates.forEach(l),t}}function Nx(t,e,n){const r=t>=0?t:qa(e,n);return Math.round((Math.sqrt(4*r*r+1)-1)/2)}function Tx(t){return ke(t)?t:Ie(+t)}Ax.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]},Ue(Ax,ba).transform=function(t,e){if(this.value&&!e.changed()&&!t.modified())return e.StopPropagation;var n=e.fork(e.NO_SOURCE|e.NO_FIELDS),r=e.materialize(e.SOURCE).source,i=t.field||jt,s=wx().smooth(!1!==t.smooth),o=t.thresholds||function(t,e,n){const r=kx(n.levels||10,n.nice,!1!==n.zero);return"shared"!==n.resolve?r:r(t.map(t=>za(e(t).values)))}(r,i,t),a=null===t.as?null:t.as||"contour",l=[];return r.forEach(e=>{const n=i(e),r=s.size([n.width,n.height])(n.values,Jt(o)?o:o(n.values));!function(t,e,n,r){let i=r.scale||e.scale,s=r.translate||e.translate;if(ke(i)&&(i=i(n,r)),ke(s)&&(s=s(n,r)),(1===i||null==i)&&!s)return;const o=(He(i)?i:i[0])||1,a=(He(i)?i:i[1])||1;t.forEach(Dx(e,o,a,s&&s[0]||0,s&&s[1]||0))}(r,n,e,t),r.forEach(t=>{l.push(xn(e,vn(null!=a?{[a]:t}:t)))})}),this.value&&(n.rem=this.value),this.value=n.source=n.add=l,n};var Ox=function(){var t=t=>t[0],e=t=>t[1],n=Vt,r=[-1,-1],i=960,s=500,o=2;function a(a,l){const u=Nx(r[0],a,t)>>o,c=Nx(r[1],a,e)>>o,h=u?u+2:0,d=c?c+2:0,f=2*h+(i>>o),p=2*d+(s>>o),m=new Float32Array(f*p),g=new Float32Array(f*p);let y=m;a.forEach(r=>{const i=h+(+t(r)>>o),s=d+(+e(r)>>o);i>=0&&i<f&&s>=0&&s<p&&(m[i+s*f]+=+n(r))}),u>0&&c>0?(Ix(f,p,m,g,u),Rx(f,p,g,m,c),Ix(f,p,m,g,u),Rx(f,p,g,m,c),Ix(f,p,m,g,u),Rx(f,p,g,m,c)):u>0?(Ix(f,p,m,g,u),Ix(f,p,g,m,u),Ix(f,p,m,g,u),y=g):c>0&&(Rx(f,p,m,g,c),Rx(f,p,g,m,c),Rx(f,p,m,g,c),y=g);let v=l?Math.pow(2,-2*o):1/ox(y);for(let t=0,e=f*p;t<e;++t)y[t]*=v;return{values:y,scale:1<<o,width:f,height:p,x1:h,y1:d,x2:h+(i>>o),y2:d+(s>>o)}}return a.x=function(e){return arguments.length?(t=Tx(e),a):t},a.y=function(t){return arguments.length?(e=Tx(t),a):e},a.weight=function(t){return arguments.length?(n=Tx(t),a):n},a.size=function(t){if(!arguments.length)return[i,s];var e=+t[0],n=+t[1];return e>=0&&n>=0||$t("invalid size"),i=e,s=n,a},a.cellSize=function(t){return arguments.length?((t=+t)>=1||$t("invalid cell size"),o=Math.floor(Math.log(t)/Math.LN2),a):1<<o},a.bandwidth=function(t){return arguments.length?(1===(t=Ce(t)).length&&(t=[+t[0],+t[0]]),2!==t.length&&$t("invalid bandwidth"),r=t,a):r},a};function Ix(t,e,n,r,i){const s=1+(i<<1);for(let o=0;o<e;++o)for(let e=0,a=0;e<t+i;++e)e<t&&(a+=n[e+o*t]),e>=i&&(e>=s&&(a-=n[e-s+o*t]),r[e-i+o*t]=a/Math.min(e+1,t-1+s-e,s))}function Rx(t,e,n,r,i){const s=1+(i<<1);for(let o=0;o<t;++o)for(let a=0,l=0;a<e+i;++a)a<e&&(l+=n[o+a*t]),a>=i&&(a>=s&&(l-=n[o+(a-s)*t]),r[o+(a-i)*t]=l/Math.min(a+1,e-1+s-a,s))}function Fx(t){ba.call(this,null,t)}Fx.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};var Mx=Ue(Fx,ba);const $x=["x","y","weight","size","cellSize","bandwidth"];function Px(t,e){return $x.forEach(n=>null!=e[n]?t[n](e[n]):0),t}function zx(t){ba.call(this,null,t)}function Lx(t){ba.call(this,null,t)}Mx.transform=function(t,e){if(this.value&&!e.changed()&&!t.modified())return e.StopPropagation;var n,r=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=function(t,e){var n,r,i,s,o,a,l=[],u=t=>t(s);if(null==e)l.push(t);else for(n={},r=0,i=t.length;r<i;++r)s=t[r],(a=n[o=e.map(u)])||(n[o]=a=[],a.dims=o,l.push(a)),a.push(s);return l}(e.materialize(e.SOURCE).source,t.groupby),s=(t.groupby||[]).map(Ot),o=Px(Ox(),t),a=t.as||"grid";return n=i.map(e=>vn(function(t,e){for(let n=0;n<s.length;++n)t[s[n]]=e[n];return t}({[a]:o(e,t.counts)},e.dims))),this.value&&(r.rem=this.value),this.value=r.source=r.add=n,r},zx.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]},Ue(zx,ba).transform=function(t,e){if(this.value&&!e.changed()&&!t.modified())return e.StopPropagation;var n,r,i=e.fork(e.NO_SOURCE|e.NO_FIELDS),s=wx().smooth(!1!==t.smooth),o=t.values,a=t.thresholds||kx(t.count||10,t.nice,!!o),l=t.size;return o||(o=e.materialize(e.SOURCE).source,r=Dx(n=Px(Ox(),t)(o,!0),n.scale||1,n.scale||1,0,0),l=[n.width,n.height],o=n.values),a=Jt(a)?a:a(o),o=s.size(l)(o,a),r&&o.forEach(r),this.value&&(i.rem=this.value),this.value=i.source=i.add=(o||[]).map(vn),i},Lx.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]},Ue(Lx,ba).transform=function(t,e){var n,r=this._features,i=this._points,s=t.fields,o=s&&s[0],a=s&&s[1],l=t.geojson||!s&&jt,u=e.ADD;n=t.modified()||e.changed(e.REM)||e.modified(It(l))||o&&e.modified(It(o))||a&&e.modified(It(a)),this.value&&!n||(u=e.SOURCE,this._features=r=[],this._points=i=[]),l&&e.visit(u,(function(t){r.push(l(t))})),o&&a&&(e.visit(u,(function(t){var e=o(t),n=a(t);null!=e&&null!=n&&(e=+e)===e&&(n=+n)===n&&i.push([e,n])})),r=r.concat({type:"Feature",geometry:{type:"MultiPoint",coordinates:i}})),this.value={type:"FeatureCollection",features:r}};var Bx=function(t){return t};function jx(t,e){t&&Vx.hasOwnProperty(t.type)&&Vx[t.type](t,e)}var Ux={Feature:function(t,e){jx(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,r=-1,i=n.length;++r<i;)jx(n[r].geometry,e)}},Vx={Sphere:function(t,e){e.sphere()},Point:function(t,e){e.point((t=t.coordinates)[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)e.point((t=n[r])[0],t[1],t[2])},LineString:function(t,e){Wx(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)Wx(n[r],e,0)},Polygon:function(t,e){qx(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)qx(n[r],e)},GeometryCollection:function(t,e){for(var n=t.geometries,r=-1,i=n.length;++r<i;)jx(n[r],e)}};function Wx(t,e,n){var r,i=-1,s=t.length-n;for(e.lineStart();++i<s;)e.point((r=t[i])[0],r[1],r[2]);e.lineEnd()}function qx(t,e){var n=-1,r=t.length;for(e.polygonStart();++n<r;)Wx(t[n],e,1);e.polygonEnd()}var Hx=function(t,e){t&&Ux.hasOwnProperty(t.type)?Ux[t.type](t,e):jx(t,e)},Gx=function(){return new Yx};function Yx(){this.reset()}Yx.prototype={constructor:Yx,reset:function(){this.s=this.t=0},add:function(t){Xx(Kx,t,this.t),Xx(this,Kx.s,this.s),this.s?this.t+=Kx.t:this.s=Kx.t},valueOf:function(){return this.s}};var Kx=new Yx;function Xx(t,e,n){var r=t.s=e+n,i=r-e;t.t=e-(r-i)+(n-i)}var Zx=Math.PI,Qx=Zx/2,Jx=Zx/4,t_=2*Zx,e_=180/Zx,n_=Zx/180,r_=Math.abs,i_=Math.atan,s_=Math.atan2,o_=Math.cos,a_=Math.ceil,l_=Math.exp,u_=(Math,Math.log),c_=Math.pow,h_=Math.sin,d_=Math.sign||function(t){return t>0?1:t<0?-1:0},f_=Math.sqrt,p_=Math.tan;function m_(t){return t>1?0:t<-1?Zx:Math.acos(t)}function g_(t){return t>1?Qx:t<-1?-Qx:Math.asin(t)}function y_(){}var v_,b_,x_,__,w_=Gx(),S_=Gx(),C_={point:y_,lineStart:y_,lineEnd:y_,polygonStart:function(){C_.lineStart=E_,C_.lineEnd=D_},polygonEnd:function(){C_.lineStart=C_.lineEnd=C_.point=y_,w_.add(r_(S_)),S_.reset()},result:function(){var t=w_/2;return w_.reset(),t}};function E_(){C_.point=k_}function k_(t,e){C_.point=A_,v_=x_=t,b_=__=e}function A_(t,e){S_.add(__*t-x_*e),x_=t,__=e}function D_(){A_(v_,b_)}var N_,T_,O_,I_,R_=C_,F_=1/0,M_=F_,$_=-F_,P_=$_,z_={point:function(t,e){t<F_&&(F_=t),t>$_&&($_=t),e<M_&&(M_=e),e>P_&&(P_=e)},lineStart:y_,lineEnd:y_,polygonStart:y_,polygonEnd:y_,result:function(){var t=[[F_,M_],[$_,P_]];return $_=P_=-(M_=F_=1/0),t}},L_=0,B_=0,j_=0,U_=0,V_=0,W_=0,q_=0,H_=0,G_=0,Y_={point:K_,lineStart:X_,lineEnd:J_,polygonStart:function(){Y_.lineStart=tw,Y_.lineEnd=ew},polygonEnd:function(){Y_.point=K_,Y_.lineStart=X_,Y_.lineEnd=J_},result:function(){var t=G_?[q_/G_,H_/G_]:W_?[U_/W_,V_/W_]:j_?[L_/j_,B_/j_]:[NaN,NaN];return L_=B_=j_=U_=V_=W_=q_=H_=G_=0,t}};function K_(t,e){L_+=t,B_+=e,++j_}function X_(){Y_.point=Z_}function Z_(t,e){Y_.point=Q_,K_(O_=t,I_=e)}function Q_(t,e){var n=t-O_,r=e-I_,i=f_(n*n+r*r);U_+=i*(O_+t)/2,V_+=i*(I_+e)/2,W_+=i,K_(O_=t,I_=e)}function J_(){Y_.point=K_}function tw(){Y_.point=nw}function ew(){rw(N_,T_)}function nw(t,e){Y_.point=rw,K_(N_=O_=t,T_=I_=e)}function rw(t,e){var n=t-O_,r=e-I_,i=f_(n*n+r*r);U_+=i*(O_+t)/2,V_+=i*(I_+e)/2,W_+=i,q_+=(i=I_*t-O_*e)*(O_+t),H_+=i*(I_+e),G_+=3*i,K_(O_=t,I_=e)}var iw=Y_;function sw(t){this._context=t}sw.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._context.moveTo(t,e),this._point=1;break;case 1:this._context.lineTo(t,e);break;default:this._context.moveTo(t+this._radius,e),this._context.arc(t,e,this._radius,0,t_)}},result:y_};var ow,aw,lw,uw,cw,hw=Gx(),dw={point:y_,lineStart:function(){dw.point=fw},lineEnd:function(){ow&&pw(aw,lw),dw.point=y_},polygonStart:function(){ow=!0},polygonEnd:function(){ow=null},result:function(){var t=+hw;return hw.reset(),t}};function fw(t,e){dw.point=pw,aw=uw=t,lw=cw=e}function pw(t,e){hw.add(f_((uw-=t)*uw+(cw-=e)*cw)),uw=t,cw=e}var mw=dw;function gw(){this._string=[]}function yw(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}gw.prototype={_radius:4.5,_circle:yw(4.5),pointRadius:function(t){return(t=+t)!==this._radius&&(this._radius=t,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._string.push("M",t,",",e),this._point=1;break;case 1:this._string.push("L",t,",",e);break;default:null==this._circle&&(this._circle=yw(this._radius)),this._string.push("M",t,",",e,this._circle)}},result:function(){if(this._string.length){var t=this._string.join("");return this._string=[],t}return null}};var vw=function(t,e){var n,r,i=4.5;function s(t){return t&&("function"==typeof i&&r.pointRadius(+i.apply(this,arguments)),Hx(t,n(r))),r.result()}return s.area=function(t){return Hx(t,n(R_)),R_.result()},s.measure=function(t){return Hx(t,n(mw)),mw.result()},s.bounds=function(t){return Hx(t,n(z_)),z_.result()},s.centroid=function(t){return Hx(t,n(iw)),iw.result()},s.projection=function(e){return arguments.length?(n=null==e?(t=null,Bx):(t=e).stream,s):t},s.context=function(t){return arguments.length?(r=null==t?(e=null,new gw):new sw(e=t),"function"!=typeof i&&r.pointRadius(i),s):e},s.pointRadius=function(t){return arguments.length?(i="function"==typeof t?t:(r.pointRadius(+t),+t),s):i},s.projection(t).context(e)},bw=function(){var t,e=[];return{point:function(e,n,r){t.push([e,n,r])},lineStart:function(){e.push(t=[])},lineEnd:y_,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}},xw=function(t,e){return r_(t[0]-e[0])<1e-6&&r_(t[1]-e[1])<1e-6};function _w(t,e,n,r){this.x=t,this.z=e,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}var ww=function(t,e,n,r,i){var s,o,a=[],l=[];if(t.forEach((function(t){if(!((e=t.length-1)<=0)){var e,n,r=t[0],o=t[e];if(xw(r,o)){if(!r[2]&&!o[2]){for(i.lineStart(),s=0;s<e;++s)i.point((r=t[s])[0],r[1]);return void i.lineEnd()}o[0]+=2e-6}a.push(n=new _w(r,t,null,!0)),l.push(n.o=new _w(r,null,n,!1)),a.push(n=new _w(o,t,null,!1)),l.push(n.o=new _w(o,null,n,!0))}})),a.length){for(l.sort(e),Sw(a),Sw(l),s=0,o=l.length;s<o;++s)l[s].e=n=!n;for(var u,c,h=a[0];;){for(var d=h,f=!0;d.v;)if((d=d.n)===h)return;u=d.z,i.lineStart();do{if(d.v=d.o.v=!0,d.e){if(f)for(s=0,o=u.length;s<o;++s)i.point((c=u[s])[0],c[1]);else r(d.x,d.n.x,1,i);d=d.n}else{if(f)for(s=(u=d.p.z).length-1;s>=0;--s)i.point((c=u[s])[0],c[1]);else r(d.x,d.p.x,-1,i);d=d.p}u=(d=d.o).z,f=!f}while(!d.v);i.lineEnd()}}};function Sw(t){if(e=t.length){for(var e,n,r=0,i=t[0];++r<e;)i.n=n=t[r],n.p=i,i=n;i.n=n=t[0],n.p=i}}function Cw(t){return[s_(t[1],t[0]),g_(t[2])]}function Ew(t){var e=t[0],n=t[1],r=o_(n);return[r*o_(e),r*h_(e),h_(n)]}function kw(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Aw(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function Dw(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function Nw(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function Tw(t){var e=f_(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}var Ow=Gx();function Iw(t){return r_(t[0])<=Zx?t[0]:d_(t[0])*((r_(t[0])+Zx)%t_-Zx)}var Rw,Fw,Mw=function(t,e){return t<e?-1:t>e?1:t>=e?0:NaN};1===(Rw=Mw).length&&(Fw=Rw,Rw=function(t,e){return Mw(Fw(t),e)});var $w=function(t,e,n){t=+t,e=+e,n=(i=arguments.length)<2?(e=t,t=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((e-t)/n)),s=new Array(i);++r<i;)s[r]=t+r*n;return s};Math.sqrt(50),Math.sqrt(10),Math.sqrt(2);var Pw=function(t){for(var e,n,r,i=t.length,s=-1,o=0;++s<i;)o+=t[s].length;for(n=new Array(o);--i>=0;)for(e=(r=t[i]).length;--e>=0;)n[--o]=r[e];return n},zw=function(t,e,n,r){return function(i){var s,o,a,l=e(i),u=bw(),c=e(u),h=!1,d={point:f,lineStart:m,lineEnd:g,polygonStart:function(){d.point=y,d.lineStart=v,d.lineEnd=b,o=[],s=[]},polygonEnd:function(){d.point=f,d.lineStart=m,d.lineEnd=g,o=Pw(o);var t=function(t,e){var n=Iw(e),r=e[1],i=h_(r),s=[h_(n),-o_(n),0],o=0,a=0;Ow.reset(),1===i?r=Qx+1e-6:-1===i&&(r=-Qx-1e-6);for(var l=0,u=t.length;l<u;++l)if(h=(c=t[l]).length)for(var c,h,d=c[h-1],f=Iw(d),p=d[1]/2+Jx,m=h_(p),g=o_(p),y=0;y<h;++y,f=b,m=_,g=w,d=v){var v=c[y],b=Iw(v),x=v[1]/2+Jx,_=h_(x),w=o_(x),S=b-f,C=S>=0?1:-1,E=C*S,k=E>Zx,A=m*_;if(Ow.add(s_(A*C*h_(E),g*w+A*o_(E))),o+=k?S+C*t_:S,k^f>=n^b>=n){var D=Aw(Ew(d),Ew(v));Tw(D);var N=Aw(s,D);Tw(N);var T=(k^S>=0?-1:1)*g_(N[2]);(r>T||r===T&&(D[0]||D[1]))&&(a+=k^S>=0?1:-1)}}return(o<-1e-6||o<1e-6&&Ow<-1e-6)^1&a}(s,r);o.length?(h||(i.polygonStart(),h=!0),ww(o,Bw,t,n,i)):t&&(h||(i.polygonStart(),h=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),h&&(i.polygonEnd(),h=!1),o=s=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function f(e,n){t(e,n)&&i.point(e,n)}function p(t,e){l.point(t,e)}function m(){d.point=p,l.lineStart()}function g(){d.point=f,l.lineEnd()}function y(t,e){a.push([t,e]),c.point(t,e)}function v(){c.lineStart(),a=[]}function b(){y(a[0][0],a[0][1]),c.lineEnd();var t,e,n,r,l=c.clean(),d=u.result(),f=d.length;if(a.pop(),s.push(a),a=null,f)if(1&l){if((e=(n=d[0]).length-1)>0){for(h||(i.polygonStart(),h=!0),i.lineStart(),t=0;t<e;++t)i.point((r=n[t])[0],r[1]);i.lineEnd()}}else f>1&&2&l&&d.push(d.pop().concat(d.shift())),o.push(d.filter(Lw))}return d}};function Lw(t){return t.length>1}function Bw(t,e){return((t=t.x)[0]<0?t[1]-Qx-1e-6:Qx-t[1])-((e=e.x)[0]<0?e[1]-Qx-1e-6:Qx-e[1])}var jw=zw((function(){return!0}),(function(t){var e,n=NaN,r=NaN,i=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(s,o){var a=s>0?Zx:-Zx,l=r_(s-n);r_(l-Zx)<1e-6?(t.point(n,r=(r+o)/2>0?Qx:-Qx),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(a,r),t.point(s,r),e=0):i!==a&&l>=Zx&&(r_(n-i)<1e-6&&(n-=1e-6*i),r_(s-a)<1e-6&&(s-=1e-6*a),r=function(t,e,n,r){var i,s,o=h_(t-n);return r_(o)>1e-6?i_((h_(e)*(s=o_(r))*h_(n)-h_(r)*(i=o_(e))*h_(t))/(i*s*o)):(e+r)/2}(n,r,s,o),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(a,r),e=0),t.point(n=s,r=o),i=a},lineEnd:function(){t.lineEnd(),n=r=NaN},clean:function(){return 2-e}}}),(function(t,e,n,r){var i;if(null==t)r.point(-Zx,i=n*Qx),r.point(0,i),r.point(Zx,i),r.point(Zx,0),r.point(Zx,-i),r.point(0,-i),r.point(-Zx,-i),r.point(-Zx,0),r.point(-Zx,i);else if(r_(t[0]-e[0])>1e-6){var s=t[0]<e[0]?Zx:-Zx;r.point(-s,i=n*s/2),r.point(0,i),r.point(s,i)}else r.point(e[0],e[1])}),[-Zx,-Qx]),Uw=function(t,e){function n(n,r){return n=t(n,r),e(n[0],n[1])}return t.invert&&e.invert&&(n.invert=function(n,r){return(n=e.invert(n,r))&&t.invert(n[0],n[1])}),n};function Vw(t,e){return[r_(t)>Zx?t+Math.round(-t/t_)*t_:t,e]}function Ww(t,e,n){return(t%=t_)?e||n?Uw(Hw(t),Gw(e,n)):Hw(t):e||n?Gw(e,n):Vw}function qw(t){return function(e,n){return[(e+=t)>Zx?e-t_:e<-Zx?e+t_:e,n]}}function Hw(t){var e=qw(t);return e.invert=qw(-t),e}function Gw(t,e){var n=o_(t),r=h_(t),i=o_(e),s=h_(e);function o(t,e){var o=o_(e),a=o_(t)*o,l=h_(t)*o,u=h_(e),c=u*n+a*r;return[s_(l*i-c*s,a*n-u*r),g_(c*i+l*s)]}return o.invert=function(t,e){var o=o_(e),a=o_(t)*o,l=h_(t)*o,u=h_(e),c=u*i-l*s;return[s_(l*i+u*s,a*n+c*r),g_(c*n-a*r)]},o}function Yw(t,e){(e=Ew(e))[0]-=t,Tw(e);var n=m_(-e[1]);return((-e[2]<0?-n:n)+t_-1e-6)%t_}Vw.invert=Vw;var Kw=function(t){var e=o_(t),n=6*n_,r=e>0,i=r_(e)>1e-6;function s(t,n){return o_(t)*o_(n)>e}function o(t,n,r){var i=[1,0,0],s=Aw(Ew(t),Ew(n)),o=kw(s,s),a=s[0],l=o-a*a;if(!l)return!r&&t;var u=e*o/l,c=-e*a/l,h=Aw(i,s),d=Nw(i,u);Dw(d,Nw(s,c));var f=h,p=kw(d,f),m=kw(f,f),g=p*p-m*(kw(d,d)-1);if(!(g<0)){var y=f_(g),v=Nw(f,(-p-y)/m);if(Dw(v,d),v=Cw(v),!r)return v;var b,x=t[0],_=n[0],w=t[1],S=n[1];_<x&&(b=x,x=_,_=b);var C=_-x,E=r_(C-Zx)<1e-6;if(!E&&S<w&&(b=w,w=S,S=b),E||C<1e-6?E?w+S>0^v[1]<(r_(v[0]-x)<1e-6?w:S):w<=v[1]&&v[1]<=S:C>Zx^(x<=v[0]&&v[0]<=_)){var k=Nw(f,(-p+y)/m);return Dw(k,d),[v,Cw(k)]}}}function a(e,n){var i=r?t:Zx-t,s=0;return e<-i?s|=1:e>i&&(s|=2),n<-i?s|=4:n>i&&(s|=8),s}return zw(s,(function(t){var e,n,l,u,c;return{lineStart:function(){u=l=!1,c=1},point:function(h,d){var f,p=[h,d],m=s(h,d),g=r?m?0:a(h,d):m?a(h+(h<0?Zx:-Zx),d):0;if(!e&&(u=l=m)&&t.lineStart(),m!==l&&(!(f=o(e,p))||xw(e,f)||xw(p,f))&&(p[2]=1),m!==l)c=0,m?(t.lineStart(),f=o(p,e),t.point(f[0],f[1])):(f=o(e,p),t.point(f[0],f[1],2),t.lineEnd()),e=f;else if(i&&e&&r^m){var y;g&n||!(y=o(p,e,!0))||(c=0,r?(t.lineStart(),t.point(y[0][0],y[0][1]),t.point(y[1][0],y[1][1]),t.lineEnd()):(t.point(y[1][0],y[1][1]),t.lineEnd(),t.lineStart(),t.point(y[0][0],y[0][1],3)))}!m||e&&xw(e,p)||t.point(p[0],p[1]),e=p,l=m,n=g},lineEnd:function(){l&&t.lineEnd(),e=null},clean:function(){return c|(u&&l)<<1}}}),(function(e,r,i,s){!function(t,e,n,r,i,s){if(n){var o=o_(e),a=h_(e),l=r*n;null==i?(i=e+r*t_,s=e-l/2):(i=Yw(o,i),s=Yw(o,s),(r>0?i<s:i>s)&&(i+=r*t_));for(var u,c=i;r>0?c>s:c<s;c-=l)u=Cw([o,-a*o_(c),-a*h_(c)]),t.point(u[0],u[1])}}(s,t,n,i,e,r)}),r?[0,-t]:[-Zx,t-Zx])};function Xw(t,e,n,r){function i(i,s){return t<=i&&i<=n&&e<=s&&s<=r}function s(i,s,a,u){var c=0,h=0;if(null==i||(c=o(i,a))!==(h=o(s,a))||l(i,s)<0^a>0)do{u.point(0===c||3===c?t:n,c>1?r:e)}while((c=(c+a+4)%4)!==h);else u.point(s[0],s[1])}function o(r,i){return r_(r[0]-t)<1e-6?i>0?0:3:r_(r[0]-n)<1e-6?i>0?2:1:r_(r[1]-e)<1e-6?i>0?1:0:i>0?3:2}function a(t,e){return l(t.x,e.x)}function l(t,e){var n=o(t,1),r=o(e,1);return n!==r?n-r:0===n?e[1]-t[1]:1===n?t[0]-e[0]:2===n?t[1]-e[1]:e[0]-t[0]}return function(o){var l,u,c,h,d,f,p,m,g,y,v,b=o,x=bw(),_={point:w,lineStart:function(){_.point=S,u&&u.push(c=[]),y=!0,g=!1,p=m=NaN},lineEnd:function(){l&&(S(h,d),f&&g&&x.rejoin(),l.push(x.result())),_.point=w,g&&b.lineEnd()},polygonStart:function(){b=x,l=[],u=[],v=!0},polygonEnd:function(){var e=function(){for(var e=0,n=0,i=u.length;n<i;++n)for(var s,o,a=u[n],l=1,c=a.length,h=a[0],d=h[0],f=h[1];l<c;++l)s=d,o=f,d=(h=a[l])[0],f=h[1],o<=r?f>r&&(d-s)*(r-o)>(f-o)*(t-s)&&++e:f<=r&&(d-s)*(r-o)<(f-o)*(t-s)&&--e;return e}(),n=v&&e,i=(l=Pw(l)).length;(n||i)&&(o.polygonStart(),n&&(o.lineStart(),s(null,null,1,o),o.lineEnd()),i&&ww(l,a,e,s,o),o.polygonEnd()),b=o,l=u=c=null}};function w(t,e){i(t,e)&&b.point(t,e)}function S(s,o){var a=i(s,o);if(u&&c.push([s,o]),y)h=s,d=o,f=a,y=!1,a&&(b.lineStart(),b.point(s,o));else if(a&&g)b.point(s,o);else{var l=[p=Math.max(-1e9,Math.min(1e9,p)),m=Math.max(-1e9,Math.min(1e9,m))],x=[s=Math.max(-1e9,Math.min(1e9,s)),o=Math.max(-1e9,Math.min(1e9,o))];!function(t,e,n,r,i,s){var o,a=t[0],l=t[1],u=0,c=1,h=e[0]-a,d=e[1]-l;if(o=n-a,h||!(o>0)){if(o/=h,h<0){if(o<u)return;o<c&&(c=o)}else if(h>0){if(o>c)return;o>u&&(u=o)}if(o=i-a,h||!(o<0)){if(o/=h,h<0){if(o>c)return;o>u&&(u=o)}else if(h>0){if(o<u)return;o<c&&(c=o)}if(o=r-l,d||!(o>0)){if(o/=d,d<0){if(o<u)return;o<c&&(c=o)}else if(d>0){if(o>c)return;o>u&&(u=o)}if(o=s-l,d||!(o<0)){if(o/=d,d<0){if(o>c)return;o>u&&(u=o)}else if(d>0){if(o<u)return;o<c&&(c=o)}return u>0&&(t[0]=a+u*h,t[1]=l+u*d),c<1&&(e[0]=a+c*h,e[1]=l+c*d),!0}}}}}(l,x,t,e,n,r)?a&&(b.lineStart(),b.point(s,o),v=!1):(g||(b.lineStart(),b.point(l[0],l[1])),b.point(x[0],x[1]),a||b.lineEnd(),v=!1)}p=s,m=o,g=a}return _}}function Zw(t){return function(e){var n=new Qw;for(var r in t)n[r]=t[r];return n.stream=e,n}}function Qw(){}function Jw(t,e,n){var r=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),null!=r&&t.clipExtent(null),Hx(n,t.stream(z_)),e(z_.result()),null!=r&&t.clipExtent(r),t}function tS(t,e,n){return Jw(t,(function(n){var r=e[1][0]-e[0][0],i=e[1][1]-e[0][1],s=Math.min(r/(n[1][0]-n[0][0]),i/(n[1][1]-n[0][1])),o=+e[0][0]+(r-s*(n[1][0]+n[0][0]))/2,a=+e[0][1]+(i-s*(n[1][1]+n[0][1]))/2;t.scale(150*s).translate([o,a])}),n)}function eS(t,e,n){return tS(t,[[0,0],e],n)}function nS(t,e,n){return Jw(t,(function(n){var r=+e,i=r/(n[1][0]-n[0][0]),s=(r-i*(n[1][0]+n[0][0]))/2,o=-i*n[0][1];t.scale(150*i).translate([s,o])}),n)}function rS(t,e,n){return Jw(t,(function(n){var r=+e,i=r/(n[1][1]-n[0][1]),s=-i*n[0][0],o=(r-i*(n[1][1]+n[0][1]))/2;t.scale(150*i).translate([s,o])}),n)}Qw.prototype={constructor:Qw,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var iS=o_(30*n_),sS=function(t,e){return+e?function(t,e){function n(r,i,s,o,a,l,u,c,h,d,f,p,m,g){var y=u-r,v=c-i,b=y*y+v*v;if(b>4*e&&m--){var x=o+d,_=a+f,w=l+p,S=f_(x*x+_*_+w*w),C=g_(w/=S),E=r_(r_(w)-1)<1e-6||r_(s-h)<1e-6?(s+h)/2:s_(_,x),k=t(E,C),A=k[0],D=k[1],N=A-r,T=D-i,O=v*N-y*T;(O*O/b>e||r_((y*N+v*T)/b-.5)>.3||o*d+a*f+l*p<iS)&&(n(r,i,s,o,a,l,A,D,E,x/=S,_/=S,w,m,g),g.point(A,D),n(A,D,E,x,_,w,u,c,h,d,f,p,m,g))}}return function(e){var r,i,s,o,a,l,u,c,h,d,f,p,m={point:g,lineStart:y,lineEnd:b,polygonStart:function(){e.polygonStart(),m.lineStart=x},polygonEnd:function(){e.polygonEnd(),m.lineStart=y}};function g(n,r){n=t(n,r),e.point(n[0],n[1])}function y(){c=NaN,m.point=v,e.lineStart()}function v(r,i){var s=Ew([r,i]),o=t(r,i);n(c,h,u,d,f,p,c=o[0],h=o[1],u=r,d=s[0],f=s[1],p=s[2],16,e),e.point(c,h)}function b(){m.point=g,e.lineEnd()}function x(){y(),m.point=_,m.lineEnd=w}function _(t,e){v(r=t,e),i=c,s=h,o=d,a=f,l=p,m.point=v}function w(){n(c,h,u,d,f,p,i,s,r,o,a,l,16,e),m.lineEnd=b,b()}return m}}(t,e):function(t){return Zw({point:function(e,n){e=t(e,n),this.stream.point(e[0],e[1])}})}(t)},oS=Zw({point:function(t,e){this.stream.point(t*n_,e*n_)}});function aS(t,e,n,r,i){function s(s,o){return[e+t*(s*=r),n-t*(o*=i)]}return s.invert=function(s,o){return[(s-e)/t*r,(n-o)/t*i]},s}function lS(t,e,n,r,i,s){var o=o_(s),a=h_(s),l=o*t,u=a*t,c=o/t,h=a/t,d=(a*n-o*e)/t,f=(a*e+o*n)/t;function p(t,s){return[l*(t*=r)-u*(s*=i)+e,n-u*t-l*s]}return p.invert=function(t,e){return[r*(c*t-h*e+d),i*(f-h*t-c*e)]},p}function uS(t){return cS((function(){return t}))()}function cS(t){var e,n,r,i,s,o,a,l,u,c,h=150,d=480,f=250,p=0,m=0,g=0,y=0,v=0,b=0,x=1,_=1,w=null,S=jw,C=null,E=Bx,k=.5;function A(t){return l(t[0]*n_,t[1]*n_)}function D(t){return(t=l.invert(t[0],t[1]))&&[t[0]*e_,t[1]*e_]}function N(){var t=lS(h,0,0,x,_,b).apply(null,e(p,m)),r=(b?lS:aS)(h,d-t[0],f-t[1],x,_,b);return n=Ww(g,y,v),a=Uw(e,r),l=Uw(n,a),o=sS(a,k),T()}function T(){return u=c=null,A}return A.stream=function(t){return u&&c===t?u:u=oS(function(t){return Zw({point:function(e,n){var r=t(e,n);return this.stream.point(r[0],r[1])}})}(n)(S(o(E(c=t)))))},A.preclip=function(t){return arguments.length?(S=t,w=void 0,T()):S},A.postclip=function(t){return arguments.length?(E=t,C=r=i=s=null,T()):E},A.clipAngle=function(t){return arguments.length?(S=+t?Kw(w=t*n_):(w=null,jw),T()):w*e_},A.clipExtent=function(t){return arguments.length?(E=null==t?(C=r=i=s=null,Bx):Xw(C=+t[0][0],r=+t[0][1],i=+t[1][0],s=+t[1][1]),T()):null==C?null:[[C,r],[i,s]]},A.scale=function(t){return arguments.length?(h=+t,N()):h},A.translate=function(t){return arguments.length?(d=+t[0],f=+t[1],N()):[d,f]},A.center=function(t){return arguments.length?(p=t[0]%360*n_,m=t[1]%360*n_,N()):[p*e_,m*e_]},A.rotate=function(t){return arguments.length?(g=t[0]%360*n_,y=t[1]%360*n_,v=t.length>2?t[2]%360*n_:0,N()):[g*e_,y*e_,v*e_]},A.angle=function(t){return arguments.length?(b=t%360*n_,N()):b*e_},A.reflectX=function(t){return arguments.length?(x=t?-1:1,N()):x<0},A.reflectY=function(t){return arguments.length?(_=t?-1:1,N()):_<0},A.precision=function(t){return arguments.length?(o=sS(a,k=t*t),T()):f_(k)},A.fitExtent=function(t,e){return tS(A,t,e)},A.fitSize=function(t,e){return eS(A,t,e)},A.fitWidth=function(t,e){return nS(A,t,e)},A.fitHeight=function(t,e){return rS(A,t,e)},function(){return e=t.apply(this,arguments),A.invert=e.invert&&D,N()}}function hS(t){var e=0,n=Zx/3,r=cS(t),i=r(e,n);return i.parallels=function(t){return arguments.length?r(e=t[0]*n_,n=t[1]*n_):[e*e_,n*e_]},i}function dS(t,e){var n=h_(t),r=(n+h_(e))/2;if(r_(r)<1e-6)return function(t){var e=o_(t);function n(t,n){return[t*e,h_(n)/e]}return n.invert=function(t,n){return[t/e,g_(n*e)]},n}(t);var i=1+n*(2*r-n),s=f_(i)/r;function o(t,e){var n=f_(i-2*r*h_(e))/r;return[n*h_(t*=r),s-n*o_(t)]}return o.invert=function(t,e){var n=s-e,o=s_(t,r_(n))*d_(n);return n*r<0&&(o-=Zx*d_(t)*d_(n)),[o/r,g_((i-(t*t+n*n)*r*r)/(2*r))]},o}var fS=function(){return hS(dS).scale(155.424).center([0,33.6442])},pS=function(){return fS().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])};function mS(t){return function(e,n){var r=o_(e),i=o_(n),s=t(r*i);return[s*i*h_(e),s*h_(n)]}}function gS(t){return function(e,n){var r=f_(e*e+n*n),i=t(r),s=h_(i),o=o_(i);return[s_(e*s,r*o),g_(r&&n*s/r)]}}var yS=mS((function(t){return f_(2/(1+t))}));yS.invert=gS((function(t){return 2*g_(t/2)}));var vS=mS((function(t){return(t=m_(t))&&t/h_(t)}));function bS(t,e){return[t,u_(p_((Qx+e)/2))]}function xS(t){var e,n,r,i=uS(t),s=i.center,o=i.scale,a=i.translate,l=i.clipExtent,u=null;function c(){var s=Zx*o(),a=i(function(t){function e(e){return(e=t(e[0]*n_,e[1]*n_))[0]*=e_,e[1]*=e_,e}return t=Ww(t[0]*n_,t[1]*n_,t.length>2?t[2]*n_:0),e.invert=function(e){return(e=t.invert(e[0]*n_,e[1]*n_))[0]*=e_,e[1]*=e_,e},e}(i.rotate()).invert([0,0]));return l(null==u?[[a[0]-s,a[1]-s],[a[0]+s,a[1]+s]]:t===bS?[[Math.max(a[0]-s,u),e],[Math.min(a[0]+s,n),r]]:[[u,Math.max(a[1]-s,e)],[n,Math.min(a[1]+s,r)]])}return i.scale=function(t){return arguments.length?(o(t),c()):o()},i.translate=function(t){return arguments.length?(a(t),c()):a()},i.center=function(t){return arguments.length?(s(t),c()):s()},i.clipExtent=function(t){return arguments.length?(null==t?u=e=n=r=null:(u=+t[0][0],e=+t[0][1],n=+t[1][0],r=+t[1][1]),c()):null==u?null:[[u,e],[n,r]]},c()}function _S(t){return p_((Qx+t)/2)}function wS(t,e){var n=o_(t),r=t===e?h_(t):u_(n/o_(e))/u_(_S(e)/_S(t)),i=n*c_(_S(t),r)/r;if(!r)return bS;function s(t,e){i>0?e<1e-6-Qx&&(e=1e-6-Qx):e>Qx-1e-6&&(e=Qx-1e-6);var n=i/c_(_S(e),r);return[n*h_(r*t),i-n*o_(r*t)]}return s.invert=function(t,e){var n=i-e,s=d_(r)*f_(t*t+n*n),o=s_(t,r_(n))*d_(n);return n*r<0&&(o-=Zx*d_(t)*d_(n)),[o/r,2*i_(c_(i/s,1/r))-Qx]},s}function SS(t,e){return[t,e]}function CS(t,e){var n=o_(t),r=t===e?h_(t):(n-o_(e))/(e-t),i=n/r+t;if(r_(r)<1e-6)return SS;function s(t,e){var n=i-e,s=r*t;return[n*h_(s),i-n*o_(s)]}return s.invert=function(t,e){var n=i-e,s=s_(t,r_(n))*d_(n);return n*r<0&&(s-=Zx*d_(t)*d_(n)),[s/r,i-d_(r)*f_(t*t+n*n)]},s}vS.invert=gS((function(t){return t})),bS.invert=function(t,e){return[t,2*i_(l_(e))-Qx]},SS.invert=SS;var ES=1.340264,kS=-.081106,AS=893e-6,DS=.003796,NS=f_(3)/2;function TS(t,e){var n=g_(NS*h_(e)),r=n*n,i=r*r*r;return[t*o_(n)/(NS*(ES+3*kS*r+i*(7*AS+9*DS*r))),n*(ES+kS*r+i*(AS+DS*r))]}function OS(t,e){var n=o_(e),r=o_(t)*n;return[n*h_(t)/r,h_(e)/r]}function IS(t,e){var n=e*e,r=n*n;return[t*(.8707-.131979*n+r*(r*(.003971*n-.001529*r)-.013791)),e*(1.007226+n*(.015085+r*(.028874*n-.044475-.005916*r)))]}function RS(t,e){return[o_(e)*h_(t),h_(e)]}function FS(t,e){var n=o_(e),r=1+o_(t)*n;return[n*h_(t)/r,h_(e)/r]}function MS(t,e){return[u_(p_((Qx+e)/2)),-t]}TS.invert=function(t,e){for(var n,r=e,i=r*r,s=i*i*i,o=0;o<12&&(s=(i=(r-=n=(r*(ES+kS*i+s*(AS+DS*i))-e)/(ES+3*kS*i+s*(7*AS+9*DS*i)))*r)*i*i,!(r_(n)<1e-12));++o);return[NS*t*(ES+3*kS*i+s*(7*AS+9*DS*i))/o_(r),g_(h_(r)/NS)]},OS.invert=gS(i_),IS.invert=function(t,e){var n,r=e,i=25;do{var s=r*r,o=s*s;r-=n=(r*(1.007226+s*(.015085+o*(.028874*s-.044475-.005916*o)))-e)/(1.007226+s*(.045255+o*(.259866*s-.311325-.005916*11*o)))}while(r_(n)>1e-6&&--i>0);return[t/(.8707+(s=r*r)*(s*(s*s*s*(.003971-.001529*s)-.013791)-.131979)),r]},RS.invert=gS(g_),FS.invert=gS((function(t){return 2*i_(t)})),MS.invert=function(t,e){return[-e,2*i_(l_(t))-Qx]};var $S=Math.abs,PS=(Math,Math,Math,Math.cos),zS=(Math,Math,Math,Math,Math,Math,Math,Math,Math.sin),LS=(Math,Math.PI),BS=LS/2,jS=(Math,VS(2));function US(t){return t>1?BS:t<-1?-BS:Math.asin(t)}function VS(t){return t>0?Math.sqrt(t):0}function WS(t,e){var n,r=t*zS(e),i=30;do{e-=n=(e+zS(e)-r)/(1+PS(e))}while($S(n)>1e-6&&--i>0);return e/2}VS(LS);var qS=function(t,e,n){function r(r,i){return[t*r*PS(i=WS(n,i)),e*zS(i)]}return r.invert=function(r,i){return i=US(i/e),[r/(t*PS(i)),US((2*i+zS(2*i))/n)]},r}(jS/BS,jS,LS),HS=vw(),GS=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function YS(t,e){return function n(){var r=e();return r.type=t,r.path=vw().projection(r),r.copy=r.copy||function(){var t=n();return GS.forEach((function(e){r[e]&&t[e](r[e]())})),t.path.pointRadius(r.path.pointRadius()),t},r}}function KS(t,e){if(!t||"string"!=typeof t)throw new Error("Projection type must be a name string.");return t=t.toLowerCase(),arguments.length>1?(ZS[t]=YS(t,e),this):ZS[t]||null}function XS(t){return t&&t.path||HS}var ZS={albers:pS,albersusa:function(){var t,e,n,r,i,s,o=pS(),a=fS().rotate([154,0]).center([-2,58.5]).parallels([55,65]),l=fS().rotate([157,0]).center([-3,19.9]).parallels([8,18]),u={point:function(t,e){s=[t,e]}};function c(t){var e=t[0],o=t[1];return s=null,n.point(e,o),s||(r.point(e,o),s)||(i.point(e,o),s)}function h(){return t=e=null,c}return c.invert=function(t){var e=o.scale(),n=o.translate(),r=(t[0]-n[0])/e,i=(t[1]-n[1])/e;return(i>=.12&&i<.234&&r>=-.425&&r<-.214?a:i>=.166&&i<.234&&r>=-.214&&r<-.115?l:o).invert(t)},c.stream=function(n){return t&&e===n?t:(r=[o.stream(e=n),a.stream(n),l.stream(n)],i=r.length,t={point:function(t,e){for(var n=-1;++n<i;)r[n].point(t,e)},sphere:function(){for(var t=-1;++t<i;)r[t].sphere()},lineStart:function(){for(var t=-1;++t<i;)r[t].lineStart()},lineEnd:function(){for(var t=-1;++t<i;)r[t].lineEnd()},polygonStart:function(){for(var t=-1;++t<i;)r[t].polygonStart()},polygonEnd:function(){for(var t=-1;++t<i;)r[t].polygonEnd()}});var r,i},c.precision=function(t){return arguments.length?(o.precision(t),a.precision(t),l.precision(t),h()):o.precision()},c.scale=function(t){return arguments.length?(o.scale(t),a.scale(.35*t),l.scale(t),c.translate(o.translate())):o.scale()},c.translate=function(t){if(!arguments.length)return o.translate();var e=o.scale(),s=+t[0],c=+t[1];return n=o.translate(t).clipExtent([[s-.455*e,c-.238*e],[s+.455*e,c+.238*e]]).stream(u),r=a.translate([s-.307*e,c+.201*e]).clipExtent([[s-.425*e+1e-6,c+.12*e+1e-6],[s-.214*e-1e-6,c+.234*e-1e-6]]).stream(u),i=l.translate([s-.205*e,c+.212*e]).clipExtent([[s-.214*e+1e-6,c+.166*e+1e-6],[s-.115*e-1e-6,c+.234*e-1e-6]]).stream(u),h()},c.fitExtent=function(t,e){return tS(c,t,e)},c.fitSize=function(t,e){return eS(c,t,e)},c.fitWidth=function(t,e){return nS(c,t,e)},c.fitHeight=function(t,e){return rS(c,t,e)},c.scale(1070)},azimuthalequalarea:function(){return uS(yS).scale(124.75).clipAngle(179.999)},azimuthalequidistant:function(){return uS(vS).scale(79.4188).clipAngle(179.999)},conicconformal:function(){return hS(wS).scale(109.5).parallels([30,30])},conicequalarea:fS,conicequidistant:function(){return hS(CS).scale(131.154).center([0,13.9389])},equalEarth:function(){return uS(TS).scale(177.158)},equirectangular:function(){return uS(SS).scale(152.63)},gnomonic:function(){return uS(OS).scale(144.049).clipAngle(60)},identity:function(){var t,e,n,r,i,s,o,a=1,l=0,u=0,c=1,h=1,d=0,f=null,p=1,m=1,g=Zw({point:function(t,e){var n=b([t,e]);this.stream.point(n[0],n[1])}}),y=Bx;function v(){return p=a*c,m=a*h,s=o=null,b}function b(n){var r=n[0]*p,i=n[1]*m;if(d){var s=i*t-r*e;r=r*t+i*e,i=s}return[r+l,i+u]}return b.invert=function(n){var r=n[0]-l,i=n[1]-u;if(d){var s=i*t+r*e;r=r*t-i*e,i=s}return[r/p,i/m]},b.stream=function(t){return s&&o===t?s:s=g(y(o=t))},b.postclip=function(t){return arguments.length?(y=t,f=n=r=i=null,v()):y},b.clipExtent=function(t){return arguments.length?(y=null==t?(f=n=r=i=null,Bx):Xw(f=+t[0][0],n=+t[0][1],r=+t[1][0],i=+t[1][1]),v()):null==f?null:[[f,n],[r,i]]},b.scale=function(t){return arguments.length?(a=+t,v()):a},b.translate=function(t){return arguments.length?(l=+t[0],u=+t[1],v()):[l,u]},b.angle=function(n){return arguments.length?(e=h_(d=n%360*n_),t=o_(d),v()):d*e_},b.reflectX=function(t){return arguments.length?(c=t?-1:1,v()):c<0},b.reflectY=function(t){return arguments.length?(h=t?-1:1,v()):h<0},b.fitExtent=function(t,e){return tS(b,t,e)},b.fitSize=function(t,e){return eS(b,t,e)},b.fitWidth=function(t,e){return nS(b,t,e)},b.fitHeight=function(t,e){return rS(b,t,e)},b},mercator:function(){return xS(bS).scale(961/t_)},mollweide:function(){return uS(qS).scale(169.529)},naturalEarth1:function(){return uS(IS).scale(175.295)},orthographic:function(){return uS(RS).scale(249.5).clipAngle(90.000001)},stereographic:function(){return uS(FS).scale(250).clipAngle(142)},transversemercator:function(){var t=xS(MS),e=t.center,n=t.rotate;return t.center=function(t){return arguments.length?e([-t[1],t[0]]):[(t=e())[1],-t[0]]},t.rotate=function(t){return arguments.length?n([t[0],t[1],t.length>2?t[2]+90:90]):[(t=n())[0],t[1],t[2]-90]},n([0,0,90]).scale(159.155)}};for(var QS in ZS)KS(QS,ZS[QS]);function JS(t){ba.call(this,null,t)}function tC(t){ba.call(this,null,t)}function eC(t){ba.call(this,null,t)}function nC(t,e,n){var r=$w(t,e-1e-6,n).concat(e);return function(t){return r.map((function(e){return[t,e]}))}}function rC(t,e,n){var r=$w(t,e-1e-6,n).concat(e);return function(t){return r.map((function(e){return[e,t]}))}}function iC(t){ba.call(this,[],t),this.generator=function(){var t,e,n,r,i,s,o,a,l,u,c,h,d=10,f=d,p=90,m=360,g=2.5;function y(){return{type:"MultiLineString",coordinates:v()}}function v(){return $w(a_(r/p)*p,n,p).map(c).concat($w(a_(a/m)*m,o,m).map(h)).concat($w(a_(e/d)*d,t,d).filter((function(t){return r_(t%p)>1e-6})).map(l)).concat($w(a_(s/f)*f,i,f).filter((function(t){return r_(t%m)>1e-6})).map(u))}return y.lines=function(){return v().map((function(t){return{type:"LineString",coordinates:t}}))},y.outline=function(){return{type:"Polygon",coordinates:[c(r).concat(h(o).slice(1),c(n).reverse().slice(1),h(a).reverse().slice(1))]}},y.extent=function(t){return arguments.length?y.extentMajor(t).extentMinor(t):y.extentMinor()},y.extentMajor=function(t){return arguments.length?(a=+t[0][1],o=+t[1][1],(r=+t[0][0])>(n=+t[1][0])&&(t=r,r=n,n=t),a>o&&(t=a,a=o,o=t),y.precision(g)):[[r,a],[n,o]]},y.extentMinor=function(n){return arguments.length?(s=+n[0][1],i=+n[1][1],(e=+n[0][0])>(t=+n[1][0])&&(n=e,e=t,t=n),s>i&&(n=s,s=i,i=n),y.precision(g)):[[e,s],[t,i]]},y.step=function(t){return arguments.length?y.stepMajor(t).stepMinor(t):y.stepMinor()},y.stepMajor=function(t){return arguments.length?(p=+t[0],m=+t[1],y):[p,m]},y.stepMinor=function(t){return arguments.length?(d=+t[0],f=+t[1],y):[d,f]},y.precision=function(d){return arguments.length?(g=+d,l=nC(s,i,90),u=rC(e,t,g),c=nC(a,o,90),h=rC(r,n,g),y):g},y.extentMajor([[-180,-89.999999],[180,89.999999]]).extentMinor([[-180,-80.000001],[180,80.000001]])}()}function sC(t){ba.call(this,null,t)}function oC(t){if(!ke(t))return!1;const e=ln(It(t));return e.$x||e.$y||e.$value||e.$max}function aC(t){ba.call(this,null,t),this.modified(!0)}function lC(t,e,n){ke(t[e])&&t[e](n)}function uC(t,e,n,r){if(isNaN(e)||isNaN(n))return t;var i,s,o,a,l,u,c,h,d,f=t._root,p={data:r},m=t._x0,g=t._y0,y=t._x1,v=t._y1;if(!f)return t._root=p,t;for(;f.length;)if((u=e>=(s=(m+y)/2))?m=s:y=s,(c=n>=(o=(g+v)/2))?g=o:v=o,i=f,!(f=f[h=c<<1|u]))return i[h]=p,t;if(a=+t._x.call(null,f.data),l=+t._y.call(null,f.data),e===a&&n===l)return p.next=f,i?i[h]=p:t._root=p,t;do{i=i?i[h]=new Array(4):t._root=new Array(4),(u=e>=(s=(m+y)/2))?m=s:y=s,(c=n>=(o=(g+v)/2))?g=o:v=o}while((h=c<<1|u)==(d=(l>=o)<<1|a>=s));return i[d]=f,i[h]=p,t}JS.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]},Ue(JS,ba).transform=function(t,e){var n=e.fork(e.ALL),r=this.value,i=t.field||jt,s=t.as||"path",o=n.SOURCE;!r||t.modified()?(this.value=r=XS(t.projection),n.materialize().reflow()):o=i===jt||e.modified(i.fields)?n.ADD_MOD:n.ADD;var a=function(t,e){var n=t.pointRadius();return t.context(null),null!=e&&t.pointRadius(e),n}(r,t.pointRadius);return n.visit(o,(function(t){t[s]=r(i(t))})),r.pointRadius(a),n.modifies(s)},tC.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]},Ue(tC,ba).transform=function(t,e){var n,r=t.projection,i=t.fields[0],s=t.fields[1],o=t.as||["x","y"],a=o[0],l=o[1];function u(t){var e=r([i(t),s(t)]);e?(t[a]=e[0],t[l]=e[1]):(t[a]=void 0,t[l]=void 0)}return t.modified()?e=e.materialize().reflow(!0).visit(e.SOURCE,u):(n=e.modified(i.fields)||e.modified(s.fields),e.visit(n?e.ADD_MOD:e.ADD,u)),e.modifies(o)},eC.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]},Ue(eC,ba).transform=function(t,e){var n=e.fork(e.ALL),r=this.value,i=t.as||"shape",s=n.ADD;return r&&!t.modified()||(this.value=r=function(t,e,n){var r=null==n?function(n){return t(e(n))}:function(r){var i=t.pointRadius(),s=t.pointRadius(n)(e(r));return t.pointRadius(i),s};return r.context=function(e){return t.context(e),r},r}(XS(t.projection),t.field||zt("datum"),t.pointRadius),n.materialize().reflow(),s=n.SOURCE),n.visit(s,(function(t){t[i]=r})),n.modifies(i)},iC.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]},Ue(iC,ba).transform=function(t,e){var n,r=this.value,i=this.generator;if(!r.length||t.modified())for(var s in t)ke(i[s])&&i[s](t[s]);return n=i(),r.length?e.mod.push(_n(r[0],n)):e.add.push(vn(n)),r[0]=n,e},sC.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]},Ue(sC,ba).transform=function(t,e){if(!e.changed()&&!t.modified())return e.StopPropagation;var n=e.materialize(e.SOURCE).source,r="shared"===t.resolve,i=t.field||jt,s=function(t,e){let n;return ke(t)?(n=n=>t(n,e),n.dep=oC(t)):t?n=Ie(t):(n=t=>t.$value/t.$max||0,n.dep=!0),n}(t.opacity,t),o=function(t,e){let n;return ke(t)?(n=n=>Rm(t(n,e)),n.dep=oC(t)):n=Ie(Rm(t||"#888")),n}(t.color,t),a=t.as||"image",l={$x:0,$y:0,$value:0,$max:r?za(n.map(t=>za(i(t).values))):0};return n.forEach(t=>{const e=i(t),n=Fe({},t,l);r||(n.$max=za(e.values||[])),t[a]=function(t,e,n,r){const i=t.width,s=t.x1||0,o=t.y1||0,a=t.x2||i,l=t.y2||t.height,u=t.values,c=u?t=>u[t]:Ut,h=xd(a-s,l-o),d=h.getContext("2d"),f=d.getImageData(0,0,a-s,l-o),p=f.data;for(let m=o,g=0;m<l;++m){e.$y=m-o;for(let t=s,o=m*i;t<a;++t,g+=4){e.$x=t-s,e.$value=c(t+o);const i=n(e);p[g+0]=i.r,p[g+1]=i.g,p[g+2]=i.b,p[g+3]=~~(255*r(e))}}return d.putImageData(f,0,0),h}(e,n,o.dep?o:Ie(o(n)),s.dep?s:Ie(s(n)))}),e.reflow(!0).modifies(a)},Ue(aC,ba).transform=function(t,e){var n,r,i=this.value;return!i||t.modified("type")?(this.value=((r=KS(((n=t.type)||"mercator").toLowerCase()))||$t("Unrecognized projection type: "+n),i=r()),GS.forEach((function(e){null!=t[e]&&lC(i,e,t[e])}))):GS.forEach((function(e){t.modified(e)&&lC(i,e,t[e])})),null!=t.pointRadius&&i.path.pointRadius(t.pointRadius),t.fit&&function(t,e){var n=function(t){return 1===(t=Ce(t)).length?t[0]:{type:"FeatureCollection",features:t.reduce((t,e)=>t.concat(function(t){return"FeatureCollection"===t.type?t.features:Ce(t).filter(t=>null!=t).map(t=>"Feature"===t.type?t:{type:"Feature",geometry:t})}(e)),[])}}(e.fit);e.extent?t.fitExtent(e.extent,n):e.size&&t.fitSize(e.size,n)}(i,t),e.fork(e.NO_SOURCE|e.NO_FIELDS)};var cC=function(t,e,n,r,i){this.node=t,this.x0=e,this.y0=n,this.x1=r,this.y1=i};function hC(t){return t[0]}function dC(t){return t[1]}function fC(t,e,n){var r=new pC(null==e?hC:e,null==n?dC:n,NaN,NaN,NaN,NaN);return null==t?r:r.addAll(t)}function pC(t,e,n,r,i,s){this._x=t,this._y=e,this._x0=n,this._y0=r,this._x1=i,this._y1=s,this._root=void 0}function mC(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var gC=fC.prototype=pC.prototype;gC.copy=function(){var t,e,n=new pC(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=mC(r),n;for(t=[{source:r,target:n._root=new Array(4)}];r=t.pop();)for(var i=0;i<4;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(4)}):r.target[i]=mC(e));return n},gC.add=function(t){var e=+this._x.call(null,t),n=+this._y.call(null,t);return uC(this.cover(e,n),e,n,t)},gC.addAll=function(t){var e,n,r,i,s=t.length,o=new Array(s),a=new Array(s),l=1/0,u=1/0,c=-1/0,h=-1/0;for(n=0;n<s;++n)isNaN(r=+this._x.call(null,e=t[n]))||isNaN(i=+this._y.call(null,e))||(o[n]=r,a[n]=i,r<l&&(l=r),r>c&&(c=r),i<u&&(u=i),i>h&&(h=i));if(l>c||u>h)return this;for(this.cover(l,u).cover(c,h),n=0;n<s;++n)uC(this,o[n],a[n],t[n]);return this},gC.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,r=this._y0,i=this._x1,s=this._y1;if(isNaN(n))i=(n=Math.floor(t))+1,s=(r=Math.floor(e))+1;else{for(var o,a,l=i-n,u=this._root;n>t||t>=i||r>e||e>=s;)switch(a=(e<r)<<1|t<n,(o=new Array(4))[a]=u,u=o,l*=2,a){case 0:i=n+l,s=r+l;break;case 1:n=i-l,s=r+l;break;case 2:i=n+l,r=s-l;break;case 3:n=i-l,r=s-l}this._root&&this._root.length&&(this._root=u)}return this._x0=n,this._y0=r,this._x1=i,this._y1=s,this},gC.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},gC.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},gC.find=function(t,e,n){var r,i,s,o,a,l,u,c=this._x0,h=this._y0,d=this._x1,f=this._y1,p=[],m=this._root;for(m&&p.push(new cC(m,c,h,d,f)),null==n?n=1/0:(c=t-n,h=e-n,d=t+n,f=e+n,n*=n);l=p.pop();)if(!(!(m=l.node)||(i=l.x0)>d||(s=l.y0)>f||(o=l.x1)<c||(a=l.y1)<h))if(m.length){var g=(i+o)/2,y=(s+a)/2;p.push(new cC(m[3],g,y,o,a),new cC(m[2],i,y,g,a),new cC(m[1],g,s,o,y),new cC(m[0],i,s,g,y)),(u=(e>=y)<<1|t>=g)&&(l=p[p.length-1],p[p.length-1]=p[p.length-1-u],p[p.length-1-u]=l)}else{var v=t-+this._x.call(null,m.data),b=e-+this._y.call(null,m.data),x=v*v+b*b;if(x<n){var _=Math.sqrt(n=x);c=t-_,h=e-_,d=t+_,f=e+_,r=m.data}}return r},gC.remove=function(t){if(isNaN(s=+this._x.call(null,t))||isNaN(o=+this._y.call(null,t)))return this;var e,n,r,i,s,o,a,l,u,c,h,d,f=this._root,p=this._x0,m=this._y0,g=this._x1,y=this._y1;if(!f)return this;if(f.length)for(;;){if((u=s>=(a=(p+g)/2))?p=a:g=a,(c=o>=(l=(m+y)/2))?m=l:y=l,e=f,!(f=f[h=c<<1|u]))return this;if(!f.length)break;(e[h+1&3]||e[h+2&3]||e[h+3&3])&&(n=e,d=h)}for(;f.data!==t;)if(r=f,!(f=f.next))return this;return(i=f.next)&&delete f.next,r?(i?r.next=i:delete r.next,this):e?(i?e[h]=i:delete e[h],(f=e[0]||e[1]||e[2]||e[3])&&f===(e[3]||e[2]||e[1]||e[0])&&!f.length&&(n?n[d]=f:this._root=f),this):(this._root=i,this)},gC.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},gC.root=function(){return this._root},gC.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},gC.visit=function(t){var e,n,r,i,s,o,a=[],l=this._root;for(l&&a.push(new cC(l,this._x0,this._y0,this._x1,this._y1));e=a.pop();)if(!t(l=e.node,r=e.x0,i=e.y0,s=e.x1,o=e.y1)&&l.length){var u=(r+s)/2,c=(i+o)/2;(n=l[3])&&a.push(new cC(n,u,c,s,o)),(n=l[2])&&a.push(new cC(n,r,c,u,o)),(n=l[1])&&a.push(new cC(n,u,i,s,c)),(n=l[0])&&a.push(new cC(n,r,i,u,c))}return this},gC.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new cC(this._root,this._x0,this._y0,this._x1,this._y1));e=n.pop();){var i=e.node;if(i.length){var s,o=e.x0,a=e.y0,l=e.x1,u=e.y1,c=(o+l)/2,h=(a+u)/2;(s=i[0])&&n.push(new cC(s,o,a,c,h)),(s=i[1])&&n.push(new cC(s,c,a,l,h)),(s=i[2])&&n.push(new cC(s,o,h,c,u)),(s=i[3])&&n.push(new cC(s,c,h,l,u))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},gC.x=function(t){return arguments.length?(this._x=t,this):this._x},gC.y=function(t){return arguments.length?(this._y=t,this):this._y};var yC=function(t){return function(){return t}},vC=function(){return 1e-6*(Math.random()-.5)};function bC(t){return t.x+t.vx}function xC(t){return t.y+t.vy}function _C(t){return t.index}function wC(t,e){var n=t.get(e);if(!n)throw new Error("missing: "+e);return n}var SC={value:function(){}};function CC(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new EC(r)}function EC(t){this._=t}function kC(t,e){return t.trim().split(/^|\s+/).map((function(t){var n="",r=t.indexOf(".");if(r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}}))}function AC(t,e){for(var n,r=0,i=t.length;r<i;++r)if((n=t[r]).name===e)return n.value}function DC(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=SC,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}EC.prototype=CC.prototype={constructor:EC,on:function(t,e){var n,r=this._,i=kC(t+"",r),s=-1,o=i.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++s<o;)if(n=(t=i[s]).type)r[n]=DC(r[n],t.name,e);else if(null==e)for(n in r)r[n]=DC(r[n],t.name,null);return this}for(;++s<o;)if((n=(t=i[s]).type)&&(n=AC(r[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new EC(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),s=0;s<n;++s)i[s]=arguments[s+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=0,n=(r=this._[t]).length;s<n;++s)r[s].value.apply(e,i)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,s=r.length;i<s;++i)r[i].value.apply(e,n)}};var NC,TC,OC=CC,IC=0,RC=0,FC=0,MC=0,$C=0,PC=0,zC="object"==typeof performance&&performance.now?performance:Date,LC="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function BC(){return $C||(LC(jC),$C=zC.now()+PC)}function jC(){$C=0}function UC(){this._call=this._time=this._next=null}function VC(t,e,n){var r=new UC;return r.restart(t,e,n),r}function WC(){$C=(MC=zC.now())+PC,IC=RC=0;try{!function(){BC(),++IC;for(var t,e=NC;e;)(t=$C-e._time)>=0&&e._call.call(null,t),e=e._next;--IC}()}finally{IC=0,function(){for(var t,e,n=NC,r=1/0;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:NC=e);TC=t,HC(r)}(),$C=0}}function qC(){var t=zC.now(),e=t-MC;e>1e3&&(PC-=e,MC=t)}function HC(t){IC||(RC&&(RC=clearTimeout(RC)),t-$C>24?(t<1/0&&(RC=setTimeout(WC,t-zC.now()-PC)),FC&&(FC=clearInterval(FC))):(FC||(MC=zC.now(),FC=setInterval(qC,1e3)),IC=1,LC(WC)))}function GC(t){return t.x}function YC(t){return t.y}UC.prototype=VC.prototype={constructor:UC,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?BC():+n)+(null==e?0:+e),this._next||TC===this||(TC?TC._next=this:NC=this,TC=this),this._call=t,this._time=n,HC()},stop:function(){this._call&&(this._call=null,this._time=1/0,HC())}};var KC=Math.PI*(3-Math.sqrt(5)),XC={center:function(t,e){var n;function r(){var r,i,s=n.length,o=0,a=0;for(r=0;r<s;++r)o+=(i=n[r]).x,a+=i.y;for(o=o/s-t,a=a/s-e,r=0;r<s;++r)(i=n[r]).x-=o,i.y-=a}return null==t&&(t=0),null==e&&(e=0),r.initialize=function(t){n=t},r.x=function(e){return arguments.length?(t=+e,r):t},r.y=function(t){return arguments.length?(e=+t,r):e},r},collide:function(t){var e,n,r=1,i=1;function s(){for(var t,s,a,l,u,c,h,d=e.length,f=0;f<i;++f)for(s=fC(e,bC,xC).visitAfter(o),t=0;t<d;++t)h=(c=n[(a=e[t]).index])*c,l=a.x+a.vx,u=a.y+a.vy,s.visit(p);function p(t,e,n,i,s){var o=t.data,d=t.r,f=c+d;if(!o)return e>l+f||i<l-f||n>u+f||s<u-f;if(o.index>a.index){var p=l-o.x-o.vx,m=u-o.y-o.vy,g=p*p+m*m;g<f*f&&(0===p&&(g+=(p=vC())*p),0===m&&(g+=(m=vC())*m),g=(f-(g=Math.sqrt(g)))/g*r,a.vx+=(p*=g)*(f=(d*=d)/(h+d)),a.vy+=(m*=g)*f,o.vx-=p*(f=1-f),o.vy-=m*f)}}}function o(t){if(t.data)return t.r=n[t.data.index];for(var e=t.r=0;e<4;++e)t[e]&&t[e].r>t.r&&(t.r=t[e].r)}function a(){if(e){var r,i,s=e.length;for(n=new Array(s),r=0;r<s;++r)n[(i=e[r]).index]=+t(i,r,e)}}return"function"!=typeof t&&(t=yC(null==t?1:+t)),s.initialize=function(t){e=t,a()},s.iterations=function(t){return arguments.length?(i=+t,s):i},s.strength=function(t){return arguments.length?(r=+t,s):r},s.radius=function(e){return arguments.length?(t="function"==typeof e?e:yC(+e),a(),s):t},s},nbody:function(){var t,e,n,r,i=yC(-30),s=1,o=1/0,a=.81;function l(r){var i,s=t.length,o=fC(t,GC,YC).visitAfter(c);for(n=r,i=0;i<s;++i)e=t[i],o.visit(h)}function u(){if(t){var e,n,s=t.length;for(r=new Array(s),e=0;e<s;++e)r[(n=t[e]).index]=+i(n,e,t)}}function c(t){var e,n,i,s,o,a=0,l=0;if(t.length){for(i=s=o=0;o<4;++o)(e=t[o])&&(n=Math.abs(e.value))&&(a+=e.value,l+=n,i+=n*e.x,s+=n*e.y);t.x=i/l,t.y=s/l}else{(e=t).x=e.data.x,e.y=e.data.y;do{a+=r[e.data.index]}while(e=e.next)}t.value=a}function h(t,i,l,u){if(!t.value)return!0;var c=t.x-e.x,h=t.y-e.y,d=u-i,f=c*c+h*h;if(d*d/a<f)return f<o&&(0===c&&(f+=(c=vC())*c),0===h&&(f+=(h=vC())*h),f<s&&(f=Math.sqrt(s*f)),e.vx+=c*t.value*n/f,e.vy+=h*t.value*n/f),!0;if(!(t.length||f>=o)){(t.data!==e||t.next)&&(0===c&&(f+=(c=vC())*c),0===h&&(f+=(h=vC())*h),f<s&&(f=Math.sqrt(s*f)));do{t.data!==e&&(e.vx+=c*(d=r[t.data.index]*n/f),e.vy+=h*d)}while(t=t.next)}}return l.initialize=function(e){t=e,u()},l.strength=function(t){return arguments.length?(i="function"==typeof t?t:yC(+t),u(),l):i},l.distanceMin=function(t){return arguments.length?(s=t*t,l):Math.sqrt(s)},l.distanceMax=function(t){return arguments.length?(o=t*t,l):Math.sqrt(o)},l.theta=function(t){return arguments.length?(a=t*t,l):Math.sqrt(a)},l},link:function(t){var e,n,r,i,s,o=_C,a=function(t){return 1/Math.min(i[t.source.index],i[t.target.index])},l=yC(30),u=1;function c(r){for(var i=0,o=t.length;i<u;++i)for(var a,l,c,h,d,f,p,m=0;m<o;++m)h=(c=(a=t[m]).target).x+c.vx-(l=a.source).x-l.vx||vC(),d=c.y+c.vy-l.y-l.vy||vC(),d*=f=((f=Math.sqrt(h*h+d*d))-n[m])/f*r*e[m],c.vx-=(h*=f)*(p=s[m]),c.vy-=d*p,l.vx+=h*(p=1-p),l.vy+=d*p}function h(){if(r){var a,l,u=r.length,c=t.length,h=new Map(r.map((t,e)=>[o(t,e,r),t]));for(a=0,i=new Array(u);a<c;++a)(l=t[a]).index=a,"object"!=typeof l.source&&(l.source=wC(h,l.source)),"object"!=typeof l.target&&(l.target=wC(h,l.target)),i[l.source.index]=(i[l.source.index]||0)+1,i[l.target.index]=(i[l.target.index]||0)+1;for(a=0,s=new Array(c);a<c;++a)s[a]=i[(l=t[a]).source.index]/(i[l.source.index]+i[l.target.index]);e=new Array(c),d(),n=new Array(c),f()}}function d(){if(r)for(var n=0,i=t.length;n<i;++n)e[n]=+a(t[n],n,t)}function f(){if(r)for(var e=0,i=t.length;e<i;++e)n[e]=+l(t[e],e,t)}return null==t&&(t=[]),c.initialize=function(t){r=t,h()},c.links=function(e){return arguments.length?(t=e,h(),c):t},c.id=function(t){return arguments.length?(o=t,c):o},c.iterations=function(t){return arguments.length?(u=+t,c):u},c.strength=function(t){return arguments.length?(a="function"==typeof t?t:yC(+t),d(),c):a},c.distance=function(t){return arguments.length?(l="function"==typeof t?t:yC(+t),f(),c):l},c},x:function(t){var e,n,r,i=yC(.1);function s(t){for(var i,s=0,o=e.length;s<o;++s)(i=e[s]).vx+=(r[s]-i.x)*n[s]*t}function o(){if(e){var s,o=e.length;for(n=new Array(o),r=new Array(o),s=0;s<o;++s)n[s]=isNaN(r[s]=+t(e[s],s,e))?0:+i(e[s],s,e)}}return"function"!=typeof t&&(t=yC(null==t?0:+t)),s.initialize=function(t){e=t,o()},s.strength=function(t){return arguments.length?(i="function"==typeof t?t:yC(+t),o(),s):i},s.x=function(e){return arguments.length?(t="function"==typeof e?e:yC(+e),o(),s):t},s},y:function(t){var e,n,r,i=yC(.1);function s(t){for(var i,s=0,o=e.length;s<o;++s)(i=e[s]).vy+=(r[s]-i.y)*n[s]*t}function o(){if(e){var s,o=e.length;for(n=new Array(o),r=new Array(o),s=0;s<o;++s)n[s]=isNaN(r[s]=+t(e[s],s,e))?0:+i(e[s],s,e)}}return"function"!=typeof t&&(t=yC(null==t?0:+t)),s.initialize=function(t){e=t,o()},s.strength=function(t){return arguments.length?(i="function"==typeof t?t:yC(+t),o(),s):i},s.y=function(e){return arguments.length?(t="function"==typeof e?e:yC(+e),o(),s):t},s}},ZC=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],QC=["static","iterations"],JC=["x","y","vx","vy"];function tE(t){ba.call(this,null,t)}tE.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:JC}]};var eE=Ue(tE,ba);function nE(t,e,n,r){var i,s,o,a,l=Ce(e.forces);for(i=0,s=ZC.length;i<s;++i)"forces"!==(o=ZC[i])&&e.modified(o)&&t[o](e[o]);for(i=0,s=l.length;i<s;++i)a="forces"+i,(o=n||e.modified("forces",i)?iE(l[i]):r&&rE(l[i],r)?t.force(a):null)&&t.force(a,o);for(s=t.numForces||0;i<s;++i)t.force("forces"+i,null);return t.numForces=l.length,t}function rE(t,e){var n,r;for(n in t)if(ke(r=t[n])&&e.modified(It(r)))return 1;return 0}function iE(t){var e,n;for(n in ze(XC,t.force)||$t("Unrecognized force: "+t.force),e=XC[t.force](),t)ke(e[n])&&sE(e[n],t[n],t);return e}function sE(t,e,n){t(ke(e)?function(t){return e(t,n)}:e)}eE.transform=function(t,e){var n,r,i=this.value,s=e.changed(e.ADD_REM),o=t.modified(ZC),a=t.iterations||300;if(i?(s&&(e.modifies("index"),i.nodes(e.source)),(o||e.changed(e.MOD))&&nE(i,t,0,e)):(this.value=i=function(t,e){var n=function(t){var e,n=1,r=.001,i=1-Math.pow(r,1/300),s=0,o=.6,a=new Map,l=VC(c),u=OC("tick","end");function c(){h(),u.call("tick",e),n<r&&(l.stop(),u.call("end",e))}function h(r){var l,u,c=t.length;void 0===r&&(r=1);for(var h=0;h<r;++h)for(n+=(s-n)*i,a.forEach((function(t){t(n)})),l=0;l<c;++l)null==(u=t[l]).fx?u.x+=u.vx*=o:(u.x=u.fx,u.vx=0),null==u.fy?u.y+=u.vy*=o:(u.y=u.fy,u.vy=0);return e}function d(){for(var e,n=0,r=t.length;n<r;++n){if((e=t[n]).index=n,null!=e.fx&&(e.x=e.fx),null!=e.fy&&(e.y=e.fy),isNaN(e.x)||isNaN(e.y)){var i=10*Math.sqrt(n),s=n*KC;e.x=i*Math.cos(s),e.y=i*Math.sin(s)}(isNaN(e.vx)||isNaN(e.vy))&&(e.vx=e.vy=0)}}function f(e){return e.initialize&&e.initialize(t),e}return null==t&&(t=[]),d(),e={tick:h,restart:function(){return l.restart(c),e},stop:function(){return l.stop(),e},nodes:function(n){return arguments.length?(t=n,d(),a.forEach(f),e):t},alpha:function(t){return arguments.length?(n=+t,e):n},alphaMin:function(t){return arguments.length?(r=+t,e):r},alphaDecay:function(t){return arguments.length?(i=+t,e):+i},alphaTarget:function(t){return arguments.length?(s=+t,e):s},velocityDecay:function(t){return arguments.length?(o=1-t,e):1-o},force:function(t,n){return arguments.length>1?(null==n?a.delete(t):a.set(t,f(n)),e):a.get(t)},find:function(e,n,r){var i,s,o,a,l,u=0,c=t.length;for(null==r?r=1/0:r*=r,u=0;u<c;++u)(o=(i=e-(a=t[u]).x)*i+(s=n-a.y)*s)<r&&(l=a,r=o);return l},on:function(t,n){return arguments.length>1?(u.on(t,n),e):u.on(t)}}}(t),r=!1,i=n.stop,s=n.restart;return n.stopped=function(){return r},n.restart=function(){return r=!1,s()},n.stop=function(){return r=!0,i()},nE(n,e,!0).on("end",(function(){r=!0}))}(e.source,t),i.on("tick",(n=e.dataflow,r=this,function(){n.touch(r).run()})),t.static||(s=!0,i.tick()),e.modifies("index")),o||s||t.modified(QC)||e.changed()&&t.restart)if(i.alpha(Math.max(i.alpha(),t.alpha||1)).alphaDecay(1-Math.pow(i.alphaMin(),1/a)),t.static)for(i.stop();--a>=0;)i.tick();else if(i.stopped()&&i.restart(),!s)return e.StopPropagation;return this.finish(t,e)},eE.finish=function(t,e){for(var n,r=e.dataflow,i=this._argops,s=0,o=i.length;s<o;++s)if("forces"===(n=i[s]).name&&"link"===n.op._argval.force)for(var a,l=n.op._argops,u=0,c=l.length;u<c;++u)if("links"===l[u].name&&(a=l[u].op.source)){r.pulse(a,r.changeset().reflow());break}return e.reflow(t.modified()).modifies(JC)};var oE=function(t,e,n){var r={};return t.each((function(t){var i=t.data;n(i)&&(r[e(i)]=t)})),t.lookup=r,t};function aE(t){var e=0,n=t.children,r=n&&n.length;if(r)for(;--r>=0;)e+=n[r].value;else e=1;t.value=e}function lE(t,e){var n,r,i,s,o,a=new dE(t),l=+t.value&&(a.value=t.value),u=[a];for(null==e&&(e=uE);n=u.pop();)if(l&&(n.value=+n.data.value),(i=e(n.data))&&(o=i.length))for(n.children=new Array(o),s=o-1;s>=0;--s)u.push(r=n.children[s]=new dE(i[s])),r.parent=n,r.depth=n.depth+1;return a.eachBefore(hE)}function uE(t){return t.children}function cE(t){t.data=t.data.data}function hE(t){var e=0;do{t.height=e}while((t=t.parent)&&t.height<++e)}function dE(t){this.data=t,this.depth=this.height=0,this.parent=null}function fE(t){ba.call(this,null,t)}function pE(t){return t.values}function mE(){var t,e=[];return t={entries:t=>function t(n,r){if(++r>e.length)return n;var i,s=[];for(i in n)s.push({key:i,values:t(n[i],r)});return s}(function t(n,r){if(r>=e.length)return n;for(var i,s,o,a=-1,l=n.length,u=e[r++],c={},h={};++a<l;)(o=c[i=u(s=n[a])+""])?o.push(s):c[i]=[s];for(i in c)h[i]=t(c[i],r);return h}(t,0),0),key:n=>(e.push(n),t)}}function gE(t){ba.call(this,null,t)}function yE(t,e){return t.parent===e.parent?1:2}dE.prototype=lE.prototype={constructor:dE,count:function(){return this.eachAfter(aE)},each:function(t){var e,n,r,i,s=this,o=[s];do{for(e=o.reverse(),o=[];s=e.pop();)if(t(s),n=s.children)for(r=0,i=n.length;r<i;++r)o.push(n[r])}while(o.length);return this},eachAfter:function(t){for(var e,n,r,i=this,s=[i],o=[];i=s.pop();)if(o.push(i),e=i.children)for(n=0,r=e.length;n<r;++n)s.push(e[n]);for(;i=o.pop();)t(i);return this},eachBefore:function(t){for(var e,n,r=this,i=[r];r=i.pop();)if(t(r),e=r.children)for(n=e.length-1;n>=0;--n)i.push(e[n]);return this},sum:function(t){return this.eachAfter((function(e){for(var n=+t(e.data)||0,r=e.children,i=r&&r.length;--i>=0;)n+=r[i].value;e.value=n}))},sort:function(t){return this.eachBefore((function(e){e.children&&e.children.sort(t)}))},path:function(t){for(var e=this,n=function(t,e){if(t===e)return t;var n=t.ancestors(),r=e.ancestors(),i=null;for(t=n.pop(),e=r.pop();t===e;)i=t,t=n.pop(),e=r.pop();return i}(e,t),r=[e];e!==n;)r.push(e=e.parent);for(var i=r.length;t!==n;)r.splice(i,0,t),t=t.parent;return r},ancestors:function(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e},descendants:function(){var t=[];return this.each((function(e){t.push(e)})),t},leaves:function(){var t=[];return this.eachBefore((function(e){e.children||t.push(e)})),t},links:function(){var t=this,e=[];return t.each((function(n){n!==t&&e.push({source:n.parent,target:n})})),e},copy:function(){return lE(this).eachBefore(cE)}},fE.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]},Ue(fE,ba).transform=function(t,e){e.source||$t("Nest transform requires an upstream data source.");var n=t.generate,r=t.modified(),i=e.clone(),s=this.value;return(!s||r||e.changed())&&(s&&s.each(t=>{t.children&&mn(t.data)&&i.rem.push(t.data)}),this.value=s=lE({values:Ce(t.keys).reduce((t,e)=>(t.key(e),t),mE()).entries(i.source)},pE),n&&s.each(t=>{t.children&&(t=vn(t.data),i.add.push(t),i.source.push(t))}),oE(s,gn,gn)),i.source.root=s,i},Ue(gE,ba).transform=function(t,e){e.source&&e.source.root||$t(this.constructor.name+" transform requires a backing tree data source.");var n=this.layout(t.method),r=this.fields,i=e.source.root,s=t.as||r;t.field?i.sum(t.field):i.count(),t.sort&&i.sort(wn(t.sort,t=>t.data)),function(t,e,n){for(var r,i=0,s=e.length;i<s;++i)(r=e[i])in n&&t[r](n[r])}(n,this.params,t),n.separation&&n.separation(!1!==t.separation?yE:Vt);try{this.value=n(i)}catch(o){$t(o)}return i.each((function(t){!function(t,e,n){for(var r=t.data,i=0,s=e.length-1;i<s;++i)r[n[i]]=t[e[i]];r[n[s]]=t.children?t.children.length:0}(t,r,s)})),e.reflow(t.modified()).modifies(s).modifies("leaf")};var vE=Array.prototype.slice;function bE(t,e){var n,r;if(wE(e,t))return[e];for(n=0;n<t.length;++n)if(xE(e,t[n])&&wE(CE(t[n],e),t))return[t[n],e];for(n=0;n<t.length-1;++n)for(r=n+1;r<t.length;++r)if(xE(CE(t[n],t[r]),e)&&xE(CE(t[n],e),t[r])&&xE(CE(t[r],e),t[n])&&wE(EE(t[n],t[r],e),t))return[t[n],t[r],e];throw new Error}function xE(t,e){var n=t.r-e.r,r=e.x-t.x,i=e.y-t.y;return n<0||n*n<r*r+i*i}function _E(t,e){var n=t.r-e.r+1e-6,r=e.x-t.x,i=e.y-t.y;return n>0&&n*n>r*r+i*i}function wE(t,e){for(var n=0;n<e.length;++n)if(!_E(t,e[n]))return!1;return!0}function SE(t){switch(t.length){case 1:return{x:(e=t[0]).x,y:e.y,r:e.r};case 2:return CE(t[0],t[1]);case 3:return EE(t[0],t[1],t[2])}var e}function CE(t,e){var n=t.x,r=t.y,i=t.r,s=e.x,o=e.y,a=e.r,l=s-n,u=o-r,c=a-i,h=Math.sqrt(l*l+u*u);return{x:(n+s+l/h*c)/2,y:(r+o+u/h*c)/2,r:(h+i+a)/2}}function EE(t,e,n){var r=t.x,i=t.y,s=t.r,o=e.x,a=e.y,l=e.r,u=n.x,c=n.y,h=n.r,d=r-o,f=r-u,p=i-a,m=i-c,g=l-s,y=h-s,v=r*r+i*i-s*s,b=v-o*o-a*a+l*l,x=v-u*u-c*c+h*h,_=f*p-d*m,w=(p*x-m*b)/(2*_)-r,S=(m*g-p*y)/_,C=(f*b-d*x)/(2*_)-i,E=(d*y-f*g)/_,k=S*S+E*E-1,A=2*(s+w*S+C*E),D=w*w+C*C-s*s,N=-(k?(A+Math.sqrt(A*A-4*k*D))/(2*k):D/A);return{x:r+w+S*N,y:i+C+E*N,r:N}}function kE(t,e,n){var r,i,s,o,a=t.x-e.x,l=t.y-e.y,u=a*a+l*l;u?(i=e.r+n.r,o=t.r+n.r,(i*=i)>(o*=o)?(r=(u+o-i)/(2*u),s=Math.sqrt(Math.max(0,o/u-r*r)),n.x=t.x-r*a-s*l,n.y=t.y-r*l+s*a):(r=(u+i-o)/(2*u),s=Math.sqrt(Math.max(0,i/u-r*r)),n.x=e.x+r*a-s*l,n.y=e.y+r*l+s*a)):(n.x=e.x+n.r,n.y=e.y)}function AE(t,e){var n=t.r+e.r-1e-6,r=e.x-t.x,i=e.y-t.y;return n>0&&n*n>r*r+i*i}function DE(t){var e=t._,n=t.next._,r=e.r+n.r,i=(e.x*n.r+n.x*e.r)/r,s=(e.y*n.r+n.y*e.r)/r;return i*i+s*s}function NE(t){this._=t,this.next=null,this.previous=null}function TE(t){return null==t?null:OE(t)}function OE(t){if("function"!=typeof t)throw new Error;return t}function IE(){return 0}var RE=function(t){return function(){return t}};function FE(t){return Math.sqrt(t.value)}function ME(t){return function(e){e.children||(e.r=Math.max(0,+t(e)||0))}}function $E(t,e){return function(n){if(r=n.children){var r,i,s,o=r.length,a=t(n)*e||0;if(a)for(i=0;i<o;++i)r[i].r+=a;if(s=function(t){if(!(i=t.length))return 0;var e,n,r,i,s,o,a,l,u,c,h;if((e=t[0]).x=0,e.y=0,!(i>1))return e.r;if(e.x=-(n=t[1]).r,n.x=e.r,n.y=0,!(i>2))return e.r+n.r;kE(n,e,r=t[2]),e=new NE(e),n=new NE(n),r=new NE(r),e.next=r.previous=n,n.next=e.previous=r,r.next=n.previous=e;t:for(a=3;a<i;++a){kE(e._,n._,r=t[a]),r=new NE(r),l=n.next,u=e.previous,c=n._.r,h=e._.r;do{if(c<=h){if(AE(l._,r._)){e.next=n=l,n.previous=e,--a;continue t}c+=l._.r,l=l.next}else{if(AE(u._,r._)){(e=u).next=n,n.previous=e,--a;continue t}h+=u._.r,u=u.previous}}while(l!==u.next);for(r.previous=e,r.next=n,e.next=n.previous=n=r,s=DE(e);(r=r.next)!==n;)(o=DE(r))<s&&(e=r,s=o);n=e.next}for(e=[n._],r=n;(r=r.next)!==n;)e.push(r._);for(r=function(t){for(var e,n,r=0,i=(t=function(t){for(var e,n,r=t.length;r;)n=Math.random()*r--|0,e=t[r],t[r]=t[n],t[n]=e;return t}(vE.call(t))).length,s=[];r<i;)e=t[r],n&&_E(n,e)?++r:(n=SE(s=bE(s,e)),r=0);return n}(e),a=0;a<i;++a)(e=t[a]).x-=r.x,e.y-=r.y;return r.r}(r),a)for(i=0;i<o;++i)r[i].r-=a;n.r=s+a}}}function PE(t){return function(e){var n=e.parent;e.r*=t,n&&(e.x=n.x+t*e.x,e.y=n.y+t*e.y)}}var zE=["x","y","r","depth","children"];function LE(t){gE.call(this,t)}LE.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:zE.length,default:zE}]};var BE=Ue(LE,gE);BE.layout=function(){var t=null,e=1,n=1,r=IE;function i(i){return i.x=e/2,i.y=n/2,t?i.eachBefore(ME(t)).eachAfter($E(r,.5)).eachBefore(PE(1)):i.eachBefore(ME(FE)).eachAfter($E(IE,1)).eachAfter($E(r,i.r/Math.min(e,n))).eachBefore(PE(Math.min(e,n)/(2*i.r))),i}return i.radius=function(e){return arguments.length?(t=TE(e),i):t},i.size=function(t){return arguments.length?(e=+t[0],n=+t[1],i):[e,n]},i.padding=function(t){return arguments.length?(r="function"==typeof t?t:RE(+t),i):r},i},BE.params=["radius","size","padding"],BE.fields=zE;var jE=function(t){t.x0=Math.round(t.x0),t.y0=Math.round(t.y0),t.x1=Math.round(t.x1),t.y1=Math.round(t.y1)},UE=function(t,e,n,r,i){for(var s,o=t.children,a=-1,l=o.length,u=t.value&&(r-e)/t.value;++a<l;)(s=o[a]).y0=n,s.y1=i,s.x0=e,s.x1=e+=s.value*u},VE=["x0","y0","x1","y1","depth","children"];function WE(t){gE.call(this,t)}WE.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:VE.length,default:VE}]};var qE=Ue(WE,gE);qE.layout=function(){var t=1,e=1,n=0,r=!1;function i(i){var s=i.height+1;return i.x0=i.y0=n,i.x1=t,i.y1=e/s,i.eachBefore(function(t,e){return function(r){r.children&&UE(r,r.x0,t*(r.depth+1)/e,r.x1,t*(r.depth+2)/e);var i=r.x0,s=r.y0,o=r.x1-n,a=r.y1-n;o<i&&(i=o=(i+o)/2),a<s&&(s=a=(s+a)/2),r.x0=i,r.y0=s,r.x1=o,r.y1=a}}(e,s)),r&&i.eachBefore(jE),i}return i.round=function(t){return arguments.length?(r=!!t,i):r},i.size=function(n){return arguments.length?(t=+n[0],e=+n[1],i):[t,e]},i.padding=function(t){return arguments.length?(n=+t,i):n},i},qE.params=["size","round","padding"],qE.fields=VE;var HE={depth:-1},GE={};function YE(t){return t.id}function KE(t){return t.parentId}var XE=function(){var t=YE,e=KE;function n(n){var r,i,s,o,a,l,u,c=n.length,h=new Array(c),d={};for(i=0;i<c;++i)a=h[i]=new dE(r=n[i]),null!=(l=t(r,i,n))&&(l+="")&&(d[u="$"+(a.id=l)]=u in d?GE:a);for(i=0;i<c;++i)if(a=h[i],null!=(l=e(n[i],i,n))&&(l+="")){if(!(o=d["$"+l]))throw new Error("missing: "+l);if(o===GE)throw new Error("ambiguous: "+l);o.children?o.children.push(a):o.children=[a],a.parent=o}else{if(s)throw new Error("multiple roots");s=a}if(!s)throw new Error("no root");if(s.parent=HE,s.eachBefore((function(t){t.depth=t.parent.depth+1,--c})).eachBefore(hE),s.parent=null,c>0)throw new Error("cycle");return s}return n.id=function(e){return arguments.length?(t=OE(e),n):t},n.parentId=function(t){return arguments.length?(e=OE(t),n):e},n};function ZE(t){ba.call(this,null,t)}function QE(t,e){return t.parent===e.parent?1:2}function JE(t){var e=t.children;return e?e[0]:t.t}function tk(t){var e=t.children;return e?e[e.length-1]:t.t}function ek(t,e,n){var r=n/(e.i-t.i);e.c-=r,e.s+=n,t.c+=r,e.z+=n,e.m+=n}function nk(t,e,n){return t.a.parent===e.parent?t.a:n}function rk(t,e){this._=t,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=e}function ik(t,e){return t.parent===e.parent?1:2}function sk(t,e){return t+e.x}function ok(t,e){return Math.max(t,e.y)}ZE.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]},Ue(ZE,ba).transform=function(t,e){e.source||$t("Stratify transform requires an upstream data source.");var n=this.value,r=t.modified(),i=e.fork(e.ALL).materialize(e.SOURCE),s=!this.value||r||e.changed(e.ADD_REM)||e.modified(t.key.fields)||e.modified(t.parentKey.fields);return i.source=i.source.slice(),s&&(n=i.source.length?oE(XE().id(t.key).parentId(t.parentKey)(i.source),t.key,Wt):oE(XE()([{}]),t.key,t.key)),i.source.root=this.value=n,i},rk.prototype=Object.create(dE.prototype);var ak={tidy:function(){var t=QE,e=1,n=1,r=null;function i(i){var l=function(t){for(var e,n,r,i,s,o=new rk(t,0),a=[o];e=a.pop();)if(r=e._.children)for(e.children=new Array(s=r.length),i=s-1;i>=0;--i)a.push(n=e.children[i]=new rk(r[i],i)),n.parent=e;return(o.parent=new rk(null,0)).children=[o],o}(i);if(l.eachAfter(s),l.parent.m=-l.z,l.eachBefore(o),r)i.eachBefore(a);else{var u=i,c=i,h=i;i.eachBefore((function(t){t.x<u.x&&(u=t),t.x>c.x&&(c=t),t.depth>h.depth&&(h=t)}));var d=u===c?1:t(u,c)/2,f=d-u.x,p=e/(c.x+d+f),m=n/(h.depth||1);i.eachBefore((function(t){t.x=(t.x+f)*p,t.y=t.depth*m}))}return i}function s(e){var n=e.children,r=e.parent.children,i=e.i?r[e.i-1]:null;if(n){!function(t){for(var e,n=0,r=0,i=t.children,s=i.length;--s>=0;)(e=i[s]).z+=n,e.m+=n,n+=e.s+(r+=e.c)}(e);var s=(n[0].z+n[n.length-1].z)/2;i?(e.z=i.z+t(e._,i._),e.m=e.z-s):e.z=s}else i&&(e.z=i.z+t(e._,i._));e.parent.A=function(e,n,r){if(n){for(var i,s=e,o=e,a=n,l=s.parent.children[0],u=s.m,c=o.m,h=a.m,d=l.m;a=tk(a),s=JE(s),a&&s;)l=JE(l),(o=tk(o)).a=e,(i=a.z+h-s.z-u+t(a._,s._))>0&&(ek(nk(a,e,r),e,i),u+=i,c+=i),h+=a.m,u+=s.m,d+=l.m,c+=o.m;a&&!tk(o)&&(o.t=a,o.m+=h-c),s&&!JE(l)&&(l.t=s,l.m+=u-d,r=e)}return r}(e,i,e.parent.A||r[0])}function o(t){t._.x=t.z+t.parent.m,t.m+=t.parent.m}function a(t){t.x*=e,t.y=t.depth*n}return i.separation=function(e){return arguments.length?(t=e,i):t},i.size=function(t){return arguments.length?(r=!1,e=+t[0],n=+t[1],i):r?null:[e,n]},i.nodeSize=function(t){return arguments.length?(r=!0,e=+t[0],n=+t[1],i):r?[e,n]:null},i},cluster:function(){var t=ik,e=1,n=1,r=!1;function i(i){var s,o=0;i.eachAfter((function(e){var n=e.children;n?(e.x=function(t){return t.reduce(sk,0)/t.length}(n),e.y=function(t){return 1+t.reduce(ok,0)}(n)):(e.x=s?o+=t(e,s):0,e.y=0,s=e)}));var a=function(t){for(var e;e=t.children;)t=e[0];return t}(i),l=function(t){for(var e;e=t.children;)t=e[e.length-1];return t}(i),u=a.x-t(a,l)/2,c=l.x+t(l,a)/2;return i.eachAfter(r?function(t){t.x=(t.x-i.x)*e,t.y=(i.y-t.y)*n}:function(t){t.x=(t.x-u)/(c-u)*e,t.y=(1-(i.y?t.y/i.y:1))*n})}return i.separation=function(e){return arguments.length?(t=e,i):t},i.size=function(t){return arguments.length?(r=!1,e=+t[0],n=+t[1],i):r?null:[e,n]},i.nodeSize=function(t){return arguments.length?(r=!0,e=+t[0],n=+t[1],i):r?[e,n]:null},i}},lk=["x","y","depth","children"];function uk(t){gE.call(this,t)}uk.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:lk.length,default:lk}]};var ck=Ue(uk,gE);function hk(t){ba.call(this,[],t)}ck.layout=function(t){var e=t||"tidy";if(ze(ak,e))return ak[e]();$t("Unrecognized Tree layout method: "+e)},ck.params=["size","nodeSize"],ck.fields=lk,hk.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]},Ue(hk,ba).transform=function(t,e){var n=this.value,r=e.source&&e.source.root,i=e.fork(e.NO_SOURCE),s={};return r||$t("TreeLinks transform requires a tree data source."),e.changed(e.ADD_REM)?(i.rem=n,e.visit(e.SOURCE,(function(t){s[gn(t)]=1})),r.each((function(t){var e=t.data,n=t.parent&&t.parent.data;n&&s[gn(e)]&&s[gn(n)]&&i.add.push(vn({source:n,target:e}))})),this.value=i.add):e.changed(e.MOD)&&(e.visit(e.MOD,(function(t){s[gn(t)]=1})),n.forEach((function(t){(s[gn(t.source)]||s[gn(t.target)])&&i.mod.push(t)}))),i};var dk=function(t,e,n,r,i){for(var s,o=t.children,a=-1,l=o.length,u=t.value&&(i-n)/t.value;++a<l;)(s=o[a]).x0=e,s.x1=r,s.y0=n,s.y1=n+=s.value*u},fk=(1+Math.sqrt(5))/2;function pk(t,e,n,r,i,s){for(var o,a,l,u,c,h,d,f,p,m,g,y=[],v=e.children,b=0,x=0,_=v.length,w=e.value;b<_;){l=i-n,u=s-r;do{c=v[x++].value}while(!c&&x<_);for(h=d=c,g=c*c*(m=Math.max(u/l,l/u)/(w*t)),p=Math.max(d/g,g/h);x<_;++x){if(c+=a=v[x].value,a<h&&(h=a),a>d&&(d=a),g=c*c*m,(f=Math.max(d/g,g/h))>p){c-=a;break}p=f}y.push(o={value:c,dice:l<u,children:v.slice(b,x)}),o.dice?UE(o,n,r,i,w?r+=u*c/w:s):dk(o,n,r,w?n+=l*c/w:i,s),w-=c,b=x}return y}var mk=function t(e){function n(t,n,r,i,s){pk(e,t,n,r,i,s)}return n.ratio=function(e){return t((e=+e)>1?e:1)},n}(fk),gk=function t(e){function n(t,n,r,i,s){if((o=t._squarify)&&o.ratio===e)for(var o,a,l,u,c,h=-1,d=o.length,f=t.value;++h<d;){for(l=(a=o[h]).children,u=a.value=0,c=l.length;u<c;++u)a.value+=l[u].value;a.dice?UE(a,n,r,i,r+=(s-r)*a.value/f):dk(a,n,r,n+=(i-n)*a.value/f,s),f-=a.value}else t._squarify=o=pk(e,t,n,r,i,s),o.ratio=e}return n.ratio=function(e){return t((e=+e)>1?e:1)},n}(fk),yk={binary:function(t,e,n,r,i){var s,o,a=t.children,l=a.length,u=new Array(l+1);for(u[0]=o=s=0;s<l;++s)u[s+1]=o+=a[s].value;!function t(e,n,r,i,s,o,l){if(e>=n-1){var c=a[e];return c.x0=i,c.y0=s,c.x1=o,void(c.y1=l)}for(var h=u[e],d=r/2+h,f=e+1,p=n-1;f<p;){var m=f+p>>>1;u[m]<d?f=m+1:p=m}d-u[f-1]<u[f]-d&&e+1<f&&--f;var g=u[f]-h,y=r-g;if(o-i>l-s){var v=(i*y+o*g)/r;t(e,f,g,i,s,v,l),t(f,n,y,v,s,o,l)}else{var b=(s*y+l*g)/r;t(e,f,g,i,s,o,b),t(f,n,y,i,b,o,l)}}(0,l,t.value,e,n,r,i)},dice:UE,slice:dk,slicedice:function(t,e,n,r,i){(1&t.depth?dk:UE)(t,e,n,r,i)},squarify:mk,resquarify:gk},vk=["x0","y0","x1","y1","depth","children"];function bk(t){gE.call(this,t)}bk.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:vk.length,default:vk}]};var xk=Ue(bk,gE);xk.layout=function(){var t=function(){var t=mk,e=!1,n=1,r=1,i=[0],s=IE,o=IE,a=IE,l=IE,u=IE;function c(t){return t.x0=t.y0=0,t.x1=n,t.y1=r,t.eachBefore(h),i=[0],e&&t.eachBefore(jE),t}function h(e){var n=i[e.depth],r=e.x0+n,c=e.y0+n,h=e.x1-n,d=e.y1-n;h<r&&(r=h=(r+h)/2),d<c&&(c=d=(c+d)/2),e.x0=r,e.y0=c,e.x1=h,e.y1=d,e.children&&(n=i[e.depth+1]=s(e)/2,r+=u(e)-n,c+=o(e)-n,(h-=a(e)-n)<r&&(r=h=(r+h)/2),(d-=l(e)-n)<c&&(c=d=(c+d)/2),t(e,r,c,h,d))}return c.round=function(t){return arguments.length?(e=!!t,c):e},c.size=function(t){return arguments.length?(n=+t[0],r=+t[1],c):[n,r]},c.tile=function(e){return arguments.length?(t=OE(e),c):t},c.padding=function(t){return arguments.length?c.paddingInner(t).paddingOuter(t):c.paddingInner()},c.paddingInner=function(t){return arguments.length?(s="function"==typeof t?t:RE(+t),c):s},c.paddingOuter=function(t){return arguments.length?c.paddingTop(t).paddingRight(t).paddingBottom(t).paddingLeft(t):c.paddingTop()},c.paddingTop=function(t){return arguments.length?(o="function"==typeof t?t:RE(+t),c):o},c.paddingRight=function(t){return arguments.length?(a="function"==typeof t?t:RE(+t),c):a},c.paddingBottom=function(t){return arguments.length?(l="function"==typeof t?t:RE(+t),c):l},c.paddingLeft=function(t){return arguments.length?(u="function"==typeof t?t:RE(+t),c):u},c}();return t.ratio=function(e){var n=t.tile();n.ratio&&t.tile(n.ratio(e))},t.method=function(e){ze(yk,e)?t.tile(yk[e]):$t("Unrecognized Treemap layout method: "+e)},t},xk.params=["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],xk.fields=vk;var _k=function(t,e){var n,r,i,s,o,a,l=[],u=function(t){return t(s)};if(null==e)l.push(t);else for(n={},r=0,i=t.length;r<i;++r)s=t[r],(a=n[o=e.map(u)])||(n[o]=a=[],a.dims=o,l.push(a)),a.push(s);return l};function wk(t){ba.call(this,null,t)}wk.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]},Ue(wk,ba).transform=function(t,e){var n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const r=e.materialize(e.SOURCE).source,i=_k(r,t.groupby),s=(t.groupby||[]).map(Ot),o=s.length,a=t.as||[Ot(t.x),Ot(t.y)],l=[];i.forEach(e=>{Ol(e,t.x,t.y,t.bandwidth||.3).forEach(t=>{const n={};for(let r=0;r<o;++r)n[s[r]]=e.dims[r];n[a[0]]=t[0],n[a[1]]=t[1],l.push(vn(n))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n};const Sk={linear:Sl,log:Cl,exp:El,pow:kl,quad:Al,poly:Dl};function Ck(t){ba.call(this,null,t)}Ck.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(Sk)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]},Ue(Ck,ba).transform=function(t,e){var n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const r=e.materialize(e.SOURCE).source,i=_k(r,t.groupby),s=(t.groupby||[]).map(Ot),o=t.method||"linear",a=t.order||3,l=function(t,e){return"poly"===t?e:"quad"===t?2:1}(o,a),u=t.as||[Ot(t.x),Ot(t.y)],c=Sk[o],h=[];let d=t.extent;ze(Sk,o)||$t("Invalid regression method: "+o),null!=d&&"log"===o&&d[0]<=0&&(e.dataflow.warn("Ignoring extent with values <= 0 for log regression."),d=null),i.forEach(n=>{if(n.length<=l)return void e.dataflow.warn("Skipping regression with more parameters than data points.");const r=c(n,t.x,t.y,a);if(t.params)return void h.push(vn({keys:n.dims,coef:r.coef,rSquared:r.rSquared}));const i=d||Me(n,t.x),f=t=>{const e={};for(let r=0;r<s.length;++r)e[s[r]]=n.dims[r];e[u[0]]=t[0],e[u[1]]=t[1],h.push(vn(e))};"linear"===o?i.forEach(t=>f([t,r.predict(t)])):Ml(r.predict,i,25,200).forEach(f)}),this.value&&(n.rem=this.value),this.value=n.add=n.source=h}return n};const Ek=Math.pow(2,-52),kk=new Uint32Array(512);class Ak{static from(t,e=Mk,n=$k){const r=t.length,i=new Float64Array(2*r);for(let s=0;s<r;s++){const r=t[s];i[2*s]=e(r),i[2*s+1]=n(r)}return new Ak(i)}constructor(t){const e=t.length>>1;if(e>0&&"number"!=typeof t[0])throw new Error("Expected coords to contain numbers.");this.coords=t;const n=Math.max(2*e-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(e)),this._hullPrev=new Uint32Array(e),this._hullNext=new Uint32Array(e),this._hullTri=new Uint32Array(e),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(e),this._dists=new Float64Array(e),this.update()}update(){const{coords:t,_hullPrev:e,_hullNext:n,_hullTri:r,_hullHash:i}=this,s=t.length>>1;let o=1/0,a=1/0,l=-1/0,u=-1/0;for(let E=0;E<s;E++){const e=t[2*E],n=t[2*E+1];e<o&&(o=e),n<a&&(a=n),e>l&&(l=e),n>u&&(u=n),this._ids[E]=E}const c=(o+l)/2,h=(a+u)/2;let d,f,p,m=1/0;for(let E=0;E<s;E++){const e=Dk(c,h,t[2*E],t[2*E+1]);e<m&&(d=E,m=e)}const g=t[2*d],y=t[2*d+1];m=1/0;for(let E=0;E<s;E++){if(E===d)continue;const e=Dk(g,y,t[2*E],t[2*E+1]);e<m&&e>0&&(f=E,m=e)}let v=t[2*f],b=t[2*f+1],x=1/0;for(let E=0;E<s;E++){if(E===d||E===f)continue;const e=Ik(g,y,v,b,t[2*E],t[2*E+1]);e<x&&(p=E,x=e)}let _=t[2*p],w=t[2*p+1];if(x===1/0){for(let r=0;r<s;r++)this._dists[r]=t[2*r]-t[0]||t[2*r+1]-t[1];Rk(this._ids,this._dists,0,s-1);const e=new Uint32Array(s);let n=0;for(let t=0,r=-1/0;t<s;t++){const i=this._ids[t];this._dists[i]>r&&(e[n++]=i,r=this._dists[i])}return this.hull=e.subarray(0,n),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(Tk(g,y,v,b,_,w)){const t=f,e=v,n=b;f=p,v=_,b=w,p=t,_=e,w=n}const S=function(t,e,n,r,i,s){const o=n-t,a=r-e,l=i-t,u=s-e,c=o*o+a*a,h=l*l+u*u,d=.5/(o*u-a*l);return{x:t+(u*c-a*h)*d,y:e+(o*h-l*c)*d}}(g,y,v,b,_,w);this._cx=S.x,this._cy=S.y;for(let E=0;E<s;E++)this._dists[E]=Dk(t[2*E],t[2*E+1],S.x,S.y);Rk(this._ids,this._dists,0,s-1),this._hullStart=d;let C=3;n[d]=e[p]=f,n[f]=e[d]=p,n[p]=e[f]=d,r[d]=0,r[f]=1,r[p]=2,i.fill(-1),i[this._hashKey(g,y)]=d,i[this._hashKey(v,b)]=f,i[this._hashKey(_,w)]=p,this.trianglesLen=0,this._addTriangle(d,f,p,-1,-1,-1);for(let E,k,A=0;A<this._ids.length;A++){const s=this._ids[A],o=t[2*s],a=t[2*s+1];if(A>0&&Math.abs(o-E)<=Ek&&Math.abs(a-k)<=Ek)continue;if(E=o,k=a,s===d||s===f||s===p)continue;let l=0;for(let t=0,e=this._hashKey(o,a);t<this._hashSize&&(l=i[(e+t)%this._hashSize],-1===l||l===n[l]);t++);l=e[l];let u,c=l;for(;u=n[c],!Tk(o,a,t[2*c],t[2*c+1],t[2*u],t[2*u+1]);)if(c=u,c===l){c=-1;break}if(-1===c)continue;let h=this._addTriangle(c,s,n[c],-1,-1,r[c]);r[s]=this._legalize(h+2),r[c]=h,C++;let m=n[c];for(;u=n[m],Tk(o,a,t[2*m],t[2*m+1],t[2*u],t[2*u+1]);)h=this._addTriangle(m,s,u,r[s],-1,r[m]),r[s]=this._legalize(h+2),n[m]=m,C--,m=u;if(c===l)for(;u=e[c],Tk(o,a,t[2*u],t[2*u+1],t[2*c],t[2*c+1]);)h=this._addTriangle(u,s,c,-1,r[c],r[u]),this._legalize(h+2),r[u]=h,n[c]=c,C--,c=u;this._hullStart=e[s]=c,n[c]=e[m]=s,n[s]=m,i[this._hashKey(o,a)]=s,i[this._hashKey(t[2*c],t[2*c+1])]=c}this.hull=new Uint32Array(C);for(let E=0,k=this._hullStart;E<C;E++)this.hull[E]=k,k=n[k];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,e){return Math.floor(function(t,e){const n=t/(Math.abs(t)+Math.abs(e));return(e>0?3-n:1+n)/4}(t-this._cx,e-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:e,_halfedges:n,coords:r}=this;let i=0,s=0;for(;;){const o=n[t],a=t-t%3;if(s=a+(t+2)%3,-1===o){if(0===i)break;t=kk[--i];continue}const l=o-o%3,u=l+(o+2)%3,c=e[s],h=e[t],d=e[a+(t+1)%3],f=e[u];if(Ok(r[2*c],r[2*c+1],r[2*h],r[2*h+1],r[2*d],r[2*d+1],r[2*f],r[2*f+1])){e[t]=f,e[o]=c;const r=n[u];if(-1===r){let e=this._hullStart;do{if(this._hullTri[e]===u){this._hullTri[e]=t;break}e=this._hullPrev[e]}while(e!==this._hullStart)}this._link(t,r),this._link(o,n[s]),this._link(s,u);const a=l+(o+1)%3;i<kk.length&&(kk[i++]=a)}else{if(0===i)break;t=kk[--i]}}return s}_link(t,e){this._halfedges[t]=e,-1!==e&&(this._halfedges[e]=t)}_addTriangle(t,e,n,r,i,s){const o=this.trianglesLen;return this._triangles[o]=t,this._triangles[o+1]=e,this._triangles[o+2]=n,this._link(o,r),this._link(o+1,i),this._link(o+2,s),this.trianglesLen+=3,o}}function Dk(t,e,n,r){const i=t-n,s=e-r;return i*i+s*s}function Nk(t,e,n,r,i,s){const o=(r-e)*(i-t),a=(n-t)*(s-e);return Math.abs(o-a)>=33306690738754716e-32*Math.abs(o+a)?o-a:0}function Tk(t,e,n,r,i,s){return(Nk(i,s,t,e,n,r)||Nk(t,e,n,r,i,s)||Nk(n,r,i,s,t,e))<0}function Ok(t,e,n,r,i,s,o,a){const l=t-o,u=e-a,c=n-o,h=r-a,d=i-o,f=s-a,p=c*c+h*h,m=d*d+f*f;return l*(h*m-p*f)-u*(c*m-p*d)+(l*l+u*u)*(c*f-h*d)<0}function Ik(t,e,n,r,i,s){const o=n-t,a=r-e,l=i-t,u=s-e,c=o*o+a*a,h=l*l+u*u,d=.5/(o*u-a*l),f=(u*c-a*h)*d,p=(o*h-l*c)*d;return f*f+p*p}function Rk(t,e,n,r){if(r-n<=20)for(let i=n+1;i<=r;i++){const r=t[i],s=e[r];let o=i-1;for(;o>=n&&e[t[o]]>s;)t[o+1]=t[o--];t[o+1]=r}else{let i=n+1,s=r;Fk(t,n+r>>1,i),e[t[n]]>e[t[r]]&&Fk(t,n,r),e[t[i]]>e[t[r]]&&Fk(t,i,r),e[t[n]]>e[t[i]]&&Fk(t,n,i);const o=t[i],a=e[o];for(;;){do{i++}while(e[t[i]]<a);do{s--}while(e[t[s]]>a);if(s<i)break;Fk(t,i,s)}t[n+1]=t[s],t[s]=o,r-i+1>=s-n?(Rk(t,e,i,r),Rk(t,e,n,s-1)):(Rk(t,e,n,s-1),Rk(t,e,i,r))}}function Fk(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function Mk(t){return t[0]}function $k(t){return t[1]}class Pk{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,e){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,e){this._+=`L${this._x1=+t},${this._y1=+e}`}arc(t,e,n){const r=(t=+t)+(n=+n),i=e=+e;if(n<0)throw new Error("negative radius");null===this._x1?this._+=`M${r},${i}`:(Math.abs(this._x1-r)>1e-6||Math.abs(this._y1-i)>1e-6)&&(this._+="L"+r+","+i),n&&(this._+=`A${n},${n},0,1,1,${t-n},${e}A${n},${n},0,1,1,${this._x1=r},${this._y1=i}`)}rect(t,e,n,r){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${+n}v${+r}h${-n}Z`}value(){return this._||null}}class zk{constructor(){this._=[]}moveTo(t,e){this._.push([t,e])}closePath(){this._.push(this._[0].slice())}lineTo(t,e){this._.push([t,e])}value(){return this._.length?this._:null}}class Lk{constructor(t,[e,n,r,i]=[0,0,960,500]){if(!((r=+r)>=(e=+e)&&(i=+i)>=(n=+n)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(2*t.points.length),this.vectors=new Float64Array(2*t.points.length),this.xmax=r,this.xmin=e,this.ymax=i,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:e,triangles:n},vectors:r}=this,i=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let d,f,p=0,m=0,g=n.length;p<g;p+=3,m+=2){const e=2*n[p],r=2*n[p+1],s=2*n[p+2],o=t[e],a=t[e+1],l=t[s],u=t[s+1],c=t[r]-o,h=t[r+1]-a,g=l-o,y=u-a,v=c*c+h*h,b=g*g+y*y,x=2*(c*y-h*g);if(x)if(Math.abs(x)<1e-8)d=(o+l)/2,f=(a+u)/2;else{const t=1/x;d=o+(y*v-h*b)*t,f=a+(c*b-g*v)*t}else d=(o+l)/2-1e8*y,f=(a+u)/2+1e8*g;i[m]=d,i[m+1]=f}let s,o,a,l=e[e.length-1],u=4*l,c=t[2*l],h=t[2*l+1];r.fill(0);for(let d=0;d<e.length;++d)l=e[d],s=u,o=c,a=h,u=4*l,c=t[2*l],h=t[2*l+1],r[s+2]=r[u]=a-h,r[s+3]=r[u+1]=c-o}render(t){const e=null==t?t=new Pk:void 0,{delaunay:{halfedges:n,inedges:r,hull:i},circumcenters:s,vectors:o}=this;if(i.length<=1)return null;for(let u=0,c=n.length;u<c;++u){const e=n[u];if(e<u)continue;const r=2*Math.floor(u/3),i=2*Math.floor(e/3);this._renderSegment(s[r],s[r+1],s[i],s[i+1],t)}let a,l=i[i.length-1];for(let u=0;u<i.length;++u){a=l,l=i[u];const e=2*Math.floor(r[l]/3),n=s[e],c=s[e+1],h=4*a,d=this._project(n,c,o[h+2],o[h+3]);d&&this._renderSegment(n,c,d[0],d[1],t)}return e&&e.value()}renderBounds(t){const e=null==t?t=new Pk:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),e&&e.value()}renderCell(t,e){const n=null==e?e=new Pk:void 0,r=this._clip(t);if(null===r||!r.length)return;e.moveTo(r[0],r[1]);let i=r.length;for(;r[0]===r[i-2]&&r[1]===r[i-1]&&i>1;)i-=2;for(let s=2;s<i;s+=2)r[s]===r[s-2]&&r[s+1]===r[s-1]||e.lineTo(r[s],r[s+1]);return e.closePath(),n&&n.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let e=0,n=t.length/2;e<n;++e){const t=this.cellPolygon(e);t&&(t.index=e,yield t)}}cellPolygon(t){const e=new zk;return this.renderCell(t,e),e.value()}_renderSegment(t,e,n,r,i){let s;const o=this._regioncode(t,e),a=this._regioncode(n,r);0===o&&0===a?(i.moveTo(t,e),i.lineTo(n,r)):(s=this._clipSegment(t,e,n,r,o,a))&&(i.moveTo(s[0],s[1]),i.lineTo(s[2],s[3]))}contains(t,e,n){return(e=+e)==e&&(n=+n)==n&&this.delaunay._step(t,e,n)===t}*neighbors(t){const e=this._clip(t);if(e)for(const n of this.delaunay.neighbors(t)){const t=this._clip(n);if(t)t:for(let r=0,i=e.length;r<i;r+=2)for(let s=0,o=t.length;s<o;s+=2)if(e[r]==t[s]&&e[r+1]==t[s+1]&&e[(r+2)%i]==t[(s+o-2)%o]&&e[(r+3)%i]==t[(s+o-1)%o]){yield n;break t}}}_cell(t){const{circumcenters:e,delaunay:{inedges:n,halfedges:r,triangles:i}}=this,s=n[t];if(-1===s)return null;const o=[];let a=s;do{const n=Math.floor(a/3);if(o.push(e[2*n],e[2*n+1]),a=a%3==2?a-2:a+1,i[a]!==t)break;a=r[a]}while(a!==s&&-1!==a);return o}_clip(t){if(0===t&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const e=this._cell(t);if(null===e)return null;const{vectors:n}=this,r=4*t;return n[r]||n[r+1]?this._clipInfinite(t,e,n[r],n[r+1],n[r+2],n[r+3]):this._clipFinite(t,e)}_clipFinite(t,e){const n=e.length;let r,i,s,o,a,l=null,u=e[n-2],c=e[n-1],h=this._regioncode(u,c);for(let d=0;d<n;d+=2)if(r=u,i=c,u=e[d],c=e[d+1],s=h,h=this._regioncode(u,c),0===s&&0===h)o=a,a=0,l?l.push(u,c):l=[u,c];else{let e,n,d,f,p;if(0===s){if(null===(e=this._clipSegment(r,i,u,c,s,h)))continue;[n,d,f,p]=e}else{if(null===(e=this._clipSegment(u,c,r,i,h,s)))continue;[f,p,n,d]=e,o=a,a=this._edgecode(n,d),o&&a&&this._edge(t,o,a,l,l.length),l?l.push(n,d):l=[n,d]}o=a,a=this._edgecode(f,p),o&&a&&this._edge(t,o,a,l,l.length),l?l.push(f,p):l=[f,p]}if(l)o=a,a=this._edgecode(l[0],l[1]),o&&a&&this._edge(t,o,a,l,l.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return l}_clipSegment(t,e,n,r,i,s){for(;;){if(0===i&&0===s)return[t,e,n,r];if(i&s)return null;let o,a,l=i||s;8&l?(o=t+(n-t)*(this.ymax-e)/(r-e),a=this.ymax):4&l?(o=t+(n-t)*(this.ymin-e)/(r-e),a=this.ymin):2&l?(a=e+(r-e)*(this.xmax-t)/(n-t),o=this.xmax):(a=e+(r-e)*(this.xmin-t)/(n-t),o=this.xmin),i?i=this._regioncode(t=o,e=a):s=this._regioncode(n=o,r=a)}}_clipInfinite(t,e,n,r,i,s){let o,a=Array.from(e);if((o=this._project(a[0],a[1],n,r))&&a.unshift(o[0],o[1]),(o=this._project(a[a.length-2],a[a.length-1],i,s))&&a.push(o[0],o[1]),a=this._clipFinite(t,a))for(let l,u=0,c=a.length,h=this._edgecode(a[c-2],a[c-1]);u<c;u+=2)l=h,h=this._edgecode(a[u],a[u+1]),l&&h&&(u=this._edge(t,l,h,a,u),c=a.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(t,e,n,r,i){for(;e!==n;){let n,s;switch(e){case 5:e=4;continue;case 4:e=6,n=this.xmax,s=this.ymin;break;case 6:e=2;continue;case 2:e=10,n=this.xmax,s=this.ymax;break;case 10:e=8;continue;case 8:e=9,n=this.xmin,s=this.ymax;break;case 9:e=1;continue;case 1:e=5,n=this.xmin,s=this.ymin}r[i]===n&&r[i+1]===s||!this.contains(t,n,s)||(r.splice(i,0,n,s),i+=2)}if(r.length>4)for(let s=0;s<r.length;s+=2){const t=(s+2)%r.length,e=(s+4)%r.length;(r[s]===r[t]&&r[t]===r[e]||r[s+1]===r[t+1]&&r[t+1]===r[e+1])&&(r.splice(t,2),s-=2)}return i}_project(t,e,n,r){let i,s,o,a=1/0;if(r<0){if(e<=this.ymin)return null;(i=(this.ymin-e)/r)<a&&(o=this.ymin,s=t+(a=i)*n)}else if(r>0){if(e>=this.ymax)return null;(i=(this.ymax-e)/r)<a&&(o=this.ymax,s=t+(a=i)*n)}if(n>0){if(t>=this.xmax)return null;(i=(this.xmax-t)/n)<a&&(s=this.xmax,o=e+(a=i)*r)}else if(n<0){if(t<=this.xmin)return null;(i=(this.xmin-t)/n)<a&&(s=this.xmin,o=e+(a=i)*r)}return[s,o]}_edgecode(t,e){return(t===this.xmin?1:t===this.xmax?2:0)|(e===this.ymin?4:e===this.ymax?8:0)}_regioncode(t,e){return(t<this.xmin?1:t>this.xmax?2:0)|(e<this.ymin?4:e>this.ymax?8:0)}}const Bk=2*Math.PI,jk=Math.pow;function Uk(t){return t[0]}function Vk(t){return t[1]}function Wk(t,e,n){return[t+Math.sin(t+e)*n,e+Math.cos(t-e)*n]}class qk{static from(t,e=Uk,n=Vk,r){return new qk("length"in t?function(t,e,n,r){const i=t.length,s=new Float64Array(2*i);for(let o=0;o<i;++o){const i=t[o];s[2*o]=e.call(r,i,o,t),s[2*o+1]=n.call(r,i,o,t)}return s}(t,e,n,r):Float64Array.from(function*(t,e,n,r){let i=0;for(const s of t)yield e.call(r,s,i,t),yield n.call(r,s,i,t),++i}(t,e,n,r)))}constructor(t){this._delaunator=new Ak(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,e=this.points;if(t.hull&&t.hull.length>2&&function(t){const{triangles:e,coords:n}=t;for(let r=0;r<e.length;r+=3){const t=2*e[r],i=2*e[r+1],s=2*e[r+2];if((n[s]-n[t])*(n[i+1]-n[t+1])-(n[i]-n[t])*(n[s+1]-n[t+1])>1e-10)return!1}return!0}(t)){this.collinear=Int32Array.from({length:e.length/2},(t,e)=>e).sort((t,n)=>e[2*t]-e[2*n]||e[2*t+1]-e[2*n+1]);const t=this.collinear[0],n=this.collinear[this.collinear.length-1],r=[e[2*t],e[2*t+1],e[2*n],e[2*n+1]],i=1e-8*Math.hypot(r[3]-r[1],r[2]-r[0]);for(let s=0,o=e.length/2;s<o;++s){const t=Wk(e[2*s],e[2*s+1],i);e[2*s]=t[0],e[2*s+1]=t[1]}this._delaunator=new Ak(e)}else delete this.collinear;const n=this.halfedges=this._delaunator.halfedges,r=this.hull=this._delaunator.hull,i=this.triangles=this._delaunator.triangles,s=this.inedges.fill(-1),o=this._hullIndex.fill(-1);for(let a=0,l=n.length;a<l;++a){const t=i[a%3==2?a-2:a+1];-1!==n[a]&&-1!==s[t]||(s[t]=a)}for(let a=0,l=r.length;a<l;++a)o[r[a]]=a;r.length<=2&&r.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=r[0],this.triangles[1]=r[1],this.triangles[2]=r[1],s[r[0]]=1,2===r.length&&(s[r[1]]=0))}voronoi(t){return new Lk(this,t)}*neighbors(t){const{inedges:e,hull:n,_hullIndex:r,halfedges:i,triangles:s,collinear:o}=this;if(o){const e=o.indexOf(t);return e>0&&(yield o[e-1]),void(e<o.length-1&&(yield o[e+1]))}const a=e[t];if(-1===a)return;let l=a,u=-1;do{if(yield u=s[l],l=l%3==2?l-2:l+1,s[l]!==t)return;if(l=i[l],-1===l){const e=n[(r[t]+1)%n.length];return void(e!==u&&(yield e))}}while(l!==a)}find(t,e,n=0){if((t=+t)!=t||(e=+e)!=e)return-1;const r=n;let i;for(;(i=this._step(n,t,e))>=0&&i!==n&&i!==r;)n=i;return i}_step(t,e,n){const{inedges:r,hull:i,_hullIndex:s,halfedges:o,triangles:a,points:l}=this;if(-1===r[t]||!l.length)return(t+1)%(l.length>>1);let u=t,c=jk(e-l[2*t],2)+jk(n-l[2*t+1],2);const h=r[t];let d=h;do{let r=a[d];const h=jk(e-l[2*r],2)+jk(n-l[2*r+1],2);if(h<c&&(c=h,u=r),d=d%3==2?d-2:d+1,a[d]!==t)break;if(d=o[d],-1===d){if(d=i[(s[t]+1)%i.length],d!==r&&jk(e-l[2*d],2)+jk(n-l[2*d+1],2)<c)return d;break}}while(d!==h);return u}render(t){const e=null==t?t=new Pk:void 0,{points:n,halfedges:r,triangles:i}=this;for(let s=0,o=r.length;s<o;++s){const e=r[s];if(e<s)continue;const o=2*i[s],a=2*i[e];t.moveTo(n[o],n[o+1]),t.lineTo(n[a],n[a+1])}return this.renderHull(t),e&&e.value()}renderPoints(t,e=2){const n=null==t?t=new Pk:void 0,{points:r}=this;for(let i=0,s=r.length;i<s;i+=2){const n=r[i],s=r[i+1];t.moveTo(n+e,s),t.arc(n,s,e,0,Bk)}return n&&n.value()}renderHull(t){const e=null==t?t=new Pk:void 0,{hull:n,points:r}=this,i=2*n[0],s=n.length;t.moveTo(r[i],r[i+1]);for(let o=1;o<s;++o){const e=2*n[o];t.lineTo(r[e],r[e+1])}return t.closePath(),e&&e.value()}hullPolygon(){const t=new zk;return this.renderHull(t),t.value()}renderTriangle(t,e){const n=null==e?e=new Pk:void 0,{points:r,triangles:i}=this,s=2*i[t*=3],o=2*i[t+1],a=2*i[t+2];return e.moveTo(r[s],r[s+1]),e.lineTo(r[o],r[o+1]),e.lineTo(r[a],r[a+1]),e.closePath(),n&&n.value()}*trianglePolygons(){const{triangles:t}=this;for(let e=0,n=t.length/3;e<n;++e)yield this.trianglePolygon(e)}trianglePolygon(t){const e=new zk;return this.renderTriangle(t,e),e.value()}}function Hk(t){ba.call(this,null,t)}Hk.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const Gk=Ue(Hk,ba),Yk=[-1e5,-1e5,1e5,1e5];function Kk(t){const e=t[0][0],n=t[0][1];let r=t.length-1;for(;t[r][0]===e&&t[r][1]===n;--r);return"M"+t.slice(0,r+1).join("L")+"Z"}Gk.transform=function(t,e){const n=t.as||"path",r=e.source;if(!r||!r.length)return e;let i=t.size;i=i?[0,0,i[0],i[1]]:(i=t.extent)?[i[0][0],i[0][1],i[1][0],i[1][1]]:Yk;const s=this.value=qk.from(r,t.x,t.y).voronoi(i);for(let o=0,a=r.length;o<a;++o){const t=s.cellPolygon(o);r[o][n]=t?Kk(t):null}return e.reflow(t.modified()).modifies(n)};var Xk=Math.PI/180;function Zk(t,e,n,r){if(!e.sprite){var i=t.context,s=t.ratio;i.clearRect(0,0,2048/s,2048/s);var o,a,l,u,c,h=0,d=0,f=0,p=n.length;for(--r;++r<p;){if(e=n[r],i.save(),i.font=e.style+" "+e.weight+" "+~~((e.size+1)/s)+"px "+e.font,o=i.measureText(e.text+"m").width*s,l=e.size<<1,e.rotate){var m=Math.sin(e.rotate*Xk),g=Math.cos(e.rotate*Xk),y=o*g,v=o*m,b=l*g,x=l*m;o=Math.max(Math.abs(y+x),Math.abs(y-x))+31>>5<<5,l=~~Math.max(Math.abs(v+b),Math.abs(v-b))}else o=o+31>>5<<5;if(l>f&&(f=l),h+o>=2048&&(h=0,d+=f,f=0),d+l>=2048)break;i.translate((h+(o>>1))/s,(d+(l>>1))/s),e.rotate&&i.rotate(e.rotate*Xk),i.fillText(e.text,0,0),e.padding&&(i.lineWidth=2*e.padding,i.strokeText(e.text,0,0)),i.restore(),e.width=o,e.height=l,e.xoff=h,e.yoff=d,e.x1=o>>1,e.y1=l>>1,e.x0=-e.x1,e.y0=-e.y1,e.hasText=!0,h+=o}for(var _=i.getImageData(0,0,2048/s,2048/s).data,w=[];--r>=0;)if((e=n[r]).hasText){for(a=(o=e.width)>>5,l=e.y1-e.y0,u=0;u<l*a;u++)w[u]=0;if(null==(h=e.xoff))return;d=e.yoff;var S=0,C=-1;for(c=0;c<l;c++){for(u=0;u<o;u++){var E=_[2048*(d+c)+(h+u)<<2]?1<<31-u%32:0;w[a*c+(u>>5)]|=E,S|=E}S?C=c:(e.y0++,l--,c--,d++)}e.y1=e.y0+C,e.sprite=w.slice(0,(e.y1-e.y0)*a)}}}function Qk(t,e,n){for(var r,i=t.sprite,s=t.width>>5,o=t.x-(s<<4),a=127&o,l=32-a,u=t.y1-t.y0,c=(t.y+t.y0)*(n>>=5)+(o>>5),h=0;h<u;h++){r=0;for(var d=0;d<=s;d++)if((r<<l|(d<s?(r=i[h*s+d])>>>a:0))&e[c+d])return!0;c+=n}return!1}function Jk(t,e){var n=t[0],r=t[1];e.x+e.x0<n.x&&(n.x=e.x+e.x0),e.y+e.y0<n.y&&(n.y=e.y+e.y0),e.x+e.x1>r.x&&(r.x=e.x+e.x1),e.y+e.y1>r.y&&(r.y=e.y+e.y1)}function tA(t){var e=t[0]/t[1];return function(t){return[e*(t*=.1)*Math.cos(t),t*Math.sin(t)]}}function eA(t){return"function"==typeof t?t:function(){return t}}var nA={archimedean:tA,rectangular:function(t){var e=4*t[0]/t[1],n=0,r=0;return function(t){var i=t<0?-1:1;switch(Math.sqrt(1+4*i*t)-i&3){case 0:n+=e;break;case 1:r+=4;break;case 2:n-=e;break;default:r-=4}return[n,r]}}},rA=["x","y","font","fontSize","fontStyle","fontWeight","angle"],iA=["text","font","rotate","fontSize","fontStyle","fontWeight"];function sA(t){ba.call(this,function(){var t,e,n,r,i,s,o,a=[256,256],l=tA,u=[],c=Math.random,h={};function d(t,e,n){for(var r,i,s,o,u,h=e.x,d=e.y,f=Math.sqrt(a[0]*a[0]+a[1]*a[1]),p=l(a),m=c()<.5?1:-1,g=-m;(r=p(g+=m))&&(i=~~r[0],s=~~r[1],!(Math.min(Math.abs(i),Math.abs(s))>=f));)if(e.x=h+i,e.y=d+s,!(e.x+e.x0<0||e.y+e.y0<0||e.x+e.x1>a[0]||e.y+e.y1>a[1]||n&&Qk(e,t,a[0])||n&&!((o=e).x+o.x1>(u=n)[0].x&&o.x+o.x0<u[1].x&&o.y+o.y1>u[0].y&&o.y+o.y0<u[1].y))){for(var y,v=e.sprite,b=e.width>>5,x=a[0]>>5,_=e.x-(b<<4),w=127&_,S=32-w,C=e.y1-e.y0,E=(e.y+e.y0)*x+(_>>5),k=0;k<C;k++){y=0;for(var A=0;A<=b;A++)t[E+A]|=y<<S|(A<b?(y=v[k*b+A])>>>w:0);E+=x}return e.sprite=null,!0}return!1}return h.layout=function(){for(var l=function(t){t.width=t.height=1;var e=Math.sqrt(t.getContext("2d").getImageData(0,0,1,1).data.length>>2);t.width=2048/e,t.height=2048/e;var n=t.getContext("2d");return n.fillStyle=n.strokeStyle="red",n.textAlign="center",{context:n,ratio:e}}(xd()),h=function(t){for(var e=[],n=-1;++n<t;)e[n]=0;return e}((a[0]>>5)*a[1]),f=null,p=u.length,m=-1,g=[],y=u.map((function(a){return{text:t(a),font:e(a),style:r(a),weight:i(a),rotate:s(a),size:~~(n(a)+1e-14),padding:o(a),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:a}})).sort((function(t,e){return e.size-t.size}));++m<p;){var v=y[m];v.x=a[0]*(c()+.5)>>1,v.y=a[1]*(c()+.5)>>1,Zk(l,v,y,m),v.hasText&&d(h,v,f)&&(g.push(v),f?Jk(f,v):f=[{x:v.x+v.x0,y:v.y+v.y0},{x:v.x+v.x1,y:v.y+v.y1}],v.x-=a[0]>>1,v.y-=a[1]>>1)}return g},h.words=function(t){return arguments.length?(u=t,h):u},h.size=function(t){return arguments.length?(a=[+t[0],+t[1]],h):a},h.font=function(t){return arguments.length?(e=eA(t),h):e},h.fontStyle=function(t){return arguments.length?(r=eA(t),h):r},h.fontWeight=function(t){return arguments.length?(i=eA(t),h):i},h.rotate=function(t){return arguments.length?(s=eA(t),h):s},h.text=function(e){return arguments.length?(t=eA(e),h):t},h.spiral=function(t){return arguments.length?(l=nA[t]||t,h):l},h.fontSize=function(t){return arguments.length?(n=eA(t),h):n},h.padding=function(t){return arguments.length?(o=eA(t),h):o},h.random=function(t){return arguments.length?(c=t,h):c},h}(),t)}function oA(t){return new Uint8Array(t)}function aA(t){return new Uint16Array(t)}function lA(t){return new Uint32Array(t)}function uA(t,e,n){var r=(e<257?oA:e<65537?aA:lA)(t);return n&&r.set(n),r}sA.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:rA}]},Ue(sA,ba).transform=function(t,e){!t.size||t.size[0]&&t.size[1]||$t("Wordcloud size dimensions must be non-zero.");var n=t.modified();if(n||e.changed(e.ADD_REM)||iA.some((function(n){var r=t[n];return ke(r)&&e.modified(r.fields)}))){var r,i=e.materialize(e.SOURCE).source,s=this.value,o=t.as||rA,a=t.fontSize||14;if(ke(a)?r=t.fontSizeRange:a=Ie(a),r){var l=a,u=Xg("sqrt")().domain(Me(i,l)).range(r);a=function(t){return u(l(t))}}i.forEach((function(t){t[o[0]]=NaN,t[o[1]]=NaN,t[o[3]]=0}));for(var c,h,d=s.words(i).text(t.text).size(t.size||[500,500]).padding(t.padding||1).spiral(t.spiral||"archimedean").rotate(t.rotate||0).font(t.font||"sans-serif").fontStyle(t.fontStyle||"normal").fontWeight(t.fontWeight||"normal").fontSize(a).random(Ga).layout(),f=s.size(),p=f[0]>>1,m=f[1]>>1,g=0,y=d.length;g<y;++g)(h=(c=d[g]).datum)[o[0]]=c.x+p,h[o[1]]=c.y+m,h[o[2]]=c.font,h[o[3]]=c.size,h[o[4]]=c.style,h[o[5]]=c.weight,h[o[6]]=c.rotate;return e.reflow(n).modifies(o)}};var cA=function(t,e,n){var r=1<<e;return{one:r,zero:~r,range:n.slice(),bisect:t.bisect,index:t.index,size:t.size,onAdd:function(t,e){var n,i=this.bisect(this.range,t.value),s=t.index,o=i[0],a=i[1],l=s.length;for(n=0;n<o;++n)e[s[n]]|=r;for(n=a;n<l;++n)e[s[n]]|=r;return this}}};function hA(){var t=lA(0),e=[],n=0;return{insert:function(r,i,s){if(!i.length)return[];var o,a,l,u=n,c=i.length,h=Array(c),d=lA(c);for(l=0;l<c;++l)h[l]=r(i[l]),d[l]=l;if(h=function(t,e){return t.sort.call(e,(function(e,n){var r=t[e],i=t[n];return r<i?-1:r>i?1:0})),n=t,Array.from(e,t=>n[t]);var n}(h,d),u)o=e,a=t,e=Array(u+c),t=lA(u+c),function(t,e,n,r,i,s,o,a,l){var u,c=0,h=0;for(u=0;c<r&&h<o;++u)e[c]<i[h]?(a[u]=e[c],l[u]=n[c++]):(a[u]=i[h],l[u]=s[h++]+t);for(;c<r;++c,++u)a[u]=e[c],l[u]=n[c];for(;h<o;++h,++u)a[u]=i[h],l[u]=s[h]+t}(s,o,a,u,h,d,c,e,t);else{if(s>0)for(l=0;l<c;++l)d[l]+=s;e=h,t=d}return n=u+c,{index:d,value:h}},remove:function(r,i){var s,o,a,l=n;for(o=0;!i[t[o]]&&o<l;++o);for(a=o;o<l;++o)i[s=t[o]]||(t[a]=s,e[a]=e[o],++a);n=l-r},bisect:function(t,r){var i;return r?i=r.length:(r=e,i=n),[em(r,t[0],0,i),tm(r,t[1],0,i)]},reindex:function(e){for(var r=0,i=n;r<i;++r)t[r]=e[t[r]]},index:function(){return t},size:function(){return n}}}function dA(t){var e,n,r,i,s;ba.call(this,(e=8,n=[],r=lA(0),i=uA(0,e),s=uA(0,e),{data:function(){return n},seen:function(){return r=(t=r).length>=(e=n.length)?t:((i=i||new t.constructor(e)).set(t),i);var t,e,i},add:function(t){for(var e,r=0,i=n.length,s=t.length;r<s;++r)(e=t[r])._index=i++,n.push(e)},remove:function(t,e){var r,o,a,l=n.length,u=Array(l-t),c=n;for(o=0;!e[o]&&o<l;++o)u[o]=n[o],c[o]=o;for(a=o;o<l;++o)r=n[o],e[o]?c[o]=-1:(c[o]=a,i[a]=i[o],s[a]=s[o],u[a]=r,r._index=a++),i[o]=0;return n=u,c},size:function(){return n.length},curr:function(){return i},prev:function(){return s},reset:function(t){s[t]=i[t]},all:function(){return e<257?255:e<65537?65535:4294967295},set:function(t,e){i[t]|=e},clear:function(t,e){i[t]&=~e},resize:function(t,n){(t>i.length||n>e)&&(e=Math.max(n,e),i=uA(t,e,i),s=uA(t,e))}}),t),this._indices=null,this._dims=null}dA.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]};var fA=Ue(dA,ba);function pA(t){ba.call(this,null,t)}fA.transform=function(t,e){return this._dims?t.modified("fields")||t.fields.some((function(t){return e.modified(t.fields)}))?this.reinit(t,e):this.eval(t,e):this.init(t,e)},fA.init=function(t,e){for(var n,r,i=t.fields,s=t.query,o=this._indices={},a=this._dims=[],l=s.length,u=0;u<l;++u)r=o[n=i[u].fname]||(o[n]=hA()),a.push(cA(r,u,s[u]));return this.eval(t,e)},fA.reinit=function(t,e){var n,r,i,s,o,a,l,u,c,h=e.materialize().fork(),d=t.fields,f=t.query,p=this._indices,m=this._dims,g=this.value,y=g.curr(),v=g.prev(),b=g.all(),x=h.rem=h.add,_=h.mod,w=f.length,S={};if(v.set(y),e.rem.length&&(o=this.remove(t,e,h)),e.add.length&&g.add(e.add),e.mod.length)for(a={},l=0,u=(s=e.mod).length;l<u;++l)a[s[l]._index]=1;for(l=0;l<w;++l)c=d[l],(!m[l]||t.modified("fields",l)||e.modified(c.fields))&&((n=S[i=c.fname])||(p[i]=r=hA(),S[i]=n=r.insert(c,e.source,0)),m[l]=cA(r,l,f[l]).onAdd(n,y));for(l=0,u=g.data().length;l<u;++l)o[l]||(v[l]!==y[l]?x.push(l):a[l]&&y[l]!==b&&_.push(l));return g.mask=(1<<w)-1,h},fA.eval=function(t,e){var n=e.materialize().fork(),r=this._dims.length,i=0;return e.rem.length&&(this.remove(t,e,n),i|=(1<<r)-1),t.modified("query")&&!t.modified("fields")&&(i|=this.update(t,e,n)),e.add.length&&(this.insert(t,e,n),i|=(1<<r)-1),e.mod.length&&(this.modify(e,n),i|=(1<<r)-1),this.value.mask=i,n},fA.insert=function(t,e,n){var r,i,s,o=e.add,a=this.value,l=this._dims,u=this._indices,c=t.fields,h={},d=n.add,f=a.size(),p=f+o.length,m=l.length;a.resize(p,m),a.add(o);var g=a.curr(),y=a.prev(),v=a.all();for(r=0;r<m;++r)s=h[i=c[r].fname]||(h[i]=u[i].insert(c[r],o,f)),l[r].onAdd(s,g);for(;f<p;++f)y[f]=v,g[f]!==v&&d.push(f)},fA.modify=function(t,e){var n,r,i,s=e.mod,o=this.value,a=o.curr(),l=o.all(),u=t.mod;for(n=0,r=u.length;n<r;++n)a[i=u[n]._index]!==l&&s.push(i)},fA.remove=function(t,e,n){var r,i,s,o,a=this._indices,l=this.value,u=l.curr(),c=l.prev(),h=l.all(),d={},f=n.rem,p=e.rem;for(r=0,i=p.length;r<i;++r)d[s=p[r]._index]=1,c[s]=o=u[s],u[s]=h,o!==h&&f.push(s);for(s in a)a[s].remove(i,d);return this.reindex(e,i,d),d},fA.reindex=function(t,e,n){var r=this._indices,i=this.value;t.runAfter((function(){var t=i.remove(e,n);for(var s in r)r[s].reindex(t)}))},fA.update=function(t,e,n){var r,i,s=this._dims,o=t.query,a=e.stamp,l=s.length,u=0;for(n.filters=0,i=0;i<l;++i)t.modified("query",i)&&(r=i,++u);if(1===u)u=s[r].one,this.incrementOne(s[r],o[r],n.add,n.rem);else for(i=0,u=0;i<l;++i)t.modified("query",i)&&(u|=s[i].one,this.incrementAll(s[i],o[i],a,n.add),n.rem=n.add);return u},fA.incrementAll=function(t,e,n,r){var i,s,o,a=this.value,l=a.seen(),u=a.curr(),c=a.prev(),h=t.index(),d=t.bisect(t.range),f=t.bisect(e),p=f[0],m=f[1],g=d[0],y=d[1],v=t.one;if(p<g)for(i=p,s=Math.min(g,m);i<s;++i)l[o=h[i]]!==n&&(c[o]=u[o],l[o]=n,r.push(o)),u[o]^=v;else if(p>g)for(i=g,s=Math.min(p,y);i<s;++i)l[o=h[i]]!==n&&(c[o]=u[o],l[o]=n,r.push(o)),u[o]^=v;if(m>y)for(i=Math.max(p,y),s=m;i<s;++i)l[o=h[i]]!==n&&(c[o]=u[o],l[o]=n,r.push(o)),u[o]^=v;else if(m<y)for(i=Math.max(g,m),s=y;i<s;++i)l[o=h[i]]!==n&&(c[o]=u[o],l[o]=n,r.push(o)),u[o]^=v;t.range=e.slice()},fA.incrementOne=function(t,e,n,r){var i,s,o,a=this.value.curr(),l=t.index(),u=t.bisect(t.range),c=t.bisect(e),h=c[0],d=c[1],f=u[0],p=u[1],m=t.one;if(h<f)for(i=h,s=Math.min(f,d);i<s;++i)a[o=l[i]]^=m,n.push(o);else if(h>f)for(i=f,s=Math.min(h,p);i<s;++i)a[o=l[i]]^=m,r.push(o);if(d>p)for(i=Math.max(h,p),s=d;i<s;++i)a[o=l[i]]^=m,n.push(o);else if(d<p)for(i=Math.max(f,d),s=p;i<s;++i)a[o=l[i]]^=m,r.push(o);t.range=e.slice()},pA.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]},Ue(pA,ba).transform=function(t,e){var n=~(t.ignore||0),r=t.filter,i=r.mask;if(0==(i&n))return e.StopPropagation;var s=e.fork(e.ALL),o=r.data(),a=r.curr(),l=r.prev(),u=function(t){return a[t]&n?null:o[t]};return s.filter(s.MOD,u),i&i-1?(s.filter(s.ADD,(function(t){var e=a[t]&n;return!e&&e^l[t]&n?o[t]:null})),s.filter(s.REM,(function(t){var e=a[t]&n;return!e||e^e^l[t]&n?null:o[t]}))):(s.filter(s.ADD,u),s.filter(s.REM,(function(t){return(a[t]&n)===i?o[t]:null}))),s.filter(s.SOURCE,(function(t){return u(t._index)}))};var mA=n("8WEG");function gA(t,e){t&&(null==e?t.removeAttribute("aria-label"):t.setAttribute("aria-label",e))}function yA(t,e){const n=t.globalCursor()?"undefined"!=typeof document&&document.body:t.container();if(n)return null==e?n.style.removeProperty("cursor"):n.style.cursor=e}function vA(t,e){var n=t._runtime.data;return ze(n,e)||$t("Unrecognized data set: "+e),n[e]}function bA(t,e){Sn(e)||$t("Second argument to changes must be a changeset.");var n=vA(this,t);return n.modified=!0,this.pulse(n.input,e)}function xA(t){var e=t.padding();return Math.max(0,t._viewWidth+e.left+e.right)}function _A(t){var e=t.padding();return Math.max(0,t._viewHeight+e.top+e.bottom)}function wA(t){var e=t.padding(),n=t._origin;return[e.left+n[0],e.top+n[1]]}const SA={trap:!1};function CA(t,e,n){const r=t._eventConfig&&t._eventConfig[e];return!(!1===r||te(r)&&!r[n])||(t.warn(`Blocked ${e} ${n} event listener.`),!1)}function EA(t){return t.item}function kA(t){return t.item.mark.source}function AA(t){return function(e,n){return n.vega.view().changeset().encode(n.item,t)}}var DA=function(t,e,n){var r=document.createElement(t);for(var i in e)r.setAttribute(i,e[i]);return null!=n&&(r.textContent=n),r};function NA(t,e,n,r){const i=DA("input");for(const s in n)"signal"!==s&&"element"!==s&&i.setAttribute("input"===s?"type":s,n[s]);i.setAttribute("name",n.signal),i.value=r,e.appendChild(i),i.addEventListener("input",()=>t.update(i.value)),t.elements=[i],t.set=t=>i.value=t}function TA(t,e,n,r){const i={type:"checkbox",name:n.signal};r&&(i.checked=!0);const s=DA("input",i);e.appendChild(s),s.addEventListener("change",()=>t.update(s.checked)),t.elements=[s],t.set=t=>s.checked=!!t||null}function OA(t,e,n,r){const i=DA("select",{name:n.signal}),s=n.labels||[];n.options.forEach((t,e)=>{const n={value:t};FA(t,r)&&(n.selected=!0),i.appendChild(DA("option",n,(s[e]||t)+""))}),e.appendChild(i),i.addEventListener("change",()=>{t.update(n.options[i.selectedIndex])}),t.elements=[i],t.set=t=>{for(let e=0,r=n.options.length;e<r;++e)if(FA(n.options[e],t))return void(i.selectedIndex=e)}}function IA(t,e,n,r){const i=DA("span",{class:"vega-bind-radio"}),s=n.labels||[];e.appendChild(i),t.elements=n.options.map((e,o)=>{const a={type:"radio",name:n.signal,value:e};FA(e,r)&&(a.checked=!0);const l=DA("input",a);l.addEventListener("change",()=>t.update(e));const u=DA("label",{},(s[o]||e)+"");return u.prepend(l),i.appendChild(u),l}),t.set=e=>{const n=t.elements,r=n.length;for(let t=0;t<r;++t)FA(n[t].value,e)&&(n[t].checked=!0)}}function RA(t,e,n,r){r=void 0!==r?r:(+n.max+ +n.min)/2;const i=null!=n.max?n.max:Math.max(100,+r)||100,s=n.min||Math.min(0,i,+r)||0,o=n.step||Er(s,i,100),a=DA("input",{type:"range",name:n.signal,min:s,max:i,step:o});a.value=r;const l=DA("span",{},+r);e.appendChild(a),e.appendChild(l);const u=()=>{l.textContent=a.value,t.update(+a.value)};a.addEventListener("input",u),a.addEventListener("change",u),t.elements=[a],t.set=t=>{a.value=t,l.textContent=t}}function FA(t,e){return t===e||t+""==e+""}var MA=function(t,e,n,r,i,s){return(e=e||new r(t.loader())).initialize(n,xA(t),_A(t),wA(t),i,s).background(t.background())},$A=function(t,e){return e?function(){try{e.apply(this,arguments)}catch(n){t.error(n)}}:null};function PA(t,e){if("string"==typeof e){if("undefined"==typeof document)return t.error("DOM document instance not found."),null;if(!(e=document.querySelector(e)))return t.error("Signal bind element not found: "+e),null}if(e)try{e.innerHTML=""}catch(n){e=null,t.error(n)}return e}const zA=t=>+t||0;var LA=function(t){return te(t)?{top:zA(t.top),bottom:zA(t.bottom),left:zA(t.left),right:zA(t.right)}:(t=>({top:t,bottom:t,left:t,right:t}))(zA(t))},BA=async function(t,e,n,r){const i=nb(e),s=i&&i.headless;return s||$t("Unrecognized renderer type: "+e),await t.runAsync(),MA(t,null,null,s,n,r).renderAsync(t._scenegraph.root)};function jA(t){const e=this.context.data[t];return e?e.values.value:[]}const UA=t=>function(e,n){return this.context.dataflow.locale()[t](n)(e)},VA=UA("format"),WA=UA("timeFormat"),qA=UA("utcFormat"),HA=UA("timeParse"),GA=UA("utcParse");var YA,KA,XA,ZA,QA,JA=new Date(2e3,0,1);function tD(t,e,n){return Number.isInteger(t)&&Number.isInteger(e)?(JA.setYear(2e3),JA.setMonth(t),JA.setDate(e),WA.call(this,JA,n)):""}function eD(t){this.type=t}eD.prototype.visit=function(t){var e,n,r;if(t(this))return 1;for(n=0,r=(e=function(t){switch(t.type){case"ArrayExpression":return t.elements;case"BinaryExpression":case"LogicalExpression":return[t.left,t.right];case"CallExpression":var e=t.arguments.slice();return e.unshift(t.callee),e;case"ConditionalExpression":return[t.test,t.consequent,t.alternate];case"MemberExpression":return[t.object,t.property];case"ObjectExpression":return t.properties;case"Property":return[t.key,t.value];case"UnaryExpression":return[t.argument];case"Identifier":case"Literal":case"RawCode":default:return[]}}(this)).length;n<r;++n)if(e[n].visit(t))return 1},(YA={})[1]="Boolean",YA[2]="<end>",YA[3]="Identifier",YA[4]="Keyword",YA[5]="Null",YA[6]="Numeric",YA[7]="Punctuator",YA[8]="String",YA[9]="RegularExpression";var nD="ILLEGAL",rD=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),iD=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function sD(t,e){if(!t)throw new Error("ASSERT: "+e)}function oD(t){return t>=48&&t<=57}function aD(t){return"0123456789abcdefABCDEF".indexOf(t)>=0}function lD(t){return"01234567".indexOf(t)>=0}function uD(t){return 32===t||9===t||11===t||12===t||160===t||t>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(t)>=0}function cD(t){return 10===t||13===t||8232===t||8233===t}function hD(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||92===t||t>=128&&rD.test(String.fromCharCode(t))}function dD(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||92===t||t>=128&&iD.test(String.fromCharCode(t))}var fD={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function pD(){for(var t;XA<ZA&&(uD(t=KA.charCodeAt(XA))||cD(t));)++XA}function mD(t){var e,n,r,i=0;for(n="u"===t?4:2,e=0;e<n;++e)XA<ZA&&aD(KA[XA])?(r=KA[XA++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):DD({},"Unexpected token %0",nD);return String.fromCharCode(i)}function gD(){var t,e;for(e=0,"}"===(t=KA[XA])&&DD({},"Unexpected token %0",nD);XA<ZA&&aD(t=KA[XA++]);)e=16*e+"0123456789abcdef".indexOf(t.toLowerCase());return(e>1114111||"}"!==t)&&DD({},"Unexpected token %0",nD),e<=65535?String.fromCharCode(e):String.fromCharCode(55296+(e-65536>>10),56320+(e-65536&1023))}function yD(){var t,e;for(t=KA.charCodeAt(XA++),e=String.fromCharCode(t),92===t&&(117!==KA.charCodeAt(XA)&&DD({},"Unexpected token %0",nD),++XA,(t=mD("u"))&&"\\"!==t&&hD(t.charCodeAt(0))||DD({},"Unexpected token %0",nD),e=t);XA<ZA&&dD(t=KA.charCodeAt(XA));)++XA,e+=String.fromCharCode(t),92===t&&(e=e.substr(0,e.length-1),117!==KA.charCodeAt(XA)&&DD({},"Unexpected token %0",nD),++XA,(t=mD("u"))&&"\\"!==t&&dD(t.charCodeAt(0))||DD({},"Unexpected token %0",nD),e+=t);return e}function vD(){var t,e,n,r,i=XA,s=KA.charCodeAt(XA),o=KA[XA];switch(s){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++XA,{type:7,value:String.fromCharCode(s),start:i,end:XA};default:if(61===(t=KA.charCodeAt(XA+1)))switch(s){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return XA+=2,{type:7,value:String.fromCharCode(s)+String.fromCharCode(t),start:i,end:XA};case 33:case 61:return 61===KA.charCodeAt(XA+=2)&&++XA,{type:7,value:KA.slice(i,XA),start:i,end:XA}}}return">>>="===(r=KA.substr(XA,4))?{type:7,value:r,start:i,end:XA+=4}:">>>"===(n=r.substr(0,3))||"<<="===n||">>="===n?{type:7,value:n,start:i,end:XA+=3}:o===(e=n.substr(0,2))[1]&&"+-<>&|".indexOf(o)>=0||"=>"===e?{type:7,value:e,start:i,end:XA+=2}:"<>=!+-*%&|^/".indexOf(o)>=0?{type:7,value:o,start:i,end:++XA}:void DD({},"Unexpected token %0",nD)}function bD(){var t,e,n;if(sD(oD((n=KA[XA]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),e=XA,t="","."!==n){if(t=KA[XA++],n=KA[XA],"0"===t){if("x"===n||"X"===n)return++XA,function(t){for(var e="";XA<ZA&&aD(KA[XA]);)e+=KA[XA++];return 0===e.length&&DD({},"Unexpected token %0",nD),hD(KA.charCodeAt(XA))&&DD({},"Unexpected token %0",nD),{type:6,value:parseInt("0x"+e,16),start:t,end:XA}}(e);if(lD(n))return function(t){for(var e="0"+KA[XA++];XA<ZA&&lD(KA[XA]);)e+=KA[XA++];return(hD(KA.charCodeAt(XA))||oD(KA.charCodeAt(XA)))&&DD({},"Unexpected token %0",nD),{type:6,value:parseInt(e,8),octal:!0,start:t,end:XA}}(e);n&&oD(n.charCodeAt(0))&&DD({},"Unexpected token %0",nD)}for(;oD(KA.charCodeAt(XA));)t+=KA[XA++];n=KA[XA]}if("."===n){for(t+=KA[XA++];oD(KA.charCodeAt(XA));)t+=KA[XA++];n=KA[XA]}if("e"===n||"E"===n)if(t+=KA[XA++],"+"!==(n=KA[XA])&&"-"!==n||(t+=KA[XA++]),oD(KA.charCodeAt(XA)))for(;oD(KA.charCodeAt(XA));)t+=KA[XA++];else DD({},"Unexpected token %0",nD);return hD(KA.charCodeAt(XA))&&DD({},"Unexpected token %0",nD),{type:6,value:parseFloat(t),start:e,end:XA}}function xD(){var t,e,n;return pD(),XA>=ZA?{type:2,start:XA,end:XA}:hD(t=KA.charCodeAt(XA))?(e=XA,{type:1===(n=92===KA.charCodeAt(XA)?yD():function(){var t,e;for(t=XA++;XA<ZA;){if(92===(e=KA.charCodeAt(XA)))return XA=t,yD();if(!dD(e))break;++XA}return KA.slice(t,XA)}()).length?3:fD.hasOwnProperty(n)?4:"null"===n?5:"true"===n||"false"===n?1:3,value:n,start:e,end:XA}):40===t||41===t||59===t?vD():39===t||34===t?function(){var t,e,n,r,i="",s=!1;for(sD("'"===(t=KA[XA])||'"'===t,"String literal must starts with a quote"),e=XA,++XA;XA<ZA;){if((n=KA[XA++])===t){t="";break}if("\\"===n)if((n=KA[XA++])&&cD(n.charCodeAt(0)))"\r"===n&&"\n"===KA[XA]&&++XA;else switch(n){case"u":case"x":"{"===KA[XA]?(++XA,i+=gD()):i+=mD(n);break;case"n":i+="\n";break;case"r":i+="\r";break;case"t":i+="\t";break;case"b":i+="\b";break;case"f":i+="\f";break;case"v":i+="\v";break;default:lD(n)?(0!==(r="01234567".indexOf(n))&&(s=!0),XA<ZA&&lD(KA[XA])&&(s=!0,r=8*r+"01234567".indexOf(KA[XA++]),"0123".indexOf(n)>=0&&XA<ZA&&lD(KA[XA])&&(r=8*r+"01234567".indexOf(KA[XA++]))),i+=String.fromCharCode(r)):i+=n}else{if(cD(n.charCodeAt(0)))break;i+=n}}return""!==t&&DD({},"Unexpected token %0",nD),{type:8,value:i,octal:s,start:e,end:XA}}():46===t?oD(KA.charCodeAt(XA+1))?bD():vD():oD(t)?bD():vD()}function _D(){var t;return XA=(t=QA).end,QA=xD(),XA=t.end,t}function wD(){var t;t=XA,QA=xD(),XA=t}function SD(t,e,n){var r=new eD("||"===t||"&&"===t?"LogicalExpression":"BinaryExpression");return r.operator=t,r.left=e,r.right=n,r}function CD(t){var e=new eD("Identifier");return e.name=t,e}function ED(t){var e=new eD("Literal");return e.value=t.value,e.raw=KA.slice(t.start,t.end),t.regex&&("//"===e.raw&&(e.raw="/(?:)/"),e.regex=t.regex),e}function kD(t,e,n){var r=new eD("MemberExpression");return r.computed="["===t,r.object=e,r.property=n,r.computed||(n.member=!0),r}function AD(t,e,n){var r=new eD("Property");return r.key=e,r.value=n,r.kind=t,r}function DD(t,e){var n,r=Array.prototype.slice.call(arguments,2),i=e.replace(/%(\d)/g,(function(t,e){return sD(e<r.length,"Message reference must be in range"),r[e]}));throw(n=new Error(i)).index=XA,n.description=i,n}function ND(t){2===t.type&&DD(t,"Unexpected end of input"),6===t.type&&DD(t,"Unexpected number"),8===t.type&&DD(t,"Unexpected string"),3===t.type&&DD(t,"Unexpected identifier"),4===t.type&&DD(t,"Unexpected reserved word"),DD(t,"Unexpected token %0",t.value)}function TD(t){var e=_D();7===e.type&&e.value===t||ND(e)}function OD(t){return 7===QA.type&&QA.value===t}function ID(t){return 4===QA.type&&QA.value===t}function RD(){var t;return XA=QA.start,8===(t=_D()).type||6===t.type?(t.octal&&DD(t,"Octal literals are not allowed in strict mode."),ED(t)):CD(t.value)}function FD(){var t,e,n;return XA=QA.start,3===(t=QA).type?(n=RD(),TD(":"),AD("init",n,jD())):2!==t.type&&7!==t.type?(e=RD(),TD(":"),AD("init",e,jD())):void ND(t)}var MD={if:1};function $D(){var t=[];if(TD("("),!OD(")"))for(;XA<ZA&&(t.push(jD()),!OD(")"));)TD(",");return TD(")"),t}function PD(){var t;return TD("["),t=UD(),TD("]"),t}function zD(){var t=function(){var t,e,n,r,i;for(t=function(){var t,e,n,r,i,s,o;if(OD("("))return function(){var t;return TD("("),t=UD(),TD(")"),t}();if(OD("["))return function(){var t=[];for(XA=QA.start,TD("[");!OD("]");)OD(",")?(_D(),t.push(null)):(t.push(jD()),OD("]")||TD(","));return _D(),function(t){var e=new eD("ArrayExpression");return e.elements=t,e}(t)}();if(OD("{"))return function(){var t,e,n=[],r={},i=String;for(XA=QA.start,TD("{");!OD("}");)e="$"+("Identifier"===(t=FD()).key.type?t.key.name:i(t.key.value)),Object.prototype.hasOwnProperty.call(r,e)?DD({},"Duplicate data property in object literal not allowed in strict mode"):r[e]=!0,n.push(t),OD("}")||TD(",");return TD("}"),function(t){var e=new eD("ObjectExpression");return e.properties=t,e}(n)}();if(XA=QA.start,3===(t=QA.type)||MD[QA.value])n=CD(_D().value);else if(8===t||6===t)QA.octal&&DD(QA,"Octal literals are not allowed in strict mode."),n=ED(_D());else{if(4===t)throw new Error("Disabled.");1===t?((e=_D()).value="true"===e.value,n=ED(e)):5===t?((e=_D()).value=null,n=ED(e)):OD("/")||OD("/=")?(n=ED((QA=null,pD(),r=XA,i=function(){var t,e,n,r;for(sD("/"===(t=KA[XA]),"Regular expression literal must start with a slash"),e=KA[XA++],n=!1,r=!1;XA<ZA;)if(e+=t=KA[XA++],"\\"===t)cD((t=KA[XA++]).charCodeAt(0))&&DD({},"Invalid regular expression: missing /"),e+=t;else if(cD(t.charCodeAt(0)))DD({},"Invalid regular expression: missing /");else if(n)"]"===t&&(n=!1);else{if("/"===t){r=!0;break}"["===t&&(n=!0)}return r||DD({},"Invalid regular expression: missing /"),{value:e.substr(1,e.length-2),literal:e}}(),s=function(){var t,e,n;for(e="",n="";XA<ZA&&dD((t=KA[XA]).charCodeAt(0));)++XA,"\\"===t&&XA<ZA?DD({},"Unexpected token %0",nD):(n+=t,e+=t);return n.search(/[^gimuy]/g)>=0&&DD({},"Invalid regular expression",n),{value:n,literal:e}}(),o=function(t,e){var n=t;e.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(function(t,e){if(parseInt(e,16)<=1114111)return"x";DD({},"Invalid regular expression")})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(r){DD({},"Invalid regular expression")}try{return new RegExp(t,e)}catch(i){return null}}(i.value,s.value),{literal:i.literal+s.literal,value:o,regex:{pattern:i.value,flags:s.value},start:r,end:XA})),wD()):ND(_D())}return n}();;)if(OD("."))t=kD(".",t,(void 0,TD("."),XA=QA.start,function(t){return 3===t.type||4===t.type||1===t.type||5===t.type}(i=_D())||ND(i),CD(i.value)));else if(OD("("))e=t,n=$D(),r=void 0,(r=new eD("CallExpression")).callee=e,r.arguments=n,t=r;else{if(!OD("["))break;t=kD("[",t,PD())}return t}();if(7===QA.type&&(OD("++")||OD("--")))throw new Error("Disabled.");return t}function LD(){var t,e,n,r,i;if(7!==QA.type&&4!==QA.type)e=zD();else{if(OD("++")||OD("--"))throw new Error("Disabled.");if(OD("+")||OD("-")||OD("~")||OD("!"))t=_D(),e=LD(),n=t.value,r=e,(i=new eD("UnaryExpression")).operator=n,i.argument=r,i.prefix=!0,e=i;else{if(ID("delete")||ID("void")||ID("typeof"))throw new Error("Disabled.");e=zD()}}return e}function BD(t){var e=0;if(7!==t.type&&4!==t.type)return 0;switch(t.value){case"||":e=1;break;case"&&":e=2;break;case"|":e=3;break;case"^":e=4;break;case"&":e=5;break;case"==":case"!=":case"===":case"!==":e=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":e=7;break;case"<<":case">>":case">>>":e=8;break;case"+":case"-":e=9;break;case"*":case"/":case"%":e=11}return e}function jD(){var t,e;return t=function(){var t,e,n,r,i,s,o,a,l,u;if(t=QA,l=LD(),0===(i=BD(r=QA)))return l;for(r.prec=i,_D(),e=[t,QA],s=[l,r,o=LD()];(i=BD(QA))>0;){for(;s.length>2&&i<=s[s.length-2].prec;)o=s.pop(),a=s.pop().value,l=s.pop(),e.pop(),n=SD(a,l,o),s.push(n);(r=_D()).prec=i,s.push(r),e.push(QA),n=LD(),s.push(n)}for(n=s[u=s.length-1],e.pop();u>1;)e.pop(),n=SD(s[u-1].value,s[u-2],n),u-=2;return n}(),OD("?")&&(_D(),e=jD(),TD(":"),t=function(t,e,n){var r=new eD("ConditionalExpression");return r.test=t,r.consequent=e,r.alternate=n,r}(t,e,jD())),t}function UD(){var t=jD();if(OD(","))throw new Error("Disabled.");return t}var VD=function(t){XA=0,ZA=(KA=t).length,QA=null,wD();var e=UD();if(2!==QA.type)throw new Error("Unexpect token after expression.");return e},WD={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"},qD=function(t){function e(e,n,r){return function(i){return function(e,n,r,i){var s=t(n[0]);return r&&(s=r+"("+s+")",0===r.lastIndexOf("new ",0)&&(s="("+s+")")),s+"."+e+(i<0?"":0===i?"()":"("+n.slice(1).map(t).join(",")+")")}(e,i,n,r)}}var n="new Date";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(e){e.length<3&&$t("Missing arguments to clamp function."),e.length>3&&$t("Too many arguments to clamp function.");var n=e.map(t);return"Math.max("+n[1]+", Math.min("+n[2]+","+n[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:e("getDate",n,0),day:e("getDay",n,0),year:e("getFullYear",n,0),month:e("getMonth",n,0),hours:e("getHours",n,0),minutes:e("getMinutes",n,0),seconds:e("getSeconds",n,0),milliseconds:e("getMilliseconds",n,0),time:e("getTime",n,0),timezoneoffset:e("getTimezoneOffset",n,0),utcdate:e("getUTCDate",n,0),utcday:e("getUTCDay",n,0),utcyear:e("getUTCFullYear",n,0),utcmonth:e("getUTCMonth",n,0),utchours:e("getUTCHours",n,0),utcminutes:e("getUTCMinutes",n,0),utcseconds:e("getUTCSeconds",n,0),utcmilliseconds:e("getUTCMilliseconds",n,0),length:e("length",null,-1),join:e("join",null),indexof:e("indexOf",null),lastindexof:e("lastIndexOf",null),slice:e("slice",null),reverse:function(e){return"("+t(e[0])+").slice().reverse()"},parseFloat:"parseFloat",parseInt:"parseInt",upper:e("toUpperCase","String",0),lower:e("toLowerCase","String",0),substring:e("substring","String"),split:e("split","String"),replace:e("replace","String"),trim:e("trim","String",0),regexp:"RegExp",test:e("test","RegExp"),if:function(e){e.length<3&&$t("Missing arguments to if function."),e.length>3&&$t("Too many arguments to if function.");var n=e.map(t);return"("+n[0]+"?"+n[1]+":"+n[2]+")"}}};function HD(t,e,n,r){"Literal"!==e[0].type&&$t("First argument to data functions must be a string literal.");const i=e[0].value,s=":"+i;if(!ze(s,r))try{r[s]=n.getData(i).tuplesRef()}catch(o){}}function GD(t,e,n,r){if("Literal"===e[0].type)YD(n,r,e[0].value);else for(t in n.scales)YD(n,r,t)}function YD(t,e,n){const r="%"+n;if(!ze(e,r))try{e[r]=t.scaleRef(n)}catch(i){}}function KD(t,e){let n;return ke(t)?t:Ye(t)?(n=e.scales[t])&&n.value:void 0}var XD,ZD,QD,JD,tN,eN=Gx(),nN=Gx(),rN={point:y_,lineStart:y_,lineEnd:y_,polygonStart:function(){eN.reset(),rN.lineStart=iN,rN.lineEnd=sN},polygonEnd:function(){var t=+eN;nN.add(t<0?t_+t:t),this.lineStart=this.lineEnd=this.point=y_},sphere:function(){nN.add(t_)}};function iN(){rN.point=oN}function sN(){aN(XD,ZD)}function oN(t,e){rN.point=aN,XD=t,ZD=e,QD=t*=n_,JD=o_(e=(e*=n_)/2+Jx),tN=h_(e)}function aN(t,e){var n=(t*=n_)-QD,r=n>=0?1:-1,i=r*n,s=o_(e=(e*=n_)/2+Jx),o=h_(e),a=tN*o,l=JD*s+a*o_(i),u=a*r*h_(i);eN.add(s_(u,l)),QD=t,JD=s,tN=o}var lN,uN,cN,hN,dN,fN,pN,mN,gN,yN,vN=Gx(),bN={point:xN,lineStart:wN,lineEnd:SN,polygonStart:function(){bN.point=CN,bN.lineStart=EN,bN.lineEnd=kN,vN.reset(),rN.polygonStart()},polygonEnd:function(){rN.polygonEnd(),bN.point=xN,bN.lineStart=wN,bN.lineEnd=SN,eN<0?(lN=-(cN=180),uN=-(hN=90)):vN>1e-6?hN=90:vN<-1e-6&&(uN=-90),yN[0]=lN,yN[1]=cN},sphere:function(){lN=-(cN=180),uN=-(hN=90)}};function xN(t,e){gN.push(yN=[lN=t,cN=t]),e<uN&&(uN=e),e>hN&&(hN=e)}function _N(t,e){var n=Ew([t*n_,e*n_]);if(mN){var r=Aw(mN,n),i=Aw([r[1],-r[0],0],r);Tw(i),i=Cw(i);var s,o=t-dN,a=o>0?1:-1,l=i[0]*e_*a,u=r_(o)>180;u^(a*dN<l&&l<a*t)?(s=i[1]*e_)>hN&&(hN=s):u^(a*dN<(l=(l+360)%360-180)&&l<a*t)?(s=-i[1]*e_)<uN&&(uN=s):(e<uN&&(uN=e),e>hN&&(hN=e)),u?t<dN?AN(lN,t)>AN(lN,cN)&&(cN=t):AN(t,cN)>AN(lN,cN)&&(lN=t):cN>=lN?(t<lN&&(lN=t),t>cN&&(cN=t)):t>dN?AN(lN,t)>AN(lN,cN)&&(cN=t):AN(t,cN)>AN(lN,cN)&&(lN=t)}else gN.push(yN=[lN=t,cN=t]);e<uN&&(uN=e),e>hN&&(hN=e),mN=n,dN=t}function wN(){bN.point=_N}function SN(){yN[0]=lN,yN[1]=cN,bN.point=xN,mN=null}function CN(t,e){if(mN){var n=t-dN;vN.add(r_(n)>180?n+(n>0?360:-360):n)}else fN=t,pN=e;rN.point(t,e),_N(t,e)}function EN(){rN.lineStart()}function kN(){CN(fN,pN),rN.lineEnd(),r_(vN)>1e-6&&(lN=-(cN=180)),yN[0]=lN,yN[1]=cN,mN=null}function AN(t,e){return(e-=t)<0?e+360:e}function DN(t,e){return t[0]-e[0]}function NN(t,e){return t[0]<=t[1]?t[0]<=e&&e<=t[1]:e<t[0]||t[1]<e}var TN,ON,IN,RN,FN,MN,$N,PN,zN,LN,BN,jN,UN,VN,WN,qN,HN={sphere:y_,point:GN,lineStart:KN,lineEnd:QN,polygonStart:function(){HN.lineStart=JN,HN.lineEnd=tT},polygonEnd:function(){HN.lineStart=KN,HN.lineEnd=QN}};function GN(t,e){t*=n_;var n=o_(e*=n_);YN(n*o_(t),n*h_(t),h_(e))}function YN(t,e,n){++TN,IN+=(t-IN)/TN,RN+=(e-RN)/TN,FN+=(n-FN)/TN}function KN(){HN.point=XN}function XN(t,e){t*=n_;var n=o_(e*=n_);VN=n*o_(t),WN=n*h_(t),qN=h_(e),HN.point=ZN,YN(VN,WN,qN)}function ZN(t,e){t*=n_;var n=o_(e*=n_),r=n*o_(t),i=n*h_(t),s=h_(e),o=s_(f_((o=WN*s-qN*i)*o+(o=qN*r-VN*s)*o+(o=VN*i-WN*r)*o),VN*r+WN*i+qN*s);ON+=o,MN+=o*(VN+(VN=r)),$N+=o*(WN+(WN=i)),PN+=o*(qN+(qN=s)),YN(VN,WN,qN)}function QN(){HN.point=GN}function JN(){HN.point=eT}function tT(){nT(jN,UN),HN.point=GN}function eT(t,e){jN=t,UN=e,t*=n_,e*=n_,HN.point=nT;var n=o_(e);VN=n*o_(t),WN=n*h_(t),qN=h_(e),YN(VN,WN,qN)}function nT(t,e){t*=n_;var n=o_(e*=n_),r=n*o_(t),i=n*h_(t),s=h_(e),o=WN*s-qN*i,a=qN*r-VN*s,l=VN*i-WN*r,u=f_(o*o+a*a+l*l),c=g_(u),h=u&&-c/u;zN+=h*o,LN+=h*a,BN+=h*l,ON+=c,MN+=c*(VN+(VN=r)),$N+=c*(WN+(WN=i)),PN+=c*(qN+(qN=s)),YN(VN,WN,qN)}function rT(t,e){return function(n,r,i){if(n){const e=KD(n,(i||this).context);return e&&e.path[t](r)}return e(r)}}const iT=rT("area",(function(t){return nN.reset(),Hx(t,rN),2*nN})),sT=rT("bounds",(function(t){var e,n,r,i,s,o,a;if(hN=cN=-(lN=uN=1/0),gN=[],Hx(t,bN),n=gN.length){for(gN.sort(DN),e=1,s=[r=gN[0]];e<n;++e)NN(r,(i=gN[e])[0])||NN(r,i[1])?(AN(r[0],i[1])>AN(r[0],r[1])&&(r[1]=i[1]),AN(i[0],r[1])>AN(r[0],r[1])&&(r[0]=i[0])):s.push(r=i);for(o=-1/0,e=0,r=s[n=s.length-1];e<=n;r=i,++e)(a=AN(r[1],(i=s[e])[0]))>o&&(o=a,lN=i[0],cN=r[1])}return gN=yN=null,lN===1/0||uN===1/0?[[NaN,NaN],[NaN,NaN]]:[[lN,uN],[cN,hN]]})),oT=rT("centroid",(function(t){TN=ON=IN=RN=FN=MN=$N=PN=zN=LN=BN=0,Hx(t,HN);var e=zN,n=LN,r=BN,i=e*e+n*n+r*r;return i<1e-12&&(e=MN,n=$N,r=PN,ON<1e-6&&(e=IN,n=RN,r=FN),(i=e*e+n*n+r*r)<1e-12)?[NaN,NaN]:[s_(n,e)*e_,g_(r/f_(i))*e_]}));function aT(t,e,n){try{t[e].apply(t,["EXPRESSION"].concat([].slice.call(n)))}catch(r){t.warn(r)}return n[n.length-1]}function lT(t){const e=t/255;return e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)}function uT(t){const e=Rm(t);return.2126*lT(e.r)+.7152*lT(e.g)+.0722*lT(e.b)}function cT(t,e){return t===e||t!=t&&e!=e||(Jt(t)?!(!Jt(e)||t.length!==e.length)&&function(t,e){for(let n=0,r=t.length;n<r;++n)if(!cT(t[n],e[n]))return!1;return!0}(t,e):!(!te(t)||!te(e))&&hT(t,e))}function hT(t,e){for(let n in t)if(!cT(t[n],e[n]))return!1;return!0}function dT(t){return e=>hT(t,e)}const fT=t=>t.data;function pT(t,e){const n=jA.call(e,t);return n.root&&n.root.lookup||{}}const mT=()=>"undefined"!=typeof window&&window||null;function gT(t,e){for(var n,r,i=e.fields,s=e.values,o=i.length,a=0;a<o;++a)if((r=i[a]).getter=zt.getter||zt(r.field),n=r.getter(t),qe(n)&&(n=oe(n)),qe(s[a])&&(s[a]=oe(s[a])),qe(s[a][0])&&(s[a]=s[a].map(oe)),"E"===r.type){if(Jt(s[a])?s[a].indexOf(n)<0:n!==s[a])return!1}else if("R"===r.type){if(!Ve(n,s[a]))return!1}else if("R-RE"===r.type){if(!Ve(n,s[a],!0,!1))return!1}else if("R-E"===r.type){if(!Ve(n,s[a],!1,!1))return!1}else if("R-LE"===r.type&&!Ve(n,s[a],!1,!0))return!1;return!0}var yT={E_union:function(t,e){if(!t.length)return e;for(var n=0,r=e.length;n<r;++n)t.indexOf(e[n])<0&&t.push(e[n]);return t},E_intersect:function(t,e){return t.length?t.filter((function(t){return e.indexOf(t)>=0})):e},R_union:function(t,e){var n=oe(e[0]),r=oe(e[1]);return n>r&&(n=e[1],r=e[0]),t.length?(t[0]>n&&(t[0]=n),t[1]<r&&(t[1]=r),t):[n,r]},R_intersect:function(t,e){var n=oe(e[0]),r=oe(e[1]);return n>r&&(n=e[1],r=e[0]),t.length?r<t[0]||t[1]<n?[]:(t[0]<n&&(t[0]=n),t[1]>r&&(t[1]=r),t):[n,r]}};function vT(t,e,n,r){"Literal"!==e[0].type&&$t("First argument to selection functions must be a string literal.");const i=e[0].value,s=":"+i;"intersect"!==(e.length>=2&&se(e).value)||ze(r,"@unit")||(r["@unit"]=n.getData(i).indataRef(n,"unit")),ze(r,s)||(r[s]=n.getData(i).tuplesRef())}const bT={random:function(){return Ga()},cumulativeNormal:il,cumulativeLogNormal:cl,cumulativeUniform:gl,densityNormal:rl,densityLogNormal:ul,densityUniform:ml,quantileNormal:sl,quantileLogNormal:hl,quantileUniform:yl,sampleNormal:nl,sampleLogNormal:ll,sampleUniform:pl,isArray:Jt,isBoolean:We,isDate:qe,isDefined:function(t){return void 0!==t},isNumber:He,isObject:te,isRegExp:Ge,isString:Ye,isTuple:mn,isValid:function(t){return null!=t&&t==t},toBoolean:rn,toDate:on,toNumber:oe,toString:an,flush:je,lerp:Xe,merge:function(){var t=[].slice.call(arguments);return t.unshift({}),Fe.apply(null,t)},pad:tn,peek:se,span:en,inrange:Ve,truncate:un,rgb:Rm,lab:ky,hcl:Ry,hsl:Bm,luminance:uT,contrast:function(t,e){const n=uT(t),r=uT(e);return(Math.max(n,r)+.05)/(Math.min(n,r)+.05)},sequence:Pu,format:VA,utcFormat:qA,utcParse:GA,utcOffset:ls,utcSequence:hs,timeFormat:WA,timeParse:HA,timeOffset:as,timeSequence:cs,timeUnitSpecifier:ai,monthFormat:function(t){return tD.call(this,t,1,"%B")},monthAbbrevFormat:function(t){return tD.call(this,t,1,"%b")},dayFormat:function(t){return tD.call(this,0,2+t,"%A")},dayAbbrevFormat:function(t){return tD.call(this,0,2+t,"%a")},quarter:we,utcquarter:Se,week:Ci,utcweek:Ti,dayofyear:Si,utcdayofyear:Ni,warn:function(){return aT(this.context.dataflow,"warn",arguments)},info:function(){return aT(this.context.dataflow,"info",arguments)},debug:function(){return aT(this.context.dataflow,"debug",arguments)},extent:Me,inScope:function(t){let e=this.context.group,n=!1;if(e)for(;t;){if(t===e){n=!0;break}t=t.mark.group}return n},intersect:function(t,e,n){if(!t)return[];const[r,i]=t,s=(new gd).set(r[0],r[1],i[0],i[1]);return rb(n||this.context.dataflow.scenegraph().root,s,function(t){let e=null;if(t){const n=Ce(t.marktype),r=Ce(t.markname);e=t=>(!n.length||n.some(e=>t.marktype===e))&&(!r.length||r.some(e=>t.name===e))}return e}(e))},clampRange:Ee,pinchDistance:function(t){const e=t.touches,n=e[0].clientX-e[1].clientX,r=e[0].clientY-e[1].clientY;return Math.sqrt(n*n+r*r)},pinchAngle:function(t){const e=t.touches;return Math.atan2(e[0].clientY-e[1].clientY,e[0].clientX-e[1].clientX)},screen:function(){const t=mT();return t?t.screen:{}},containerSize:function(){const t=this.context.dataflow,e=t.container&&t.container();return e?[e.clientWidth,e.clientHeight]:[void 0,void 0]},windowSize:function(){const t=mT();return t?[t.innerWidth,t.innerHeight]:[void 0,void 0]},bandspace:function(t,e,n){return Yp(t||0,e||0,n||0)},setdata:function(t,e){const n=this.context.dataflow;return n.pulse(this.context.data[t].input,n.changeset().remove(Wt).insert(e)),1},pathShape:function(t){let e=null;return function(n){return n?xh(n,e=e||uh(t)):t}},panLinear:fe,panLog:pe,panPow:me,panSymlog:ge,zoomLinear:ve,zoomLog:be,zoomPow:xe,zoomSymlog:_e,encode:function(t,e,n){if(t){const n=this.context.dataflow;n.pulse(t.mark.source,n.changeset().encode(t,e))}return void 0!==n?n:t},modify:function(t,e,n,r,i,s){let o,a,l=this.context.dataflow,u=this.context.data[t],c=u.input,h=u.changes,d=l.stamp();if(!1===l._trigger||!(c.value.length||e||r))return 0;if((!h||h.stamp<d)&&(u.changes=h=l.changeset(),h.stamp=d,l.runAfter((function(){u.modified=!0,l.pulse(c,h).run()}),!0,1)),n&&(o=!0===n?Wt:Jt(n)||mn(n)?n:dT(n),h.remove(o)),e&&h.insert(e),r&&(o=dT(r),c.value.some(o)?h.remove(o):h.insert(r)),i)for(a in s)h.modify(i,a,s[a]);return 1}},xT=["view","item","group","xy","x","y"],_T={};function wT(t,e,n){return 1===arguments.length?bT[t]:(bT[t]=e,n&&(_T[t]=n),CT&&(CT.functions[t]="this."+t),this)}wT("bandwidth",(function(t,e){const n=KD(t,(e||this).context);return n&&n.bandwidth?n.bandwidth():0}),GD),wT("copy",(function(t,e){const n=KD(t,(e||this).context);return n?n.copy():void 0}),GD),wT("domain",(function(t,e){const n=KD(t,(e||this).context);return n?n.domain():[]}),GD),wT("range",(function(t,e){const n=KD(t,(e||this).context);return n&&n.range?n.range():[]}),GD),wT("invert",(function(t,e,n){const r=KD(t,(n||this).context);return r?Jt(e)?(r.invertRange||r.invert)(e):(r.invert||r.invertExtent)(e):void 0}),GD),wT("scale",(function(t,e,n){const r=KD(t,(n||this).context);return r?r(e):void 0}),GD),wT("gradient",(function(t,e,n,r,i){t=KD(t,(i||this).context);const s=dc(e,n);let o=t.domain(),a=o[0],l=se(o),u=jt;return l-a?u=ev(t,a,l):t=(t.interpolator?Xg("sequential")().interpolator(t.interpolator()):Xg("linear")().interpolate(t.interpolate()).range(t.range())).domain([a=0,l=1]),t.ticks&&(o=t.ticks(+r||15),a!==o[0]&&o.unshift(a),l!==se(o)&&o.push(l)),o.forEach(e=>s.stop(u(e),t(e))),s}),GD),wT("geoArea",iT,GD),wT("geoBounds",sT,GD),wT("geoCentroid",oT,GD),wT("geoShape",(function(t,e,n){const r=KD(t,(n||this).context);return function(t){return r?r.path.context(t)(e):""}}),GD),wT("indata",(function(t,e,n){const r=this.context.data[t]["index:"+e],i=r?r.value.get(n):void 0;return i?i.count:i}),(function(t,e,n,r){"Literal"!==e[0].type&&$t("First argument to indata must be a string literal."),"Literal"!==e[1].type&&$t("Second argument to indata must be a string literal.");const i=e[0].value,s=e[1].value,o="@"+s;ze(o,r)||(r[o]=n.getData(i).indataRef(n,s))})),wT("data",jA,HD),wT("treePath",(function(t,e,n){const r=pT(t,this),i=r[e],s=r[n];return i&&s?i.path(s).map(fT):void 0}),HD),wT("treeAncestors",(function(t,e){const n=pT(t,this)[e];return n?n.ancestors().map(fT):void 0}),HD),wT("vlSelectionTest",(function(t,e,n){for(var r,i,s,o,a,l=this.context.data[t],u=l?l.values.value:[],c=l?l["index:unit"]&&l["index:unit"].value:void 0,h="intersect"===n,d=u.length,f=0;f<d;++f)if(r=u[f],c&&h){if(-1===(s=(i=i||{})[o=r.unit]||0))continue;if(a=gT(e,r),i[o]=a?-1:++s,a&&1===c.size)return!0;if(!a&&s===c.get(o).count)return!1}else if(h^(a=gT(e,r)))return a;return d&&h}),vT),wT("vlSelectionResolve",(function(t,e,n){for(var r,i,s,o,a,l,u,c,h,d,f=this.context.data[t],p=f?f.values.value:[],m={},g={},y={},v=p.length,b=0;b<v;++b){for(o=(r=p[b]).unit,s=r.values,h=0,d=(i=r.fields).length;h<d;++h)u=(l=m[(a=i[h]).field]||(m[a.field]={}))[o]||(l[o]=[]),y[a.field]=c=a.type.charAt(0),l[o]=(0,yT[c+"_union"])(u,Ce(s[h]));n&&(u=g[o]||(g[o]=[])).push(Ce(s).reduce((t,e,n)=>(t[i[n].field]=e,t),{}))}return e=e||"union",Object.keys(m).forEach((function(t){m[t]=Object.keys(m[t]).map(e=>m[t][e]).reduce((n,r)=>void 0===n?r:yT[y[t]+"_"+e](n,r))})),p=Object.keys(g),n&&p.length&&(m.vlMulti="union"===e?{or:p.reduce((t,e)=>(t.push.apply(t,g[e]),t),[])}:{and:p.map(t=>({or:g[t]}))}),m}),vT);const ST={blacklist:["_"],whitelist:["datum","event","item"],fieldvar:"datum",globalvar:t=>"_["+nn("$"+t)+"]",functions:function(t){const e=qD(t);xT.forEach(t=>e[t]="event.vega."+t);for(let n in bT)e[n]="this."+n;return Fe(e,function(t,e,n){e.__bandwidth=t=>t&&t.bandwidth?t.bandwidth():0,n._bandwidth=GD,n._range=GD,n._scale=GD;const r=e=>"_["+("Literal"===e.type?nn("%"+e.value):nn("%")+"+"+t(e))+"]";return{_bandwidth:t=>`this.__bandwidth(${r(t[0])})`,_range:t=>r(t[0])+".range()",_scale:e=>`${r(e[0])}(${t(e[1])})`}}(t,bT,_T)),e},constants:WD,visitors:_T};var CT=function(t){var e=(t=t||{}).whitelist?ln(t.whitelist):{},n=t.blacklist?ln(t.blacklist):{},r=t.constants||WD,i=(t.functions||qD)(h),s=t.globalvar,o=t.fieldvar,a={},l={},u=0,c=ke(s)?s:function(t){return s+'["'+t+'"]'};function h(t){if(Ye(t))return t;var e=d[t.type];return null==e&&$t("Unsupported type: "+t.type),e(t)}var d={Literal:function(t){return t.raw},Identifier:function(t){var i=t.name;return u>0?i:ze(n,i)?$t("Illegal identifier: "+i):ze(r,i)?r[i]:ze(e,i)?i:(a[i]=1,c(i))},MemberExpression:function(t){var e=!t.computed,n=h(t.object);e&&(u+=1);var r=h(t.property);return n===o&&(l[function(t){var e=t&&t.length-1;return e&&('"'===t[0]&&'"'===t[e]||"'"===t[0]&&"'"===t[e])?t.slice(1,-1):t}(r)]=1),e&&(u-=1),n+(e?"."+r:"["+r+"]")},CallExpression:function(t){"Identifier"!==t.callee.type&&$t("Illegal callee type: "+t.callee.type);var e=t.callee.name,n=t.arguments,r=ze(i,e)&&i[e];return r||$t("Unrecognized function: "+e),ke(r)?r(n):r+"("+n.map(h).join(",")+")"},ArrayExpression:function(t){return"["+t.elements.map(h).join(",")+"]"},BinaryExpression:function(t){return"("+h(t.left)+t.operator+h(t.right)+")"},UnaryExpression:function(t){return"("+t.operator+h(t.argument)+")"},ConditionalExpression:function(t){return"("+h(t.test)+"?"+h(t.consequent)+":"+h(t.alternate)+")"},LogicalExpression:function(t){return"("+h(t.left)+t.operator+h(t.right)+")"},ObjectExpression:function(t){return"{"+t.properties.map(h).join(",")+"}"},Property:function(t){u+=1;var e=h(t.key);return u-=1,e+":"+h(t.value)}};function f(t){var e={code:h(t),globals:Object.keys(a),fields:Object.keys(l)};return a={},l={},e}return f.functions=i,f.constants=r,f}(ST),ET=function(t,e){var n,r,i={};try{t=Ye(t)?t:nn(t)+"",n=VD(t)}catch(s){$t("Expression parse error: "+t)}return n.visit(t=>{if("CallExpression"===t.type){var n=t.callee.name,r=ST.visitors[n];r&&r(n,t.arguments,e,i)}}),(r=CT(n)).globals.forEach(t=>{var n="$"+t;!ze(i,n)&&e.getSignal(t)&&(i[n]=e.signalRef(t))}),{$expr:Fe({code:r.code},e.options.ast?{ast:n}:null),$fields:r.fields,$params:i}};const kT=ln(["rule"]),AT=ln(["group","image","rect"]);function DT(t){return(t+"").toLowerCase()}function NT(t,e,n){";"!==n[n.length-1]&&(n="return("+n+");");var r=Function.apply(null,e.concat(n));return t&&t.functions?r.bind(t.functions):r}var TT={operator:(t,e)=>NT(t,["_"],e.code),parameter:(t,e)=>NT(t,["datum","_"],e.code),event:(t,e)=>NT(t,["event"],e.code),handler:(t,e)=>NT(t,["_","event"],`var datum=event.item&&event.item.datum;return ${e.code};`),encode:(t,e)=>{const{marktype:n,channels:r}=e;let i="var o=item,datum=o.datum,m=0,$;";for(const s in r){const t="o["+nn(s)+"]";i+=`$=${r[s].code};if(${t}!==$)${t}=$,m=1;`}return i+=function(t,e){let n="";return kT[e]||(t.x2&&(t.x?(AT[e]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),t.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),t.y2&&(t.y?(AT[e]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),t.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}(r,n),i+="return m;",NT(t,["item","_"],i)},codegen:{get(t){const e=`[${t.map(nn).join("][")}]`,n=Function("_",`return _${e};`);return n.path=e,n},comparator(t,e){let n;const r=Function("a","b","var u, v; return "+t.map((t,r)=>{const i=e[r];let s,o;return t.path?(s="a"+t.path,o="b"+t.path):((n=n||{})["f"+r]=t,s=`this.f${r}(a)`,o=`this.f${r}(b)`),function(t,e,n,r){return`((u = ${t}) < (v = ${e}) || u == null) && v != null ? ${n}\n  : (u > v || v == null) && u != null ? ${r}\n  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ${n}\n  : v !== v && u === u ? ${r} : `}(s,o,-i,i)}).join("")+"0;");return n?r.bind(n):r}}};function OT(t,e,n){if(!t||!te(t))return t;for(let r,i=0,s=IT.length;i<s;++i)if(r=IT[i],ze(t,r.key))return r.parse(t,e,n);return t}var IT=[{key:"$ref",parse:function(t,e){return e.get(t.$ref)||$t("Operator not defined: "+t.$ref)}},{key:"$key",parse:function(t,e){const n="k:"+t.$key+"_"+!!t.$flat;return e.fn[n]||(e.fn[n]=Ke(t.$key,t.$flat,e.expr.codegen))}},{key:"$expr",parse:function(t,e,n){t.$params&&e.parseParameters(t.$params,n);const r="e:"+t.$expr.code+"_"+t.$name;return e.fn[r]||(e.fn[r]=Tt(e.parameterExpression(t.$expr),t.$fields,t.$name))}},{key:"$field",parse:function(t,e){if(!t.$field)return null;const n="f:"+t.$field+"_"+t.$name;return e.fn[n]||(e.fn[n]=zt(t.$field,t.$name,e.expr.codegen))}},{key:"$encode",parse:function(t,e){const n=t.$encode,r={};for(const i in n){const t=n[i];r[i]=Tt(e.encodeExpression(t.$expr),t.$fields),r[i].output=t.$output}return r}},{key:"$compare",parse:function(t,e){const n="c:"+t.$compare+"_"+t.$order,r=Ce(t.$compare).map(t=>t&&t.$tupleid?gn:t);return e.fn[n]||(e.fn[n]=Ae(r,t.$order,e.expr.codegen))}},{key:"$context",parse:function(t,e){return e}},{key:"$subflow",parse:function(t,e){const n=t.$subflow;return function(t,r,i){const s=e.fork().parse(n),o=s.get(n.operators[0].id),a=s.signals.parent;return a&&a.set(i),o.detachSubflow=()=>e.detach(s),o}}},{key:"$tupleid",parse:function(){return gn}}],RT={skip:!0},FT=function(t,e,n,r){return new MT(t,e,n,r)};function MT(t,e,n,r){this.dataflow=t,this.transforms=e,this.events=t.events.bind(t),this.expr=r||TT,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function $T(t){this.dataflow=t.dataflow,this.transforms=t.transforms,this.events=t.events,this.expr=t.expr,this.signals=Object.create(t.signals),this.scales=Object.create(t.scales),this.nodes=Object.create(t.nodes),this.data=Object.create(t.data),this.fn=Object.create(t.fn),t.functions&&(this.functions=Object.create(t.functions),this.functions.context=this)}MT.prototype=$T.prototype={fork(){const t=new $T(this);return(this.subcontext||(this.subcontext=[])).push(t),t},detach(t){this.subcontext=this.subcontext.filter(e=>e!==t);const e=Object.keys(t.nodes);for(const n of e)t.nodes[n]._targets=null;for(const n of e)t.nodes[n].detach();t.nodes=null},get(t){return this.nodes[t]},set(t,e){return this.nodes[t]=e},add(t,e){const n=this,r=n.dataflow,i=t.value;if(n.set(t.id,e),"collect"===DT(t.type)&&i&&(i.$ingest?r.ingest(e,i.$ingest,i.$format):i.$request?r.preload(e,i.$request,i.$format):r.pulse(e,r.changeset().insert(i))),t.root&&(n.root=e),t.parent){var s=n.get(t.parent.$ref);s?(r.connect(s,[e]),e.targets().add(s)):(n.unresolved=n.unresolved||[]).push(()=>{s=n.get(t.parent.$ref),r.connect(s,[e]),e.targets().add(s)})}if(t.signal&&(n.signals[t.signal]=e),t.scale&&(n.scales[t.scale]=e),t.data)for(const o in t.data){const r=n.data[o]||(n.data[o]={});t.data[o].forEach(t=>r[t]=e)}},resolve(){return(this.unresolved||[]).forEach(t=>t()),delete this.unresolved,this},operator(t,e){this.add(t,this.dataflow.add(t.value,e))},transform(t,e){this.add(t,this.dataflow.add(this.transforms[DT(e)]))},stream(t,e){this.set(t.id,e)},update(t,e,n,r,i){this.dataflow.on(e,n,r,i,t.options)},operatorExpression(t){return this.expr.operator(this,t)},parameterExpression(t){return this.expr.parameter(this,t)},eventExpression(t){return this.expr.event(this,t)},handlerExpression(t){return this.expr.handler(this,t)},encodeExpression(t){return this.expr.encode(this,t)},parse:function(t){const e=this,n=t.operators||[];return t.background&&(e.background=t.background),t.eventConfig&&(e.eventConfig=t.eventConfig),t.locale&&(e.locale=t.locale),n.forEach(t=>e.parseOperator(t)),n.forEach(t=>e.parseOperatorParameters(t)),(t.streams||[]).forEach(t=>e.parseStream(t)),(t.updates||[]).forEach(t=>e.parseUpdate(t)),e.resolve()},parseOperator:function(t){"operator"!==DT(t.type)&&t.type?this.transform(t,t.type):this.operator(t,t.update?this.operatorExpression(t.update):null)},parseOperatorParameters:function(t){const e=this;if(t.params){const n=e.get(t.id);n||$t("Invalid operator id: "+t.id),e.dataflow.connect(n,n.parameters(e.parseParameters(t.params),t.react,t.initonly))}},parseParameters:function(t,e){e=e||{};const n=this;for(const r in t){const i=t[r];e[r]=Jt(i)?i.map(t=>OT(t,n,e)):OT(i,n,e)}return e},parseStream:function(t){var e,n=this,r=null!=t.filter?n.eventExpression(t.filter):void 0,i=null!=t.stream?n.get(t.stream):void 0;t.source?i=n.events(t.source,t.type,r):t.merge&&(i=(e=t.merge.map(t=>n.get(t)))[0].merge.apply(e[0],e.slice(1))),t.between&&(e=t.between.map(t=>n.get(t)),i=i.between(e[0],e[1])),t.filter&&(i=i.filter(r)),null!=t.throttle&&(i=i.throttle(+t.throttle)),null!=t.debounce&&(i=i.debounce(+t.debounce)),null==i&&$t("Invalid stream definition: "+JSON.stringify(t)),t.consume&&i.consume(!0),n.stream(t,i)},parseUpdate:function(t){var e,n=te(n=t.source)?n.$ref:n,r=this.get(n),i=t.update,s=void 0;r||$t("Source not defined: "+t.source),e=t.target&&t.target.$expr?this.eventExpression(t.target.$expr):this.get(t.target),i&&i.$expr&&(i.$params&&(s=this.parseParameters(i.$params)),i=this.handlerExpression(i.$expr)),this.update(t,r,e,i,s)},getState:function(t){var e=this,n={};if(t.signals){var r=n.signals={};Object.keys(e.signals).forEach(n=>{var i=e.signals[n];t.signals(n,i)&&(r[n]=i.value)})}if(t.data){var i=n.data={};Object.keys(e.data).forEach(n=>{var r=e.data[n];t.data(n,r)&&(i[n]=r.input.value)})}return e.subcontext&&!1!==t.recurse&&(n.subcontext=e.subcontext.map(e=>e.getState(t))),n},setState:function(t){var e=this,n=e.dataflow,r=t.data,i=t.signals;Object.keys(i||{}).forEach(t=>{n.update(e.signals[t],i[t],RT)}),Object.keys(r||{}).forEach(t=>{n.pulse(e.data[t].input,n.changeset().remove(Wt).insert(r[t]))}),(t.subcontext||[]).forEach((t,n)=>{var r=e.subcontext[n];r&&r.setState(t)})}};var PT={skip:!0};function zT(t,e){var n=t.autosize(),r=t.padding();return e-(n&&"padding"===n.contains?r.left+r.right:0)}function LT(t,e){var n=t.autosize(),r=t.padding();return e-(n&&"padding"===n.contains?r.top+r.bottom:0)}function BT(t,e){return e.modified&&Jt(e.input.value)&&t.indexOf("_:vega:_")}function jT(t,e){return!("parent"===t||e instanceof _a.proxy)}var UT=function(t,e,n,r){var i=t.element();i&&i.setAttribute("title",function(t){return null==t?"":Jt(t)?VT(t):te(t)&&!qe(t)?(e=t,Object.keys(e).map((function(t){var n=e[t];return t+": "+(Jt(n)?VT(n):WT(n))})).join("\n")):t+"";var e}(r))};function VT(t){return"["+t.map(WT).join(", ")+"]"}function WT(t){return Jt(t)?"[\u2026]":te(t)&&!qe(t)?"{\u2026}":t}function qT(t,e){const n=this;if(e=e||{},ga.call(n),e.loader&&n.loader(e.loader),e.logger&&n.logger(e.logger),null!=e.logLevel&&n.logLevel(e.logLevel),e.locale||t.locale){const r=Fe({},t.locale,e.locale);n.locale(Zo(r.number,r.time))}n._el=null,n._elBind=null,n._renderType=e.renderer||tb.Canvas,n._scenegraph=new fp;const r=n._scenegraph.root;n._renderer=null,n._tooltip=e.tooltip||UT,n._redraw=!0,n._handler=(new $p).scene(r),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=function(t){const e=Fe({defaults:{}},t),n=(t,e)=>{e.forEach(e=>{Jt(t[e])&&(t[e]=ln(t[e]))})};return n(e.defaults,["prevent","allow"]),n(e,["view","window","selector"]),e}(t.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const i=function(t,e,n){return FT(t,_a,bT,n).parse(e)}(n,t,e.expr);n._runtime=i,n._signals=i.signals,n._bind=(t.bindings||[]).map(t=>({state:null,param:Fe({},t)})),i.root&&i.root.set(r),r.source=i.data.root.input,n.pulse(i.data.root.input,n.changeset().insert(r.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=zT(n,n._width),n._viewHeight=LT(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,function(t){var e=t._signals,n=e.width,r=e.height,i=e.padding;function s(){t._autosize=t._resize=1}t._resizeWidth=t.add(null,(function(e){t._width=e.size,t._viewWidth=zT(t,e.size),s()}),{size:n}),t._resizeHeight=t.add(null,(function(e){t._height=e.size,t._viewHeight=LT(t,e.size),s()}),{size:r});var o=t.add(null,s,{pad:i});t._resizeWidth.rank=n.rank+1,t._resizeHeight.rank=r.rank+1,o.rank=i.rank+1}(n),function(t){t.add(null,e=>(t._background=e.bg,t._resize=1,e.bg),{bg:t._signals.background})}(n),function(t){const e=t._signals.cursor||(t._signals.cursor=t.add({user:"default",item:null}));t.on(t.events("view","mousemove"),e,(function(t,n){const r=e.value,i=r?Ye(r)?r:r.user:"default",s=n.item&&n.item.cursor||null;return r&&i===r.user&&s==r.item?r:{user:i,item:s}})),t.add(null,(function(e){let n=e.cursor,r=this.value;return Ye(n)||(r=n.item,n=n.user),yA(t,n&&"default"!==n?n:r||n),r}),{cursor:e})}(n),n.description(t.description),e.hover&&n.hover(),e.container&&n.initialize(e.container,e.bind)}var HT=Ue(qT,ga);function GT(t,e){return ze(t._signals,e)?t._signals[e]:$t("Unrecognized signal name: "+nn(e))}function YT(t,e){const n=(t._targets||[]).filter(t=>t._update&&t._update.handler===e);return n.length?n[0]:null}function KT(t,e,n,r){var i=YT(n,r);return i||((i=$A(t,()=>r(e,n.value))).handler=r,t.on(n,null,i)),t}function XT(t,e,n){var r=YT(e,n);return r&&e._targets.remove(r),t}HT.evaluate=async function(t,e,n){if(await ga.prototype.evaluate.call(this,t,e),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,i=wA(r=this),s=xA(r),o=_A(r),r._renderer.background(r.background()),r._renderer.resize(s,o,i),r._handler.origin(i),r._resizeListeners.forEach((function(t){try{t(s,o)}catch(e){r.error(e)}}))),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(a){this.error(a)}var r,i,s,o;return n&&dn(this,n),this},HT.dirty=function(t){this._redraw=!0,this._renderer&&this._renderer.dirty(t)},HT.description=function(t){if(arguments.length){const e=null!=t?t+"":null;return e!==this._desc&&gA(this._el,this._desc=e),this}return this._desc},HT.container=function(){return this._el},HT.scenegraph=function(){return this._scenegraph},HT.origin=function(){return this._origin.slice()},HT.signal=function(t,e,n){var r=GT(this,t);return 1===arguments.length?r.value:this.update(r,e,n)},HT.width=function(t){return arguments.length?this.signal("width",t):this.signal("width")},HT.height=function(t){return arguments.length?this.signal("height",t):this.signal("height")},HT.padding=function(t){return arguments.length?this.signal("padding",LA(t)):LA(this.signal("padding"))},HT.autosize=function(t){return arguments.length?this.signal("autosize",t):this.signal("autosize")},HT.background=function(t){return arguments.length?this.signal("background",t):this.signal("background")},HT.renderer=function(t){return arguments.length?(nb(t)||$t("Unrecognized renderer type: "+t),t!==this._renderType&&(this._renderType=t,this._resetRenderer()),this):this._renderType},HT.tooltip=function(t){return arguments.length?(t!==this._tooltip&&(this._tooltip=t,this._resetRenderer()),this):this._tooltip},HT.loader=function(t){return arguments.length?(t!==this._loader&&(ga.prototype.loader.call(this,t),this._resetRenderer()),this):this._loader},HT.resize=function(){return this._autosize=1,this.touch(GT(this,"autosize"))},HT._resetRenderer=function(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},HT._resizeView=function(t,e,n,r,i,s){this.runAfter((function(o){var a=0;o._autosize=0,o.width()!==n&&(a=1,o.signal("width",n,PT),o._resizeWidth.skip(!0)),o.height()!==r&&(a=1,o.signal("height",r,PT),o._resizeHeight.skip(!0)),o._viewWidth!==t&&(o._resize=1,o._viewWidth=t),o._viewHeight!==e&&(o._resize=1,o._viewHeight=e),o._origin[0]===i[0]&&o._origin[1]===i[1]||(o._resize=1,o._origin=i),a&&o.run("enter"),s&&o.runAfter(t=>t.resize())}),!1,1)},HT.addEventListener=function(t,e,n){var r=e;return n&&!1===n.trap||((r=$A(this,e)).raw=e),this._handler.on(t,r),this},HT.removeEventListener=function(t,e){for(var n,r,i=this._handler.handlers(t),s=i.length;--s>=0;)if(n=i[s].handler,t===(r=i[s].type)&&(e===n||e===n.raw)){this._handler.off(r,n);break}return this},HT.addResizeListener=function(t){var e=this._resizeListeners;return e.indexOf(t)<0&&e.push(t),this},HT.removeResizeListener=function(t){var e=this._resizeListeners,n=e.indexOf(t);return n>=0&&e.splice(n,1),this},HT.addSignalListener=function(t,e){return KT(this,t,GT(this,t),e)},HT.removeSignalListener=function(t,e){return XT(this,GT(this,t),e)},HT.addDataListener=function(t,e){return KT(this,t,vA(this,t).values,e)},HT.removeDataListener=function(t,e){return XT(this,vA(this,t).values,e)},HT.globalCursor=function(t){if(arguments.length){if(this._globalCursor!==!!t){const e=yA(this,null);this._globalCursor=!!t,e&&yA(this,e)}return this}return this._globalCursor},HT.preventDefault=function(t){return arguments.length?(this._preventDefault=t,this):this._preventDefault},HT.timer=function(t,e){this._timers.push(function(t,e,n){var r=new UC,i=e;return null==e?(r.restart(t,e,n),r):(e=+e,n=null==n?BC():+n,r.restart((function s(o){o+=i,r.restart(s,i+=e,n),t(o)}),e,n),r)}((function(e){t({timestamp:Date.now(),elapsed:e})}),e))},HT.events=function(t,e,n){var r,i=this,s=new Fn(n),o=function(n,r){i.runAsync(null,()=>{"view"===t&&function(t,e){var n=t._eventConfig.defaults,r=n.prevent,i=n.allow;return!1!==r&&!0!==i&&(!0===r||!1===i||(r?r[e]:i?!i[e]:t.preventDefault()))}(i,e)&&n.preventDefault(),s.receive(function(t,e,n){var r,i,s=t._renderer,o=s&&s.canvas();return o&&(i=wA(t),(r=_p(e.changedTouches?e.changedTouches[0]:e,o))[0]-=i[0],r[1]-=i[1]),e.dataflow=t,e.item=n,e.vega=function(t,e,n){var r=e?"group"===e.mark.marktype?e:e.mark.group:null;function i(t){var n,i=r;if(t)for(n=e;n;n=n.mark.group)if(n.mark.name===t){i=n;break}return i&&i.mark&&i.mark.interactive?i:{}}function s(t){if(!t)return n;Ye(t)&&(t=i(t));for(var e=n.slice();t;)e[0]-=t.x||0,e[1]-=t.y||0,t=t.mark&&t.mark.group;return e}return{view:Ie(t),item:Ie(e||{}),group:i,xy:s,x:function(t){return s(t)[0]},y:function(t){return s(t)[1]}}}(t,n,r),e}(i,n,r))})};if("timer"===t)CA(i,"timer",e)&&i.timer(o,e);else if("view"===t)CA(i,"view",e)&&i.addEventListener(e,o,SA);else if("window"===t?CA(i,"window",e)&&"undefined"!=typeof window&&(r=[window]):"undefined"!=typeof document&&CA(i,"selector",e)&&(r=document.querySelectorAll(t)),r){for(var a=0,l=r.length;a<l;++a)r[a].addEventListener(e,o);i._eventListeners.push({type:e,sources:r,handler:o})}else i.warn("Can not resolve event source: "+t);return s},HT.finalize=function(){var t,e,n,r=this._tooltip,i=this._timers,s=this._eventListeners;for(t=i.length;--t>=0;)i[t].stop();for(t=s.length;--t>=0;)for(e=(n=s[t]).sources.length;--e>=0;)n.sources[e].removeEventListener(n.type,n.handler);return r&&r.call(this,this._handler,null,null,null),this},HT.hover=function(t,e){return e=[e||"update",(t=[t||"hover"])[0]],this.on(this.events("view","mouseover",EA),kA,AA(t)),this.on(this.events("view","mouseout",EA),kA,AA(e)),this},HT.data=function(t,e){return arguments.length<2?vA(this,t).values.value:bA.call(this,t,Cn().remove(Wt).insert(e))},HT.change=bA,HT.insert=function(t,e){return bA.call(this,t,Cn().insert(e))},HT.remove=function(t,e){return bA.call(this,t,Cn().remove(e))},HT.scale=function(t){var e=this._runtime.scales;return ze(e,t)||$t("Unrecognized scale or projection: "+t),e[t].value},HT.initialize=function(t,e){const n=this,r=n._renderType,i=n._eventConfig.bind,s=nb(r);t=n._el=t?PA(n,t):null,function(t){const e=t.container();e&&(e.setAttribute("role","graphics-document"),e.setAttribute("aria-roleDescription","visualization"),gA(e,t.description()))}(n),s||n.error("Unrecognized renderer type: "+r);const o=s.handler||$p,a=t?s.renderer:s.headless;return n._renderer=a?MA(n,n._renderer,t,a):null,n._handler=function(t,e,n,r){var i=new r(t.loader(),$A(t,t.tooltip())).scene(t.scenegraph().root).initialize(n,wA(t),t);return e&&e.handlers().forEach((function(t){i.on(t.type,t.handler)})),i}(n,n._handler,t,o),n._redraw=!0,t&&"none"!==i&&(e=e?n._elBind=PA(n,e):t.appendChild(DA("form",{class:"vega-bindings"})),n._bind.forEach((function(t){t.param.element&&"container"!==i&&(t.element=PA(n,t.param.element))})),n._bind.forEach((function(t){!function(t,e,n){if(!e)return;const r=n.param;let i=n.state;i||(i=n.state={elements:null,active:!1,set:null,update:e=>{e!==t.signal(r.signal)&&t.runAsync(null,(function(){i.source=!0,t.signal(r.signal,e)}))}},r.debounce&&(i.update=Re(r.debounce,i.update))),function(t,e,n,r){const i=DA("div",{class:"vega-bind"}),s="radio"===n.input?i:i.appendChild(DA("label"));s.appendChild(DA("span",{class:"vega-bind-name"},n.name||n.signal)),e.appendChild(i);let o=NA;switch(n.input){case"checkbox":o=TA;break;case"select":o=OA;break;case"radio":o=IA;break;case"range":o=RA}o(t,s,n,r)}(i,e,r,t.signal(r.signal)),i.active||(t.on(t._signals[r.signal],null,()=>{i.source?i.source=!1:i.set(t.signal(r.signal))}),i.active=!0)}(n,t.element||e,t)}))),n},HT.toImageURL=async function(t,e){t!==tb.Canvas&&t!==tb.SVG&&t!==tb.PNG&&$t("Unrecognized image type: "+t);const n=await BA(this,t,e);return t===tb.SVG?(r=n.svg(),i=new Blob([r],{type:"image/svg+xml"}),window.URL.createObjectURL(i)):n.canvas().toDataURL("image/png");var r,i},HT.toCanvas=async function(t,e){return(await BA(this,tb.Canvas,t,e)).canvas()},HT.toSVG=async function(t){return(await BA(this,tb.SVG,t)).svg()},HT.getState=function(t){return this._runtime.getState(t||{data:BT,signals:jT,recurse:!0})},HT.setState=function(t){return this.runAsync(null,e=>{e._trigger=!1,e._runtime.setState(t)},t=>{t._trigger=!0}),this};var ZT=function(t){return te(t)?t:{type:t||"pad"}};const QT=t=>+t||0;var JT=function(t){return te(t)?t.signal?t:{top:QT(t.top),bottom:QT(t.bottom),left:QT(t.left),right:QT(t.right)}:{top:e=QT(t),bottom:e,left:e,right:e};var e};const tO=t=>te(t)&&!Jt(t)?Fe({},t):{value:t};function eO(t,e,n,r){return null!=n?(te(n)&&!Jt(n)?t.update[e]=n:t[r||"enter"][e]={value:n},1):0}function nO(t,e,n){for(const r in e)eO(t,r,e[r]);for(const r in n)eO(t,r,n[r],"update")}function rO(t,e,n){for(const r in e)n&&ze(n,r)||(t[r]=Fe(t[r]||{},e[r]));return t}function iO(t,e){return e&&(e.enter&&e.enter[t]||e.update&&e.update[t])}function sO(t,e,n){t[e]=n&&n.signal?{signal:n.signal}:{value:n}}const oO=t=>Ye(t)?nn(t):t.signal?`(${t.signal})`:cO(t);function aO(t){if(null!=t.gradient)return function(t){const e=[t.start,t.stop,t.count].map(t=>null==t?null:nn(t));for(;e.length&&null==se(e);)e.pop();return e.unshift(oO(t.gradient)),`gradient(${e.join(",")})`}(t);let e=t.signal?`(${t.signal})`:t.color?function(t){return t.c?lO("hcl",t.h,t.c,t.l):t.h||t.s?lO("hsl",t.h,t.s,t.l):t.l||t.a?lO("lab",t.l,t.a,t.b):t.r||t.g||t.b?lO("rgb",t.r,t.g,t.b):null}(t.color):null!=t.field?cO(t.field):void 0!==t.value?nn(t.value):void 0;return null!=t.scale&&(e=function(t,e){const n=oO(t.scale);return null!=t.range?e=`lerp(_range(${n}), ${+t.range})`:(void 0!==e&&(e=`_scale(${n}, ${e})`),t.band&&(e=(e?e+"+":"")+`_bandwidth(${n})`+(1==+t.band?"":"*"+uO(t.band)),t.extra&&(e=`(datum.extra ? _scale(${n}, datum.extra.value) : ${e})`)),null==e&&(e="0")),e}(t,e)),void 0===e&&(e=null),null!=t.exponent&&(e=`pow(${e},${uO(t.exponent)})`),null!=t.mult&&(e+="*"+uO(t.mult)),null!=t.offset&&(e+="+"+uO(t.offset)),t.round&&(e=`round(${e})`),e}const lO=(t,e,n,r)=>`(${t}(${[e,n,r].map(aO).join(",")})+'')`;function uO(t){return te(t)?"("+aO(t)+")":t}function cO(t){return function t(e){let n,r,i;if(e.signal)n="datum",i=e.signal;else if(e.group||e.parent){for(r=Math.max(1,e.level||1),n="item";r-- >0;)n+=".mark.group";e.parent?(i=e.parent,n+=".datum"):i=e.group}else e.datum?(n="datum",i=e.datum):$t("Invalid field reference: "+nn(e));return e.signal||(i=Ye(i)?Pt(i).map(nn).join("]["):t(i)),n+"["+i+"]"}(te(t)?t:{datum:t})}var hO=function(t,e,n,r,i,s){const o={};(s=s||{}).encoders={$encode:o},t=function(t,e,n,r,i){const s={},o={};let a,l,u,c;for(l in l="lineBreak","text"!==e||null==i[l]||iO(l,t)||sO(s,l,i[l]),("legend"==n||String(n).startsWith("axis"))&&(n=null),c="frame"===n?i.group:"mark"===n?Fe({},i.mark,i[e]):null,c)u=iO(l,t)||("fill"===l||"stroke"===l)&&(iO("fill",t)||iO("stroke",t)),u||sO(s,l,c[l]);for(l in Ce(r).forEach(e=>{const n=i.style&&i.style[e];for(const r in n)iO(r,t)||sO(s,r,n[r])}),t=Fe({},t),s)c=s[l],c.signal?(a=a||{})[l]=c:o[l]=c;return t.enter=Fe(o,t.enter),a&&(t.update=Fe(a,t.update)),t}(t,e,n,r,i.config);for(const a in t)o[a]=dO(t[a],e,s,i);return s};function dO(t,e,n,r){const i={},s={};for(const a in t)null!=t[a]&&(i[a]=fO(Jt(o=t[a])?function(t){let e="";return t.forEach(t=>{const n=aO(t);e+=t.test?`(${t.test})?${n}:`:n}),":"===se(e)&&(e+="null"),e}(o):aO(o),r,n,s));var o;return{$expr:{marktype:e,channels:i},$fields:Object.keys(s),$output:Object.keys(t)}}function fO(t,e,n,r){const i=ET(t,e);return i.$fields.forEach(t=>r[t]=1),Fe(n,i.$params),i.$expr}var pO=["value","update","init","react","bind"];function mO(t,e){$t(t+' for "outer" push: '+nn(e))}var gO=function(t,e){var n=t.name;if("outer"===t.push)e.signals[n]||mO("No prior signal definition",n),pO.forEach((function(e){void 0!==t[e]&&mO("Invalid property ",e)}));else{var r=e.addSignal(n,t.value);!1===t.react&&(r.react=!1),t.bind&&e.addBinding(n,t.bind)}};function yO(t,e,n,r){this.id=-1,this.type=t,this.value=e,this.params=n,r&&(this.parent=r)}function vO(t,e,n,r){return new yO(t,e,n,r)}function bO(t,e){return vO("operator",t,e)}function xO(t){var e={$ref:t.id};return t.id<0&&(t.refs=t.refs||[]).push(e),e}function _O(t,e){return e?{$field:t,$name:e}:{$field:t}}var wO=_O("key");function SO(t,e){return{$compare:t,$order:e}}function CO(t,e){return(t&&t.signal?"$"+t.signal:t||"")+(t&&e?"_":"")+(e&&e.signal?"$"+e.signal:e||"")}function EO(t){return t&&t.signal}function kO(t){if(EO(t))return!0;if(te(t))for(var e in t)if(kO(t[e]))return!0;return!1}function AO(t,e){return null!=t?t:e}function DO(t){return t&&t.signal||t}function NO(t,e){return(t.merge?TO:t.stream?OO:t.type?IO:$t("Invalid stream specification: "+nn(t)))(t,e)}function TO(t,e){var n=RO({merge:t.merge.map(t=>NO(t,e))},t,e);return e.addStream(n).id}function OO(t,e){var n=RO({stream:NO(t.stream,e)},t,e);return e.addStream(n).id}function IO(t,e){var n,r,i;return"timer"===t.type?(n=e.event("timer",t.throttle),t={between:t.between,filter:t.filter}):n=e.event("scope"===(i=t.source)?"view":i||"view",t.type),r=RO({stream:n},t,e),1===Object.keys(r).length?n:e.addStream(r).id}function RO(t,e,n){var r,i,s,o,a=e.between;return a&&(2!==a.length&&$t('Stream "between" parameter must have 2 entries: '+nn(e)),t.between=[NO(a[0],n),NO(a[1],n)]),a=e.filter?[].concat(e.filter):[],(e.marktype||e.markname||e.markrole)&&a.push((o="event.item")+((r=e.marktype)&&"*"!==r?"&&"+o+".mark.marktype==='"+r+"'":"")+((s=e.markrole)?"&&"+o+".mark.role==='"+s+"'":"")+((i=e.markname)?"&&"+o+".mark.name==='"+i+"'":"")),"scope"===e.source&&a.push("inScope(event.item)"),a.length&&(t.filter=ET("("+a.join(")&&(")+")",n).$expr),null!=(a=e.throttle)&&(t.throttle=+a),null!=(a=e.debounce)&&(t.debounce=+a),e.consume&&(t.consume=!0),t}var FO,MO,$O=function(t,e,n){return FO=e||PO,MO=n||LO,jO(t.trim()).map(UO)},PO="view",zO=/[[\]{}]/,LO={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};function BO(t,e,n,r,i){for(var s,o=0,a=t.length;e<a;++e){if(s=t[e],!o&&s===n)return e;i&&i.indexOf(s)>=0?--o:r&&r.indexOf(s)>=0&&++o}return e}function jO(t){for(var e=[],n=0,r=t.length,i=0;i<r;)i=BO(t,i,",","[{","]}"),e.push(t.substring(n,i).trim()),n=++i;if(0===e.length)throw"Empty event selector: "+t;return e}function UO(t){return"["===t[0]?function(t){var e,n,r=t.length,i=1;if((i=BO(t,i,"]","[","]"))===r)throw"Empty between selector: "+t;if(2!==(e=jO(t.substring(1,i))).length)throw"Between selector must have two elements: "+t;if(">"!==(t=t.slice(i+1).trim())[0])throw"Expected '>' after between selector: "+t;return e=e.map(UO),(n=UO(t.slice(1).trim())).between?{between:e,stream:n}:(n.between=e,n)}(t):function(t){var e,n,r={source:FO},i=[],s=[0,0],o=0,a=0,l=t.length,u=0;if("}"===t[l-1]){if(!((u=t.lastIndexOf("{"))>=0))throw"Unmatched right brace: "+t;try{s=function(t){var e=t.split(",");if(!t.length||e.length>2)throw t;return e.map((function(e){var n=+e;if(n!=n)throw t;return n}))}(t.substring(u+1,l-1))}catch(c){throw"Invalid throttle specification: "+t}l=(t=t.slice(0,u).trim()).length,u=0}if(!l)throw t;if("@"===t[0]&&(o=++u),(e=BO(t,u,":"))<l&&(i.push(t.substring(a,e).trim()),a=u=++e),(u=BO(t,u,"["))===l)i.push(t.substring(a,l).trim());else if(i.push(t.substring(a,u).trim()),n=[],(a=++u)===l)throw"Unmatched left bracket: "+t;for(;u<l;){if((u=BO(t,u,"]"))===l)throw"Unmatched left bracket: "+t;if(n.push(t.substring(a,u).trim()),u<l-1&&"["!==t[++u])throw"Expected left bracket: "+t;a=++u}if(!(l=i.length)||zO.test(i[l-1]))throw"Invalid event selector: "+t;return l>1?(r.type=i[1],o?r.markname=i[0].slice(1):MO[i[0]]?r.marktype=i[0]:r.source=i[0]):r.type=i[0],"!"===r.type.slice(-1)&&(r.consume=!0,r.type=r.type.slice(0,-1)),null!=n&&(r.filter=n),s[0]&&(r.throttle=s[0]),s[1]&&(r.debounce=s[1]),r}(t)}const VO={code:"_.$value",ast:{type:"Identifier",value:"value"}};function WO(t){return{signal:"["+t.map(t=>t.scale?'scale("'+t.scale+'")':t.signal)+"]"}}const qO=t=>(e,n,r)=>vO(t,n,e||void 0,r);var HO=qO("aggregate"),GO=qO("axisticks"),YO=qO("bound"),KO=qO("collect"),XO=qO("compare"),ZO=qO("datajoin"),QO=qO("encode"),JO=qO("expression"),tI=(qO("extent"),qO("facet")),eI=qO("field"),nI=qO("key"),rI=qO("legendentries"),iI=qO("load"),sI=qO("mark"),oI=qO("multiextent"),aI=qO("multivalues"),lI=qO("overlap"),uI=qO("params"),cI=qO("prefacet"),hI=qO("projection"),dI=qO("proxy"),fI=qO("relay"),pI=qO("render"),mI=qO("scale"),gI=qO("sieve"),yI=qO("sortitems"),vI=qO("viewlayout"),bI=qO("values"),xI=0,_I={min:"min",max:"max",count:"sum"};function wI(t,e){return te(t)?t.signal?e.signalRef(t.signal):$t("Unsupported object: "+nn(t)):t}function SI(t,e){return t.signal?e.signalRef(t.signal):t.map(t=>wI(t,e))}function CI(t){$t("Can not find data set: "+nn(t))}function EI(t,e,n){if(t)return t.signal?n.signalRef(t.signal):(Jt(t)?kI:t.fields?DI:AI)(t,e,n);null==e.domainMin&&null==e.domainMax||$t("No scale domain defined for domainMin/domainMax to override.")}function kI(t,e,n){return t.map((function(t){return wI(t,n)}))}function AI(t,e,n){var r=n.getData(t.data);return r||CI(t.data),ty(e.type)?r.valuesRef(n,t.field,TI(t.sort,!1)):iy(e.type)?r.domainRef(n,t.field):r.extentRef(n,t.field)}function DI(t,e,n){var r=t.data,i=t.fields.reduce((function(t,e){return e=Ye(e)?{data:r,field:e}:Jt(e)||e.signal?function(t,e){var n="_:vega:_"+xI++,r=KO({});if(Jt(t))r.value={$ingest:t};else if(t.signal){var i="setdata("+nn(n)+","+t.signal+")";r.params.input=e.signalRef(i)}return e.addDataPipeline(n,[r,gI({})]),{data:n,field:"data"}}(e,n):e,t.push(e),t}),[]);return(ty(e.type)?NI:iy(e.type)?OI:II)(t,n,i)}function NI(t,e,n){var r,i,s,o,a,l=TI(t.sort,!0);return r=n.map((function(t){var n=e.getData(t.data);return n||CI(t.data),n.countsRef(e,t.field,l)})),i={groupby:wO,pulse:r},l&&(s=l.op||"count",a=l.field?CO(s,l.field):"count",i.ops=[_I[s]],i.fields=[e.fieldRef(a)],i.as=[a]),s=e.add(HO(i)),o=e.add(KO({pulse:xO(s)})),a=e.add(bI({field:wO,sort:e.sortRef(l),pulse:xO(o)})),xO(a)}function TI(t,e){return t&&(t.field||t.op?t.field||"count"===t.op?e&&t.field&&t.op&&!_I[t.op]&&$t("Multiple domain scales can not be sorted using "+t.op):$t("No field provided for sort aggregate op: "+t.op):te(t)?t.field="key":t={field:"key"}),t}function OI(t,e,n){var r=n.map((function(t){var n=e.getData(t.data);return n||CI(t.data),n.domainRef(e,t.field)}));return xO(e.add(aI({values:r})))}function II(t,e,n){var r=n.map((function(t){var n=e.getData(t.data);return n||CI(t.data),n.extentRef(e,t.field)}));return xO(e.add(oI({extents:r})))}function RI(t,e,n){return Jt(t)?t.map((function(t){return RI(t,e,n)})):te(t)?t.signal?n.signalRef(t.signal):"fit"===e?t:$t("Unsupported parameter object: "+nn(t)):t}const FI="value",MI=["size","shape","fill","stroke","strokeWidth","strokeDash","opacity"],$I={name:1,style:1,interactive:1},PI={value:0},zI={value:1};var LI=function(t){return t.type="group",t.interactive=t.interactive||!1,t};function BI(t,e){const n=(n,r)=>AO(t[n],AO(e[n],r));return n.isVertical=n=>"vertical"===AO(t.direction,e.direction||(n?e.symbolDirection:e.gradientDirection)),n.gradientLength=()=>AO(t.gradientLength,e.gradientLength||e.gradientWidth),n.gradientThickness=()=>AO(t.gradientThickness,e.gradientThickness||e.gradientHeight),n.entryColumns=()=>AO(t.columns,AO(e.columns,+n.isVertical(!0))),n}function jI(t,e){var n=e&&(e.update&&e.update[t]||e.enter&&e.enter[t]);return n&&n.signal?n:n?n.value:null}function UI(t,e,n){return`item.anchor === 'start' ? ${t} : item.anchor === 'end' ? ${e} : ${n}`}const VI=UI(nn("left"),nn("right"),nn("center"));function WI(t,e){return e?t?te(t)?Object.assign({},t,{offset:WI(t.offset,e)}):{value:t,offset:e}:e:t}var qI=function(t,e){return e?(t.name=e.name,t.style=e.style||t.style,t.interactive=!!e.interactive,t.encode=rO(t.encode,e,$I)):t.interactive=!1,t},HI=function(t,e,n,r){var i,s,o,a,l,u,c=BI(t,n),h=c.isVertical(),d=c.gradientThickness(),f=c.gradientLength();return h?(o=[0,1],a=[0,0],l=d,u=f):(o=[0,0],a=[1,0],l=f,u=d),nO(i={enter:s={opacity:PI,x:PI,y:PI,width:tO(l),height:tO(u)},update:Fe({},s,{opacity:zI,fill:{gradient:e,start:o,stop:a}}),exit:{opacity:PI}},{stroke:c("gradientStrokeColor"),strokeWidth:c("gradientStrokeWidth")},{opacity:c("gradientOpacity")}),qI({type:"rect",role:"legend-gradient",encode:i},r)},GI=function(t,e,n,r,i){var s,o,a,l,u,c,h=BI(t,n),d=h.isVertical(),f=h.gradientThickness(),p=h.gradientLength(),m="";return d?(a="y",u="y2",l="x",c="width",m="1-"):(a="x",u="x2",l="y",c="height"),(o={opacity:PI,fill:{scale:e,field:FI}})[a]={signal:m+"datum.perc",mult:p},o[l]=PI,o[u]={signal:m+"datum.perc2",mult:p},o[c]=tO(f),nO(s={enter:o,update:Fe({},o,{opacity:zI}),exit:{opacity:PI}},{stroke:h("gradientStrokeColor"),strokeWidth:h("gradientStrokeWidth")},{opacity:h("gradientOpacity")}),qI({type:"rect",role:"legend-band",key:FI,from:i,encode:s},r)},YI=function(t,e,n,r){var i,s,o,a,l,u=BI(t,e),c=u.isVertical(),h=tO(u.gradientThickness()),d=u.gradientLength(),f=u("labelOverlap"),p="";return nO(i={enter:s={opacity:PI},update:o={opacity:zI,text:{field:"label"}},exit:{opacity:PI}},{fill:u("labelColor"),fillOpacity:u("labelOpacity"),font:u("labelFont"),fontSize:u("labelFontSize"),fontStyle:u("labelFontStyle"),fontWeight:u("labelFontWeight"),limit:AO(t.labelLimit,e.gradientLabelLimit)}),c?(s.align={value:"left"},s.baseline=o.baseline={signal:'datum.perc<=0?"bottom":datum.perc>=1?"top":"middle"'},a="y",l="x",p="1-"):(s.align=o.align={signal:'datum.perc<=0?"left":datum.perc>=1?"right":"center"'},s.baseline={value:"top"},a="x",l="y"),s[a]=o[a]={signal:p+"datum.perc",mult:d},s[l]=o[l]=h,h.offset=AO(t.labelOffset,e.gradientLabelOffset)||0,f=f?{separation:u("labelSeparation"),method:f,order:"datum.index"}:void 0,qI({type:"text",role:"legend-label",style:"guide-label",key:FI,from:r,encode:i,overlap:f},n)},KI=function(t,e,n,r,i){var s,o,a,l,u,c,h,d=BI(t,e),f=n.entries,p=!(!f||!f.interactive),m=f?f.name:void 0,g=d("clipHeight"),y=d("symbolOffset"),v={data:"value"},b={},x=`(${i}) ? datum.offset : datum.size`,_=g?tO(g):{field:"size"},w="datum.index",S=`max(1, ${i})`;_.mult=.5,b={enter:s={opacity:PI,x:{signal:x,mult:.5,offset:y},y:_},update:o={opacity:zI,x:s.x,y:s.y},exit:{opacity:PI}};var C=null,E=null;return t.fill||(C=e.symbolBaseFillColor,E=e.symbolBaseStrokeColor),nO(b,{fill:d("symbolFillColor",C),shape:d("symbolType"),size:d("symbolSize"),stroke:d("symbolStrokeColor",E),strokeDash:d("symbolDash"),strokeDashOffset:d("symbolDashOffset"),strokeWidth:d("symbolStrokeWidth")},{opacity:d("symbolOpacity")}),MI.forEach((function(e){t[e]&&(o[e]=s[e]={scale:t[e],field:FI})})),l=qI({type:"symbol",role:"legend-symbol",key:FI,from:v,clip:!!g||void 0,encode:b},n.symbols),(a=tO(y)).offset=d("labelOffset"),nO(b={enter:s={opacity:PI,x:{signal:x,offset:a},y:_},update:o={opacity:zI,text:{field:"label"},x:s.x,y:s.y},exit:{opacity:PI}},{align:d("labelAlign"),baseline:d("labelBaseline"),fill:d("labelColor"),fillOpacity:d("labelOpacity"),font:d("labelFont"),fontSize:d("labelFontSize"),fontStyle:d("labelFontStyle"),fontWeight:d("labelFontWeight"),limit:d("labelLimit")}),u=qI({type:"text",role:"legend-label",style:"guide-label",key:FI,from:v,encode:b},n.labels),b={enter:{noBound:{value:!g},width:PI,height:g?tO(g):PI,opacity:PI},exit:{opacity:PI},update:o={opacity:zI,row:{signal:null},column:{signal:null}}},d.isVertical(!0)?(o.row.signal=`${w}%${c=`ceil(item.mark.items.length / ${S})`}`,o.column.signal=`floor(${w} / ${c})`,h={field:["row",w]}):(o.row.signal=`floor(${w} / ${S})`,o.column.signal=`${w} % ${S}`,h={field:w}),o.column.signal=`(${i})?${o.column.signal}:${w}`,LI({role:"scope",from:r={facet:{data:r,name:"value",groupby:"index"}},encode:rO(b,f,$I),marks:[l,u],name:m,interactive:p,sort:h})};const XI='item.orient === "left"',ZI='item.orient === "right"',QI=`(${XI} || ${ZI})`,JI="datum.vgrad && "+QI,tR=UI('"top"','"bottom"','"middle"'),eR=`datum.vgrad && ${ZI} ? (${UI('"right"','"left"','"center"')}) : (${QI} && !(datum.vgrad && ${XI})) ? "left" : ${VI}`,nR=`item._anchor || (${QI} ? "middle" : "start")`,rR=`${JI} ? (${XI} ? -90 : 90) : 0`,iR=`${QI} ? (datum.vgrad ? (${ZI} ? "bottom" : "top") : ${tR}) : "top"`;var sR=function(t,e){var n;return te(t)&&(t.signal?n=t.signal:t.path?n="pathShape("+oR(t.path)+")":t.sphere&&(n="geoShape("+oR(t.sphere)+', {type: "Sphere"})')),n?e.signalRef(n):!!t};function oR(t){return te(t)&&t.signal?t.signal:nn(t)}var aR=function(t){var e=t.role||"";return e.indexOf("axis")&&e.indexOf("legend")&&e.indexOf("title")?"group"===t.type?"scope":e||"mark":e},lR=function(t){return{marktype:t.type,name:t.name||void 0,role:t.role||aR(t),zindex:+t.zindex||void 0,aria:t.aria,description:t.description}},uR=function(t,e){return t&&t.signal?e.signalRef(t.signal):!1!==t},cR=function(t,e){var n=wa(t.type);n||$t("Unrecognized transform type: "+nn(t.type));var r=vO(n.type.toLowerCase(),null,hR(n,t,e));return t.signal&&e.addSignal(t.signal,e.proxy(r)),r.metadata=n.metadata||{},r};function hR(t,e,n){var r,i,s,o={};for(i=0,s=t.params.length;i<s;++i)o[(r=t.params[i]).name]=dR(r,e,n);return o}function dR(t,e,n){var r=t.type,i=e[t.name];return"index"===r?function(t,e,n){return Ye(e.from)||$t('Lookup "from" parameter must be a string literal.'),n.getData(e.from).lookupRef(n,e.key)}(0,e,n):void 0!==i?"param"===r?function(t,e,n){var r=e[t.name];return t.array?(Jt(r)||$t("Expected an array of sub-parameters. Instead: "+nn(r)),r.map((function(e){return pR(t,e,n)}))):pR(t,r,n)}(t,e,n):"projection"===r?n.projectionRef(e[t.name]):t.array&&!EO(i)?i.map((function(e){return fR(t,e,n)})):fR(t,i,n):void(t.required&&$t("Missing required "+nn(e.type)+" parameter: "+nn(t.name)))}function fR(t,e,n){var r=t.type;if(EO(e))return mR(r)?$t("Expression references can not be signals."):gR(r)?n.fieldRef(e):yR(r)?n.compareRef(e):n.signalRef(e.signal);var i,s=t.expr||gR(r);return s&&(i=e)&&i.expr?n.exprRef(e.expr,e.as):s&&function(t){return t&&t.field}(e)?_O(e.field,e.as):mR(r)?ET(e,n):function(t){return"data"===t}(r)?xO(n.getData(e).values):gR(r)?_O(e):yR(r)?n.compareRef(e):e}function pR(t,e,n){var r,i,s,o,a;for(o=0,a=t.params.length;o<a;++o){for(s in(i=t.params[o]).key)if(i.key[s]!==e[s]){i=null;break}if(i)break}return i||$t("Unsupported parameter: "+nn(e)),r=Fe(hR(i,e,n),i.key),xO(n.add(uI(r)))}function mR(t){return"expr"===t}function gR(t){return"field"===t}function yR(t){return"compare"===t}function vR(t,e){return t.$ref?t:t.data&&t.data.$ref?t.data:xO(e.getData(t.data).output)}function bR(t,e,n,r,i){this.scope=t,this.input=e,this.output=n,this.values=r,this.aggregate=i,this.index={}}bR.fromEntries=function(t,e){var n=e.length,r=1,i=e[0],s=e[n-1],o=e[n-2],a=null;for(i&&"load"===i.type&&(i=e[1]),t.add(e[0]);r<n;++r)e[r].params.pulse=xO(e[r-1]),t.add(e[r]),"aggregate"===e[r].type&&(a=e[r]);return new bR(t,i,o,s,a)};var xR=bR.prototype;function _R(t){return Ye(t)?t:null}function wR(t,e,n){var r,i=CO(n.op,n.field);if(e.ops){for(var s=0,o=e.as.length;s<o;++s)if(e.as[s]===i)return}else e.ops=["count"],e.fields=[null],e.as=["count"];n.op&&(e.ops.push((r=n.op.signal)?t.signalRef(r):n.op),e.fields.push(t.fieldRef(n.field)),e.as.push(i))}function SR(t,e,n,r,i,s,o){var a,l,u=e[n]||(e[n]={}),c=function(t){return te(t)?("descending"===t.order?"-":"+")+CO(t.op,t.field):""}(s),h=_R(i);if(null!=h&&(t=e.scope,a=u[h+=c?"|"+c:""]),!a){var d=s?{field:wO,pulse:e.countsRef(t,i,s)}:{field:t.fieldRef(i),pulse:xO(e.output)};c&&(d.sort=t.sortRef(s)),l=t.add(vO(r,void 0,d)),o&&(e.index[i]=l),a=xO(l),null!=h&&(u[h]=a)}return a}xR.countsRef=function(t,e,n){var r,i,s,o=this.counts||(this.counts={}),a=_R(e);return null!=a&&(t=this.scope,r=o[a]),r?n&&n.field&&wR(t,r.agg.params,n):(s={groupby:t.fieldRef(e,"key"),pulse:xO(this.output)},n&&n.field&&wR(t,s,n),i=t.add(HO(s)),r=t.add(KO({pulse:xO(i)})),r={agg:i,ref:xO(r)},null!=a&&(o[a]=r)),r.ref},xR.tuplesRef=function(){return xO(this.values)},xR.extentRef=function(t,e){return SR(t,this,"extent","extent",e,!1)},xR.domainRef=function(t,e){return SR(t,this,"domain","values",e,!1)},xR.valuesRef=function(t,e,n){return SR(t,this,"vals","values",e,n||!0)},xR.lookupRef=function(t,e){return SR(t,this,"lookup","tupleindex",e,!1)},xR.indataRef=function(t,e){return SR(t,this,"indata","tupleindex",e,!0,!0)};var CR=function(t,e,n){var r,i,s=t.remove,o=t.insert,a=t.toggle,l=t.modify,u=t.values,c=e.add(bO());r="if("+t.trigger+',modify("'+n+'",'+[o,s,a,l,u].map((function(t){return null==t?"null":t})).join(",")+"),0)",i=ET(r,e),c.update=i.$expr,c.params=i.$params},ER=function(t,e){var n,r,i,s,o,a,l,u,c,h,d,f,p,m,g=aR(t),y="group"===t.type,v=t.from&&t.from.facet,b=t.layout||"scope"===g||"frame"===g,x="mark"===g||b||v,_=t.overlap;i=function(t,e,n){var r,i,s,o,a;return t?(r=t.facet)&&(e||$t("Only group marks can be faceted."),null!=r.field?o=a=vR(r,n):(t.data?a=xO(n.getData(t.data).aggregate):((s=cR(Fe({type:"aggregate",groupby:Ce(r.groupby)},r.aggregate),n)).params.key=n.keyRef(r.groupby),s.params.pulse=vR(r,n),o=a=xO(n.add(s))),i=n.keyRef(r.groupby,!0))):o=xO(n.add(KO(null,[{}]))),o||(o=vR(t,n)),{key:i,pulse:o,parent:a}}(t.from,y,e),h=xO(r=e.add(ZO({key:i.key||(t.key?_O(t.key):void 0),pulse:i.pulse,clean:!y}))),r=s=e.add(KO({pulse:h})),r=e.add(sI({markdef:lR(t),interactive:uR(t.interactive,e),clip:sR(t.clip,e),context:{$context:!0},groups:e.lookup(),parent:e.signals.parent?e.signalRef("parent"):null,index:e.markpath(),pulse:xO(r)})),d=xO(r),(r=o=e.add(QO(hO(t.encode,t.type,g,t.style,e,{mod:!1,pulse:d})))).params.parent=e.encode(),t.transform&&t.transform.forEach((function(t){const n=cR(t,e),i=n.metadata;(i.generates||i.changes)&&$t("Mark transforms should not generate new data."),i.nomod||(o.params.mod=!0),n.params.pulse=xO(r),e.add(r=n)})),t.sort&&(r=e.add(yI({sort:e.compareRef(t.sort),pulse:xO(r)}))),f=xO(r),(v||b)&&(p=xO(b=e.add(vI({layout:e.objectProperty(t.layout),legends:e.legends,mark:d,pulse:f})))),m=xO(a=e.add(YO({mark:d,pulse:p||f}))),y&&(x&&((n=e.operators).pop(),b&&n.pop()),e.pushState(f,p||m,h),v?function(t,e,n){var r,i,s,o,a=t.from.facet,l=a.name,u=vR(a,e);a.name||$t("Facet must have a name: "+nn(a)),a.data||$t("Facet must reference a data set: "+nn(a)),a.field?o=e.add(cI({field:e.fieldRef(a.field),pulse:u})):a.groupby?o=e.add(tI({key:e.keyRef(a.groupby),group:xO(e.proxy(n.parent)),pulse:u})):$t("Facet must specify groupby or field: "+nn(a)),i=(r=e.fork()).add(KO()),s=r.add(gI({pulse:xO(i)})),r.addData(l,new bR(r,i,i,s)),r.addSignal("parent",null),o.params.subflow={$subflow:r.parse(t).toRuntime()}}(t,e,i):x?function(t,e,n){var r=e.add(cI({pulse:n.pulse})),i=e.fork();i.add(gI()),i.addSignal("parent",null),r.params.subflow={$subflow:i.parse(t).toRuntime()}}(t,e,i):e.parse(t),e.popState(),x&&(b&&n.push(b),n.push(a))),_&&(m=function(t,e,n){var r,i=t.method,s=t.bound,o=t.separation,a={separation:EO(o)?n.signalRef(o.signal):o,method:EO(i)?n.signalRef(i.signal):i,pulse:e};return t.order&&(a.sort=n.compareRef({field:t.order})),s&&(a.boundTolerance=EO(r=s.tolerance)?n.signalRef(r.signal):+r,a.boundScale=n.scaleRef(s.scale),a.boundOrient=s.orient),xO(n.add(lI(a)))}(_,m,e)),l=e.add(pI({pulse:m})),u=e.add(gI({pulse:xO(l)},void 0,e.parent())),null!=t.name&&(e.addData(c=t.name,new bR(e,s,l,u)),t.on&&t.on.forEach((function(t){(t.insert||t.remove||t.toggle)&&$t("Marks only support modify triggers."),CR(t,e,c)})))};function kR(t,e,n){return e[t]?`scale("${e[t]}",datum)`:jI(t,n[0].encode)}function AR(t,e){var n={enter:{},update:{}};return nO(n,{orient:t("orient"),anchor:t("anchor"),align:{signal:VI},angle:{signal:'item.orient==="left"?-90:item.orient==="right"?90:0'},limit:t("limit"),frame:t("frame"),offset:t("offset")||0,padding:t("subtitlePadding")}),rO(n,e,$I)}function DR(t){var e=KO({},t);return e.metadata={source:!0},e}function NR(t,e){return iI({url:e.url?t.property(e.url):void 0,async:e.async?t.property(e.async):void 0,values:e.values?t.property(e.values):void 0,format:t.objectProperty(e.format)})}const TR=t=>"bottom"===t||"top"===t,OR=(t,e,n)=>EO(t)?PR(t.signal,e,n):"left"===t||"top"===t?e:n,IR=(t,e,n)=>EO(t)?MR(t.signal,e,n):TR(t)?e:n,RR=(t,e,n)=>EO(t)?$R(t.signal,e,n):TR(t)?n:e,FR=(t,e,n)=>EO(t)?zR(t.signal,e,n):"top"===t?{value:e}:{value:n},MR=(t,e,n)=>LR(`${t} === 'top' || ${t} === 'bottom'`,e,n),$R=(t,e,n)=>LR(`${t} !== 'top' && ${t} !== 'bottom'`,e,n),PR=(t,e,n)=>jR(`${t} === 'left' || ${t} === 'top'`,e,n),zR=(t,e,n)=>jR(t+" === 'top'",e,n),LR=(t,e,n)=>(e=null!=e?tO(e):e,n=null!=n?tO(n):n,BR(e)&&BR(n)?{signal:`${t} ? (${e=e?e.signal||nn(e.value):null}) : (${n=n?n.signal||nn(n.value):null})`}:[Fe({test:t},e)].concat(n||[])),BR=t=>null==t||1===Object.keys(t).length,jR=(t,e,n)=>({signal:`${t} ? (${UR(e)}) : (${UR(n)})`}),UR=t=>EO(t)?t.signal:null==t?null:nn(t),VR=(t,e)=>{const n=t.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+e.signal}:t};function WR(t,e,n,r){let i;if(e&&ze(e,t))return e[t];if(ze(n,t))return n[t];if(t.startsWith("title")){switch(t){case"titleColor":i="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":i=t[5].toLowerCase()+t.slice(6)}return r["guide-title"][i]}if(t.startsWith("label")){switch(t){case"labelColor":i="fill";break;case"labelFont":case"labelFontSize":i=t[5].toLowerCase()+t.slice(6)}return r["guide-label"][i]}return null}function qR(t){const e={};for(const n of t)if(n)for(const t in n)e[t]=1;return Object.keys(e)}function HR(t,e){return{scale:t.scale,range:e}}function GR(t,e,n,r,i){return{signal:'flush(range("'+t+'"), scale("'+t+'", datum.value), '+e+","+n+","+r+","+i+")"}}var YR=function(t,e){var n,r,i,s,o,a=function(t,e){var n,r,i,s,o,a,l,u,c=e.config,h=c.style,d=c.axis,f="band"===e.scaleType(t.scale)&&c.axisBand,p=t.orient;if(EO(p)){const t=qR([c.axisX,c.axisY]),e=qR([c.axisTop,c.axisBottom,c.axisLeft,c.axisRight]);for(i of(n={},t))n[i]=IR(p,WR(i,c.axisX,d,h),WR(i,c.axisY,d,h));for(i of(r={},e))r[i]=(s=p.signal,o=WR(i,c.axisTop,d,h),a=WR(i,c.axisBottom,d,h),l=WR(i,c.axisLeft,d,h),u=WR(i,c.axisRight,d,h),{signal:(null!=l?`${s} === 'left' ? (${UR(l)}) : `:"")+(null!=a?`${s} === 'bottom' ? (${UR(a)}) : `:"")+(null!=u?`${s} === 'right' ? (${UR(u)}) : `:"")+(null!=o?`${s} === 'top' ? (${UR(o)}) : `:"")+"(null)"})}else n="top"===p||"bottom"===p?c.axisX:c.axisY,r=c["axis"+p[0].toUpperCase()+p.slice(1)];return n||r||f?Fe({},d,n,r,f):d}(t,e),l=t.encode||{},u=l.axis||{},c=u.name||void 0,h=u.interactive,d=u.style,f=BI(t,a),p=function(t){let e,n,r=t("tickBand"),i=t("tickOffset");return r?r.signal?(e={signal:`(${r.signal}) === 'extent' ? 1 : 0.5`},n={signal:`(${r.signal}) === 'extent'`},te(i)||(i={signal:`(${r.signal}) === 'extent' ? 0 : ${i}`})):"extent"===r?(e=1,n=!0,i=0):(e=.5,n=!1):(e=t("bandPosition"),n=t("tickExtra")),{extra:n,band:e,offset:i}}(f);return n={scale:t.scale,ticks:!!f("ticks"),labels:!!f("labels"),grid:!!f("grid"),domain:!!f("domain"),title:null!=t.title},r=xO(e.add(KO({},[n]))),u=rO(function(t,e){var n={enter:{},update:{}};return nO(n,{orient:t("orient"),offset:t("offset")||0,position:AO(e.position,0),titlePadding:t("titlePadding"),minExtent:t("minExtent"),maxExtent:t("maxExtent"),range:{signal:`abs(span(range("${e.scale}")))`},translate:t("translate"),format:e.format,formatType:e.formatType}),n}(f,t),u,$I),i=xO(e.add(GO({scale:e.scaleRef(t.scale),extra:e.property(p.extra),count:e.objectProperty(t.tickCount),values:e.objectProperty(t.values),minstep:e.property(t.tickMinStep),formatType:e.property(t.formatType),formatSpecifier:e.property(t.format)}))),o=[],n.grid&&o.push(function(t,e,n,r,i){var s,o,a,l,u,c,h,d,f=BI(t,e),p=t.orient,m=t.gridScale,g=OR(p,1,-1),y=function(t,e){if(1===e);else if(te(t)){let n=t=Fe({},t);for(;null!=n.mult;){if(!te(n.mult))return n.mult=EO(e)?{signal:`(${n.mult}) * (${e.signal})`}:n.mult*e,t;n=n.mult=Fe({},n.mult)}n.mult=e}else t=EO(e)?{signal:`(${e.signal}) * (${t||0})`}:e*(t||0);return t}(t.offset,g);return nO(s={enter:o={opacity:PI},update:l={opacity:zI},exit:a={opacity:PI}},{stroke:f("gridColor"),strokeCap:f("gridCap"),strokeDash:f("gridDash"),strokeDashOffset:f("gridDashOffset"),strokeOpacity:f("gridOpacity"),strokeWidth:f("gridWidth")}),u={scale:t.scale,field:FI,band:i.band,extra:i.extra,offset:i.offset,round:f("tickRound")},d=IR(p,{signal:"height"},{signal:"width"}),c=m?{scale:m,range:0,mult:g,offset:y}:{value:0,offset:y},h=m?{scale:m,range:1,mult:g,offset:y}:Fe(d,{mult:g,offset:y}),o.x=l.x=IR(p,u,c),o.y=l.y=RR(p,u,c),o.x2=l.x2=RR(p,h),o.y2=l.y2=IR(p,h),a.x=IR(p,u),a.y=RR(p,u),qI({type:"rule",role:"axis-grid",key:FI,from:r,encode:s},n)}(t,a,l.grid,i,p)),n.ticks&&(s=f("tickSize"),o.push(function(t,e,n,r,i,s){var o,a,l,u,c,h,d=BI(t,e),f=t.orient,p=OR(f,-1,1);return nO(o={enter:a={opacity:PI},update:u={opacity:zI},exit:l={opacity:PI}},{stroke:d("tickColor"),strokeCap:d("tickCap"),strokeDash:d("tickDash"),strokeDashOffset:d("tickDashOffset"),strokeOpacity:d("tickOpacity"),strokeWidth:d("tickWidth")}),(c=tO(i)).mult=p,h={scale:t.scale,field:FI,band:s.band,extra:s.extra,offset:s.offset,round:d("tickRound")},u.y=a.y=IR(f,PI,h),u.y2=a.y2=IR(f,c),l.x=IR(f,h),u.x=a.x=RR(f,PI,h),u.x2=a.x2=RR(f,c),l.y=RR(f,h),qI({type:"rule",role:"axis-tick",key:FI,from:r,encode:o},n)}(t,a,l.ticks,i,s,p))),n.labels&&o.push(function(t,e,n,r,i,s){var o,a,l,u,c,h,d,f,p,m,g=BI(t,e),y=t.orient,v=t.scale,b=OR(y,-1,1),x=DO(g("labelFlush")),_=DO(g("labelFlushOffset")),w=0===x||!!x,S=g("labelAlign"),C=g("labelBaseline");return(u=tO(i)).mult=b,u.offset=tO(g("labelPadding")||0),u.offset.mult=b,c={scale:v,field:FI,band:.5,offset:WI(s.offset,g("labelOffset"))},h=IR(y,w?GR(v,x,'"left"','"right"','"center"'):{value:"center"},((t,e,n)=>EO(t)?jR(t.signal+" === 'right'","left","right"):"right"===t?{value:e}:{value:n})(y,"left","right")),d=IR(y,FR(y,"bottom","top"),w?GR(v,x,'"top"','"bottom"','"middle"'):{value:"middle"}),m=GR(v,x,`-(${_})`,_,0),w=w&&_,nO(o={enter:a={opacity:PI,x:IR(y,c,u),y:RR(y,c,u)},update:l={opacity:zI,text:{field:"label"},x:a.x,y:a.y,align:h,baseline:d},exit:{opacity:PI,x:a.x,y:a.y}},{dx:!S&&w?IR(y,m):null,dy:!C&&w?RR(y,m):null}),nO(o,{angle:g("labelAngle"),fill:g("labelColor"),fillOpacity:g("labelOpacity"),font:g("labelFont"),fontSize:g("labelFontSize"),fontWeight:g("labelFontWeight"),fontStyle:g("labelFontStyle"),limit:g("labelLimit"),lineHeight:g("labelLineHeight")},{align:S,baseline:C}),f=g("labelBound"),p=(p=g("labelOverlap"))||f?{separation:g("labelSeparation"),method:p,order:"datum.index",bound:f?{scale:v,orient:y,tolerance:f}:null}:void 0,l.align!==h&&(l.align=VR(l.align,h)),l.baseline!==d&&(l.baseline=VR(l.baseline,d)),qI({type:"text",role:"axis-label",style:"guide-label",key:FI,from:r,encode:o,overlap:p},n)}(t,a,l.labels,i,s=n.ticks?s:0,p)),n.domain&&o.push(function(t,e,n,r){var i,s,o,a=BI(t,e),l=t.orient;nO(i={enter:s={opacity:PI},update:o={opacity:zI},exit:{opacity:PI}},{stroke:a("domainColor"),strokeCap:a("domainCap"),strokeDash:a("domainDash"),strokeDashOffset:a("domainDashOffset"),strokeWidth:a("domainWidth"),strokeOpacity:a("domainOpacity")});const u=HR(t,0),c=HR(t,1);return s.x=o.x=IR(l,u,PI),s.x2=o.x2=IR(l,c),s.y=o.y=RR(l,u,PI),s.y2=o.y2=RR(l,c),qI({type:"rule",role:"axis-domain",from:r,encode:i},n)}(t,a,l.domain,r)),n.title&&o.push(function(t,e,n,r){var i,s,o,a,l=BI(t,e),u=t.orient,c=OR(u,-1,1);return i={enter:s={opacity:PI,anchor:tO(l("titleAnchor",null)),align:{signal:VI}},update:o=Fe({},s,{opacity:zI,text:tO(t.title)}),exit:{opacity:PI}},a={signal:`lerp(range("${t.scale}"), ${UI(0,1,.5)})`},o.x=IR(u,a),o.y=RR(u,a),s.angle=IR(u,PI,((t,e)=>EO(t)?{signal:`(${t.signal}) * 90`}:{value:90*t})(c)),s.baseline=IR(u,FR(u,"bottom","top"),{value:"bottom"}),o.angle=s.angle,o.baseline=s.baseline,nO(i,{fill:l("titleColor"),fillOpacity:l("titleOpacity"),font:l("titleFont"),fontSize:l("titleFontSize"),fontStyle:l("titleFontStyle"),fontWeight:l("titleFontWeight"),limit:l("titleLimit"),lineHeight:l("titleLineHeight")},{align:l("titleAlign"),angle:l("titleAngle"),baseline:l("titleBaseline")}),function(t,e,n,r){const i=(t,e)=>null!=t?(n.update[e]=VR(tO(t),n.update[e]),!1):!iO(e,r),s=i(t("titleX"),"x"),o=i(t("titleY"),"y");n.enter.auto=o===s?tO(o):IR(e,tO(o),tO(s))}(l,u,i,n),i.update.align=VR(i.update.align,s.align),i.update.angle=VR(i.update.angle,s.angle),i.update.baseline=VR(i.update.baseline,s.baseline),qI({type:"text",role:"axis-title",style:"guide-title",from:r,encode:i},n)}(t,a,l.title,r)),ER(LI({role:"axis",from:r,encode:u,marks:o,aria:f("aria"),description:f("description"),zindex:f("zindex"),name:c,interactive:h,style:d}),e)},KR=function(t,e,n){var r=Ce(t.signals),i=Ce(t.scales);return n||r.forEach(t=>gO(t,e)),Ce(t.projections).forEach(t=>function(t,e){var n=e.config.projection||{},r={};for(var i in t)"name"!==i&&(r[i]=RI(t[i],i,e));for(i in n)null==r[i]&&(r[i]=RI(n[i],i,e));e.addProjection(t.name,r)}(t,e)),i.forEach(t=>function(t,e){var n=t.type||"linear";Zg(n)||$t("Unrecognized scale type: "+nn(n)),e.addScale(t.name,{type:n,domain:void 0})}(t,e)),Ce(t.data).forEach(t=>function(t,e){var n=[];t.transform&&t.transform.forEach((function(t){n.push(cR(t,e))})),t.on&&t.on.forEach((function(n){CR(n,e,t.name)})),e.addDataPipeline(t.name,function(t,e,n){var r,i,s,o,a,l=[],u=null,c=!1,h=!1;for(t.values?kO(t.values)||kO(t.format)?(l.push(NR(e,t)),l.push(u=DR())):l.push(u=DR({$ingest:t.values,$format:t.format})):t.url?kO(t.url)||kO(t.format)?(l.push(NR(e,t)),l.push(u=DR())):l.push(u=DR({$request:t.url,$format:t.format})):t.source&&(u=r=Ce(t.source).map((function(t){return xO(e.getData(t).output)})),l.push(null)),i=0,s=n.length;i<s;++i)a=(o=n[i]).metadata,u||a.source||l.push(u=DR()),l.push(o),a.generates&&(h=!0),a.modifies&&!h&&(c=!0),a.source?u=o:a.changes&&(u=null);return r&&(l[0]=fI({derive:c,pulse:(s=r.length-1)?r:r[0]}),(c||s)&&l.splice(1,0,DR())),u||l.push(DR()),l.push(gI({})),l}(t,e,n))}(t,e)),i.forEach(t=>function(t,e){var n,r,i=e.getScale(t.name).params;for(n in i.domain=EI(t.domain,t,e),null!=t.range&&(i.range=function t(e,n,r){var i=e.range,s=n.config.range;if(i.signal)return n.signalRef(i.signal);if(Ye(i)){if(s&&ze(s,i))return t(e=Fe({},e,{range:s[i]}),n,r);"width"===i?i=[0,{signal:"width"}]:"height"===i?i=ty(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]:$t("Unrecognized scale range value: "+nn(i))}else{if(i.scheme)return r.scheme=Jt(i.scheme)?SI(i.scheme,n):wI(i.scheme,n),i.extent&&(r.schemeExtent=SI(i.extent,n)),void(i.count&&(r.schemeCount=wI(i.count,n)));if(i.step)return void(r.rangeStep=wI(i.step,n));if(ty(e.type)&&!Jt(i))return EI(i,e,n);Jt(i)||$t("Unsupported range type: "+nn(i))}return i.map(t=>(Jt(t)?SI:wI)(t,n))}(t,e,i)),null!=t.interpolate&&function(t,e){e.interpolate=wI(t.type||t),null!=t.gamma&&(e.interpolateGamma=wI(t.gamma))}(t.interpolate,i),null!=t.nice&&(i.nice=te(r=t.nice)?{interval:wI(r.interval),step:wI(r.step)}:wI(r)),null!=t.bins&&(i.bins=function(t,e){return t.signal||Jt(t)?SI(t,e):e.objectProperty(t)}(t.bins,e)),t)ze(i,n)||"name"===n||(i[n]=wI(t[n],e))}(t,e)),(n||r).forEach(t=>function(t,e){var n=e.getSignal(t.name),r=t.update;t.init&&(r?$t("Signals can not include both init and update expressions."):(r=t.init,n.initonly=!0)),r&&(r=ET(r,e),n.update=r.$expr,n.params=r.$params),t.on&&t.on.forEach((function(t){!function(t,e,n){var r=t.events,i=t.update,s=t.encode,o=[],a={target:n};r||$t("Signal update missing events specification."),Ye(r)&&(r=$O(r,e.isSubscope()?"scope":"view")),r=Ce(r).filter(t=>t.signal||t.scale?(o.push(t),0):1),o.length>1&&(o=[WO(o)]),r.length&&o.push(r.length>1?{merge:r}:r[0]),null!=s&&(i&&$t("Signal encode and update are mutually exclusive."),i="encode(item(),"+nn(s)+")"),a.update=Ye(i)?ET(i,e):null!=i.expr?ET(i.expr,e):null!=i.value?i.value:null!=i.signal?{$expr:VO,$params:{$value:e.signalRef(i.signal)}}:$t("Invalid signal update specification."),t.force&&(a.options={force:!0}),o.forEach((function(t){e.addUpdate(Fe(function(t,e){return{source:t.signal?e.signalRef(t.signal):t.scale?e.scaleRef(t.scale):NO(t,e)}}(t,e),a))}))}(t,e,n.id)}))}(t,e)),Ce(t.axes).forEach(t=>YR(t,e)),Ce(t.marks).forEach(t=>ER(t,e)),Ce(t.legends).forEach(t=>function(t,e){var n,r,i,s,o,a,l,u,c=e.config.legend,h=t.encode||{},d=h.legend||{},f=d.name||void 0,p=d.interactive,m=d.style,g=BI(t,c),y={},v=0;return MI.forEach(e=>t[e]?(y[e]=t[e],v=v||t[e]):0),v||$t("Missing valid scale for legend."),o=function(t,e){var n=t.type||"symbol";return t.type||1!==function(t){return MI.reduce((function(e,n){return e+(t[n]?1:0)}),0)}(t)||!t.fill&&!t.stroke||(n=Jg(e)?"gradient":ey(e)?"discrete":"symbol"),"gradient"!==n?n:ey(e)?"discrete":"gradient"}(t,e.scaleType(v)),a={title:null!=t.title,scales:y,type:o,vgrad:"symbol"!==o&&g.isVertical()},l=xO(e.add(KO(null,[a]))),d=rO(function(t,e,n){var r={enter:{},update:{}};return nO(r,{orient:t("orient"),offset:t("offset"),padding:t("padding"),titlePadding:t("titlePadding"),cornerRadius:t("cornerRadius"),fill:t("fillColor"),stroke:t("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:t("legendX"),y:t("legendY"),format:e.format,formatType:e.formatType}),r}(g,t,c),d,$I),n={enter:{x:{value:0},y:{value:0}}},u=xO(e.add(rI(i={type:o,scale:e.scaleRef(v),count:e.objectProperty(g("tickCount")),limit:e.property(g("symbolLimit")),values:e.objectProperty(t.values),minstep:e.property(t.tickMinStep),formatType:e.property(t.formatType),formatSpecifier:e.property(t.format)}))),"gradient"===o?(s=[HI(t,v,c,h.gradient),YI(t,c,h.labels,u)],i.count=i.count||e.signalRef(`max(2,2*floor((${DO(g.gradientLength())})/100))`)):"discrete"===o?s=[GI(t,v,c,h.gradient,u),YI(t,c,h.labels,u)]:(r=function(t,e){const n=BI(t,e);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}(t,c),s=[KI(t,c,h,u,DO(r.columns))],i.size=function(t,e,n){var r=DO(kR("size",t,n)),i=DO(kR("strokeWidth",t,n)),s=DO(function(t,e,n){return jI("fontSize",t)||function(t,e,n){var r=e.config.style["guide-label"];return r&&r.fontSize}(0,e)}(n[1].encode,e));return ET(`max(ceil(sqrt(${r})+${i}),${s})`,e)}(t,e,s[0].marks)),s=[LI({role:"legend-entry",from:l,encode:n,marks:s,layout:r,interactive:p})],a.title&&s.push(function(t,e,n,r){var i,s=BI(t,e);return nO(i={enter:{opacity:PI},update:{opacity:zI,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:PI}},{orient:s("titleOrient"),_anchor:s("titleAnchor"),anchor:{signal:nR},angle:{signal:rR},align:{signal:eR},baseline:{signal:iR},text:t.title,fill:s("titleColor"),fillOpacity:s("titleOpacity"),font:s("titleFont"),fontSize:s("titleFontSize"),fontStyle:s("titleFontStyle"),fontWeight:s("titleFontWeight"),limit:s("titleLimit"),lineHeight:s("titleLineHeight")},{align:s("titleAlign"),baseline:s("titleBaseline")}),qI({type:"text",role:"legend-title",style:"guide-title",from:r,encode:i},n)}(t,c,h.title,l)),ER(LI({role:"legend",from:l,encode:d,marks:s,aria:g("aria"),description:g("description"),zindex:g("zindex"),name:f,interactive:p,style:m}),e)}(t,e)),t.title&&function(t,e){var n,r=BI(t=Ye(t)?{text:t}:t,e.config.title),i=t.encode||{},s=i.group||{},o=s.name||void 0,a=s.interactive,l=s.style,u=[];n=xO(e.add(KO(null,[{}]))),u.push(function(t,e,n,r){var i={value:0},s={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return nO(s,{text:t.text,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:e("dx"),dy:e("dy"),fill:e("color"),font:e("font"),fontSize:e("fontSize"),fontStyle:e("fontStyle"),fontWeight:e("fontWeight"),lineHeight:e("lineHeight")},{align:e("align"),angle:e("angle"),baseline:e("baseline")}),qI({type:"text",role:"title-text",style:"group-title",from:r,encode:s},n)}(t,r,function(t){const e=t.encode;return e&&e.title||Fe({name:t.name,interactive:t.interactive,style:t.style},e)}(t),n)),t.subtitle&&u.push(function(t,e,n,r){var i={value:0},s={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return nO(s,{text:t.subtitle,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:e("dx"),dy:e("dy"),fill:e("subtitleColor"),font:e("subtitleFont"),fontSize:e("subtitleFontSize"),fontStyle:e("subtitleFontStyle"),fontWeight:e("subtitleFontWeight"),lineHeight:e("subtitleLineHeight")},{align:e("align"),angle:e("angle"),baseline:e("baseline")}),qI({type:"text",role:"title-subtitle",style:"group-subtitle",from:r,encode:s},n)}(t,r,i.subtitle,n)),ER(LI({role:"title",from:n,encode:AR(r,s),marks:u,aria:r("aria"),description:r("description"),zindex:r("zindex"),name:o,interactive:a,style:l}),e)}(t.title,e),e.parseLambdas(),e};function XR(t,e){return e&&e.signal?{name:t,update:e.signal}:{name:t,value:e}}function ZR(t,e){this.config=t||{},this.options=e||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function QR(t){this.config=t.config,this.options=t.options,this.legends=t.legends,this.field=Object.create(t.field),this.signals=Object.create(t.signals),this.lambdas=Object.create(t.lambdas),this.scales=Object.create(t.scales),this.events=Object.create(t.events),this.data=Object.create(t.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++t._nextsub[0],this._nextsub=t._nextsub,this._parent=t._parent.slice(),this._encode=t._encode.slice(),this._lookup=t._lookup.slice(),this._markpath=t._markpath}var JR=ZR.prototype=QR.prototype;function tF(t){return(Jt(t)?eF:nF)(t)}function eF(t){for(var e,n="[",r=0,i=t.length;r<i;++r)n+=(r>0?",":"")+(te(e=t[r])?e.signal||tF(e):nn(e));return n+"]"}function nF(t){var e,n,r="{",i=0;for(e in t)n=t[e],r+=(++i>1?",":"")+nn(e)+":"+(te(n)?n.signal||tF(n):nn(n));return r+"}"}JR.parse=function(t){return KR(t,this)},JR.fork=function(){return new QR(this)},JR.isSubscope=function(){return this._subid>0},JR.toRuntime=function(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},JR.id=function(){return(this._subid?this._subid+":":0)+this._id++},JR.add=function(t){return this.operators.push(t),t.id=this.id(),t.refs&&(t.refs.forEach((function(e){e.$ref=t.id})),t.refs=null),t},JR.proxy=function(t){var e=t instanceof yO?xO(t):t;return this.add(dI({value:e}))},JR.addStream=function(t){return this.streams.push(t),t.id=this.id(),t},JR.addUpdate=function(t){return this.updates.push(t),t},JR.finish=function(){var t,e;for(t in this.root&&(this.root.root=!0),this.signals)this.signals[t].signal=t;for(t in this.scales)this.scales[t].scale=t;function n(t,e,n){var r;t&&((r=t.data||(t.data={}))[e]||(r[e]=[])).push(n)}for(t in this.data)for(var r in n((e=this.data[t]).input,t,"input"),n(e.output,t,"output"),n(e.values,t,"values"),e.index)n(e.index[r],t,"index:"+r);return this},JR.pushState=function(t,e,n){this._encode.push(xO(this.add(gI({pulse:t})))),this._parent.push(e),this._lookup.push(n?xO(this.proxy(n)):null),this._markpath.push(-1)},JR.popState=function(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},JR.parent=function(){return se(this._parent)},JR.encode=function(){return se(this._encode)},JR.lookup=function(){return se(this._lookup)},JR.markpath=function(){var t=this._markpath;return++t[t.length-1]},JR.fieldRef=function(t,e){if(Ye(t))return _O(t,e);t.signal||$t("Unsupported field reference: "+nn(t));var n,r=t.signal,i=this.field[r];return i||(n={name:this.signalRef(r)},e&&(n.as=e),this.field[r]=i=xO(this.add(eI(n)))),i},JR.compareRef=function(t){function e(t){return EO(t)?(r=!0,n.signalRef(t.signal)):function(t){return t&&t.expr}(t)?(r=!0,n.exprRef(t.expr)):t}var n=this,r=!1,i=Ce(t.field).map(e),s=Ce(t.order).map(e);return r?xO(this.add(XO({fields:i,orders:s}))):SO(i,s)},JR.keyRef=function(t,e){var n=this.signals,r=!1;return t=Ce(t).map((function(t){return EO(t)?(r=!0,xO(n[t.signal])):t})),r?xO(this.add(nI({fields:t,flat:e}))):function(t,e){var n={$key:t};return e&&(n.$flat=!0),n}(t,e)},JR.sortRef=function(t){if(!t)return t;var e=CO(t.op,t.field),n=t.order||"ascending";return n.signal?xO(this.add(XO({fields:e,orders:this.signalRef(n.signal)}))):SO(e,n)},JR.event=function(t,e){var n=t+":"+e;if(!this.events[n]){var r=this.id();this.streams.push({id:r,source:t,type:e}),this.events[n]=r}return this.events[n]},JR.hasOwnSignal=function(t){return ze(this.signals,t)},JR.addSignal=function(t,e){this.hasOwnSignal(t)&&$t("Duplicate signal name: "+nn(t));var n=e instanceof yO?e:this.add(bO(e));return this.signals[t]=n},JR.getSignal=function(t){return this.signals[t]||$t("Unrecognized signal name: "+nn(t)),this.signals[t]},JR.signalRef=function(t){return this.signals[t]?xO(this.signals[t]):(ze(this.lambdas,t)||(this.lambdas[t]=this.add(bO(null))),xO(this.lambdas[t]))},JR.parseLambdas=function(){for(var t=Object.keys(this.lambdas),e=0,n=t.length;e<n;++e){var r=t[e],i=ET(r,this),s=this.lambdas[r];s.params=i.$params,s.update=i.$expr}},JR.property=function(t){return t&&t.signal?this.signalRef(t.signal):t},JR.objectProperty=function(t){return t&&te(t)?this.signalRef(t.signal||tF(t)):t},JR.exprRef=function(t,e){var n={expr:ET(t,this)};return e&&(n.expr.$name=e),xO(this.add(JO(n)))},JR.addBinding=function(t,e){this.bindings||$t("Nested signals do not support binding: "+nn(t)),this.bindings.push(Fe({signal:t},e))},JR.addScaleProj=function(t,e){ze(this.scales,t)&&$t("Duplicate scale or projection name: "+nn(t)),this.scales[t]=this.add(e)},JR.addScale=function(t,e){this.addScaleProj(t,mI(e))},JR.addProjection=function(t,e){this.addScaleProj(t,hI(e))},JR.getScale=function(t){return this.scales[t]||$t("Unrecognized scale name: "+nn(t)),this.scales[t]},JR.projectionRef=JR.scaleRef=function(t){return xO(this.getScale(t))},JR.projectionType=JR.scaleType=function(t){return this.getScale(t).params.type},JR.addData=function(t,e){return ze(this.data,t)&&$t("Duplicate data set name: "+nn(t)),this.data[t]=e},JR.getData=function(t){return this.data[t]||$t("Undefined data set name: "+nn(t)),this.data[t]},JR.addDataPipeline=function(t,e){return ze(this.data,t)&&$t("Duplicate data set name: "+nn(t)),this.addData(t,bR.fromEntries(this,e))};var rF=function(t,e,n){return te(t)||$t("Input Vega specification must be an object."),function(t,e){const n=e.config,r=xO(e.root=e.add(bO())),i=function(t,e){const n=n=>AO(t[n],e[n]),r=[XR("background",n("background")),XR("autosize",ZT(n("autosize"))),XR("padding",JT(n("padding"))),XR("width",n("width")||0),XR("height",n("height")||0)],i=r.reduce((t,e)=>(t[e.name]=e,t),{}),s={};return Ce(t.signals).forEach(t=>{ze(i,t.name)?t=Fe(i[t.name],t):r.push(t),s[t.name]=t}),Ce(e.signals).forEach(t=>{ze(s,t.name)||ze(i,t.name)||r.push(t)}),r}(t,n);i.forEach(t=>gO(t,e)),e.description=t.description||n.description,e.eventConfig=n.events,e.legends=e.objectProperty(n.legend&&n.legend.layout),e.locale=n.locale;const s=e.add(KO()),o=e.add(QO(hO((t=>rO({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},t))(t.encode),"group","frame",t.style,e,{pulse:xO(s)}))),a=e.add(vI({layout:e.objectProperty(t.layout),legends:e.legends,autosize:e.signalRef("autosize"),mark:r,pulse:xO(o)}));e.operators.pop(),e.pushState(xO(o),xO(a),null),KR(t,e,i),e.operators.push(a);let l=e.add(YO({mark:r,pulse:xO(a)}));return l=e.add(pI({pulse:xO(l)})),l=e.add(gI({pulse:xO(l)})),e.addData("root",new bR(e,s,s,l)),e}(t,new ZR(e=ne({description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:"#4c78a8"},area:{fill:"#4c78a8"},image:null,line:{stroke:"#4c78a8",strokeWidth:2},path:{stroke:"#4c78a8"},rect:{fill:"#4c78a8"},rule:{stroke:"#000"},shape:{stroke:"#4c78a8"},symbol:{fill:"#4c78a8",size:64},text:{fill:"#000",font:"sans-serif",fontSize:11},trail:{fill:"#4c78a8",size:2},style:{"guide-label":{fill:"#000",font:"sans-serif",fontSize:10},"guide-title":{fill:"#000",font:"sans-serif",fontSize:11,fontWeight:"bold"},"group-title":{fill:"#000",font:"sans-serif",fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:"#000",font:"sans-serif",fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:"#ddd"}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:"#888",grid:!1,gridWidth:1,gridColor:"#ddd",labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:"#888",tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:"#ddd",gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:"#888",titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}},e,t.config),n)).toRuntime()};Fe(_a,r,s,o,a,l,u,c,h,d,f);var iF=n("qHvB");function sF(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function t(){var e=isNaN(arguments[0])?1:Number(arguments[0]);return e?Array.prototype.reduce.call(this,(function(n,r){return Array.isArray(r)?n.push.apply(n,t.call(r,e-1)):n.push(r),n}),[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(t){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var oF=n("JBAE"),aF=n.n(oF),lF=n("Rq1Q"),uF=n.n(lF),cF=n("8BEe"),hF=n.n(cF);function dF(t){return!!t.or}function fF(t){return!!t.and}function pF(t){return!!t.not}function mF(t,e){return pF(t)?{not:mF(t.not,e)}:fF(t)?{and:t.and.map(t=>mF(t,e))}:dF(t)?{or:t.or.map(t=>mF(t,e))}:e(t)}const gF=uF.a,yF=aF.a;function vF(t,e){const n={};for(const r of e)ze(t,r)&&(n[r]=t[r]);return n}function bF(t,e){const n=Object.assign({},t);for(const r of e)delete n[r];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(t=>hF()(t)).join(",")})`};const xF=hF.a;function _F(t){if(He(t))return t;const e=Ye(t)?t:hF()(t);if(e.length<250)return e;let n=0;for(let r=0;r<e.length;r++)n=(n<<5)-n+e.charCodeAt(r),n&=n;return n}function wF(t){return!1===t||null===t}function SF(t,e){return t.indexOf(e)>-1}function CF(t,e){let n=0;for(const[r,i]of t.entries())if(e(i,r,n++))return!0;return!1}function EF(t,e){let n=0;for(const[r,i]of t.entries())if(!e(i,r,n++))return!1;return!0}function kF(t,e){for(const n of IF(e))re(t,n,e[n],!0)}function AF(t,e){const n=[],r={};let i;for(const s of t)i=e(s),i in r||(r[i]=1,n.push(s));return n}function DF(t,e){for(const n of t)if(e.has(n))return!0;return!1}function NF(t){const e=new Set;for(const n of t){const t=Pt(n).map((t,e)=>0===e?t:`[${t}]`),r=t.map((e,n)=>t.slice(0,n+1).join(""));for(const n of r)e.add(n)}return e}function TF(t,e){return void 0===t||void 0===e||DF(NF(t),NF(e))}function OF(t){return 0===IF(t).length}const IF=Object.keys,RF=Object.values;function FF(t){const e=[];for(const n in t)ze(t,n)&&e.push({key:n,value:t[n]});return e}function MF(t){return!0===t||!1===t}function $F(t){const e=t.replace(/\W/g,"_");return(t.match(/^\d+/)?"_":"")+e}function PF(t,e){return pF(t)?"!("+PF(t.not,e)+")":fF(t)?"("+t.and.map(t=>PF(t,e)).join(") && (")+")":dF(t)?"("+t.or.map(t=>PF(t,e)).join(") || (")+")":e(t)}function zF(t,e){if(0===e.length)return!0;const n=e.shift();return n in t&&zF(t[n],e)&&delete t[n],OF(t)}function LF(t){return t.charAt(0).toUpperCase()+t.substr(1)}function BF(t,e="datum"){const n=Pt(t),r=[];for(let i=1;i<=n.length;i++){const t=`[${n.slice(0,i).map(nn).join("][")}]`;r.push(`${e}${t}`)}return r.join(" && ")}function jF(t){return t.replace(/(\[|\]|\.|'|")/g,"\\$1")}function UF(t){return""+Pt(t).map(jF).join("\\.")}function VF(t,e,n){return t.replace(new RegExp(e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function WF(t){return""+Pt(t).join(".")}function qF(t){return t?Pt(t).length:0}function HF(...t){for(const e of t)if(void 0!==e)return e}let GF=42;function YF(t){if(void 0!==t)return(t%360+360)%360}function KF(t){return!!He(t)||!isNaN(t)&&!isNaN(parseFloat(t))}const XF={domainColor:{part:"domain",vgProp:"stroke"},labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"},titleColor:{part:"title",vgProp:"fill"},title:null};function ZF(t){return t&&t.condition}const QF=["domain","grid","labels","ticks","title"],JF={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},tM={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},eM=Object.assign(Object.assign({},tM),{style:1,labelExpr:1,encoding:1});function nM(t){return!!eM[t]}IF(eM);const rM={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},iM=rM.arc,sM=rM.area,oM=rM.bar,aM=rM.image,lM=rM.line,uM=rM.point,cM=rM.rect,hM=rM.rule,dM=rM.text,fM=rM.tick,pM=rM.trail,mM=rM.circle,gM=rM.square,yM=rM.geoshape;function vM(t){return SF(["line","area","trail"],t)}function bM(t){return SF(["rect","bar","image","arc"],t)}const xM=IF(rM);function _M(t){return t.type}ln(xM);const wM=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit","fill","fillOpacity"],SM=IF({color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1}),CM={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]};function EM(t){return"mark"in t}class kM{constructor(t,e){this.name=t,this.run=e}hasMatchingType(t){return!!EM(t)&&(_M(e=t.mark)?e.type:e)===this.name;var e}}const AM={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},DM={count:1,min:1,max:1};function NM(t){return!!t&&!!t.argmin}function TM(t){return!!t&&!!t.argmax}function OM(t){return Ye(t)&&!!AM[t]}IF(AM);const IM=["count","valid","missing","distinct"];function RM(t){return Ye(t)&&SF(IM,t)}const FM=["count","sum","distinct","valid","missing"],MM=ln(["mean","average","median","q1","q3","min","max"]),$M="row",PM="column",zM="radius",LM="theta",BM="theta2",jM="color",UM="fill",VM="stroke",WM="shape",qM="size",HM={theta:1,theta2:1,radius:1,radius2:1};function GM(t){return t in HM}const YM={longitude:1,longitude2:1,latitude:1,latitude2:1},KM=IF(YM),XM=Object.assign(Object.assign(Object.assign(Object.assign({},{x:1,y:1,x2:1,y2:1}),HM),YM),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function ZM(t){return t===jM||t===UM||t===VM}const QM={row:1,column:1,facet:1},JM=IF(QM),t$=Object.assign(Object.assign({},XM),QM),e$=IF(t$),n$=sF(t$,["order","detail","tooltip"]),r$=sF(n$,["row","column","facet"]);function i$(t){return!!t$[t]}IF(n$),IF(r$);const s$=["x2","y2","latitude2","longitude2",BM,"radius2"];function o$(t){return a$(t)!==t}function a$(t){switch(t){case"x2":return"x";case"y2":return"y";case"latitude2":return"latitude";case"longitude2":return"longitude";case BM:return LM;case"radius2":return zM}return t}function l$(t){if(GM(t))switch(t){case LM:return"startAngle";case BM:return"endAngle";case zM:return"outerRadius";case"radius2":return"innerRadius"}return t}function u$(t){switch(t){case"x":return"x2";case"y":return"y2";case"latitude":return"latitude2";case"longitude":return"longitude2";case LM:return BM;case zM:return"radius2"}}function c$(t){switch(t){case"x":case"x2":return"width";case"y":case"y2":return"height"}}IF(XM);const h$=sF(XM,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),d$=IF(h$),f$={x:1,y:1},p$=IF(f$);function m$(t){return t in f$}const g$={theta:1,radius:1},y$=IF(g$);function v$(t){return"width"===t?"x":"y"}const b$=sF(h$,["text","tooltip","href","url","description","detail","key","order"]),x$=IF(b$),_$=Object.assign(Object.assign(Object.assign({},f$),g$),b$),w$=IF(_$);function S$(t){return!!_$[t]}const C$={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},E$=sF(C$,["geoshape"]);function k$(t){switch(t){case"x":case"y":case LM:case zM:case qM:case"angle":case"strokeWidth":case"opacity":case"fillOpacity":case"strokeOpacity":case"x2":case"y2":case BM:case"radius2":return;case"facet":case $M:case PM:case WM:case"strokeDash":case"text":case"tooltip":case"href":case"url":case"description":return"discrete";case jM:case UM:case VM:return"flexible";case"latitude":case"longitude":case"latitude2":case"longitude2":case"detail":case"key":case"order":return}}function A$(t){return We(t)&&(t=bB(t,void 0)),"bin"+IF(t).map(e=>O$(t[e])?$F(`_${e}_${Object.entries(t[e])}`):$F(`_${e}_${t[e]}`)).join("")}function D$(t){return!0===t||T$(t)&&!t.binned}function N$(t){return"binned"===t||T$(t)&&!0===t.binned}function T$(t){return te(t)}function O$(t){return null==t?void 0:t.selection}function I$(t){switch(t){case $M:case PM:case qM:case jM:case UM:case VM:case"strokeWidth":case"opacity":case"fillOpacity":case"strokeOpacity":case WM:return 6;case"strokeDash":return 4;default:return 10}}function R$(t){return`Invalid specification ${JSON.stringify(t)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const F$='Autosize "fit" only works for single views and layered views.';function M$(t){return("width"==t?"Width":"Height")+' "container" only works for single views and layered views.'}function $$(t){return`${"width"==t?"Width":"Height"} "container" only works well with autosize "fit" or "fit-${"width"==t?"x":"y"}".`}function P$(t){return t?`Dropping "fit-${t}" because spec has discrete ${c$(t)}.`:'Dropping "fit" because spec has discrete size.'}function z$(t){return`Unknown field for ${t}. Cannot calculate view size.`}function L$(t){return`Cannot project a selection on encoding channel "${t}", which has no field.`}function B$(t,e){return`Cannot project a selection on encoding channel "${t}" as it uses an aggregate function ("${e}").`}function j$(t){return`The "nearest" transform is not supported for ${t} marks.`}function U$(t){return`Selection not supported for ${t} yet.`}function V$(t){return`Cannot find a selection named "${t}".`}const W$="Scale bindings are currently only supported for scales with unbinned, continuous domains.",q$="Legend bindings are only supported for selections over an individual field or encoding channel.";function H$(t){return`Cannot define and lookup the "${t}" selection in the same view. Try moving the lookup into a second, layered view?`}const G$="The same selection must be used to override scale domains in a layered view.",Y$='Interval selections should be initialized using "x" and/or "y" keys.';function K$(t){return`Unknown repeated value "${t}".`}function X$(t){return`The "columns" property cannot be used when "${t}" has nested row/column.`}const Z$="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function Q$(t){return`Unrecognized parse "${t}".`}function J$(t,e,n){return`An ancestor parsed field "${t}" as ${n} but a child wants to parse the field as ${e}.`}const tP="Attempt to add the same child twice.";function eP(t){return`Ignoring an invalid transform: ${xF(t)}.`}const nP='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function rP(t){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${t} are dropped.`}function iP(t){const{parentProjection:e,projection:n}=t;return`Layer's shared projection ${xF(e)} is overridden by a child projection ${xF(n)}.`}const sP="Arc marks uses theta channel rather than angle, replacing angle with theta.";function oP(t,e,n){return`Channel ${t} is a ${e}. Converted to {value: ${xF(n)}}.`}function aP(t){return`Invalid field type "${t}".`}function lP(t,e){return`Invalid field type "${t}" for aggregate: "${e}", using "quantitative" instead.`}function uP(t){return`Invalid aggregation operator "${t}".`}function cP(t,e){return`Missing type for channel "${t}", using "${e}" instead.`}function hP(t,e){const{fill:n,stroke:r}=e;return`Dropping color ${t} as the plot also has ${n&&r?"fill and stroke":n?"fill":"stroke"}.`}function dP(t,e){return`Dropping ${xF(t)} from channel "${e}" since it does not contain any data field, datum, value, or signal.`}function fP(t,e,n){return`${t}-encoding with type ${e} is deprecated. Replacing with ${n}-encoding.`}const pP="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function mP(t,e,n){return`${t} dropped as it is incompatible with "${e}"${n?" when "+n:""}.`}function gP(t){return`${t}-encoding is dropped as ${t} is not a valid encoding channel.`}function yP(t){return t+" encoding should be discrete (ordinal / nominal / binned)."}function vP(t){return`Facet encoding dropped as ${t.join(" and ")} ${t.length>1?"are":"is"} also specified.`}function bP(t,e){return`Using discrete channel "${t}" to encode "${e}" field can be misleading as it does not encode ${"ordinal"===e?"order":"magnitude"}.`}function xP(t,e){return`Line mark is for continuous lines and thus cannot be used with ${t&&e?"x2 and y2":t?"x2":"y2"}. We will use the rule mark (line segments) instead.`}function _P(t,e){return`Specified orient "${t}" overridden with "${e}".`}const wP="Custom domain scale cannot be unioned with default field-based domain.",SP='Scale\'s "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.';function CP(t){return`Cannot use the scale property "${t}" with non-color channel.`}function EP(t){return`Using unaggregated domain with raw field has no effect (${xF(t)}).`}function kP(t){return`Unaggregated domain not applicable for "${t}" since it produces values outside the origin domain of the source data.`}function AP(t){return`Unaggregated domain is currently unsupported for log scale (${xF(t)}).`}function DP(t){return`Cannot apply size to non-oriented mark "${t}".`}function NP(t,e,n){return`Channel "${t}" does not work with "${e}" scale. We are using "${n}" scale instead.`}function TP(t,e){return`FieldDef does not work with "${t}" scale. We are using "${e}" scale instead.`}function OP(t,e,n){return`${n}-scale's "${e}" is dropped as it does not work with ${t} scale.`}function IP(t,e){return`Scale type "${e}" does not work with mark "${t}".`}function RP(t){return`The step for "${t}" is dropped because the ${"width"===t?"x":"y"} is continuous.`}function FP(t,e,n,r){return`Conflicting ${e.toString()} property "${t.toString()}" (${xF(n)} and ${xF(r)}). Using ${xF(n)}.`}function MP(t,e,n,r){return`Conflicting ${e.toString()} property "${t.toString()}" (${xF(n)} and ${xF(r)}). Using the union of the two domains.`}function $P(t){return`Setting the scale to be independent for "${t}" means we also have to set the guide (axis or legend) to be independent.`}function PP(t){return`Dropping sort property ${xF(t)} as unioned domains only support boolean or op "count", "min", and "max".`}const zP="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",LP="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",BP="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",jP="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.",UP="Invalid channel for axis.";function VP(t){return`Cannot stack "${t}" if there is already "${t}2".`}function WP(t){return`Cannot stack non-linear scale (${t}).`}function qP(t){return`Stacking is applied even though the aggregate function is non-summative ("${t}").`}function HP(t,e){return`Invalid ${t}: ${xF(e)}.`}function GP(t){return`Dropping day from datetime ${xF(t)} as day cannot be combined with other units.`}function YP(t,e){return`${e?"extent ":""}${e&&t?"and ":""}${t?"center ":""}${e&&t?"are ":"is "}not needed when data are aggregated.`}function KP(t,e,n){return`${t} is not usually used with ${e} for ${n}.`}function XP(t,e){return`Continuous axis should not have customized aggregation function ${t}; ${e} already agregates the axis.`}function ZP(t){return`1D error band does not support ${t}.`}function QP(t){return`Channel ${t} is required for "binned" bin.`}function JP(t){return`Channel ${t} should not be used with "binned" bin.`}function tz(t){return`Domain for ${t} is required for threshold scale.`}const ez=Qt(Kt);let nz=ez;function rz(...t){nz.warn(...t)}function iz(t){if(t&&te(t))for(const e of dz)if(e in t)return!0;return!1}new WeakMap;const sz=["january","february","march","april","may","june","july","august","september","october","november","december"],oz=sz.map(t=>t.substr(0,3)),az=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],lz=az.map(t=>t.substr(0,3));function uz(t,e){const n=[];if(e&&void 0!==t.day&&IF(t).length>1&&(rz(m.droppedDay(t)),delete(t=yF(t)).day),n.push(void 0!==t.year?t.year:2012),void 0!==t.month){const r=e?function(t){if(KF(t)&&(t=+t),He(t))return t-1;{const e=t.toLowerCase(),n=sz.indexOf(e);if(-1!==n)return n;const r=e.substr(0,3),i=oz.indexOf(r);if(-1!==i)return i;throw new Error(m.invalidTimeUnit("month",t))}}(t.month):t.month;n.push(r)}else if(void 0!==t.quarter){const r=e?function(t){if(KF(t)&&(t=+t),He(t))return t>4&&rz(m.invalidTimeUnit("quarter",t)),t-1;throw new Error(m.invalidTimeUnit("quarter",t))}(t.quarter):t.quarter;n.push(He(r)?3*r:r+"*3")}else n.push(0);if(void 0!==t.date)n.push(t.date);else if(void 0!==t.day){const r=e?function(t){if(KF(t)&&(t=+t),He(t))return t%7;{const e=t.toLowerCase(),n=az.indexOf(e);if(-1!==n)return n;const r=e.substr(0,3),i=lz.indexOf(r);if(-1!==i)return i;throw new Error(m.invalidTimeUnit("day",t))}}(t.day):t.day;n.push(He(r)?r+1:r+"+1")}else n.push(1);for(const r of["hours","minutes","seconds","milliseconds"]){const e=t[r];n.push(void 0===e?0:e)}return n}function cz(t){const e=uz(t,!0).join(", ");return t.utc?`utc(${e})`:`datetime(${e})`}const hz={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},dz=IF(hz);function fz(t){return t.startsWith("utc")}const pz={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function mz(t){const e=[];for(const n of dz)gz(t,n)&&e.push(n);return e}function gz(t,e){const n=t.indexOf(e);return!(n<0||n>0&&"seconds"===e&&"i"===t.charAt(n-1)||t.length>n+3&&"day"===e&&"o"===t.charAt(n+3)||n>0&&"year"===e&&"f"===t.charAt(n-1))}function yz(t){if(!t)return;const e=mz(t);return`timeUnitSpecifier(${hF()(e)}, ${hF()(pz)})`}function vz(t){if(!t)return;let e;return Ye(t)?e={unit:t}:te(t)&&(e=Object.assign(Object.assign({},t),t.unit?{unit:t.unit}:{})),fz(e.unit)&&(e.utc=!0,e.unit=e.unit.substr(3)),e}function bz(t){return t&&!!t.signal}function xz(t){return!!t.step}function _z(t){return!Jt(t)&&"field"in t&&"data"in t}const wz=IF({aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1}),Sz={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},Cz=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function Ez(t){return t&&!!t.field&&void 0!==t.equal}function kz(t){return t&&!!t.field&&void 0!==t.lt}function Az(t){return t&&!!t.field&&void 0!==t.lte}function Dz(t){return t&&!!t.field&&void 0!==t.gt}function Nz(t){return t&&!!t.field&&void 0!==t.gte}function Tz(t){if(t&&t.field){if(Jt(t.range)&&2===t.range.length)return!0;if(bz(t.range))return!0}return!1}function Oz(t){return t&&!!t.field&&(Jt(t.oneOf)||Jt(t.in))}function Iz(t){return Oz(t)||Ez(t)||Tz(t)||kz(t)||Dz(t)||Az(t)||Nz(t)}function Rz(t,e){return wB(t,{timeUnit:e,wrapTime:!0})}function Fz(t,e=!0){var n;const{field:r}=t,i=null===(n=vz(t.timeUnit))||void 0===n?void 0:n.unit,s=i?"time("+function(t,e,{end:n}={end:!1}){const r=BF(e),i=fz(t)?"utc":"";let s;const o={};for(const l of dz)gz(t,l)&&(o[l]="quarter"===(a=l)?`(${i}quarter(${r})-1)`:`${i}${a}(${r})`,s=l);var a;return n&&(o[s]+="+1"),function(t){const e=uz(t,!1).join(", ");return t.utc?`utc(${e})`:`datetime(${e})`}(o)}(i,r)+")":iB(t,{expr:"datum"});if(Ez(t))return s+"==="+Rz(t.equal,i);if(kz(t))return`${s}<${Rz(t.lt,i)}`;if(Dz(t))return`${s}>${Rz(t.gt,i)}`;if(Az(t))return`${s}<=${Rz(t.lte,i)}`;if(Nz(t))return`${s}>=${Rz(t.gte,i)}`;if(Oz(t))return`indexof([${function(t,e){return t.map(t=>Rz(t,e))}(t.oneOf,i).join(",")}], ${s}) !== -1`;if(function(t){return t&&!!t.field&&void 0!==t.valid}(t))return Mz(s,t.valid);if(Tz(t)){const{range:n}=t,r=bz(n)?{signal:n.signal+"[0]"}:n[0],o=bz(n)?{signal:n.signal+"[1]"}:n[1];if(null!==r&&null!==o&&e)return"inrange("+s+", ["+Rz(r,i)+", "+Rz(o,i)+"])";const a=[];return null!==r&&a.push(`${s} >= ${Rz(r,i)}`),null!==o&&a.push(`${s} <= ${Rz(o,i)}`),a.length>0?a.join(" && "):"true"}throw new Error("Invalid field predicate: "+JSON.stringify(t))}function Mz(t,e=!0){return e?`isValid(${t}) && isFinite(+${t})`:`!isValid(${t}) || !isFinite(+${t})`}function $z(t){var e;return Iz(t)&&t.timeUnit?Object.assign(Object.assign({},t),{timeUnit:null===(e=vz(t.timeUnit))||void 0===e?void 0:e.unit}):t}const Pz={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"},zz=Pz.quantitative,Lz=Pz.ordinal,Bz=Pz.temporal,jz=Pz.nominal,Uz=Pz.geojson;IF(Pz);const Vz={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function Wz(t,e){const n=Vz[t],r=Vz[e];return n===r||"ordinal-position"===n&&"time"===r||"ordinal-position"===r&&"time"===n}IF(Vz);const qz={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function Hz(t){return qz[t]}const Gz=["linear","log","pow","sqrt","symlog","time","utc"],Yz=ln(Gz),Kz=ln(["linear","log","pow","sqrt","symlog"]),Xz=ln(["quantile","quantize","threshold"]),Zz=Gz.concat(["quantile","quantize","threshold","sequential","identity"]),Qz=ln(Zz),Jz=ln(["ordinal","bin-ordinal","point","band"]);function tL(t){return t in Jz}function eL(t){return t in Qz}function nL(t){return t in Yz}function rL(t){return t in Xz}function iL(t){return null==t?void 0:t.selection}const sL={type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},oL=(IF(sL),sF(sL,["type","domain","range","rangeMax","rangeMin","scheme"])),aL=IF(oL);function lL(t,e){switch(e){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!SF(["point","band","identity"],t);case"bins":return!SF(["point","band","identity","ordinal"],t);case"round":return nL(t)||"band"===t||"point"===t;case"padding":case"rangeMin":case"rangeMax":return nL(t)||SF(["point","band"],t);case"paddingOuter":case"align":return SF(["point","band"],t);case"paddingInner":return"band"===t;case"domainMax":case"domainMid":case"domainMin":case"clamp":return nL(t);case"nice":return nL(t)||"quantize"===t||"threshold"===t;case"exponent":return"pow"===t;case"base":return"log"===t;case"constant":return"symlog"===t;case"zero":return eL(t)&&!SF(["log","time","utc","threshold","quantile"],t)}}function uL(t,e){switch(e){case"interpolate":case"scheme":case"domainMid":return ZM(t)?void 0:m.cannotUseScalePropertyWithNonColor(t);case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}}function cL(t){const{channel:e,channelDef:n,markDef:r,scale:i,config:s}=t,o=gL(t);return qL(n)&&!RM(n.aggregate)&&i&&nL(i.get("type"))&&!1===i.get("zero")?hL({fieldDef:n,channel:e,markDef:r,ref:o,config:s}):o}function hL({fieldDef:t,channel:e,markDef:n,ref:r,config:i}){return vM(n.type)||null===OB("invalid",n,i)?r:[dL(t,e),r]}function dL(t,e){const n=fL(t,!0),r=a$(e);return Object.assign({test:n},"y"===r?{field:{group:"height"}}:{value:0})}function fL(t,e=!0){return Mz(Ye(t)?t:iB(t,{expr:"datum"}),!e)}function pL(t,e,n,r){const i={};if(e&&(i.scale=e),GL(t)){const{datum:e}=t;iz(e)?i.signal=cz(e):bz(e)?i.signal=e.signal:i.value=e}else i.field=iB(t,n);if(r){const{offset:t,band:e}=r;t&&(i.offset=t),e&&(i.band=e)}return i}function mL({scaleName:t,fieldOrDatumDef:e,fieldOrDatumDef2:n,offset:r,startSuffix:i,band:s=.5}){const o=0<s&&s<1?"datum":void 0,a=iB(e,{expr:o,suffix:i}),l=void 0!==n?iB(n,{expr:o}):iB(e,{suffix:"end",expr:o}),u={};return 0===s||1===s?(u.scale=t,u.field=0===s?a:l):u.signal=`scale("${t}", ${s} * ${a} + ${1-s} * ${l})`,r&&(u.offset=r),u}function gL({channel:t,channelDef:e,channel2Def:n,markDef:r,config:i,scaleName:s,scale:o,stack:a,offset:l,defaultRef:u,band:c}){var h;if(e){if(XL(e)){if(ZL(e)){c=null!=c?c:BL({channel:t,fieldDef:e,fieldDef2:n,markDef:r,stack:a,config:i,isMidPoint:!0});const{bin:o,timeUnit:u,type:h}=e;if(D$(o)||c&&u&&h===Bz)return a&&a.impute?pL(e,s,{binSuffix:"mid"},{offset:l}):c?mL({scaleName:s,fieldOrDatumDef:e,band:c,offset:l}):pL(e,s,CB(e,t)?{binSuffix:"range"}:{},{offset:l});if(N$(o)){if(qL(n))return mL({scaleName:s,fieldOrDatumDef:e,fieldOrDatumDef2:n,band:c,offset:l});rz(m.channelRequiredForBinned("x"===t?"x2":"y2"))}}const u=null==o?void 0:o.get("type");return pL(e,s,tL(u)?{binSuffix:"range"}:{},{offset:l,band:"band"===u?null!==(h=null!=c?c:e.band)&&void 0!==h?h:.5:void 0})}if(QL(e)){const n=l?{offset:l}:{};return Object.assign(Object.assign({},yL(t,e.value)),n)}}return ke(u)&&(u=u()),u?Object.assign(Object.assign({},u),l?{offset:l}:{}):u}function yL(t,e){return SF(["x","x2"],t)&&"width"===e?{field:{group:"width"}}:SF(["y","y2"],t)&&"height"===e?{field:{group:"height"}}:AB(e)}function vL(t){return t&&"number"!==t&&"time"!==t}function bL(t,e,n){return`${t}(${e}${n?", "+JSON.stringify(n):""})`}function xL({fieldOrDatumDef:t,format:e,formatType:n,expr:r,normalizeStack:i,config:s}){var o,a;if(vL(n))return wL({fieldOrDatumDef:t,format:e,formatType:n,expr:r,config:s});const l=_L(t,r,i);if(_B(t)){const n=function(t,e,n,r,i){return!e||n?`${i?"utc":"time"}Format(${t}, '${n=Ye(n)?n:r}')`:function(t,e,n){if(!t)return;const r=yz(t);return`${n||fz(t)?"utc":"time"}Format(${e}, ${r})`}(e,t,i)}(l,qL(t)?null===(o=vz(t.timeUnit))||void 0===o?void 0:o.unit:void 0,e,s.timeFormat,JL(t)&&"utc"===(null===(a=t.scale)||void 0===a?void 0:a.type));return n?{signal:n}:void 0}return e=EL(HL(t),e,s),qL(t)&&D$(t.bin)?{signal:DL(l,iB(t,{expr:r,binSuffix:"end"}),e,n,s)}:e||"quantitative"===HL(t)?{signal:""+kL(l,e)}:{signal:`isValid(${l}) ? ${l} : ""+${l}`}}function _L(t,e,n){return qL(t)?n?`${iB(t,{expr:e,suffix:"end"})}-${iB(t,{expr:e,suffix:"start"})}`:iB(t,{expr:e}):function(t){const{datum:e}=t;return iz(e)?cz(e):""+JSON.stringify(e)}(t)}function wL({fieldOrDatumDef:t,format:e,formatType:n,expr:r,normalizeStack:i,config:s,field:o}){return o=null!=o?o:_L(t,r,i),qL(t)&&D$(t.bin)?{signal:DL(o,iB(t,{expr:r,binSuffix:"end"}),e,n,s)}:{signal:bL(n,o,e)}}function SL(t,e,n,r,i,s){var o;if(!vL(r))return _B(t)?function(t,e,n,r){return t||(e?{signal:yz(e)}:r?void 0:n.timeFormat)}(n,qL(t)?null===(o=vz(t.timeUnit))||void 0===o?void 0:o.unit:void 0,i,s):EL(e,n,i)}function CL(t,e,n){return t&&(bz(t)||"number"===t||"time"===t)?t:_B(e)&&"time"!==n&&"utc"!==n?"time":void 0}function EL(t,e,n){return Ye(e)?e:t===zz?n.numberFormat:void 0}function kL(t,e){return`format(${t}, "${e||""}")`}function AL(t,e,n,r){var i;return vL(n)?bL(n,t,e):kL(t,null!==(i=Ye(e)?e:void 0)&&void 0!==i?i:r.numberFormat)}function DL(t,e,n,r,i){const s=AL(t,n,r,i),o=AL(e,n,r,i);return`${Mz(t,!1)} ? "null" : ${s} + " \u2013 " + ${o}`}const NL="min",TL={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function OL(t){return t in TL}function IL(t){return!!t&&!!t.encoding}function RL(t){return!(!t||"count"!==t.op&&!t.field)}function FL(t){return!!t&&Jt(t)}function ML(t){return"row"in t||"column"in t}function $L(t){return!!t&&"header"in t}function PL(t){return"facet"in t}function zL(t){const{field:e,timeUnit:n,bin:r,aggregate:i}=t;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),r?{bin:r}:{}),i?{aggregate:i}:{}),{field:e})}function LL(t){return"sort"in t}function BL({channel:t,fieldDef:e,fieldDef2:n,markDef:r,stack:i,config:s,isMidPoint:o}){if(XL(e)&&void 0!==e.band)return e.band;if(qL(e)){const{timeUnit:t,bin:i}=e;if(t&&!n)return o?IB("timeUnitBandPosition",r,s):bM(r.type)?IB("timeUnitBand",r,s):0;if(D$(i))return bM(r.type)&&!o?1:.5}return(null==i?void 0:i.fieldChannel)===t&&o?.5:void 0}function jL(t,e,n,r,i,s){return!!(D$(e.bin)||e.timeUnit&&ZL(e)&&"temporal"===e.type)&&!!BL({channel:t,fieldDef:e,fieldDef2:n,stack:r,markDef:i,config:s})}function UL(t){return!!t&&"condition"in t}function VL(t){const e=t&&t.condition;return!!e&&!Jt(e)&&qL(e)}function WL(t){const e=t&&t.condition;return!!e&&!Jt(e)&&XL(e)}function qL(t){return!(!t||!t.field&&"count"!==t.aggregate)}function HL(t){return t&&t.type}function GL(t){return!!t&&"datum"in t}function YL(t){return ZL(t)&&oB(t)||KL(t)}function KL(t){return GL(t)&&He(t.datum)}function XL(t){return qL(t)||GL(t)}function ZL(t){return!!t&&("field"in t||"count"===t.aggregate)&&"type"in t}function QL(t){return t&&"value"in t&&"value"in t}function JL(t){return!!t&&("scale"in t||"sort"in t)}function tB(t){return t&&("axis"in t||"stack"in t||"impute"in t)}function eB(t){return!!t&&"legend"in t}function nB(t){return!!t&&("format"in t||"formatType"in t)}function rB(t){return bF(t,["legend","axis","header","scale"])}function iB(t,e={}){var n,r,i;let s=t.field;const o=e.prefix;let a=e.suffix,l="";if(function(t){return"count"===t.aggregate}(t))s=0==="count".indexOf("__")?"count":"__count";else{let o;if(!e.nofn)if(function(t){return"op"in t}(t))o=t.op;else{const{bin:u,aggregate:c,timeUnit:h}=t;D$(u)?(o=A$(u),a=(null!==(n=e.binSuffix)&&void 0!==n?n:"")+(null!==(r=e.suffix)&&void 0!==r?r:"")):c?TM(c)?(l=`["${s}"]`,s="argmax_"+c.argmax):NM(c)?(l=`["${s}"]`,s="argmin_"+c.argmin):o=String(c):h&&(o=function(t){const e=vz(t),{utc:n}=e,r=sF(e,["utc"]);return r.unit?(n?"utc":"")+IF(r).map(t=>$F(`${"unit"===t?"":`_${t}_`}${r[t]}`)).join(""):(n?"utc":"")+"timeunit"+IF(r).map(t=>$F(`_${t}_${r[t]}`)).join("")}(h),a=(!SF(["range","mid"],e.binSuffix)&&e.binSuffix||"")+(null!==(i=e.suffix)&&void 0!==i?i:""))}o&&(s=s?`${o}_${s}`:o)}return a&&(s=`${s}_${a}`),o&&(s=`${o}_${s}`),e.forAs?WF(s):e.expr?function(t,e="datum"){return`${e}[${nn(Pt(t).join("."))}]`}(s,e.expr)+l:UF(s)+l}function sB(t){switch(t.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return qL(t)&&!!t.bin;case"temporal":return!1}throw new Error(m.invalidFieldType(t.type))}function oB(t){return!sB(t)}const aB=(t,e)=>{switch(e.fieldTitle){case"plain":return t.field;case"functional":return function(t){const{aggregate:e,bin:n,timeUnit:r,field:i}=t;if(TM(e))return`${i} for argmax(${e.argmax})`;if(NM(e))return`${i} for argmin(${e.argmin})`;const s=vz(r),o=e||(null==s?void 0:s.unit)||(null==s?void 0:s.maxbins)&&"timeunit"||D$(n)&&"bin";return o?o.toUpperCase()+"("+i+")":i}(t);default:return function(t,e){var n;const{field:r,bin:i,timeUnit:s,aggregate:o}=t;if("count"===o)return e.countTitle;if(D$(i))return r+" (binned)";if(s){const t=null===(n=vz(s))||void 0===n?void 0:n.unit;if(t)return`${r} (${mz(t).join("-")})`}else if(o)return TM(o)?`${r} for max ${o.argmax}`:NM(o)?`${r} for min ${o.argmin}`:`${LF(o)} of ${r}`;return r}(t,e)}};let lB=aB;function uB(t){lB=t}function cB(t,e,{allowDisabling:n,includeDefault:r=!0}){var i,s;const o=null===(i=hB(t))||void 0===i?void 0:i.title;if(!qL(t))return o;const a=t,l=r?dB(a,e):void 0;return n?HF(o,a.title,l):null!==(s=null!=o?o:a.title)&&void 0!==s?s:l}function hB(t){return tB(t)&&t.axis?t.axis:eB(t)&&t.legend?t.legend:$L(t)&&t.header?t.header:void 0}function dB(t,e){return lB(t,e)}function fB(t){var e;if(nB(t)){const{format:e,formatType:n}=t;return{format:e,formatType:n}}{const n=null!==(e=hB(t))&&void 0!==e?e:{},{format:r,formatType:i}=n;return{format:r,formatType:i}}}function pB(t){return qL(t)?t:VL(t)?t.condition:void 0}function mB(t){return XL(t)?t:WL(t)?t.condition:void 0}function gB(t,e,n,r={}){if(Ye(t)||He(t)||We(t)){const n=Ye(t)?"string":He(t)?"number":"boolean";return rz(m.primitiveChannelDef(e,n,t)),{value:t}}return XL(t)?yB(t,e,n,r):WL(t)?Object.assign(Object.assign({},t),{condition:yB(t.condition,e,n,r)}):t}function yB(t,e,n,r){if(nB(t)){const{formatType:i}=t,s=sF(t,["format","formatType"]);if(vL(i)&&!n.customFormatTypes)return rz(m.customFormatTypeNotAllowed(e)),yB(s,e,n,r)}else{const i=tB(t)?"axis":eB(t)?"legend":$L(t)?"header":null;if(i&&t[i]){const s=t[i],{formatType:o}=s,a=sF(s,["format","formatType"]);if(vL(o)&&!n.customFormatTypes)return rz(m.customFormatTypeNotAllowed(e)),yB(Object.assign(Object.assign({},t),{[i]:a}),e,n,r)}}return qL(t)?vB(t,e,r):function(t){let e=t.type;if(e)return t;const{datum:n}=t;return e=He(n)?"quantitative":Ye(n)?"nominal":iz(n)?"temporal":void 0,Object.assign(Object.assign({},t),{type:e})}(t)}function vB(t,e,{compositeMark:n=!1}={}){const{aggregate:r,timeUnit:i,bin:s,field:o}=t,a=Object.assign({},t);if(n||!r||OM(r)||TM(r)||NM(r)||(rz(m.invalidAggregate(r)),delete a.aggregate),i&&(a.timeUnit=vz(i)),o&&(a.field=""+o),D$(s)&&(a.bin=bB(s,e)),N$(s)&&!m$(e)&&rz(m.channelShouldNotBeUsedForBinned(e)),ZL(a)){const{type:t}=a,e=function(t){if(t)switch(t=t.toLowerCase()){case"q":case zz:return"quantitative";case"t":case Bz:return"temporal";case"o":case Lz:return"ordinal";case"n":case jz:return"nominal";case Uz:return"geojson"}}(t);t!==e&&(a.type=e),"quantitative"!==t&&RM(r)&&(rz(m.invalidFieldTypeForCountAggregate(t,r)),a.type="quantitative")}else if(!o$(e)){const t=function(t,e){var n;switch(e){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal"}if(LL(t)&&Jt(t.sort))return"ordinal";const{aggregate:r,bin:i,timeUnit:s}=t;if(s)return"temporal";if(i||r&&!TM(r)&&!NM(r))return"quantitative";if(JL(t)&&(null===(n=t.scale)||void 0===n?void 0:n.type))switch(Vz[t.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}(a,e);a.type=t}if(ZL(a)){const{compatible:t,warning:n}=function(t,e){const n=t.type;if("geojson"===n&&"shape"!==e)return{compatible:!1,warning:`Channel ${e} should not be used with a geojson data.`};switch(e){case $M:case PM:case"facet":return oB(t)?{compatible:!1,warning:m.facetChannelShouldBeDiscrete(e)}:xB;case"x":case"y":case jM:case UM:case VM:case"text":case"detail":case"key":case"tooltip":case"href":case"url":case"angle":case LM:case zM:case"description":return xB;case"longitude":case"longitude2":case"latitude":case"latitude2":return n!==zz?{compatible:!1,warning:`Channel ${e} should be used with a quantitative field only, not ${t.type} field.`}:xB;case"opacity":case"fillOpacity":case"strokeOpacity":case"strokeWidth":case qM:case BM:case"radius2":case"x2":case"y2":return"nominal"!==n||t.sort?xB:{compatible:!1,warning:`Channel ${e} should not be used with an unsorted discrete field.`};case"strokeDash":return SF(["ordinal","nominal"],t.type)?xB:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case WM:return SF(["ordinal","nominal","geojson"],t.type)?xB:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case"order":return"nominal"!==t.type||"sort"in t?xB:{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}}(a,e)||{};!1===t&&rz(n)}if(LL(a)&&Ye(a.sort)){const{sort:t}=a;if(OL(t))return Object.assign(Object.assign({},a),{sort:{encoding:t}});const e=t.substr(1);if("-"===t.charAt(0)&&OL(e))return Object.assign(Object.assign({},a),{sort:{encoding:e,order:"descending"}})}if($L(a)){const{header:t}=a,{orient:e}=t,n=sF(t,["orient"]);if(e)return Object.assign(Object.assign({},a),{header:Object.assign(Object.assign({},n),{labelOrient:t.labelOrient||e,titleOrient:t.titleOrient||e})})}return a}function bB(t,e){return We(t)?{maxbins:I$(e)}:"binned"===t?{binned:!0}:t.maxbins||t.step?t:Object.assign(Object.assign({},t),{maxbins:I$(e)})}const xB={compatible:!0};function _B(t){const{formatType:e}=fB(t);return"time"===e||!e&&(n=t)&&("temporal"===n.type||qL(n)&&!!n.timeUnit);var n}function wB(t,{timeUnit:e,type:n,wrapTime:r,undefinedIfExprNotRequired:i}){var s;const o=e&&(null===(s=vz(e))||void 0===s?void 0:s.unit);let a,l=o||"temporal"===n;return bz(t)?a=t.signal:iz(t)?(l=!0,a=cz(t)):(Ye(t)||He(t))&&l&&(a=`datetime(${JSON.stringify(t)})`,function(t){return!!hz[t]}(o)&&(He(t)&&t<1e4||Ye(t)&&isNaN(Date.parse(t)))&&(a=cz({[o]:t}))),a?r&&l?`time(${a})`:a:i?void 0:JSON.stringify(t)}function SB(t,e){const{type:n}=t;return e.map(e=>{const r=wB(e,{timeUnit:qL(t)?t.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return void 0!==r?{signal:r}:e})}function CB(t,e){return D$(t.bin)?S$(e)&&SF(["ordinal","nominal"],t.type):(console.warn("Only call this method for binned field defs."),!1)}function EB(t){const{anchor:e,frame:n,offset:r,orient:i,color:s,subtitleColor:o,subtitleFont:a,subtitleFontSize:l,subtitleFontStyle:u,subtitleFontWeight:c,subtitleLineHeight:h,subtitlePadding:d}=t,f=sF(t,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),p=Object.assign(Object.assign({},f),s?{fill:s}:{}),m=Object.assign(Object.assign(Object.assign(Object.assign({},e?{anchor:e}:{}),n?{frame:n}:{}),r?{offset:r}:{}),i?{orient:i}:{}),g=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},o?{subtitleColor:o}:{}),a?{subtitleFont:a}:{}),l?{subtitleFontSize:l}:{}),u?{subtitleFontStyle:u}:{}),c?{subtitleFontWeight:c}:{}),h?{subtitleLineHeight:h}:{}),d?{subtitlePadding:d}:{});return{titleMarkConfig:p,subtitleMarkConfig:vF(p,["align","baseline","dx","dy","limit"]),nonMark:m,subtitle:g}}function kB(t){return Ye(t)||Jt(t)&&Ye(t[0])}function AB(t){return bz(t)?t:void 0!==t?{value:t}:void 0}function DB(t){return bz(t)?t.signal:nn(t.value)}function NB(t){return bz(t)?t.signal:null==t?null:nn(t)}function TB(t){var e;return[].concat(t.type,null!==(e=t.style)&&void 0!==e?e:[])}function OB(t,e,n,r={}){const{vgChannel:i,ignoreVgConfig:s}=r;return i&&void 0!==e[i]?e[i]:void 0!==e[t]?e[t]:!s||i&&i!==t?IB(t,e,n,r):void 0}function IB(t,e,n,{vgChannel:r}={}){return HF(r?RB(t,e,n.style):void 0,RB(t,e,n.style),r?n[e.type][r]:void 0,n[e.type][t],r?n.mark[r]:n.mark[t])}function RB(t,e,n){return FB(t,TB(e),n)}function FB(t,e,n){let r;e=Ce(e);for(const i of e){const e=n[i];e&&void 0!==e[t]&&(r=e[t])}return r}function MB(t,e){return Ce(t).reduce((t,n)=>{var r;return t.field.push(iB(n,e)),t.order.push(null!==(r=n.sort)&&void 0!==r?r:"ascending"),t},{field:[],order:[]})}function $B(t,e){const n=[...t];return e.forEach(t=>{for(const e of n)if(gF(e,t))return;n.push(t)}),n}function PB(t,e){return gF(t,e)||!e?t:t?[...Ce(t),...Ce(e)].join(", "):e}function zB(t,e){const n=t.value,r=e.value;if(null==n||null===r)return{explicit:t.explicit,value:null};if((kB(n)||bz(n))&&(kB(r)||bz(r)))return{explicit:t.explicit,value:PB(n,r)};if(kB(n)||bz(n))return{explicit:t.explicit,value:n};if(kB(r)||bz(r))return{explicit:t.explicit,value:r};if(!(kB(n)||bz(n)||kB(r)||bz(r)))return{explicit:t.explicit,value:$B(n,r)};throw new Error("It should never reach here")}function LB(t,e){const n=t&&t[e];return!!n&&(Jt(n)?CF(n,t=>!!t.field):qL(n)||VL(n))}function BB(t){return CF(e$,e=>{if(LB(t,e)){const n=t[e];if(Jt(n))return CF(n,t=>!!t.aggregate);{const t=pB(n);return t&&!!t.aggregate}}return!1})}function jB(t,e){const n=[],r=[],i=[],s=[],o={};return VB(t,(a,l)=>{if(qL(a)){const{field:u,aggregate:c,bin:h,timeUnit:d}=a,f=sF(a,["field","aggregate","bin","timeUnit"]);if(c||d||h){const t=hB(a),p=t&&t.title;let m=iB(a,{forAs:!0});const g=Object.assign(Object.assign(Object.assign({},p?[]:{title:cB(a,e,{allowDisabling:!0})}),f),{field:m});if(c){let t;if(TM(c)?(t="argmax",m=iB({op:"argmax",field:c.argmax},{forAs:!0}),g.field=`${m}.${u}`):NM(c)?(t="argmin",m=iB({op:"argmin",field:c.argmin},{forAs:!0}),g.field=`${m}.${u}`):"boxplot"!==c&&"errorbar"!==c&&"errorband"!==c&&(t=c),t){const e={op:t,as:m};u&&(e.field=u),s.push(e)}}else if(n.push(m),ZL(a)&&D$(h))r.push({bin:h,field:u,as:m}),n.push(iB(a,{binSuffix:"end"})),CB(a,l)&&n.push(iB(a,{binSuffix:"range"})),m$(l)&&(o[l+"2"]={field:m+"_end"}),g.bin="binned",o$(l)||(g.type=zz);else if(d){i.push({timeUnit:d,field:u,as:m});const t=ZL(a)&&a.type!==Bz&&"time";t&&("text"===l||"tooltip"===l?g.formatType=t:function(t){return!!h$[t]}(l)?g.legend=Object.assign({formatType:t},g.legend):m$(l)&&(g.axis=Object.assign({formatType:t},g.axis)))}o[l]=g}else n.push(u),o[l]=t[l]}else o[l]=t[l]}),{bins:r,timeUnits:i,aggregate:s,groupby:n,encoding:o}}function UB(t,e){return IF(t).reduce((n,r)=>{const i=gB(t[r],r,e,{compositeMark:!0});return n[r]=i,n},{})}function VB(t,e,n){if(t)for(const r of IF(t)){const i=t[r];if(Jt(i))for(const t of i)e.call(n,t,r);else e.call(n,i,r)}}function WB(t,e,n,r){return t?IF(t).reduce((n,i)=>{const s=t[i];return Jt(s)?s.reduce((t,n)=>e.call(r,t,n,i),n):e.call(r,n,s,i)},n):n}function qB(t,e){return IF(e).reduce((n,r)=>{switch(r){case"x":case"y":case"href":case"description":case"url":case"x2":case"y2":case LM:case BM:case zM:case"radius2":case"latitude":case"longitude":case"latitude2":case"longitude2":case"text":case WM:case"angle":case"tooltip":return n;case"order":if("line"===t||"trail"===t)return n;case"detail":case"key":{const t=e[r];if(Jt(t)||qL(t))for(const e of Ce(t))e.aggregate||n.push(iB(e,{}));return n}case qM:if("trail"===t)return n;case jM:case UM:case VM:case"opacity":case"fillOpacity":case"strokeOpacity":case"strokeDash":case"strokeWidth":{const t=pB(e[r]);return t&&!t.aggregate&&n.push(iB(t,{})),n}}},[])}function HB(t,e,n,r=!0){return"tooltip"in n?{tooltip:n.tooltip}:{tooltip:[...t.map(({fieldPrefix:t,titlePrefix:n})=>{const i=r?" of "+GB(e):"";return{field:t+e.field,type:e.type,title:bz(n)?{signal:n+`"${escape(i)}"`}:n+i}}),...AF(function(t){const e=[];for(const n of IF(t))if(LB(t,n)){const r=Ce(t[n]);for(const t of r)qL(t)?e.push(t):VL(t)&&e.push(t.condition)}return e}(n).map(rB),_F)]}}function GB(t){const{title:e,field:n}=t;return HF(e,n)}function YB(t,e,n,r,i){const{scale:s,axis:o}=n;return({partName:a,mark:l,positionPrefix:u,endPositionPrefix:c,extraEncoding:h={}})=>{const d=GB(n);return KB(t,a,i,{mark:l,encoding:Object.assign(Object.assign(Object.assign({[e]:Object.assign(Object.assign(Object.assign({field:u+"_"+n.field,type:n.type},void 0!==d?{title:d}:{}),void 0!==s?{scale:s}:{}),void 0!==o?{axis:o}:{})},Ye(c)?{[e+"2"]:{field:c+"_"+n.field}}:{}),r),h)})}}function KB(t,e,n,r){const{clip:i,color:s,opacity:o}=t,a=t.type;return t[e]||void 0===t[e]&&n[e]?[Object.assign(Object.assign({},r),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[e]),i?{clip:i}:{}),s?{color:s}:{}),o?{opacity:o}:{}),_M(r.mark)?r.mark:{type:r.mark}),{style:`${a}-${e}`}),We(t[e])?{}:t[e])})]:[]}function XB(t,e,n){const{encoding:r}=t,i="vertical"===e?"y":"x",s=r[i+"2"],o=r[i+"Error"],a=r[i+"Error2"];return{continuousAxisChannelDef:ZB(r[i],n),continuousAxisChannelDef2:ZB(s,n),continuousAxisChannelDefError:ZB(o,n),continuousAxisChannelDefError2:ZB(a,n),continuousAxis:i}}function ZB(t,e){if(t&&t.aggregate){const{aggregate:n}=t,r=sF(t,["aggregate"]);return n!==e&&rz(m.errorBarContinuousAxisHasCustomizedAggregate(n,e)),r}return t}function QB(t,e){const{mark:n,encoding:r}=t,{x:i,y:s}=r;if(_M(n)&&n.orient)return n.orient;if(YL(i)){if(YL(s)){const t=qL(i)&&i.aggregate,n=qL(s)&&s.aggregate;if(t||n!==e){if(n||t!==e){if(t===e&&n===e)throw new Error("Both x and y cannot have aggregate");return _B(s)&&!_B(i)?"horizontal":"vertical"}return"horizontal"}return"vertical"}return"horizontal"}if(YL(s))return"vertical";throw new Error(`Need a valid continuous axis for ${e}s`)}const JB=new kM("boxplot",ej);function tj(t){return He(t)?"tukey":t}function ej(t,{config:e}){var n,r;t=Object.assign(Object.assign({},t),{encoding:UB(t.encoding,e)});const{mark:i,selection:s}=t,o=sF(t,["mark","encoding","selection","projection"]),a=_M(i)?i:{type:i};s&&rz(m.selectionNotSupported("boxplot"));const l=null!==(n=a.extent)&&void 0!==n?n:e.boxplot.extent,u=OB("size",a,e),c=tj(l),{bins:h,timeUnits:d,transform:f,continuousAxisChannelDef:p,continuousAxis:g,groupby:y,aggregate:v,encodingWithoutContinuousAxis:b,ticksOrient:x,boxOrient:_,customTooltipWithoutAggregatedField:w}=function(t,e,n){const r=QB(t,"boxplot"),{continuousAxisChannelDef:i,continuousAxis:s}=XB(t,r,"boxplot"),o=i.field,a=tj(e),l=[...nj(o),{op:"median",field:o,as:"mid_box_"+o},{op:"min",field:o,as:("min-max"===a?"lower_whisker_":"min_")+o},{op:"max",field:o,as:("min-max"===a?"upper_whisker_":"max_")+o}],u="min-max"===a||"tukey"===a?[]:[{calculate:`datum["upper_box_${o}"] - datum["lower_box_${o}"]`,as:"iqr_"+o},{calculate:`min(datum["upper_box_${o}"] + datum["iqr_${o}"] * ${e}, datum["max_${o}"])`,as:"upper_whisker_"+o},{calculate:`max(datum["lower_box_${o}"] - datum["iqr_${o}"] * ${e}, datum["min_${o}"])`,as:"lower_whisker_"+o}],c=sF(t.encoding,["symbol"==typeof s?s:s+""]),{customTooltipWithoutAggregatedField:h,filteredEncoding:d}=function(t){const{tooltip:e}=t,n=sF(t,["tooltip"]);if(!e)return{filteredEncoding:n};let r,i;if(Jt(e)){for(const t of e)t.aggregate?(r||(r=[]),r.push(t)):(i||(i=[]),i.push(t));r&&(n.tooltip=r)}else e.aggregate?n.tooltip=e:i=e;return Jt(i)&&1===i.length&&(i=i[0]),{customTooltipWithoutAggregatedField:i,filteredEncoding:n}}(c),{bins:f,timeUnits:p,aggregate:m,groupby:g,encoding:y}=jB(d,n),v="vertical"===r?"horizontal":"vertical",b=r;return{bins:f,timeUnits:p,transform:[...f,...p,{aggregate:[...m,...l],groupby:g},...u],groupby:g,aggregate:m,continuousAxisChannelDef:i,continuousAxis:s,encodingWithoutContinuousAxis:y,ticksOrient:v,boxOrient:b,customTooltipWithoutAggregatedField:h}}(t,l,e),{size:S}=b,C=sF(b,["color","size"]),E=t=>YB(a,g,p,t,e.boxplot),k=E(C),A=E(b),D=E(Object.assign(Object.assign({},C),S?{size:S}:{})),N=HB([{fieldPrefix:"min-max"===c?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:"min-max"===c?"lower_whisker_":"min_",titlePrefix:"Min"}],p,b),T={type:"tick",color:"black",opacity:1,orient:x,invalid:null,aria:!1},O="min-max"===c?N:HB([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],p,b),I=[...k({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:O}),...k({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:O}),...k({partName:"ticks",mark:T,positionPrefix:"lower_whisker",extraEncoding:O}),...k({partName:"ticks",mark:T,positionPrefix:"upper_whisker",extraEncoding:O})],R=[..."tukey"!==c?I:[],...A({partName:"box",mark:Object.assign(Object.assign({type:"bar"},u?{size:u}:{}),{orient:_,invalid:null,ariaRoleDescription:"box"}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:N}),...D({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},te(e.boxplot.median)&&e.boxplot.median.color?{color:e.boxplot.median.color}:{}),u?{size:u}:{}),{orient:x,aria:!1}),positionPrefix:"mid_box",extraEncoding:N})];if("min-max"===c)return Object.assign(Object.assign({},o),{transform:(null!==(r=o.transform)&&void 0!==r?r:[]).concat(f),layer:R});const F=`datum["lower_box_${p.field}"]`,M=`datum["upper_box_${p.field}"]`,$=`(${M} - ${F})`,P=`${F} - ${l} * ${$}`,z=`${M} + ${l} * ${$}`,L=`datum["${p.field}"]`,B={joinaggregate:nj(p.field),groupby:y},j={transform:[{filter:`(${P} <= ${L}) && (${L} <= ${z})`},{aggregate:[{op:"min",field:p.field,as:"lower_whisker_"+p.field},{op:"max",field:p.field,as:"upper_whisker_"+p.field},{op:"min",field:"lower_box_"+p.field,as:"lower_box_"+p.field},{op:"max",field:"upper_box_"+p.field,as:"upper_box_"+p.field},...v],groupby:y}],layer:I},U=sF(C,["tooltip"]),{scale:V,axis:W}=p,q=GB(p),H=bF(W,["title"]),G=KB(a,"outliers",e.boxplot,{transform:[{filter:`(${L} < ${P}) || (${L} > ${z})`}],mark:"point",encoding:Object.assign(Object.assign({[g]:Object.assign(Object.assign(Object.assign({field:p.field,type:p.type},void 0!==q?{title:q}:{}),void 0!==V?{scale:V}:{}),OF(H)?{}:{axis:H})},U),w?{tooltip:w}:{})})[0];let Y;const K=[...h,...d,B];return G?Y={transform:K,layer:[G,j]}:(Y=j,Y.transform.unshift(...K)),Object.assign(Object.assign({},o),{layer:[Y,{transform:f,layer:R}]})}function nj(t){return[{op:"q1",field:t,as:"lower_box_"+t},{op:"q3",field:t,as:"upper_box_"+t}]}const rj=new kM("errorbar",ij);function ij(t,{config:e}){t=Object.assign(Object.assign({},t),{encoding:UB(t.encoding,e)});const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:s,ticksOrient:o,markDef:a,outerSpec:l,tooltipEncoding:u}=sj(t,"errorbar",e);delete s.size;const c=YB(a,i,r,s,e.errorbar),h=a.thickness,d=a.size,f=Object.assign(Object.assign({type:"tick",orient:o,aria:!1},void 0!==h?{thickness:h}:{}),void 0!==d?{size:d}:{}),p=[...c({partName:"ticks",mark:f,positionPrefix:"lower",extraEncoding:u}),...c({partName:"ticks",mark:f,positionPrefix:"upper",extraEncoding:u}),...c({partName:"rule",mark:Object.assign({type:"rule",ariaRoleDescription:"errorbar"},void 0!==h?{size:h}:{}),positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u})];return Object.assign(Object.assign(Object.assign({},l),{transform:n}),p.length>1?{layer:p}:Object.assign({},p[0]))}function sj(t,e,n){var r;const{mark:i,encoding:s,selection:o}=t,a=sF(t,["mark","encoding","selection","projection"]),l=_M(i)?i:{type:i};o&&rz(m.selectionNotSupported(e));const{orient:u,inputType:c}=function(t,e){const{encoding:n}=t;if(function(t){return(XL(t.x)||XL(t.y))&&!XL(t.x2)&&!XL(t.y2)&&!XL(t.xError)&&!XL(t.xError2)&&!XL(t.yError)&&!XL(t.yError2)}(n))return{orient:QB(t,e),inputType:"raw"};const r=function(t){return XL(t.x2)||XL(t.y2)}(n),i=function(t){return XL(t.xError)||XL(t.xError2)||XL(t.yError)||XL(t.yError2)}(n),s=n.x,o=n.y;if(r){if(i)throw new Error(e+" cannot be both type aggregated-upper-lower and aggregated-error");const t=n.x2,r=n.y2;if(XL(t)&&XL(r))throw new Error(e+" cannot have both x2 and y2");if(XL(t)){if(YL(s))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error("Both x and x2 have to be quantitative in "+e)}if(XL(r)){if(YL(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error("Both y and y2 have to be quantitative in "+e)}throw new Error("No ranged axis")}{const t=n.xError,r=n.yError,i=n.yError2;if(XL(n.xError2)&&!XL(t))throw new Error(e+" cannot have xError2 without xError");if(XL(i)&&!XL(r))throw new Error(e+" cannot have yError2 without yError");if(XL(t)&&XL(r))throw new Error(e+" cannot have both xError and yError with both are quantiative");if(XL(t)){if(YL(s))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}if(XL(r)){if(YL(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}(t,e),{continuousAxisChannelDef:h,continuousAxisChannelDef2:d,continuousAxisChannelDefError:f,continuousAxisChannelDefError2:p,continuousAxis:g}=XB(t,u,e),{errorBarSpecificAggregate:y,postAggregateCalculates:v,tooltipSummary:b,tooltipTitleWithFieldName:x}=function(t,e,n,r,i,s,o,a){let l=[],u=[];const c=e.field;let h,d=!1;if("raw"===s){const e=t.center?t.center:t.extent?"iqr"===t.extent?"median":"mean":a.errorbar.center,n=t.extent?t.extent:"mean"===e?"stderr":"iqr";if("median"===e!=("iqr"===n)&&rz(m.errorBarCenterIsUsedWithWrongExtent(e,n,o)),"stderr"===n||"stdev"===n)l=[{op:n,field:c,as:"extent_"+c},{op:e,field:c,as:"center_"+c}],u=[{calculate:`datum["center_${c}"] + datum["extent_${c}"]`,as:"upper_"+c},{calculate:`datum["center_${c}"] - datum["extent_${c}"]`,as:"lower_"+c}],h=[{fieldPrefix:"center_",titlePrefix:LF(e)},{fieldPrefix:"upper_",titlePrefix:oj(e,n,"+")},{fieldPrefix:"lower_",titlePrefix:oj(e,n,"-")}],d=!0;else{let t,e,r;"ci"===n?(t="mean",e="ci0",r="ci1"):(t="median",e="q1",r="q3"),l=[{op:e,field:c,as:"lower_"+c},{op:r,field:c,as:"upper_"+c},{op:t,field:c,as:"center_"+c}],h=[{fieldPrefix:"upper_",titlePrefix:cB({field:c,aggregate:r,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:cB({field:c,aggregate:e,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:cB({field:c,aggregate:t,type:"quantitative"},a,{allowDisabling:!1})}]}}else{(t.center||t.extent)&&rz(m.errorBarCenterAndExtentAreNotNeeded(t.center,t.extent)),"aggregated-upper-lower"===s?(h=[],u=[{calculate:`datum["${n.field}"]`,as:"upper_"+c},{calculate:`datum["${c}"]`,as:"lower_"+c}]):"aggregated-error"===s&&(h=[{fieldPrefix:"",titlePrefix:c}],u=[{calculate:`datum["${c}"] + datum["${r.field}"]`,as:"upper_"+c}],u.push(i?{calculate:`datum["${c}"] + datum["${i.field}"]`,as:"lower_"+c}:{calculate:`datum["${c}"] - datum["${r.field}"]`,as:"lower_"+c}));for(const t of u)h.push({fieldPrefix:t.as.substring(0,6),titlePrefix:VF(VF(t.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:u,errorBarSpecificAggregate:l,tooltipSummary:h,tooltipTitleWithFieldName:d}}(l,h,d,f,p,c,e,n),_="x"===g?"x2":"y2",w="x"===g?"xError":"yError",S="x"===g?"xError2":"yError2",C=sF(s,["symbol"==typeof g?g:g+"","symbol"==typeof _?_:_+"","symbol"==typeof w?w:w+"","symbol"==typeof S?S:S+""]),{bins:E,timeUnits:k,aggregate:A,groupby:D,encoding:N}=jB(C,n),T=[...A,...y],O="raw"!==c?[]:D,I=HB(b,h,N,x);return{transform:[...null!==(r=a.transform)&&void 0!==r?r:[],...E,...k,...0===T.length?[]:[{aggregate:T,groupby:O}],...v],groupby:O,continuousAxisChannelDef:h,continuousAxis:g,encodingWithoutContinuousAxis:N,ticksOrient:"vertical"===u?"horizontal":"vertical",markDef:l,outerSpec:a,tooltipEncoding:I}}function oj(t,e,n){return LF(t)+" "+n+" "+e}const aj=new kM("errorband",lj);function lj(t,{config:e}){t=Object.assign(Object.assign({},t),{encoding:UB(t.encoding,e)});const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:s,markDef:o,outerSpec:a,tooltipEncoding:l}=sj(t,"errorband",e),u=o,c=YB(u,i,r,s,e.errorband),h=void 0!==t.encoding.x&&void 0!==t.encoding.y;let d={type:h?"area":"rect"},f={type:h?"line":"rule"};const p=Object.assign(Object.assign({},u.interpolate?{interpolate:u.interpolate}:{}),u.tension&&u.interpolate?{tension:u.tension}:{});return h?(d=Object.assign(Object.assign(Object.assign({},d),p),{ariaRoleDescription:"errorband"}),f=Object.assign(Object.assign(Object.assign({},f),p),{aria:!1})):u.interpolate?rz(m.errorBand1DNotSupport("interpolate")):u.tension&&rz(m.errorBand1DNotSupport("tension")),Object.assign(Object.assign({},a),{transform:n,layer:[...c({partName:"band",mark:d,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l}),...c({partName:"borders",mark:f,positionPrefix:"lower",extraEncoding:l}),...c({partName:"borders",mark:f,positionPrefix:"upper",extraEncoding:l})]})}const uj={};function cj(t,e,n){const r=new kM(t,e);uj[t]={normalizer:r,parts:n}}cj("boxplot",ej,["box","median","outliers","rule","ticks"]),cj("errorbar",ij,["ticks","rule"]),cj("errorband",lj,["band","borders"]);const hj=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],dj=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],fj={fillColor:{part:"legend",vgProp:"fill"},gradientStrokeColor:{part:"gradient",vgProp:"stroke"},labelColor:{part:"labels",vgProp:"fill"},strokeColor:{part:"legend",vgProp:"stroke"},symbolFillColor:{part:"symbols",vgProp:"fill"},symbolStrokeColor:{part:"symbols",vgProp:"stroke"},titleColor:{part:"title",vgProp:"fill"}},pj={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},mj=(IF(pj),{single:{on:"click",fields:["_vgsid_"],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:["_vgsid_"],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}});function gj(t){return!(!t||"legend"!==t&&!t.legend)}function yj(t){return gj(t)&&te(t)}function vj(t){return"concat"in t}function bj(t){return"vconcat"in t}function xj(t){return"hconcat"in t}function _j(t){return te(t)&&void 0!==t.step}function wj(t){return t.view||t.width||t.height}const Sj=IF({align:1,bounds:1,center:1,columns:1,spacing:1});function Cj(t,e){var n;return null!==(n=t[e])&&void 0!==n?n:t["width"===e?"continuousWidth":"continuousHeight"]}function Ej(t,e){const n=kj(t,e);return _j(n)?n.step:Aj}function kj(t,e){var n;return HF(null!==(n=t[e])&&void 0!==n?n:t["width"===e?"discreteWidth":"discreteHeight"],{step:t.step})}const Aj=20,Dj={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:{continuousWidth:200,continuousHeight:200,step:Aj},mark:{color:"#4c78a8",invalid:"filter",timeUnitBand:1},arc:{},area:{},bar:{binSpacing:1,continuousBandSize:5,timeUnitBandPosition:.5},circle:{},geoshape:{},image:{},line:{},point:{},rect:{binSpacing:0,continuousBandSize:5,timeUnitBandPosition:.5},rule:{color:"black"},square:{},text:{color:"black"},tick:{thickness:1},trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:{pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4},projection:{},legend:{gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:mj,style:{},title:{},facet:{spacing:20},concat:{spacing:20}},Nj=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],Tj={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},Oj={blue:Nj[0],orange:Nj[1],red:Nj[2],teal:Nj[3],green:Nj[4],yellow:Nj[5],purple:Nj[6],pink:Nj[7],brown:Nj[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function Ij(t={}){const{color:e,font:n,fontSize:r}=t,i=sF(t,["color","font","fontSize"]);return ne({},Dj,n?function(t){return{text:{font:t},style:{"guide-label":{font:t},"guide-title":{font:t},"group-title":{font:t},"group-subtitle":{font:t}}}}(n):{},e?function(t={}){return{signals:[{name:"color",value:te(t)?Object.assign(Object.assign({},Oj),t):Oj}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}(e):{},r?function(t){return{signals:[{name:"fontSize",value:te(t)?Object.assign(Object.assign({},Tj),t):Tj}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}(r):{},i||{})}const Rj=["view",...xM],Fj=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],Mj=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},{area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]});function $j(t,e,n,r){"view"===e&&(n="cell");const i=Object.assign(Object.assign({},r?t[e][r]:t[e]),t.style[null!=n?n:e]);OF(i)||(t.style[null!=n?n:e]=i),r||delete t[e]}function Pj(t){return"layer"in t}const zj={zero:1,center:1,normalize:1},Lj=new Set([iM,oM,sM,hM,uM,mM,gM,lM,dM,fM]),Bj=new Set([oM,sM,iM]);function jj(t,e){var n,r;const i="x"===e?"y":"radius",s=t[e],o=t[i];if(qL(s)&&qL(o))if("quantitative"===HL(s)&&"quantitative"===HL(o)){if(s.stack)return e;if(o.stack)return i;const t=qL(s)&&!!s.aggregate;if(t!==(qL(o)&&!!o.aggregate))return t?e:i;{const t=null===(n=s.scale)||void 0===n?void 0:n.type,a=null===(r=o.scale)||void 0===r?void 0:r.type;if(t&&"linear"!==t)return i;if(a&&"linear"!==a)return e}}else{if("quantitative"===HL(s))return e;if("quantitative"===HL(o))return i}else{if("quantitative"===HL(s))return e;if("quantitative"===HL(o))return i}}function Uj(t,e,n={}){const r=_M(t)?t.type:t;if(!Lj.has(r))return null;const i=jj(e,"x")||jj(e,"theta");if(!i)return null;const s=e[i],o=qL(s)?iB(s,{}):void 0;let a=function(t){switch(t){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}(i),l=e[a],u=qL(l)?iB(l,{}):void 0;u===o&&(u=void 0,l=void 0,a=void 0);const c=d$.reduce((t,n)=>{if("tooltip"!==n&&LB(e,n)){const r=e[n];for(const e of Ce(r)){const r=pB(e);if(r.aggregate)continue;const i=iB(r,{});i&&i===u||t.push({channel:n,fieldDef:r})}}return t},[]);let h;if(void 0!==s.stack?h=We(s.stack)?s.stack?"zero":null:s.stack:c.length>0&&Bj.has(r)&&(h="zero"),!h||!(h in zj))return null;if(BB(e)&&0===c.length)return null;if(s.scale&&s.scale.type&&"linear"!==s.scale.type){if(n.disallowNonLinearStack)return null;rz(m.cannotStackNonLinearScale(s.scale.type))}return XL(e[u$(i)])?(void 0!==s.stack&&rz(m.cannotStackRangedMark(i)),null):(qL(s)&&s.aggregate&&!SF(FM,s.aggregate)&&rz(m.stackNonSummativeAggregate(s.aggregate)),{groupbyChannel:l?a:void 0,groupbyField:u,fieldChannel:i,impute:null!==s.impute&&vM(r),stackBy:c,offset:h})}function Vj(t){const e=sF(t,["point","line"]);return IF(e).length>1?e:e.type}function Wj(t){for(const e of["line","area","rule","trail"])t[e]&&(t=Object.assign(Object.assign({},t),{[e]:bF(t[e],["point","line"])}));return t}function qj(t,e={},n){return"transparent"===t.point?{opacity:0}:t.point?te(t.point)?t.point:{}:void 0!==t.point?null:e.point||n.shape?te(e.point)?e.point:{}:void 0}function Hj(t,e={}){return t.line?!0===t.line?{}:t.line:void 0!==t.line?null:e.line?!0===e.line?{}:e.line:void 0}class Gj{constructor(){this.name="path-overlay"}hasMatchingType(t,e){if(EM(t)){const{mark:n,encoding:r}=t,i=_M(n)?n:{type:n};switch(i.type){case"line":case"rule":case"trail":return!!qj(i,e[i.type],r);case"area":return!!qj(i,e[i.type],r)||!!Hj(i,e[i.type])}}return!1}run(t,e,n){const{config:r}=e,{selection:i,projection:s,mark:o,encoding:a}=t,l=sF(t,["selection","projection","mark","encoding"]),u=UB(a,r),c=_M(o)?o:{type:o},h=qj(c,r[c.type],u),d="area"===c.type&&Hj(c,r[c.type]),f=[Object.assign(Object.assign({},i?{selection:i}:{}),{mark:Vj(Object.assign(Object.assign({},"area"===c.type&&void 0===c.opacity&&void 0===c.fillOpacity?{opacity:.7}:{}),c)),encoding:bF(u,["shape"])})],p=Uj(c,u);let m=u;if(p){const{fieldChannel:t,offset:e}=p;m=Object.assign(Object.assign({},u),{[t]:Object.assign(Object.assign({},u[t]),e?{stack:e}:{})})}return d&&f.push(Object.assign(Object.assign({},s?{projection:s}:{}),{mark:Object.assign(Object.assign({type:"line"},vF(c,["clip","interpolate","tension","tooltip"])),d),encoding:m})),h&&f.push(Object.assign(Object.assign({},s?{projection:s}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},vF(c,["clip","tooltip"])),h),encoding:m})),n(Object.assign(Object.assign({},l),{layer:f}),Object.assign(Object.assign({},e),{config:Wj(r)}))}}class Yj{constructor(){this.name="RangeStep"}hasMatchingType(t){var e;if(EM(t)&&t.encoding)for(const n of p$){const r=t.encoding[n];if(r&&XL(r)&&(null===(e=null==r?void 0:r.scale)||void 0===e?void 0:e.rangeStep))return!0}return!1}run(t){var e;const n={};let r=Object.assign({},t.encoding);for(const i of p$){const t=c$(i),s=r[i];if(s&&XL(s)&&(null===(e=null==s?void 0:s.scale)||void 0===e?void 0:e.rangeStep)){const{scale:e}=s,o=sF(s,["scale"]),a=sF(e,["rangeStep"]);n[t]={step:e.rangeStep},rz(m.RANGE_STEP_DEPRECATED),r=Object.assign(Object.assign({},r),{[i]:Object.assign(Object.assign({},o),OF(a)?{}:{scale:a})})}}return Object.assign(Object.assign(Object.assign({},n),t),{encoding:r})}}function Kj(t,e){return e?ML(t)?eU(t,e):Qj(t,e):t}function Xj(t,e){return e?eU(t,e):t}function Zj(t,e,n){const r=e[t];return(i=r)&&!Ye(i)&&"repeat"in i?r.repeat in n?Object.assign(Object.assign({},e),{[t]:n[r.repeat]}):void rz(m.noSuchRepeatedValue(r.repeat)):e;var i}function Qj(t,e){if(void 0!==(t=Zj("field",t,e))){if(null===t)return null;if(LL(t)&&RL(t.sort)){const n=Zj("field",t.sort,e);t=Object.assign(Object.assign({},t),n?{sort:n}:{})}return t}}function Jj(t,e){if(qL(t))return Qj(t,e);{const n=Zj("datum",t,e);return n===t||n.type||(n.type="nominal"),n}}function tU(t,e){if(!XL(t)){if(WL(t)){const n=Jj(t.condition,e);return n?Object.assign(Object.assign({},t),{condition:n}):sF(t,["condition"])}return t}{const n=Jj(t,e);if(n)return n;if(UL(t))return{condition:t.condition}}}function eU(t,e){const n={};for(const r in t)if(ze(t,r)){const i=t[r];if(Jt(i))n[r]=i.map(t=>tU(t,e)).filter(t=>t);else{const t=tU(i,e);void 0!==t&&(n[r]=t)}}return n}class nU{constructor(){this.name="RuleForRangedLine"}hasMatchingType(t){if(EM(t)){const{encoding:e,mark:n}=t;if("line"===n)for(const t of s$){const n=e[a$(t)];if(e[t]&&(qL(n)&&!N$(n.bin)||GL(n)))return!0}}return!1}run(t,e,n){const{encoding:r}=t;return rz(m.lineWithRange(!!r.x2,!!r.y2)),n(Object.assign(Object.assign({},t),{mark:"rule"}),e)}}function rU({parentEncoding:t,encoding:e={},layer:n}){let r={};if(t){const i=new Set([...IF(t),...IF(e)]);for(const s of i){const i=e[s],o=t[s];if(XL(i)){const t=Object.assign(Object.assign({},o),i);r[s]=t}else WL(i)?r[s]=Object.assign(Object.assign({},i),{condition:Object.assign(Object.assign({},o),i.condition)}):i||null===i?r[s]=i:(n||QL(o)||bz(o)||XL(o)||Jt(o))&&(r[s]=o)}}else r=e;return!r||OF(r)?void 0:r}function iU(t){const{parentProjection:e,projection:n}=t;return e&&n&&rz(m.projectionOverridden({parentProjection:e,projection:n})),null!=n?n:e}function sU(t,e){void 0===e&&(e=Ij(t.config));const n=function(t,e={}){return oU.map(t,{config:e})}(t,e),{width:r,height:i}=t,s=function(t,e,n){let{width:r,height:i}=e;const s=EM(t)||Pj(t),o={};s?"container"==r&&"container"==i?(o.type="fit",o.contains="padding"):"container"==r?(o.type="fit-x",o.contains="padding"):"container"==i&&(o.type="fit-y",o.contains="padding"):("container"==r&&(rz(m.containerSizeNonSingle("width")),r=void 0),"container"==i&&(rz(m.containerSizeNonSingle("height")),i=void 0));const a=Object.assign(Object.assign(Object.assign({type:"pad"},o),n?aU(n.autosize):{}),aU(t.autosize));if("fit"!==a.type||s||(rz(m.FIT_NON_SINGLE),a.type="pad"),"container"==r&&"fit"!=a.type&&"fit-x"!=a.type&&rz(m.containerSizeNotCompatibleWithAutosize("width")),"container"==i&&"fit"!=a.type&&"fit-y"!=a.type&&rz(m.containerSizeNotCompatibleWithAutosize("height")),!gF(a,{type:"pad"}))return a}(n,{width:r,height:i,autosize:t.autosize},e);return Object.assign(Object.assign({},n),s?{autosize:s}:{})}const oU=new class extends class{map(t,e){return PL(t)?this.mapFacet(t,e):function(t){return"repeat"in t}(t)?this.mapRepeat(t,e):xj(t)?this.mapHConcat(t,e):bj(t)?this.mapVConcat(t,e):vj(t)?this.mapConcat(t,e):this.mapLayerOrUnit(t,e)}mapLayerOrUnit(t,e){if(Pj(t))return this.mapLayer(t,e);if(EM(t))return this.mapUnit(t,e);throw new Error(m.invalidSpec(t))}mapLayer(t,e){return Object.assign(Object.assign({},t),{layer:t.layer.map(t=>this.mapLayerOrUnit(t,e))})}mapHConcat(t,e){return Object.assign(Object.assign({},t),{hconcat:t.hconcat.map(t=>this.map(t,e))})}mapVConcat(t,e){return Object.assign(Object.assign({},t),{vconcat:t.vconcat.map(t=>this.map(t,e))})}mapConcat(t,e){const{concat:n}=t,r=sF(t,["concat"]);return Object.assign(Object.assign({},r),{concat:n.map(t=>this.map(t,e))})}mapFacet(t,e){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,e)})}mapRepeat(t,e){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,e)})}}{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[JB,rj,aj,new Gj,new nU,new Yj]}map(t,e){if(EM(t)){const n=LB(t.encoding,$M),r=LB(t.encoding,PM),i=LB(t.encoding,"facet");if(n||r||i)return this.mapFacetedUnit(t,e)}return super.map(t,e)}mapUnit(t,e){const{parentEncoding:n,parentProjection:r}=e,i=Xj(t.encoding,e.repeater),s=Object.assign(Object.assign({},t),i?{encoding:i}:{});if(n||r)return this.mapUnitWithParentEncodingOrProjection(s,e);const o=this.mapLayerOrUnit.bind(this);for(const a of this.nonFacetUnitNormalizers)if(a.hasMatchingType(s,e.config))return a.run(s,e,o);return s}mapRepeat(t,e){return function(t){return!Jt(t.repeat)&&t.repeat.layer}(t)?this.mapLayerRepeat(t,e):this.mapNonLayerRepeat(t,e)}mapLayerRepeat(t,e){const{repeat:n,spec:r}=t,i=sF(t,["repeat","spec"]),{row:s,column:o,layer:a}=n,{repeater:l={},repeaterPrefix:u=""}=e;return s||o?this.mapRepeat(Object.assign(Object.assign({},t),{repeat:Object.assign(Object.assign({},s?{row:s}:{}),o?{column:o}:{}),spec:{repeat:{layer:a},spec:r}}),e):Object.assign(Object.assign({},i),{layer:a.map(t=>{const n=Object.assign(Object.assign({},l),{layer:t}),i=(r.name||"")+u+"child__layer_"+$F(t),s=this.mapLayerOrUnit(r,Object.assign(Object.assign({},e),{repeater:n,repeaterPrefix:i}));return s.name=i,s})})}mapNonLayerRepeat(t,e){var n;const{repeat:r,spec:i,data:s}=t,o=sF(t,["repeat","spec","data"]);!Jt(r)&&t.columns&&(t=bF(t,["columns"]),rz(m.columnsNotSupportByRowCol("repeat")));const a=[],{repeater:l={},repeaterPrefix:u=""}=e,c=!Jt(r)&&r.row||[l?l.row:null],h=!Jt(r)&&r.column||[l?l.column:null],d=Jt(r)&&r||[l?l.repeat:null];for(const p of d)for(const t of c)for(const n of h){const s={repeat:p,row:t,column:n,layer:l.layer},o=(i.name||"")+u+"child__"+(Jt(r)?""+$F(p):(r.row?"row_"+$F(t):"")+(r.column?"column_"+$F(n):"")),c=this.map(i,Object.assign(Object.assign({},e),{repeater:s,repeaterPrefix:o}));c.name=o,a.push(bF(c,["data"]))}const f=Jt(r)?t.columns:r.column?r.column.length:1;return Object.assign(Object.assign({data:null!==(n=i.data)&&void 0!==n?n:s,align:"all"},o),{columns:f,concat:a})}mapFacet(t,e){const{facet:n}=t;return ML(n)&&t.columns&&(t=bF(t,["columns"]),rz(m.columnsNotSupportByRowCol("facet"))),super.mapFacet(t,e)}mapUnitWithParentEncodingOrProjection(t,e){const{encoding:n,projection:r}=t,{parentEncoding:i,parentProjection:s,config:o}=e,a=iU({parentProjection:s,projection:r}),l=rU({parentEncoding:i,encoding:Xj(n,e.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},t),a?{projection:a}:{}),l?{encoding:l}:{}),{config:o})}mapFacetedUnit(t,e){const n=t.encoding,{row:r,column:i,facet:s}=n,o=sF(n,["row","column","facet"]),{mark:a,width:l,projection:u,height:c,view:h,selection:d}=t,f=sF(t,["mark","width","projection","height","view","selection","encoding"]),{facetMapping:p,layout:m}=this.getFacetMappingAndLayout({row:r,column:i,facet:s},e),g=Xj(o,e.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},f),m),{facet:p,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},l?{width:l}:{}),c?{height:c}:{}),h?{view:h}:{}),u?{projection:u}:{}),{mark:a,encoding:g}),d?{selection:d}:{})}),e)}getFacetMappingAndLayout(t,e){var n;const{row:r,column:i,facet:s}=t;if(r||i){s&&rz(m.facetChannelDropped([...r?[$M]:[],...i?[PM]:[]]));const e={},o={};for(const r of[$M,PM]){const i=t[r];if(i){const t=sF(i,["align","center","spacing","columns"]);e[r]=t;for(const e of["align","center","spacing"])void 0!==i[e]&&(o[e]=null!==(n=o[e])&&void 0!==n?n:{},o[e][r]=i[e])}}return{facetMapping:e,layout:o}}{const{align:t,center:n,spacing:r,columns:i}=s;return{facetMapping:Kj(sF(s,["align","center","spacing","columns"]),e.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},t?{align:t}:{}),n?{center:n}:{}),r?{spacing:r}:{}),i?{columns:i}:{})}}}mapLayer(t,e){var{parentEncoding:n,parentProjection:r}=e,i=sF(e,["parentEncoding","parentProjection"]);const{encoding:s,projection:o}=t,a=sF(t,["encoding","projection"]),l=Object.assign(Object.assign({},i),{parentEncoding:rU({parentEncoding:n,encoding:s,layer:!0}),parentProjection:iU({parentProjection:r,projection:o})});return super.mapLayer(a,l)}};function aU(t){return Ye(t)?{type:t}:null!=t?t:{}}const lU=["background","padding"];function uU(t){return lU.reduce((e,n)=>(t&&void 0!==t[n]&&(e[n]=t[n]),e),{})}class cU{constructor(t={},e={}){this.explicit=t,this.implicit=e}clone(){return new cU(yF(this.explicit),yF(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(t){return HF(this.explicit[t],this.implicit[t])}getWithExplicit(t){return void 0!==this.explicit[t]?{explicit:!0,value:this.explicit[t]}:void 0!==this.implicit[t]?{explicit:!1,value:this.implicit[t]}:{explicit:!1,value:void 0}}setWithExplicit(t,e){void 0!==e.value&&this.set(t,e.value,e.explicit)}set(t,e,n){return delete this[n?"implicit":"explicit"][t],this[n?"explicit":"implicit"][t]=e,this}copyKeyFromSplit(t,e){void 0!==e.explicit[t]?this.set(t,e.explicit[t],!0):void 0!==e.implicit[t]&&this.set(t,e.implicit[t],!1)}copyKeyFromObject(t,e){void 0!==e[t]&&this.set(t,e[t],!0)}copyAll(t){for(const e of IF(t.combine())){const n=t.getWithExplicit(e);this.setWithExplicit(e,n)}}}function hU(t){return{explicit:!0,value:t}}function dU(t){return{explicit:!1,value:t}}function fU(t){return(e,n,r,i)=>{const s=t(e.value,n.value);return s>0?e:s<0?n:pU(e,n,r,i)}}function pU(t,e,n,r){return t.explicit&&e.explicit&&rz(m.mergeConflictingProperty(n,r,t.value,e.value)),t}function mU(t,e,n,r,i=pU){return void 0===t||void 0===t.value?e:t.explicit&&!e.explicit?t:e.explicit&&!t.explicit?e:gF(t.value,e.value)?t:i(t,e,n,r)}class gU extends cU{constructor(t={},e={},n=!1){super(t,e),this.explicit=t,this.implicit=e,this.parseNothing=n}clone(){const t=super.clone();return t.parseNothing=this.parseNothing,t}}function yU(t){return"url"in t}function vU(t){return"values"in t}function bU(t){return"name"in t&&!yU(t)&&!vU(t)&&!xU(t)}function xU(t){return t&&(_U(t)||wU(t)||SU(t))}function _U(t){return"sequence"in t}function wU(t){return"sphere"in t}function SU(t){return"graticule"in t}var CU;function EU(t){return"filter"in t}function kU(t){return"lookup"in t}function AU(t){return"pivot"in t}function DU(t){return"density"in t}function NU(t){return"quantile"in t}function TU(t){return"regression"in t}function OU(t){return"loess"in t}function IU(t){return"sample"in t}function RU(t){return"window"in t}function FU(t){return"joinaggregate"in t}function MU(t){return"flatten"in t}function $U(t){return"calculate"in t}function PU(t){return"bin"in t}function zU(t){return"impute"in t}function LU(t){return"timeUnit"in t}function BU(t){return"aggregate"in t}function jU(t){return"stack"in t}function UU(t){return"fold"in t}function VU(t,e,n,r){const i=UL(e)&&e.condition,s=r(e);return i?{[n]:[...Ce(i).map(e=>{const n=r(e),i=function(t){return t.selection}(e)?QV(t,e.selection):tW(t,e.test);return Object.assign({test:i},n)}),...void 0!==s?[s]:[]]}:void 0!==s?{[n]:s}:{}}function WU(t,e="text"){return VU(t,t.encoding[e],e,e=>qU(e,t.config))}function qU(t,e,n="datum"){if(t){if(QL(t))return AB(t.value);if(XL(t)){const{format:r,formatType:i}=fB(t);return xL({fieldOrDatumDef:t,format:r,formatType:i,expr:n,config:e})}}}function HU(t,e={}){const{encoding:n,markDef:r,config:i,stack:s}=t,o=n.tooltip;if(Jt(o))return{tooltip:YU({tooltip:o},s,i,e)};{const a=e.reactiveGeom?"datum.datum":"datum";return VU(t,o,"tooltip",t=>{const o=qU(t,i,a);if(o)return o;if(null===t)return;let l=OB("tooltip",r,i);return!0===l&&(l={content:"encoding"}),Ye(l)?{value:l}:te(l)?bz(l)?l:"encoding"===l.content?YU(n,s,i,e):{signal:a}:void 0})}}function GU(t,e,n,{reactiveGeom:r}={}){const i={},s=r?"datum.datum":"datum",o=[];function a(r,a){const l=a$(a),u=ZL(r)?r:Object.assign(Object.assign({},r),{type:t[l].type}),c=u.title||dB(u,n),h=Ce(c).join(", ");let d;if(m$(a)){const r="x"===a?"x2":"y2",o=pB(t[r]);if(N$(u.bin)&&o){const t=iB(u,{expr:s}),e=iB(o,{expr:s}),{format:a,formatType:l}=fB(u);d=DL(t,e,a,l,n),i[r]=!0}else if(e&&e.fieldChannel===a&&"normalize"===e.offset){const{format:t,formatType:e}=fB(u);d=xL({fieldOrDatumDef:u,format:t,formatType:e,expr:s,config:n,normalizeStack:!0}).signal}}d=null!=d?d:qU(u,n,s).signal,o.push({channel:a,key:h,value:d})}VB(t,(t,e)=>{qL(t)?a(t,e):VL(t)&&a(t.condition,e)});const l={};for(const{channel:u,key:c,value:h}of o)i[u]||l[c]||(l[c]=h);return l}function YU(t,e,n,{reactiveGeom:r}={}){const i=FF(GU(t,e,n,{reactiveGeom:r})).map(({key:t,value:e})=>`"${t}": ${e}`);return i.length>0?{signal:`{${i.join(", ")}}`}:void 0}function KU(t,e,n={}){const{markDef:r,encoding:i,config:s}=e,{vgChannel:o}=n;let{defaultRef:a,defaultValue:l}=n;return void 0===a&&(l=null!=l?l:OB(t,r,s,{vgChannel:o,ignoreVgConfig:!0}),void 0!==l&&(a=AB(l))),VU(e,i[t],null!=o?o:t,n=>gL({channel:t,channelDef:n,markDef:r,config:s,scaleName:e.scaleName(t),scale:e.getScaleComponent(t),stack:null,defaultRef:a}))}function XU(t,e={filled:void 0}){var n,r,i,s;const{markDef:o,encoding:a,config:l}=t,{type:u}=o,c=null!==(n=e.filled)&&void 0!==n?n:OB("filled",o,l),h=SF(["bar","point","circle","square","geoshape"],u)?"transparent":void 0,d=null!==(i=null!==(r=OB(!0===c?"color":void 0,o,l,{vgChannel:"fill"}))&&void 0!==r?r:l.mark[!0===c&&"color"])&&void 0!==i?i:h,f=null!==(s=OB(!1===c?"color":void 0,o,l,{vgChannel:"stroke"}))&&void 0!==s?s:l.mark[!1===c&&"color"],p=c?"fill":"stroke",g=Object.assign(Object.assign({},d?{fill:AB(d)}:{}),f?{stroke:AB(f)}:{});return o.color&&(c?o.fill:o.stroke)&&rz(m.droppingColor("property",{fill:"fill"in o,stroke:"stroke"in o})),Object.assign(Object.assign(Object.assign(Object.assign({},g),KU("color",t,{vgChannel:p,defaultValue:c?d:f})),KU("fill",t,{defaultValue:a.fill?d:void 0})),KU("stroke",t,{defaultValue:a.stroke?f:void 0}))}function ZU(t,e){const n=e[function(t){switch(t){case"x":return"xOffset";case"y":return"yOffset";case"x2":return"x2Offset";case"y2":return"y2Offset";case LM:return"thetaOffset";case zM:return"radiusOffset";case BM:return"theta2Offset";case"radius2":return"radius2Offset"}}(t)];if(n)return n}function QU(t,e,{defaultPos:n,vgChannel:r,isMidPoint:i}){const{encoding:s,markDef:o,config:a,stack:l}=e,u=s[t],c=s[u$(t)],h=e.scaleName(t),d=e.getScaleComponent(t),f=ZU(t,o),p=JU({model:e,defaultPos:n,channel:t,scaleName:h,scale:d}),m=!u&&m$(t)&&(s.latitude||s.longitude)?{field:e.getName(t)}:function(t){const{channel:e,channelDef:n,isMidPoint:r,scaleName:i,stack:s,offset:o,markDef:a,config:l}=t;if(XL(n)&&s&&e===s.fieldChannel){if(qL(n)){const t=BL({channel:e,fieldDef:n,isMidPoint:r,markDef:a,stack:s,config:l});if(void 0!==t)return mL({scaleName:i,fieldOrDatumDef:n,startSuffix:"start",band:t,offset:o})}return pL(n,i,{suffix:"end"},{offset:o})}return cL(t)}({channel:t,channelDef:u,channel2Def:c,markDef:o,config:a,isMidPoint:i,scaleName:h,scale:d,stack:l,offset:f,defaultRef:p});return m?{[r||t]:m}:void 0}function JU({model:t,defaultPos:e,channel:n,scaleName:r,scale:i}){const{markDef:s,config:o}=t;return()=>{const a=a$(n),l=l$(n),u=OB(n,s,o,{vgChannel:l});if(void 0!==u)return yL(n,u);switch(e){case"zeroOrMin":case"zeroOrMax":if(r)if(SF(["log","time","utc"],i.get("type")));else if(i.domainDefinitelyIncludesZero())return{scale:r,value:0};if("zeroOrMin"===e)return"y"===a?{field:{group:"height"}}:{value:0};switch(a){case"radius":return{signal:`min(${t.width.signal},${t.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const e=t[c$(n)];return Object.assign(Object.assign({},e),{mult:.5})}}}}!function(t){t[t.Raw=0]="Raw",t[t.Main=1]="Main",t[t.Row=2]="Row",t[t.Column=3]="Column",t[t.Lookup=4]="Lookup"}(CU||(CU={}));const tV={left:"x",center:"xc",right:"x2"},eV={top:"y",middle:"yc",bottom:"y2"};function nV(t,e,n,r="middle"){if("radius"===t||"theta"===t)return l$(t);const i=OB("x"===t?"align":"baseline",e,n);return"x"===t?tV[i||("top"===r?"left":"center")]:eV[i||r]}function rV(t,e,{defaultPos:n,defaultPos2:r,range:i}){return i?iV(t,e,{defaultPos:n,defaultPos2:r}):QU(t,e,{defaultPos:n})}function iV(t,e,{defaultPos:n,defaultPos2:r}){const{markDef:i,config:s}=e,o=u$(t),a=c$(t),l=function(t,e,n){const{encoding:r,mark:i,markDef:s,stack:o,config:a}=t,l=a$(n),u=c$(n),c=l$(n),h=r[l],d=t.scaleName(l),f=t.getScaleComponent(l),p=ZU(n in r||n in s?n:l,t.markDef);if(!h&&("x2"===n||"y2"===n)&&(r.latitude||r.longitude))return{[c]:{field:t.getName(n)}};const m=function({channel:t,channelDef:e,channel2Def:n,markDef:r,config:i,scaleName:s,scale:o,stack:a,offset:l,defaultRef:u}){return XL(e)&&a&&t.charAt(0)===a.fieldChannel.charAt(0)?pL(e,s,{suffix:"start"},{offset:l}):cL({channel:t,channelDef:n,scaleName:s,scale:o,stack:a,markDef:r,config:i,offset:l,defaultRef:u})}({channel:n,channelDef:h,channel2Def:r[n],markDef:s,config:a,scaleName:d,scale:f,stack:o,offset:p,defaultRef:void 0});return void 0!==m?{[c]:m}:sV(n,s)||sV(n,{[n]:RB(n,s,a.style),[u]:RB(u,s,a.style)})||sV(n,a[i])||sV(n,a.mark)||{[c]:JU({model:t,defaultPos:e,channel:n,scaleName:d,scale:f})()}}(e,r,o),u=l[a]?nV(t,i,s):l$(t);return Object.assign(Object.assign({},QU(t,e,{defaultPos:n,vgChannel:u})),l)}function sV(t,e){const n=c$(t),r=l$(t);return void 0!==e[r]?{[r]:yL(t,e[r])}:void 0!==e[t]?{[r]:yL(t,e[t])}:e[n]?{[n]:yL(t,e[n])}:void 0}function oV(t,e,n){var r,i,s,o;const{config:a,encoding:l,markDef:u,stack:c}=t,h=u$(e),d=c$(e),f=l[e],p=l[h],g=t.getScaleComponent(e),y=g?g.get("type"):void 0,v=t.scaleName(e),b=u.orient,x=null!==(i=null!==(r=l[d])&&void 0!==r?r:l.size)&&void 0!==i?i:OB("size",u,a,{vgChannel:d}),_="bar"===n&&("x"===e?"vertical"===b:"horizontal"===b);if(qL(f)&&(D$(f.bin)||N$(f.bin)||f.timeUnit&&!p)&&!x&&!tL(y)){const n=BL({channel:e,fieldDef:f,stack:c,markDef:u,config:a}),r=null===(s=t.component.axes[e])||void 0===s?void 0:s[0];return function({fieldDef:t,fieldDef2:e,channel:n,band:r,scaleName:i,markDef:s,spacing:o=0,axisTranslate:a,reverse:l,config:u}){const c=u$(n),h=l$(n),d=l$(c),f=ZU(n,s);if(D$(t.bin)||t.timeUnit)return{[d]:uV({channel:n,fieldDef:t,scaleName:i,markDef:s,band:(1-r)/2,offset:lV(c,o,l,a,f),config:u}),[h]:uV({channel:n,fieldDef:t,scaleName:i,markDef:s,band:1-(1-r)/2,offset:lV(n,o,l,a,f),config:u})};if(N$(t.bin)){const r=pL(t,i,{},{offset:lV(c,o,l,a,f)});if(qL(e))return{[d]:r,[h]:pL(e,i,{},{offset:lV(n,o,l,a,f)})};if(T$(t.bin)&&t.bin.step)return{[d]:r,[h]:{signal:`scale("${i}", ${iB(t,{expr:"datum"})} + ${t.bin.step})`,offset:lV(n,o,l,a,f)}}}rz(m.channelRequiredForBinned(c))}({fieldDef:f,fieldDef2:p,channel:e,markDef:u,scaleName:v,band:n,axisTranslate:null!==(o=null==r?void 0:r.get("translate"))&&void 0!==o?o:.5,spacing:m$(e)?OB("binSpacing",u,a):void 0,reverse:g.get("reverse"),config:a})}return(XL(f)&&tL(y)||_)&&!p?function(t,e,n,r){var i;const{markDef:s,encoding:o,config:a,stack:l}=r,u=s.orient,c=r.scaleName(n),h=r.getScaleComponent(n),d=c$(n),f=u$(n),p="horizontal"===u&&"y"===n||"vertical"===u&&"x"===n,g=OB(p?"size":d,s,a,{vgChannel:d});let y;(o.size||void 0!==g)&&(p?y=KU("size",r,{vgChannel:d,defaultValue:g}):rz(m.cannotApplySizeToNonOrientedMark(s.type)));const v=null!==(i=XL(e)?BL({channel:n,fieldDef:e,markDef:s,stack:l,config:a}):void 0)&&void 0!==i?i:1;y=y||{[d]:aV(t,d,c,h,a,v)};const b="band"!==(null==h?void 0:h.get("type"))||!("band"in y[d]),x=nV(n,s,a,b?"middle":"top"),_=ZU(n,s),w=cL({channel:n,channelDef:e,markDef:s,config:a,scaleName:c,scale:h,stack:l,offset:_,defaultRef:JU({model:r,defaultPos:"mid",channel:n,scaleName:c,scale:h}),band:b?.5:(1-v)/2});if(d)return Object.assign({[x]:w},y);{const t=l$(f),e=y[d],n=_?Object.assign(Object.assign({},e),{offset:_}):e;return{[x]:w,[t]:Jt(w)?[w[0],Object.assign(Object.assign({},w[1]),{offset:n})]:Object.assign(Object.assign({},w),{offset:n})}}}(n,f,e,t):iV(e,t,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function aV(t,e,n,r,i,s){if(r){const e=r.get("type");if("point"===e||"band"===e){if(void 0!==i[t].discreteBandSize)return{value:i[t].discreteBandSize};if("point"===e){const t=r.get("range");return xz(t)&&He(t.step)?{value:t.step-2}:{value:Aj-2}}return{scale:n,band:s}}return{value:i[t].continuousBandSize}}const o=Ej(i.view,e),a=HF(i[t].discreteBandSize,o-2);return void 0!==a?{value:a}:void 0}function lV(t,e,n,r,i){if(GM(t))return 0;const s="x"===t||"y2"===t?-e/2:e/2;if(bz(n)||bz(i)||bz(r)){const t=NB(n),e=NB(i),o=NB(r);return{signal:(o?o+" + ":"")+(t?`(${t} ? -1 : 1) * `:"")+(e?`(${e} + ${s})`:s)}}return i=i||0,r+(n?-i-s:+i+s)}function uV({channel:t,fieldDef:e,scaleName:n,markDef:r,band:i,offset:s,config:o}){return hL({fieldDef:e,channel:t,markDef:r,ref:mL({scaleName:n,fieldOrDatumDef:e,band:i,offset:s}),config:o})}const cV=new Set(["aria"]);function hV(t,e){const{fill:n,stroke:r}="include"===e.color?XU(t):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},function(t,e){return wz.reduce((n,r)=>(cV.has(r)||void 0===t[r]||"ignore"===e[r]||(n[r]=AB(t[r])),n),{})}(t.markDef,e)),dV(t,"fill",n)),dV(t,"stroke",r)),KU("opacity",t)),KU("fillOpacity",t)),KU("strokeOpacity",t)),KU("strokeWidth",t)),KU("strokeDash",t)),function(t){const{encoding:e,mark:n}=t,r=e.order;return!vM(n)&&QL(r)?VU(t,r,"zindex",t=>t):{}}(t)),HU(t)),WU(t,"href")),function(t){const{markDef:e,config:n}=t,r=OB("aria",e,n);return!1===r?{}:Object.assign(Object.assign(Object.assign({},r?{aria:r}:{}),function(t){const{mark:e,markDef:n,config:r}=t;if(!1===r.aria)return{};const i=OB("ariaRoleDescription",n,r);return null!=i?{ariaRoleDescription:{value:i}}:e in Sz?{}:{ariaRoleDescription:{value:e}}}(t)),function(t){const{encoding:e,markDef:n,config:r,stack:i}=t,s=e.description;if(s)return VU(t,s,"description",e=>qU(e,t.config));const o=OB("description",n,r);if(null!=o)return{description:AB(o)};if(!1===r.aria)return{};const a=GU(e,i,r);return OF(a)?void 0:{description:{signal:FF(a).map(({key:t,value:e},n)=>`"${n>0?"; ":""}${t}: " + (${e})`).join(" + ")}}}(t))}(t))}function dV(t,e,n){const{config:r,mark:i,markDef:s}=t;if("hide"===OB("invalid",s,r)&&n&&!vM(i)){const r=function(t,{invalid:e=!1,channels:n}){const r=n.reduce((e,n)=>{const r=t.getScaleComponent(n);if(r){const i=r.get("type"),s=t.vgField(n,{expr:"datum"});s&&eL(i)&&(e[s]=!0)}return e},{}),i=IF(r);if(i.length>0){const t=e?"||":"&&";return i.map(t=>fL(t,e)).join(` ${t} `)}}(t,{invalid:!0,channels:w$});if(r)return{[e]:[{test:r,value:null},...Ce(n)]}}return n?{[e]:n}:{}}function fV(t){const{config:e,markDef:n}=t;if(OB("invalid",n,e)){const e=function(t,{invalid:e=!1,channels:n}){const r=n.reduce((e,n)=>{const r=t.getScaleComponent(n);if(r){const i=r.get("type"),s=t.vgField(n,{expr:"datum"});s&&eL(i)&&(e[s]=!0)}return e},{}),i=IF(r);if(i.length>0){const t=e?"||":"&&";return i.map(t=>fL(t,e)).join(` ${t} `)}}(t,{channels:p$});if(e)return{defined:{signal:e}}}return{}}function pV(t,e){if(void 0!==e)return{[t]:AB(e)}}var mV={has:t=>"interval"!==t.type&&t.nearest,parse:(t,e)=>{if(e.events)for(const n of e.events)n.markname=t.getName("voronoi")},marks:(t,e,n)=>{const{x:r,y:i}=e.project.hasChannel,s=t.mark;if(vM(s))return rz(m.nearestNotSupportForContinuous(s)),n;const o={name:t.getName("voronoi"),type:"path",interactive:!0,from:{data:t.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},HU(t,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:r||!i?"datum.datum.x || 0":"0"},y:{expr:i||!r?"datum.datum.y || 0":"0"},size:[t.getSizeSignalRef("width"),t.getSizeSignalRef("height")]}]};let a=0,l=!1;return n.forEach((e,n)=>{var r;const i=null!==(r=e.name)&&void 0!==r?r:"";i===t.component.mark[0].name?a=n:i.indexOf("voronoi")>=0&&(l=!0)}),l||n.splice(a+1,0,o),n}};class gV{constructor(t,e){this.debugName=e,this._children=[],this._parent=null,t&&(this.parent=t)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(t){this._parent=t,t&&t.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(t,e){this._children.indexOf(t)>-1?rz(m.ADD_SAME_CHILD_TWICE):void 0!==e?this._children.splice(e,0,t):this._children.push(t)}removeChild(t){const e=this._children.indexOf(t);return this._children.splice(e,1),e}remove(){let t=this._parent.removeChild(this);for(const e of this._children)e._parent=this._parent,this._parent.addChild(e,t++)}insertAsParentOf(t){const e=t.parent;e.removeChild(this),this.parent=e,t.parent=this}swapWithParent(){const t=this._parent,e=t.parent;for(const n of this._children)n.parent=t;this._children=[],t.removeChild(this),t.parent.removeChild(t),this.parent=e,t.parent=this}}class yV extends gV{constructor(t,e,n,r){super(t,e),this.type=n,this.refCounts=r,this._source=this._name=e,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const t=new this.constructor;return t.debugName="clone_"+this.debugName,t._source=this._source,t._name="clone_"+this._name,t.type=this.type,t.refCounts=this.refCounts,t.refCounts[t._name]=0,t}dependentFields(){return new Set}producedFields(){return new Set}hash(){return void 0===this._hash&&(this._hash="Output "+ ++GF),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(t){this._source=t}}class vV extends gV{constructor(t,e){super(t),this.formula=e}clone(){return new vV(null,yF(this.formula))}static makeFromEncoding(t,e){const n=e.reduceFieldDef((t,n,r)=>{const{field:i,timeUnit:s}=n,o=fH(e)?e.encoding[u$(r)]:void 0,a=fH(e)&&jL(r,n,o,e.stack,e.markDef,e.config);if(s){const e=iB(n,{forAs:!0});t[_F({as:e,field:i,timeUnit:s})]=Object.assign({as:e,field:i,timeUnit:s},a?{band:!0}:{})}return t},{});return OF(n)?null:new vV(t,n)}static makeFromTransform(t,e){const n=Object.assign({},e),{timeUnit:r}=n,i=sF(n,["timeUnit"]),s=vz(r),o=Object.assign(Object.assign({},i),{timeUnit:s});return new vV(t,{[_F(o)]:o})}merge(t){this.formula=Object.assign({},this.formula);for(const e in t.formula)this.formula[e]&&!t.formula[e].band||(this.formula[e]=t.formula[e]);for(const e of t.children)t.removeChild(e),e.parent=this;t.remove()}producedFields(){return new Set(RF(this.formula).map(t=>t.as))}dependentFields(){return new Set(RF(this.formula).map(t=>t.field))}hash(){return"TimeUnit "+_F(this.formula)}assemble(){const t=[];for(const e of RF(this.formula)){const{field:n,as:r,timeUnit:i}=e,s=vz(i),{unit:o,utc:a}=s,l=sF(s,["unit","utc"]);t.push(Object.assign(Object.assign(Object.assign(Object.assign({field:UF(n),type:"timeunit"},o?{units:mz(o)}:{}),a?{timezone:"utc"}:{}),l),{as:[r,r+"_end"]}))}return t}}class bV{constructor(...t){this.items=t,this.hasChannel={},this.hasField={}}}var xV={has:t=>"single"===t.type&&"global"===t.resolve&&t.bind&&"scales"!==t.bind&&!gj(t.bind),parse:(t,e,n,r)=>{r.on||delete e.events,r.clear||delete e.clear},topLevelSignals:(t,e,n)=>{const r=e.name,i=e.project,s=e.bind,o=e.init&&e.init[0],a=mV.has(e)?"(item().isVoronoi ? datum.datum : datum)":"datum";return i.items.forEach((t,i)=>{var l,u;const c=$F(`${r}_${t.field}`);n.filter(t=>t.name===c).length||n.unshift(Object.assign(Object.assign({name:c},o?{init:FV(o[i])}:{value:null}),{on:e.events?[{events:e.events,update:`datum && item().mark.marktype !== 'group' ? ${a}[${nn(t.field)}] : null`}]:[],bind:null!==(u=null!==(l=s[t.field])&&void 0!==l?l:s[t.channel])&&void 0!==u?u:s}))}),n},signals:(t,e,n)=>{const r=e.name,i=e.project,s=n.filter(t=>t.name===r+WV)[0],o=r+"_tuple_fields",a=i.items.map(t=>$F(`${r}_${t.field}`)),l=a.map(t=>t+" !== null").join(" && ");return a.length&&(s.update=`${l} ? {fields: ${o}, values: [${a.join(", ")}]} : null`),delete s.value,delete s.on,n}},_V={has:t=>"multi"===t.type&&!!t.toggle,signals:(t,e,n)=>n.concat({name:e.name+"_toggle",value:!1,on:[{events:e.events,update:e.toggle}]}),modifyExpr:(t,e)=>{const n=e.name+WV,r=e.name+"_toggle";return`${r} ? null : ${n}, `+("global"===e.resolve?r+" ? null : true, ":`${r} ? null : {unit: ${YV(t)}}, `)+`${r} ? ${n} : null`}};const wV={has:t=>void 0!==t.clear&&!1!==t.clear,parse:(t,e,n)=>{n.clear&&(e.clear=Ye(n.clear)?$O(n.clear,"scope"):n.clear)},topLevelSignals:(t,e,n)=>{if(xV.has(e))for(const r of e.project.items){const t=n.findIndex(t=>t.name===$F(`${e.name}_${r.field}`));-1!==t&&n[t].on.push({events:e.clear,update:"null"})}return n},signals:(t,e,n)=>{function r(t,r){-1!==t&&n[t].on&&n[t].on.push({events:e.clear,update:r})}if("interval"===e.type)for(const i of e.project.items){const t=n.findIndex(t=>t.name===i.signals.visual);r(t,"[0, 0]"),-1===t&&r(n.findIndex(t=>t.name===i.signals.data),"null")}else{let t=n.findIndex(t=>t.name===e.name+WV);r(t,"null"),_V.has(e)&&(t=n.findIndex(t=>t.name===e.name+"_toggle"),r(t,"false"))}return n}};var SV={has:t=>"interval"===t.type&&"global"===t.resolve&&t.bind&&"scales"===t.bind,parse:(t,e)=>{const n=e.scales=[];for(const r of e.project.items){const i=r.channel;if(!S$(i))continue;const s=t.getScaleComponent(i),o=s?s.get("type"):void 0;s&&eL(o)?(s.set("selectionExtent",{selection:e.name,field:r.field},!0),n.push(r)):rz(m.SCALE_BINDINGS_CONTINUOUS)}},topLevelSignals:(t,e,n)=>{const r=e.scales.filter(t=>0===n.filter(e=>e.name===t.signals.data).length);if(!t.parent||EV(t)||0===r.length)return n;const i=n.filter(t=>t.name===e.name)[0];let s=i.update;if(s.indexOf(qV)>=0)i.update=`{${r.map(t=>`${nn(t.field)}: ${t.signals.data}`).join(", ")}}`;else{for(const t of r){const e=`${nn(t.field)}: ${t.signals.data}`;s.indexOf(e)<0&&(s=`${s.substring(0,s.length-1)}, ${e}}`)}i.update=s}return n.concat(r.map(t=>({name:t.signals.data})))},signals:(t,e,n)=>{if(t.parent&&!EV(t))for(const r of e.scales){const t=n.filter(t=>t.name===r.signals.data)[0];t.push="outer",delete t.value,delete t.update}return n}};function CV(t,e){return`domain(${nn(t.scaleName(e))})`}function EV(t){var e;return t.parent&&gH(t.parent)&&(null!==(e=!t.parent.parent)&&void 0!==e?e:EV(t.parent.parent))}const kV={has:t=>{const e="global"===t.resolve&&t.bind&&gj(t.bind),n=1===t.project.items.length&&"_vgsid_"!==t.project.items[0].field;return e&&!n&&rz(m.LEGEND_BINDINGS_MUST_HAVE_PROJECTION),e&&n},parse:(t,e,n,r)=>{var i;if(r.on||delete e.events,r.clear||delete e.clear,r.on||r.clear){const t='event.item && indexof(event.item.mark.role, "legend") < 0';for(const n of e.events)n.filter=Ce(null!==(i=n.filter)&&void 0!==i?i:[]),n.filter.indexOf(t)<0&&n.filter.push(t)}const s=yj(e.bind)?e.bind.legend:"click",o=Ye(s)?$O(s,"view"):Ce(s);e.bind={legend:{merge:o}}},topLevelSignals:(t,e,n)=>{const r=e.name,i=yj(e.bind)&&e.bind.legend,s=t=>e=>{const n=yF(e);return n.markname=t,n};for(const o of e.project.items){if(!o.hasLegend)continue;const t=$F(o.field)+"_legend",a=`${r}_${t}`;if(0===n.filter(t=>t.name===a).length){const r=i.merge.map(s(t+"_symbols")).concat(i.merge.map(s(t+"_labels"))).concat(i.merge.map(s(t+"_entries")));n.unshift(Object.assign(Object.assign({name:a},e.init?{}:{value:null}),{on:[{events:r,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:i.merge,update:"!event.item || !datum ? null : "+a,force:!0}]}))}}return n},signals:(t,e,n)=>{const r=e.name,i=e.project,s=n.find(t=>t.name===r+WV),o=r+"_tuple_fields",a=i.items.filter(t=>t.hasLegend).map(t=>$F(`${r}_${$F(t.field)}_legend`)),l=`${a.map(t=>t+" !== null").join(" && ")} ? {fields: ${o}, values: [${a.join(", ")}]} : null`;e.events&&a.length>0?s.on.push({events:a.map(t=>({signal:t})),update:l}):a.length>0&&(s.update=l,delete s.value,delete s.on);const u=n.find(t=>t.name===r+"_toggle"),c=yj(e.bind)&&e.bind.legend;return u&&(e.events?u.on.push(Object.assign(Object.assign({},u.on[0]),{events:c})):u.on[0].events=c),n}},AV="_translate_delta",DV={has:t=>"interval"===t.type&&t.translate,signals:(t,e,n)=>{const r=e.name,i=SV.has(e),s=r+"_translate_anchor",{x:o,y:a}=e.project.hasChannel;let l=$O(e.translate,"scope");return i||(l=l.map(t=>(t.between[0].markname=r+PV,t))),n.push({name:s,value:{},on:[{events:l.map(t=>t.between[0]),update:"{x: x(unit), y: y(unit)"+(void 0!==o?", extent_x: "+(i?CV(t,"x"):`slice(${o.signals.visual})`):"")+(void 0!==a?", extent_y: "+(i?CV(t,"y"):`slice(${a.signals.visual})`):"")+"}"}]},{name:r+AV,value:{},on:[{events:l,update:`{x: ${s}.x - x(unit), y: ${s}.y - y(unit)}`}]}),void 0!==o&&NV(t,e,o,"width",n),void 0!==a&&NV(t,e,a,"height",n),n}};function NV(t,e,n,r,i){var s;const o=e.name,a=o+"_translate_anchor",l=o+AV,u=n.channel,c=SV.has(e),h=i.filter(t=>t.name===n.signals[c?"data":"visual"])[0],d=t.getSizeSignalRef(r).signal,f=t.getScaleComponent(u),p=f.get("type"),m=`${a}.extent_${u}`,g=`${c?"log"===p?"panLog":"pow"===p?"panPow":"panLinear":"panLinear"}(${m}, ${`${c&&"x"===u?"-":""}${l}.${u} / `+(c?""+d:`span(${m})`)}`+(c&&"pow"===p?", "+(null!==(s=f.get("exponent"))&&void 0!==s?s:1):"")+")";h.on.push({events:{signal:l},update:c?g:`clampRange(${g}, 0, ${d})`})}const TV={has:t=>"interval"===t.type&&t.zoom,signals:(t,e,n)=>{const r=e.name,i=SV.has(e),s=r+"_zoom_delta",{x:o,y:a}=e.project.hasChannel,l=nn(t.scaleName("x")),u=nn(t.scaleName("y"));let c=$O(e.zoom,"scope");return i||(c=c.map(t=>(t.markname=r+PV,t))),n.push({name:r+"_zoom_anchor",on:[{events:c,update:i?"{"+[l?`x: invert(${l}, x(unit))`:"",u?`y: invert(${u}, y(unit))`:""].filter(t=>!!t).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:s,on:[{events:c,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),void 0!==o&&OV(t,e,o,"width",n),void 0!==a&&OV(t,e,a,"height",n),n}};function OV(t,e,n,r,i){var s;const o=e.name,a=n.channel,l=SV.has(e),u=i.filter(t=>t.name===n.signals[l?"data":"visual"])[0],c=t.getSizeSignalRef(r).signal,h=t.getScaleComponent(a),d=h.get("type"),f=l?CV(t,a):u.name,p=o+"_zoom_delta",m=`${l?"log"===d?"zoomLog":"pow"===d?"zoomPow":"zoomLinear":"zoomLinear"}(${f}, ${o}_zoom_anchor.${a}, ${p}`+(l&&"pow"===d?", "+(null!==(s=h.get("exponent"))&&void 0!==s?s:1):"")+")";u.on.push({events:{signal:p},update:l?m:`clampRange(${m}, 0, ${c})`})}const IV=[{has:()=>!0,parse:(t,e,n)=>{var r,i,s;const o=e.name,a=null!==(r=e.project)&&void 0!==r?r:e.project=new bV,l={},u={},c=new Set,h=(t,e)=>{const n="visual"===e?t.channel:t.field;let r=$F(`${o}_${n}`);for(let i=1;c.has(r);i++)r=$F(`${o}_${n}_${i}`);return c.add(r),{[e]:r}};if(!n.fields&&!n.encodings){const e=t.config.selection[n.type];if(n.init)for(const t of Ce(n.init))for(const r of IF(t))r$[r]?(n.encodings||(n.encodings=[])).push(r):"interval"===n.type?(rz(m.INTERVAL_INITIALIZED_WITH_X_Y),n.encodings=e.encodings):(n.fields||(n.fields=[])).push(r);else n.encodings=e.encodings,n.fields=e.fields}for(const d of null!==(i=n.fields)&&void 0!==i?i:[]){const t={type:"E",field:d};t.signals=Object.assign({},h(t,"data")),a.items.push(t),a.hasField[d]=t}for(const d of null!==(s=n.encodings)&&void 0!==s?s:[]){const n=t.fieldDef(d);if(n){let r=n.field;if(n.aggregate){rz(m.cannotProjectAggregate(d,n.aggregate));continue}if(!r){rz(m.cannotProjectOnChannelWithoutField(d));continue}if(n.timeUnit){r=t.vgField(d);const e={timeUnit:n.timeUnit,as:r,field:n.field};u[_F(e)]=e}if(!l[r]){let i="E";"interval"===e.type?eL(t.getScaleComponent(d).get("type"))&&(i="R"):n.bin&&(i="R-RE");const s={field:r,channel:d,type:i};s.signals=Object.assign(Object.assign({},h(s,"data")),h(s,"visual")),a.items.push(l[r]=s),a.hasField[r]=a.hasChannel[d]=l[r]}}else rz(m.cannotProjectOnChannelWithoutField(d))}if(n.init){const t=t=>a.items.map(e=>void 0!==t[e.channel]?t[e.channel]:t[e.field]);if("interval"===n.type)e.init=t(n.init);else{const r=Ce(n.init);e.init=r.map(t)}}OF(u)||(a.timeUnit=new vV(null,u))},signals:(t,e,n)=>{const r=e.name+"_tuple_fields";return n.filter(t=>t.name===r).length>0?n:n.concat({name:r,value:e.project.items.map(t=>{const e=sF(t,["signals","hasLegend"]);return e.field=UF(e.field),e})})}},_V,SV,kV,DV,TV,xV,mV,wV];function RV(t,e){for(const n of IV)n.has(t)&&e(n)}function FV(t,e=!0,n=jt){if(Jt(t)){const r=t.map(t=>FV(t,e,n));return e?`[${r.join(", ")}]`:r}return iz(t)?n(e?cz(t):function(t){const e=uz(t,!0);return t.utc?+new Date(Date.UTC(...e)):+new Date(...e)}(t)):e?n(JSON.stringify(t)):t}function MV(t,e){return GV(t,(n,r)=>{e=r.marks?r.marks(t,n,e):e,RV(n,r=>{r.marks&&(e=r.marks(t,n,e))})}),e}function $V(t){return t.map(t=>(t.on&&!t.on.length&&delete t.on,t))}const PV="_brush",zV={signals:(t,e)=>{const n=e.name,r=n+"_tuple_fields",i=SV.has(e),s=[],o=[],a=[];if(e.translate&&!i){const t="!event.item || event.item.mark.name !== "+nn(n+PV);LV(e,(e,n)=>{var r;const i=Ce(null!==(r=n.between[0].filter)&&void 0!==r?r:n.between[0].filter=[]);return i.indexOf(t)<0&&i.push(t),e})}e.project.items.forEach((n,r)=>{const i=n.channel;if("x"!==i&&"y"!==i)return void rz("Interval selections only support x and y encoding channels.");const l=function(t,e,n,r){const i=n.channel,s=n.signals.visual,o=n.signals.data,a=SV.has(e),l=nn(t.scaleName(i)),u=t.getScaleComponent(i),c=u?u.get("type"):void 0,h=t=>`scale(${l}, ${t})`,d=t.getSizeSignalRef("x"===i?"width":"height").signal,f=i+"(unit)",p=LV(e,(t,e)=>[...t,{events:e.between[0],update:`[${f}, ${f}]`},{events:e,update:`[${s}[0], clamp(${f}, 0, ${d})]`}]);return p.push({events:{signal:e.name+"_scale_trigger"},update:eL(c)?`[${h(o+"[0]")}, ${h(o+"[1]")}]`:"[0, 0]"}),a?[{name:o,on:[]}]:[Object.assign(Object.assign({name:s},r?{init:FV(r,!0,h)}:{value:[]}),{on:p}),Object.assign(Object.assign({name:o},r?{init:FV(r)}:{}),{on:[{events:{signal:s},update:`${s}[0] === ${s}[1] ? null : invert(${l}, ${s})`}]})]}(t,e,n,e.init?e.init[r]:null),u=n.signals.data,c=n.signals.visual,h=nn(t.scaleName(i)),d=eL(t.getScaleComponent(i).get("type"))?"+":"";s.push(...l),o.push(u),a.push({scaleName:t.scaleName(i),expr:`(!isArray(${u}) || (${d}invert(${h}, ${c})[0] === ${d}${u}[0] && ${d}invert(${h}, ${c})[1] === ${d}${u}[1]))`})}),i||s.push({name:n+"_scale_trigger",value:{},on:[{events:a.map(t=>({scale:t.scaleName})),update:a.map(t=>t.expr).join(" && ")+` ? ${n+"_scale_trigger"} : {}`}]});const l=e.init,u=`unit: ${YV(t)}, fields: ${r}, values`;return s.concat(Object.assign(Object.assign({name:n+WV},l?{init:`{${u}: ${FV(l)}}`}:{}),{on:[{events:[{signal:o.join(" || ")}],update:o.join(" && ")+` ? {${u}: [${o}]} : null`}]}))},modifyExpr:(t,e)=>e.name+WV+", "+("global"===e.resolve?"true":`{unit: ${YV(t)}}`),marks:(t,e,n)=>{const r=e.name,{x:i,y:s}=e.project.hasChannel,o=i&&i.signals.visual,a=s&&s.signals.visual,l=`data(${nn(e.name+VV)})`;if(SV.has(e))return n;const u={x:void 0!==i?{signal:o+"[0]"}:{value:0},y:void 0!==s?{signal:a+"[0]"}:{value:0},x2:void 0!==i?{signal:o+"[1]"}:{field:{group:"width"}},y2:void 0!==s?{signal:a+"[1]"}:{field:{group:"height"}}};if("global"===e.resolve)for(const g of IF(u))u[g]=[Object.assign({test:`${l}.length && ${l}[0].unit === ${YV(t)}`},u[g]),{value:0}];const c=e.mark,{fill:h,fillOpacity:d,cursor:f}=c,p=sF(c,["fill","fillOpacity","cursor"]),m=IF(p).reduce((t,e)=>(t[e]=[{test:[void 0!==i&&`${o}[0] !== ${o}[1]`,void 0!==s&&`${a}[0] !== ${a}[1]`].filter(t=>t).join(" && "),value:p[e]},{value:null}],t),{});return[{name:r+PV+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:h},fillOpacity:{value:d}},update:u}},...n,{name:r+PV,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},f?{cursor:{value:f}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},u),m)}}]}};function LV(t,e){return t.events.reduce((t,n)=>n.between?e(t,n):(rz(n+" is not an ordered event stream for interval selections."),t),[])}function BV(t,e){const n=e.name,r=n+"_tuple_fields",i="(item().isVoronoi ? datum.datum : datum)",s=e.project.items.map(e=>{const n=t.fieldDef(e.channel);return n&&n.bin?`[${i}[${nn(t.vgField(e.channel,{}))}], ${i}[${nn(t.vgField(e.channel,{binSuffix:"end"}))}]]`:`${i}[${nn(e.field)}]`}).join(", "),o=`unit: ${YV(t)}, fields: ${r}, values`,a=e.events;return[{name:n+WV,on:a?[{events:a,update:`datum && item().mark.marktype !== 'group' ? {${o}: [${s}]} : null`,force:!0}]:[]}]}const jV={signals:BV,modifyExpr:(t,e)=>e.name+WV+", "+("global"===e.resolve?"null":`{unit: ${YV(t)}}`)},UV={signals:BV,modifyExpr:(t,e)=>e.name+WV+", "+("global"===e.resolve?"true":`{unit: ${YV(t)}}`)},VV="_store",WV="_tuple",qV="vlSelectionResolve",HV={single:UV,multi:jV,interval:zV};function GV(t,e){const n=t.component.selection;if(n)for(const r of RF(n))if(!0===e(r,HV[r.type]))break}function YV(t,{escape:e}={escape:!0}){let n=e?nn(t.name):t.name;const r=function(t){let e=t.parent;for(;e&&!pH(e);)e=e.parent;return e}(t);if(r){const{facet:t}=r;for(const e of JM)t[e]&&(n+=` + '__facet_${e}_' + (facet[${nn(r.vgField(e))}])`)}return n}function KV(t){let e=!1;return GV(t,t=>{e=e||t.project.items.some(t=>"_vgsid_"===t.field)}),e}function XV(t){const e=VD(t),n=new Set;return e.visit(t=>{"MemberExpression"===t.type&&function t(e){return"MemberExpression"===e.object.type?t(e.object):"datum"===e.object.name}(t)&&n.add(function t(e){const n=[];return"Identifier"===e.type?[e.name]:"Literal"===e.type?[e.value]:("MemberExpression"===e.type&&(n.push(...t(e.object)),n.push(...t(e.property))),n)}(t).slice(1).join("."))}),n}class ZV extends gV{constructor(t,e,n){super(t),this.model=e,this.filter=n,this.expr=tW(this.model,this.filter,this),this._dependentFields=XV(this.expr)}clone(){return new ZV(null,this.model,yF(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return"Filter "+this.expr}}function QV(t,e,n,r="datum"){const i=[],s=PF(e,(function(e){const s=$F(e),o=t.getSelectionComponent(s,e),a=nn(s+VV);if(o.project.timeUnit){const e=null!=n?n:t.component.data.raw,r=o.project.timeUnit.clone();e.parent?r.insertAsParentOf(e):e.parent=r}return"none"!==o.empty&&i.push(a),`vlSelectionTest(${a}, ${r}`+("global"===o.resolve?")":`, ${nn(o.resolve)})`)}));return(i.length?"!("+i.map(t=>`length(data(${t}))`).join(" || ")+") || ":"")+`(${s})`}function JV(t,e){const n=e.encoding;let r=e.field;if(n||r){if(n&&!r){const i=t.project.items.filter(t=>t.channel===n);!i.length||i.length>1?(r=t.project.items[0].field,rz((i.length?"Multiple ":"No ")+`matching ${nn(n)} encoding found for selection ${nn(e.selection)}. `+`Using "field": ${nn(r)}.`)):r=i[0].field}}else r=t.project.items[0].field,t.project.items.length>1&&rz(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${nn(r)}.`);return`${t.name}[${nn(r)}]`}function tW(t,e,n){return PF(e,e=>Ye(e)?e:function(t){return null==t?void 0:t.selection}(e)?QV(t,e.selection,n):Fz(e))}function eW(t,e,n,r){var i,s,o;t.encode=null!==(i=t.encode)&&void 0!==i?i:{},t.encode[e]=null!==(s=t.encode[e])&&void 0!==s?s:{},t.encode[e].update=null!==(o=t.encode[e].update)&&void 0!==o?o:{},t.encode[e].update[n]=r}function nW(t,e,n,r={header:!1}){var i,s;const o=t.combine(),{disable:a,orient:l,scale:u,labelExpr:c,title:h,zindex:d}=o,f=sF(o,["disable","orient","scale","labelExpr","title","zindex"]);if(!a){for(const t in f){const n=JF[t],r=f[t];if(n&&n!==e&&"both"!==n)delete f[t];else if(ZF(r)){const{condition:e}=r,n=sF(r,["condition"]),i=Ce(e),s=XF[t];if(s){const{vgProp:e,part:r}=s;eW(f,r,e,[...i.map(t=>{const{test:e}=t,n=sF(t,["test"]);return Object.assign({test:tW(null,e)},n)}),n]),delete f[t]}else if(null===s){const e={signal:i.map(t=>{const{test:e}=t,n=sF(t,["test"]);return`${tW(null,e)} ? ${DB(n)} : `}).join("")+DB(n)};f[t]=e}}else if(bz(r)){const e=XF[t];if(e){const{vgProp:n,part:i}=e;eW(f,i,n,r),delete f[t]}}}if("grid"===e){if(!f.grid)return;if(f.encode){const{grid:t}=f.encode;f.encode=Object.assign({},t?{grid:t}:{}),OF(f.encode)&&delete f.encode}return Object.assign(Object.assign({scale:u,orient:l},f),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:HF(d,0)})}{if(!r.header&&t.mainExtracted)return;if(void 0!==c){let t=c;(null===(s=null===(i=f.encode)||void 0===i?void 0:i.labels)||void 0===s?void 0:s.update)&&bz(f.encode.labels.update.text)&&(t=VF(c,"datum.label",f.encode.labels.update.text.signal)),eW(f,"labels","text",{signal:t})}if(null===f.labelAlign&&delete f.labelAlign,f.encode){for(const e of QF)t.hasAxisPart(e)||delete f.encode[e];OF(f.encode)&&delete f.encode}const e=function(t,e){if(t)return Jt(t)&&!kB(t)?t.map(t=>dB(t,e)).join(", "):t}(h,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:u,orient:l,grid:!1},e?{title:e}:{}),f),!1===n.aria?{aria:!1}:{}),{zindex:HF(d,0)})}}}function rW(t){const{axes:e}=t.component,n=[];for(const r of p$)if(e[r])for(const i of e[r])if(!i.get("disable")&&!i.get("gridScale")){const e="x"===r?"height":"width",i=t.getSizeSignalRef(e).signal;e!==i&&n.push({name:e,update:i})}return n}const iW={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},sW={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},oW=IF(iW),aW=IF(sW);function lW(t,e,n,r){return Object.assign.apply(null,[{},...t.map(t=>{if("axisOrient"===t){const t="x"===n?"bottom":"left",i=e["x"===n?"axisBottom":"axisLeft"]||{},s=e["x"===n?"axisTop":"axisRight"]||{},o=new Set([...IF(i),...IF(s)]),a={};for(const e of o.values())a[e]={signal:`${r.signal} === "${t}" ? ${NB(i[e])} : ${NB(s[e])}`};return a}return e[t]})])}function uW(t,e){var n;const r=[{}];for(const i of t){let t=null===(n=e[i])||void 0===n?void 0:n.style;if(t){t=Ce(t);for(const n of t)r.push(e.style[n])}}return Object.assign.apply(null,r)}function cW(t,e,n,r={}){var i;const s=FB(t,n,e);if(void 0!==s)return{configFrom:"style",configValue:s};for(const o of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(void 0!==(null===(i=r[o])||void 0===i?void 0:i[t]))return{configFrom:o,configValue:r[o][t]};return{}}const hW={scale:({model:t,channel:e})=>t.scaleName(e),format:({fieldOrDatumDef:t,config:e,axis:n})=>{const{format:r,formatType:i}=n;return SL(t,t.type,r,i,e,!0)},formatType:({axis:t,fieldOrDatumDef:e,scaleType:n})=>{const{formatType:r}=t;return CL(r,e,n)},grid:({fieldOrDatumDef:t,axis:e,scaleType:n})=>{var r;return(!qL(t)||!N$(t.bin))&&(null!==(r=e.grid)&&void 0!==r?r:function(t,e){return!tL(t)&&qL(e)&&!D$(null==e?void 0:e.bin)}(n,t))},gridScale:({model:t,channel:e})=>function(t,e){const n="x"===e?"y":"x";if(t.getScaleComponent(n))return t.scaleName(n)}(t,e),labelAlign:({axis:t,labelAngle:e,orient:n,channel:r})=>t.labelAlign||pW(e,n,r),labelAngle:({labelAngle:t})=>t,labelBaseline:({axis:t,labelAngle:e,orient:n,channel:r})=>t.labelBaseline||fW(e,n,r),labelFlush:({axis:t,fieldOrDatumDef:e,channel:n})=>{var r;return null!==(r=t.labelFlush)&&void 0!==r?r:function(t,e){if("x"===e&&SF(["quantitative","temporal"],t))return!0}(e.type,n)},labelOverlap:({axis:t,fieldOrDatumDef:e,scaleType:n})=>{var r;return null!==(r=t.labelOverlap)&&void 0!==r?r:function(t,e,n,r){if(n&&!te(r)||"nominal"!==t&&"ordinal"!==t)return"log"!==e||"greedy"}(e.type,n,qL(e)&&!!e.timeUnit,qL(e)?e.sort:void 0)},orient:({orient:t})=>t,tickCount:({channel:t,model:e,axis:n,fieldOrDatumDef:r,scaleType:i})=>{var s;const o="x"===t?"width":"y"===t?"height":void 0,a=o?e.getSizeSignalRef(o):void 0;return null!==(s=n.tickCount)&&void 0!==s?s:function({fieldOrDatumDef:t,scaleType:e,size:n,values:r}){var i;if(!r&&!tL(e)&&"log"!==e){if(qL(t)){if(D$(t.bin))return{signal:`ceil(${n.signal}/10)`};if(t.timeUnit&&SF(["month","hours","day","quarter"],null===(i=vz(t.timeUnit))||void 0===i?void 0:i.unit))return}return{signal:`ceil(${n.signal}/40)`}}}({fieldOrDatumDef:r,scaleType:i,size:a,values:n.values})},title:({axis:t,model:e,channel:n})=>{if(void 0!==t.title)return t.title;const r=mW(e,n);if(void 0!==r)return r;const i=e.typedFieldDef(n),s=e.fieldDef("x"===n?"x2":"y2");return $B(i?[zL(i)]:[],qL(s)?[zL(s)]:[])},values:({axis:t,fieldOrDatumDef:e})=>function(t,e){const n=t.values;return Jt(n)?SB(e,n):bz(n)?n:void 0}(t,e),zindex:({axis:t,fieldOrDatumDef:e,mark:n})=>{var r;return null!==(r=t.zindex)&&void 0!==r?r:function(t,e){return"rect"===t&&sB(e)?1:0}(n,e)}};function dW(t){return`(((${t.signal} % 360) + 360) % 360)`}function fW(t,e,n,r){if(void 0!==t){if("x"===n){if(bz(t)){const n=dW(t);return{signal:`(45 < ${n} && ${n} < 135) || (225 < ${n} && ${n} < 315) ? "middle" :(${n} <= 45 || 315 <= ${n}) === ${bz(e)?`(${e.signal} === "top")`:"top"===e} ? "bottom" : "top"`}}return 45<t&&t<135||225<t&&t<315?"middle":bz(e)?{signal:`${e.signal} ${t<=45||315<=t?"===":"!=="} "top" ? "bottom" : "top"`}:(t<=45||315<=t)==("top"===e)?"bottom":"top"}if(bz(t)){const n=dW(t);return{signal:`${n} <= 45 || 315 <= ${n} || (135 <= ${n} && ${n} <= 225) ? ${r?'"middle"':"null"} : (45 <= ${n} && ${n} <= 135) === ${bz(e)?`(${e.signal} === "left")`:"left"===e} ? "top" : "bottom"`}}return t<=45||315<=t||135<=t&&t<=225?r?"middle":null:bz(e)?{signal:`${e.signal} ${45<=t&&t<=135?"===":"!=="} "left" ? "top" : "bottom"`}:(45<=t&&t<=135)==("left"===e)?"top":"bottom"}}function pW(t,e,n){if(void 0===t)return;const r="x"===n,i=r?0:90,s=r?"bottom":"left";if(bz(t)){const n=dW(t);return{signal:`(${i?"("+n+" + 90)":n} % 180 === 0) ? ${r?null:'"center"'} :(${i} < ${n} && ${n} < ${180+i}) === ${bz(e)?`(${e.signal} === "${s}")`:e===s} ? "left" : "right"`}}return(t+i)%180==0?r?null:"center":bz(e)?{signal:`${e.signal} ${i<t&&t<180+i?"===":"!=="} "${s}" ? "left" : "right"`}:(i<t&&t<180+i)==(e===s)?"left":"right"}function mW(t,e){const n="x"===e?"x2":"y2",r=t.fieldDef(e),i=t.fieldDef(n),s=r?r.title:void 0,o=i?i.title:void 0;return s&&o?PB(s,o):s||o||(void 0!==s?s:void 0!==o?o:void 0)}class gW extends gV{constructor(t,e){super(t),this.transform=e,this._dependentFields=XV(this.transform.calculate)}clone(){return new gW(null,yF(this.transform))}static parseAllForSortIndex(t,e){return e.forEachFieldDef((e,n)=>{if(JL(e)&&FL(e.sort)){const{field:r,timeUnit:i}=e,s=e.sort,o=s.map((t,e)=>`${Fz({field:r,timeUnit:i,equal:t})} ? ${e} : `).join("")+s.length;t=new gW(t,{calculate:o,as:yW(e,n,{forAs:!0})})}}),t}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return"Calculate "+_F(this.transform)}}function yW(t,e,n){return iB(t,Object.assign({prefix:e,suffix:"sort_index"},null!=n?n:{}))}function vW(t,e){return SF(["top","bottom"],e)?"column":SF(["left","right"],e)||"row"===t?"row":"column"}function bW(t,e,n,r){const i="row"===r?n.headerRow:"column"===r?n.headerColumn:n.headerFacet;return HF(((null==e?void 0:e.header)||{})[t],i[t],n.header[t])}function xW(t,e,n,r){const i={};for(const s of t){const t=bW(s,e,n,r);void 0!==t&&(i[s]=t)}return i}const _W=["row","column"],wW=["header","footer"];function SW(t,e){const n=t.component.layoutHeaders[e].title,r=t.config?t.config:void 0,i=t.component.layoutHeaders[e].facetFieldDef?t.component.layoutHeaders[e].facetFieldDef:void 0,{titleAnchor:s,titleAngle:o,titleOrient:a}=xW(["titleAnchor","titleAngle","titleOrient"],i,r,e),l=vW(e,a),u=YF(o);return{name:e+"-title",type:"group",role:l+"-title",title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},"row"===e?{orient:"left"}:{}),{style:"guide-title"}),EW(u,l)),CW(l,u,s)),IW(r,i,e,oW,iW))}}function CW(t,e,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const r=pW(e,"row"===t?"left":"top","row"===t?"y":"x");return r?{align:r}:{}}function EW(t,e){const n=fW(t,"row"===e?"left":"top","row"===e?"y":"x",!0);return n?{baseline:n}:{}}function kW(t,e){const n=t.component.layoutHeaders[e],r=[];for(const i of wW)if(n[i])for(const s of n[i]){const o=NW(t,e,i,n,s);null!=o&&r.push(o)}return r}function AW(t,e){var n;const{sort:r}=t;return RL(r)?{field:iB(r,{expr:"datum"}),order:null!==(n=r.order)&&void 0!==n?n:"ascending"}:Jt(r)?{field:yW(t,e,{expr:"datum"}),order:"ascending"}:{field:iB(t,{expr:"datum"}),order:null!=r?r:"ascending"}}function DW(t,e,n){const{format:r,formatType:i,labelAngle:s,labelAnchor:o,labelOrient:a,labelExpr:l}=xW(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],t,n,e),u=xL({fieldOrDatumDef:t,format:r,formatType:i,expr:"parent",config:n}).signal,c=vW(e,a);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:l?VF(VF(l,"datum.label",u),"datum.value",iB(t,{expr:"parent"})):u}},"row"===e?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),EW(s,c)),CW(c,s,o)),IW(n,t,e,aW,sW))}function NW(t,e,n,r,i){if(i){let s=null;const{facetFieldDef:o}=r,a=t.config?t.config:void 0;if(o&&i.labels){const{labelOrient:t}=xW(["labelOrient"],o,a,e);("row"===e&&!SF(["top","bottom"],t)||"column"===e&&!SF(["left","right"],t))&&(s=DW(o,e,a))}const l=pH(t)&&!ML(t.facet),u=i.axes,c=(null==u?void 0:u.length)>0;if(s||c){const a="row"===e?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:t.getName(`${e}_${n}`),type:"group",role:`${e}-${n}`},r.facetFieldDef?{from:{data:t.getName(e+"_domain")},sort:AW(o,e)}:{}),c&&l?{from:{data:t.getName("facet_domain_"+e)}}:{}),s?{title:s}:{}),i.sizeSignal?{encode:{update:{[a]:i.sizeSignal}}}:{}),c?{axes:u}:{})}}return null}const TW={column:{start:0,end:1},row:{start:1,end:0}};function OW(t,e){return TW[e][t]}function IW(t,e,n,r,i){const s={};for(const o of r){if(!i[o])continue;const r=bW(o,e,t,n);void 0!==r&&(s[i[o]]=r)}return s}function RW(t){return[...FW(t,"width"),...FW(t,"height"),...FW(t,"childWidth"),...FW(t,"childHeight")]}function FW(t,e){const n="width"===e?"x":"y",r=t.component.layoutSize.get(e);if(!r||"merged"===r)return[];const i=t.getSizeSignalRef(e).signal;if("step"===r){const e=t.getScaleComponent(n);if(e){const r=e.get("type"),s=e.get("range");if(tL(r)&&xz(s)){const r=t.scaleName(n);return pH(t.parent)&&"independent"===t.parent.component.resolve.scale[n]?[MW(r,s)]:[MW(r,s),{name:i,update:$W(r,e,`domain('${r}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}if("container"==r){const e=i.endsWith("width"),n=e?"containerSize()[0]":"containerSize()[1]",r=`isFinite(${n}) ? ${n} : ${Cj(t.config.view,e?"width":"height")}`;return[{name:i,init:r,on:[{update:r,events:"window:resize"}]}]}return[{name:i,value:r}]}function MW(t,e){return{name:t+"_step",value:e.step}}function $W(t,e,n){const r=e.get("type"),i=e.get("padding"),s=HF(e.get("paddingOuter"),i);let o=e.get("paddingInner");return o="band"===r?void 0!==o?o:i:1,`bandspace(${n}, ${o}, ${s}) * ${t}_step`}function PW(t){return"childWidth"===t?"width":"childHeight"===t?"height":t}function zW(t,e){return IF(t).reduce((n,r)=>{const i=t[r];return Object.assign(Object.assign({},n),VU(e,i,r,t=>bz(t)?t:{value:t.value}))},{})}function LW(t,e){if(gH(e)||pH(e))return"shared";if(mH(e))return m$(t)?"independent":"shared";throw new Error("invalid model type for resolve")}function BW(t,e){const n=t.scale[e],r=m$(e)?"axis":"legend";return"independent"===n?("shared"===t[r][e]&&rz(m.independentScaleMeansIndependentGuide(e)),"independent"):t[r][e]||"shared"}const jW=Object.assign(Object.assign({},pj),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),UW=IF(jW);class VW extends cU{}const WW={symbols:function(t,{fieldOrDatumDef:e,model:n,channel:r,legendCmpt:i,legendType:s}){var o,a,l,u,c,h,d,f;if("symbol"!==s)return;const{markDef:p,encoding:m,config:g,mark:y}=n,v=p.filled&&"trail"!==y;let b=Object.assign(Object.assign({},function(t,e,n){for(const r of n){const n=IB(r,e.markDef,e.config);void 0!==n&&(t[r]=AB(n))}return t}({},n,wM)),XU(n,{filled:v}));const x=null!==(o=i.get("symbolOpacity"))&&void 0!==o?o:g.legend.symbolOpacity,_=null!==(a=i.get("symbolFillColor"))&&void 0!==a?a:g.legend.symbolFillColor,w=null!==(l=i.get("symbolStrokeColor"))&&void 0!==l?l:g.legend.symbolStrokeColor,S=void 0===x?null!==(u=qW(m.opacity))&&void 0!==u?u:p.opacity:void 0;if(b.fill)if("fill"===r||v&&r===jM)delete b.fill;else if(b.fill.field)_?delete b.fill:(b.fill=AB(null!==(c=g.legend.symbolBaseFillColor)&&void 0!==c?c:"black"),b.fillOpacity=AB(null!=S?S:1));else if(Jt(b.fill)){const t=null!==(f=null!==(d=HW(null!==(h=m.fill)&&void 0!==h?h:m.color))&&void 0!==d?d:p.fill)&&void 0!==f?f:v&&p.color;t&&(b.fill=AB(t))}if(b.stroke)if("stroke"===r||!v&&r===jM)delete b.stroke;else if(b.stroke.field||w)delete b.stroke;else if(Jt(b.stroke)){const t=HF(HW(m.stroke||m.color),p.stroke,v?p.color:void 0);t&&(b.stroke={value:t})}if("opacity"!==r){const t=qL(e)&&YW(0,i,e);t?b.opacity=[Object.assign({test:t},AB(null!=S?S:1)),AB(g.legend.unselectedOpacity)]:S&&(b.opacity=AB(S))}return b=Object.assign(Object.assign({},b),t),OF(b)?void 0:b},gradient:function(t,{model:e,legendType:n,legendCmpt:r}){var i;if("gradient"!==n)return;const{config:s,markDef:o,encoding:a}=e;let l={};const u=void 0===(null!==(i=r.get("gradientOpacity"))&&void 0!==i?i:s.legend.gradientOpacity)?qW(a.opacity)||o.opacity:void 0;return u&&(l.opacity=AB(u)),l=Object.assign(Object.assign({},l),t),OF(l)?void 0:l},labels:function(t,{fieldOrDatumDef:e,model:n,channel:r,legendCmpt:i}){const s=n.legend(r)||{},o=n.config,a=qL(e)?YW(0,i,e):void 0,l=a?[{test:a,value:1},{value:o.legend.unselectedOpacity}]:void 0,{format:u,formatType:c}=s,h=vL(c)?wL({fieldOrDatumDef:e,field:"datum.value",format:u,formatType:c,config:o}):void 0,d=Object.assign(Object.assign(Object.assign({},l?{opacity:l}:{}),h?{text:h}:{}),t);return OF(d)?void 0:d},entries:function(t,{legendCmpt:e}){const n=e.get("selections");return(null==n?void 0:n.length)?Object.assign(Object.assign({},t),{fill:{value:"transparent"}}):t}};function qW(t){return GW(t,(t,e)=>Math.max(t,e.value))}function HW(t){return GW(t,(t,e)=>HF(t,e.value))}function GW(t,e){return function(t){const e=t&&t.condition;return!!e&&(Jt(e)||QL(e))}(t)?Ce(t.condition).reduce(e,t.value):QL(t)?t.value:void 0}function YW(t,e,n){const r=e.get("selections");if(!(null==r?void 0:r.length))return;const i=nn(n.field);return r.map(t=>`(!length(data(${nn($F(t)+VV)})) || (${t}[${i}] && indexof(${t}[${i}], datum.value) >= 0))`).join(" || ")}const KW={direction:({direction:t})=>t,format:({fieldOrDatumDef:t,legend:e,config:n})=>{const{format:r,formatType:i}=e;return SL(t,t.type,r,i,n,!1)},formatType:({legend:t,fieldOrDatumDef:e,scaleType:n})=>{const{formatType:r}=t;return CL(r,e,n)},gradientLength:t=>{var e,n;const{legend:r,legendConfig:i}=t;return null!==(n=null!==(e=r.gradientLength)&&void 0!==e?e:i.gradientLength)&&void 0!==n?n:function({legendConfig:t,model:e,direction:n,orient:r,scaleType:i}){const{gradientHorizontalMaxLength:s,gradientHorizontalMinLength:o,gradientVerticalMaxLength:a,gradientVerticalMinLength:l}=t;if(nL(i))return"horizontal"===n?"top"===r||"bottom"===r?ZW(e,"width",o,s):o:ZW(e,"height",l,a)}(t)},labelOverlap:({legend:t,legendConfig:e,scaleType:n})=>{var r,i;return null!==(i=null!==(r=t.labelOverlap)&&void 0!==r?r:e.labelOverlap)&&void 0!==i?i:function(t){if(SF(["quantile","threshold","log"],t))return"greedy"}(n)},symbolType:({legend:t,markDef:e,channel:n,encoding:r})=>{var i;return null!==(i=t.symbolType)&&void 0!==i?i:function(t,e,n,r){var i;if("shape"!==e){const t=null!==(i=HW(n))&&void 0!==i?i:r;if(t)return t}switch(t){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}(e.type,n,r.shape,e.shape)},title:({fieldOrDatumDef:t,config:e})=>cB(t,e,{allowDisabling:!0}),type:({legendType:t,scaleType:e,channel:n})=>{if(ZM(n)&&nL(e)){if("gradient"===t)return}else if("symbol"===t)return;return t},values:({fieldOrDatumDef:t,legend:e})=>function(t,e){const n=t.values;return Jt(n)?SB(e,n):bz(n)?n:void 0}(e,t)};function XW({legendConfig:t,legendType:e,orient:n,legend:r}){var i,s;return null!==(s=null!==(i=r.direction)&&void 0!==i?i:t[e?"gradientDirection":"symbolDirection"])&&void 0!==s?s:function(t,e){switch(t){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return"gradient"===e?"horizontal":void 0}}(n,e)}function ZW(t,e,n,r){return{signal:`clamp(${t.getSizeSignalRef(e).signal}, ${n}, ${r})`}}function QW(t,e,n,r){switch(e){case"disable":return void 0!==n;case"values":return!!(null==n?void 0:n.values);case"title":if("title"===e&&t===(null==r?void 0:r.title))return!0}return t===(n||{})[e]}function JW(t,e){var n,r,i;let s=t.legend(e);const{markDef:o,encoding:a,config:l}=t,u=l.legend,c=new VW({},function(t,e){const n=t.scaleName(e);if("trail"===t.mark){if("color"===e)return{stroke:n};if("size"===e)return{strokeWidth:n}}return"color"===e?t.markDef.filled?{fill:n}:{stroke:n}:{[e]:n}}(t,e));!function(t,e,n){var r;const i=null===(r=t.fieldDef(e))||void 0===r?void 0:r.field;GV(t,t=>{var r,s;const o=null!==(r=t.project.hasField[i])&&void 0!==r?r:t.project.hasChannel[e];if(o&&kV.has(t)){const e=null!==(s=n.get("selections"))&&void 0!==s?s:[];e.push(t.name),n.set("selections",e,!1),o.hasLegend=!0}})}(t,e,c);const h=void 0!==s?!s:u.disable;if(c.set("disable",h,void 0!==s),h)return c;s=s||{};const d=t.getScaleComponent(e).get("type"),f=mB(a[e]),p=qL(f)?null===(n=vz(f.timeUnit))||void 0===n?void 0:n.unit:void 0,m=s.orient||l.legend.orient||"right",g=function(t){const{legend:e}=t;return HF(e.type,function({channel:t,timeUnit:e,scaleType:n}){if(ZM(t)){if(SF(["quarter","month","day"],e))return"symbol";if(nL(n))return"gradient"}return"symbol"}(t))}({legend:s,channel:e,timeUnit:p,scaleType:d}),y={legend:s,channel:e,model:t,markDef:o,encoding:a,fieldOrDatumDef:f,legendConfig:u,config:l,scaleType:d,orient:m,legendType:g,direction:XW({legend:s,legendType:g,orient:m,legendConfig:u})};for(const w of UW){if("gradient"===g&&w.startsWith("symbol")||"symbol"===g&&w.startsWith("gradient"))continue;const n=w in KW?KW[w](y):s[w];if(void 0!==n){const r=QW(n,w,s,t.fieldDef(e));(r||void 0===l.legend[w])&&c.set(w,n,r)}}const v=null!==(r=null==s?void 0:s.encoding)&&void 0!==r?r:{},b=c.get("selections"),x={},_={fieldOrDatumDef:f,model:t,channel:e,legendCmpt:c,legendType:g};for(const w of["labels","legend","title","symbols","gradient","entries"]){const e=zW(null!==(i=v[w])&&void 0!==i?i:{},t),n=w in WW?WW[w](e,_):e;void 0===n||OF(n)||(x[w]=Object.assign(Object.assign(Object.assign({},(null==b?void 0:b.length)&&qL(f)?{name:`${$F(f.field)}_legend_${w}`}:{}),(null==b?void 0:b.length)?{interactive:!!b}:{}),{update:n}))}return OF(x)||c.set("encode",x,!!(null==s?void 0:s.encoding)),c}function tq(t,e){var n,r,i,s;if(!t)return e.clone();const o=t.getWithExplicit("orient"),a=e.getWithExplicit("orient");if(o.explicit&&a.explicit&&o.value!==a.value)return;let l=!1;for(const u of UW){const n=mU(t.getWithExplicit(u),e.getWithExplicit(u),u,"legend",(t,e)=>{switch(u){case"symbolType":return"circle"===(n=e).value?n:t;case"title":return zB(t,e);case"type":return l=!0,dU("symbol")}var n;return pU(t,e,u,"legend")});t.setWithExplicit(u,n)}return l&&((null===(r=null===(n=t.implicit)||void 0===n?void 0:n.encode)||void 0===r?void 0:r.gradient)&&zF(t.implicit,["encode","gradient"]),(null===(s=null===(i=t.explicit)||void 0===i?void 0:i.encode)||void 0===s?void 0:s.gradient)&&zF(t.explicit,["encode","gradient"])),t}function eq(t,e,n,r){var i,s,o;t.encode=null!==(i=t.encode)&&void 0!==i?i:{},t.encode[e]=null!==(s=t.encode[e])&&void 0!==s?s:{},t.encode[e].update=null!==(o=t.encode[e].update)&&void 0!==o?o:{},t.encode[e].update[n]=r}function nq(t){const e=t.component.legends,n={};for(const r of IF(e)){const i=t.getScaleComponent(r),s=xF(i.get("domains"));if(n[s])for(const t of n[s])tq(t,e[r])||n[s].push(e[r]);else n[s]=[e[r].clone()]}return RF(n).flat().map(e=>function(t,e){var n,r,i;const s=t.combine(),{disable:o,labelExpr:a}=s,l=sF(s,["disable","labelExpr","selections"]);if(!o){if(!1===e.aria&&null==l.aria&&(l.aria=!1),null===(n=l.encode)||void 0===n?void 0:n.symbols){const t=l.encode.symbols.update;!t.fill||"transparent"===t.fill.value||t.stroke||l.stroke||(t.stroke={value:"transparent"});for(const e of dj)l[e]&&delete t[e]}if(l.title||delete l.title,void 0!==a){let t=a;(null===(i=null===(r=l.encode)||void 0===r?void 0:r.labels)||void 0===i?void 0:i.update)&&bz(l.encode.labels.update.text)&&(t=VF(a,"datum.label",l.encode.labels.update.text.signal)),eq(l,"labels","text",{signal:t})}for(const t in l){const e=l[t];if(bz(e)){const n=fj[t];if(n){const{vgProp:r,part:i}=n;eq(l,i,r,e),delete l[t]}}}return l}}(e,t.config)).filter(t=>void 0!==t)}function rq(t){const e=t.component.projection;if(!e||e.merged)return[];const n=e.combine(),{name:r}=n;if(e.data){const i={signal:`[${e.size.map(t=>t.signal).join(", ")}]`},s=e.data.reduce((e,n)=>{const r=bz(n)?n.signal:`data('${t.lookupDataSource(n)}')`;return SF(e,r)||e.push(r),e},[]);if(s.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:r,size:i,fit:{signal:s.length>1?`[${s.join(", ")}]`:s[0]}},n)]}return[Object.assign(Object.assign({name:r},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const iq=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class sq extends cU{constructor(t,e,n,r){super(Object.assign({},e),{name:t}),this.specifiedProjection=e,this.size=n,this.data=r,this.merged=!1}get isFit(){return!!this.data}}function oq(t,e){return`${A$(t)}_${e}`}function aq(t,e,n){var r;const i=oq(null!==(r=bB(n,void 0))&&void 0!==r?r:{},e);return t.getName(i+"_bins")}function lq(t,e,n){let r,i;r=function(t){return"as"in t}(t)?Ye(t.as)?[t.as,t.as+"_end"]:[t.as[0],t.as[1]]:[iB(t,{forAs:!0}),iB(t,{binSuffix:"end",forAs:!0})];const s=Object.assign({},bB(e,void 0)),o=oq(s,t.field),{signal:a,extentSignal:l}=function(t,e){return{signal:t.getName(e+"_bins"),extentSignal:t.getName(e+"_extent")}}(n,o);if(O$(s.extent)){const t=s.extent,e=t.selection;i=JV(n.getSelectionComponent($F(e),e),t),delete s.extent}return{key:o,binComponent:Object.assign(Object.assign(Object.assign({bin:s,field:t.field,as:[r]},a?{signal:a}:{}),l?{extentSignal:l}:{}),i?{span:i}:{})}}class uq extends gV{constructor(t,e){super(t),this.bins=e}clone(){return new uq(null,yF(this.bins))}static makeFromEncoding(t,e){const n=e.reduceFieldDef((t,n,r)=>{if(ZL(n)&&D$(n.bin)){const{key:i,binComponent:s}=lq(n,n.bin,e);t[i]=Object.assign(Object.assign(Object.assign({},s),t[i]),function(t,e,n,r){var i,s;if(CB(e,n)){const o=fH(t)&&null!==(s=null!==(i=t.axis(n))&&void 0!==i?i:t.legend(n))&&void 0!==s?s:{},a=iB(e,{expr:"datum"}),l=iB(e,{expr:"datum",binSuffix:"end"});return{formulaAs:iB(e,{binSuffix:"range",forAs:!0}),formula:DL(a,l,o.format,o.formatType,r)}}return{}}(e,n,r,e.config))}return t},{});return OF(n)?null:new uq(t,n)}static makeFromTransform(t,e,n){const{key:r,binComponent:i}=lq(e,e.bin,n);return new uq(t,{[r]:i})}merge(t,e){for(const n of IF(t.bins))n in this.bins?(e(t.bins[n].signal,this.bins[n].signal),this.bins[n].as=AF([...this.bins[n].as,...t.bins[n].as],_F)):this.bins[n]=t.bins[n];for(const n of t.children)t.removeChild(n),n.parent=this;t.remove()}producedFields(){return new Set(RF(this.bins).map(t=>t.as).flat(2))}dependentFields(){return new Set(RF(this.bins).map(t=>t.field))}hash(){return"Bin "+_F(this.bins)}assemble(){return RF(this.bins).flatMap(t=>{const e=[],[n,...r]=t.as,i=t.bin,{extent:s}=i,o=sF(i,["extent"]),a=Object.assign(Object.assign(Object.assign({type:"bin",field:UF(t.field),as:n,signal:t.signal},O$(s)?{extent:null}:{extent:s}),t.span?{span:{signal:`span(${t.span})`}}:{}),o);!s&&t.extentSignal&&(e.push({type:"extent",field:UF(t.field),signal:t.extentSignal}),a.extent={signal:t.extentSignal}),e.push(a);for(const l of r)for(let t=0;t<2;t++)e.push({type:"formula",expr:iB({field:n[t]},{expr:"datum"}),as:l[t]});return t.formula&&e.push({type:"formula",expr:t.formula,as:t.formulaAs}),e})}}class cq extends gV{constructor(t){let e;if(super(null),xU(t=null!=t?t:{name:"source"})||(e=t.format?Object.assign({},bF(t.format,["parse"])):{}),vU(t))this._data={values:t.values};else if(yU(t)){if(this._data={url:t.url},!e.type){let n=/(?:\.([^.]+))?$/.exec(t.url)[1];SF(["json","csv","tsv","dsv","topojson"],n)||(n="json"),e.type=n}}else wU(t)?this._data={values:[{type:"Sphere"}]}:(bU(t)||xU(t))&&(this._data={});this._generator=xU(t),t.name&&(this._name=t.name),e&&!OF(e)&&(this._data.format=e)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(t){this._name=t}set parent(t){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}class hq extends gV{constructor(t,e){super(t),this.params=e}clone(){return new hq(null,this.params)}dependentFields(){return new Set}producedFields(){}hash(){return"Graticule "+_F(this.params)}assemble(){return Object.assign({type:"graticule"},!0===this.params?{}:this.params)}}class dq extends gV{constructor(t,e){super(t),this.params=e}clone(){return new dq(null,this.params)}dependentFields(){return new Set}producedFields(){var t;return new Set([null!==(t=this.params.as)&&void 0!==t?t:"data"])}hash(){return"Hash "+_F(this.params)}assemble(){return Object.assign({type:"sequence"},this.params)}}function fq(t){return t instanceof cq||t instanceof hq||t instanceof dq}class pq{constructor(){this._mutated=!1}setMutated(){this._mutated=!0}get mutatedFlag(){return this._mutated}}class mq extends pq{constructor(){super(),this._continue=!1}setContinue(){this._continue=!0}get continueFlag(){return this._continue}get flags(){return{continueFlag:this.continueFlag,mutatedFlag:this.mutatedFlag}}set flags({continueFlag:t,mutatedFlag:e}){t&&this.setContinue(),e&&this.setMutated()}reset(){}optimizeNextFromLeaves(t){if(fq(t))return!1;const e=t.parent,{continueFlag:n}=this.run(t);return n&&this.optimizeNextFromLeaves(e),this.mutatedFlag}}class gq extends pq{}class yq extends gV{constructor(t,e,n){super(t),this.dimensions=e,this.measures=n}clone(){return new yq(null,new Set(this.dimensions),yF(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(t,e){let n=!1;e.forEachFieldDef(t=>{t.aggregate&&(n=!0)});const r={},i=new Set;return n?(e.forEachFieldDef((t,n)=>{var s,o,a,l;const{aggregate:u,field:c}=t;if(u)if("count"===u)r["*"]=null!==(s=r["*"])&&void 0!==s?s:{},r["*"].count=new Set([iB(t,{forAs:!0})]);else{if(NM(u)||TM(u)){const t=NM(u)?"argmin":"argmax",e=u[t];r[e]=null!==(o=r[e])&&void 0!==o?o:{},r[e][t]=new Set([iB({op:t,field:e},{forAs:!0})])}else r[c]=null!==(a=r[c])&&void 0!==a?a:{},r[c][u]=new Set([iB(t,{forAs:!0})]);S$(n)&&"unaggregated"===e.scaleDomain(n)&&(r[c]=null!==(l=r[c])&&void 0!==l?l:{},r[c].min=new Set([iB({field:c,aggregate:"min"},{forAs:!0})]),r[c].max=new Set([iB({field:c,aggregate:"max"},{forAs:!0})]))}else!function(t,e,n,r){const i=fH(r)?r.encoding[u$(e)]:void 0;if(ZL(n)&&fH(r)&&jL(e,n,i,r.stack,r.markDef,r.config))t.add(iB(n,{})),t.add(iB(n,{suffix:"end"})),n.bin&&CB(n,e)&&t.add(iB(n,{binSuffix:"range"}));else if(e in YM){const n=function(t){switch(t){case"latitude":return"y";case"latitude2":return"y2";case"longitude":return"x";case"longitude2":return"x2"}}(e);t.add(r.getName(n))}else t.add(iB(n))}(i,n,t,e)}),i.size+IF(r).length===0?null:new yq(t,i,r)):null}static makeFromTransform(t,e){var n,r,i;const s=new Set,o={};for(const a of e.aggregate){const{op:t,field:e,as:i}=a;t&&("count"===t?(o["*"]=null!==(n=o["*"])&&void 0!==n?n:{},o["*"].count=new Set([i||iB(a,{forAs:!0})])):(o[e]=null!==(r=o[e])&&void 0!==r?r:{},o[e][t]=new Set([i||iB(a,{forAs:!0})])))}for(const a of null!==(i=e.groupby)&&void 0!==i?i:[])s.add(a);return s.size+IF(o).length===0?null:new yq(t,s,o)}merge(t){return function(t,e){if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;return!0}(this.dimensions,t.dimensions)?(function(t,e){var n;for(const r of IF(e)){const i=e[r];for(const e of IF(i))r in t?t[r][e]=new Set([...null!==(n=t[r][e])&&void 0!==n?n:[],...i[e]]):t[r]={[e]:i[e]}}}(this.measures,t.measures),!0):(nz.debug("different dimensions, cannot merge"),!1)}addDimensions(t){t.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...IF(this.measures)])}producedFields(){const t=new Set;for(const e of IF(this.measures))for(const n of IF(this.measures[e])){const r=this.measures[e][n];0===r.size?t.add(`${n}_${e}`):r.forEach(t.add,t)}return t}hash(){return"Aggregate "+_F({dimensions:this.dimensions,measures:this.measures})}assemble(){const t=[],e=[],n=[];for(const r of IF(this.measures))for(const i of IF(this.measures[r]))for(const s of this.measures[r][i])n.push(s),t.push(i),e.push("*"===r?null:UF(r));return{type:"aggregate",groupby:[...this.dimensions].map(UF),ops:t,fields:e,as:n}}}class vq extends gV{constructor(t,e,n,r){super(t),this.model=e,this.name=n,this.data=r;for(const i of JM){const t=e.facet[i];if(t){const{bin:n,sort:r}=t;this[i]=Object.assign({name:e.getName(i+"_domain"),fields:[iB(t),...D$(n)?[iB(t,{binSuffix:"end"})]:[]]},RL(r)?{sortField:r}:Jt(r)?{sortIndexField:yW(t,i)}:{})}}this.childModel=e.child}hash(){let t="Facet";for(const e of JM)this[e]&&(t+=` ${e.charAt(0)}:${_F(this[e])}`);return t}get fields(){var t;const e=[];for(const n of JM)(null===(t=this[n])||void 0===t?void 0:t.fields)&&e.push(...this[n].fields);return e}dependentFields(){const t=new Set(this.fields);for(const e of JM)this[e]&&(this[e].sortField&&t.add(this[e].sortField.field),this[e].sortIndexField&&t.add(this[e].sortIndexField));return t}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const t={};for(const e of p$){const n=this.childModel.component.scales[e];if(n&&!n.merged){const r=n.get("type"),i=n.get("range");if(tL(r)&&xz(i)){const n=Qq(Jq(this.childModel,e));n?t[e]=n:rz(m.unknownField(e))}}}return t}assembleRowColumnHeaderData(t,e,n){const r={row:"y",column:"x"}[t],i=[],s=[],o=[];n&&n[r]&&(e?(i.push("distinct_"+n[r]),s.push("max")):(i.push(n[r]),s.push("distinct")),o.push("distinct_"+n[r]));const{sortField:a,sortIndexField:l}=this[t];if(a){const{op:t=NL,field:e}=a;i.push(e),s.push(t),o.push(iB(a,{forAs:!0}))}else l&&(i.push(l),s.push("max"),o.push(l));return{name:this[t].name,source:null!=e?e:this.data,transform:[Object.assign({type:"aggregate",groupby:this[t].fields},i.length?{fields:i,ops:s,as:o}:{})]}}assembleFacetHeaderData(t){var e,n;const{columns:r}=this.model.layout,{layoutHeaders:i}=this.model.component,s=[],o={};for(const u of _W){for(const t of wW){const r=null!==(e=i[u]&&i[u][t])&&void 0!==e?e:[];for(const t of r)if((null===(n=t.axes)||void 0===n?void 0:n.length)>0){o[u]=!0;break}}if(o[u]){const t=`length(data("${this.facet.name}"))`;s.push({name:`${this.facet.name}_${u}`,transform:[{type:"sequence",start:0,stop:"row"===u?r?{signal:`ceil(${t} / ${r})`}:1:r?{signal:`min(${t}, ${r})`}:{signal:t}}]})}}const{row:a,column:l}=o;return(a||l)&&s.unshift(this.assembleRowColumnHeaderData("facet",null,t)),s}assemble(){var t,e;const n=[];let r=null;const i=this.getChildIndependentFieldsWithStep(),{column:s,row:o,facet:a}=this;if(s&&o&&(i.x||i.y)){r=`cross_${this.column.name}_${this.row.name}`;const s=[].concat(null!==(t=i.x)&&void 0!==t?t:[],null!==(e=i.y)&&void 0!==e?e:[]),o=s.map(()=>"distinct");n.push({name:r,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:s,ops:o}]})}for(const l of[PM,$M])this[l]&&n.push(this.assembleRowColumnHeaderData(l,r,i));if(a){const t=this.assembleFacetHeaderData(i);t&&n.push(...t)}return n}}function bq(t){return"'"===t[0]&&"'"===t[t.length-1]||'"'===t[0]&&'"'===t[t.length-1]?t.slice(1,-1):t}function xq(t){const e={};return function t(e,n){if(pF(e))t(e.not,n);else if(fF(e))for(const r of e.and)t(r,n);else if(dF(e))for(const r of e.or)t(r,n);else n(e)}(t.filter,t=>{var n;if(Iz(t)){let r=null;Ez(t)?r=t.equal:Tz(t)?r=t.range[0]:Oz(t)&&(r=(null!==(n=t.oneOf)&&void 0!==n?n:t.in)[0]),r&&(iz(r)?e[t.field]="date":He(r)?e[t.field]="number":Ye(r)&&(e[t.field]="string")),t.timeUnit&&(e[t.field]="date")}}),e}class _q extends gV{constructor(t,e){super(t),this._parse=e}clone(){return new _q(null,yF(this._parse))}hash(){return"Parse "+_F(this._parse)}static makeExplicit(t,e,n){let r={};const i=e.data;return!xU(i)&&i&&i.format&&i.format.parse&&(r=i.format.parse),this.makeWithAncestors(t,r,{},n)}static makeWithAncestors(t,e,n,r){for(const o of IF(n)){const t=r.getWithExplicit(o);void 0!==t.value&&(t.explicit||t.value===n[o]||"derived"===t.value||"flatten"===n[o]?delete n[o]:rz(m.differentParse(o,n[o],t.value)))}for(const o of IF(e)){const t=r.get(o);void 0!==t&&(t===e[o]?delete e[o]:rz(m.differentParse(o,e[o],t)))}const i=new cU(e,n);r.copyAll(i);const s={};for(const o of IF(i.combine())){const t=i.get(o);null!==t&&(s[o]=t)}return 0===IF(s).length||r.parseNothing?null:new _q(t,s)}get parse(){return this._parse}merge(t){this._parse=Object.assign(Object.assign({},this._parse),t.parse),t.remove()}assembleFormatParse(){const t={};for(const e of IF(this._parse)){const n=this._parse[e];1===qF(e)&&(t[e]=n)}return t}producedFields(){return new Set(IF(this._parse))}dependentFields(){return new Set(IF(this._parse))}assembleTransforms(t=!1){return IF(this._parse).filter(e=>!t||qF(e)>1).map(t=>{const e=function(t,e){const n=BF(t);return"number"===e?`toNumber(${n})`:"boolean"===e?`toBoolean(${n})`:"string"===e?`toString(${n})`:"date"===e?`toDate(${n})`:"flatten"===e?n:0===e.indexOf("date:")?`timeParse(${n},'${bq(e.slice(5,e.length))}')`:0===e.indexOf("utc:")?`utcParse(${n},'${bq(e.slice(4,e.length))}')`:(rz(m.unrecognizedParse(e)),null)}(t,this._parse[t]);return e?{type:"formula",expr:e,as:WF(t)}:null}).filter(t=>null!==t)}}class wq extends gV{clone(){return new wq(null)}constructor(t){super(t)}dependentFields(){return new Set}producedFields(){return new Set(["_vgsid_"])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:"_vgsid_"}}}class Sq extends gV{constructor(t,e){super(t),this.transform=e}clone(){return new Sq(null,yF(this.transform))}addDimensions(t){this.transform.groupby=AF(this.transform.groupby.concat(t),t=>t)}dependentFields(){const t=new Set;return this.transform.groupby&&this.transform.groupby.forEach(t.add,t),this.transform.joinaggregate.map(t=>t.field).filter(t=>void 0!==t).forEach(t.add,t),t}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(t){var e;return null!==(e=t.as)&&void 0!==e?e:iB(t)}hash(){return"JoinAggregateTransform "+_F(this.transform)}assemble(){const t=[],e=[],n=[];for(const i of this.transform.joinaggregate)e.push(i.op),n.push(this.getDefaultName(i)),t.push(void 0===i.field?null:i.field);const r=this.transform.groupby;return Object.assign({type:"joinaggregate",as:n,ops:e,fields:t},void 0!==r?{groupby:r}:{})}}class Cq extends gV{constructor(t,e){super(t),this._stack=e}clone(){return new Cq(null,yF(this._stack))}static makeFromTransform(t,e){const{stack:n,groupby:r,as:i,offset:s="zero"}=e,o=[],a=[];if(void 0!==e.sort)for(const c of e.sort)o.push(c.field),a.push(HF(c.order,"ascending"));const l={field:o,order:a};let u;return u=function(t){return Jt(t)&&t.every(t=>Ye(t))&&t.length>1}(i)?i:Ye(i)?[i,i+"_end"]:[e.stack+"_start",e.stack+"_end"],new Cq(t,{stackField:n,groupby:r,offset:s,sort:l,facetby:[],as:u})}static makeFromEncoding(t,e){const n=e.stack,{encoding:r}=e;if(!n)return null;const{groupbyChannel:i,fieldChannel:s,offset:o,impute:a}=n;let l;i&&(l=pB(r[i]));const u=function(t){return t.stack.stackBy.reduce((t,e)=>{const n=iB(e.fieldDef);return n&&t.push(n),t},[])}(e),c=e.encoding.order;let h;return h=Jt(c)||qL(c)?MB(c):u.reduce((t,e)=>(t.field.push(e),t.order.push("y"===s?"descending":"ascending"),t),{field:[],order:[]}),new Cq(t,{dimensionFieldDef:l,stackField:e.vgField(s),facetby:[],stackby:u,sort:h,offset:o,impute:a,as:[e.vgField(s,{suffix:"start",forAs:!0}),e.vgField(s,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(t){this._stack.facetby.push(...t)}dependentFields(){const t=new Set;return t.add(this._stack.stackField),this.getGroupbyFields().forEach(t.add,t),this._stack.facetby.forEach(t.add,t),this._stack.sort.field.forEach(t.add,t),t}producedFields(){return new Set(this._stack.as)}hash(){return"Stack "+_F(this._stack)}getGroupbyFields(){const{dimensionFieldDef:t,impute:e,groupby:n}=this._stack;return t?t.bin?e?[iB(t,{binSuffix:"mid"})]:[iB(t,{}),iB(t,{binSuffix:"end"})]:[iB(t)]:null!=n?n:[]}assemble(){const t=[],{facetby:e,dimensionFieldDef:n,stackField:r,stackby:i,sort:s,offset:o,impute:a,as:l}=this._stack;if(a&&n){const{band:s=.5,bin:o}=n;o&&t.push({type:"formula",expr:s+"*"+iB(n,{expr:"datum"})+`+${1-s}*`+iB(n,{expr:"datum",binSuffix:"end"}),as:iB(n,{binSuffix:"mid",forAs:!0})}),t.push({type:"impute",field:r,groupby:[...i,...e],key:iB(n,{binSuffix:"mid"}),method:"value",value:0})}return t.push({type:"stack",groupby:[...this.getGroupbyFields(),...e],field:r,sort:s,as:l,offset:o}),t}}class Eq extends gV{constructor(t,e){super(t),this.transform=e}clone(){return new Eq(null,yF(this.transform))}addDimensions(t){this.transform.groupby=AF(this.transform.groupby.concat(t),t=>t)}dependentFields(){var t,e;const n=new Set;return(null!==(t=this.transform.groupby)&&void 0!==t?t:[]).forEach(n.add,n),(null!==(e=this.transform.sort)&&void 0!==e?e:[]).forEach(t=>n.add(t.field)),this.transform.window.map(t=>t.field).filter(t=>void 0!==t).forEach(n.add,n),n}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(t){var e;return null!==(e=t.as)&&void 0!==e?e:iB(t)}hash(){return"WindowTransform "+_F(this.transform)}assemble(){var t;const e=[],n=[],r=[],i=[];for(const c of this.transform.window)n.push(c.op),r.push(this.getDefaultName(c)),i.push(void 0===c.param?null:c.param),e.push(void 0===c.field?null:c.field);const s=this.transform.frame,o=this.transform.groupby;if(s&&null===s[0]&&null===s[1]&&n.every(t=>OM(t)))return Object.assign({type:"joinaggregate",as:r,ops:n,fields:e},void 0!==o?{groupby:o}:{});const a=[],l=[];if(void 0!==this.transform.sort)for(const c of this.transform.sort)a.push(c.field),l.push(null!==(t=c.order)&&void 0!==t?t:"ascending");const u=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:i,as:r,ops:n,fields:e,sort:{field:a,order:l}},void 0!==u?{ignorePeers:u}:{}),void 0!==o?{groupby:o}:{}),void 0!==s?{frame:s}:{})}}class kq extends mq{run(t){const e=t.parent;if(t instanceof _q){if(fq(e))return this.flags;if(e.numChildren()>1)return this.setContinue(),this.flags;if(e instanceof _q)this.setMutated(),e.merge(t);else{if(TF(e.producedFields(),t.dependentFields()))return this.setContinue(),this.flags;this.setMutated(),t.swapWithParent()}}return this.setContinue(),this.flags}}class Aq extends gq{mergeNodes(t,e){const n=e.shift();for(const r of e)t.removeChild(r),r.parent=n,r.remove()}run(t){const e=t.children.map(t=>t.hash()),n={};for(let r=0;r<e.length;r++)void 0===n[e[r]]?n[e[r]]=[t.children[r]]:n[e[r]].push(t.children[r]);for(const r of IF(n))n[r].length>1&&(this.setMutated(),this.mergeNodes(t,n[r]));for(const r of t.children)this.run(r);return this.mutatedFlag}}class Dq extends mq{run(t){return t instanceof yV||t.numChildren()>0||t instanceof vq||(this.setMutated(),t.remove()),this.flags}}class Nq extends mq{constructor(){super(...arguments),this.fields=new Set,this.prev=null}run(t){if(this.setContinue(),t instanceof vV){const e=t.producedFields();DF(e,this.fields)?(this.setMutated(),this.prev.remove()):this.fields=new Set([...this.fields,...e]),this.prev=t}return this.flags}reset(){this.fields.clear()}}class Tq extends mq{run(t){this.setContinue();const e=t.parent.children.filter(t=>t instanceof vV),n=e.pop();for(const r of e)this.setMutated(),n.merge(r);return this.flags}}function Oq(t){if(t instanceof vq)if(1!==t.numChildren()||t.children[0]instanceof yV){const n=t.model.component.data.main;!function t(e){if(e instanceof yV&&e.type===CU.Main&&1===e.numChildren()){const n=e.children[0];n instanceof vq||(n.swapWithParent(),t(e))}}(n);const r=(e=t,function t(n){if(!(n instanceof vq)){const r=n.clone();if(r instanceof yV){const t=zq+r.getSource();r.setSource(t),e.model.component.data.outputNodes[t]=r}else(r instanceof yq||r instanceof Cq||r instanceof Eq||r instanceof Sq)&&r.addDimensions(e.fields);for(const e of n.children.flatMap(t))e.parent=r;return[r]}return n.children.flatMap(t)}),i=t.children.map(r).flat();for(const t of i)t.parent=n}else{const e=t.children[0];(e instanceof yq||e instanceof Cq||e instanceof Eq||e instanceof Sq)&&e.addDimensions(t.fields),e.swapWithParent(),Oq(t)}else t.children.map(Oq);var e}class Iq extends gq{constructor(){super()}run(t){t instanceof yV&&!t.isRequired()&&(this.setMutated(),t.remove());for(const e of t.children)this.run(e);return this.mutatedFlag}}class Rq extends gq{constructor(t){super(),this.requiresSelectionId=t&&KV(t)}run(t){t instanceof wq&&(this.requiresSelectionId&&(fq(t.parent)||t.parent instanceof yq||t.parent instanceof _q)||(this.setMutated(),t.remove()));for(const e of t.children)this.run(e);return this.mutatedFlag}}class Fq extends mq{run(t){const e=t.parent,n=[...e.children],r=e.children.filter(t=>t instanceof _q);if(e.numChildren()>1&&r.length>=1){const t={},i=new Set;for(const e of r){const n=e.parse;for(const e of IF(n))e in t?t[e]!==n[e]&&i.add(e):t[e]=n[e]}for(const e of i)delete t[e];if(!OF(t)){this.setMutated();const r=new _q(e,t);for(const i of n){if(i instanceof _q)for(const e of IF(t))delete i.parse[e];e.removeChild(i),i.parent=r,i instanceof _q&&0===IF(i.parse).length&&i.remove()}}}return this.setContinue(),this.flags}}class Mq extends mq{run(t){const e=t.parent,n=e.children.filter(t=>t instanceof yq),r={};for(const i of n){const t=_F(i.groupBy);t in r||(r[t]=[]),r[t].push(i)}for(const i of IF(r)){const t=r[i];if(t.length>1){const n=t.pop();for(const r of t)n.merge(r)&&(e.removeChild(r),r.parent=n,r.remove(),this.setMutated())}}return this.setContinue(),this.flags}}class $q extends mq{constructor(t){super(),this.model=t}run(t){const e=t.parent,n=!(fq(e)||e instanceof ZV||e instanceof _q||e instanceof wq),r=[],i=[];for(const s of e.children)s instanceof uq&&(n&&!TF(e.producedFields(),s.dependentFields())?r.push(s):i.push(s));if(r.length>0){const t=r.pop();for(const e of r)t.merge(e,this.model.renameSignal.bind(this.model));this.setMutated(),e instanceof uq?e.merge(t,this.model.renameSignal.bind(this.model)):t.swapWithParent()}if(i.length>1){const t=i.pop();for(const e of i)t.merge(e,this.model.renameSignal.bind(this.model));this.setMutated()}return this.setContinue(),this.flags}}class Pq extends mq{run(t){const e=t.parent,n=[...e.children];if(!CF(n,t=>t instanceof yV)||e.numChildren()<=1)return this.setContinue(),this.flags;const r=[];let i;for(const s of n)if(s instanceof yV){let t=s;for(;1===t.numChildren();){const[e]=t.children;if(!(e instanceof yV))break;t=e}r.push(...t.children),i?(e.removeChild(s),s.parent=i.parent,i.parent.removeChild(i),i.parent=t,this.setMutated()):i=t}else r.push(s);if(r.length){this.setMutated();for(const t of r)t.parent.removeChild(t),t.parent=i}return this.setContinue(),this.flags}}const zq="scale_";function Lq(t){for(const e of t){for(const t of e.children)if(t.parent!==e)return!1;if(!Lq(e.children))return!1}return!0}function Bq(t){const e=[];function n(t){if(0===t.numChildren())e.push(t);else for(const e of t.children)n(e)}for(const r of t)n(r);return e}function jq(t){return t}function Uq(t,e){return e.map(e=>{if(t instanceof mq){const n=t.optimizeNextFromLeaves(e);return t.reset(),n}return t.run(e)}).some(jq)}function Vq(t,e,n){let r=t.sources;const i=new Set;return i.add(Uq(new Iq,r)),i.add(Uq(new Rq(e),r)),r=r.filter(t=>t.numChildren()>0),i.add(Uq(new Dq,Bq(r))),r=r.filter(t=>t.numChildren()>0),n||(i.add(Uq(new kq,Bq(r))),i.add(Uq(new $q(e),Bq(r))),i.add(Uq(new Nq,Bq(r))),i.add(Uq(new Fq,Bq(r))),i.add(Uq(new Mq,Bq(r))),i.add(Uq(new Tq,Bq(r))),i.add(Uq(new Aq,r)),i.add(Uq(new Pq,Bq(r)))),t.sources=r,i.has(!0)}class Wq{constructor(t){Object.defineProperty(this,"signal",{enumerable:!0,get:t})}static fromName(t,e){return new Wq(()=>t(e))}}function qq(t,e){const n=t.getScaleComponent(e).get("type"),{encoding:r}=t,i=function(t,e,n,r){if("unaggregated"===t){const{valid:t,reason:r}=Xq(e,n);if(!t)return void rz(r)}else if(void 0===t&&r.useUnaggregatedDomain){const{valid:t}=Xq(e,n);if(t)return"unaggregated"}return t}(t.scaleDomain(e),t.typedFieldDef(e),n,t.config.scale);return i!==t.scaleDomain(e)&&(t.specifiedScales[e]=Object.assign(Object.assign({},t.specifiedScales[e]),{domain:i})),"x"===e&&mB(r.x2)?mB(r.x)?mU(Gq(n,i,t,"x"),Gq(n,i,t,"x2"),"domain","scale",Zq):Gq(n,i,t,"x2"):"y"===e&&mB(r.y2)?mB(r.y)?mU(Gq(n,i,t,"y"),Gq(n,i,t,"y2"),"domain","scale",Zq):Gq(n,i,t,"y2"):Gq(n,i,t,e)}function Hq(t,e,n){var r;const i=null===(r=vz(n))||void 0===r?void 0:r.unit;return"temporal"===e||i?function(t,e,n){return t.map(t=>({signal:`{data: ${wB(t,{timeUnit:n,type:e})}}`}))}(t,e,i):[t]}function Gq(t,e,n,r){const{encoding:i}=n,s=mB(i[r]),{type:o}=s,a=s.timeUnit;if(function(t){return t&&t.unionWith}(e)){const i=Gq(t,void 0,n,r),s=Hq(e.unionWith,o,a);return hU([...i.value,...s])}if(bz(e))return hU([e]);if(e&&"unaggregated"!==e&&!iL(e))return hU(Hq(e,o,a));const l=n.stack;if(l&&r===l.fieldChannel){if("normalize"===l.offset)return dU([[0,1]]);const t=n.requestDataName(CU.Main);return dU([{data:t,field:n.vgField(r,{suffix:"start"})},{data:t,field:n.vgField(r,{suffix:"end"})}])}const u=S$(r)&&qL(s)?function(t,e,n){if(!tL(n))return;const r=t.fieldDef(e),i=r.sort;if(FL(i))return{op:"min",field:yW(r,e),order:"ascending"};const{stack:s}=t,o=s?[...s.groupbyField?[s.groupbyField]:[],...s.stackBy.map(t=>t.fieldDef.field)]:void 0;if(RL(i))return Yq(i,s&&!SF(o,i.field));if(IL(i)){const{encoding:e,order:n}=i,r=t.fieldDef(e),{aggregate:a,field:l}=r,u=s&&!SF(o,l);if(NM(a)||TM(a))return Yq({field:iB(r),order:n},u);if(OM(a)||!a)return Yq({op:a,field:l,order:n},u)}else{if("descending"===i)return{op:"min",field:t.vgField(e),order:"descending"};if(SF(["ascending",void 0],i))return!0}}(n,r,t):void 0;if(GL(s))return dU(Hq([s.datum],o,a));const c=s;if("unaggregated"===e){const t=n.requestDataName(CU.Main),{field:e}=s;return dU([{data:t,field:iB({field:e,aggregate:"min"})},{data:t,field:iB({field:e,aggregate:"max"})}])}if(D$(c.bin)){if(tL(t))return dU("bin-ordinal"===t?[]:[{data:MF(u)?n.requestDataName(CU.Main):n.requestDataName(CU.Raw),field:n.vgField(r,CB(c,r)?{binSuffix:"range"}:{}),sort:!0!==u&&te(u)?u:{field:n.vgField(r,{}),op:"min"}}]);{const{bin:t}=c;if(D$(t)){const e=aq(n,c.field,t);return dU([new Wq(()=>{const t=n.getSignalName(e);return`[${t}.start, ${t}.stop]`})])}return dU([{data:n.requestDataName(CU.Main),field:n.vgField(r,{})}])}}if(c.timeUnit&&SF(["time","utc"],t)&&jL(r,c,fH(n)?n.encoding[u$(r)]:void 0,n.stack,n.markDef,n.config)){const t=n.requestDataName(CU.Main);return dU([{data:t,field:n.vgField(r)},{data:t,field:n.vgField(r,{suffix:"end"})}])}return dU(u?[{data:MF(u)?n.requestDataName(CU.Main):n.requestDataName(CU.Raw),field:n.vgField(r),sort:u}]:[{data:n.requestDataName(CU.Main),field:n.vgField(r)}])}function Yq(t,e){const{op:n,field:r,order:i}=t;return Object.assign(Object.assign({op:null!=n?n:e?"sum":NL},r?{field:UF(r)}:{}),i?{order:i}:{})}function Kq(t,e){var n;const r=t.component.scales[e],i=t.specifiedScales[e].domain,s=null===(n=t.fieldDef(e))||void 0===n?void 0:n.bin,o=iL(i)&&i,a=T$(s)&&O$(s.extent)&&s.extent;(o||a)&&r.set("selectionExtent",null!=o?o:a,!0)}function Xq(t,e){const{aggregate:n,type:r}=t;return n?Ye(n)&&!MM[n]?{valid:!1,reason:m.unaggregateDomainWithNonSharedDomainOp(n)}:"quantitative"===r&&"log"===e?{valid:!1,reason:m.unaggregatedDomainWithLogScale(t)}:{valid:!0}:{valid:!1,reason:m.unaggregateDomainHasNoEffectForRawField(t)}}function Zq(t,e,n,r){return t.explicit&&e.explicit&&rz(m.mergeConflictingDomainProperty(n,r,t.value,e.value)),{explicit:t.explicit,value:[...t.value,...e.value]}}function Qq(t){if(_z(t)&&Ye(t.field))return t.field;if(function(t){return!Jt(t)&&"fields"in t&&!("data"in t)}(t)){let e;for(const n of t.fields)if(_z(n)&&Ye(n.field))if(e){if(e!==n.field)return rz(m.FACETED_INDEPENDENT_DIFFERENT_SOURCES),e}else e=n.field;return rz(m.FACETED_INDEPENDENT_SAME_FIELDS_DIFFERENT_SOURCES),e}if(function(t){return!Jt(t)&&"fields"in t&&"data"in t}(t)){rz(m.FACETED_INDEPENDENT_SAME_SOURCE);const e=t.fields[0];return Ye(e)?e:void 0}}function Jq(t,e){return function(t){const e=AF(t.map(t=>_z(t)?sF(t,["sort"]):t),_F),n=AF(t.map(t=>{if(_z(t)){const e=t.sort;return void 0===e||MF(e)||("op"in e&&"count"===e.op&&delete e.field,"ascending"===e.order&&delete e.order),e}}).filter(t=>void 0!==t),_F);if(0===e.length)return;if(1===e.length){const e=t[0];if(_z(e)&&n.length>0){let t=n[0];return n.length>1?(rz(m.MORE_THAN_ONE_SORT),t=!0):te(t)&&"field"in t&&e.field===t.field&&(t=!t.order||{order:t.order}),Object.assign(Object.assign({},e),{sort:t})}return e}const r=AF(n.map(t=>MF(t)||!("op"in t)||t.op in DM?t:(rz(m.domainSortDropped(t)),!0)),_F);let i;1===r.length?i=r[0]:r.length>1&&(rz(m.MORE_THAN_ONE_SORT),i=!0);const s=AF(t.map(t=>_z(t)?t.data:null),t=>t);return Object.assign(1===s.length&&null!==s[0]?{data:s[0],fields:e.map(t=>t.field)}:{fields:e},i?{sort:i}:{})}(t.component.scales[e].get("domains").map(e=>(_z(e)&&(e.data=t.lookupDataSource(e.data)),e)))}function tH(t){return IF(t.component.scales).reduce((e,n)=>{const r=t.component.scales[n];if(r.merged)return e;const i=r.combine(),{name:s,type:o,selectionExtent:a,reverse:l}=i,u=sF(i,["name","type","selectionExtent","domains","range","reverse"]),c=function(t,e,n,r){if(m$(n)){if(xz(t))return{step:{signal:e+"_step"}}}else if(te(t)&&_z(t))return Object.assign(Object.assign({},t),{data:r.lookupDataSource(t.data)});return t}(i.range,s,n,t);let h;a&&(h=function(t,e){const n=e.selection;return{signal:JV(t.getSelectionComponent(n,$F(n)),e)}}(t,a));const d=Jq(t,n);return e.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:s,type:o},d?{domain:d}:{}),h?{domainRaw:h}:{}),{range:c}),void 0!==l?{reverse:l}:{}),u)),e},[])}class eH extends cU{constructor(t,e){super({},{name:t}),this.merged=!1,this.setWithExplicit("type",e)}domainDefinitelyIncludesZero(){return!1!==this.get("zero")||CF(this.get("domains"),t=>Jt(t)&&2===t.length&&t[0]<=0&&t[1]>=0)}}const nH=["range","scheme"];function rH(t){return"x"===t?"width":"y"===t?"height":void 0}function iH(t,e){const n=t.fieldDef(e);if(n&&n.bin&&D$(n.bin)){const r=aq(t,n.field,n.bin),i=rH(e),s=t.getName(i);return new Wq(()=>{const e=t.getSignalName(r),n=`(${e}.stop - ${e}.start) / ${e}.step`;return`${t.getSignalName(s)} / (${n})`})}}function sH(t,e){const n=e.specifiedScales[t],{size:r}=e,i=e.getScaleComponent(t).get("type");for(const u of nH)if(void 0!==n[u]){const r=lL(i,u),o=uL(t,u);if(r)if(o)rz(o);else switch(u){case"range":{const r=n.range;if(Jt(r)){if(m$(t))return hU(r.map(t=>{if("width"===t||"height"===t){const n=e.getName(t),r=e.getSignalName.bind(e);return Wq.fromName(r,n)}return t}))}else if(te(r))return hU({data:e.requestDataName(CU.Main),field:r.field,sort:{op:"min",field:e.vgField(t)}});return hU(r)}case"scheme":return hU(function(t){return!Ye(t)&&!!t.name}(s=n[u])?Object.assign({scheme:s.name},bF(s,["name"])):{scheme:s})}else rz(m.scalePropertyNotWorkWithScaleType(i,u,t))}var s;if("x"===t||"y"===t){const e="x"===t?"width":"height",n=r[e];if(_j(n)){if(tL(i))return hU({step:n.step});rz(m.stepDropped(e))}}const{rangeMin:o,rangeMax:a}=n,l=function(t,e){const{size:n,config:r,mark:i,encoding:s}=e,o=e.getSignalName.bind(e),{type:a}=mB(s[t]),l=e.getScaleComponent(t).get("type"),{domain:u,domainMid:c}=e.specifiedScales[t];switch(t){case"x":case"y":{if(SF(["point","band"],l))if("x"!==t||n.width){if("y"===t&&!n.height){const t=kj(r.view,"height");if(_j(t))return t}}else{const t=kj(r.view,"width");if(_j(t))return t}const i=rH(t),s=e.getName(i);return"y"===t&&eL(l)?[Wq.fromName(o,s),0]:[0,Wq.fromName(o,s)]}case qM:{const s=function t(e,n,r){if(n)return bz(n)?{signal:`${n.signal} ? 0 : ${t(e,!1,r)}`}:0;switch(e){case"bar":case"tick":return r.scale.minBandSize;case"line":case"trail":case"rule":return r.scale.minStrokeWidth;case"text":return r.scale.minFontSize;case"point":case"square":case"circle":return r.scale.minSize}throw new Error(m.incompatibleChannel("size",e))}(i,e.component.scales[t].get("zero"),r),o=function(t,e,n,r){const i={x:iH(n,"x"),y:iH(n,"y")};switch(t){case"bar":case"tick":{if(void 0!==r.scale.maxBandSize)return r.scale.maxBandSize;const t=oH(e,i,r.view);return He(t)?t-1:new Wq(()=>t.signal+" - 1")}case"line":case"trail":case"rule":return r.scale.maxStrokeWidth;case"text":return r.scale.maxFontSize;case"point":case"square":case"circle":{if(r.scale.maxSize)return r.scale.maxSize;const t=oH(e,i,r.view);return He(t)?Math.pow(.95*t,2):new Wq(()=>`pow(0.95 * ${t.signal}, 2)`)}}throw new Error(m.incompatibleChannel("size",t))}(i,n,e,r);return rL(l)?function(t,e,n){const r=()=>{const r=NB(e),i=NB(t),s=`(${r} - ${i}) / (${n} - 1)`;return`sequence(${i}, ${r} + ${s}, ${s})`};return bz(e)?new Wq(r):{signal:r()}}(s,o,function(t,e,n,r){switch(t){case"quantile":return e.scale.quantileCount;case"quantize":return e.scale.quantizeCount;case"threshold":return void 0!==n&&Jt(n)?n.length+1:(rz(m.domainRequiredForThresholdScale(r)),3)}}(l,r,u,t)):[s,o]}case LM:return[0,2*Math.PI];case"angle":return[0,360];case zM:return[0,new Wq(()=>`min(${e.getSignalName("width")},${e.getSignalName("height")})/2`)];case"strokeWidth":return[r.scale.minStrokeWidth,r.scale.maxStrokeWidth];case"strokeDash":return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case WM:return"symbol";case jM:case UM:case VM:return"ordinal"===l?"nominal"===a?"category":"ordinal":void 0!==c?"diverging":"rect"===i||"geoshape"===i?"heatmap":"ramp";case"opacity":case"fillOpacity":case"strokeOpacity":return[r.scale.minOpacity,r.scale.maxOpacity]}throw new Error("Scale range undefined for channel "+t)}(t,e);return(void 0!==o||void 0!==a)&&lL(i,"rangeMin")&&Jt(l)&&2===l.length?hU([null!=o?o:l[0],null!=a?a:l[1]]):dU(l)}function oH(t,e,n){const r=_j(t.width)?t.width.step:Ej(n,"width"),i=_j(t.height)?t.height.step:Ej(n,"height");return e.x||e.y?new Wq(()=>`min(${[e.x?e.x.signal:r,e.y?e.y.signal:i].join(", ")})`):Math.min(r,i)}function aH(t,e){fH(t)?function(t,e){const n=t.component.scales,{config:r,encoding:i,markDef:s,specifiedScales:o}=t;for(const a of IF(n)){const l=o[a],u=n[a],c=t.getScaleComponent(a),h=mB(i[a]),d=l[e],f=c.get("type"),p=c.get("padding"),g=c.get("paddingInner"),y=lL(f,e),v=uL(a,e);if(void 0!==d&&(y?v&&rz(v):rz(m.scalePropertyNotWorkWithScaleType(f,e,a))),y&&void 0===v)if(void 0!==d){const t=h.timeUnit,n=h.type;switch(e){case"domainMax":case"domainMin":iz(l[e])||"temporal"===n||t?u.set(e,{signal:wB(l[e],{type:n,timeUnit:t})},!0):u.set(e,l[e],!0);break;default:u.copyKeyFromObject(e,l)}}else{const n=e in lH?lH[e]({model:t,channel:a,fieldOrDatumDef:h,scaleType:f,scalePadding:p,scalePaddingInner:g,domain:l.domain,markDef:s,config:r}):r.scale[e];void 0!==n&&u.set(e,n,!1)}}}(t,e):cH(t,e)}const lH={bins:({model:t,fieldOrDatumDef:e})=>qL(e)?function(t,e){const n=e.bin;if(D$(n)){const r=aq(t,e.field,n);return new Wq(()=>t.getSignalName(r))}if(N$(n)&&T$(n)&&void 0!==n.step)return{step:n.step}}(t,e):void 0,interpolate:({channel:t,fieldOrDatumDef:e})=>function(t,e){if(SF([jM,UM,VM],t)&&"nominal"!==e)return"hcl"}(t,e.type),nice:({scaleType:t,channel:e,fieldOrDatumDef:n})=>function(t,e,n){var r;if(!(null===(r=pB(n))||void 0===r?void 0:r.bin)&&!SF(["time","utc"],t))return e in f$||void 0}(t,e,n),padding:({channel:t,scaleType:e,fieldOrDatumDef:n,markDef:r,config:i})=>function(t,e,n,r,i,s){if(t in f$){if(nL(e)){if(void 0!==n.continuousPadding)return n.continuousPadding;const{type:e,orient:o}=i;if("bar"===e&&(!qL(r)||!r.bin&&!r.timeUnit)&&("vertical"===o&&"x"===t||"horizontal"===o&&"y"===t))return s.continuousBandSize}if("point"===e)return n.pointPadding}}(t,e,i.scale,n,r,i.bar),paddingInner:({scalePadding:t,channel:e,markDef:n,config:r})=>function(t,e,n,r){if(void 0===t&&e in f$){const{bandPaddingInner:t,barBandPaddingInner:e,rectBandPaddingInner:i}=r;return HF(t,"bar"===n?e:i)}}(t,e,n.type,r.scale),paddingOuter:({scalePadding:t,channel:e,scaleType:n,scalePaddingInner:r,config:i})=>function(t,e,n,r,i,s){if(void 0===t&&e in f$&&"band"===n){const{bandPaddingOuter:t}=s;return HF(t,bz(i)?{signal:i.signal+"/2"}:i/2)}}(t,e,n,0,r,i.scale),reverse:({fieldOrDatumDef:t,scaleType:e,channel:n,config:r})=>function(t,e,n,r){return"x"===n&&void 0!==r.xReverse?eL(t)&&"descending"===e?bz(r.xReverse)?{signal:"!"+r.xReverse.signal}:!r.xReverse:r.xReverse:!(!eL(t)||"descending"!==e)||void 0}(e,qL(t)?t.sort:void 0,n,r.scale),zero:({channel:t,fieldOrDatumDef:e,domain:n,markDef:r,scaleType:i})=>function(t,e,n,r,i){if(n&&"unaggregated"!==n&&eL(i)){if(Jt(n)){const t=n[n.length-1];if(n[0]<=0&&t>=0)return!0}return!1}if("size"===t&&"quantitative"===e.type&&!rL(i))return!0;if((!qL(e)||!e.bin)&&SF([...p$,...y$],t)){const{orient:e,type:n}=r;return!SF(["bar","area","line","trail"],n)||!("horizontal"===e&&"y"===t||"vertical"===e&&"x"===t)}return!1}(t,e,n,r,i)};function uH(t){fH(t)?function(t){const e=t.component.scales;for(const n of w$){const r=e[n];if(!r)continue;const i=sH(n,t);r.setWithExplicit("range",i)}}(t):cH(t,"range")}function cH(t,e){const n=t.component.scales;for(const r of t.children)"range"===e?uH(r):aH(r,e);for(const r of IF(n)){let i;for(const n of t.children){const t=n.component.scales[r];t&&(i=mU(i,t.getWithExplicit(e),e,"scale",fU((t,n)=>{switch(e){case"range":return t.step&&n.step?t.step-n.step:0}return 0})))}n[r].setWithExplicit(e,i)}}const hH=fU((t,e)=>Hz(t)-Hz(e));class dH{constructor(){this.nameMap={}}rename(t,e){this.nameMap[t]=e}has(t){return void 0!==this.nameMap[t]}get(t){for(;this.nameMap[t]&&t!==this.nameMap[t];)t=this.nameMap[t];return t}}function fH(t){return"unit"===(null==t?void 0:t.type)}function pH(t){return"facet"===(null==t?void 0:t.type)}function mH(t){return"concat"===(null==t?void 0:t.type)}function gH(t){return"layer"===(null==t?void 0:t.type)}class yH{constructor(t,e,n,r,i,s,o){var a,l;this.type=e,this.parent=n,this.config=i,this.view=o,this.children=[],this.correctDataNames=t=>(t.from&&t.from.data&&(t.from.data=this.lookupDataSource(t.from.data)),t.from&&t.from.facet&&t.from.facet.data&&(t.from.facet.data=this.lookupDataSource(t.from.facet.data)),t),this.parent=n,this.config=i,this.name=null!==(a=t.name)&&void 0!==a?a:r,this.title=kB(t.title)?{text:t.title}:t.title,this.scaleNameMap=n?n.scaleNameMap:new dH,this.projectionNameMap=n?n.projectionNameMap:new dH,this.signalNameMap=n?n.signalNameMap:new dH,this.data=t.data,this.description=t.description,this.transforms=(null!==(l=t.transform)&&void 0!==l?l:[]).map(t=>EU(t)?{filter:mF(t.filter,$z)}:t),this.layout="layer"===e||"unit"===e?{}:function(t,e,n){var r,i;const s=n[e],o={},{spacing:a,columns:l}=s;void 0!==a&&(o.spacing=a),void 0!==l&&(PL(t)&&!ML(t.facet)||vj(t))&&(o.columns=l),bj(t)&&(o.columns=1);for(const u of Sj)if(void 0!==t[u])if("spacing"===u){const e=t[u];o[u]=He(e)?e:{row:null!==(r=e.row)&&void 0!==r?r:a,column:null!==(i=e.column)&&void 0!==i?i:a}}else o[u]=t[u];return o}(t,e,i),this.component={data:{sources:n?n.component.data.sources:[],outputNodes:n?n.component.data.outputNodes:{},outputNodeRefCounts:n?n.component.data.outputNodeRefCounts:{},isFaceted:PL(t)||n&&n.component.data.isFaceted&&void 0===t.data},layoutSize:new cU,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},s?yF(s):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){!function(t,{ignoreRange:e}={}){(function t(e){e.component.scales=fH(e)?function(t){const{encoding:e,mark:n}=t;return w$.reduce((r,i)=>{const s=mB(e[i]);if(s&&n===yM&&i===WM&&s.type===Uz)return r;let o=s&&s.scale;if(s&&null!==o&&!1!==o){o=null!=o?o:{};const e=function(t,e,n,r){const i=function(t,e,n){var r;switch(e.type){case"nominal":case"ordinal":if(ZM(t)||"discrete"===k$(t))return"shape"===t&&"ordinal"===e.type&&rz(m.discreteChannelCannotEncode(t,"ordinal")),"ordinal";if(t in f$){if(SF(["rect","bar","image","rule"],n))return"band"}else if("arc"===n&&t in g$)return"band";return void 0!==e.band||tB(e)&&(null===(r=e.axis)||void 0===r?void 0:r.tickBand)?"band":"point";case"temporal":return ZM(t)?"time":"discrete"===k$(t)?(rz(m.discreteChannelCannotEncode(t,"temporal")),"ordinal"):qL(e)&&e.timeUnit&&vz(e.timeUnit).utc?"utc":"time";case"quantitative":return ZM(t)?qL(e)&&D$(e.bin)?"bin-ordinal":"linear":"discrete"===k$(t)?(rz(m.discreteChannelCannotEncode(t,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(m.invalidFieldType(e.type))}(e,n,r),{type:s}=t;return S$(e)?void 0!==s?function(t,e){if(!S$(t))return!1;switch(t){case"x":case"y":case LM:case zM:return nL(e)||SF(["band","point"],e);case qM:case"strokeWidth":case"opacity":case"fillOpacity":case"strokeOpacity":case"angle":return nL(e)||rL(e)||SF(["band","point","ordinal"],e);case jM:case UM:case VM:return"band"!==e;case"strokeDash":return"ordinal"===e||rL(e);case WM:return"ordinal"===e}}(e,s)?qL(n)&&(o=s,!(SF([Lz,jz],a=n.type)?void 0===o||tL(o):a===Bz?SF(["time","utc",void 0],o):a!==zz||SF(["log","pow","sqrt","symlog","quantile","quantize","threshold","linear",void 0],o)))?(rz(m.scaleTypeNotWorkWithFieldDef(s,i)),i):s:(rz(m.scaleTypeNotWorkWithChannel(e,s,i)),i):i:null;var o,a}(o,i,s,n);r[i]=new eH(t.scaleName(i+"",!0),{value:e,explicit:o.type===e})}return r},{})}(e):function(e){var n;const r=e.component.scales={},i={},s=e.component.resolve;for(const o of e.children){t(o);for(const t of IF(o.component.scales))if(s.scale[t]=null!==(n=s.scale[t])&&void 0!==n?n:LW(t,e),"shared"===s.scale[t]){const e=i[t],n=o.component.scales[t].getWithExplicit("type");e?Wz(e.value,n.value)?i[t]=mU(e,n,"type","scale",hH):(s.scale[t]="independent",delete i[t]):i[t]=n}}for(const t of IF(i)){const n=e.scaleName(t,!0);r[t]=new eH(n,i[t]);for(const r of e.children){const e=r.component.scales[t];e&&(r.renameScale(e.get("name"),n),e.merged=!0)}}return r}(e)})(t),function t(e){fH(e)?function(t){const e=t.component.scales;for(const n of IF(e)){const r=qq(t,n);if(e[n].setWithExplicit("domains",r),Kq(t,n),t.component.data.isFaceted){let e=t;for(;!pH(e)&&e.parent;)e=e.parent;if("shared"===e.component.resolve.scale[n])for(const t of r.value)_z(t)&&(t.data=zq+t.data.replace(zq,""))}}}(e):function(e){for(const r of e.children)t(r);const n=e.component.scales;for(const t of IF(n)){let r,i=null;for(const n of e.children){const e=n.component.scales[t];if(e){r=void 0===r?e.getWithExplicit("domains"):mU(r,e.getWithExplicit("domains"),"domains","scale",Zq);const t=e.get("selectionExtent");i&&t&&i.selection!==t.selection&&rz(m.NEEDS_SAME_SELECTION),i=t}}n[t].setWithExplicit("domains",r),i&&n[t].set("selectionExtent",i,!0)}}(e)}(t);for(const n of aL)aH(t,n);e||uH(t)}(this)}parseProjection(){!function t(e){e.component.projection=fH(e)?function(t){var e;if(t.hasProjection){const n=t.specifiedProjection,r=!(n&&(null!=n.scale||null!=n.translate)),i=r?[t.getSizeSignalRef("width"),t.getSizeSignalRef("height")]:void 0,s=r?function(t){const e=[],{encoding:n}=t;for(const r of[["longitude","latitude"],["longitude2","latitude2"]])(mB(n[r[0]])||mB(n[r[1]]))&&e.push({signal:t.getName("geojson_"+e.length)});return t.channelHasField(WM)&&t.typedFieldDef(WM).type===Uz&&e.push({signal:t.getName("geojson_"+e.length)}),0===e.length&&e.push(t.requestDataName(CU.Main)),e}(t):void 0;return new sq(t.projectionName(!0),Object.assign(Object.assign({},null!==(e=t.config.projection)&&void 0!==e?e:{}),null!=n?n:{}),i,s)}}(e):function(e){if(0===e.children.length)return;let n;for(const i of e.children)t(i);const r=EF(e.children,t=>{const e=t.component.projection;if(e){if(n){const t=function(t,e){const n=EF(iq,n=>!ze(t.explicit,n)&&!ze(e.explicit,n)||!(!ze(t.explicit,n)||!ze(e.explicit,n)||xF(t.get(n))!==xF(e.get(n))));if(xF(t.size)===xF(e.size)){if(n)return t;if(xF(t.explicit)===xF({}))return e;if(xF(e.explicit)===xF({}))return t}return null}(n,e);return t&&(n=t),!!t}return n=e,!0}return!0});if(n&&r){const t=e.projectionName(!0),r=new sq(t,n.specifiedProjection,n.size,yF(n.data));for(const n of e.children){const e=n.component.projection;e&&(e.isFit&&r.data.push(...n.component.projection.data),n.renameProjection(e.get("name"),t),e.merged=!0)}return r}}(e)}(this)}renameTopLevelLayoutSizeSignal(){"width"!==this.getName("width")&&this.renameSignal(this.getName("width"),"width"),"height"!==this.getName("height")&&this.renameSignal(this.getName("height"),"height")}parseLegends(){!function t(e){const n=fH(e)?function(t){const{encoding:e}=t,n={};for(const r of[jM,...dj]){const i=mB(e[r]);i&&t.getScaleComponent(r)&&(r===WM&&qL(i)&&i.type===Uz||(n[r]=JW(t,r)))}return n}(e):function(e){const{legends:n,resolve:r}=e.component;for(const i of e.children){t(i);for(const t of IF(i.component.legends))r.legend[t]=BW(e.component.resolve,t),"shared"===r.legend[t]&&(n[t]=tq(n[t],i.component.legends[t]),n[t]||(r.legend[t]="independent",delete n[t]))}for(const t of IF(n))for(const n of e.children)n.component.legends[t]&&"shared"===r.legend[t]&&delete n.component.legends[t];return n}(e);return e.component.legends=n,n}(this)}assembleGroupStyle(){var t,e;if("unit"===this.type||"layer"===this.type)return null!==(e=null===(t=this.view)||void 0===t?void 0:t.style)&&void 0!==e?e:"cell"}assembleEncodeFromView(t){const e=sF(t,["style"]),n={};for(const r of IF(e)){const t=e[r];void 0!==t&&(n[r]=AB(t))}return n}assembleGroupEncodeEntry(t){let e={};return this.view&&(e=this.assembleEncodeFromView(this.view)),t||(this.description&&(e.description=AB(this.description)),"unit"!==this.type&&"layer"!==this.type)?OF(e)?void 0:e:Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},null!=e?e:{})}assembleLayout(){if(!this.layout)return;const t=this.layout,{spacing:e}=t,n=sF(t,["spacing"]),{component:r,config:i}=this,s=function(t,e){const n={};for(const r of JM){const i=t[r];if(null==i?void 0:i.facetFieldDef){const{titleAnchor:t,titleOrient:s}=xW(["titleAnchor","titleOrient"],i.facetFieldDef,e,r),o=vW(r,s),a=OW(t,o);void 0!==a&&(n[o]=a)}}return OF(n)?void 0:n}(r.layoutHeaders,i);return Object.assign(Object.assign(Object.assign({padding:e},this.assembleDefaultLayout()),n),s?{titleBand:s}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:t}=this.component;let e=[];for(const n of JM)t[n].title&&e.push(SW(this,n));for(const n of _W)e=e.concat(kW(this,n));return e}assembleAxes(){return function(t,e){const{x:n=[],y:r=[]}=t;return[...n.map(t=>nW(t,"grid",e)),...r.map(t=>nW(t,"grid",e)),...n.map(t=>nW(t,"main",e)),...r.map(t=>nW(t,"main",e))].filter(t=>t)}(this.component.axes,this.config)}assembleLegends(){return nq(this)}assembleProjections(){return gH(this)||mH(this)?function(t){return t.children.reduce((t,e)=>t.concat(e.assembleProjections()),rq(t))}(this):rq(this)}assembleTitle(){var t,e,n;const r=null!==(t=this.title)&&void 0!==t?t:{},{encoding:i}=r,s=sF(r,["encoding"]),o=Object.assign(Object.assign(Object.assign({},EB(this.config.title).nonMark),s),i?{encode:{update:i}}:{});if(o.text)return SF(["unit","layer"],this.type)?SF(["middle",void 0],o.anchor)&&(o.frame=null!==(e=o.frame)&&void 0!==e?e:"group"):o.anchor=null!==(n=o.anchor)&&void 0!==n?n:"start",OF(o)?void 0:o}assembleGroup(t=[]){const e={};(t=t.concat(this.assembleSignals())).length>0&&(e.signals=t);const n=this.assembleLayout();n&&(e.layout=n),e.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const r=!this.parent||pH(this.parent)?function t(e){return gH(e)||mH(e)?e.children.reduce((e,n)=>e.concat(t(n)),tH(e)):tH(e)}(this):[];r.length>0&&(e.scales=r);const i=this.assembleAxes();i.length>0&&(e.axes=i);const s=this.assembleLegends();return s.length>0&&(e.legends=s),e}getName(t){return $F((this.name?this.name+"_":"")+t)}getDataName(t){return this.getName(CU[t].toLowerCase())}requestDataName(t){const e=this.getDataName(t),n=this.component.data.outputNodeRefCounts;return n[e]=(n[e]||0)+1,e}getSizeSignalRef(t){if(pH(this.parent)){const e=v$(PW(t)),n=this.component.scales[e];if(n&&!n.merged){const t=n.get("type"),r=n.get("range");if(tL(t)&&xz(r)){const t=n.get("name"),r=Qq(Jq(this,e));return r?{signal:$W(t,n,iB({aggregate:"distinct",field:r},{expr:"datum"}))}:(rz(m.unknownField(e)),null)}}}return{signal:this.signalNameMap.get(this.getName(t))}}lookupDataSource(t){const e=this.component.data.outputNodes[t];return e?e.getSource():t}getSignalName(t){return this.signalNameMap.get(t)}renameSignal(t,e){this.signalNameMap.rename(t,e)}renameScale(t,e){this.scaleNameMap.rename(t,e)}renameProjection(t,e){this.projectionNameMap.rename(t,e)}scaleName(t,e){return e?this.getName(t):i$(t)&&S$(t)&&this.component.scales[t]||this.scaleNameMap.has(this.getName(t))?this.scaleNameMap.get(this.getName(t)):void 0}projectionName(t){return t?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(t){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const e=this.component.scales[t];return e&&!e.merged?e:this.parent?this.parent.getScaleComponent(t):void 0}getSelectionComponent(t,e){let n=this.component.selection[t];if(!n&&this.parent&&(n=this.parent.getSelectionComponent(t,e)),!n)throw new Error(m.selectionNotFound(e));return n}hasAxisOrientSignalRef(){var t,e;return(null===(t=this.component.axes.x)||void 0===t?void 0:t.some(t=>t.hasOrientSignalRef()))||(null===(e=this.component.axes.y)||void 0===e?void 0:e.some(t=>t.hasOrientSignalRef()))}}class vH extends yH{vgField(t,e={}){const n=this.fieldDef(t);if(n)return iB(n,e)}reduceFieldDef(t,e){return WB(this.getMapping(),(e,n,r)=>{const i=pB(n);return i?t(e,i,r):e},e)}forEachFieldDef(t,e){VB(this.getMapping(),(e,n)=>{const r=pB(e);r&&t(r,n)},e)}}class bH extends gV{constructor(t,e){var n,r,i;super(t),this.transform=e,this.transform=yF(e);const s=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=s[0])&&void 0!==r?r:"value",null!==(i=s[1])&&void 0!==i?i:"density"]}clone(){return new bH(null,yF(this.transform))}dependentFields(){var t;return new Set([this.transform.density,...null!==(t=this.transform.groupby)&&void 0!==t?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"DensityTransform "+_F(this.transform)}assemble(){const t=this.transform,{density:e}=t,n=sF(t,["density"]);return Object.assign({type:"kde",field:e},n)}}class xH extends gV{constructor(t,e){super(t),this.filter=e}clone(){return new xH(null,Object.assign({},this.filter))}static make(t,e){const{config:n,mark:r,markDef:i}=e;if("filter"!==OB("invalid",i,n))return null;const s=e.reduceFieldDef((t,n,i)=>{const s=S$(i)&&e.getScaleComponent(i);return s&&eL(s.get("type"))&&"count"!==n.aggregate&&!vM(r)&&(t[n.field]=n),t},{});return IF(s).length?new xH(t,s):null}dependentFields(){return new Set(IF(this.filter))}producedFields(){return new Set}hash(){return"FilterInvalid "+_F(this.filter)}assemble(){const t=IF(this.filter).reduce((t,e)=>{const n=this.filter[e],r=iB(n,{expr:"datum"});return null!==n&&("temporal"===n.type?t.push(`(isDate(${r}) || (isValid(${r}) && isFinite(+${r})))`):"quantitative"===n.type&&(t.push(`isValid(${r})`),t.push(`isFinite(+${r})`))),t},[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null}}class _H extends gV{constructor(t,e){super(t),this.transform=e,this.transform=yF(e);const{flatten:n,as:r=[]}=this.transform;this.transform.as=n.map((t,e)=>{var n;return null!==(n=r[e])&&void 0!==n?n:t})}clone(){return new _H(this.parent,yF(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return"FlattenTransform "+_F(this.transform)}assemble(){const{flatten:t,as:e}=this.transform;return{type:"flatten",fields:t,as:e}}}class wH extends gV{constructor(t,e){var n,r,i;super(t),this.transform=e,this.transform=yF(e);const s=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=s[0])&&void 0!==r?r:"key",null!==(i=s[1])&&void 0!==i?i:"value"]}clone(){return new wH(null,yF(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return"FoldTransform "+_F(this.transform)}assemble(){const{fold:t,as:e}=this.transform;return{type:"fold",fields:t,as:e}}}class SH extends gV{constructor(t,e,n,r){super(t),this.fields=e,this.geojson=n,this.signal=r}clone(){return new SH(null,yF(this.fields),this.geojson,this.signal)}static parseAll(t,e){if(e.component.projection&&!e.component.projection.isFit)return t;let n=0;for(const r of[["longitude","latitude"],["longitude2","latitude2"]]){const i=r.map(t=>{const n=mB(e.encoding[t]);return qL(n)?n.field:GL(n)?{expr:""+n.datum}:QL(n)?{expr:""+n.value}:void 0});(i[0]||i[1])&&(t=new SH(t,i,null,e.getName("geojson_"+n++)))}if(e.channelHasField(WM)){const r=e.typedFieldDef(WM);r.type===Uz&&(t=new SH(t,null,r.field,e.getName("geojson_"+n++)))}return t}dependentFields(){var t;const e=(null!==(t=this.fields)&&void 0!==t?t:[]).filter(Ye);return new Set([...this.geojson?[this.geojson]:[],...e])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${_F(this.fields)}`}assemble(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}class CH extends gV{constructor(t,e,n,r){super(t),this.projection=e,this.fields=n,this.as=r}clone(){return new CH(null,this.projection,yF(this.fields),yF(this.as))}static parseAll(t,e){if(!e.projectionName())return t;for(const n of[["longitude","latitude"],["longitude2","latitude2"]]){const r=n.map(t=>{const n=mB(e.encoding[t]);return qL(n)?n.field:GL(n)?{expr:""+n.datum}:QL(n)?{expr:""+n.value}:void 0}),i="longitude2"===n[0]?"2":"";(r[0]||r[1])&&(t=new CH(t,e.projectionName(),r,[e.getName("x"+i),e.getName("y"+i)]))}return t}dependentFields(){return new Set(this.fields.filter(Ye))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${_F(this.fields)} ${_F(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class EH extends gV{constructor(t,e){super(t),this.transform=e}clone(){return new EH(null,yF(this.transform))}dependentFields(){var t;return new Set([this.transform.impute,this.transform.key,...null!==(t=this.transform.groupby)&&void 0!==t?t:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(t){const{start:e=0,stop:n,step:r}=t;return{signal:`sequence(${[e,n,...r?[r]:[]].join(",")})`}}static makeFromTransform(t,e){return new EH(t,e)}static makeFromEncoding(t,e){const n=e.encoding,r=n.x,i=n.y;if(qL(r)&&qL(i)){const s=r.impute?r:i.impute?i:void 0;if(void 0===s)return;const o=r.impute?i:i.impute?r:void 0,{method:a,value:l,frame:u,keyvals:c}=s.impute,h=qB(e.mark,n);return new EH(t,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:s.field,key:o.field},a?{method:a}:{}),void 0!==l?{value:l}:{}),u?{frame:u}:{}),void 0!==c?{keyvals:c}:{}),h.length?{groupby:h}:{}))}return null}hash(){return"Impute "+_F(this.transform)}assemble(){const{impute:t,key:e,keyvals:n,method:r,groupby:i,value:s,frame:o=[null,null]}=this.transform,a=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:t,key:e},n?{keyvals:(l=n,void 0!==(null==l?void 0:l.stop)?this.processSequence(n):n)}:{}),{method:"value"}),i?{groupby:i}:{}),{value:r&&"value"!==r?null:s});var l;return r&&"value"!==r?[a,Object.assign({type:"window",as:[`imputed_${t}_value`],ops:[r],fields:[t],frame:o,ignorePeers:!1},i?{groupby:i}:{}),{type:"formula",expr:`datum.${t} === null ? datum.imputed_${t}_value : datum.${t}`,as:t}]:[a]}}class kH extends gV{constructor(t,e){var n,r,i;super(t),this.transform=e,this.transform=yF(e);const s=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=s[0])&&void 0!==r?r:e.on,null!==(i=s[1])&&void 0!==i?i:e.loess]}clone(){return new kH(null,yF(this.transform))}dependentFields(){var t;return new Set([this.transform.loess,this.transform.on,...null!==(t=this.transform.groupby)&&void 0!==t?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"LoessTransform "+_F(this.transform)}assemble(){const t=this.transform,{loess:e,on:n}=t,r=sF(t,["loess","on"]);return Object.assign({type:"loess",x:n,y:e},r)}}class AH extends gV{constructor(t,e,n){super(t),this.transform=e,this.secondary=n}clone(){return new AH(null,yF(this.transform),this.secondary)}static make(t,e,n,r){const i=e.component.data.sources,{from:s}=n;let o=null;if(function(t){return"data"in t}(s)){let t=jH(s.data,i);t||(t=new cq(s.data),i.push(t));const n=e.getName("lookup_"+r);o=new yV(t,n,CU.Lookup,e.component.data.outputNodeRefCounts),e.component.data.outputNodes[n]=o}else if(function(t){return"selection"in t}(s)){const t=s.selection;if(n=Object.assign({as:t},n),o=e.getSelectionComponent($F(t),t).materialized,!o)throw new Error(m.noSameUnitLookup(t))}return new AH(t,n,o.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?Ce(this.transform.as):this.transform.from.fields)}hash(){return"Lookup "+_F({transform:this.transform,secondary:this.secondary})}assemble(){let t;if(this.transform.from.fields)t=Object.assign({values:this.transform.from.fields},this.transform.as?{as:Ce(this.transform.as)}:{});else{let e=this.transform.as;Ye(e)||(rz(m.NO_FIELDS_NEEDS_AS),e="_lookup"),t={as:[e]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},t),this.transform.default?{default:this.transform.default}:{})}}class DH extends gV{constructor(t,e){var n,r,i;super(t),this.transform=e,this.transform=yF(e);const s=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=s[0])&&void 0!==r?r:"prob",null!==(i=s[1])&&void 0!==i?i:"value"]}clone(){return new DH(null,yF(this.transform))}dependentFields(){var t;return new Set([this.transform.quantile,...null!==(t=this.transform.groupby)&&void 0!==t?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"QuantileTransform "+_F(this.transform)}assemble(){const t=this.transform,{quantile:e}=t,n=sF(t,["quantile"]);return Object.assign({type:"quantile",field:e},n)}}class NH extends gV{constructor(t,e){var n,r,i;super(t),this.transform=e,this.transform=yF(e);const s=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=s[0])&&void 0!==r?r:e.on,null!==(i=s[1])&&void 0!==i?i:e.regression]}clone(){return new NH(null,yF(this.transform))}dependentFields(){var t;return new Set([this.transform.regression,this.transform.on,...null!==(t=this.transform.groupby)&&void 0!==t?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"RegressionTransform "+_F(this.transform)}assemble(){const t=this.transform,{regression:e,on:n}=t,r=sF(t,["regression","on"]);return Object.assign({type:"regression",x:n,y:e},r)}}class TH extends gV{constructor(t,e){super(t),this.transform=e}clone(){return new TH(null,yF(this.transform))}addDimensions(t){var e;this.transform.groupby=AF((null!==(e=this.transform.groupby)&&void 0!==e?e:[]).concat(t),t=>t)}producedFields(){}dependentFields(){var t;return new Set([this.transform.pivot,this.transform.value,...null!==(t=this.transform.groupby)&&void 0!==t?t:[]])}hash(){return"PivotTransform "+_F(this.transform)}assemble(){const{pivot:t,value:e,groupby:n,limit:r,op:i}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:t,value:e},void 0!==r?{limit:r}:{}),void 0!==i?{op:i}:{}),void 0!==n?{groupby:n}:{})}}class OH extends gV{constructor(t,e){super(t),this.transform=e}clone(){return new OH(null,yF(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return"SampleTransform "+_F(this.transform)}assemble(){return{type:"sample",size:this.transform.sample}}}function IH(t){let e=0;return function n(r,i){var s;if(r instanceof cq&&!r.isGenerator&&!yU(r.data)&&(t.push(i),i={name:null,source:i.name,transform:[]}),r instanceof _q&&(r.parent instanceof cq&&!i.source?(i.format=Object.assign(Object.assign({},null!==(s=i.format)&&void 0!==s?s:{}),{parse:r.assembleFormatParse()}),i.transform.push(...r.assembleTransforms(!0))):i.transform.push(...r.assembleTransforms())),r instanceof vq){i.name||(i.name="data_"+e++),!i.source||i.transform.length>0?(t.push(i),r.data=i.name):r.data=i.source;for(const e of r.assemble())t.push(e)}else switch((r instanceof hq||r instanceof dq||r instanceof xH||r instanceof ZV||r instanceof gW||r instanceof CH||r instanceof SH||r instanceof yq||r instanceof AH||r instanceof Eq||r instanceof Sq||r instanceof wH||r instanceof _H||r instanceof bH||r instanceof kH||r instanceof DH||r instanceof NH||r instanceof wq||r instanceof OH||r instanceof TH)&&i.transform.push(r.assemble()),(r instanceof uq||r instanceof vV||r instanceof EH||r instanceof Cq)&&i.transform.push(...r.assemble()),r instanceof yV&&(i.source&&0===i.transform.length?r.setSource(i.source):r.parent instanceof yV?r.setSource(i.name):(i.name||(i.name="data_"+e++),r.setSource(i.name),1===r.numChildren()&&(t.push(i),i={name:null,source:i.name,transform:[]}))),r.numChildren()){case 0:r instanceof yV&&(!i.source||i.transform.length>0)&&t.push(i);break;case 1:n(r.children[0],i);break;default:{i.name||(i.name="data_"+e++);let s=i.name;!i.source||i.transform.length>0?t.push(i):s=i.source;for(const t of r.children)n(t,{name:null,source:s,transform:[]});break}}}}function RH(t,e){var n;const{facet:r,config:i,child:s,component:o}=t;if(t.channelHasField(e)){const a=r[e],l=bW("title",null,i,e);let u=cB(a,i,{allowDisabling:!0,includeDefault:void 0===l||!!l});s.component.layoutHeaders[e].title&&(u=Jt(u)?u.join(", "):u,u+=" / "+s.component.layoutHeaders[e].title,s.component.layoutHeaders[e].title=null);const c=bW("labelOrient",a,i,e),h=HF((null!==(n=a.header)&&void 0!==n?n:{}).labels,i.header.labels,!0),d=SF(["bottom","right"],c)?"footer":"header";o.layoutHeaders[e]={title:u,facetFieldDef:a,[d]:"facet"===e?[]:[FH(t,e,h)]}}}function FH(t,e,n){const r="row"===e?"height":"width";return{labels:n,sizeSignal:t.child.component.layoutSize.get(r)?t.child.getSizeSignalRef(r):void 0,axes:[]}}function MH(t,e){var n;const{child:r}=t;if(r.component.axes[e]){const{layoutHeaders:s,resolve:o}=t.component;if(o.axis[e]=BW(o,e),"shared"===o.axis[e]){const o="x"===e?"column":"row",a=s[o];for(const s of r.component.axes[e]){const e="top"===(i=s.get("orient"))||"left"===i||bz(i)?"header":"footer";a[e]=null!==(n=a[e])&&void 0!==n?n:[FH(t,o,!1)];const r=nW(s,"main",t.config,{header:!0});r&&a[e][0].axes.push(r),s.mainExtracted=!0}}}var i}function $H(t){for(const e of t.children)e.parseLayoutSize()}function PH(t,e){const n=PW(e),r=v$(n),i=t.component.resolve,s=t.component.layoutSize;let o;for(const a of t.children){const t=a.component.layoutSize.getWithExplicit(n),e=i.scale[r];if("independent"===e&&"step"===t.value){o=void 0;break}if(o){if("independent"===e&&o.value!==t.value){o=void 0;break}o=mU(o,t,n,"")}else o=t}if(o){for(const r of t.children)t.renameSignal(r.getName(n),t.getName(e)),r.component.layoutSize.set(n,"merged",!1);s.setWithExplicit(e,o)}else s.setWithExplicit(e,{explicit:!1,value:void 0})}function zH(t,e){const n=t.config,r=t.getScaleComponent("width"===e?"x":"y");if(r){const t=r.get("type"),i=r.get("range");if(tL(t)){const t=kj(n.view,e);return xz(i)||_j(t)?"step":t}return Cj(n.view,e)}if(t.hasProjection||"arc"===t.mark)return Cj(n.view,e);{const t=kj(n.view,e);return _j(t)?t.step:t}}function LH(t,e,n){return iB(e,Object.assign({suffix:"by_"+iB(t)},null!=n?n:{}))}class BH extends vH{constructor(t,e,n,r){super(t,"facet",e,n,r,t.resolve),this.child=sG(t.spec,this,this.getName("child"),void 0,r),this.children=[this.child],this.facet=this.initFacet(t.facet,r)}initFacet(t,e){return ML(t)?WB(t,(t,n,r)=>SF([$M,PM],r)?void 0===n.field?(rz(m.emptyFieldDef(n,r)),t):(t[r]=gB(n,r,e),t):(rz(m.incompatibleChannel(r,"facet")),t),{}):{facet:gB(t,"facet",e)}}channelHasField(t){return!!this.facet[t]}fieldDef(t){return this.facet[t]}parseData(){this.component.data=UH(this),this.child.parseData()}parseLayoutSize(){$H(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),function(t){for(const e of JM)RH(t,e);MH(t,"x"),MH(t,"y")}(this)}assembleSelectionTopLevelSignals(t){return this.child.assembleSelectionTopLevelSignals(t)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(t){return this.child.assembleSelectionData(t)}getHeaderLayoutMixins(){var t,e,n;const r={};for(const i of JM)for(const s of wW){const o=this.component.layoutHeaders[i],a=o[s],{facetFieldDef:l}=o;if(l){const e=bW("titleOrient",l,this.config,i);if(SF(["right","bottom"],e)){const n=vW(i,e);r.titleAnchor=null!==(t=r.titleAnchor)&&void 0!==t?t:{},r.titleAnchor[n]="end"}}if(null==a?void 0:a[0]){const t="row"===i?"height":"width",a="header"===s?"headerBand":"footerBand";"facet"===i||this.child.component.layoutSize.get(t)||(r[a]=null!==(e=r[a])&&void 0!==e?e:{},r[a][i]=.5),o.title&&(r.offset=null!==(n=r.offset)&&void 0!==n?n:{},r.offset["row"===i?"rowTitle":"columnTitle"]=10)}}return r}assembleDefaultLayout(){const{column:t,row:e}=this.facet,n=t?this.columnDistinctSignal():e?1:void 0;let r="all";return(e||"independent"!==this.component.resolve.scale.x)&&(t||"independent"!==this.component.resolve.scale.y)||(r="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),n?{columns:n}:{}),{bounds:"full",align:r})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof BH))return{signal:`length(data('${this.getName("column_domain")}'))`}}assembleGroup(t){return this.parent&&this.parent instanceof BH?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:iB(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(t)):super.assembleGroup(t)}getCardinalityAggregateForChild(){const t=[],e=[],n=[];if(this.child instanceof BH){if(this.child.channelHasField("column")){const r=iB(this.child.facet.column);t.push(r),e.push("distinct"),n.push("distinct_"+r)}}else for(const r of p$){const i=this.child.component.scales[r];if(i&&!i.merged){const s=i.get("type"),o=i.get("range");if(tL(s)&&xz(o)){const i=Qq(Jq(this.child,r));i?(t.push(i),e.push("distinct"),n.push("distinct_"+i)):rz(m.unknownField(r))}}}return{fields:t,ops:e,as:n}}assembleFacet(){const{name:t,data:e}=this.component.data.facetRoot,{row:n,column:r}=this.facet,{fields:i,ops:s,as:o}=this.getCardinalityAggregateForChild(),a=[];for(const u of JM){const t=this.facet[u];if(t){a.push(iB(t));const{bin:e,sort:l}=t;if(D$(e)&&a.push(iB(t,{binSuffix:"end"})),RL(l)){const{field:e,op:a=NL}=l,u=LH(t,l);n&&r?(i.push(u),s.push("max"),o.push(u)):(i.push(e),s.push(a),o.push(u))}else if(Jt(l)){const e=yW(t,u);i.push(e),s.push("max"),o.push(e)}}}const l=!!n&&!!r;return Object.assign({name:t,data:e,groupby:a},l||i.length>0?{aggregate:Object.assign(Object.assign({},l?{cross:l}:{}),i.length?{fields:i,ops:s,as:o}:{})}:{})}facetSortFields(t){const{facet:e}=this,n=e[t];return n?RL(n.sort)?[LH(n,n.sort,{expr:"datum"})]:Jt(n.sort)?[yW(n,t,{expr:"datum"})]:[iB(n,{expr:"datum"})]:[]}facetSortOrder(t){const{facet:e}=this,n=e[t];if(n){const{sort:t}=n;return[(RL(t)?t.order:!Jt(t)&&t)||"ascending"]}return[]}assembleLabelTitle(){const{facet:t,config:e}=this;if(t.facet)return DW(t.facet,"facet",e);const n={row:["top","bottom"],column:["left","right"]};for(const r of _W)if(t[r]){const i=bW("labelOrient",t[r],e,r);if(SF(n[r],i))return DW(t[r],r,e)}}assembleMarks(){const{child:t}=this,e=function(t){const e=[],n=IH(e);for(const r of t.children)n(r,{source:t.name,name:null,transform:[]});return e}(this.component.data.facetRoot),n=t.assembleGroupEncodeEntry(!1),r=this.assembleLabelTitle()||t.assembleTitle(),i=t.assembleGroupStyle();return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},r?{title:r}:{}),i?{style:i}:{}),{from:{facet:this.assembleFacet()},sort:{field:JM.map(t=>this.facetSortFields(t)).flat(),order:JM.map(t=>this.facetSortOrder(t)).flat()}}),e.length>0?{data:e}:{}),n?{encode:{update:n}}:{}),t.assembleGroup(function(t,e){if(t.component.selection&&IF(t.component.selection).length){const n=nn(t.getName("cell"));e.unshift({name:"facet",value:{},on:[{events:$O("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return $V(e)}(this,[])))]}getMapping(){return this.facet}}function jH(t,e){var n,r,i,s,o,a,l,u,c,h;for(const d of e){const e=d.data;if(!(t.name&&d.hasName()&&t.name!==d.dataName||(null===(n=t.format)||void 0===n?void 0:n.mesh)&&(null===(r=e.format)||void 0===r?void 0:r.feature)||((null===(i=t.format)||void 0===i?void 0:i.feature)||(null===(s=e.format)||void 0===s?void 0:s.feature))&&(null===(o=t.format)||void 0===o?void 0:o.feature)!==(null===(a=e.format)||void 0===a?void 0:a.feature)||((null===(l=t.format)||void 0===l?void 0:l.mesh)||(null===(u=e.format)||void 0===u?void 0:u.mesh))&&(null===(c=t.format)||void 0===c?void 0:c.mesh)!==(null===(h=e.format)||void 0===h?void 0:h.mesh)))if(vU(t)&&vU(e)){if(gF(t.values,e.values))return d}else if(yU(t)&&yU(e)){if(t.url===e.url)return d}else if(bU(t)&&t.name===d.dataName)return d}return null}function UH(t){var e,n,r,i,s,o,a,l,u,c;let h=function(t,e){if(t.data||!t.parent){if(null===t.data){const t=new cq({values:[]});return e.push(t),t}const n=jH(t.data,e);if(n)return xU(t.data)||(n.data.format=function(t,...e){for(const n of e)kF(t,null!=n?n:{});return t}({},t.data.format,n.data.format)),!n.hasName()&&t.data.name&&(n.dataName=t.data.name),n;{const n=new cq(t.data);return e.push(n),n}}return t.parent.component.data.facetRoot?t.parent.component.data.facetRoot:t.parent.component.data.main}(t,t.component.data.sources);const{outputNodes:d,outputNodeRefCounts:f}=t.component.data,p=t.parent?t.parent.component.data.ancestorParse.clone():new gU,g=t.data;xU(g)?(_U(g)?h=new dq(h,g.sequence):SU(g)&&(h=new hq(h,g.graticule)),p.parseNothing=!0):null===(null===(e=null==g?void 0:g.format)||void 0===e?void 0:e.parse)&&(p.parseNothing=!0),h=null!==(n=_q.makeExplicit(h,t,p))&&void 0!==n?n:h,h=new wq(h);const y=t.parent&&gH(t.parent);(fH(t)||pH(t))&&y&&(h=null!==(r=uq.makeFromEncoding(h,t))&&void 0!==r?r:h),t.transforms.length>0&&(h=function(t,e,n){var r,i;let s=0;for(const o of e.transforms){let a,l=void 0;if($U(o))a=t=new gW(t,o),l="derived";else if(EU(o)){const i=xq(o);a=t=null!==(r=_q.makeWithAncestors(t,{},i,n))&&void 0!==r?r:t,t=new ZV(t,e,o.filter)}else if(PU(o))a=t=uq.makeFromTransform(t,o,e),l="number";else if(LU(o))l="date",void 0===n.getWithExplicit(o.field).value&&(t=new _q(t,{[o.field]:l}),n.set(o.field,l,!1)),a=t=vV.makeFromTransform(t,o);else if(BU(o))a=t=yq.makeFromTransform(t,o),l="number",KV(e)&&(t=new wq(t));else if(kU(o))a=t=AH.make(t,e,o,s++),l="derived";else if(RU(o))a=t=new Eq(t,o),l="number";else if(FU(o))a=t=new Sq(t,o),l="number";else if(jU(o))a=t=Cq.makeFromTransform(t,o),l="derived";else if(UU(o))a=t=new wH(t,o),l="derived";else if(MU(o))a=t=new _H(t,o),l="derived";else if(AU(o))a=t=new TH(t,o),l="derived";else if(IU(o))t=new OH(t,o);else if(zU(o))a=t=EH.makeFromTransform(t,o),l="derived";else if(DU(o))a=t=new bH(t,o),l="derived";else if(NU(o))a=t=new DH(t,o),l="derived";else if(TU(o))a=t=new NH(t,o),l="derived";else{if(!OU(o)){rz(m.invalidTransformIgnored(o));continue}a=t=new kH(t,o),l="derived"}if(a&&void 0!==l)for(const t of null!==(i=a.producedFields())&&void 0!==i?i:[])n.set(t,l,!1)}return t}(h,t,p));const v=function(t){const e={};if(fH(t)&&t.component.selection)for(const n of IF(t.component.selection)){const r=t.component.selection[n];for(const t of r.project.items)!t.channel&&qF(t.field)>1&&(e[t.field]="flatten")}return e}(t),b=function(t){const e={};function n(t){var n;_B(t)?e[t.field]="date":"quantitative"===t.type&&Ye(n=t.aggregate)&&SF(["min","max"],n)?e[t.field]="number":qF(t.field)>1?t.field in e||(e[t.field]="flatten"):JL(t)&&RL(t.sort)&&qF(t.sort.field)>1&&(t.sort.field in e||(e[t.sort.field]="flatten"))}if((fH(t)||pH(t))&&t.forEachFieldDef((e,r)=>{if(ZL(e))n(e);else{const i=a$(r),s=t.fieldDef(i);n(Object.assign(Object.assign({},e),{type:s.type}))}}),fH(t)){const{mark:n,markDef:r,encoding:i}=t;if(vM(n)&&!t.encoding.order){const t=i["horizontal"===r.orient?"y":"x"];qL(t)&&"quantitative"===t.type&&!(t.field in e)&&(e[t.field]="number")}}return e}(t);h=null!==(i=_q.makeWithAncestors(h,{},Object.assign(Object.assign({},v),b),p))&&void 0!==i?i:h,fH(t)&&(h=SH.parseAll(h,t),h=CH.parseAll(h,t)),(fH(t)||pH(t))&&(y||(h=null!==(s=uq.makeFromEncoding(h,t))&&void 0!==s?s:h),h=null!==(o=vV.makeFromEncoding(h,t))&&void 0!==o?o:h,h=gW.parseAllForSortIndex(h,t));const x=t.getDataName(CU.Raw),_=new yV(h,x,CU.Raw,f);if(d[x]=_,h=_,fH(t)){const e=yq.makeFromEncoding(h,t);e&&(h=e,KV(t)&&(h=new wq(h))),h=null!==(a=EH.makeFromEncoding(h,t))&&void 0!==a?a:h,h=null!==(l=Cq.makeFromEncoding(h,t))&&void 0!==l?l:h}fH(t)&&(h=null!==(u=xH.make(h,t))&&void 0!==u?u:h);const w=t.getDataName(CU.Main),S=new yV(h,w,CU.Main,f);d[w]=S,h=S,fH(t)&&function(t,e){GV(t,n=>{const r=n.name,i=t.getName("lookup_"+r);t.component.data.outputNodes[i]=n.materialized=new yV(new ZV(e,t,{selection:r}),i,CU.Lookup,t.component.data.outputNodeRefCounts)})}(t,S);let C=null;if(pH(t)){const e=t.getName("facet");h=null!==(c=function(t,e){const{row:n,column:r}=e;if(n&&r){let e=null;for(const i of[n,r])if(RL(i.sort)){const{field:n,op:r=NL}=i.sort;t=e=new Sq(t,{joinaggregate:[{op:r,field:n,as:LH(i,i.sort,{forAs:!0})}],groupby:[iB(i)]})}return e}return null}(h,t.facet))&&void 0!==c?c:h,C=new vq(h,t,e,S.getSource()),d[e]=C}return Object.assign(Object.assign({},t.component.data),{outputNodes:d,outputNodeRefCounts:f,raw:_,main:S,facetRoot:C,ancestorParse:p})}class VH extends yH{constructor(t,e,n,r){var i,s,o,a;super(t,"concat",e,n,r,t.resolve),"shared"!==(null===(s=null===(i=t.resolve)||void 0===i?void 0:i.axis)||void 0===s?void 0:s.x)&&"shared"!==(null===(a=null===(o=t.resolve)||void 0===o?void 0:o.axis)||void 0===a?void 0:a.y)||rz(m.CONCAT_CANNOT_SHARE_AXIS),this.children=this.getChildren(t).map((t,e)=>sG(t,this,this.getName("concat_"+e),void 0,r))}parseData(){this.component.data=UH(this);for(const t of this.children)t.parseData()}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const e of IF(t.component.selection))this.component.selection[e]=t.component.selection[e]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){for(const t of this.children)t.parseAxesAndHeaders()}getChildren(t){return bj(t)?t.vconcat:xj(t)?t.hconcat:t.concat}parseLayoutSize(){!function(t){$H(t);const e=void 0===t.layout.columns?"height":"childHeight";PH(t,1===t.layout.columns?"width":"childWidth"),PH(t,e)}(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(t){return this.children.reduce((t,e)=>e.assembleSelectionTopLevelSignals(t),t)}assembleSignals(){return this.children.forEach(t=>t.assembleSignals()),[]}assembleLayoutSignals(){const t=RW(this);for(const e of this.children)t.push(...e.assembleLayoutSignals());return t}assembleSelectionData(t){return this.children.reduce((t,e)=>e.assembleSelectionData(t),t)}assembleMarks(){return this.children.map(t=>{const e=t.assembleTitle(),n=t.assembleGroupStyle(),r=t.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:t.getName("group")},e?{title:e}:{}),n?{style:n}:{}),r?{encode:{update:r}}:{}),t.assembleGroup())})}assembleDefaultLayout(){const t=this.layout.columns;return Object.assign(Object.assign({},null!=t?{columns:t}:{}),{bounds:"full",align:"each"})}}const WH=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},tM),{labelExpr:1,encode:1}),qH=IF(WH);class HH extends cU{constructor(t={},e={},n=!1){super(),this.explicit=t,this.implicit=e,this.mainExtracted=n}clone(){return new HH(yF(this.explicit),yF(this.implicit),this.mainExtracted)}hasAxisPart(t){return!("axis"!==t&&("grid"===t||"title"===t?!this.get(t):!1===(e=this.get(t))||null===e));var e}hasOrientSignalRef(){return bz(this.explicit.orient)}}const GH={bottom:"top",top:"bottom",left:"right",right:"left"};function YH(t,e){if(!t)return e.map(t=>t.clone());{if(t.length!==e.length)return;const n=t.length;for(let r=0;r<n;r++){const n=t[r],i=e[r];if(!!n!=!!i)return;if(n&&i){const e=n.getWithExplicit("orient"),s=i.getWithExplicit("orient");if(e.explicit&&s.explicit&&e.value!==s.value)return;t[r]=KH(n,i)}}}return t}function KH(t,e){for(const n of qH){const r=mU(t.getWithExplicit(n),e.getWithExplicit(n),n,"axis",(t,e)=>{switch(n){case"title":return zB(t,e);case"gridScale":return{explicit:t.explicit,value:HF(t.value,e.value)}}return pU(t,e,n,"axis")});t.setWithExplicit(n,r)}return t}function XH(t,e,n,r,i){if("disable"===e)return void 0!==n;switch(n=n||{},e){case"titleAngle":case"labelAngle":return t===(bz(n.labelAngle)?n.labelAngle:YF(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(t===mW(r,i))return!0}return t===n[e]}const ZH=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function QH(t,e){var n,r,i;let s=e.axis(t);const o=new HH,a=mB(e.encoding[t]),{mark:l,config:u}=e,c=(null==s?void 0:s.orient)||(null===(n=u["x"===t?"axisX":"axisY"])||void 0===n?void 0:n.orient)||(null===(r=u.axis)||void 0===r?void 0:r.orient)||function(t){return"x"===t?"bottom":"left"}(t),h=e.getScaleComponent(t).get("type"),d=function(t,e,n,r){const i="band"===e?["axisDiscrete","axisBand"]:"point"===e?["axisDiscrete","axisPoint"]:e in Kz?["axisQuantitative"]:"time"===e||"utc"===e?["axisTemporal"]:[],s="x"===t?"axisX":"axisY",o=bz(n)?"axisOrient":"axis"+LF(n),a=[...i,...i.map(t=>s+t.substr(4))],l=["axis",o,s];return{vlOnlyAxisConfig:lW(a,r,t,n),vgAxisConfig:lW(l,r,t,n),axisConfigStyle:uW([...l,...a],r)}}(t,h,c,e.config),f=void 0!==s?!s:cW("disable",u.style,null==s?void 0:s.style,d).configValue;if(o.set("disable",f,void 0!==s),f)return o;s=s||{};const p=function(t,e,n,r,i){const s=null==e?void 0:e.labelAngle;if(void 0!==s)return bz(s)?s:YF(s);{const{configValue:s}=cW("labelAngle",r,null==e?void 0:e.style,i);return void 0!==s?YF(s):"x"!==n||!SF([jz,Lz],t.type)||qL(t)&&t.timeUnit?void 0:270}}(a,s,t,u.style,d),m={fieldOrDatumDef:a,axis:s,channel:t,model:e,scaleType:h,orient:c,labelAngle:p,mark:l,config:u};for(const v of qH){const n=v in hW?hW[v](m):nM(v)?s[v]:void 0,r=void 0!==n,i=XH(n,v,s,e,t);if(r&&i)o.set(v,n,i);else{const{configValue:t,configFrom:e}=nM(v)&&"values"!==v?cW(v,u.style,s.style,d):{},a=void 0!==t;r&&!a?o.set(v,n,i):("vgAxisConfig"!==e||ZH.has(v)&&a||ZF(t)||bz(t))&&o.set(v,t,!1)}}const g=null!==(i=s.encoding)&&void 0!==i?i:{},y=QF.reduce((n,r)=>{var i;if(!o.hasAxisPart(r))return n;const s=zW(null!==(i=g[r])&&void 0!==i?i:{},e),a="labels"===r?function(t,e,n){var r;const{encoding:i,config:s}=t,o=null!==(r=mB(i[e]))&&void 0!==r?r:mB(i[u$(e)]),a=t.axis(e)||{},{format:l,formatType:u}=a;return vL(u)?Object.assign({text:wL({fieldOrDatumDef:o,field:"datum.value",format:l,formatType:u,config:s})},n):n}(e,t,s):s;return void 0===a||OF(a)||(n[r]={update:a}),n},{});return OF(y)||o.set("encode",y,!!s.encoding||void 0!==s.labelAngle),o}function JH(t,e){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},hV(t,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),QU("x",t,{defaultPos:"mid"})),QU("y",t,{defaultPos:"mid"})),KU("size",t)),KU("angle",t)),function(t,e,n){return n?{shape:{value:n}}:KU("shape",t)}(t,0,e))}function tG(t){var e;const{config:n,markDef:r}=t,{orient:i}=r,s="horizontal"===i?"width":"height",o=t.getScaleComponent("horizontal"===i?"x":"y"),a=null!==(e=OB("size",r,n,{vgChannel:s}))&&void 0!==e?e:n.tick.bandSize;if(void 0!==a)return a;{const t=o?o.get("range"):void 0;return t&&xz(t)&&He(t.step)?3*t.step/4:3*Ej(n.view,s)/4}}const eG={arc:{vgMark:"arc",encodeEntry:t=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},hV(t,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),QU("x",t,{defaultPos:"mid"})),QU("y",t,{defaultPos:"mid"})),oV(t,"radius","arc")),oV(t,"theta","arc"))},area:{vgMark:"area",encodeEntry:t=>Object.assign(Object.assign(Object.assign(Object.assign({},hV(t,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),rV("x",t,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"horizontal"===t.markDef.orient})),rV("y",t,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"vertical"===t.markDef.orient})),fV(t))},bar:{vgMark:"rect",encodeEntry:t=>Object.assign(Object.assign(Object.assign({},hV(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),oV(t,"x","bar")),oV(t,"y","bar"))},circle:{vgMark:"symbol",encodeEntry:t=>JH(t,"circle")},geoshape:{vgMark:"shape",encodeEntry:t=>Object.assign({},hV(t,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:t=>{const{encoding:e}=t,n=e.shape;return[Object.assign({type:"geoshape",projection:t.projectionName()},n&&qL(n)&&n.type===Uz?{field:iB(n,{expr:"datum"})}:{})]}},image:{vgMark:"image",encodeEntry:t=>Object.assign(Object.assign(Object.assign(Object.assign({},hV(t,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),oV(t,"x","image")),oV(t,"y","image")),WU(t,"url"))},line:{vgMark:"line",encodeEntry:t=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},hV(t,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),QU("x",t,{defaultPos:"mid"})),QU("y",t,{defaultPos:"mid"})),KU("size",t,{vgChannel:"strokeWidth"})),fV(t))},point:{vgMark:"symbol",encodeEntry:t=>JH(t)},rect:{vgMark:"rect",encodeEntry:t=>Object.assign(Object.assign(Object.assign({},hV(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),oV(t,"x","rect")),oV(t,"y","rect"))},rule:{vgMark:"rule",encodeEntry:t=>{const{markDef:e}=t,n=e.orient;return t.encoding.x||t.encoding.y||t.encoding.latitude||t.encoding.longitude?Object.assign(Object.assign(Object.assign(Object.assign({},hV(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),rV("x",t,{defaultPos:"horizontal"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"vertical"!==n})),rV("y",t,{defaultPos:"vertical"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"horizontal"!==n})),KU("size",t,{vgChannel:"strokeWidth"})):{}}},square:{vgMark:"symbol",encodeEntry:t=>JH(t,"square")},text:{vgMark:"text",encodeEntry:t=>{const{config:e}=t;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},hV(t,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),QU("x",t,{defaultPos:"mid"})),QU("y",t,{defaultPos:"mid"})),WU(t)),KU("size",t,{vgChannel:"fontSize"})),KU("angle",t)),pV("align",function(t,e,n){if(void 0===OB("align",t,n))return"center"}(t.markDef,0,e))),pV("baseline",function(t,e,n){if(void 0===OB("baseline",t,n))return"middle"}(t.markDef,0,e))),QU("radius",t,{defaultPos:null,isMidPoint:!0})),QU("theta",t,{defaultPos:null,isMidPoint:!0}))}},tick:{vgMark:"rect",encodeEntry:t=>{const{config:e,markDef:n}=t,r=n.orient,i="horizontal"===r?"width":"height",s="horizontal"===r?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},hV(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),QU("x",t,{defaultPos:"mid",vgChannel:"xc"})),QU("y",t,{defaultPos:"mid",vgChannel:"yc"})),KU("size",t,{defaultValue:tG(t),vgChannel:i})),{[s]:AB(OB("thickness",n,e))})}},trail:{vgMark:"trail",encodeEntry:t=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},hV(t,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),QU("x",t,{defaultPos:"mid"})),QU("y",t,{defaultPos:"mid"})),KU("size",t)),fV(t))}};function nG(t,e={fromPrefix:""}){const{mark:n,markDef:r,encoding:i,config:s}=t,o=HF(r.clip,function(t){const e=t.getScaleComponent("x"),n=t.getScaleComponent("y");return!!(e&&e.get("selectionExtent")||n&&n.get("selectionExtent"))||void 0}(t),function(t){const e=t.component.projection;return!(!e||e.isFit)||void 0}(t)),a=TB(r),l=i.key,u=function(t){const{encoding:e,stack:n,mark:r,markDef:i,config:s}=t,o=e.order;if(!(!Jt(o)&&QL(o)&&wF(o.value)||!o&&wF(OB("order",i,s)))){if((Jt(o)||qL(o))&&!n)return MB(o,{expr:"datum"});if(vM(r)){const n="horizontal"===i.orient?"y":"x",r=e[n];if(qL(r)){const e=r.sort;return Jt(e)?{field:iB(r,{prefix:n,suffix:"sort_index",expr:"datum"})}:RL(e)?{field:iB({aggregate:BB(t.encoding)?e.op:void 0,field:e.field},{expr:"datum"})}:IL(e)?{field:iB(t.fieldDef(e.encoding),{expr:"datum"}),order:e.order}:null===e?void 0:{field:iB(r,{binSuffix:t.stack&&t.stack.impute?"mid":void 0,expr:"datum"})}}}}}(t),c=function(t){if(!t.component.selection)return null;const e=IF(t.component.selection).length;let n=e,r=t.parent;for(;r&&0===n;)n=IF(r.component.selection).length,r=r.parent;return n?{interactive:e>0}:null}(t),h=OB("aria",r,s),d=eG[n].postEncodingTransform?eG[n].postEncodingTransform(t):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:t.getName("marks"),type:eG[n].vgMark},o?{clip:!0}:{}),a?{style:a}:{}),l?{key:l.field}:{}),u?{sort:u}:{}),c||{}),!1===h?{aria:h}:{}),{from:{data:e.fromPrefix+t.requestDataName(CU.Main)},encode:{update:eG[n].encodeEntry(t)}}),d?{transform:d}:{})]}class rG extends vH{constructor(t,e,n,r={},i){super(t,"unit",e,n,i,void 0,wj(t)?t.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection={},this.children=[];const s=_M(t.mark)?Object.assign({},t.mark):{type:t.mark},o=s.type;void 0===s.filled&&(s.filled=function(t,e,{graticule:n}){if(n)return!1;const r=IB("filled",t,e),i=t.type;return HF(r,i!==uM&&i!==lM&&i!==hM)}(s,i,{graticule:t.data&&SU(t.data)}));const a=this.encoding=function(t,e,n,r){return IF(t).reduce((i,s)=>{if(!i$(s))return rz(m.invalidEncodingChannel(s)),i;const o=t[s];if("angle"!==s||"arc"!==e||t.theta||(rz(m.REPLACE_ANGLE_WITH_THETA),s=LM),!function(t,e,n){const r=function(t,e){return function(t){switch(t){case jM:case UM:case VM:case"description":case"detail":case"key":case"tooltip":case"href":case"order":case"opacity":case"fillOpacity":case"strokeOpacity":case"strokeWidth":case"facet":case $M:case PM:return C$;case"x":case"y":case"latitude":case"longitude":return E$;case"x2":case"y2":case"latitude2":case"longitude2":return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case qM:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case"strokeDash":return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case WM:return{point:"always",geoshape:"always"};case"text":return{text:"always"};case"angle":return{point:"always",square:"always",text:"always"};case"url":return{image:"always"};case LM:case zM:return{text:"always",arc:"always"};case BM:case"radius2":return{arc:"always"}}}(t)[e]}(e,n);if(!r)return!1;if("binned"===r){const n=t["x2"===e?"x":"y"];return!!(qL(n)&&qL(t[e])&&N$(n.bin))}return!0}(t,s,e))return rz(m.incompatibleChannel(s,e)),i;if(s===qM&&"line"===e){const e=pB(t[s]);if(null==e?void 0:e.aggregate)return rz(m.LINE_WITH_VARYING_SIZE),i}if(s===jM&&(n?"fill"in t:"stroke"in t))return rz(m.droppingColor("encoding",{fill:"fill"in t,stroke:"stroke"in t})),i;if("detail"===s||"order"===s&&!Jt(o)&&!QL(o)||"tooltip"===s&&Jt(o))o&&(i[s]=Ce(o).reduce((t,e)=>(qL(e)?t.push(vB(e,s)):rz(m.emptyFieldDef(e,s)),t),[]));else{if("tooltip"===s&&null===o)i[s]=null;else if(!(qL(o)||GL(o)||QL(o)||UL(o)||bz(o)))return rz(m.emptyFieldDef(o,s)),i;i[s]=gB(o,s,r)}return i},{})}(t.encoding||{},o,s.filled,i);this.markDef=function(t,e,n){const r=OB("orient",t,n);if(t.orient=function(t,e,n){switch(t){case uM:case mM:case gM:case dM:case cM:case aM:return}const{x:r,y:i,x2:s,y2:o}=e;switch(t){case oM:if(qL(r)&&(N$(r.bin)||qL(i)&&i.aggregate&&!r.aggregate))return"vertical";if(qL(i)&&(N$(i.bin)||qL(r)&&r.aggregate&&!i.aggregate))return"horizontal";if(o||s){if(n)return n;if(!s&&(qL(r)&&r.type===zz&&!D$(r.bin)||KL(r)))return"horizontal";if(!o&&(qL(i)&&i.type===zz&&!D$(i.bin)||KL(i)))return"vertical"}case hM:if(s&&(!qL(r)||!N$(r.bin))&&o&&(!qL(i)||!N$(i.bin)))return;case sM:if(o)return qL(i)&&N$(i.bin)?"horizontal":"vertical";if(s)return qL(r)&&N$(r.bin)?"vertical":"horizontal";if(t===hM){if(r&&!i)return"vertical";if(i&&!r)return"horizontal"}case lM:case fM:{const e=YL(r),s=YL(i);if(e&&!s)return"tick"!==t?"horizontal":"vertical";if(!e&&s)return"tick"!==t?"vertical":"horizontal";if(e&&s){const e=r,s=i,o=e.type===Bz,a=s.type===Bz;return o&&!a?"tick"!==t?"vertical":"horizontal":!o&&a?"tick"!==t?"horizontal":"vertical":!e.aggregate&&s.aggregate?"tick"!==t?"vertical":"horizontal":e.aggregate&&!s.aggregate?"tick"!==t?"horizontal":"vertical":n||"vertical"}return n||void 0}}return"vertical"}(t.type,e,r),void 0!==r&&r!==t.orient&&rz(m.orientOverridden(t.orient,r)),"bar"===t.type&&t.orient){const r=OB("cornerRadiusEnd",t,n);if(void 0!==r){const n="horizontal"===t.orient&&e.x2||"vertical"===t.orient&&e.y2?["cornerRadius"]:CM[t.orient];for(const e of n)t[e]=r;void 0!==t.cornerRadiusEnd&&delete t.cornerRadiusEnd}}return void 0===OB("opacity",t,n)&&(t.opacity=function(t,e){if(SF([uM,fM,mM,gM],t)&&!BB(e))return.7}(t.type,e)),void 0===OB("cursor",t,n)&&(t.cursor=function(t,e,n){return e.href||t.href||OB("href",t,n)?"pointer":t.cursor}(t,e,n)),t}(s,a,i),this.size=function({encoding:t,size:e}){for(const n of p$){const r=c$(n);_j(e[r])&&YL(t[n])&&(delete e[r],rz(m.stepDropped(r)))}return e}({encoding:a,size:wj(t)?Object.assign(Object.assign(Object.assign({},r),t.width?{width:t.width}:{}),t.height?{height:t.height}:{}):r}),this.stack=Uj(o,a),this.specifiedScales=this.initScales(o,a),this.specifiedAxes=this.initAxes(a),this.specifiedLegends=this.initLegend(a),this.specifiedProjection=t.projection,this.selection=t.selection}get hasProjection(){const{encoding:t}=this,e=this.mark===yM,n=t&&KM.some(e=>XL(t[e]));return e||n}scaleDomain(t){const e=this.specifiedScales[t];return e?e.domain:void 0}axis(t){return this.specifiedAxes[t]}legend(t){return this.specifiedLegends[t]}initScales(t,e){return w$.reduce((t,n)=>{var r;const i=mB(e[n]);return i&&(t[n]=null!==(r=i.scale)&&void 0!==r?r:{}),t},{})}initAxes(t){return p$.reduce((e,n)=>{const r=t[n];if(XL(r)||"x"===n&&XL(t.x2)||"y"===n&&XL(t.y2)){const t=XL(r)?r.axis:void 0;e[n]=t?Object.assign({},t):t}return e},{})}initLegend(t){return x$.reduce((e,n)=>{const r=mB(t[n]);if(r&&function(t){switch(t){case jM:case UM:case VM:case qM:case WM:case"opacity":case"strokeWidth":case"strokeDash":return!0;case"fillOpacity":case"strokeOpacity":case"angle":return!1}}(n)){const t=r.legend;e[n]=t?Object.assign({},t):t}return e},{})}parseData(){this.component.data=UH(this)}parseLayoutSize(){!function(t){const{size:e,component:n}=t;for(const r of p$){const i=c$(r);if(e[i]){const t=e[i];n.layoutSize.set(i,_j(t)?"step":t,!0)}else{const e=zH(t,i);n.layoutSize.set(i,e,!1)}}}(this)}parseSelections(){this.component.selection=function(t,e){var n;const r={},i=t.config.selection;for(const s of IF(null!=e?e:{})){const o=yF(e[s]),a=sF(i[o.type],["fields","encodings"]);for(const t in a)"encodings"===t&&o.fields||"fields"===t&&o.encodings||("mark"===t&&(o[t]=Object.assign(Object.assign({},a[t]),o[t])),void 0!==o[t]&&!0!==o[t]||(o[t]=null!==(n=a[t])&&void 0!==n?n:o[t]));const l=$F(s),u=r[l]=Object.assign(Object.assign({},o),{name:l,events:Ye(o.on)?$O(o.on,"scope"):yF(o.on)});RV(u,n=>{n.has(u)&&n.parse&&n.parse(t,u,o,e[s])})}return r}(this,this.selection)}parseMarkGroup(){this.component.mark=function(t){if(SF([lM,sM,pM],t.mark)){const e=qB(t.mark,t.encoding);if(e.length>0)return function(t,e){return[{name:t.getName("pathgroup"),type:"group",from:{facet:{name:"faceted_path_"+t.requestDataName(CU.Main),data:t.requestDataName(CU.Main),groupby:e}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:nG(t,{fromPrefix:"faceted_path_"})}]}(t,e)}else if(SF([oM],t.mark)){const e=Cz.some(e=>OB(e,t.markDef,t.config));if(t.stack&&!t.fieldDef("size")&&e)return function(t){const[e]=nG(t,{fromPrefix:"stack_group_"}),n=t.scaleName(t.stack.fieldChannel),r=(e={})=>t.vgField(t.stack.fieldChannel,e),i=(t,e)=>`${t}(${[r({prefix:"min",suffix:"start",expr:e}),r({prefix:"max",suffix:"start",expr:e}),r({prefix:"min",suffix:"end",expr:e}),r({prefix:"max",suffix:"end",expr:e})].map(t=>`scale('${n}',${t})`).join(",")})`;let s,o;"x"===t.stack.fieldChannel?(s=Object.assign(Object.assign({},vF(e.encode.update,["y","yc","y2","height",...Cz])),{x:{signal:i("min","datum")},x2:{signal:i("max","datum")},clip:{value:!0}}),o={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},e.encode.update=Object.assign(Object.assign({},bF(e.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(s=Object.assign(Object.assign({},vF(e.encode.update,["x","xc","x2","width"])),{y:{signal:i("min","datum")},y2:{signal:i("max","datum")},clip:{value:!0}}),o={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},e.encode.update=Object.assign(Object.assign({},bF(e.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const u of Cz){const n=IB(u,t.markDef,t.config);e.encode.update[u]?(s[u]=e.encode.update[u],delete e.encode.update[u]):n&&(s[u]=AB(n)),n&&(e.encode.update[u]={value:0})}const a=t.fieldDef(t.stack.groupbyChannel),l=iB(a)?[iB(a)]:[];return((null==a?void 0:a.bin)||(null==a?void 0:a.timeUnit))&&l.push(iB(a,{binSuffix:"end"})),s=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce((n,r)=>{if(e.encode.update[r])return Object.assign(Object.assign({},n),{[r]:e.encode.update[r]});{const e=IB(r,t.markDef,t.config);return void 0!==e?Object.assign(Object.assign({},n),{[r]:AB(e)}):n}},s),s.stroke&&(s.strokeForeground={value:!0},s.strokeOffset={value:0}),[{type:"group",from:{facet:{data:t.requestDataName(CU.Main),name:"stack_group_"+t.requestDataName(CU.Main),groupby:l,aggregate:{fields:[r({suffix:"start"}),r({suffix:"start"}),r({suffix:"end"}),r({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:s},marks:[{type:"group",encode:{update:o},marks:[e]}]}]}(t)}return nG(t)}(this)}parseAxesAndHeaders(){var t;this.component.axes=(t=this,p$.reduce((e,n)=>(t.component.scales[n]&&(e[n]=[QH(n,t)]),e),{}))}assembleSelectionTopLevelSignals(t){return function(t,e){let n=!1;return GV(t,(r,i)=>{const s=r.name,o=nn(s+VV);if(0===e.filter(t=>t.name===s).length){const t="multi"===r.type?", true)":")";e.push({name:r.name,update:`${qV}(${o}, ${nn("global"===r.resolve?"union":r.resolve)}${t}`})}n=!0,i.topLevelSignals&&(e=i.topLevelSignals(t,r,e)),RV(r,n=>{n.topLevelSignals&&(e=n.topLevelSignals(t,r,e))})}),n&&0===e.filter(t=>"unit"===t.name).length&&e.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]}),$V(e)}(this,t)}assembleSignals(){return[...rW(this),...(t=this,e=[],GV(t,(n,r)=>{const i=n.name;let s=r.modifyExpr(t,n);e.push(...r.signals(t,n)),RV(n,r=>{r.signals&&(e=r.signals(t,n,e)),r.modifyExpr&&(s=r.modifyExpr(t,n,s))}),e.push({name:i+"_modify",on:[{events:{signal:n.name+WV},update:`modify(${nn(n.name+VV)}, ${s})`}]})}),$V(e))];var t,e}assembleSelectionData(t){return function(t,e){const n=[...e];return GV(t,e=>{const r={name:e.name+VV};if(e.init){const n=e.project.items.map(t=>sF(t,["signals"])),i=e.init.map(t=>FV(t,!1));r.values="interval"===e.type?[{unit:YV(t,{escape:!1}),fields:n,values:i}]:i.map(e=>({unit:YV(t,{escape:!1}),fields:n,values:e}))}n.filter(t=>t.name===e.name+VV).length||n.push(r)}),n}(this,t)}assembleLayout(){return null}assembleLayoutSignals(){return RW(this)}assembleMarks(){var t;let e=null!==(t=this.component.mark)&&void 0!==t?t:[];return this.parent&&gH(this.parent)||(e=MV(this,e)),e.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(t){return LB(this.encoding,t)}fieldDef(t){return pB(this.encoding[t])}typedFieldDef(t){const e=this.fieldDef(t);return ZL(e)?e:null}}class iG extends yH{constructor(t,e,n,r,i){super(t,"layer",e,n,i,t.resolve,t.view);const s=Object.assign(Object.assign(Object.assign({},r),t.width?{width:t.width}:{}),t.height?{height:t.height}:{});this.children=t.layer.map((t,e)=>{if(Pj(t))return new iG(t,this,this.getName("layer_"+e),s,i);if(EM(t))return new rG(t,this,this.getName("layer_"+e),s,i);throw new Error(m.invalidSpec(t))})}parseData(){this.component.data=UH(this);for(const t of this.children)t.parseData()}parseLayoutSize(){$H(this),PH(this,"width"),PH(this,"height")}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const e of IF(t.component.selection))this.component.selection[e]=t.component.selection[e]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){!function(t){var e;const{axes:n,resolve:r}=t.component,i={top:0,bottom:0,right:0,left:0};for(const s of t.children){s.parseAxesAndHeaders();for(const e of IF(s.component.axes))r.axis[e]=BW(t.component.resolve,e),"shared"===r.axis[e]&&(n[e]=YH(n[e],s.component.axes[e]),n[e]||(r.axis[e]="independent",delete n[e]))}for(const s of p$){for(const o of t.children)if(o.component.axes[s]){if("independent"===r.axis[s]){n[s]=(null!==(e=n[s])&&void 0!==e?e:[]).concat(o.component.axes[s]);for(const t of o.component.axes[s]){const{value:e,explicit:n}=t.getWithExplicit("orient");if(!bz(e)){if(i[e]>0&&!n){const n=GH[e];i[e]>i[n]&&t.set("orient",n,!1)}i[e]++}}}delete o.component.axes[s]}if("independent"===r.axis[s]&&n[s]&&n[s].length>1)for(const t of n[s])t.get("grid")&&!t.explicit.grid&&(t.implicit.grid=!1)}}(this)}assembleSelectionTopLevelSignals(t){return this.children.reduce((t,e)=>e.assembleSelectionTopLevelSignals(t),t)}assembleSignals(){return this.children.reduce((t,e)=>t.concat(e.assembleSignals()),rW(this))}assembleLayoutSignals(){return this.children.reduce((t,e)=>t.concat(e.assembleLayoutSignals()),RW(this))}assembleSelectionData(t){return this.children.reduce((t,e)=>e.assembleSelectionData(t),t)}assembleTitle(){let t=super.assembleTitle();if(t)return t;for(const e of this.children)if(t=e.assembleTitle(),t)return t}assembleLayout(){return null}assembleMarks(){return function(t,e){for(const n of t.children)fH(n)&&(e=MV(n,e));return e}(this,this.children.flatMap(t=>t.assembleMarks()))}assembleLegends(){return this.children.reduce((t,e)=>t.concat(e.assembleLegends()),nq(this))}}function sG(t,e,n,r,i){if(PL(t))return new BH(t,e,n,i);if(Pj(t))return new iG(t,e,n,r,i);if(EM(t))return new rG(t,e,n,r,i);if(function(t){return bj(t)||xj(t)||vj(t)}(t))return new VH(t,e,n,i);throw new Error(m.invalidSpec(t))}function oG(t,e={}){e.logger&&(nz=e.logger),e.fieldTitle&&uB(e.fieldTitle);try{const n=Ij(ne(e.config,t.config)),r=sU(t,n),i=sG(r,null,"",void 0,n);return i.parse(),function(t,e){Lq(t.sources);let n=0,r=0;for(let i=0;i<5&&Vq(t,e,!0);i++)n++;t.sources.map(Oq);for(let i=0;i<5&&Vq(t,e,!1);i++)r++;Lq(t.sources),5===Math.max(n,r)&&rz("Maximum optimization runs(5) reached.")}(i.component.data,i),{spec:function(t,e,n={},r){const i=t.config?function(t){t=yF(t);for(const e of Fj)delete t[e];if(t.axis)for(const e in t.axis)ZF(t.axis[e])&&delete t.axis[e];if(t.legend)for(const e of hj)delete t.legend[e];if(t.mark){for(const e of SM)delete t.mark[e];t.mark.tooltip&&te(t.mark.tooltip)&&delete t.mark.tooltip}for(const e of Rj){for(const r of SM)delete t[e][r];const n=Mj[e];if(n)for(const r of n)delete t[e][r];$j(t,e)}for(const e of IF(uj))delete t[e];!function(t){const{titleMarkConfig:e,subtitleMarkConfig:n,subtitle:r}=EB(t.title);OF(e)||(t.style["group-title"]=Object.assign(Object.assign({},t.style["group-title"]),e)),OF(n)||(t.style["group-subtitle"]=Object.assign(Object.assign({},t.style["group-subtitle"]),n)),OF(r)?delete t.title:t.title=r}(t);for(const e in t)te(t[e])&&OF(t[e])&&delete t[e];return OF(t)?void 0:t}(t.config):void 0,s=[].concat(t.assembleSelectionData([]),function(t,e){var n,r;const i=[],s=IH(i);let o=0;for(const l of t.sources){l.hasName()||(l.dataName="source_"+o++);const t=l.assemble();s(l,t)}for(const l of i)0===l.transform.length&&delete l.transform;let a=0;for(const[l,u]of i.entries())0!==(null!==(n=u.transform)&&void 0!==n?n:[]).length||u.source||i.splice(a++,0,i.splice(l,1)[0]);for(const l of i)for(const e of null!==(r=l.transform)&&void 0!==r?r:[])"lookup"===e.type&&(e.from=t.outputNodes[e.from].getSource());for(const l of i)l.name in e&&(l.values=e[l.name]);return i}(t.component.data,n)),o=t.assembleProjections(),a=t.assembleTitle(),l=t.assembleGroupStyle(),u=t.assembleGroupEncodeEntry(!0);let c=t.assembleLayoutSignals();return c=c.filter(t=>"width"!==t.name&&"height"!==t.name||void 0===t.value||(e[t.name]=+t.value,!1)),Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},t.description?{description:t.description}:{}),e),a?{title:a}:{}),l?{style:l}:{}),u?{encode:{update:u}}:{}),{data:s}),o.length>0?{projections:o}:{}),t.assembleGroup([...c,...t.assembleSelectionTopLevelSignals([])])),i?{config:i}:{}),r?{usermeta:r}:{})}(i,function(t,e,n,r){const i=r.component.layoutSize.get("width"),s=r.component.layoutSize.get("height");if(void 0===e?(e={type:"pad"},r.hasAxisOrientSignalRef()&&(e.resize=!0)):Ye(e)&&(e={type:e}),i&&s&&("fit"===(o=e.type)||"fit-x"===o||"fit-y"===o))if("step"===i&&"step"===s)rz(m.droppingFit()),e.type="pad";else if("step"===i||"step"===s){const t="step"===i?"width":"height";rz(m.droppingFit(v$(t))),e.type=function(t){return t?"fit-"+v$(t):"fit"}("width"===t?"height":"width")}var o;return Object.assign(Object.assign(Object.assign({},1===IF(e).length&&e.type?"pad"===e.type?{}:{autosize:e.type}:{autosize:e}),uU(n)),uU(t))}(t,r.autosize,n,i),t.datasets,t.usermeta),normalized:r}}finally{e.logger&&(nz=ez),e.fieldTitle&&uB(aB)}}var aG=n("gatG"),lG=n.n(aG),uG=n("qw/d"),cG={background:"#333",title:{color:"#fff"},style:{"guide-label":{fill:"#fff"},"guide-title":{fill:"#fff"}},axis:{domainColor:"#fff",gridColor:"#888",tickColor:"#fff"}},hG={background:"#fff",arc:{fill:"#4572a7"},area:{fill:"#4572a7"},line:{stroke:"#4572a7",strokeWidth:2},path:{stroke:"#4572a7"},rect:{fill:"#4572a7"},shape:{stroke:"#4572a7"},symbol:{fill:"#4572a7",strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},dG={arc:{fill:"#30a2da"},area:{fill:"#30a2da"},axis:{domainColor:"#cbcbcb",grid:!0,gridColor:"#cbcbcb",gridWidth:1,labelColor:"#999",labelFontSize:10,titleColor:"#333",tickColor:"#cbcbcb",tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:"#f0f0f0",group:{fill:"#f0f0f0"},legend:{labelColor:"#333",labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:"#333",titleFontSize:14,titlePadding:10},line:{stroke:"#30a2da",strokeWidth:2},path:{stroke:"#30a2da",strokeWidth:.5},rect:{fill:"#30a2da"},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:"#30a2da"},bar:{binSpacing:2,fill:"#30a2da",stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},fG={group:{fill:"#e5e5e5"},arc:{fill:"#000"},area:{fill:"#000"},line:{stroke:"#000"},path:{stroke:"#000"},rect:{fill:"#000"},shape:{stroke:"#000"},symbol:{fill:"#000",size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}};const pG="Benton Gothic Bold, sans-serif",mG={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]};var gG={background:"#ffffff",title:{anchor:"start",color:"#000000",font:pG,fontSize:22,fontWeight:"normal"},arc:{fill:"#82c6df"},area:{fill:"#82c6df"},line:{stroke:"#82c6df",strokeWidth:2},path:{stroke:"#82c6df"},rect:{fill:"#82c6df"},shape:{stroke:"#82c6df"},symbol:{fill:"#82c6df",size:30},axis:{labelFont:"Benton Gothic, sans-serif",labelFontSize:11.5,labelFontWeight:"normal",titleFont:pG,titleFontSize:13,titleFontWeight:"normal"},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:"Benton Gothic, sans-serif",labelFontSize:11.5,symbolType:"square",titleFont:pG,titleFontSize:13,titleFontWeight:"normal"},range:{category:mG["category-6"],diverging:mG["fireandice-6"],heatmap:mG["fire-7"],ordinal:mG["fire-7"],ramp:mG["fire-7"]}},yG={background:"#f9f9f9",arc:{fill:"#ab5787"},area:{fill:"#ab5787"},line:{stroke:"#ab5787"},path:{stroke:"#ab5787"},rect:{fill:"#ab5787"},shape:{stroke:"#ab5787"},symbol:{fill:"#ab5787",size:30},axis:{domainColor:"#979797",domainWidth:.5,gridWidth:.2,labelColor:"#979797",tickColor:"#979797",tickWidth:.2,titleColor:"#979797"},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},vG={background:"#fff",arc:{fill:"#3e5c69"},area:{fill:"#3e5c69"},line:{stroke:"#3e5c69"},path:{stroke:"#3e5c69"},rect:{fill:"#3e5c69"},shape:{stroke:"#3e5c69"},symbol:{fill:"#3e5c69"},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}};const bG={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]};var xG={background:"#FFFFFF",title:{anchor:"start",fontSize:18,font:"Lato"},axisX:{domain:!0,domainColor:"#000000",domainWidth:1,grid:!1,labelFontSize:12,labelFont:"Lato",labelAngle:0,tickColor:"#000000",tickSize:5,titleFontSize:12,titlePadding:10,titleFont:"Lato"},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:"#DEDDDD",gridWidth:1,labelFontSize:12,labelFont:"Lato",labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:"Lato",titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:"Lato",symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:"Lato",orient:"right",offset:10},view:{stroke:"transparent"},range:{category:bG["six-groups-cat-1"],diverging:bG["diverging-colors"],heatmap:bG["diverging-colors"],ordinal:bG["six-groups-seq"],ramp:bG["shades-blue"]},area:{fill:"#1696d2"},rect:{fill:"#1696d2"},line:{color:"#1696d2",stroke:"#1696d2",strokeWidth:5},trail:{color:"#1696d2",stroke:"#1696d2",strokeWidth:0,size:1},path:{stroke:"#1696d2",strokeWidth:.5},point:{filled:!0},text:{font:"Lato",color:"#1696d2",fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:"#1696d2",stroke:null}},arc:{fill:"#1696d2"},shape:{stroke:"#1696d2"},symbol:{fill:"#1696d2",size:30}},_G={arc:{fill:"#3366CC"},area:{fill:"#3366CC"},path:{stroke:"#3366CC"},rect:{fill:"#3366CC"},shape:{stroke:"#3366CC"},symbol:{stroke:"#3366CC"},circle:{fill:"#3366CC"},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:"Arial, sans-serif",fontSize:12},"guide-title":{font:"Arial, sans-serif",fontSize:12},"group-title":{font:"Arial, sans-serif",fontSize:12}},title:{font:"Arial, sans-serif",fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:"#ccc",tickColor:"#ccc",domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}};const wG=uG.version;n("3iBx");const SG="vg-tooltip-element",CG={offsetX:10,offsetY:10,id:SG,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:function(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;")},maxDepth:2};function EG(t,e){return JSON.stringify(t,function(t){const e=[];return function(n,r){if("object"!=typeof r||null===r)return r;const i=e.indexOf(this)+1;return e.length=i,e.length>t?"[Object]":e.indexOf(r)>=0?"[Circular]":(e.push(r),r)}}(e))}class kG{constructor(t){this.options=Object.assign(Object.assign({},CG),t);const e=this.options.id;if(this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const t=document.createElement("style");t.setAttribute("id",this.options.styleId),t.innerHTML=function(t){if(!/^[A-Za-z]+[-:.\w]*$/.test(t))throw new Error("Invalid HTML ID");return"#vg-tooltip-element {\n  visibility: hidden;\n  padding: 8px;\n  position: fixed;\n  z-index: 1000;\n  font-family: sans-serif;\n  font-size: 11px;\n  border-radius: 3px;\n  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);\n  /* The default theme is the light theme. */\n  background-color: rgba(255, 255, 255, 0.95);\n  border: 1px solid #d9d9d9;\n  color: black; }\n  #vg-tooltip-element.visible {\n    visibility: visible; }\n  #vg-tooltip-element h2 {\n    margin-top: 0;\n    margin-bottom: 10px;\n    font-size: 13px; }\n  #vg-tooltip-element table {\n    border-spacing: 0; }\n    #vg-tooltip-element table tr {\n      border: none; }\n      #vg-tooltip-element table tr td {\n        overflow: hidden;\n        text-overflow: ellipsis;\n        padding-top: 2px;\n        padding-bottom: 2px; }\n        #vg-tooltip-element table tr td.key {\n          color: #808080;\n          max-width: 150px;\n          text-align: right;\n          padding-right: 4px; }\n        #vg-tooltip-element table tr td.value {\n          display: block;\n          max-width: 300px;\n          max-height: 7em;\n          text-align: left; }\n  #vg-tooltip-element.dark-theme {\n    background-color: rgba(32, 32, 32, 0.9);\n    border: 1px solid #f5f5f5;\n    color: white; }\n    #vg-tooltip-element.dark-theme td.key {\n      color: #bfbfbf; }\n".toString().replace(SG,t)}(e);const n=document.head;n.childNodes.length>0?n.insertBefore(t,n.childNodes[0]):n.appendChild(t)}this.el=document.getElementById(e),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",e),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el))}tooltipHandler(t,e,n,r){if(null==r||""===r)return void this.el.classList.remove("visible",this.options.theme+"-theme");this.el.innerHTML=function(t,e,n){if(Jt(t))return`[${t.map(t=>e(Ye(t)?t:EG(t,n))).join(", ")}]`;if(te(t)){let r="";const i=t,{title:s}=i,o=Object(v.b)(i,["title"]);s&&(r+=`<h2>${e(s)}</h2>`);const a=Object.keys(o);if(a.length>0){r+="<table>";for(const t of a){let i=o[t];void 0!==i&&(te(i)&&(i=EG(i,n)),r+=`<tr><td class="key">${e(t)}:</td><td class="value">${e(i)}</td></tr>`)}r+="</table>"}return r||"{}"}return e(t)}(r,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",this.options.theme+"-theme");const{x:i,y:s}=function(t,e,n,r){let i=t.clientX+n;i+e.width>window.innerWidth&&(i=+t.clientX-n-e.width);let s=t.clientY+r;return s+e.height>window.innerHeight&&(s=+t.clientY-r-e.height),{x:i,y:s}}(e,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${s}px; left: ${i}px`)}}n.d(e,"vega",(function(){return AG})),n.d(e,"vegaLite",(function(){return DG})),n.d(e,"guessMode",(function(){return MG})),n.d(e,"default",(function(){return $G}));const AG=p;let DG=g;const NG=window;void 0===DG&&NG.vl&&NG.vl.compile&&(DG=NG.vl);const TG={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},OG={vega:"Vega","vega-lite":"Vega-Lite"},IG={vega:p.version,"vega-lite":DG?DG.version:"not available"},RG={vega:t=>t,"vega-lite":(t,e)=>DG.compile(t,{config:e}).spec};function FG(t,e,n,r){const i=`<html><head>${e}</head><body><pre><code class="json">`,s=`</code></pre>${n}</body></html>`,o=window.open("");o.document.write(i+t+s),o.document.title=OG[r]+" JSON Source"}function MG(t,e){if(t.$schema){const n=lG()(t.$schema);e&&e!==n.library&&console.warn(`The given visualization spec is written in ${OG[n.library]}, but mode argument sets ${OG[e]||e}.`);const r=n.library;return Object(Nt.satisfies)(IG[r],"^"+n.version.slice(1))||console.warn(`The input spec uses ${OG[r]} ${n.version}, but the current version of ${OG[r]} is v${IG[r]}.`),r}return"mark"in t||"encoding"in t||"layer"in t||"hconcat"in t||"vconcat"in t||"facet"in t||"repeat"in t?"vega-lite":"marks"in t||"signals"in t||"scales"in t||"axes"in t?"vega":e||"vega"}function $G(t,e,n={}){return Object(v.a)(this,void 0,void 0,(function*(){const r=(i=n.loader)&&"load"in i?n.loader:AG.loader(n.loader);var i;if(AG.isString(e)){const i=yield r.load(e);return $G(t,JSON.parse(i),n)}let s=(n=kt()(n,e.usermeta&&e.usermeta.embedOptions||{})).config||{};if(AG.isString(s)){const i=yield r.load(s);return $G(t,e,Object.assign(Object.assign({},n),{config:JSON.parse(i)}))}const o=We(n.actions)?n.actions:kt()({export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},n.actions||{}),a=Object.assign(Object.assign({},TG),n.i18n),l=n.renderer||"canvas",u=n.logLevel||AG.Warn,c=n.downloadFileName||"visualization";if(!1!==n.defaultStyle){const t="vega-embed-style";if(!document.getElementById(t)){const e=document.createElement("style");e.id=t,e.innerText=void 0===n.defaultStyle||!0===n.defaultStyle?'.vega-embed {\n  position: relative;\n  display: inline-block;\n  padding-right: 38px; }\n  .vega-embed details:not([open]) > :not(summary) {\n    display: none !important; }\n  .vega-embed summary {\n    list-style: none;\n    position: absolute;\n    top: 0;\n    right: 0;\n    padding: 6px;\n    z-index: 1000;\n    background: white;\n    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);\n    color: #1b1e23;\n    border: 1px solid #aaa;\n    border-radius: 999px;\n    opacity: 0.2;\n    transition: opacity 0.4s ease-in;\n    outline: none;\n    cursor: pointer;\n    line-height: 0px; }\n    .vega-embed summary::-webkit-details-marker {\n      display: none; }\n    .vega-embed summary:active {\n      box-shadow: #aaa 0px 0px 0px 1px inset; }\n    .vega-embed summary svg {\n      width: 14px;\n      height: 14px; }\n  .vega-embed details[open] summary {\n    opacity: 0.7; }\n  .vega-embed:hover summary,\n  .vega-embed:focus summary {\n    opacity: 1 !important;\n    transition: opacity 0.2s ease; }\n  .vega-embed .vega-actions {\n    position: absolute;\n    top: 35px;\n    right: -9px;\n    display: flex;\n    flex-direction: column;\n    padding-bottom: 8px;\n    padding-top: 8px;\n    border-radius: 4px;\n    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);\n    border: 1px solid #d9d9d9;\n    background: white;\n    animation-duration: 0.15s;\n    animation-name: scale-in;\n    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5); }\n    .vega-embed .vega-actions a {\n      padding: 8px 16px;\n      font-family: sans-serif;\n      font-size: 14px;\n      font-weight: 600;\n      white-space: nowrap;\n      color: #434a56;\n      text-decoration: none; }\n      .vega-embed .vega-actions a:hover {\n        background-color: #f7f7f9;\n        color: black; }\n    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {\n      content: "";\n      display: inline-block;\n      position: absolute; }\n    .vega-embed .vega-actions::before {\n      left: auto;\n      right: 14px;\n      top: -16px;\n      border: 8px solid #0000;\n      border-bottom-color: #d9d9d9; }\n    .vega-embed .vega-actions::after {\n      left: auto;\n      right: 15px;\n      top: -14px;\n      border: 7px solid #0000;\n      border-bottom-color: #fff; }\n\n.vega-embed-wrapper {\n  max-width: 100%;\n  overflow: scroll;\n  padding-right: 14px; }\n\n@keyframes scale-in {\n  from {\n    opacity: 0;\n    transform: scale(0.6); }\n  to {\n    opacity: 1;\n    transform: scale(1); } }\n'.toString():n.defaultStyle,document.head.appendChild(e)}}n.theme&&(s=kt()(y[n.theme],s));const h=MG(e,n.mode);let d=RG[h](e,s);if("vega-lite"===h&&d.$schema){const t=lG()(d.$schema);Object(Nt.satisfies)(IG.vega,"^"+t.version.slice(1))||console.warn(`The compiled spec uses Vega ${t.version}, but current version is v${IG.vega}.`)}const f=(p=t,"string"==typeof p?new Ct([[document.querySelector(p)]],[document.documentElement]):new Ct([[p]],St)).classed("vega-embed",!0).html("");var p;const m=n.patch;if(m)if(m instanceof Function)d=m(d);else if(AG.isString(m)){const t=yield r.load(m);d=kt()(d,JSON.parse(t))}else d=kt()(d,m);const g=AG.parse(d,"vega-lite"===h?{}:s),v=new AG.View(g,{loader:r,logLevel:u,renderer:l});if(!1!==n.tooltip){let t;t="function"==typeof n.tooltip?n.tooltip:new kG(!0===n.tooltip?{}:n.tooltip).call,v.tooltip(t)}let{hover:b}=n;if(void 0===b&&(b="vega"===h),b){const{hoverSet:t,updateSet:e}="boolean"==typeof b?{}:b;v.hover(t,e)}if(n&&(n.width&&v.width(n.width),n.height&&v.height(n.height),n.padding&&v.padding(n.padding)),yield v.initialize(t).runAsync(),!1!==o){let t=f;if(!1!==n.defaultStyle){const e=f.append("details").attr("title",a.CLICK_TO_VIEW_ACTIONS);t=e,e.insert("summary").html('\n<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">\n  <circle r="2" cy="8" cx="2"></circle>\n  <circle r="2" cy="8" cx="8"></circle>\n  <circle r="2" cy="8" cx="14"></circle>\n</svg>');const n=e.node();document.addEventListener("click",t=>{n.contains(t.target)||n.removeAttribute("open")})}const r=t.insert("div").attr("class","vega-actions");if(!0===o||!1!==o.export)for(const e of["svg","png"])if(!0===o||!0===o.export||o.export[e]){const t=a[e.toUpperCase()+"_ACTION"];r.append("a").text(t).attr("href","#").attr("target","_blank").attr("download",`${c}.${e}`).on("mousedown",(function(){v.toImageURL(e,n.scaleFactor).then(t=>{this.href=t}).catch(t=>{throw t}),pt.preventDefault()}))}if(!0!==o&&!1===o.source||r.append("a").text(a.SOURCE_ACTION).attr("href","#").on("mousedown",()=>{FG(Dt()(e),n.sourceHeader||"",n.sourceFooter||"",h),pt.preventDefault()}),"vega-lite"!==h||!0!==o&&!1===o.compiled||r.append("a").text(a.COMPILED_ACTION).attr("href","#").on("mousedown",()=>{FG(Dt()(d),n.sourceHeader||"",n.sourceFooter||"","vega"),pt.preventDefault()}),!0===o||!1!==o.editor){const t=n.editorUrl||"https://vega.github.io/editor/";r.append("a").text(a.EDITOR_ACTION).attr("href","#").on("mousedown",()=>{!function(t,e,n){const r=t.open(e);let i=40;t.addEventListener("message",(function e(n){n.source===r&&(i=0,t.removeEventListener("message",e,!1))}),!1),setTimeout((function t(){i<=0||(r.postMessage(n,"*"),setTimeout(t,250),i-=1)}),250)}(window,t,{config:s,mode:h,renderer:l,spec:Dt()(e)}),pt.preventDefault()})}}return{view:v,spec:e,vgSpec:d}}))}},euyF:function(t,e,n){(function(t){var r;!function(t,i,s){function o(t){var e=this;e.next=function(){var t,n,r=e.w,i=e.X,s=e.i;return e.w=r=r+1640531527|0,n=i[s+34&127],t=i[s=s+1&127],n^=n<<13,t^=t<<17,n=i[s]=(n^=n>>>15)^(t^=t>>>12),e.i=s,n+(r^r>>>16)|0},function(t,e){var n,r,i,s,o,a=[],l=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,l=Math.max(l,e.length)),i=0,s=-32;s<l;++s)e&&(r^=e.charCodeAt((s+32)%e.length)),0===s&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,s>=0&&(i=0==(n=a[127&s]^=r+(o=o+1640531527|0))?i+1:0);for(i>=128&&(a[127&(e&&e.length||0)]=-1),i=127,s=512;s>0;--s)r=a[i+34&127],n=a[i=i+1&127],r^=r<<13,n^=n<<17,a[i]=(r^=r>>>15)^(n^=n>>>12);t.w=o,t.X=a,t.i=i}(e,t)}function a(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function l(t,e){null==t&&(t=+new Date);var n=new o(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,r&&(r.X&&a(r,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=l:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return l}).call(e,n,e,i))||(i.exports=r):this.xor4096=l}(0,t,n("B9Yq"))}).call(this,n("YuTi")(t))},gatG:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){var e=/\/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(t).slice(1,3);return{library:e[0],version:e[1]}}},h1ZQ:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(e){s(e)}}function a(t){try{l(r.throw(t))}catch(e){s(e)}}function l(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(o,a)}l((r=r.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=n("rWgG"),o=i(n("etOl")),a=n("Ewl0"),l=n("QUk2"),u=n("Vinz"),c={maxBins:12,fontSize:11};e.histogram=function(t,e,n={}){return r(this,void 0,void 0,(function*(){const r=function(t){if(null==t.length)throw new Error("input data must be an array");if(0===t.length)return[];if("object"==typeof t[0]){if(null==t[0].value)throw new Error("input data must have a value field");return t}{const e=Array(t.length);for(let n=0;n<t.length;n++)e[n]={value:t[n]};return e}}(e),i=Object.assign({},c,n),h=a.subSurface(t,"histogram");if(!1!==n.stats){const e=a.subSurface(t,"stats",{prepend:!0});let o;o=n.stats?n.stats:l.arrayStats(r.map(t=>t.value)),function(t,e,n){const r=s.format(",.4~f"),i=s.format(".4~p"),o=[],a=[];if(null!=t.numVals&&(o.push("Num Vals"),a.push(r(t.numVals))),null!=t.min&&(o.push("Min"),a.push(r(t.min))),null!=t.max&&(o.push("Max"),a.push(r(t.max))),null!=t.numZeros){o.push("# Zeros");let e="";t.numVals&&(e=t.numZeros>0?`(${i(t.numZeros/t.numVals)})`:""),a.push(`${r(t.numZeros)} ${e}`)}if(null!=t.numNans){o.push("# NaNs");let e="";t.numVals&&(e=t.numNans>0?`(${i(t.numNans/t.numVals)})`:""),a.push(`${r(t.numNans)} ${e}`)}if(null!=t.numInfs){o.push("# Infinity");let e="";t.numVals&&(e=t.numInfs>0?`(${i(t.numInfs/t.numVals)})`:""),a.push(`${r(t.numInfs)} ${e}`)}u.table(e,{headers:o,values:[a]},n)}(o,e,{fontSize:i.fontSize})}const d=[];for(let t=0;t<r.length;t++){const e=r[t].value;null!=e&&isFinite(e)&&d.push(r[t])}const f={width:i.width||a.getDefaultWidth(h),height:i.height||a.getDefaultHeight(h),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},data:{values:d},mark:{type:"bar",tooltip:!0},config:{axis:{labelFontSize:i.fontSize,titleFontSize:i.fontSize},text:{fontSize:i.fontSize},legend:{labelFontSize:i.fontSize,titleFontSize:i.fontSize}},encoding:{x:{bin:{maxbins:i.maxBins},field:"value",type:"quantitative"},y:{aggregate:"count",type:"quantitative"},color:{value:i.color||"#001B44"}}};return o.default(h,f,{actions:!1,mode:"vega-lite",defaultStyle:!1})}))}},hAya:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if("position"===t&&"sticky"===e)return["-webkit-sticky","sticky"]},t.exports=e.default},homf:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if("cursor"===t&&i.hasOwnProperty(e))return r.map((function(t){return t+e}))};var r=["-webkit-","-moz-",""],i={"zoom-in":!0,"zoom-out":!0,grab:!0,grabbing:!0};t.exports=e.default},ie1u:function(t,e,n){(function(t){var r;!function(t,i,s){function o(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,i=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^i,e.a=i-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}function a(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function l(t,e){var n=new o(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&a(r,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=l:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return l}).call(e,n,e,i))||(i.exports=r):this.tychei=l}(0,t,n("B9Yq"))}).call(this,n("YuTi")(t))},jke5:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(e){s(e)}}function a(t){try{l(r.throw(t))}catch(e){s(e)}}function l(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(o,a)}l((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const i=n("t+T0"),s=n("LwnN");e.getDrawArea=function(t){if(t instanceof HTMLElement)return t;if(i.isSurface(t))return t.drawArea;if(i.isSurfaceInfo(t))return s.visor().surface({name:t.name,tab:t.tab,styles:t.styles}).drawArea;throw new Error("Not a drawable")},e.shallowEquals=function(t,e){const n=Object.getOwnPropertyNames(t),r=Object.getOwnPropertyNames(e);if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++){const r=n[i];if(t[r]!==e[r])return!1}return!0},e.nextFrame=function(){return r(this,void 0,void 0,(function*(){yield new Promise(t=>requestAnimationFrame(t))}))}},lZ34:function(t,e,n){"use strict";var r=n("NgHg"),i=/^-ms-/;t.exports=function(t){return r(t.replace(i,"ms-"))}},mrSG:function(t,e,n){"use strict";function r(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}function i(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(e){s(e)}}function a(t){try{l(r.throw(t))}catch(e){s(e)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((r=r.apply(t,e||[])).next())}))}n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return i}))},msJK:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.processStyleName=void 0,e.createMarkupForStyles=function(t,e){var n="";for(var i in t){var s=0===i.indexOf("--");if(t.hasOwnProperty(i)&&"label"!==i){var o=t[i];null!=o&&(s?n+=i+":"+o+";":(n+=a(i)+":",n+=(0,r.default)(i,o,e)+";"))}}return n||null},o(n("lZ34"));var r=o(n("0mDd")),i=o(n("+8Ar")),s=o(n("rWXM"));function o(t){return t&&t.__esModule?t:{default:t}}o(n("2mcs"));var a=e.processStyleName=(0,s.default)(i.default)},ohE5:function(t,e,n){"use strict";function r(t){return function(){return t}}var i=function(){};i.thatReturns=r,i.thatReturnsFalse=r(!1),i.thatReturnsTrue=r(!0),i.thatReturnsNull=r(null),i.thatReturnsThis=function(){return this},i.thatReturnsArgument=function(t){return t},t.exports=i},ouyH:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("ML/J"),i=n("Ad6o");class s extends r.Component{componentDidMount(){const{name:t,tab:e}=this.props;this.props.registerSurface(t,e,this)}componentDidUpdate(){return!1}render(){const{name:t,visible:e,styles:n}=this.props,o=Object.assign({},s.defaultStyles,n),{width:a,height:l}=o;let{maxHeight:u,maxWidth:c}=o;u=l===s.defaultStyles.height?u:l,c=a===s.defaultStyles.width?c:a;const h=i.css({display:e?"block":"none",backgroundColor:"white",marginTop:"10px",marginBottom:"10px",boxShadow:"0 0 6px -3px #777",padding:"10px !important",height:l,width:a,maxHeight:u,maxWidth:c,overflow:"auto"}),d=i.css({backgroundColor:"white",boxSizing:"border-box",borderBottom:"1px solid #357EDD",lineHeight:"2em",marginBottom:"20px",fontWeight:"600",textAlign:"center"}),f=i.css({boxSizing:"border-box"});return r.h("div",{className:h+" tf-surface",ref:t=>this.container=t,"data-visible":e},r.h("div",{className:d+" tf-label",ref:t=>this.label=t},t),r.h("div",{className:f+" tf-draw-area",ref:t=>this.drawArea=t}))}}s.defaultStyles={maxWidth:"550px",maxHeight:"580px",height:"auto",width:"auto"},e.SurfaceComponent=s},"pJ3+":function(t,e,n){var r;!function(i,s){var o,a=this,l=s.pow(256,6),u=s.pow(2,52),c=2*u;function h(t,e,n){var r=[],h=p(function t(e,n){var r,i=[],s=typeof e;if(n&&"object"==s)for(r in e)try{i.push(t(e[r],n-1))}catch(o){}return i.length?i:"string"==s?e:e+"\0"}((e=1==e?{entropy:!0}:e||{}).entropy?[t,m(i)]:null==t?function(){try{var t;return o&&(t=o.randomBytes)?t=t(256):(t=new Uint8Array(256),(a.crypto||a.msCrypto).getRandomValues(t)),m(t)}catch(r){var e=a.navigator,n=e&&e.plugins;return[+new Date,a,n,a.screen,m(i)]}}():t,3),r),g=new d(r),y=function(){for(var t=g.g(6),e=l,n=0;t<u;)t=256*(t+n),e*=256,n=g.g(1);for(;t>=c;)t/=2,e/=2,n>>>=1;return(t+n)/e};return y.int32=function(){return 0|g.g(4)},y.quick=function(){return g.g(4)/4294967296},y.double=y,p(m(g.S),i),(e.pass||n||function(t,e,n,r){return r&&(r.S&&f(r,g),t.state=function(){return f(g,{})}),n?(s.random=t,e):t})(y,h,"global"in e?e.global:this==s,e.state)}function d(t){var e,n=t.length,r=this,i=0,s=r.i=r.j=0,o=r.S=[];for(n||(t=[n++]);i<256;)o[i]=i++;for(i=0;i<256;i++)o[i]=o[s=255&s+t[i%n]+(e=o[i])],o[s]=e;(r.g=function(t){for(var e,n=0,i=r.i,s=r.j,o=r.S;t--;)e=o[i=255&i+1],n=256*n+o[255&(o[i]=o[s=255&s+e])+(o[s]=e)];return r.i=i,r.j=s,n})(256)}function f(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function p(t,e){for(var n,r=t+"",i=0;i<r.length;)e[255&i]=255&(n^=19*e[255&i])+r.charCodeAt(i++);return m(e)}function m(t){return String.fromCharCode.apply(0,t)}if(s.seedrandom=h,p(s.random(),i),t.exports){t.exports=h;try{o=n(3)}catch(g){}}else void 0===(r=(function(){return h}).call(e,n,e,t))||(t.exports=r)}([],Math)},pJ6O:function(t,e,n){(function(t){var r;!function(t,i,s){function o(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function a(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function l(t,e){var n=new o(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&a(r,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=l:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return l}).call(e,n,e,i))||(i.exports=r):this.xorwow=l}(0,t,n("B9Yq"))}).call(this,n("YuTi")(t))},qHvB:function(t){t.exports=JSON.parse('{"a":"4.14.1"}')},qvkj:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if("string"==typeof e&&!(0,i.default)(e)&&e.indexOf("cross-fade(")>-1)return s.map((function(t){return e.replace(/cross-fade\(/g,t+"cross-fade(")}))};var r,i=(r=n("sUt/"))&&r.__esModule?r:{default:r},s=["-webkit-",""];t.exports=e.default},"qw/d":function(t){t.exports=JSON.parse('{"name":"vega-themes","version":"2.8.5","description":"Themes for stylized Vega and Vega-Lite visualizations.","keywords":["vega","vega-lite","themes","style"],"license":"BSD-3-Clause","author":{"name":"UW Interactive Data Lab","url":"https://idl.cs.washington.edu"},"contributors":[{"name":"Emily Gu","url":"https://github.com/emilygu"},{"name":"Arvind Satyanarayan","url":"http://arvindsatya.com"},{"name":"Jeffrey Heer","url":"https://idl.cs.washington.edu"},{"name":"Dominik Moritz","url":"https://www.domoritz.de"}],"main":"build/vega-themes.js","module":"build/src/index.js","unpkg":"build/vega-themes.min.js","jsdelivr":"build/vega-themes.min.js","typings":"build/src/index.d.ts","repository":{"type":"git","url":"https://github.com/vega/vega-themes.git"},"scripts":{"prepare":"beemo create-config --silent","clean":"rm -rf build examples/build","prettierbase":"beemo prettier \'examples/*.{html,scss,css}\'","eslintbase":"beemo eslint .","format":"yarn eslintbase --fix && yarn prettierbase --write","lint":"yarn eslintbase && yarn prettierbase --check","prebuild":"mkdir -p build","build":"tsc && rollup -c","postbuild":"terser build/vega-themes.js -cm > build/vega-themes.min.js","deploy:gh":"yarn build && mkdir -p examples/build && rsync -r build/* examples/build && gh-pages -d examples","prepublishOnly":"yarn clean && yarn build","preversion":"yarn lint","serve":"browser-sync start -s -f build examples --serveStatic examples","start":"yarn build && concurrently --kill-others -n Server,Typescript,Rollup \'yarn serve\' \'tsc -w\' \'rollup -c -w\'"},"devDependencies":{"@rollup/plugin-json":"^4.1.0","browser-sync":"^2.26.7","concurrently":"^5.2.0","gh-pages":"^3.1.0","rollup":"^2.21.0","terser":"^4.8.0","typescript":"^3.9.6","vega":"^5.10.0","vega-lite":"^4.8.1","vega-lite-dev-config":"^0.11.8"},"peerDependencies":{"vega":"*","vega-lite":"*"},"beemo":{"module":"vega-lite-dev-config","drivers":["prettier","eslint"]}}')},rWXM:function(t,e,n){"use strict";t.exports=function(t){var e={};return function(n){return e.hasOwnProperty(n)||(e[n]=t.call(this,n)),e[n]}}},rWgG:function(t,e,n){"use strict";n.r(e);var r=function(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]},i=function(t){return(t=r(Math.abs(t)))?t[1]:NaN},s=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function o(t){return new a(t)}function a(t){if(!(e=s.exec(t)))throw new Error("invalid format: "+t);var e;this.fill=e[1]||" ",this.align=e[2]||">",this.sign=e[3]||"-",this.symbol=e[4]||"",this.zero=!!e[5],this.width=e[6]&&+e[6],this.comma=!!e[7],this.precision=e[8]&&+e[8].slice(1),this.trim=!!e[9],this.type=e[10]||""}o.prototype=a.prototype,a.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(null==this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(null==this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var l,u,c,h,d=function(t,e){var n=r(t,e);if(!n)return t+"";var i=n[0],s=n[1];return s<0?"0."+new Array(-s).join("0")+i:i.length>s+1?i.slice(0,s+1)+"."+i.slice(s+1):i+new Array(s-i.length+2).join("0")},f={"%":function(t,e){return(100*t).toFixed(e)},b:function(t){return Math.round(t).toString(2)},c:function(t){return t+""},d:function(t){return Math.round(t).toString(10)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},g:function(t,e){return t.toPrecision(e)},o:function(t){return Math.round(t).toString(8)},p:function(t,e){return d(100*t,e)},r:d,s:function(t,e){var n=r(t,e);if(!n)return t+"";var i=n[0],s=n[1],o=s-(l=3*Math.max(-8,Math.min(8,Math.floor(s/3))))+1,a=i.length;return o===a?i:o>a?i+new Array(o-a+1).join("0"):o>0?i.slice(0,o)+"."+i.slice(o):"0."+new Array(1-o).join("0")+r(t,Math.max(0,e+o-1))[0]},X:function(t){return Math.round(t).toString(16).toUpperCase()},x:function(t){return Math.round(t).toString(16)}},p=function(t){return t},m=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"],g=function(t){var e,n,r=t.grouping&&t.thousands?(e=t.grouping,n=t.thousands,function(t,r){for(var i=t.length,s=[],o=0,a=e[0],l=0;i>0&&a>0&&(l+a+1>r&&(a=Math.max(1,r-l)),s.push(t.substring(i-=a,i+a)),!((l+=a+1)>r));)a=e[o=(o+1)%e.length];return s.reverse().join(n)}):p,s=t.currency,a=t.decimal,u=t.numerals?function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(t.numerals):p,c=t.percent||"%";function h(t){var e=(t=o(t)).fill,n=t.align,i=t.sign,h=t.symbol,d=t.zero,p=t.width,g=t.comma,y=t.precision,v=t.trim,b=t.type;"n"===b?(g=!0,b="g"):f[b]||(null==y&&(y=12),v=!0,b="g"),(d||"0"===e&&"="===n)&&(d=!0,e="0",n="=");var x="$"===h?s[0]:"#"===h&&/[boxX]/.test(b)?"0"+b.toLowerCase():"",_="$"===h?s[1]:/[%p]/.test(b)?c:"",w=f[b],S=/[defgprs%]/.test(b);function C(t){var s,o,c,h=x,f=_;if("c"===b)f=w(t)+f,t="";else{var C=(t=+t)<0;if(t=w(Math.abs(t),y),v&&(t=function(t){t:for(var e,n=t.length,r=1,i=-1;r<n;++r)switch(t[r]){case".":i=e=r;break;case"0":0===i&&(i=r),e=r;break;default:if(i>0){if(!+t[r])break t;i=0}}return i>0?t.slice(0,i)+t.slice(e+1):t}(t)),C&&0==+t&&(C=!1),h=(C?"("===i?i:"-":"-"===i||"("===i?"":i)+h,f=("s"===b?m[8+l/3]:"")+f+(C&&"("===i?")":""),S)for(s=-1,o=t.length;++s<o;)if(48>(c=t.charCodeAt(s))||c>57){f=(46===c?a+t.slice(s+1):t.slice(s))+f,t=t.slice(0,s);break}}g&&!d&&(t=r(t,1/0));var E=h.length+t.length+f.length,k=E<p?new Array(p-E+1).join(e):"";switch(g&&d&&(t=r(k+t,k.length?p-f.length:1/0),k=""),n){case"<":t=h+t+f+k;break;case"=":t=h+k+t+f;break;case"^":t=k.slice(0,E=k.length>>1)+h+t+f+k.slice(E);break;default:t=k+h+t+f}return u(t)}return y=null==y?6:/[gprs]/.test(b)?Math.max(1,Math.min(21,y)):Math.max(0,Math.min(20,y)),C.toString=function(){return t+""},C}return{format:h,formatPrefix:function(t,e){var n=h(((t=o(t)).type="f",t)),r=3*Math.max(-8,Math.min(8,Math.floor(i(e)/3))),s=Math.pow(10,-r),a=m[8+r/3];return function(t){return n(s*t)+a}}}};function y(t){return u=g(t),c=u.format,h=u.formatPrefix,u}y({decimal:".",thousands:",",grouping:[3],currency:["$",""]});var v=function(t){return Math.max(0,-i(Math.abs(t)))},b=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(i(e)/3)))-i(Math.abs(t)))},x=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,i(e)-i(t))+1};n.d(e,"formatDefaultLocale",(function(){return y})),n.d(e,"format",(function(){return c})),n.d(e,"formatPrefix",(function(){return h})),n.d(e,"formatLocale",(function(){return g})),n.d(e,"formatSpecifier",(function(){return o})),n.d(e,"precisionFixed",(function(){return v})),n.d(e,"precisionPrefix",(function(){return b})),n.d(e,"precisionRound",(function(){return x}))},rtRu:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n("ML/J"),i=n("Ad6o"),s=n("ouyH"),o=n("EzSE");class a extends r.Component{static render(t,e,n){return r.render(r.h(a,Object.assign({},n)),t,e)}constructor(t){super(t),this.surfaces=new Map,this.state={isOpen:null==t.startOpen||t.startOpen,isFullscreen:!1,activeTab:null,tabs:new Set},this.keyHandler=this.keyHandler.bind(this)}close(){this.setState({isOpen:!1})}open(){this.setState({isOpen:!0})}toggle(){this.setState({isOpen:!this.state.isOpen})}toggleFullScreen(){this.setState({isFullscreen:!this.state.isFullscreen})}isOpen(){return this.state.isOpen}isFullscreen(){return this.state.isFullscreen}getSurface(t,e){const n=this.surfaceId(t,e);let r;if(!this.surfaces.has(n))throw Error("Surface not found with id: "+n);return r=this.surfaces.get(n),{container:r.container,label:r.label,drawArea:r.drawArea}}bindKeys(){document.addEventListener("keydown",this.keyHandler,!1)}unbindKeys(){document.removeEventListener("keydown",this.keyHandler)}surfaceId(t,e){return t+e}setTabs(t){const e=t.map(t=>t.tab),n=this.state.tabs;let r;for(const i of e)n.has(i)||(n.add(i),r=i);null!=r&&this.setState({tabs:n,activeTab:r})}getTabs(){return this.state.tabs}registerSurface(t,e,n){const r=this.surfaceId(t,e);this.surfaces.set(r,n)}keyHandler(t){192===t.keyCode&&(t.shiftKey?this.toggleFullScreen():this.toggle())}setActiveTab(t){this.setState({activeTab:t})}componentDidMount(){this.bindKeys()}componentWillMount(){this.setTabs(this.props.surfaceList)}componentWillReceiveProps(t){this.setTabs(t.surfaceList)}render(){const{isOpen:t,isFullscreen:e,activeTab:n}=this.state,{surfaceList:a}=this.props,u=Array.from(this.getTabs().values()),c=e?"90vw":"550px",h=i.css({width:c,height:"100%",backgroundColor:"#fafafa",boxSizing:"border-box",padding:"10px",position:"fixed",top:"0px",transition:"right 0.5s cubic-bezier(0.645, 0.045, 0.355, 1), width 0.5s cubic-bezier(0.645, 0.045, 0.355, 1)",boxShadow:"0 2px 5px rgba(0, 0, 0, 0.12), 0 2px 5px rgba(0, 0, 0, 0.24)",overflow:"auto",fontFamily:"sans-serif",fontSize:"14px",zIndex:1e3}),d=i.css({right:"0"}),f=i.css({right:`calc(-${c} - 10px)`}),p=t?d:f,m=i.css({});return r.h("div",{className:`${h} ${p} visor`,"data-isopen":t,"data-isfullscreen":e},r.h(l,{fullScreenHandler:this.toggleFullScreen.bind(this),closeHandler:this.close.bind(this),isFullScreen:e}),r.h(o.Tabs,{tabNames:u,activeTab:n,handleClick:this.setActiveTab.bind(this)}),r.h("div",{className:m+" visor-surfaces"},a.map(t=>r.h(s.SurfaceComponent,{key:t.name+t.tab,name:t.name,tab:t.tab,styles:t.styles,registerSurface:this.registerSurface.bind(this),visible:n===t.tab}))))}}function l(t){const{isFullScreen:e,fullScreenHandler:n,closeHandler:s}=t,o=i.css({display:"flex",backgroundColor:"white",border:"1px solid white",padding:"6px",paddingTop:"10px",marginBottom:"10px",borderRadius:"6px",marginTop:"-16px"}),a=i.css({fontSize:".875rem",borderRadius:".25rem",paddingLeft:"1rem",paddingRight:"1rem",paddingTop:".5rem",paddingBottom:".5rem",textDecoration:"none",transition:"color .15s ease-in",color:"#111"}),l=i.css({marginLeft:"auto"});return r.h("div",{className:o+" visor-controls"},r.h("button",{className:""+a,onClick:n},e?"Minimize":"Maximize"),r.h("button",{className:`${a} ${l}`,onClick:s},"Hide"))}e.VisorComponent=a},"sUt/":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return"string"==typeof t&&r.test(t)};var r=/-webkit-|-moz-|-ms-/;t.exports=e.default},"t+T0":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isSurfaceInfo=function(t){return null!=t.name},e.isSurface=function(t){return t.drawArea instanceof HTMLElement}},tNsn:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(e){s(e)}}function a(t){try{l(r.throw(t))}catch(e){s(e)}}function l(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(o,a)}l((r=r.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i(n("etOl")),o=n("Ewl0"),a=n("jke5");e.barchart=function(t,e,n={}){return r(this,void 0,void 0,(function*(){const r=a.getDrawArea(t),i=e,c=Object.assign({},l,n);if(u.has(r)){const t=u.get(r);if(a.shallowEquals(c,t.lastOptions)){yield a.nextFrame();const e=t.view,n=e.changeset().remove(()=>!0).insert(i);return void(yield e.change("values",n).runAsync())}}const{xLabel:h,yLabel:d,xType:f,yType:p}=c;let m=null;null!=h&&(m={title:h});let g,y=null;null!=d&&(y={title:d}),g=null!=c.color?Array.isArray(c.color)?{field:"index",type:"nominal",scale:{range:c.color}}:{value:c.color}:{value:"#4C78A0"};const v={width:c.width||o.getDefaultWidth(r),height:c.height||o.getDefaultHeight(r),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:c.fontSize,titleFontSize:c.fontSize},text:{fontSize:c.fontSize},legend:{labelFontSize:c.fontSize,titleFontSize:c.fontSize}},data:{values:i,name:"values"},mark:{type:"bar",tooltip:!0},encoding:{x:{field:"index",type:f,axis:m},y:{field:"value",type:p,axis:y},color:g}};yield a.nextFrame();const b=yield s.default(r,v,{actions:!1,mode:"vega-lite",defaultStyle:!1});u.set(r,{view:b.view,lastOptions:c})}))};const l={xLabel:"",yLabel:"",xType:"ordinal",yType:"quantitative",fontSize:11},u=new Map},tduB:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.default=function t(e){return Array.isArray(e)?(i=!1,s=[],(n=e).forEach((function(e){var n=t(e);null!==n&&n===e||(i=!0),null!==n&&s.push(n)})),0==s.length?null:i?s:n):function(e){if(function(t){return null==t||!1===t||"object"===(void 0===t?"undefined":r(t))&&0===Object.keys(t).length}(e))return null;if("object"!==(void 0===e?"undefined":r(e)))return e;for(var n={},i=Object.keys(e),s=!1,o=0;o<i.length;o++){var a=e[i[o]],l=t(a);null!==l&&l===a||(s=!0),null!==l&&(n[i[o]]=l)}return 0===Object.keys(n).length?null:s?n:e}(e);var n,i,s}},uDiL:function(t,e,n){(function(t){var r;!function(t,i,s){function o(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}function a(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function l(t,e){var n=new o(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&a(r,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=l:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return l}).call(e,n,e,i))||(i.exports=r):this.xor128=l}(0,t,n("B9Yq"))}).call(this,n("YuTi")(t))},uGx6:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){for(var e in t){var n=(0,s.default)(y,e,t[e],t,v);n&&(t[e]=n),(0,i.default)(v,e,t)}return t};var r=g(n("e575")),i=g(n("djh3")),s=g(n("Pp8E")),o=g(n("homf")),a=g(n("qvkj")),l=g(n("7ZGM")),u=g(n("9eqh")),c=g(n("ytq/")),h=g(n("6fql")),d=g(n("2KGH")),f=g(n("hAya")),p=g(n("uVON")),m=g(n("c0yS"));function g(t){return t&&t.__esModule?t:{default:t}}var y=[a.default,o.default,l.default,c.default,h.default,d.default,f.default,p.default,m.default,u.default],v=r.default.prefixMap},uVON:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if(i.hasOwnProperty(t)&&s.hasOwnProperty(e))return r.map((function(t){return t+e}))};var r=["-webkit-","-moz-",""],i={maxHeight:!0,maxWidth:!0,width:!0,height:!0,columnWidth:!0,minWidth:!0,minHeight:!0},s={"min-content":!0,"max-content":!0,"fill-available":!0,"fit-content":!0,"contain-floats":!0};t.exports=e.default},v20e:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t};e.PluginSet=l,e.fallbacks=function(t){if(Object.keys(t.style).map((function(e){return Array.isArray(t.style[e])})).indexOf(!0)>=0){var e=t.style,n=Object.keys(e).reduce((function(t,n){return t[n]=Array.isArray(e[n])?e[n].join("; "+(0,s.processStyleName)(n)+": "):e[n],t}),{});return(0,i.default)({},t,{style:n})}return t},e.contentWrap=function(t){if(t.style.content){var e=t.style.content;return u.indexOf(e)>=0||/^(attr|calc|counters?|url)\(/.test(e)?t:e.charAt(0)!==e.charAt(e.length-1)||'"'!==e.charAt(0)&&"'"!==e.charAt(0)?r({},t,{style:r({},t.style,{content:'"'+e+'"'})}):t}return t},e.prefixes=function(t){return(0,i.default)({},t,{style:(0,o.default)(r({},t.style))})};var i=a(n("MgzW")),s=n("msJK"),o=a(n("uGx6"));function a(t){return t&&t.__esModule?t:{default:t}}function l(t){this.fns=t||[]}(0,i.default)(l.prototype,{add:function(){for(var t=this,e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];n.forEach((function(e){t.fns.indexOf(e)>=0||(t.fns=[e].concat(t.fns))}))},remove:function(t){this.fns=this.fns.filter((function(e){return e!==t}))},clear:function(){this.fns=[]},transform:function(t){return this.fns.reduce((function(t,e){return e(t)}),t)}});var u=["normal","none","counter","open-quote","close-quote","no-open-quote","no-close-quote","initial","inherit"]},vWdZ:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(e){s(e)}}function a(t){try{l(r.throw(t))}catch(e){s(e)}}function l(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(o,a)}l((r=r.apply(t,e||[])).next())}))},i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e},s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=i(n("zhpf")),a=s(n("etOl")),l=n("Ewl0"),u=n("YYB2"),c=n("jke5");function h(t,e,n){const r=t instanceof o.Tensor?t.shape:[t.length,t[0].length];0===n?u.assert(r[0]===e.length,`Length of xTickLabels (${e.length}) must match number of rows (${r[0]})`):1===n&&u.assert(r[1]===e.length,`Length of yTickLabels (${e.length}) must match number of columns (${r[1]})`)}e.heatmap=function(t,e,n={}){return r(this,void 0,void 0,(function*(){const i=Object.assign({},d,n),s=c.getDrawArea(t);let f=e.values;i.rowMajor&&(f=yield function(t){return r(this,void 0,void 0,(function*(){let e,n;t instanceof o.Tensor?(e=t.shape,n=t.transpose()):(e=[t.length,t[0].length],n=o.tidy(()=>o.tensor2d(t).transpose())),u.assert(2===n.rank,"Input to renderHeatmap must be a 2d array or Tensor2d");const r=yield n.array();n.dispose();const i=[r.length,r[0].length];return u.assert(e[0]===i[1]&&e[1]===i[0],`Unexpected transposed shape. Original ${e} : Transposed ${i}`),r}))}(e.values));const{xTickLabels:p,yTickLabels:m}=e;null!=p&&h(f,p,0),null!=m&&h(f,m,1);const g=[];if(f instanceof o.Tensor){u.assert(2===f.rank,"Input to renderHeatmap must be a 2d array or Tensor2d");const t=yield f.data(),[e,n]=f.shape;for(let r=0;r<e;r++){const e=p?`${p[r]}@tfidx@${r}`:r;for(let i=0;i<n;i++)g.push({x:e,y:m?`${m[i]}@tfidx@${i}`:i,value:t[r*n+i]})}}else{const t=f;for(let e=0;e<t.length;e++){const n=p?`${p[e]}@tfidx@${e}`:e;for(let r=0;r<t[e].length;r++)g.push({x:n,y:m?`${m[r]}@tfidx@${r}`:r,value:t[e][r]})}}const y={actions:!1,mode:"vega-lite",defaultStyle:!1},v={width:i.width||l.getDefaultWidth(s),height:i.height||l.getDefaultHeight(s),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:i.fontSize,titleFontSize:i.fontSize},text:{fontSize:i.fontSize},legend:{labelFontSize:i.fontSize,titleFontSize:i.fontSize},scale:{bandPaddingInner:0,bandPaddingOuter:0}},data:{values:g},mark:{type:"rect",tooltip:!0},encoding:{x:{field:"x",type:i.xType,title:i.xLabel,sort:"x"},y:{field:"y",type:i.yType,title:i.yLabel,sort:"y"},fill:{field:"value",type:"quantitative"}}},b=new RegExp("@tfidx@\\d+$");let x;switch(p&&(v.encoding.x.axis={labelExpr:"replace(datum.value, regexp(/@tfidx@\\d+$/), '')"}),m&&(v.encoding.y.axis={labelExpr:"replace(datum.value, regexp(/@tfidx@\\d+$/), '')"}),(p||m)&&(y.tooltip={sanitize:t=>String(t).replace(b,"")}),i.colorMap){case"blues":x=["#f7fbff","#4292c6"];break;case"greyscale":x=["#000000","#ffffff"];break;case"viridis":default:x="viridis"}if("viridis"!==x&&(v.encoding.fill.scale={range:x}),i.domain){const t=v.encoding.fill;t.scale=null!=t.scale?Object.assign({},t.scale,{domain:i.domain}):{domain:i.domain}}yield a.default(s,v,y)}))};const d={xLabel:null,yLabel:null,xType:"ordinal",yType:"ordinal",colorMap:"viridis",fontSize:12,domain:null,rowMajor:!1}},yLV6:function(t,e,n){var r;!function(i,s,o,a){"use strict";var l,u=["","webkit","Moz","MS","ms","o"],c=s.createElement("div"),h=Math.round,d=Math.abs,f=Date.now;function p(t,e,n){return setTimeout(_(t,n),e)}function m(t,e,n){return!!Array.isArray(t)&&(g(t,n[e],n),!0)}function g(t,e,n){var r;if(t)if(t.forEach)t.forEach(e,n);else if(void 0!==t.length)for(r=0;r<t.length;)e.call(n,t[r],r,t),r++;else for(r in t)t.hasOwnProperty(r)&&e.call(n,t[r],r,t)}function y(t,e,n){var r="DEPRECATED METHOD: "+e+"\n"+n+" AT \n";return function(){var e=new Error("get-stack-trace"),n=e&&e.stack?e.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",s=i.console&&(i.console.warn||i.console.log);return s&&s.call(i.console,r,n),t.apply(this,arguments)}}l="function"!=typeof Object.assign?function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var i in r)r.hasOwnProperty(i)&&(e[i]=r[i])}return e}:Object.assign;var v=y((function(t,e,n){for(var r=Object.keys(e),i=0;i<r.length;)(!n||n&&void 0===t[r[i]])&&(t[r[i]]=e[r[i]]),i++;return t}),"extend","Use `assign`."),b=y((function(t,e){return v(t,e,!0)}),"merge","Use `assign`.");function x(t,e,n){var r,i=e.prototype;(r=t.prototype=Object.create(i)).constructor=t,r._super=i,n&&l(r,n)}function _(t,e){return function(){return t.apply(e,arguments)}}function w(t,e){return"function"==typeof t?t.apply(e&&e[0]||void 0,e):t}function S(t,e){return void 0===t?e:t}function C(t,e,n){g(D(e),(function(e){t.addEventListener(e,n,!1)}))}function E(t,e,n){g(D(e),(function(e){t.removeEventListener(e,n,!1)}))}function k(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function A(t,e){return t.indexOf(e)>-1}function D(t){return t.trim().split(/\s+/g)}function N(t,e,n){if(t.indexOf&&!n)return t.indexOf(e);for(var r=0;r<t.length;){if(n&&t[r][n]==e||!n&&t[r]===e)return r;r++}return-1}function T(t){return Array.prototype.slice.call(t,0)}function O(t,e,n){for(var r=[],i=[],s=0;s<t.length;){var o=e?t[s][e]:t[s];N(i,o)<0&&r.push(t[s]),i[s]=o,s++}return n&&(r=e?r.sort((function(t,n){return t[e]>n[e]})):r.sort()),r}function I(t,e){for(var n,r,i=e[0].toUpperCase()+e.slice(1),s=0;s<u.length;){if((r=(n=u[s])?n+i:e)in t)return r;s++}}var R=1;function F(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow||i}var M="ontouchstart"in i,$=void 0!==I(i,"PointerEvent"),P=M&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),z=["x","y"],L=["clientX","clientY"];function B(t,e){var n=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){w(t.options.enable,[t])&&n.handler(e)},this.init()}function j(t,e,n){var r=n.pointers.length,i=n.changedPointers.length,s=1&e&&r-i==0,o=12&e&&r-i==0;n.isFirst=!!s,n.isFinal=!!o,s&&(t.session={}),n.eventType=e,function(t,e){var n=t.session,r=e.pointers,i=r.length;n.firstInput||(n.firstInput=U(e)),i>1&&!n.firstMultiple?n.firstMultiple=U(e):1===i&&(n.firstMultiple=!1);var s=n.firstInput,o=n.firstMultiple,a=o?o.center:s.center,l=e.center=V(r);e.timeStamp=f(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=G(a,l),e.distance=H(a,l),function(t,e){var n=e.center,r=t.offsetDelta||{},i=t.prevDelta||{},s=t.prevInput||{};1!==e.eventType&&4!==s.eventType||(i=t.prevDelta={x:s.deltaX||0,y:s.deltaY||0},r=t.offsetDelta={x:n.x,y:n.y}),e.deltaX=i.x+(n.x-r.x),e.deltaY=i.y+(n.y-r.y)}(n,e),e.offsetDirection=q(e.deltaX,e.deltaY);var u,c,h=W(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=h.x,e.overallVelocityY=h.y,e.overallVelocity=d(h.x)>d(h.y)?h.x:h.y,e.scale=o?(u=o.pointers,H((c=r)[0],c[1],L)/H(u[0],u[1],L)):1,e.rotation=o?function(t,e){return G(e[1],e[0],L)+G(t[1],t[0],L)}(o.pointers,r):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length,function(t,e){var n,r,i,s,o=t.lastInterval||e,a=e.timeStamp-o.timeStamp;if(8!=e.eventType&&(a>25||void 0===o.velocity)){var l=e.deltaX-o.deltaX,u=e.deltaY-o.deltaY,c=W(a,l,u);r=c.x,i=c.y,n=d(c.x)>d(c.y)?c.x:c.y,s=q(l,u),t.lastInterval=e}else n=o.velocity,r=o.velocityX,i=o.velocityY,s=o.direction;e.velocity=n,e.velocityX=r,e.velocityY=i,e.direction=s}(n,e);var p=t.element;k(e.srcEvent.target,p)&&(p=e.srcEvent.target),e.target=p}(t,n),t.emit("hammer.input",n),t.recognize(n),t.session.prevInput=n}function U(t){for(var e=[],n=0;n<t.pointers.length;)e[n]={clientX:h(t.pointers[n].clientX),clientY:h(t.pointers[n].clientY)},n++;return{timeStamp:f(),pointers:e,center:V(e),deltaX:t.deltaX,deltaY:t.deltaY}}function V(t){var e=t.length;if(1===e)return{x:h(t[0].clientX),y:h(t[0].clientY)};for(var n=0,r=0,i=0;i<e;)n+=t[i].clientX,r+=t[i].clientY,i++;return{x:h(n/e),y:h(r/e)}}function W(t,e,n){return{x:e/t||0,y:n/t||0}}function q(t,e){return t===e?1:d(t)>=d(e)?t<0?2:4:e<0?8:16}function H(t,e,n){n||(n=z);var r=e[n[0]]-t[n[0]],i=e[n[1]]-t[n[1]];return Math.sqrt(r*r+i*i)}function G(t,e,n){return n||(n=z),180*Math.atan2(e[n[1]]-t[n[1]],e[n[0]]-t[n[0]])/Math.PI}B.prototype={handler:function(){},init:function(){this.evEl&&C(this.element,this.evEl,this.domHandler),this.evTarget&&C(this.target,this.evTarget,this.domHandler),this.evWin&&C(F(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&E(this.element,this.evEl,this.domHandler),this.evTarget&&E(this.target,this.evTarget,this.domHandler),this.evWin&&E(F(this.element),this.evWin,this.domHandler)}};var Y={mousedown:1,mousemove:2,mouseup:4};function K(){this.evEl="mousedown",this.evWin="mousemove mouseup",this.pressed=!1,B.apply(this,arguments)}x(K,B,{handler:function(t){var e=Y[t.type];1&e&&0===t.button&&(this.pressed=!0),2&e&&1!==t.which&&(e=4),this.pressed&&(4&e&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}});var X={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},Z={2:"touch",3:"pen",4:"mouse",5:"kinect"},Q="pointerdown",J="pointermove pointerup pointercancel";function tt(){this.evEl=Q,this.evWin=J,B.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}i.MSPointerEvent&&!i.PointerEvent&&(Q="MSPointerDown",J="MSPointerMove MSPointerUp MSPointerCancel"),x(tt,B,{handler:function(t){var e=this.store,n=!1,r=t.type.toLowerCase().replace("ms",""),i=X[r],s=Z[t.pointerType]||t.pointerType,o="touch"==s,a=N(e,t.pointerId,"pointerId");1&i&&(0===t.button||o)?a<0&&(e.push(t),a=e.length-1):12&i&&(n=!0),a<0||(e[a]=t,this.callback(this.manager,i,{pointers:e,changedPointers:[t],pointerType:s,srcEvent:t}),n&&e.splice(a,1))}});var et={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function nt(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,B.apply(this,arguments)}function rt(t,e){var n=T(t.touches),r=T(t.changedTouches);return 12&e&&(n=O(n.concat(r),"identifier",!0)),[n,r]}x(nt,B,{handler:function(t){var e=et[t.type];if(1===e&&(this.started=!0),this.started){var n=rt.call(this,t,e);12&e&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:t})}}});var it={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function st(){this.evTarget="touchstart touchmove touchend touchcancel",this.targetIds={},B.apply(this,arguments)}function ot(t,e){var n=T(t.touches),r=this.targetIds;if(3&e&&1===n.length)return r[n[0].identifier]=!0,[n,n];var i,s,o=T(t.changedTouches),a=[],l=this.target;if(s=n.filter((function(t){return k(t.target,l)})),1===e)for(i=0;i<s.length;)r[s[i].identifier]=!0,i++;for(i=0;i<o.length;)r[o[i].identifier]&&a.push(o[i]),12&e&&delete r[o[i].identifier],i++;return a.length?[O(s.concat(a),"identifier",!0),a]:void 0}function at(){B.apply(this,arguments);var t=_(this.handler,this);this.touch=new st(this.manager,t),this.mouse=new K(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function lt(t,e){1&t?(this.primaryTouch=e.changedPointers[0].identifier,ut.call(this,e)):12&t&&ut.call(this,e)}function ut(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var n={x:e.clientX,y:e.clientY};this.lastTouches.push(n);var r=this.lastTouches;setTimeout((function(){var t=r.indexOf(n);t>-1&&r.splice(t,1)}),2500)}}function ct(t){for(var e=t.srcEvent.clientX,n=t.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var i=this.lastTouches[r],s=Math.abs(e-i.x),o=Math.abs(n-i.y);if(s<=25&&o<=25)return!0}return!1}x(st,B,{handler:function(t){var e=it[t.type],n=ot.call(this,t,e);n&&this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:t})}}),x(at,B,{handler:function(t,e,n){var r="mouse"==n.pointerType;if(!(r&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if("touch"==n.pointerType)lt.call(this,e,n);else if(r&&ct.call(this,n))return;this.callback(t,e,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var ht=I(c.style,"touchAction"),dt=void 0!==ht,ft=function(){if(!dt)return!1;var t={},e=i.CSS&&i.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(n){t[n]=!e||i.CSS.supports("touch-action",n)})),t}();function pt(t,e){this.manager=t,this.set(e)}function mt(t){this.options=l({},this.defaults,t||{}),this.id=R++,this.manager=null,this.options.enable=S(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function gt(t){return 16&t?"cancel":8&t?"end":4&t?"move":2&t?"start":""}function yt(t){return 16==t?"down":8==t?"up":2==t?"left":4==t?"right":""}function vt(t,e){var n=e.manager;return n?n.get(t):t}function bt(){mt.apply(this,arguments)}function xt(){bt.apply(this,arguments),this.pX=null,this.pY=null}function _t(){bt.apply(this,arguments)}function wt(){mt.apply(this,arguments),this._timer=null,this._input=null}function St(){bt.apply(this,arguments)}function Ct(){bt.apply(this,arguments)}function Et(){mt.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function kt(t,e){return(e=e||{}).recognizers=S(e.recognizers,kt.defaults.preset),new At(t,e)}function At(t,e){var n;this.options=l({},kt.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=new((n=this).options.inputClass||($?tt:P?st:M?at:K))(n,j),this.touchAction=new pt(this,this.options.touchAction),Dt(this,!0),g(this.options.recognizers,(function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])}),this)}function Dt(t,e){var n,r=t.element;r.style&&(g(t.options.cssProps,(function(i,s){n=I(r.style,s),e?(t.oldCssProps[n]=r.style[n],r.style[n]=i):r.style[n]=t.oldCssProps[n]||""})),e||(t.oldCssProps={}))}pt.prototype={set:function(t){"compute"==t&&(t=this.compute()),dt&&this.manager.element.style&&ft[t]&&(this.manager.element.style[ht]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return g(this.manager.recognizers,(function(e){w(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))})),function(t){if(A(t,"none"))return"none";var e=A(t,"pan-x"),n=A(t,"pan-y");return e&&n?"none":e||n?e?"pan-x":"pan-y":A(t,"manipulation")?"manipulation":"auto"}(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,n=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var r=this.actions,i=A(r,"none")&&!ft.none,s=A(r,"pan-y")&&!ft["pan-y"],o=A(r,"pan-x")&&!ft["pan-x"];if(i&&1===t.pointers.length&&t.distance<2&&t.deltaTime<250)return;if(!o||!s)return i||s&&6&n||o&&24&n?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}},mt.prototype={defaults:{},set:function(t){return l(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(m(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=vt(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return m(t,"dropRecognizeWith",this)||(t=vt(t,this),delete this.simultaneous[t.id]),this},requireFailure:function(t){if(m(t,"requireFailure",this))return this;var e=this.requireFail;return-1===N(e,t=vt(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(m(t,"dropRequireFailure",this))return this;t=vt(t,this);var e=N(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,n=this.state;function r(n){e.manager.emit(n,t)}n<8&&r(e.options.event+gt(n)),r(e.options.event),t.additionalEvent&&r(t.additionalEvent),n>=8&&r(e.options.event+gt(n))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=32},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(33&this.requireFail[t].state))return!1;t++}return!0},recognize:function(t){var e=l({},t);if(!w(this.options.enable,[this,e]))return this.reset(),void(this.state=32);56&this.state&&(this.state=1),this.state=this.process(e),30&this.state&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},x(bt,mt,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,n=t.eventType,r=6&e,i=this.attrTest(t);return r&&(8&n||!i)?16|e:r||i?4&n?8|e:2&e?4|e:2:32}}),x(xt,bt,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var t=this.options.direction,e=[];return 6&t&&e.push("pan-y"),24&t&&e.push("pan-x"),e},directionTest:function(t){var e=this.options,n=!0,r=t.distance,i=t.direction,s=t.deltaX,o=t.deltaY;return i&e.direction||(6&e.direction?(i=0===s?1:s<0?2:4,n=s!=this.pX,r=Math.abs(t.deltaX)):(i=0===o?1:o<0?8:16,n=o!=this.pY,r=Math.abs(t.deltaY))),t.direction=i,n&&r>e.threshold&&i&e.direction},attrTest:function(t){return bt.prototype.attrTest.call(this,t)&&(2&this.state||!(2&this.state)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=yt(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),x(_t,bt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||2&this.state)},emit:function(t){1!==t.scale&&(t.additionalEvent=this.options.event+(t.scale<1?"in":"out")),this._super.emit.call(this,t)}}),x(wt,mt,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return["auto"]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,r=t.distance<e.threshold,i=t.deltaTime>e.time;if(this._input=t,!r||!n||12&t.eventType&&!i)this.reset();else if(1&t.eventType)this.reset(),this._timer=p((function(){this.state=8,this.tryEmit()}),e.time,this);else if(4&t.eventType)return 8;return 32},reset:function(){clearTimeout(this._timer)},emit:function(t){8===this.state&&(t&&4&t.eventType?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=f(),this.manager.emit(this.options.event,this._input)))}}),x(St,bt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||2&this.state)}}),x(Ct,bt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return xt.prototype.getTouchAction.call(this)},attrTest:function(t){var e,n=this.options.direction;return 30&n?e=t.overallVelocity:6&n?e=t.overallVelocityX:24&n&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&n&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&d(e)>this.options.velocity&&4&t.eventType},emit:function(t){var e=yt(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),x(Et,mt,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return["manipulation"]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,r=t.distance<e.threshold,i=t.deltaTime<e.time;if(this.reset(),1&t.eventType&&0===this.count)return this.failTimeout();if(r&&i&&n){if(4!=t.eventType)return this.failTimeout();var s=!this.pTime||t.timeStamp-this.pTime<e.interval,o=!this.pCenter||H(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,o&&s?this.count+=1:this.count=1,this._input=t,0==this.count%e.taps)return this.hasRequireFailures()?(this._timer=p((function(){this.state=8,this.tryEmit()}),e.interval,this),2):8}return 32},failTimeout:function(){return this._timer=p((function(){this.state=32}),this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),kt.VERSION="2.0.7",kt.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[St,{enable:!1}],[_t,{enable:!1},["rotate"]],[Ct,{direction:6}],[xt,{direction:6},["swipe"]],[Et],[Et,{event:"doubletap",taps:2},["tap"]],[wt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},At.prototype={set:function(t){return l(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){var n;this.touchAction.preventDefaults(t);var r=this.recognizers,i=e.curRecognizer;(!i||i&&8&i.state)&&(i=e.curRecognizer=null);for(var s=0;s<r.length;)n=r[s],2===e.stopped||i&&n!=i&&!n.canRecognizeWith(i)?n.reset():n.recognize(t),!i&&14&n.state&&(i=e.curRecognizer=n),s++}},get:function(t){if(t instanceof mt)return t;for(var e=this.recognizers,n=0;n<e.length;n++)if(e[n].options.event==t)return e[n];return null},add:function(t){if(m(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(m(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,n=N(e,t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this},on:function(t,e){if(void 0!==t&&void 0!==e){var n=this.handlers;return g(D(t),(function(t){n[t]=n[t]||[],n[t].push(e)})),this}},off:function(t,e){if(void 0!==t){var n=this.handlers;return g(D(t),(function(t){e?n[t]&&n[t].splice(N(n[t],e),1):delete n[t]})),this}},emit:function(t,e){this.options.domEvents&&function(t,e){var n=s.createEvent("Event");n.initEvent(t,!0,!0),n.gesture=e,e.target.dispatchEvent(n)}(t,e);var n=this.handlers[t]&&this.handlers[t].slice();if(n&&n.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var r=0;r<n.length;)n[r](e),r++}},destroy:function(){this.element&&Dt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},l(kt,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:32,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:24,DIRECTION_ALL:30,Manager:At,Input:B,TouchAction:pt,TouchInput:st,MouseInput:K,PointerEventInput:tt,TouchMouseInput:at,SingleTouchInput:nt,Recognizer:mt,AttrRecognizer:bt,Tap:Et,Pan:xt,Swipe:Ct,Pinch:_t,Rotate:St,Press:wt,on:C,off:E,each:g,merge:b,extend:v,assign:l,inherit:x,bindFn:_,prefixed:I}),(void 0!==i?i:"undefined"!=typeof self?self:{}).Hammer=kt,void 0===(r=(function(){return kt}).call(e,n,e,t))||(t.exports=r)}(window,document)},"ytq/":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n){"flexDirection"===t&&"string"==typeof e&&(n.WebkitBoxOrient=e.indexOf("column")>-1?"vertical":"horizontal",n.WebkitBoxDirection=e.indexOf("reverse")>-1?"reverse":"normal"),i.hasOwnProperty(t)&&(n[i[t]]=r[e]||e)};var r={"space-around":"justify","space-between":"justify","flex-start":"start","flex-end":"end","wrap-reverse":"multiple",wrap:"multiple"},i={alignItems:"WebkitBoxAlign",justifyContent:"WebkitBoxPack",flexWrap:"WebkitBoxLines"};t.exports=e.default},yuCN:function(t,e,n){(function(t){var r;!function(t,i,s){function o(t){var e=this;e.next=function(){var t,n,r=e.x,i=e.i;return t=r[i],n=(t^=t>>>7)^t<<24,n^=(t=r[i+1&7])^t>>>10,n^=(t=r[i+3&7])^t>>>3,n^=(t=r[i+4&7])^t<<7,t=r[i+7&7],r[i]=n^=(t^=t<<13)^t<<9,e.i=i+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n&&(r[7]=-1),t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function a(t,e){return e.x=t.x.slice(),e.i=t.i,e}function l(t,e){null==t&&(t=+new Date);var n=new o(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,r&&(r.x&&a(r,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=l:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return l}).call(e,n,e,i))||(i.exports=r):this.xorshift7=l}(0,t,n("B9Yq"))}).call(this,n("YuTi")(t))},zUnb:function(t,e,n){"use strict";function r(t){return"function"==typeof t}n.r(e);let i=!1;const s={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){if(t){const t=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+t.stack)}else i&&console.log("RxJS: Back to a better error behavior. Thank you. <3");i=t},get useDeprecatedSynchronousErrorHandling(){return i}};function o(t){setTimeout(()=>{throw t})}const a={closed:!0,next(t){},error(t){if(s.useDeprecatedSynchronousErrorHandling)throw t;o(t)},complete(){}},l=Array.isArray||(t=>t&&"number"==typeof t.length);function u(t){return null!==t&&"object"==typeof t}function c(t){return Error.call(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((t,e)=>`${e+1}) ${t.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t,this}c.prototype=Object.create(Error.prototype);const h=c;let d=(()=>{class t{constructor(t){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}unsubscribe(){let t,e=!1;if(this.closed)return;let{_parent:n,_parents:i,_unsubscribe:s,_subscriptions:o}=this;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;let a=-1,c=i?i.length:0;for(;n;)n.remove(this),n=++a<c&&i[a]||null;if(r(s))try{s.call(this)}catch(d){e=!0,t=d instanceof h?f(d.errors):[d]}if(l(o))for(a=-1,c=o.length;++a<c;){const n=o[a];if(u(n))try{n.unsubscribe()}catch(d){e=!0,t=t||[],d instanceof h?t=t.concat(f(d.errors)):t.push(d)}}if(e)throw new h(t)}add(e){let n=e;switch(typeof e){case"function":n=new t(e);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof t)){const e=n;n=new t,n._subscriptions=[e]}break;default:if(!e)return t.EMPTY;throw new Error("unrecognized teardown "+e+" added to Subscription.")}if(n._addParent(this)){const t=this._subscriptions;t?t.push(n):this._subscriptions=[n]}return n}remove(t){const e=this._subscriptions;if(e){const n=e.indexOf(t);-1!==n&&e.splice(n,1)}}_addParent(t){let{_parent:e,_parents:n}=this;return e!==t&&(e?n?-1===n.indexOf(t)&&(n.push(t),!0):(this._parents=[t],!0):(this._parent=t,!0))}}return t.EMPTY=function(t){return t.closed=!0,t}(new t),t})();function f(t){return t.reduce((t,e)=>t.concat(e instanceof h?e.errors:e),[])}const p="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random();class m extends d{constructor(t,e,n){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=a;break;case 1:if(!t){this.destination=a;break}if("object"==typeof t){t instanceof m?(this.syncErrorThrowable=t.syncErrorThrowable,this.destination=t,t.add(this)):(this.syncErrorThrowable=!0,this.destination=new g(this,t));break}default:this.syncErrorThrowable=!0,this.destination=new g(this,t,e,n)}}[p](){return this}static create(t,e,n){const r=new m(t,e,n);return r.syncErrorThrowable=!1,r}next(t){this.isStopped||this._next(t)}error(t){this.isStopped||(this.isStopped=!0,this._error(t))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(t){this.destination.next(t)}_error(t){this.destination.error(t),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parent:t,_parents:e}=this;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=t,this._parents=e,this}}class g extends m{constructor(t,e,n,i){let s;super(),this._parentSubscriber=t;let o=this;r(e)?s=e:e&&(s=e.next,n=e.error,i=e.complete,e!==a&&(o=Object.create(e),r(o.unsubscribe)&&this.add(o.unsubscribe.bind(o)),o.unsubscribe=this.unsubscribe.bind(this))),this._context=o,this._next=s,this._error=n,this._complete=i}next(t){if(!this.isStopped&&this._next){const{_parentSubscriber:e}=this;s.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}}error(t){if(!this.isStopped){const{_parentSubscriber:e}=this,{useDeprecatedSynchronousErrorHandling:n}=s;if(this._error)n&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)n?(e.syncErrorValue=t,e.syncErrorThrown=!0):o(t),this.unsubscribe();else{if(this.unsubscribe(),n)throw t;o(t)}}}complete(){if(!this.isStopped){const{_parentSubscriber:t}=this;if(this._complete){const e=()=>this._complete.call(this._context);s.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,e),this.unsubscribe()):(this.__tryOrUnsub(e),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(t,e){try{t.call(this._context,e)}catch(n){if(this.unsubscribe(),s.useDeprecatedSynchronousErrorHandling)throw n;o(n)}}__tryOrSetError(t,e,n){if(!s.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,n)}catch(r){return s.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=r,t.syncErrorThrown=!0,!0):(o(r),!0)}return!1}_unsubscribe(){const{_parentSubscriber:t}=this;this._context=null,this._parentSubscriber=null,t.unsubscribe()}}const y="function"==typeof Symbol&&Symbol.observable||"@@observable";function v(){}function b(...t){return x(t)}function x(t){return t?1===t.length?t[0]:function(e){return t.reduce((t,e)=>e(t),e)}:v}let _=(()=>{class t{constructor(t){this._isScalar=!1,t&&(this._subscribe=t)}lift(e){const n=new t;return n.source=this,n.operator=e,n}subscribe(t,e,n){const{operator:r}=this,i=function(t,e,n){if(t){if(t instanceof m)return t;if(t[p])return t[p]()}return t||e||n?new m(t,e,n):new m(a)}(t,e,n);if(i.add(r?r.call(i,this.source):this.source||s.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),s.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i}_trySubscribe(t){try{return this._subscribe(t)}catch(e){s.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),function(t){for(;t;){const{closed:e,destination:n,isStopped:r}=t;if(e||r)return!1;t=n&&n instanceof m?n:null}return!0}(t)?t.error(e):console.warn(e)}}forEach(t,e){return new(e=w(e))((e,n)=>{let r;r=this.subscribe(e=>{try{t(e)}catch(i){n(i),r&&r.unsubscribe()}},n,e)})}_subscribe(t){const{source:e}=this;return e&&e.subscribe(t)}[y](){return this}pipe(...t){return 0===t.length?this:x(t)(this)}toPromise(t){return new(t=w(t))((t,e)=>{let n;this.subscribe(t=>n=t,t=>e(t),()=>t(n))})}}return t.create=e=>new t(e),t})();function w(t){if(t||(t=s.Promise||Promise),!t)throw new Error("no Promise impl found");return t}function S(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}S.prototype=Object.create(Error.prototype);const C=S;class E extends d{constructor(t,e){super(),this.subject=t,this.subscriber=e,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const t=this.subject,e=t.observers;if(this.subject=null,!e||0===e.length||t.isStopped||t.closed)return;const n=e.indexOf(this.subscriber);-1!==n&&e.splice(n,1)}}class k extends m{constructor(t){super(t),this.destination=t}}let A=(()=>{class t extends _{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[p](){return new k(this)}lift(t){const e=new D(this,this);return e.operator=t,e}next(t){if(this.closed)throw new C;if(!this.isStopped){const{observers:e}=this,n=e.length,r=e.slice();for(let i=0;i<n;i++)r[i].next(t)}}error(t){if(this.closed)throw new C;this.hasError=!0,this.thrownError=t,this.isStopped=!0;const{observers:e}=this,n=e.length,r=e.slice();for(let i=0;i<n;i++)r[i].error(t);this.observers.length=0}complete(){if(this.closed)throw new C;this.isStopped=!0;const{observers:t}=this,e=t.length,n=t.slice();for(let r=0;r<e;r++)n[r].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(t){if(this.closed)throw new C;return super._trySubscribe(t)}_subscribe(t){if(this.closed)throw new C;return this.hasError?(t.error(this.thrownError),d.EMPTY):this.isStopped?(t.complete(),d.EMPTY):(this.observers.push(t),new E(this,t))}asObservable(){const t=new _;return t.source=this,t}}return t.create=(t,e)=>new D(t,e),t})();class D extends A{constructor(t,e){super(),this.destination=t,this.source=e}next(t){const{destination:e}=this;e&&e.next&&e.next(t)}error(t){const{destination:e}=this;e&&e.error&&this.destination.error(t)}complete(){const{destination:t}=this;t&&t.complete&&this.destination.complete()}_subscribe(t){const{source:e}=this;return e?this.source.subscribe(t):d.EMPTY}}function N(t){return t&&"function"==typeof t.schedule}class T extends m{constructor(t,e,n){super(),this.parent=t,this.outerValue=e,this.outerIndex=n,this.index=0}_next(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)}_error(t){this.parent.notifyError(t,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}const O=t=>e=>{for(let n=0,r=t.length;n<r&&!e.closed;n++)e.next(t[n]);e.closed||e.complete()},I=t=>e=>(t.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,o),e);function R(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}const F=R(),M=t=>e=>{const n=t[F]();for(;;){const t=n.next();if(t.done){e.complete();break}if(e.next(t.value),e.closed)break}return"function"==typeof n.return&&e.add(()=>{n.return&&n.return()}),e},$=t=>e=>{const n=t[y]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(e)},P=t=>t&&"number"==typeof t.length&&"function"!=typeof t;function z(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}const L=t=>{if(t instanceof _)return e=>t._isScalar?(e.next(t.value),void e.complete()):t.subscribe(e);if(t&&"function"==typeof t[y])return $(t);if(P(t))return O(t);if(z(t))return I(t);if(t&&"function"==typeof t[F])return M(t);{const e=u(t)?"an invalid object":`'${t}'`;throw new TypeError(`You provided ${e} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`)}};function B(t,e,n,r,i=new T(t,n,r)){if(!i.closed)return L(e)(i)}class j extends m{notifyNext(t,e,n,r,i){this.destination.next(e)}notifyError(t,e){this.destination.error(t)}notifyComplete(t){this.destination.complete()}}function U(t,e){return function(n){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new V(t,e))}}class V{constructor(t,e){this.project=t,this.thisArg=e}call(t,e){return e.subscribe(new W(t,this.project,this.thisArg))}}class W extends m{constructor(t,e,n){super(t),this.project=e,this.count=0,this.thisArg=n||this}_next(t){let e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(n){return void this.destination.error(n)}this.destination.next(e)}}function q(t,e){return new _(e?n=>{const r=new d;let i=0;return r.add(e.schedule((function(){i!==t.length?(n.next(t[i++]),n.closed||r.add(this.schedule())):n.complete()}))),r}:O(t))}function H(t,e){if(!e)return t instanceof _?t:new _(L(t));if(null!=t){if(function(t){return t&&"function"==typeof t[y]}(t))return function(t,e){return new _(e?n=>{const r=new d;return r.add(e.schedule(()=>{const i=t[y]();r.add(i.subscribe({next(t){r.add(e.schedule(()=>n.next(t)))},error(t){r.add(e.schedule(()=>n.error(t)))},complete(){r.add(e.schedule(()=>n.complete()))}}))})),r}:$(t))}(t,e);if(z(t))return function(t,e){return new _(e?n=>{const r=new d;return r.add(e.schedule(()=>t.then(t=>{r.add(e.schedule(()=>{n.next(t),r.add(e.schedule(()=>n.complete()))}))},t=>{r.add(e.schedule(()=>n.error(t)))}))),r}:I(t))}(t,e);if(P(t))return q(t,e);if(function(t){return t&&"function"==typeof t[F]}(t)||"string"==typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new _(e?n=>{const r=new d;let i;return r.add(()=>{i&&"function"==typeof i.return&&i.return()}),r.add(e.schedule(()=>{i=t[F](),r.add(e.schedule((function(){if(n.closed)return;let t,e;try{const n=i.next();t=n.value,e=n.done}catch(r){return void n.error(r)}e?n.complete():(n.next(t),this.schedule())})))})),r}:M(t))}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}function G(t,e,n=Number.POSITIVE_INFINITY){return"function"==typeof e?r=>r.pipe(G((n,r)=>H(t(n,r)).pipe(U((t,i)=>e(n,t,r,i))),n)):("number"==typeof e&&(n=e),e=>e.lift(new Y(t,n)))}class Y{constructor(t,e=Number.POSITIVE_INFINITY){this.project=t,this.concurrent=e}call(t,e){return e.subscribe(new K(t,this.project,this.concurrent))}}class K extends j{constructor(t,e,n=Number.POSITIVE_INFINITY){super(t),this.project=e,this.concurrent=n,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)}_tryNext(t){let e;const n=this.index++;try{e=this.project(t,n)}catch(r){return void this.destination.error(r)}this.active++,this._innerSub(e,t,n)}_innerSub(t,e,n){const r=new T(this,void 0,void 0);this.destination.add(r),B(this,t,e,n,r)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(t,e,n,r,i){this.destination.next(e)}notifyComplete(t){const e=this.buffer;this.remove(t),this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}function X(t){return t}function Z(t=Number.POSITIVE_INFINITY){return G(X,t)}function Q(...t){let e=Number.POSITIVE_INFINITY,n=null,r=t[t.length-1];return N(r)?(n=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(e=t.pop())):"number"==typeof r&&(e=t.pop()),null===n&&1===t.length&&t[0]instanceof _?t[0]:Z(e)(q(t,n))}function J(){return function(t){return t.lift(new tt(t))}}class tt{constructor(t){this.connectable=t}call(t,e){const{connectable:n}=this;n._refCount++;const r=new et(t,n),i=e.subscribe(r);return r.closed||(r.connection=n.connect()),i}}class et extends m{constructor(t,e){super(t),this.connectable=e}_unsubscribe(){const{connectable:t}=this;if(!t)return void(this.connection=null);this.connectable=null;const e=t._refCount;if(e<=0)return void(this.connection=null);if(t._refCount=e-1,e>1)return void(this.connection=null);const{connection:n}=this,r=t._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}const nt=class extends _{constructor(t,e){super(),this.source=t,this.subjectFactory=e,this._refCount=0,this._isComplete=!1}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject}connect(){let t=this._connection;return t||(this._isComplete=!1,t=this._connection=new d,t.add(this.source.subscribe(new it(this.getSubject(),this))),t.closed?(this._connection=null,t=d.EMPTY):this._connection=t),t}refCount(){return J()(this)}}.prototype,rt={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:nt._subscribe},_isComplete:{value:nt._isComplete,writable:!0},getSubject:{value:nt.getSubject},connect:{value:nt.connect},refCount:{value:nt.refCount}};class it extends k{constructor(t,e){super(t),this.connectable=e}_error(t){this._unsubscribe(),super._error(t)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const t=this.connectable;if(t){this.connectable=null;const e=t._connection;t._refCount=0,t._subject=null,t._connection=null,e&&e.unsubscribe()}}}function st(){return new A}function ot(){return t=>{return J()((e=st,function(t){let n;n="function"==typeof e?e:function(){return e};const r=Object.create(t,rt);return r.source=t,r.subjectFactory=n,r})(t));var e}}function at(t,e,n){const r=function(t){return function(...e){if(t){const n=t(...e);for(const t in n)this[t]=n[t]}}}(e);function i(...t){if(this instanceof i)return r.apply(this,t),this;const e=new i(...t);return n.annotation=e,n;function n(t,n,r){const i=t.hasOwnProperty("__parameters__")?t.__parameters__:Object.defineProperty(t,"__parameters__",{value:[]}).__parameters__;for(;i.length<=r;)i.push(null);return(i[r]=i[r]||[]).push(e),t}}return n&&(i.prototype=Object.create(n.prototype)),i.prototype.ngMetadataName=t,i.annotationCls=i,i}const lt=at("Inject",t=>({token:t})),ut=at("Optional"),ct=at("Self"),ht=at("SkipSelf");var dt=function(t){return t[t.Default=0]="Default",t[t.Host=1]="Host",t[t.Self=2]="Self",t[t.SkipSelf=4]="SkipSelf",t[t.Optional=8]="Optional",t}({});function ft(t){for(let e in t)if(t[e]===ft)return e;throw Error("Could not find renamed property on target object.")}function pt(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function mt(t){const e=t[gt];return e&&e.token===t?e:null}const gt=ft({ngInjectableDef:ft});function yt(t){if("string"==typeof t)return t;if(t instanceof Array)return"["+t.map(yt).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return""+t.overriddenName;if(t.name)return""+t.name;const e=t.toString();if(null==e)return""+e;const n=e.indexOf("\n");return-1===n?e:e.substring(0,n)}const vt=ft({__forward_ref__:ft});function bt(t){return t.__forward_ref__=bt,t.toString=function(){return yt(this())},t}function xt(t){const e=t;return"function"==typeof e&&e.hasOwnProperty(vt)&&e.__forward_ref__===bt?e():t}const _t="undefined"!=typeof globalThis&&globalThis,wt="undefined"!=typeof window&&window,St="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Ct="undefined"!=typeof global&&global,Et=_t||Ct||wt||St;class kt{constructor(t,e){this._desc=t,this.ngMetadataName="InjectionToken",this.ngInjectableDef=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.ngInjectableDef=pt({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}toString(){return"InjectionToken "+this._desc}}const At=new kt("INJECTOR",-1),Dt=new Object,Nt=/\n/gm,Tt=ft({provide:String,useValue:ft});let Ot=void 0;function It(t){const e=Ot;return Ot=t,e}function Rt(t,e=dt.Default){return function(t,e=dt.Default){if(void 0===Ot)throw new Error("inject() must be called from an injection context");return null===Ot?function(t,e,n){const r=mt(t);if(r&&"root"==r.providedIn)return void 0===r.value?r.value=r.factory():r.value;if(n&dt.Optional)return null;throw new Error(`Injector: NOT_FOUND [${yt(t)}]`)}(t,0,e):Ot.get(t,e&dt.Optional?null:void 0,e)}(t,e)}const Ft=Rt;class Mt{get(t,e=Dt){if(e===Dt){const e=new Error(`NullInjectorError: No provider for ${yt(t)}!`);throw e.name="NullInjectorError",e}return e}}function $t(t,e,n,r=null){t=t&&"\n"===t.charAt(0)&&"\u0275"==t.charAt(1)?t.substr(2):t;let i=yt(e);if(e instanceof Array)i=e.map(yt).join(" -> ");else if("object"==typeof e){let t=[];for(let n in e)if(e.hasOwnProperty(n)){let r=e[n];t.push(n+":"+("string"==typeof r?JSON.stringify(r):yt(r)))}i=`{${t.join(", ")}}`}return`${n}${r?"("+r+")":""}[${i}]: ${t.replace(Nt,"\n  ")}`}class Pt{}class zt{}function Lt(t,e,n){e>=t.length?t.push(n):t.splice(e,0,n)}function Bt(t,e){return e>=t.length-1?t.pop():t.splice(e,1)[0]}const jt=function(){var t={Emulated:0,Native:1,None:2,ShadowDom:3};return t[t.Emulated]="Emulated",t[t.Native]="Native",t[t.None]="None",t[t.ShadowDom]="ShadowDom",t}(),Ut=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Et))();function Vt(t){return t.ngDebugContext}function Wt(t){return t.ngOriginalError}function qt(t,...e){t.error(...e)}class Ht{constructor(){this._console=console}handleError(t){const e=this._findOriginalError(t),n=this._findContext(t),r=function(t){return t.ngErrorLogger||qt}(t);r(this._console,"ERROR",t),e&&r(this._console,"ORIGINAL ERROR",e),n&&r(this._console,"ERROR CONTEXT",n)}_findContext(t){return t?Vt(t)?Vt(t):this._findContext(Wt(t)):null}_findOriginalError(t){let e=Wt(t);for(;e&&Wt(e);)e=Wt(e);return e}}let Gt=!0,Yt=!1;function Kt(){return Yt=!0,Gt}class Xt{constructor(t){if(this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),this.inertBodyElement=this.inertDocument.body,null==this.inertBodyElement){const t=this.inertDocument.createElement("html");this.inertDocument.appendChild(t),this.inertBodyElement=this.inertDocument.createElement("body"),t.appendChild(this.inertBodyElement)}this.inertBodyElement.innerHTML='<svg><g onload="this.parentNode.remove()"></g></svg>',!this.inertBodyElement.querySelector||this.inertBodyElement.querySelector("svg")?(this.inertBodyElement.innerHTML='<svg><p><style><img src="</style><img src=x onerror=alert(1)//">',this.getInertBodyElement=this.inertBodyElement.querySelector&&this.inertBodyElement.querySelector("svg img")&&function(){try{return!!window.DOMParser}catch(t){return!1}}()?this.getInertBodyElement_DOMParser:this.getInertBodyElement_InertDocument):this.getInertBodyElement=this.getInertBodyElement_XHR}getInertBodyElement_XHR(t){t="<body><remove></remove>"+t+"</body>";try{t=encodeURI(t)}catch(r){return null}const e=new XMLHttpRequest;e.responseType="document",e.open("GET","data:text/html;charset=utf-8,"+t,!1),e.send(void 0);const n=e.response.body;return n.removeChild(n.firstChild),n}getInertBodyElement_DOMParser(t){t="<body><remove></remove>"+t+"</body>";try{const e=(new window.DOMParser).parseFromString(t,"text/html").body;return e.removeChild(e.firstChild),e}catch(e){return null}}getInertBodyElement_InertDocument(t){const e=this.inertDocument.createElement("template");return"content"in e?(e.innerHTML=t,e):(this.inertBodyElement.innerHTML=t,this.defaultDoc.documentMode&&this.stripCustomNsAttrs(this.inertBodyElement),this.inertBodyElement)}stripCustomNsAttrs(t){const e=t.attributes;for(let r=e.length-1;0<r;r--){const n=e.item(r).name;"xmlns:ns1"!==n&&0!==n.indexOf("ns1:")||t.removeAttribute(n)}let n=t.firstChild;for(;n;)n.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(n),n=n.nextSibling}}const Zt=/^(?:(?:https?|mailto|ftp|tel|file):|[^&:/?#]*(?:[/?#]|$))/gi,Qt=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function Jt(t){return(t=String(t)).match(Zt)||t.match(Qt)?t:(Kt()&&console.warn(`WARNING: sanitizing unsafe URL value ${t} (see http://g.co/ng/security#xss)`),"unsafe:"+t)}function te(t){const e={};for(const n of t.split(","))e[n]=!0;return e}function ee(...t){const e={};for(const n of t)for(const t in n)n.hasOwnProperty(t)&&(e[t]=!0);return e}const ne=te("area,br,col,hr,img,wbr"),re=te("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),ie=te("rp,rt"),se=ee(ie,re),oe=ee(ne,ee(re,te("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),ee(ie,te("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),se),ae=te("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),le=te("srcset"),ue=ee(ae,le,te("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),te("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),ce=te("script,style,template");class he{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(t){let e=t.firstChild,n=!0;for(;e;)if(e.nodeType===Node.ELEMENT_NODE?n=this.startElement(e):e.nodeType===Node.TEXT_NODE?this.chars(e.nodeValue):this.sanitizedSomething=!0,n&&e.firstChild)e=e.firstChild;else for(;e;){e.nodeType===Node.ELEMENT_NODE&&this.endElement(e);let t=this.checkClobberedElement(e,e.nextSibling);if(t){e=t;break}e=this.checkClobberedElement(e,e.parentNode)}return this.buf.join("")}startElement(t){const e=t.nodeName.toLowerCase();if(!oe.hasOwnProperty(e))return this.sanitizedSomething=!0,!ce.hasOwnProperty(e);this.buf.push("<"),this.buf.push(e);const n=t.attributes;for(let i=0;i<n.length;i++){const t=n.item(i),e=t.name,s=e.toLowerCase();if(!ue.hasOwnProperty(s)){this.sanitizedSomething=!0;continue}let o=t.value;ae[s]&&(o=Jt(o)),le[s]&&(r=o,o=(r=String(r)).split(",").map(t=>Jt(t.trim())).join(", ")),this.buf.push(" ",e,'="',pe(o),'"')}var r;return this.buf.push(">"),!0}endElement(t){const e=t.nodeName.toLowerCase();oe.hasOwnProperty(e)&&!ne.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))}chars(t){this.buf.push(pe(t))}checkClobberedElement(t,e){if(e&&(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error("Failed to sanitize html because the element is clobbered: "+t.outerHTML);return e}}const de=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,fe=/([^\#-~ |!])/g;function pe(t){return t.replace(/&/g,"&amp;").replace(de,(function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"})).replace(fe,(function(t){return"&#"+t.charCodeAt(0)+";"})).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let me;function ge(t){return"content"in t&&function(t){return t.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===t.nodeName}(t)?t.content:null}const ye=function(){var t={NONE:0,HTML:1,STYLE:2,SCRIPT:3,URL:4,RESOURCE_URL:5};return t[t.NONE]="NONE",t[t.HTML]="HTML",t[t.STYLE]="STYLE",t[t.SCRIPT]="SCRIPT",t[t.URL]="URL",t[t.RESOURCE_URL]="RESOURCE_URL",t}();class ve{}const be=new RegExp("^([-,.\"'%_!# a-zA-Z0-9]+|(?:(?:matrix|translate|scale|rotate|skew|perspective)(?:X|Y|Z|3d)?|(?:rgb|hsl)a?|(?:repeating-)?(?:linear|radial)-gradient|(?:calc|attr))\\([-0-9.%, #a-zA-Z]+\\))$","g"),xe=/^url\(([^)]+)\)$/,_e=/([A-Z])/g;function we(t){try{return null!=t?t.toString().slice(0,30):t}catch(e){return"[ERROR] Exception while trying to serialize the value"}}let Se=(()=>{class t{}return t.__NG_ELEMENT_ID__=()=>Ce(),t})();const Ce=(...t)=>{},Ee=new kt("The presence of this token marks an injector as being the root injector."),ke=function(t,e,n){return new Ie(t,e,n)};let Ae=(()=>{class t{static create(t,e){return Array.isArray(t)?ke(t,e,""):ke(t.providers,t.parent,t.name||"")}}return t.THROW_IF_NOT_FOUND=Dt,t.NULL=new Mt,t.ngInjectableDef=pt({token:t,providedIn:"any",factory:()=>Rt(At)}),t.__NG_ELEMENT_ID__=-1,t})();const De=function(t){return t},Ne=[],Te=De,Oe=function(){return Array.prototype.slice.call(arguments)};class Ie{constructor(t,e=Ae.NULL,n=null){this.parent=e,this.source=n;const r=this._records=new Map;r.set(Ae,{token:Ae,fn:De,deps:Ne,value:this,useNew:!1}),r.set(At,{token:At,fn:De,deps:Ne,value:this,useNew:!1}),function t(e,n){if(n)if((n=xt(n))instanceof Array)for(let r=0;r<n.length;r++)t(e,n[r]);else{if("function"==typeof n)throw Fe("Function/Class not supported",n);if(!n||"object"!=typeof n||!n.provide)throw Fe("Unexpected provider",n);{let t=xt(n.provide);const r=function(t){const e=function(t){let e=Ne;const n=t.deps;if(n&&n.length){e=[];for(let t=0;t<n.length;t++){let r=6,i=xt(n[t]);if(i instanceof Array)for(let t=0,e=i;t<e.length;t++){const n=e[t];n instanceof ut||n==ut?r|=1:n instanceof ht||n==ht?r&=-3:n instanceof ct||n==ct?r&=-5:i=n instanceof lt?n.token:xt(n)}e.push({token:i,options:r})}}else if(t.useExisting)e=[{token:xt(t.useExisting),options:6}];else if(!n&&!(Tt in t))throw Fe("'deps' required",t);return e}(t);let n=De,r=Ne,i=!1,s=xt(t.provide);if(Tt in t)r=t.useValue;else if(t.useFactory)n=t.useFactory;else if(t.useExisting);else if(t.useClass)i=!0,n=xt(t.useClass);else{if("function"!=typeof s)throw Fe("StaticProvider does not have [useValue|useFactory|useExisting|useClass] or [provide] is not newable",t);i=!0,n=s}return{deps:e,fn:n,useNew:i,value:r}}(n);if(!0===n.multi){let r=e.get(t);if(r){if(r.fn!==Oe)throw Re(t)}else e.set(t,r={token:n.provide,deps:[],useNew:!1,fn:Oe,value:Ne});t=n,r.deps.push({token:t,options:6})}const i=e.get(t);if(i&&i.fn==Oe)throw Re(t);e.set(t,r)}}}(r,t)}get(t,e,n=dt.Default){const r=this._records.get(t);try{return function t(e,n,r,i,s,o){try{return function(e,n,r,i,s,o){let a;if(!n||o&dt.SkipSelf)o&dt.Self||(a=i.get(e,s,dt.Default));else{if(a=n.value,a==Te)throw Error("\u0275Circular dependency");if(a===Ne){n.value=Te;let e=void 0,s=n.useNew,o=n.fn,l=n.deps,u=Ne;if(l.length){u=[];for(let e=0;e<l.length;e++){const n=l[e],s=n.options,o=2&s?r.get(n.token):void 0;u.push(t(n.token,o,r,o||4&s?i:Ae.NULL,1&s?null:Ae.THROW_IF_NOT_FOUND,dt.Default))}}n.value=a=s?new o(...u):o.apply(e,u)}}return a}(e,n,r,i,s,o)}catch(a){throw a instanceof Error||(a=new Error(a)),(a.ngTempTokenPath=a.ngTempTokenPath||[]).unshift(e),n&&n.value==Te&&(n.value=Ne),a}}(t,r,this._records,this.parent,e,n)}catch(i){return function(t,e,n,r){const i=t.ngTempTokenPath;throw e.__source&&i.unshift(e.__source),t.message=$t("\n"+t.message,i,"StaticInjectorError",r),t.ngTokenPath=i,t.ngTempTokenPath=null,t}(i,t,0,this.source)}}toString(){const t=[];return this._records.forEach((e,n)=>t.push(yt(n))),`StaticInjector[${t.join(", ")}]`}}function Re(t){return Fe("Cannot mix multi providers and regular providers",t)}function Fe(t,e){return new Error($t(t,e,"StaticInjectorError"))}const Me=new kt("AnalyzeForEntryComponents");let $e=null;function Pe(){if(!$e){const t=Et.Symbol;if(t&&t.iterator)$e=t.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let e=0;e<t.length;++e){const n=t[e];"entries"!==n&&"size"!==n&&Map.prototype[n]===Map.prototype.entries&&($e=n)}}}return $e}function ze(t,e){return t===e||"number"==typeof t&&"number"==typeof e&&isNaN(t)&&isNaN(e)}function Le(t,e){const n=je(t),r=je(e);if(n&&r)return function(t,e,n){const r=t[Pe()](),i=e[Pe()]();for(;;){const t=r.next(),e=i.next();if(t.done&&e.done)return!0;if(t.done||e.done)return!1;if(!n(t.value,e.value))return!1}}(t,e,Le);{const i=t&&("object"==typeof t||"function"==typeof t),s=e&&("object"==typeof e||"function"==typeof e);return!(n||!i||r||!s)||ze(t,e)}}class Be{constructor(t){this.wrapped=t}static wrap(t){return new Be(t)}static unwrap(t){return Be.isWrapped(t)?t.wrapped:t}static isWrapped(t){return t instanceof Be}}function je(t){return!!Ue(t)&&(Array.isArray(t)||!(t instanceof Map)&&Pe()in t)}function Ue(t){return null!==t&&("function"==typeof t||"object"==typeof t)}function Ve(t){return!!t&&"function"==typeof t.then}function We(t){return!!t&&"function"==typeof t.subscribe}class qe{constructor(t,e,n){this.previousValue=t,this.currentValue=e,this.firstChange=n}isFirstChange(){return this.firstChange}}class He{}function Ge(t){const e=Error(`No component factory found for ${yt(t)}. Did you add it to @NgModule.entryComponents?`);return e[Ye]=t,e}const Ye="ngComponent";class Ke{resolveComponentFactory(t){throw Ge(t)}}let Xe=(()=>{class t{}return t.NULL=new Ke,t})();class Ze{constructor(t,e,n){this._parent=e,this._ngModule=n,this._factories=new Map;for(let r=0;r<t.length;r++){const e=t[r];this._factories.set(e.componentType,e)}}resolveComponentFactory(t){let e=this._factories.get(t);if(!e&&this._parent&&(e=this._parent.resolveComponentFactory(t)),!e)throw Ge(t);return new Qe(e,this._ngModule)}}class Qe extends He{constructor(t,e){super(),this.factory=t,this.ngModule=e,this.selector=t.selector,this.componentType=t.componentType,this.ngContentSelectors=t.ngContentSelectors,this.inputs=t.inputs,this.outputs=t.outputs}create(t,e,n,r){return this.factory.create(t,e,n,r||this.ngModule)}}function Je(...t){}let tn=(()=>{class t{constructor(t){this.nativeElement=t}}return t.__NG_ELEMENT_ID__=()=>en(t),t})();const en=Je;class nn{}class rn{}const sn=function(){var t={Important:1,DashCase:2};return t[t.Important]="Important",t[t.DashCase]="DashCase",t}();let on=(()=>{class t{}return t.__NG_ELEMENT_ID__=()=>an(),t})();const an=Je;class ln{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const un=new ln("8.2.14");class cn{constructor(){}supports(t){return je(t)}create(t){return new dn(t)}}const hn=(t,e)=>e;class dn{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||hn}forEachItem(t){let e;for(e=this._itHead;null!==e;e=e._next)t(e)}forEachOperation(t){let e=this._itHead,n=this._removalsHead,r=0,i=null;for(;e||n;){const s=!n||e&&e.currentIndex<gn(n,r,i)?e:n,o=gn(s,r,i),a=s.currentIndex;if(s===n)r--,n=n._nextRemoved;else if(e=e._next,null==s.previousIndex)r++;else{i||(i=[]);const t=o-r,e=a-r;if(t!=e){for(let n=0;n<t;n++){const r=n<i.length?i[n]:i[n]=0,s=r+n;e<=s&&s<t&&(i[n]=r+1)}i[s.previousIndex]=e-t}}o!==a&&t(s,o,a)}}forEachPreviousItem(t){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachMovedItem(t){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}forEachIdentityChange(t){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)t(e)}diff(t){if(null==t&&(t=[]),!je(t))throw new Error(`Error trying to diff '${yt(t)}'. Only arrays and iterables are allowed`);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e,n,r,i=this._itHead,s=!1;if(Array.isArray(t)){this.length=t.length;for(let e=0;e<this.length;e++)n=t[e],r=this._trackByFn(e,n),null!==i&&ze(i.trackById,r)?(s&&(i=this._verifyReinsertion(i,n,r,e)),ze(i.item,n)||this._addIdentityChange(i,n)):(i=this._mismatch(i,n,r,e),s=!0),i=i._next}else e=0,function(t,e){if(Array.isArray(t))for(let n=0;n<t.length;n++)e(t[n]);else{const n=t[Pe()]();let r;for(;!(r=n.next()).done;)e(r.value)}}(t,t=>{r=this._trackByFn(e,t),null!==i&&ze(i.trackById,r)?(s&&(i=this._verifyReinsertion(i,t,r,e)),ze(i.item,t)||this._addIdentityChange(i,t)):(i=this._mismatch(i,t,r,e),s=!0),i=i._next,e++}),this.length=e;return this._truncate(i),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t,e;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=e)t.previousIndex=t.currentIndex,e=t._nextMoved;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,e,n,r){let i;return null===t?i=this._itTail:(i=t._prev,this._remove(t)),null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(n,r))?(ze(t.item,e)||this._addIdentityChange(t,e),this._moveAfter(t,i,r)):null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(ze(t.item,e)||this._addIdentityChange(t,e),this._reinsertAfter(t,i,r)):t=this._addAfter(new fn(e,n),i,r),t}_verifyReinsertion(t,e,n,r){let i=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==i?t=this._reinsertAfter(i,t._prev,r):t.currentIndex!=r&&(t.currentIndex=r,this._addToMoves(t,r)),t}_truncate(t){for(;null!==t;){const e=t._next;this._addToRemovals(this._unlink(t)),t=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,e,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const r=t._prevRemoved,i=t._nextRemoved;return null===r?this._removalsHead=i:r._nextRemoved=i,null===i?this._removalsTail=r:i._prevRemoved=r,this._insertAfter(t,e,n),this._addToMoves(t,n),t}_moveAfter(t,e,n){return this._unlink(t),this._insertAfter(t,e,n),this._addToMoves(t,n),t}_addAfter(t,e,n){return this._insertAfter(t,e,n),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,e,n){const r=null===e?this._itHead:e._next;return t._next=r,t._prev=e,null===r?this._itTail=t:r._prev=t,null===e?this._itHead=t:e._next=t,null===this._linkedRecords&&(this._linkedRecords=new mn),this._linkedRecords.put(t),t.currentIndex=n,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const e=t._prev,n=t._next;return null===e?this._itHead=n:e._next=n,null===n?this._itTail=e:n._prev=e,t}_addToMoves(t,e){return t.previousIndex===e||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new mn),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,e){return t.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class fn{constructor(t,e){this.item=t,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class pn{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,e){let n;for(n=this._head;null!==n;n=n._nextDup)if((null===e||e<=n.currentIndex)&&ze(n.trackById,t))return n;return null}remove(t){const e=t._prevDup,n=t._nextDup;return null===e?this._head=n:e._nextDup=n,null===n?this._tail=e:n._prevDup=e,null===this._head}}class mn{constructor(){this.map=new Map}put(t){const e=t.trackById;let n=this.map.get(e);n||(n=new pn,this.map.set(e,n)),n.add(t)}get(t,e){const n=this.map.get(t);return n?n.get(t,e):null}remove(t){const e=t.trackById;return this.map.get(e).remove(t)&&this.map.delete(e),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function gn(t,e,n){const r=t.previousIndex;if(null===r)return r;let i=0;return n&&r<n.length&&(i=n[r]),r+e+i}class yn{constructor(){}supports(t){return t instanceof Map||Ue(t)}create(){return new vn}}class vn{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let e;for(e=this._mapHead;null!==e;e=e._next)t(e)}forEachPreviousItem(t){let e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)t(e)}forEachChangedItem(t){let e;for(e=this._changesHead;null!==e;e=e._nextChanged)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}diff(t){if(t){if(!(t instanceof Map||Ue(t)))throw new Error(`Error trying to diff '${yt(t)}'. Only maps and objects are allowed`)}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(t,(t,n)=>{if(e&&e.key===n)this._maybeAddToChanges(e,t),this._appendAfter=e,e=e._next;else{const r=this._getOrCreateRecordForKey(n,t);e=this._insertBeforeOrAppend(e,r)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let t=e;null!==t;t=t._nextRemoved)t===this._mapHead&&(this._mapHead=null),this._records.delete(t.key),t._nextRemoved=t._next,t.previousValue=t.currentValue,t.currentValue=null,t._prev=null,t._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,e){if(t){const n=t._prev;return e._next=t,e._prev=n,t._prev=e,n&&(n._next=e),t===this._mapHead&&(this._mapHead=e),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(t,e){if(this._records.has(t)){const n=this._records.get(t);this._maybeAddToChanges(n,e);const r=n._prev,i=n._next;return r&&(r._next=i),i&&(i._prev=r),n._next=null,n._prev=null,n}const n=new bn(t);return this._records.set(t,n),n.currentValue=e,this._addToAdditions(n),n}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,e){ze(e,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=e,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,e){t instanceof Map?t.forEach(e):Object.keys(t).forEach(n=>e(t[n],n))}}class bn{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}let xn=(()=>{class t{constructor(t){this.factories=t}static create(e,n){if(null!=n){const t=n.factories.slice();e=e.concat(t)}return new t(e)}static extend(e){return{provide:t,useFactory:n=>{if(!n)throw new Error("Cannot extend IterableDiffers without a parent injector");return t.create(e,n)},deps:[[t,new ht,new ut]]}}find(t){const e=this.factories.find(e=>e.supports(t));if(null!=e)return e;throw new Error(`Cannot find a differ supporting object '${t}' of type '${n=t,n.name||typeof n}'`);var n}}return t.ngInjectableDef=pt({token:t,providedIn:"root",factory:()=>new t([new cn])}),t})(),_n=(()=>{class t{constructor(t){this.factories=t}static create(e,n){if(n){const t=n.factories.slice();e=e.concat(t)}return new t(e)}static extend(e){return{provide:t,useFactory:n=>{if(!n)throw new Error("Cannot extend KeyValueDiffers without a parent injector");return t.create(e,n)},deps:[[t,new ht,new ut]]}}find(t){const e=this.factories.find(e=>e.supports(t));if(e)return e;throw new Error(`Cannot find a differ supporting object '${t}'`)}}return t.ngInjectableDef=pt({token:t,providedIn:"root",factory:()=>new t([new yn])}),t})();const wn=[new yn],Sn=new xn([new cn]),Cn=new _n(wn);let En=(()=>{class t{}return t.__NG_ELEMENT_ID__=()=>kn(t,tn),t})();const kn=Je;let An=(()=>{class t{}return t.__NG_ELEMENT_ID__=()=>Dn(t,tn),t})();const Dn=Je;function Nn(t,e,n,r){let i=`ExpressionChangedAfterItHasBeenCheckedError: Expression has changed after it was checked. Previous value: '${e}'. Current value: '${n}'.`;return r&&(i+=" It seems like the view has been created after its parent and its children have been dirty checked. Has it been created in a change detection hook ?"),function(t,e){const n=new Error(t);return Tn(n,e),n}(i,t)}function Tn(t,e){t.ngDebugContext=e,t.ngErrorLogger=e.logError.bind(e)}function On(t){return new Error("ViewDestroyedError: Attempt to use a destroyed view: "+t)}function In(t,e,n){const r=t.state,i=1792&r;return i===e?(t.state=-1793&r|n,t.initIndex=-1,!0):i===n}function Rn(t,e,n){return(1792&t.state)===e&&t.initIndex<=n&&(t.initIndex=n+1,!0)}function Fn(t,e){return t.nodes[e]}function Mn(t,e){return t.nodes[e]}function $n(t,e){return t.nodes[e]}function Pn(t,e){return t.nodes[e]}function zn(t,e){return t.nodes[e]}const Ln={setCurrentNode:void 0,createRootView:void 0,createEmbeddedView:void 0,createComponentView:void 0,createNgModuleRef:void 0,overrideProvider:void 0,overrideComponentView:void 0,clearOverrides:void 0,checkAndUpdateView:void 0,checkNoChangesView:void 0,destroyView:void 0,resolveDep:void 0,createDebugContext:void 0,handleEvent:void 0,updateDirectives:void 0,updateRenderer:void 0,dirtyParentQueries:void 0},Bn=()=>{},jn=new Map;function Un(t){let e=jn.get(t);return e||(e=yt(t)+"_"+jn.size,jn.set(t,e)),e}function Vn(t){return{id:"$$undefined",styles:t.styles,encapsulation:t.encapsulation,data:t.data}}let Wn=0;function qn(t,e,n,r){return!(!(2&t.state)&&ze(t.oldValues[e.bindingIndex+n],r))}function Hn(t,e,n,r){return!!qn(t,e,n,r)&&(t.oldValues[e.bindingIndex+n]=r,!0)}function Gn(t,e,n,r){const i=t.oldValues[e.bindingIndex+n];if(1&t.state||!Le(i,r)){const s=e.bindings[n].name;throw Nn(Ln.createDebugContext(t,e.nodeIndex),`${s}: ${i}`,`${s}: ${r}`,0!=(1&t.state))}}function Yn(t){let e=t;for(;e;)2&e.def.flags&&(e.state|=8),e=e.viewContainerParent||e.parent}function Kn(t,e){let n=t;for(;n&&n!==e;)n.state|=64,n=n.viewContainerParent||n.parent}function Xn(t,e,n,r){try{return Yn(33554432&t.def.nodes[e].flags?Mn(t,e).componentView:t),Ln.handleEvent(t,e,n,r)}catch(i){t.root.errorHandler.handleError(i)}}function Zn(t){return t.parent?Mn(t.parent,t.parentNodeDef.nodeIndex):null}function Qn(t){return t.parent?t.parentNodeDef.parent:null}function Jn(t,e){switch(201347067&e.flags){case 1:return Mn(t,e.nodeIndex).renderElement;case 2:return Fn(t,e.nodeIndex).renderText}}function tr(t){return!!t.parent&&!!(32768&t.parentNodeDef.flags)}function er(t){return!(!t.parent||32768&t.parentNodeDef.flags)}function nr(t){return 1<<t%32}function rr(t){const e={};let n=0;const r={};return t&&t.forEach(([t,i])=>{"number"==typeof t?(e[t]=i,n|=nr(t)):r[t]=i}),{matchedQueries:e,references:r,matchedQueryIds:n}}function ir(t,e){return t.map(t=>{let n,r;return Array.isArray(t)?[r,n]=t:(r=0,n=t),n&&("function"==typeof n||"object"==typeof n)&&e&&Object.defineProperty(n,"__source",{value:e,configurable:!0}),{flags:r,token:n,tokenKey:Un(n)}})}function sr(t,e,n){let r=n.renderParent;return r?0==(1&r.flags)||0==(33554432&r.flags)||r.element.componentRendererType&&r.element.componentRendererType.encapsulation===jt.Native?Mn(t,n.renderParent.nodeIndex).renderElement:void 0:e}const or=new WeakMap;function ar(t){let e=or.get(t);return e||(e=t(()=>Bn),e.factory=t,or.set(t,e)),e}function lr(t,e,n,r,i){3===e&&(n=t.renderer.parentNode(Jn(t,t.def.lastRenderRootNode))),ur(t,e,0,t.def.nodes.length-1,n,r,i)}function ur(t,e,n,r,i,s,o){for(let a=n;a<=r;a++){const n=t.def.nodes[a];11&n.flags&&hr(t,n,e,i,s,o),a+=n.childCount}}function cr(t,e,n,r,i,s){let o=t;for(;o&&!tr(o);)o=o.parent;const a=o.parent,l=Qn(o),u=l.nodeIndex+l.childCount;for(let c=l.nodeIndex+1;c<=u;c++){const t=a.def.nodes[c];t.ngContentIndex===e&&hr(a,t,n,r,i,s),c+=t.childCount}if(!a.parent){const o=t.root.projectableNodes[e];if(o)for(let e=0;e<o.length;e++)dr(t,o[e],n,r,i,s)}}function hr(t,e,n,r,i,s){if(8&e.flags)cr(t,e.ngContent.index,n,r,i,s);else{const o=Jn(t,e);if(3===n&&33554432&e.flags&&48&e.bindingFlags?(16&e.bindingFlags&&dr(t,o,n,r,i,s),32&e.bindingFlags&&dr(Mn(t,e.nodeIndex).componentView,o,n,r,i,s)):dr(t,o,n,r,i,s),16777216&e.flags){const o=Mn(t,e.nodeIndex).viewContainer._embeddedViews;for(let t=0;t<o.length;t++)lr(o[t],n,r,i,s)}1&e.flags&&!e.element.name&&ur(t,n,e.nodeIndex+1,e.nodeIndex+e.childCount,r,i,s)}}function dr(t,e,n,r,i,s){const o=t.renderer;switch(n){case 1:o.appendChild(r,e);break;case 2:o.insertBefore(r,e,i);break;case 3:o.removeChild(r,e);break;case 0:s.push(e)}}const fr=/^:([^:]+):(.+)$/;function pr(t){if(":"===t[0]){const e=t.match(fr);return[e[1],e[2]]}return["",t]}function mr(t){let e=0;for(let n=0;n<t.length;n++)e|=t[n].flags;return e}const gr=new Object,yr=Un(Ae),vr=Un(At),br=Un(Pt);function xr(t,e,n,r){return n=xt(n),{index:-1,deps:ir(r,yt(e)),flags:t,token:e,value:n}}function _r(t,e,n=Ae.THROW_IF_NOT_FOUND){const r=It(t);try{if(8&e.flags)return e.token;if(2&e.flags&&(n=null),1&e.flags)return t._parent.get(e.token,n);const o=e.tokenKey;switch(o){case yr:case vr:case br:return t}const a=t._def.providersByKey[o];let l;if(a){let e=t._providers[a.index];return void 0===e&&(e=t._providers[a.index]=wr(t,a)),e===gr?void 0:e}if((l=mt(e.token))&&(i=t,null!=(s=l).providedIn&&(function(t,e){return t._def.modules.indexOf(e)>-1}(i,s.providedIn)||"root"===s.providedIn&&i._def.isRoot))){const n=t._providers.length;return t._def.providers[n]=t._def.providersByKey[e.tokenKey]={flags:5120,value:l.factory,deps:[],index:n,token:e.token},t._providers[n]=gr,t._providers[n]=wr(t,t._def.providersByKey[e.tokenKey])}return 4&e.flags?n:t._parent.get(e.token,n)}finally{It(r)}var i,s}function wr(t,e){let n;switch(201347067&e.flags){case 512:n=function(t,e,n){const r=n.length;switch(r){case 0:return new e;case 1:return new e(_r(t,n[0]));case 2:return new e(_r(t,n[0]),_r(t,n[1]));case 3:return new e(_r(t,n[0]),_r(t,n[1]),_r(t,n[2]));default:const i=new Array(r);for(let e=0;e<r;e++)i[e]=_r(t,n[e]);return new e(...i)}}(t,e.value,e.deps);break;case 1024:n=function(t,e,n){const r=n.length;switch(r){case 0:return e();case 1:return e(_r(t,n[0]));case 2:return e(_r(t,n[0]),_r(t,n[1]));case 3:return e(_r(t,n[0]),_r(t,n[1]),_r(t,n[2]));default:const i=Array(r);for(let e=0;e<r;e++)i[e]=_r(t,n[e]);return e(...i)}}(t,e.value,e.deps);break;case 2048:n=_r(t,e.deps[0]);break;case 256:n=e.value}return n===gr||null===n||"object"!=typeof n||131072&e.flags||"function"!=typeof n.ngOnDestroy||(e.flags|=131072),void 0===n?gr:n}function Sr(t,e){const n=t.viewContainer._embeddedViews;if((null==e||e>=n.length)&&(e=n.length-1),e<0)return null;const r=n[e];return r.viewContainerParent=null,Bt(n,e),Ln.dirtyParentQueries(r),Er(r),r}function Cr(t,e,n){const r=e?Jn(e,e.def.lastRenderRootNode):t.renderElement,i=n.renderer.parentNode(r),s=n.renderer.nextSibling(r);lr(n,2,i,s,void 0)}function Er(t){lr(t,3,null,null,void 0)}const kr=new Object;function Ar(t,e,n,r,i,s){return new Dr(t,e,n,r,i,s)}class Dr extends He{constructor(t,e,n,r,i,s){super(),this.selector=t,this.componentType=e,this._inputs=r,this._outputs=i,this.ngContentSelectors=s,this.viewDefFactory=n}get inputs(){const t=[],e=this._inputs;for(let n in e)t.push({propName:n,templateName:e[n]});return t}get outputs(){const t=[];for(let e in this._outputs)t.push({propName:e,templateName:this._outputs[e]});return t}create(t,e,n,r){if(!r)throw new Error("ngModule should be provided");const i=ar(this.viewDefFactory),s=i.nodes[0].element.componentProvider.nodeIndex,o=Ln.createRootView(t,e||[],n,i,r,kr),a=$n(o,s).instance;return n&&o.renderer.setAttribute(Mn(o,0).renderElement,"ng-version",un.full),new Nr(o,new Rr(o),a)}}class Nr extends class{}{constructor(t,e,n){super(),this._view=t,this._viewRef=e,this._component=n,this._elDef=this._view.def.nodes[0],this.hostView=e,this.changeDetectorRef=e,this.instance=n}get location(){return new tn(Mn(this._view,this._elDef.nodeIndex).renderElement)}get injector(){return new Pr(this._view,this._elDef)}get componentType(){return this._component.constructor}destroy(){this._viewRef.destroy()}onDestroy(t){this._viewRef.onDestroy(t)}}function Tr(t,e,n){return new Or(t,e,n)}class Or{constructor(t,e,n){this._view=t,this._elDef=e,this._data=n,this._embeddedViews=[]}get element(){return new tn(this._data.renderElement)}get injector(){return new Pr(this._view,this._elDef)}get parentInjector(){let t=this._view,e=this._elDef.parent;for(;!e&&t;)e=Qn(t),t=t.parent;return t?new Pr(t,e):new Pr(this._view,null)}clear(){for(let t=this._embeddedViews.length-1;t>=0;t--){const e=Sr(this._data,t);Ln.destroyView(e)}}get(t){const e=this._embeddedViews[t];if(e){const t=new Rr(e);return t.attachToViewContainerRef(this),t}return null}get length(){return this._embeddedViews.length}createEmbeddedView(t,e,n){const r=t.createEmbeddedView(e||{});return this.insert(r,n),r}createComponent(t,e,n,r,i){const s=n||this.parentInjector;i||t instanceof Qe||(i=s.get(Pt));const o=t.create(s,r,void 0,i);return this.insert(o.hostView,e),o}insert(t,e){if(t.destroyed)throw new Error("Cannot insert a destroyed View in a ViewContainer!");const n=t;return function(t,e,n,r){let i=e.viewContainer._embeddedViews;null==n&&(n=i.length),r.viewContainerParent=t,Lt(i,n,r),function(t,e){const n=Zn(e);if(!n||n===t||16&e.state)return;e.state|=16;let r=n.template._projectedViews;r||(r=n.template._projectedViews=[]),r.push(e),function(t,e){if(4&e.flags)return;t.nodeFlags|=4,e.flags|=4;let n=e.parent;for(;n;)n.childFlags|=4,n=n.parent}(e.parent.def,e.parentNodeDef)}(e,r),Ln.dirtyParentQueries(r),Cr(e,n>0?i[n-1]:null,r)}(this._view,this._data,e,n._view),n.attachToViewContainerRef(this),t}move(t,e){if(t.destroyed)throw new Error("Cannot move a destroyed View in a ViewContainer!");const n=this._embeddedViews.indexOf(t._view);return function(t,e,n){const r=t.viewContainer._embeddedViews,i=r[e];Bt(r,e),null==n&&(n=r.length),Lt(r,n,i),Ln.dirtyParentQueries(i),Er(i),Cr(t,n>0?r[n-1]:null,i)}(this._data,n,e),t}indexOf(t){return this._embeddedViews.indexOf(t._view)}remove(t){const e=Sr(this._data,t);e&&Ln.destroyView(e)}detach(t){const e=Sr(this._data,t);return e?new Rr(e):null}}function Ir(t){return new Rr(t)}class Rr{constructor(t){this._view=t,this._viewContainerRef=null,this._appRef=null}get rootNodes(){return function(t){const e=[];return lr(t,0,void 0,void 0,e),e}(this._view)}get context(){return this._view.context}get destroyed(){return 0!=(128&this._view.state)}markForCheck(){Yn(this._view)}detach(){this._view.state&=-5}detectChanges(){const t=this._view.root.rendererFactory;t.begin&&t.begin();try{Ln.checkAndUpdateView(this._view)}finally{t.end&&t.end()}}checkNoChanges(){Ln.checkNoChangesView(this._view)}reattach(){this._view.state|=4}onDestroy(t){this._view.disposables||(this._view.disposables=[]),this._view.disposables.push(t)}destroy(){this._appRef?this._appRef.detachView(this):this._viewContainerRef&&this._viewContainerRef.detach(this._viewContainerRef.indexOf(this)),Ln.destroyView(this._view)}detachFromAppRef(){this._appRef=null,Er(this._view),Ln.dirtyParentQueries(this._view)}attachToAppRef(t){if(this._viewContainerRef)throw new Error("This view is already attached to a ViewContainer!");this._appRef=t}attachToViewContainerRef(t){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._viewContainerRef=t}}function Fr(t,e){return new Mr(t,e)}class Mr extends En{constructor(t,e){super(),this._parentView=t,this._def=e}createEmbeddedView(t){return new Rr(Ln.createEmbeddedView(this._parentView,this._def,this._def.element.template,t))}get elementRef(){return new tn(Mn(this._parentView,this._def.nodeIndex).renderElement)}}function $r(t,e){return new Pr(t,e)}class Pr{constructor(t,e){this.view=t,this.elDef=e}get(t,e=Ae.THROW_IF_NOT_FOUND){return Ln.resolveDep(this.view,this.elDef,!!this.elDef&&0!=(33554432&this.elDef.flags),{flags:0,token:t,tokenKey:Un(t)},e)}}function zr(t,e){const n=t.def.nodes[e];if(1&n.flags){const e=Mn(t,n.nodeIndex);return n.element.template?e.template:e.renderElement}if(2&n.flags)return Fn(t,n.nodeIndex).renderText;if(20240&n.flags)return $n(t,n.nodeIndex).instance;throw new Error("Illegal state: read nodeValue for node index "+e)}function Lr(t){return new Br(t.renderer)}class Br{constructor(t){this.delegate=t}selectRootElement(t){return this.delegate.selectRootElement(t)}createElement(t,e){const[n,r]=pr(e),i=this.delegate.createElement(r,n);return t&&this.delegate.appendChild(t,i),i}createViewRoot(t){return t}createTemplateAnchor(t){const e=this.delegate.createComment("");return t&&this.delegate.appendChild(t,e),e}createText(t,e){const n=this.delegate.createText(e);return t&&this.delegate.appendChild(t,n),n}projectNodes(t,e){for(let n=0;n<e.length;n++)this.delegate.appendChild(t,e[n])}attachViewAfter(t,e){const n=this.delegate.parentNode(t),r=this.delegate.nextSibling(t);for(let i=0;i<e.length;i++)this.delegate.insertBefore(n,e[i],r)}detachView(t){for(let e=0;e<t.length;e++){const n=t[e],r=this.delegate.parentNode(n);this.delegate.removeChild(r,n)}}destroyView(t,e){for(let n=0;n<e.length;n++)this.delegate.destroyNode(e[n])}listen(t,e,n){return this.delegate.listen(t,e,n)}listenGlobal(t,e,n){return this.delegate.listen(t,e,n)}setElementProperty(t,e,n){this.delegate.setProperty(t,e,n)}setElementAttribute(t,e,n){const[r,i]=pr(e);null!=n?this.delegate.setAttribute(t,i,n,r):this.delegate.removeAttribute(t,i,r)}setBindingDebugInfo(t,e,n){}setElementClass(t,e,n){n?this.delegate.addClass(t,e):this.delegate.removeClass(t,e)}setElementStyle(t,e,n){null!=n?this.delegate.setStyle(t,e,n):this.delegate.removeStyle(t,e)}invokeElementMethod(t,e,n){t[e].apply(t,n)}setText(t,e){this.delegate.setValue(t,e)}animate(){throw new Error("Renderer.animate is no longer supported!")}}function jr(t,e,n,r){return new Ur(t,e,n,r)}class Ur{constructor(t,e,n,r){this._moduleType=t,this._parent=e,this._bootstrapComponents=n,this._def=r,this._destroyListeners=[],this._destroyed=!1,this.injector=this,function(t){const e=t._def,n=t._providers=new Array(e.providers.length);for(let r=0;r<e.providers.length;r++){const i=e.providers[r];4096&i.flags||void 0===n[r]&&(n[r]=wr(t,i))}}(this)}get(t,e=Ae.THROW_IF_NOT_FOUND,n=dt.Default){let r=0;return n&dt.SkipSelf?r|=1:n&dt.Self&&(r|=4),_r(this,{token:t,tokenKey:Un(t),flags:r},e)}get instance(){return this.get(this._moduleType)}get componentFactoryResolver(){return this.get(Xe)}destroy(){if(this._destroyed)throw new Error(`The ng module ${yt(this.instance.constructor)} has already been destroyed.`);this._destroyed=!0,function(t,e){const n=t._def,r=new Set;for(let i=0;i<n.providers.length;i++)if(131072&n.providers[i].flags){const e=t._providers[i];if(e&&e!==gr){const t=e.ngOnDestroy;"function"!=typeof t||r.has(e)||(t.apply(e),r.add(e))}}}(this),this._destroyListeners.forEach(t=>t())}onDestroy(t){this._destroyListeners.push(t)}}const Vr=Un(nn),Wr=Un(on),qr=Un(tn),Hr=Un(An),Gr=Un(En),Yr=Un(Se),Kr=Un(Ae),Xr=Un(At);function Zr(t,e,n,r,i,s,o,a){const l=[];if(o)for(let c in o){const[t,e]=o[c];l[t]={flags:8,name:c,nonMinifiedName:e,ns:null,securityContext:null,suffix:null}}const u=[];if(a)for(let c in a)u.push({type:1,propName:c,target:null,eventName:a[c]});return Jr(t,e|=16384,n,r,i,i,s,l,u)}function Qr(t,e,n,r,i){return Jr(-1,t,e,0,n,r,i)}function Jr(t,e,n,r,i,s,o,a,l){const{matchedQueries:u,references:c,matchedQueryIds:h}=rr(n);l||(l=[]),a||(a=[]),s=xt(s);const d=ir(o,yt(i));return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:e,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:u,matchedQueryIds:h,references:c,ngContentIndex:-1,childCount:r,bindings:a,bindingFlags:mr(a),outputs:l,element:null,provider:{token:i,value:s,deps:d},text:null,query:null,ngContent:null}}function ti(t,e){return ii(t,e)}function ei(t,e){let n=t;for(;n.parent&&!tr(n);)n=n.parent;return si(n.parent,Qn(n),!0,e.provider.value,e.provider.deps)}function ni(t,e){const n=si(t,e.parent,(32768&e.flags)>0,e.provider.value,e.provider.deps);if(e.outputs.length)for(let r=0;r<e.outputs.length;r++){const i=e.outputs[r],s=n[i.propName];if(!We(s))throw new Error(`@Output ${i.propName} not initialized in '${n.constructor.name}'.`);{const n=s.subscribe(ri(t,e.parent.nodeIndex,i.eventName));t.disposables[e.outputIndex+r]=n.unsubscribe.bind(n)}}return n}function ri(t,e,n){return r=>Xn(t,e,n,r)}function ii(t,e){const n=(8192&e.flags)>0,r=e.provider;switch(201347067&e.flags){case 512:return si(t,e.parent,n,r.value,r.deps);case 1024:return function(t,e,n,r,i){const s=i.length;switch(s){case 0:return r();case 1:return r(ai(t,e,n,i[0]));case 2:return r(ai(t,e,n,i[0]),ai(t,e,n,i[1]));case 3:return r(ai(t,e,n,i[0]),ai(t,e,n,i[1]),ai(t,e,n,i[2]));default:const o=Array(s);for(let r=0;r<s;r++)o[r]=ai(t,e,n,i[r]);return r(...o)}}(t,e.parent,n,r.value,r.deps);case 2048:return ai(t,e.parent,n,r.deps[0]);case 256:return r.value}}function si(t,e,n,r,i){const s=i.length;switch(s){case 0:return new r;case 1:return new r(ai(t,e,n,i[0]));case 2:return new r(ai(t,e,n,i[0]),ai(t,e,n,i[1]));case 3:return new r(ai(t,e,n,i[0]),ai(t,e,n,i[1]),ai(t,e,n,i[2]));default:const o=new Array(s);for(let r=0;r<s;r++)o[r]=ai(t,e,n,i[r]);return new r(...o)}}const oi={};function ai(t,e,n,r,i=Ae.THROW_IF_NOT_FOUND){if(8&r.flags)return r.token;const s=t;2&r.flags&&(i=null);const o=r.tokenKey;o===Yr&&(n=!(!e||!e.element.componentView)),e&&1&r.flags&&(n=!1,e=e.parent);let a=t;for(;a;){if(e)switch(o){case Vr:return Lr(li(a,e,n));case Wr:return li(a,e,n).renderer;case qr:return new tn(Mn(a,e.nodeIndex).renderElement);case Hr:return Mn(a,e.nodeIndex).viewContainer;case Gr:if(e.element.template)return Mn(a,e.nodeIndex).template;break;case Yr:return Ir(li(a,e,n));case Kr:case Xr:return $r(a,e);default:const t=(n?e.element.allProviders:e.element.publicProviders)[o];if(t){let e=$n(a,t.nodeIndex);return e||(e={instance:ii(a,t)},a.nodes[t.nodeIndex]=e),e.instance}}n=tr(a),e=Qn(a),a=a.parent,4&r.flags&&(a=null)}const l=s.root.injector.get(r.token,oi);return l!==oi||i===oi?l:s.root.ngModule.injector.get(r.token,i)}function li(t,e,n){let r;if(n)r=Mn(t,e.nodeIndex).componentView;else for(r=t;r.parent&&!tr(r);)r=r.parent;return r}function ui(t,e,n,r,i,s){if(32768&n.flags){const e=Mn(t,n.parent.nodeIndex).componentView;2&e.def.flags&&(e.state|=8)}if(e.instance[n.bindings[r].name]=i,524288&n.flags){s=s||{};const e=Be.unwrap(t.oldValues[n.bindingIndex+r]);s[n.bindings[r].nonMinifiedName]=new qe(e,i,0!=(2&t.state))}return t.oldValues[n.bindingIndex+r]=i,s}function ci(t,e){if(!(t.def.nodeFlags&e))return;const n=t.def.nodes;let r=0;for(let i=0;i<n.length;i++){const s=n[i];let o=s.parent;for(!o&&s.flags&e&&di(t,i,s.flags&e,r++),0==(s.childFlags&e)&&(i+=s.childCount);o&&1&o.flags&&i===o.nodeIndex+o.childCount;)o.directChildFlags&e&&(r=hi(t,o,e,r)),o=o.parent}}function hi(t,e,n,r){for(let i=e.nodeIndex+1;i<=e.nodeIndex+e.childCount;i++){const e=t.def.nodes[i];e.flags&n&&di(t,i,e.flags&n,r++),i+=e.childCount}return r}function di(t,e,n,r){const i=$n(t,e);if(!i)return;const s=i.instance;s&&(Ln.setCurrentNode(t,e),1048576&n&&Rn(t,512,r)&&s.ngAfterContentInit(),2097152&n&&s.ngAfterContentChecked(),4194304&n&&Rn(t,768,r)&&s.ngAfterViewInit(),8388608&n&&s.ngAfterViewChecked(),131072&n&&s.ngOnDestroy())}const fi=new kt("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>Ut}),pi={},mi=function(){var t={LocaleId:0,DayPeriodsFormat:1,DayPeriodsStandalone:2,DaysFormat:3,DaysStandalone:4,MonthsFormat:5,MonthsStandalone:6,Eras:7,FirstDayOfWeek:8,WeekendRange:9,DateFormat:10,TimeFormat:11,DateTimeFormat:12,NumberSymbols:13,NumberFormats:14,CurrencySymbol:15,CurrencyName:16,Currencies:17,PluralCase:18,ExtraData:19};return t[t.LocaleId]="LocaleId",t[t.DayPeriodsFormat]="DayPeriodsFormat",t[t.DayPeriodsStandalone]="DayPeriodsStandalone",t[t.DaysFormat]="DaysFormat",t[t.DaysStandalone]="DaysStandalone",t[t.MonthsFormat]="MonthsFormat",t[t.MonthsStandalone]="MonthsStandalone",t[t.Eras]="Eras",t[t.FirstDayOfWeek]="FirstDayOfWeek",t[t.WeekendRange]="WeekendRange",t[t.DateFormat]="DateFormat",t[t.TimeFormat]="TimeFormat",t[t.DateTimeFormat]="DateTimeFormat",t[t.NumberSymbols]="NumberSymbols",t[t.NumberFormats]="NumberFormats",t[t.CurrencySymbol]="CurrencySymbol",t[t.CurrencyName]="CurrencyName",t[t.Currencies]="Currencies",t[t.PluralCase]="PluralCase",t[t.ExtraData]="ExtraData",t}(),gi=void 0;var yi=["en",[["a","p"],["AM","PM"],gi],[["AM","PM"],gi,gi],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],gi,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],gi,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",gi,"{1} 'at' {0}",gi],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"$","US Dollar",{},function(t){let e=Math.floor(Math.abs(t)),n=t.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===n?1:5}];class vi extends A{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,e,n){let r,i=t=>null,s=()=>null;t&&"object"==typeof t?(r=this.__isAsync?e=>{setTimeout(()=>t.next(e))}:e=>{t.next(e)},t.error&&(i=this.__isAsync?e=>{setTimeout(()=>t.error(e))}:e=>{t.error(e)}),t.complete&&(s=this.__isAsync?()=>{setTimeout(()=>t.complete())}:()=>{t.complete()})):(r=this.__isAsync?e=>{setTimeout(()=>t(e))}:e=>{t(e)},e&&(i=this.__isAsync?t=>{setTimeout(()=>e(t))}:t=>{e(t)}),n&&(s=this.__isAsync?()=>{setTimeout(()=>n())}:()=>{n()}));const o=super.subscribe(r,i,s);return t instanceof d&&t.add(o),o}}function bi(){return this._results[Pe()]()}class xi{constructor(){this.dirty=!0,this._results=[],this.changes=new vi,this.length=0;const t=Pe(),e=xi.prototype;e[t]||(e[t]=bi)}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,e){return this._results.reduce(t,e)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t){this._results=function t(e,n){void 0===n&&(n=e);for(let r=0;r<e.length;r++){let i=e[r];Array.isArray(i)?(n===e&&(n=e.slice(0,r)),t(i,n)):n!==e&&n.push(i)}return n}(t),this.dirty=!1,this.length=this._results.length,this.last=this._results[this.length-1],this.first=this._results[0]}notifyOnChanges(){this.changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}const _i=new kt("Application Initializer");class wi{constructor(t){this.appInits=t,this.initialized=!1,this.done=!1,this.donePromise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}runInitializers(){if(this.initialized)return;const t=[],e=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let n=0;n<this.appInits.length;n++){const e=this.appInits[n]();Ve(e)&&t.push(e)}Promise.all(t).then(()=>{e()}).catch(t=>{this.reject(t)}),0===t.length&&e(),this.initialized=!0}}const Si=new kt("AppId");function Ci(){return`${Ei()}${Ei()}${Ei()}`}function Ei(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const ki=new kt("Platform Initializer"),Ai=new kt("Platform ID"),Di=new kt("appBootstrapListener");class Ni{log(t){console.log(t)}warn(t){console.warn(t)}}const Ti=new kt("LocaleId");function Oi(){throw new Error("Runtime compiler is not loaded")}const Ii=Oi,Ri=Oi,Fi=Oi,Mi=Oi;class $i{constructor(){this.compileModuleSync=Ii,this.compileModuleAsync=Ri,this.compileModuleAndAllComponentsSync=Fi,this.compileModuleAndAllComponentsAsync=Mi}clearCache(){}clearCacheFor(t){}getModuleId(t){}}class Pi{}let zi,Li;function Bi(){const t=Et.wtf;return!(!t||(zi=t.trace,!zi)||(Li=zi.events,0))}const ji=Bi();function Ui(t,e){return null}const Vi=ji?function(t,e=null){return Li.createScope(t,e)}:(t,e)=>Ui,Wi=ji?function(t,e){return zi.leaveScope(t,e),e}:(t,e)=>e,qi=(()=>Promise.resolve(0))();function Hi(t){"undefined"==typeof Zone?qi.then(()=>{t&&t.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",t)}class Gi{constructor({enableLongStackTrace:t=!1}){if(this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new vi(!1),this.onMicrotaskEmpty=new vi(!1),this.onStable=new vi(!1),this.onError=new vi(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");var e;Zone.assertZonePatched(),this._nesting=0,this._outer=this._inner=Zone.current,Zone.wtfZoneSpec&&(this._inner=this._inner.fork(Zone.wtfZoneSpec)),Zone.TaskTrackingZoneSpec&&(this._inner=this._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(this._inner=this._inner.fork(Zone.longStackTraceZoneSpec)),(e=this)._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,n,r,i,s,o)=>{try{return Zi(e),t.invokeTask(r,i,s,o)}finally{Qi(e)}},onInvoke:(t,n,r,i,s,o,a)=>{try{return Zi(e),t.invoke(r,i,s,o,a)}finally{Qi(e)}},onHasTask:(t,n,r,i)=>{t.hasTask(r,i),n===r&&("microTask"==i.change?(e.hasPendingMicrotasks=i.microTask,Xi(e)):"macroTask"==i.change&&(e.hasPendingMacrotasks=i.macroTask))},onHandleError:(t,n,r,i)=>(t.handleError(r,i),e.runOutsideAngular(()=>e.onError.emit(i)),!1)})}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Gi.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(Gi.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(t,e,n){return this._inner.run(t,e,n)}runTask(t,e,n,r){const i=this._inner,s=i.scheduleEventTask("NgZoneEvent: "+r,t,Ki,Yi,Yi);try{return i.runTask(s,e,n)}finally{i.cancelTask(s)}}runGuarded(t,e,n){return this._inner.runGuarded(t,e,n)}runOutsideAngular(t){return this._outer.run(t)}}function Yi(){}const Ki={};function Xi(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function Zi(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function Qi(t){t._nesting--,Xi(t)}class Ji{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new vi,this.onMicrotaskEmpty=new vi,this.onStable=new vi,this.onError=new vi}run(t){return t()}runGuarded(t){return t()}runOutsideAngular(t){return t()}runTask(t){return t()}}class ts{constructor(t){this._ngZone=t,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Gi.assertNotInAngularZone(),Hi(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Hi(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(e=>!e.updateCb||!e.updateCb(t)||(clearTimeout(e.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,e,n){let r=-1;e&&e>0&&(r=setTimeout(()=>{this._callbacks=this._callbacks.filter(t=>t.timeoutId!==r),t(this._didWork,this.getPendingTasks())},e)),this._callbacks.push({doneCb:t,timeoutId:r,updateCb:n})}whenStable(t,e,n){if(n&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/dist/task-tracking.js" loaded?');this.addCallback(t,e,n),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(t,e,n){return[]}}class es{constructor(){this._applications=new Map,is.addToWindow(this)}registerApplication(t,e){this._applications.set(t,e)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,e=!0){return is.findTestabilityInTree(this,t,e)}}class ns{addToWindow(t){}findTestabilityInTree(t,e,n){return null}}let rs,is=new ns;const ss=new kt("AllowMultipleToken");class os{constructor(t,e){this.name=t,this.token=e}}function as(t,e,n=[]){const r="Platform: "+e,i=new kt(r);return(e=[])=>{let s=ls();if(!s||s.injector.get(ss,!1))if(t)t(n.concat(e).concat({provide:i,useValue:!0}));else{const t=n.concat(e).concat({provide:i,useValue:!0});!function(t){if(rs&&!rs.destroyed&&!rs.injector.get(ss,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");rs=t.get(us);const e=t.get(ki,null);e&&e.forEach(t=>t())}(Ae.create({providers:t,name:r}))}return function(t){const e=ls();if(!e)throw new Error("No platform exists!");if(!e.injector.get(t,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return e}(i)}}function ls(){return rs&&!rs.destroyed?rs:null}class us{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,e){const n=function(t){let e;return e="noop"===t?new Ji:("zone.js"===t?void 0:t)||new Gi({enableLongStackTrace:Kt()}),e}(e?e.ngZone:void 0),r=[{provide:Gi,useValue:n}];return n.run(()=>{const e=Ae.create({providers:r,parent:this.injector,name:t.moduleType.name}),i=t.create(e),s=i.injector.get(Ht,null);if(!s)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return i.onDestroy(()=>ds(this._modules,i)),n.runOutsideAngular(()=>n.onError.subscribe({next:t=>{s.handleError(t)}})),function(t,e,n){try{const r=n();return Ve(r)?r.catch(n=>{throw e.runOutsideAngular(()=>t.handleError(n)),n}):r}catch(r){throw e.runOutsideAngular(()=>t.handleError(r)),r}}(s,n,()=>{const t=i.injector.get(wi);return t.runInitializers(),t.donePromise.then(()=>(this._moduleDoBootstrap(i),i))})})}bootstrapModule(t,e=[]){const n=cs({},e);return function(t,e,n){return t.get(Pi).createCompiler([e]).compileModuleAsync(n)}(this.injector,n,t).then(t=>this.bootstrapModuleFactory(t,n))}_moduleDoBootstrap(t){const e=t.injector.get(hs);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(t=>e.bootstrap(t));else{if(!t.instance.ngDoBootstrap)throw new Error(`The module ${yt(t.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.`);t.instance.ngDoBootstrap(e)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(t=>t.destroy()),this._destroyListeners.forEach(t=>t()),this._destroyed=!0}get destroyed(){return this._destroyed}}function cs(t,e){return Array.isArray(e)?e.reduce(cs,t):Object.assign({},t,e)}let hs=(()=>{class t{constructor(t,e,n,r,i,s){this._zone=t,this._console=e,this._injector=n,this._exceptionHandler=r,this._componentFactoryResolver=i,this._initStatus=s,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._enforceNoNewChanges=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._enforceNoNewChanges=Kt(),this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const o=new _(t=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{t.next(this._stable),t.complete()})}),a=new _(t=>{let e;this._zone.runOutsideAngular(()=>{e=this._zone.onStable.subscribe(()=>{Gi.assertNotInAngularZone(),Hi(()=>{this._stable||this._zone.hasPendingMacrotasks||this._zone.hasPendingMicrotasks||(this._stable=!0,t.next(!0))})})});const n=this._zone.onUnstable.subscribe(()=>{Gi.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{t.next(!1)}))});return()=>{e.unsubscribe(),n.unsubscribe()}});this.isStable=Q(o,a.pipe(ot()))}bootstrap(t,e){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let n;n=t instanceof He?t:this._componentFactoryResolver.resolveComponentFactory(t),this.componentTypes.push(n.componentType);const r=n instanceof Qe?null:this._injector.get(Pt),i=n.create(Ae.NULL,[],e||n.selector,r);i.onDestroy(()=>{this._unloadComponent(i)});const s=i.injector.get(ts,null);return s&&i.injector.get(es).registerApplication(i.location.nativeElement,s),this._loadComponent(i),Kt()&&this._console.log("Angular is running in the development mode. Call enableProdMode() to enable the production mode."),i}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");const e=t._tickScope();try{this._runningTick=!0;for(let t of this._views)t.detectChanges();if(this._enforceNoNewChanges)for(let t of this._views)t.checkNoChanges()}catch(n){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(n))}finally{this._runningTick=!1,Wi(e)}}attachView(t){const e=t;this._views.push(e),e.attachToAppRef(this)}detachView(t){const e=t;ds(this._views,e),e.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t),this._injector.get(Di,[]).concat(this._bootstrapListeners).forEach(e=>e(t))}_unloadComponent(t){this.detachView(t.hostView),ds(this.components,t)}ngOnDestroy(){this._views.slice().forEach(t=>t.destroy())}get viewCount(){return this._views.length}}return t._tickScope=Vi("ApplicationRef#tick()"),t})();function ds(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}class fs{}class ps{}const ms={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"};class gs{constructor(t,e){this._compiler=t,this._config=e||ms}load(t){return this._compiler instanceof $i?this.loadFactory(t):this.loadAndCompile(t)}loadAndCompile(t){let[e,r]=t.split("#");return void 0===r&&(r="default"),n("zn8P")(e).then(t=>t[r]).then(t=>ys(t,e,r)).then(t=>this._compiler.compileModuleAsync(t))}loadFactory(t){let[e,r]=t.split("#"),i="NgFactory";return void 0===r&&(r="default",i=""),n("zn8P")(this._config.factoryPathPrefix+e+this._config.factoryPathSuffix).then(t=>t[r+i]).then(t=>ys(t,e,r))}}function ys(t,e,n){if(!t)throw new Error(`Cannot find '${n}' in '${e}'`);return t}class vs{constructor(t,e){this.name=t,this.callback=e}}class bs{constructor(t,e,n){this.listeners=[],this.parent=null,this._debugContext=n,this.nativeNode=t,e&&e instanceof xs&&e.addChild(this)}get injector(){return this._debugContext.injector}get componentInstance(){return this._debugContext.component}get context(){return this._debugContext.context}get references(){return this._debugContext.references}get providerTokens(){return this._debugContext.providerTokens}}class xs extends bs{constructor(t,e,n){super(t,e,n),this.properties={},this.attributes={},this.classes={},this.styles={},this.childNodes=[],this.nativeElement=t}addChild(t){t&&(this.childNodes.push(t),t.parent=this)}removeChild(t){const e=this.childNodes.indexOf(t);-1!==e&&(t.parent=null,this.childNodes.splice(e,1))}insertChildrenAfter(t,e){const n=this.childNodes.indexOf(t);-1!==n&&(this.childNodes.splice(n+1,0,...e),e.forEach(e=>{e.parent&&e.parent.removeChild(e),t.parent=this}))}insertBefore(t,e){const n=this.childNodes.indexOf(t);-1===n?this.addChild(e):(e.parent&&e.parent.removeChild(e),e.parent=this,this.childNodes.splice(n,0,e))}query(t){return this.queryAll(t)[0]||null}queryAll(t){const e=[];return function t(e,n,r){e.childNodes.forEach(e=>{e instanceof xs&&(n(e)&&r.push(e),t(e,n,r))})}(this,t,e),e}queryAllNodes(t){const e=[];return function t(e,n,r){e instanceof xs&&e.childNodes.forEach(e=>{n(e)&&r.push(e),e instanceof xs&&t(e,n,r)})}(this,t,e),e}get children(){return this.childNodes.filter(t=>t instanceof xs)}triggerEventHandler(t,e){this.listeners.forEach(n=>{n.name==t&&n.callback(e)})}}const _s=new Map,ws=function(t){return _s.get(t)||null};function Ss(t){_s.set(t.nativeNode,t)}const Cs=as(null,"core",[{provide:Ai,useValue:"unknown"},{provide:us,deps:[Ae]},{provide:es,deps:[]},{provide:Ni,deps:[]}]);function Es(){return Sn}function ks(){return Cn}function As(t){return t||"en-US"}function Ds(t){let e=[];return t.onStable.subscribe(()=>{for(;e.length;)e.pop()()}),function(t){e.push(t)}}class Ns{constructor(t){}}function Ts(t,e,n,r,i,s){t|=1;const{matchedQueries:o,references:a,matchedQueryIds:l}=rr(e);return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,flags:t,checkIndex:-1,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:o,matchedQueryIds:l,references:a,ngContentIndex:n,childCount:r,bindings:[],bindingFlags:0,outputs:[],element:{ns:null,name:null,attrs:null,template:s?ar(s):null,componentProvider:null,componentView:null,componentRendererType:null,publicProviders:null,allProviders:null,handleEvent:i||Bn},provider:null,text:null,query:null,ngContent:null}}function Os(t,e,n,r,i,s,o=[],a,l,u,c,h){u||(u=Bn);const{matchedQueries:d,references:f,matchedQueryIds:p}=rr(n);let m=null,g=null;s&&([m,g]=pr(s)),a=a||[];const y=new Array(a.length);for(let x=0;x<a.length;x++){const[t,e,n]=a[x],[r,i]=pr(e);let s=void 0,o=void 0;switch(15&t){case 4:o=n;break;case 1:case 8:s=n}y[x]={flags:t,ns:r,name:i,nonMinifiedName:i,securityContext:s,suffix:o}}l=l||[];const v=new Array(l.length);for(let x=0;x<l.length;x++){const[t,e]=l[x];v[x]={type:0,target:t,eventName:e,propName:null}}const b=(o=o||[]).map(([t,e])=>{const[n,r]=pr(t);return[n,r,e]});return h=function(t){if(t&&"$$undefined"===t.id){const e=null!=t.encapsulation&&t.encapsulation!==jt.None||t.styles.length||Object.keys(t.data).length;t.id=e?"c"+Wn++:"$$empty"}return t&&"$$empty"===t.id&&(t=null),t||null}(h),c&&(e|=33554432),{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:e|=1,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:d,matchedQueryIds:p,references:f,ngContentIndex:r,childCount:i,bindings:y,bindingFlags:mr(y),outputs:v,element:{ns:m,name:g,attrs:b,template:null,componentProvider:null,componentView:c||null,componentRendererType:h,publicProviders:null,allProviders:null,handleEvent:u||Bn},provider:null,text:null,query:null,ngContent:null}}function Is(t,e,n){const r=n.element,i=t.root.selectorOrNode,s=t.renderer;let o;if(t.parent||!i){o=r.name?s.createElement(r.name,r.ns):s.createComment("");const i=sr(t,e,n);i&&s.appendChild(i,o)}else o=s.selectRootElement(i,!!r.componentRendererType&&r.componentRendererType.encapsulation===jt.ShadowDom);if(r.attrs)for(let a=0;a<r.attrs.length;a++){const[t,e,n]=r.attrs[a];s.setAttribute(o,e,n,t)}return o}function Rs(t,e,n,r){for(let o=0;o<n.outputs.length;o++){const a=n.outputs[o],l=Fs(t,n.nodeIndex,(s=a.eventName,(i=a.target)?`${i}:${s}`:s));let u=a.target,c=t;"component"===a.target&&(u=null,c=e);const h=c.renderer.listen(u||r,a.eventName,l);t.disposables[n.outputIndex+o]=h}var i,s}function Fs(t,e,n){return r=>Xn(t,e,n,r)}function Ms(t,e,n,r){if(!Hn(t,e,n,r))return!1;const i=e.bindings[n],s=Mn(t,e.nodeIndex),o=s.renderElement,a=i.name;switch(15&i.flags){case 1:!function(t,e,n,r,i,s){const o=e.securityContext;let a=o?t.root.sanitizer.sanitize(o,s):s;a=null!=a?a.toString():null;const l=t.renderer;null!=s?l.setAttribute(n,i,a,r):l.removeAttribute(n,i,r)}(t,i,o,i.ns,a,r);break;case 2:!function(t,e,n,r){const i=t.renderer;r?i.addClass(e,n):i.removeClass(e,n)}(t,o,a,r);break;case 4:!function(t,e,n,r,i){let s=t.root.sanitizer.sanitize(ye.STYLE,i);if(null!=s){s=s.toString();const t=e.suffix;null!=t&&(s+=t)}else s=null;const o=t.renderer;null!=s?o.setStyle(n,r,s):o.removeStyle(n,r)}(t,i,o,a,r);break;case 8:!function(t,e,n,r,i){const s=e.securityContext;let o=s?t.root.sanitizer.sanitize(s,i):i;t.renderer.setProperty(n,r,o)}(33554432&e.flags&&32&i.flags?s.componentView:t,i,o,a,r)}return!0}function $s(t,e,n){let r=[];for(let i in n)r.push({propName:i,bindingType:n[i]});return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:-1,flags:t,childFlags:0,directChildFlags:0,childMatchedQueries:0,ngContentIndex:-1,matchedQueries:{},matchedQueryIds:0,references:{},childCount:0,bindings:[],bindingFlags:0,outputs:[],element:null,provider:null,text:null,query:{id:e,filterId:nr(e),bindings:r},ngContent:null}}function Ps(t){const e=t.def.nodeMatchedQueries;for(;t.parent&&er(t);){let n=t.parentNodeDef;t=t.parent;const r=n.nodeIndex+n.childCount;for(let i=0;i<=r;i++){const r=t.def.nodes[i];67108864&r.flags&&536870912&r.flags&&(r.query.filterId&e)===r.query.filterId&&zn(t,i).setDirty(),!(1&r.flags&&i+r.childCount<n.nodeIndex)&&67108864&r.childFlags&&536870912&r.childFlags||(i+=r.childCount)}}if(134217728&t.def.nodeFlags)for(let n=0;n<t.def.nodes.length;n++){const e=t.def.nodes[n];134217728&e.flags&&536870912&e.flags&&zn(t,n).setDirty(),n+=e.childCount}}function zs(t,e){const n=zn(t,e.nodeIndex);if(!n.dirty)return;let r,i=void 0;if(67108864&e.flags){const n=e.parent.parent;i=Ls(t,n.nodeIndex,n.nodeIndex+n.childCount,e.query,[]),r=$n(t,e.parent.nodeIndex).instance}else 134217728&e.flags&&(i=Ls(t,0,t.def.nodes.length-1,e.query,[]),r=t.component);n.reset(i);const s=e.query.bindings;let o=!1;for(let a=0;a<s.length;a++){const t=s[a];let e;switch(t.bindingType){case 0:e=n.first;break;case 1:e=n,o=!0}r[t.propName]=e}o&&n.notifyOnChanges()}function Ls(t,e,n,r,i){for(let s=e;s<=n;s++){const e=t.def.nodes[s],n=e.matchedQueries[r.id];if(null!=n&&i.push(Bs(t,e,n)),1&e.flags&&e.element.template&&(e.element.template.nodeMatchedQueries&r.filterId)===r.filterId){const n=Mn(t,s);if((e.childMatchedQueries&r.filterId)===r.filterId&&(Ls(t,s+1,s+e.childCount,r,i),s+=e.childCount),16777216&e.flags){const t=n.viewContainer._embeddedViews;for(let e=0;e<t.length;e++){const s=t[e],o=Zn(s);o&&o===n&&Ls(s,0,s.def.nodes.length-1,r,i)}}const o=n.template._projectedViews;if(o)for(let t=0;t<o.length;t++){const e=o[t];Ls(e,0,e.def.nodes.length-1,r,i)}}(e.childMatchedQueries&r.filterId)!==r.filterId&&(s+=e.childCount)}return i}function Bs(t,e,n){if(null!=n)switch(n){case 1:return Mn(t,e.nodeIndex).renderElement;case 0:return new tn(Mn(t,e.nodeIndex).renderElement);case 2:return Mn(t,e.nodeIndex).template;case 3:return Mn(t,e.nodeIndex).viewContainer;case 4:return $n(t,e.nodeIndex).instance}}function js(t,e){return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:-1,flags:8,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:{},matchedQueryIds:0,references:{},ngContentIndex:t,childCount:0,bindings:[],bindingFlags:0,outputs:[],element:null,provider:null,text:null,query:null,ngContent:{index:e}}}function Us(t,e,n){const r=sr(t,e,n);r&&cr(t,n.ngContent.index,1,r,null,void 0)}function Vs(t,e,n){const r=new Array(n.length-1);for(let i=1;i<n.length;i++)r[i-1]={flags:8,name:null,ns:null,nonMinifiedName:null,securityContext:null,suffix:n[i]};return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:2,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:{},matchedQueryIds:0,references:{},ngContentIndex:e,childCount:0,bindings:r,bindingFlags:8,outputs:[],element:null,provider:null,text:{prefix:n[0]},query:null,ngContent:null}}function Ws(t,e,n){let r;const i=t.renderer;r=i.createText(n.text.prefix);const s=sr(t,e,n);return s&&i.appendChild(s,r),{renderText:r}}function qs(t,e){return(null!=t?t.toString():"")+e.suffix}function Hs(t,e,n,r){let i=0,s=0,o=0,a=0,l=0,u=null,c=null,h=!1,d=!1,f=null;for(let p=0;p<e.length;p++){const t=e[p];if(t.nodeIndex=p,t.parent=u,t.bindingIndex=i,t.outputIndex=s,t.renderParent=c,o|=t.flags,l|=t.matchedQueryIds,t.element){const e=t.element;e.publicProviders=u?u.element.publicProviders:Object.create(null),e.allProviders=e.publicProviders,h=!1,d=!1,t.element.template&&(l|=t.element.template.nodeMatchedQueries)}if(Ys(u,t,e.length),i+=t.bindings.length,s+=t.outputs.length,!c&&3&t.flags&&(f=t),20224&t.flags){h||(h=!0,u.element.publicProviders=Object.create(u.element.publicProviders),u.element.allProviders=u.element.publicProviders);const e=0!=(32768&t.flags);0==(8192&t.flags)||e?u.element.publicProviders[Un(t.provider.token)]=t:(d||(d=!0,u.element.allProviders=Object.create(u.element.publicProviders)),u.element.allProviders[Un(t.provider.token)]=t),e&&(u.element.componentProvider=t)}if(u?(u.childFlags|=t.flags,u.directChildFlags|=t.flags,u.childMatchedQueries|=t.matchedQueryIds,t.element&&t.element.template&&(u.childMatchedQueries|=t.element.template.nodeMatchedQueries)):a|=t.flags,t.childCount>0)u=t,Gs(t)||(c=t);else for(;u&&p===u.nodeIndex+u.childCount;){const t=u.parent;t&&(t.childFlags|=u.childFlags,t.childMatchedQueries|=u.childMatchedQueries),u=t,c=u&&Gs(u)?u.renderParent:u}}return{factory:null,nodeFlags:o,rootNodeFlags:a,nodeMatchedQueries:l,flags:t,nodes:e,updateDirectives:n||Bn,updateRenderer:r||Bn,handleEvent:(t,n,r,i)=>e[n].element.handleEvent(t,r,i),bindingCount:i,outputCount:s,lastRenderRootNode:f}}function Gs(t){return 0!=(1&t.flags)&&null===t.element.name}function Ys(t,e,n){const r=e.element&&e.element.template;if(r){if(!r.lastRenderRootNode)throw new Error("Illegal State: Embedded templates without nodes are not allowed!");if(r.lastRenderRootNode&&16777216&r.lastRenderRootNode.flags)throw new Error(`Illegal State: Last root node of a template can't have embedded views, at index ${e.nodeIndex}!`)}if(20224&e.flags&&0==(1&(t?t.flags:0)))throw new Error(`Illegal State: StaticProvider/Directive nodes need to be children of elements or anchors, at index ${e.nodeIndex}!`);if(e.query){if(67108864&e.flags&&(!t||0==(16384&t.flags)))throw new Error(`Illegal State: Content Query nodes need to be children of directives, at index ${e.nodeIndex}!`);if(134217728&e.flags&&t)throw new Error(`Illegal State: View Query nodes have to be top level nodes, at index ${e.nodeIndex}!`)}if(e.childCount){const r=t?t.nodeIndex+t.childCount:n-1;if(e.nodeIndex<=r&&e.nodeIndex+e.childCount>r)throw new Error(`Illegal State: childCount of node leads outside of parent, at index ${e.nodeIndex}!`)}}function Ks(t,e,n,r){const i=Qs(t.root,t.renderer,t,e,n);return Js(i,t.component,r),to(i),i}function Xs(t,e,n){const r=Qs(t,t.renderer,null,null,e);return Js(r,n,n),to(r),r}function Zs(t,e,n,r){const i=e.element.componentRendererType;let s;return s=i?t.root.rendererFactory.createRenderer(r,i):t.root.renderer,Qs(t.root,s,t,e.element.componentProvider,n)}function Qs(t,e,n,r,i){const s=new Array(i.nodes.length),o=i.outputCount?new Array(i.outputCount):null;return{def:i,parent:n,viewContainerParent:null,parentNodeDef:r,context:null,component:null,nodes:s,state:13,root:t,renderer:e,oldValues:new Array(i.bindingCount),disposables:o,initIndex:-1}}function Js(t,e,n){t.component=e,t.context=n}function to(t){let e;tr(t)&&(e=Mn(t.parent,t.parentNodeDef.parent.nodeIndex).renderElement);const n=t.def,r=t.nodes;for(let i=0;i<n.nodes.length;i++){const s=n.nodes[i];let o;switch(Ln.setCurrentNode(t,i),201347067&s.flags){case 1:const n=Is(t,e,s);let a=void 0;if(33554432&s.flags){const e=ar(s.element.componentView);a=Ln.createComponentView(t,s,e,n)}Rs(t,a,s,n),o={renderElement:n,componentView:a,viewContainer:null,template:s.element.template?Fr(t,s):void 0},16777216&s.flags&&(o.viewContainer=Tr(t,s,o));break;case 2:o=Ws(t,e,s);break;case 512:case 1024:case 2048:case 256:o=r[i],o||4096&s.flags||(o={instance:ti(t,s)});break;case 16:o={instance:ei(t,s)};break;case 16384:o=r[i],o||(o={instance:ni(t,s)}),32768&s.flags&&Js(Mn(t,s.parent.nodeIndex).componentView,o.instance,o.instance);break;case 32:case 64:case 128:o={value:void 0};break;case 67108864:case 134217728:o=new xi;break;case 8:Us(t,e,s),o=void 0}r[i]=o}uo(t,lo.CreateViewNodes),po(t,201326592,268435456,0)}function eo(t){io(t),Ln.updateDirectives(t,1),co(t,lo.CheckNoChanges),Ln.updateRenderer(t,1),uo(t,lo.CheckNoChanges),t.state&=-97}function no(t){1&t.state?(t.state&=-2,t.state|=2):t.state&=-3,In(t,0,256),io(t),Ln.updateDirectives(t,0),co(t,lo.CheckAndUpdate),po(t,67108864,536870912,0);let e=In(t,256,512);ci(t,2097152|(e?1048576:0)),Ln.updateRenderer(t,0),uo(t,lo.CheckAndUpdate),po(t,134217728,536870912,0),e=In(t,512,768),ci(t,8388608|(e?4194304:0)),2&t.def.flags&&(t.state&=-9),t.state&=-97,In(t,768,1024)}function ro(t,e,n,r,i,s,o,a,l,u,c,h,d){return 0===n?function(t,e,n,r,i,s,o,a,l,u,c,h){switch(201347067&e.flags){case 1:return function(t,e,n,r,i,s,o,a,l,u,c,h){const d=e.bindings.length;let f=!1;return d>0&&Ms(t,e,0,n)&&(f=!0),d>1&&Ms(t,e,1,r)&&(f=!0),d>2&&Ms(t,e,2,i)&&(f=!0),d>3&&Ms(t,e,3,s)&&(f=!0),d>4&&Ms(t,e,4,o)&&(f=!0),d>5&&Ms(t,e,5,a)&&(f=!0),d>6&&Ms(t,e,6,l)&&(f=!0),d>7&&Ms(t,e,7,u)&&(f=!0),d>8&&Ms(t,e,8,c)&&(f=!0),d>9&&Ms(t,e,9,h)&&(f=!0),f}(t,e,n,r,i,s,o,a,l,u,c,h);case 2:return function(t,e,n,r,i,s,o,a,l,u,c,h){let d=!1;const f=e.bindings,p=f.length;if(p>0&&Hn(t,e,0,n)&&(d=!0),p>1&&Hn(t,e,1,r)&&(d=!0),p>2&&Hn(t,e,2,i)&&(d=!0),p>3&&Hn(t,e,3,s)&&(d=!0),p>4&&Hn(t,e,4,o)&&(d=!0),p>5&&Hn(t,e,5,a)&&(d=!0),p>6&&Hn(t,e,6,l)&&(d=!0),p>7&&Hn(t,e,7,u)&&(d=!0),p>8&&Hn(t,e,8,c)&&(d=!0),p>9&&Hn(t,e,9,h)&&(d=!0),d){let d=e.text.prefix;p>0&&(d+=qs(n,f[0])),p>1&&(d+=qs(r,f[1])),p>2&&(d+=qs(i,f[2])),p>3&&(d+=qs(s,f[3])),p>4&&(d+=qs(o,f[4])),p>5&&(d+=qs(a,f[5])),p>6&&(d+=qs(l,f[6])),p>7&&(d+=qs(u,f[7])),p>8&&(d+=qs(c,f[8])),p>9&&(d+=qs(h,f[9]));const m=Fn(t,e.nodeIndex).renderText;t.renderer.setValue(m,d)}return d}(t,e,n,r,i,s,o,a,l,u,c,h);case 16384:return function(t,e,n,r,i,s,o,a,l,u,c,h){const d=$n(t,e.nodeIndex),f=d.instance;let p=!1,m=void 0;const g=e.bindings.length;return g>0&&qn(t,e,0,n)&&(p=!0,m=ui(t,d,e,0,n,m)),g>1&&qn(t,e,1,r)&&(p=!0,m=ui(t,d,e,1,r,m)),g>2&&qn(t,e,2,i)&&(p=!0,m=ui(t,d,e,2,i,m)),g>3&&qn(t,e,3,s)&&(p=!0,m=ui(t,d,e,3,s,m)),g>4&&qn(t,e,4,o)&&(p=!0,m=ui(t,d,e,4,o,m)),g>5&&qn(t,e,5,a)&&(p=!0,m=ui(t,d,e,5,a,m)),g>6&&qn(t,e,6,l)&&(p=!0,m=ui(t,d,e,6,l,m)),g>7&&qn(t,e,7,u)&&(p=!0,m=ui(t,d,e,7,u,m)),g>8&&qn(t,e,8,c)&&(p=!0,m=ui(t,d,e,8,c,m)),g>9&&qn(t,e,9,h)&&(p=!0,m=ui(t,d,e,9,h,m)),m&&f.ngOnChanges(m),65536&e.flags&&Rn(t,256,e.nodeIndex)&&f.ngOnInit(),262144&e.flags&&f.ngDoCheck(),p}(t,e,n,r,i,s,o,a,l,u,c,h);case 32:case 64:case 128:return function(t,e,n,r,i,s,o,a,l,u,c,h){const d=e.bindings;let f=!1;const p=d.length;if(p>0&&Hn(t,e,0,n)&&(f=!0),p>1&&Hn(t,e,1,r)&&(f=!0),p>2&&Hn(t,e,2,i)&&(f=!0),p>3&&Hn(t,e,3,s)&&(f=!0),p>4&&Hn(t,e,4,o)&&(f=!0),p>5&&Hn(t,e,5,a)&&(f=!0),p>6&&Hn(t,e,6,l)&&(f=!0),p>7&&Hn(t,e,7,u)&&(f=!0),p>8&&Hn(t,e,8,c)&&(f=!0),p>9&&Hn(t,e,9,h)&&(f=!0),f){const f=Pn(t,e.nodeIndex);let m;switch(201347067&e.flags){case 32:m=new Array(d.length),p>0&&(m[0]=n),p>1&&(m[1]=r),p>2&&(m[2]=i),p>3&&(m[3]=s),p>4&&(m[4]=o),p>5&&(m[5]=a),p>6&&(m[6]=l),p>7&&(m[7]=u),p>8&&(m[8]=c),p>9&&(m[9]=h);break;case 64:m={},p>0&&(m[d[0].name]=n),p>1&&(m[d[1].name]=r),p>2&&(m[d[2].name]=i),p>3&&(m[d[3].name]=s),p>4&&(m[d[4].name]=o),p>5&&(m[d[5].name]=a),p>6&&(m[d[6].name]=l),p>7&&(m[d[7].name]=u),p>8&&(m[d[8].name]=c),p>9&&(m[d[9].name]=h);break;case 128:const t=n;switch(p){case 1:m=t.transform(n);break;case 2:m=t.transform(r);break;case 3:m=t.transform(r,i);break;case 4:m=t.transform(r,i,s);break;case 5:m=t.transform(r,i,s,o);break;case 6:m=t.transform(r,i,s,o,a);break;case 7:m=t.transform(r,i,s,o,a,l);break;case 8:m=t.transform(r,i,s,o,a,l,u);break;case 9:m=t.transform(r,i,s,o,a,l,u,c);break;case 10:m=t.transform(r,i,s,o,a,l,u,c,h)}}f.value=m}return f}(t,e,n,r,i,s,o,a,l,u,c,h);default:throw"unreachable"}}(t,e,r,i,s,o,a,l,u,c,h,d):function(t,e,n){switch(201347067&e.flags){case 1:return function(t,e,n){let r=!1;for(let i=0;i<n.length;i++)Ms(t,e,i,n[i])&&(r=!0);return r}(t,e,n);case 2:return function(t,e,n){const r=e.bindings;let i=!1;for(let s=0;s<n.length;s++)Hn(t,e,s,n[s])&&(i=!0);if(i){let i="";for(let t=0;t<n.length;t++)i+=qs(n[t],r[t]);i=e.text.prefix+i;const s=Fn(t,e.nodeIndex).renderText;t.renderer.setValue(s,i)}return i}(t,e,n);case 16384:return function(t,e,n){const r=$n(t,e.nodeIndex),i=r.instance;let s=!1,o=void 0;for(let a=0;a<n.length;a++)qn(t,e,a,n[a])&&(s=!0,o=ui(t,r,e,a,n[a],o));return o&&i.ngOnChanges(o),65536&e.flags&&Rn(t,256,e.nodeIndex)&&i.ngOnInit(),262144&e.flags&&i.ngDoCheck(),s}(t,e,n);case 32:case 64:case 128:return function(t,e,n){const r=e.bindings;let i=!1;for(let s=0;s<n.length;s++)Hn(t,e,s,n[s])&&(i=!0);if(i){const i=Pn(t,e.nodeIndex);let s;switch(201347067&e.flags){case 32:s=n;break;case 64:s={};for(let i=0;i<n.length;i++)s[r[i].name]=n[i];break;case 128:const t=n[0],e=n.slice(1);s=t.transform(...e)}i.value=s}return i}(t,e,n);default:throw"unreachable"}}(t,e,r)}function io(t){const e=t.def;if(4&e.nodeFlags)for(let n=0;n<e.nodes.length;n++){const r=e.nodes[n];if(4&r.flags){const e=Mn(t,n).template._projectedViews;if(e)for(let n=0;n<e.length;n++){const r=e[n];r.state|=32,Kn(r,t)}}else 0==(4&r.childFlags)&&(n+=r.childCount)}}function so(t,e,n,r,i,s,o,a,l,u,c,h,d){return 0===n?function(t,e,n,r,i,s,o,a,l,u,c,h){const d=e.bindings.length;d>0&&Gn(t,e,0,n),d>1&&Gn(t,e,1,r),d>2&&Gn(t,e,2,i),d>3&&Gn(t,e,3,s),d>4&&Gn(t,e,4,o),d>5&&Gn(t,e,5,a),d>6&&Gn(t,e,6,l),d>7&&Gn(t,e,7,u),d>8&&Gn(t,e,8,c),d>9&&Gn(t,e,9,h)}(t,e,r,i,s,o,a,l,u,c,h,d):function(t,e,n){for(let r=0;r<n.length;r++)Gn(t,e,r,n[r])}(t,e,r),!1}function oo(t,e){if(zn(t,e.nodeIndex).dirty)throw Nn(Ln.createDebugContext(t,e.nodeIndex),`Query ${e.query.id} not dirty`,`Query ${e.query.id} dirty`,0!=(1&t.state))}function ao(t){if(!(128&t.state)){if(co(t,lo.Destroy),uo(t,lo.Destroy),ci(t,131072),t.disposables)for(let e=0;e<t.disposables.length;e++)t.disposables[e]();!function(t){if(!(16&t.state))return;const e=Zn(t);if(e){const n=e.template._projectedViews;n&&(Bt(n,n.indexOf(t)),Ln.dirtyParentQueries(t))}}(t),t.renderer.destroyNode&&function(t){const e=t.def.nodes.length;for(let n=0;n<e;n++){const e=t.def.nodes[n];1&e.flags?t.renderer.destroyNode(Mn(t,n).renderElement):2&e.flags?t.renderer.destroyNode(Fn(t,n).renderText):(67108864&e.flags||134217728&e.flags)&&zn(t,n).destroy()}}(t),tr(t)&&t.renderer.destroy(),t.state|=128}}const lo=function(){var t={CreateViewNodes:0,CheckNoChanges:1,CheckNoChangesProjectedViews:2,CheckAndUpdate:3,CheckAndUpdateProjectedViews:4,Destroy:5};return t[t.CreateViewNodes]="CreateViewNodes",t[t.CheckNoChanges]="CheckNoChanges",t[t.CheckNoChangesProjectedViews]="CheckNoChangesProjectedViews",t[t.CheckAndUpdate]="CheckAndUpdate",t[t.CheckAndUpdateProjectedViews]="CheckAndUpdateProjectedViews",t[t.Destroy]="Destroy",t}();function uo(t,e){const n=t.def;if(33554432&n.nodeFlags)for(let r=0;r<n.nodes.length;r++){const i=n.nodes[r];33554432&i.flags?ho(Mn(t,r).componentView,e):0==(33554432&i.childFlags)&&(r+=i.childCount)}}function co(t,e){const n=t.def;if(16777216&n.nodeFlags)for(let r=0;r<n.nodes.length;r++){const i=n.nodes[r];if(16777216&i.flags){const n=Mn(t,r).viewContainer._embeddedViews;for(let t=0;t<n.length;t++)ho(n[t],e)}else 0==(16777216&i.childFlags)&&(r+=i.childCount)}}function ho(t,e){const n=t.state;switch(e){case lo.CheckNoChanges:0==(128&n)&&(12==(12&n)?eo(t):64&n&&fo(t,lo.CheckNoChangesProjectedViews));break;case lo.CheckNoChangesProjectedViews:0==(128&n)&&(32&n?eo(t):64&n&&fo(t,e));break;case lo.CheckAndUpdate:0==(128&n)&&(12==(12&n)?no(t):64&n&&fo(t,lo.CheckAndUpdateProjectedViews));break;case lo.CheckAndUpdateProjectedViews:0==(128&n)&&(32&n?no(t):64&n&&fo(t,e));break;case lo.Destroy:ao(t);break;case lo.CreateViewNodes:to(t)}}function fo(t,e){co(t,e),uo(t,e)}function po(t,e,n,r){if(!(t.def.nodeFlags&e&&t.def.nodeFlags&n))return;const i=t.def.nodes.length;for(let s=0;s<i;s++){const i=t.def.nodes[s];if(i.flags&e&&i.flags&n)switch(Ln.setCurrentNode(t,i.nodeIndex),r){case 0:zs(t,i);break;case 1:oo(t,i)}i.childFlags&e&&i.childFlags&n||(s+=i.childCount)}}let mo=!1;function go(t,e,n,r,i,s){const o=i.injector.get(rn);return Xs(vo(t,i,o,e,n),r,s)}function yo(t,e,n,r,i,s){const o=i.injector.get(rn),a=vo(t,i,new Xo(o),e,n),l=Do(r);return Yo(Fo.create,Xs,null,[a,l,s])}function vo(t,e,n,r,i){const s=e.injector.get(ve),o=e.injector.get(Ht),a=n.createRenderer(null,null);return{ngModule:e,injector:t,projectableNodes:r,selectorOrNode:i,sanitizer:s,rendererFactory:n,renderer:a,errorHandler:o}}function bo(t,e,n,r){const i=Do(n);return Yo(Fo.create,Ks,null,[t,e,i,r])}function xo(t,e,n,r){return n=Co.get(e.element.componentProvider.provider.token)||Do(n),Yo(Fo.create,Zs,null,[t,e,n,r])}function _o(t,e,n,r){return jr(t,e,n,function(t){const{hasOverrides:e,hasDeprecatedOverrides:n}=function(t){let e=!1,n=!1;return 0===wo.size||(t.providers.forEach(t=>{const r=wo.get(t.token);3840&t.flags&&r&&(e=!0,n=n||r.deprecatedBehavior)}),t.modules.forEach(t=>{So.forEach((r,i)=>{mt(i).providedIn===t&&(e=!0,n=n||r.deprecatedBehavior)})})),{hasOverrides:e,hasDeprecatedOverrides:n}}(t);return e?(function(t){for(let e=0;e<t.providers.length;e++){const r=t.providers[e];n&&(r.flags|=4096);const i=wo.get(r.token);i&&(r.flags=-3841&r.flags|i.flags,r.deps=ir(i.deps),r.value=i.value)}if(So.size>0){let e=new Set(t.modules);So.forEach((r,i)=>{if(e.has(mt(i).providedIn)){let e={token:i,flags:r.flags|(n?4096:0),deps:ir(r.deps),value:r.value,index:t.providers.length};t.providers.push(e),t.providersByKey[Un(i)]=e}})}}(t=t.factory(()=>Bn)),t):t}(r))}const wo=new Map,So=new Map,Co=new Map;function Eo(t){let e;wo.set(t.token,t),"function"==typeof t.token&&(e=mt(t.token))&&"function"==typeof e.providedIn&&So.set(t.token,t)}function ko(t,e){const n=ar(e.viewDefFactory),r=ar(n.nodes[0].element.componentView);Co.set(t,r)}function Ao(){wo.clear(),So.clear(),Co.clear()}function Do(t){if(0===wo.size)return t;const e=function(t){const e=[];let n=null;for(let r=0;r<t.nodes.length;r++){const i=t.nodes[r];1&i.flags&&(n=i),n&&3840&i.flags&&wo.has(i.provider.token)&&(e.push(n.nodeIndex),n=null)}return e}(t);if(0===e.length)return t;t=t.factory(()=>Bn);for(let r=0;r<e.length;r++)n(t,e[r]);return t;function n(t,e){for(let n=e+1;n<t.nodes.length;n++){const e=t.nodes[n];if(1&e.flags)return;if(3840&e.flags){const t=e.provider,n=wo.get(t.token);n&&(e.flags=-3841&e.flags|n.flags,t.deps=ir(n.deps),t.value=n.value)}}}}function No(t,e,n,r,i,s,o,a,l,u,c,h,d){const f=t.def.nodes[e];return ro(t,f,n,r,i,s,o,a,l,u,c,h,d),224&f.flags?Pn(t,e).value:void 0}function To(t,e,n,r,i,s,o,a,l,u,c,h,d){const f=t.def.nodes[e];return so(t,f,n,r,i,s,o,a,l,u,c,h,d),224&f.flags?Pn(t,e).value:void 0}function Oo(t){return Yo(Fo.detectChanges,no,null,[t])}function Io(t){return Yo(Fo.checkNoChanges,eo,null,[t])}function Ro(t){return Yo(Fo.destroy,ao,null,[t])}const Fo=function(){var t={create:0,detectChanges:1,checkNoChanges:2,destroy:3,handleEvent:4};return t[t.create]="create",t[t.detectChanges]="detectChanges",t[t.checkNoChanges]="checkNoChanges",t[t.destroy]="destroy",t[t.handleEvent]="handleEvent",t}();let Mo,$o,Po;function zo(t,e){$o=t,Po=e}function Lo(t,e,n,r){return zo(t,e),Yo(Fo.handleEvent,t.def.handleEvent,null,[t,e,n,r])}function Bo(t,e){if(128&t.state)throw On(Fo[Mo]);return zo(t,Wo(t,0)),t.def.updateDirectives((function(t,n,r,...i){const s=t.def.nodes[n];return 0===e?Uo(t,s,r,i):Vo(t,s,r,i),16384&s.flags&&zo(t,Wo(t,n)),224&s.flags?Pn(t,s.nodeIndex).value:void 0}),t)}function jo(t,e){if(128&t.state)throw On(Fo[Mo]);return zo(t,qo(t,0)),t.def.updateRenderer((function(t,n,r,...i){const s=t.def.nodes[n];return 0===e?Uo(t,s,r,i):Vo(t,s,r,i),3&s.flags&&zo(t,qo(t,n)),224&s.flags?Pn(t,s.nodeIndex).value:void 0}),t)}function Uo(t,e,n,r){if(ro(t,e,n,...r)){const s=1===n?r[0]:r;if(16384&e.flags){const n={};for(let t=0;t<e.bindings.length;t++){const r=e.bindings[t],o=s[t];8&r.flags&&(n[(i=r.nonMinifiedName,"ng-reflect-"+i.replace(/[$@]/g,"_").replace(_e,(...t)=>"-"+t[1].toLowerCase()))]=we(o))}const r=e.parent,o=Mn(t,r.nodeIndex).renderElement;if(r.element.name)for(let e in n){const r=n[e];null!=r?t.renderer.setAttribute(o,e,r):t.renderer.removeAttribute(o,e)}else t.renderer.setValue(o,"bindings="+JSON.stringify(n,null,2))}}var i}function Vo(t,e,n,r){so(t,e,n,...r)}function Wo(t,e){for(let n=e;n<t.def.nodes.length;n++){const e=t.def.nodes[n];if(16384&e.flags&&e.bindings&&e.bindings.length)return n}return null}function qo(t,e){for(let n=e;n<t.def.nodes.length;n++){const e=t.def.nodes[n];if(3&e.flags&&e.bindings&&e.bindings.length)return n}return null}class Ho{constructor(t,e){this.view=t,this.nodeIndex=e,null==e&&(this.nodeIndex=e=0),this.nodeDef=t.def.nodes[e];let n=this.nodeDef,r=t;for(;n&&0==(1&n.flags);)n=n.parent;if(!n)for(;!n&&r;)n=Qn(r),r=r.parent;this.elDef=n,this.elView=r}get elOrCompView(){return Mn(this.elView,this.elDef.nodeIndex).componentView||this.view}get injector(){return $r(this.elView,this.elDef)}get component(){return this.elOrCompView.component}get context(){return this.elOrCompView.context}get providerTokens(){const t=[];if(this.elDef)for(let e=this.elDef.nodeIndex+1;e<=this.elDef.nodeIndex+this.elDef.childCount;e++){const n=this.elView.def.nodes[e];20224&n.flags&&t.push(n.provider.token),e+=n.childCount}return t}get references(){const t={};if(this.elDef){Go(this.elView,this.elDef,t);for(let e=this.elDef.nodeIndex+1;e<=this.elDef.nodeIndex+this.elDef.childCount;e++){const n=this.elView.def.nodes[e];20224&n.flags&&Go(this.elView,n,t),e+=n.childCount}}return t}get componentRenderElement(){const t=function(t){for(;t&&!tr(t);)t=t.parent;return t.parent?Mn(t.parent,Qn(t).nodeIndex):null}(this.elOrCompView);return t?t.renderElement:void 0}get renderNode(){return 2&this.nodeDef.flags?Jn(this.view,this.nodeDef):Jn(this.elView,this.elDef)}logError(t,...e){let n,r;2&this.nodeDef.flags?(n=this.view.def,r=this.nodeDef.nodeIndex):(n=this.elView.def,r=this.elDef.nodeIndex);const i=function(t,e){let n=-1;for(let r=0;r<=e;r++)3&t.nodes[r].flags&&n++;return n}(n,r);let s=-1;n.factory(()=>(s++,s===i?t.error.bind(t,...e):Bn)),s<i&&(t.error("Illegal state: the ViewDefinitionFactory did not call the logger!"),t.error(...e))}}function Go(t,e,n){for(let r in e.references)n[r]=Bs(t,e,e.references[r])}function Yo(t,e,n,r){const i=Mo,s=$o,o=Po;try{Mo=t;const a=e.apply(n,r);return $o=s,Po=o,Mo=i,a}catch(a){if(Vt(a)||!$o)throw a;throw function(t,e){return t instanceof Error||(t=new Error(t.toString())),Tn(t,e),t}(a,Ko())}}function Ko(){return $o?new Ho($o,Po):null}class Xo{constructor(t){this.delegate=t}createRenderer(t,e){return new Zo(this.delegate.createRenderer(t,e))}begin(){this.delegate.begin&&this.delegate.begin()}end(){this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.delegate.whenRenderingDone?this.delegate.whenRenderingDone():Promise.resolve(null)}}class Zo{constructor(t){this.delegate=t,this.debugContextFactory=Ko,this.data=this.delegate.data}createDebugContext(t){return this.debugContextFactory(t)}destroyNode(t){const e=ws(t);!function(t){_s.delete(t.nativeNode)}(e),e instanceof bs&&(e.listeners.length=0),this.delegate.destroyNode&&this.delegate.destroyNode(t)}destroy(){this.delegate.destroy()}createElement(t,e){const n=this.delegate.createElement(t,e),r=this.createDebugContext(n);if(r){const e=new xs(n,null,r);e.name=t,Ss(e)}return n}createComment(t){const e=this.delegate.createComment(t),n=this.createDebugContext(e);return n&&Ss(new bs(e,null,n)),e}createText(t){const e=this.delegate.createText(t),n=this.createDebugContext(e);return n&&Ss(new bs(e,null,n)),e}appendChild(t,e){const n=ws(t),r=ws(e);n&&r&&n instanceof xs&&n.addChild(r),this.delegate.appendChild(t,e)}insertBefore(t,e,n){const r=ws(t),i=ws(e),s=ws(n);r&&i&&r instanceof xs&&r.insertBefore(s,i),this.delegate.insertBefore(t,e,n)}removeChild(t,e){const n=ws(t),r=ws(e);n&&r&&n instanceof xs&&n.removeChild(r),this.delegate.removeChild(t,e)}selectRootElement(t,e){const n=this.delegate.selectRootElement(t,e),r=Ko();return r&&Ss(new xs(n,null,r)),n}setAttribute(t,e,n,r){const i=ws(t);i&&i instanceof xs&&(i.attributes[r?r+":"+e:e]=n),this.delegate.setAttribute(t,e,n,r)}removeAttribute(t,e,n){const r=ws(t);r&&r instanceof xs&&(r.attributes[n?n+":"+e:e]=null),this.delegate.removeAttribute(t,e,n)}addClass(t,e){const n=ws(t);n&&n instanceof xs&&(n.classes[e]=!0),this.delegate.addClass(t,e)}removeClass(t,e){const n=ws(t);n&&n instanceof xs&&(n.classes[e]=!1),this.delegate.removeClass(t,e)}setStyle(t,e,n,r){const i=ws(t);i&&i instanceof xs&&(i.styles[e]=n),this.delegate.setStyle(t,e,n,r)}removeStyle(t,e,n){const r=ws(t);r&&r instanceof xs&&(r.styles[e]=null),this.delegate.removeStyle(t,e,n)}setProperty(t,e,n){const r=ws(t);r&&r instanceof xs&&(r.properties[e]=n),this.delegate.setProperty(t,e,n)}listen(t,e,n){if("string"!=typeof t){const r=ws(t);r&&r.listeners.push(new vs(e,n))}return this.delegate.listen(t,e,n)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setValue(t,e){return this.delegate.setValue(t,e)}}function Qo(t,e,n){return new Jo(t,e,n)}class Jo extends zt{constructor(t,e,n){super(),this.moduleType=t,this._bootstrapComponents=e,this._ngModuleDefFactory=n}create(t){!function(){if(mo)return;mo=!0;const t=Kt()?{setCurrentNode:zo,createRootView:yo,createEmbeddedView:bo,createComponentView:xo,createNgModuleRef:_o,overrideProvider:Eo,overrideComponentView:ko,clearOverrides:Ao,checkAndUpdateView:Oo,checkNoChangesView:Io,destroyView:Ro,createDebugContext:(t,e)=>new Ho(t,e),handleEvent:Lo,updateDirectives:Bo,updateRenderer:jo}:{setCurrentNode:()=>{},createRootView:go,createEmbeddedView:Ks,createComponentView:Zs,createNgModuleRef:jr,overrideProvider:Bn,overrideComponentView:Bn,clearOverrides:Bn,checkAndUpdateView:no,checkNoChangesView:eo,destroyView:ao,createDebugContext:(t,e)=>new Ho(t,e),handleEvent:(t,e,n,r)=>t.def.handleEvent(t,e,n,r),updateDirectives:(t,e)=>t.def.updateDirectives(0===e?No:To,t),updateRenderer:(t,e)=>t.def.updateRenderer(0===e?No:To,t)};Ln.setCurrentNode=t.setCurrentNode,Ln.createRootView=t.createRootView,Ln.createEmbeddedView=t.createEmbeddedView,Ln.createComponentView=t.createComponentView,Ln.createNgModuleRef=t.createNgModuleRef,Ln.overrideProvider=t.overrideProvider,Ln.overrideComponentView=t.overrideComponentView,Ln.clearOverrides=t.clearOverrides,Ln.checkAndUpdateView=t.checkAndUpdateView,Ln.checkNoChangesView=t.checkNoChangesView,Ln.destroyView=t.destroyView,Ln.resolveDep=ai,Ln.createDebugContext=t.createDebugContext,Ln.handleEvent=t.handleEvent,Ln.updateDirectives=t.updateDirectives,Ln.updateRenderer=t.updateRenderer,Ln.dirtyParentQueries=Ps}();const e=function(t){const e=Array.from(t.providers),n=Array.from(t.modules),r={};for(const i in t.providersByKey)r[i]=t.providersByKey[i];return{factory:t.factory,isRoot:t.isRoot,providers:e,modules:n,providersByKey:r}}(ar(this._ngModuleDefFactory));return Ln.createNgModuleRef(this.moduleType,t||Ae.NULL,this._bootstrapComponents,e)}}n("yLV6");class ta{}class ea{constructor(){this.title="tensorflowModels"}}class na{}const ra=new kt("Location Initialized");class ia{}const sa=new kt("appBaseHref");class oa{constructor(t,e){this._subject=new vi,this._urlChangeListeners=[],this._platformStrategy=t;const n=this._platformStrategy.getBaseHref();this._platformLocation=e,this._baseHref=oa.stripTrailingSlash(aa(n)),this._platformStrategy.onPopState(t=>{this._subject.emit({url:this.path(!0),pop:!0,state:t.state,type:t.type})})}path(t=!1){return this.normalize(this._platformStrategy.path(t))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(t,e=""){return this.path()==this.normalize(t+oa.normalizeQueryParams(e))}normalize(t){return oa.stripTrailingSlash(function(t,e){return t&&e.startsWith(t)?e.substring(t.length):e}(this._baseHref,aa(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._platformStrategy.prepareExternalUrl(t)}go(t,e="",n=null){this._platformStrategy.pushState(n,"",t,e),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+oa.normalizeQueryParams(e)),n)}replaceState(t,e="",n=null){this._platformStrategy.replaceState(n,"",t,e),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+oa.normalizeQueryParams(e)),n)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}onUrlChange(t){this._urlChangeListeners.push(t),this.subscribe(t=>{this._notifyUrlChangeListeners(t.url,t.state)})}_notifyUrlChangeListeners(t="",e){this._urlChangeListeners.forEach(n=>n(t,e))}subscribe(t,e,n){return this._subject.subscribe({next:t,error:e,complete:n})}static normalizeQueryParams(t){return t&&"?"!==t[0]?"?"+t:t}static joinWithSlash(t,e){if(0==t.length)return e;if(0==e.length)return t;let n=0;return t.endsWith("/")&&n++,e.startsWith("/")&&n++,2==n?t+e.substring(1):1==n?t+e:t+"/"+e}static stripTrailingSlash(t){const e=t.match(/#|\?|$/),n=e&&e.index||t.length;return t.slice(0,n-("/"===t[n-1]?1:0))+t.slice(n)}}function aa(t){return t.replace(/\/index.html$/,"")}class la extends ia{constructor(t,e){super(),this._platformLocation=t,this._baseHref="",null!=e&&(this._baseHref=e)}onPopState(t){this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t)}getBaseHref(){return this._baseHref}path(t=!1){let e=this._platformLocation.hash;return null==e&&(e="#"),e.length>0?e.substring(1):e}prepareExternalUrl(t){const e=oa.joinWithSlash(this._baseHref,t);return e.length>0?"#"+e:e}pushState(t,e,n,r){let i=this.prepareExternalUrl(n+oa.normalizeQueryParams(r));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.pushState(t,e,i)}replaceState(t,e,n,r){let i=this.prepareExternalUrl(n+oa.normalizeQueryParams(r));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.replaceState(t,e,i)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}}class ua extends ia{constructor(t,e){if(super(),this._platformLocation=t,null==e&&(e=this._platformLocation.getBaseHrefFromDOM()),null==e)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=e}onPopState(t){this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t)}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return oa.joinWithSlash(this._baseHref,t)}path(t=!1){const e=this._platformLocation.pathname+oa.normalizeQueryParams(this._platformLocation.search),n=this._platformLocation.hash;return n&&t?`${e}${n}`:e}pushState(t,e,n,r){const i=this.prepareExternalUrl(n+oa.normalizeQueryParams(r));this._platformLocation.pushState(t,e,i)}replaceState(t,e,n,r){const i=this.prepareExternalUrl(n+oa.normalizeQueryParams(r));this._platformLocation.replaceState(t,e,i)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}}const ca=function(){var t={Zero:0,One:1,Two:2,Few:3,Many:4,Other:5};return t[t.Zero]="Zero",t[t.One]="One",t[t.Two]="Two",t[t.Few]="Few",t[t.Many]="Many",t[t.Other]="Other",t}(),ha=new kt("UseV4Plurals");class da{}class fa extends da{constructor(t,e){super(),this.locale=t,this.deprecatedPluralFn=e}getPluralCategory(t,e){switch(this.deprecatedPluralFn?this.deprecatedPluralFn(e||this.locale,t):function(t){return function(t){const e=t.toLowerCase().replace(/_/g,"-");let n=pi[e];if(n)return n;const r=e.split("-")[0];if(n=pi[r],n)return n;if("en"===r)return yi;throw new Error(`Missing locale data for the locale "${t}".`)}(t)[mi.PluralCase]}(e||this.locale)(t)){case ca.Zero:return"zero";case ca.One:return"one";case ca.Two:return"two";case ca.Few:return"few";case ca.Many:return"many";default:return"other"}}}class pa{}class ma{constructor(t,e,n,r){this._iterableDiffers=t,this._keyValueDiffers=e,this._ngEl=n,this._renderer=r,this._initialClasses=[]}getValue(){return null}setClass(t){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof t?t.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}setNgClass(t){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof t?t.split(/\s+/):t,this._rawClass&&(je(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}applyChanges(){if(this._iterableDiffer){const t=this._iterableDiffer.diff(this._rawClass);t&&this._applyIterableChanges(t)}else if(this._keyValueDiffer){const t=this._keyValueDiffer.diff(this._rawClass);t&&this._applyKeyValueChanges(t)}}_applyKeyValueChanges(t){t.forEachAddedItem(t=>this._toggleClass(t.key,t.currentValue)),t.forEachChangedItem(t=>this._toggleClass(t.key,t.currentValue)),t.forEachRemovedItem(t=>{t.previousValue&&this._toggleClass(t.key,!1)})}_applyIterableChanges(t){t.forEachAddedItem(t=>{if("string"!=typeof t.item)throw new Error("NgClass can only toggle CSS classes expressed as strings, got "+yt(t.item));this._toggleClass(t.item,!0)}),t.forEachRemovedItem(t=>this._toggleClass(t.item,!1))}_applyClasses(t){t&&(Array.isArray(t)||t instanceof Set?t.forEach(t=>this._toggleClass(t,!0)):Object.keys(t).forEach(e=>this._toggleClass(e,!!t[e])))}_removeClasses(t){t&&(Array.isArray(t)||t instanceof Set?t.forEach(t=>this._toggleClass(t,!1)):Object.keys(t).forEach(t=>this._toggleClass(t,!1)))}_toggleClass(t,e){(t=t.trim())&&t.split(/\s+/g).forEach(t=>{e?this._renderer.addClass(this._ngEl.nativeElement,t):this._renderer.removeClass(this._ngEl.nativeElement,t)})}}let ga=(()=>{class t{constructor(t){this._delegate=t}getValue(){return this._delegate.getValue()}}return t.ngDirectiveDef=void 0,t})();class ya extends ga{constructor(t){super(t)}set klass(t){this._delegate.setClass(t)}set ngClass(t){this._delegate.setNgClass(t)}ngDoCheck(){this._delegate.applyChanges()}}class va{constructor(t,e,n,r){this.$implicit=t,this.ngForOf=e,this.index=n,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}class ba{constructor(t,e,n){this._viewContainer=t,this._template=e,this._differs=n,this._ngForOfDirty=!0,this._differ=null}set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){Kt()&&null!=t&&"function"!=typeof t&&console&&console.warn&&console.warn(`trackBy must be a function, but received ${JSON.stringify(t)}. See https://angular.io/docs/ts/latest/api/common/index/NgFor-directive.html#!#change-propagation for more information.`),this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const n=this._ngForOf;if(!this._differ&&n)try{this._differ=this._differs.find(n).create(this.ngForTrackBy)}catch(e){throw new Error(`Cannot find a differ supporting object '${n}' of type '${t=n,t.name||typeof t}'. NgFor only supports binding to Iterables such as Arrays.`)}}var t;if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const e=[];t.forEachOperation((t,n,r)=>{if(null==t.previousIndex){const n=this._viewContainer.createEmbeddedView(this._template,new va(null,this._ngForOf,-1,-1),r),i=new xa(t,n);e.push(i)}else if(null==r)this._viewContainer.remove(n);else{const i=this._viewContainer.get(n);this._viewContainer.move(i,r);const s=new xa(t,i);e.push(s)}});for(let n=0;n<e.length;n++)this._perViewChange(e[n].view,e[n].record);for(let n=0,r=this._viewContainer.length;n<r;n++){const t=this._viewContainer.get(n);t.context.index=n,t.context.count=r,t.context.ngForOf=this._ngForOf}t.forEachIdentityChange(t=>{this._viewContainer.get(t.currentIndex).context.$implicit=t.item})}_perViewChange(t,e){t.context.$implicit=e.item}static ngTemplateContextGuard(t,e){return!0}}class xa{constructor(t,e){this.record=t,this.view=e}}class _a{constructor(t,e){this._viewContainer=t,this._context=new wa,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=e}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){Sa("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){Sa("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}}class wa{constructor(){this.$implicit=null,this.ngIf=null}}function Sa(t,e){if(e&&!e.createEmbeddedView)throw new Error(`${t} must be a TemplateRef, but received '${yt(e)}'.`)}class Ca{constructor(t,e){this._viewContainerRef=t,this._templateRef=e,this._created=!1}create(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}destroy(){this._created=!1,this._viewContainerRef.clear()}enforceState(t){t&&!this._created?this.create():!t&&this._created&&this.destroy()}}class Ea{constructor(){this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}set ngSwitch(t){this._ngSwitch=t,0===this._caseCount&&this._updateDefaultCases(!0)}_addCase(){return this._caseCount++}_addDefault(t){this._defaultViews||(this._defaultViews=[]),this._defaultViews.push(t)}_matchCase(t){const e=t==this._ngSwitch;return this._lastCasesMatched=this._lastCasesMatched||e,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),e}_updateDefaultCases(t){if(this._defaultViews&&t!==this._defaultUsed){this._defaultUsed=t;for(let e=0;e<this._defaultViews.length;e++)this._defaultViews[e].enforceState(t)}}}class ka{constructor(t,e,n){this.ngSwitch=n,n._addCase(),this._view=new Ca(t,e)}ngDoCheck(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}}class Aa{createSubscription(t,e){return t.subscribe({next:e,error:t=>{throw t}})}dispose(t){t.unsubscribe()}onDestroy(t){t.unsubscribe()}}class Da{createSubscription(t,e){return t.then(e,t=>{throw t})}dispose(t){}onDestroy(t){}}const Na=new Da,Ta=new Aa;class Oa{constructor(t){this._ref=t,this._latestValue=null,this._latestReturnedValue=null,this._subscription=null,this._obj=null,this._strategy=null}ngOnDestroy(){this._subscription&&this._dispose()}transform(t){return this._obj?t!==this._obj?(this._dispose(),this.transform(t)):ze(this._latestValue,this._latestReturnedValue)?this._latestReturnedValue:(this._latestReturnedValue=this._latestValue,Be.wrap(this._latestValue)):(t&&this._subscribe(t),this._latestReturnedValue=this._latestValue,this._latestValue)}_subscribe(t){this._obj=t,this._strategy=this._selectStrategy(t),this._subscription=this._strategy.createSubscription(t,e=>this._updateLatestValue(t,e))}_selectStrategy(t){if(Ve(t))return Na;if(We(t))return Ta;throw Error(`InvalidPipeArgument: '${t}' for pipe '${yt(Oa)}'`)}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._latestReturnedValue=null,this._subscription=null,this._obj=null}_updateLatestValue(t,e){t===this._obj&&(this._latestValue=e,this._ref.markForCheck())}}class Ia{}const Ra=new kt("DocumentToken");function Fa(t){return"browser"===t}function Ma(t){return"server"===t}let $a=(()=>{class t{}return t.ngInjectableDef=pt({token:t,providedIn:"root",factory:()=>new Pa(Rt(Ra),window,Rt(Ht))}),t})();class Pa{constructor(t,e,n){this.document=t,this.window=e,this.errorHandler=n,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportScrollRestoration()?[this.window.scrollX,this.window.scrollY]:[0,0]}scrollToPosition(t){this.supportScrollRestoration()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(this.supportScrollRestoration()){t=this.window.CSS&&this.window.CSS.escape?this.window.CSS.escape(t):t.replace(/(\"|\'\ |:|\.|\[|\]|,|=)/g,"\\$1");try{const e=this.document.querySelector("#"+t);if(e)return void this.scrollToElement(e);const n=this.document.querySelector(`[name='${t}']`);if(n)return void this.scrollToElement(n)}catch(e){this.errorHandler.handleError(e)}}}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const e=this.window.history;e&&e.scrollRestoration&&(e.scrollRestoration=t)}}scrollToElement(t){const e=t.getBoundingClientRect(),n=e.left+this.window.pageXOffset,r=e.top+this.window.pageYOffset,i=this.offset();this.window.scrollTo(n-i[0],r-i[1])}supportScrollRestoration(){try{return!!this.window&&!!this.window.scrollTo}catch(t){return!1}}}const za=new _(t=>t.complete());function La(t){return t?function(t){return new _(e=>t.schedule(()=>e.complete()))}(t):za}function Ba(t){const e=new _(e=>{e.next(t),e.complete()});return e._isScalar=!0,e.value=t,e}function ja(...t){let e=t[t.length-1];switch(N(e)?t.pop():e=void 0,t.length){case 0:return La(e);case 1:return e?q(t,e):Ba(t[0]);default:return q(t,e)}}class Ua extends A{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const e=super._subscribe(t);return e&&!e.closed&&t.next(this._value),e}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new C;return this._value}next(t){super.next(this._value=t)}}function Va(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}Va.prototype=Object.create(Error.prototype);const Wa=Va,qa={};function Ha(...t){let e=null,n=null;return N(t[t.length-1])&&(n=t.pop()),"function"==typeof t[t.length-1]&&(e=t.pop()),1===t.length&&l(t[0])&&(t=t[0]),q(t,n).lift(new Ga(e))}class Ga{constructor(t){this.resultSelector=t}call(t,e){return e.subscribe(new Ya(t,this.resultSelector))}}class Ya extends j{constructor(t,e){super(t),this.resultSelector=e,this.active=0,this.values=[],this.observables=[]}_next(t){this.values.push(qa),this.observables.push(t)}_complete(){const t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(let n=0;n<e;n++){const e=t[n];this.add(B(this,e,e,n))}}}notifyComplete(t){0==(this.active-=1)&&this.destination.complete()}notifyNext(t,e,n,r,i){const s=this.values,o=this.toRespond?s[n]===qa?--this.toRespond:this.toRespond:0;s[n]=e,0===o&&(this.resultSelector?this._tryResultSelector(s):this.destination.next(s.slice()))}_tryResultSelector(t){let e;try{e=this.resultSelector.apply(this,t)}catch(n){return void this.destination.error(n)}this.destination.next(e)}}function Ka(t){return new _(e=>{let n;try{n=t()}catch(r){return void e.error(r)}return(n?H(n):La()).subscribe(e)})}function Xa(){return Z(1)}function Za(t,e){return function(n){return n.lift(new Qa(t,e))}}class Qa{constructor(t,e){this.predicate=t,this.thisArg=e}call(t,e){return e.subscribe(new Ja(t,this.predicate,this.thisArg))}}class Ja extends m{constructor(t,e,n){super(t),this.predicate=e,this.thisArg=n,this.count=0}_next(t){let e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(n){return void this.destination.error(n)}e&&this.destination.next(t)}}function tl(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}tl.prototype=Object.create(Error.prototype);const el=tl;function nl(t){return function(e){return 0===t?La():e.lift(new rl(t))}}class rl{constructor(t){if(this.total=t,this.total<0)throw new el}call(t,e){return e.subscribe(new il(t,this.total))}}class il extends m{constructor(t,e){super(t),this.total=e,this.ring=new Array,this.count=0}_next(t){const e=this.ring,n=this.total,r=this.count++;e.length<n?e.push(t):e[r%n]=t}_complete(){const t=this.destination;let e=this.count;if(e>0){const n=this.count>=this.total?this.total:this.count,r=this.ring;for(let i=0;i<n;i++){const i=e++%n;t.next(r[i])}}t.complete()}}function sl(t,e,n){return function(r){return r.lift(new ol(t,e,n))}}class ol{constructor(t,e,n){this.nextOrObserver=t,this.error=e,this.complete=n}call(t,e){return e.subscribe(new al(t,this.nextOrObserver,this.error,this.complete))}}class al extends m{constructor(t,e,n,i){super(t),this._tapNext=v,this._tapError=v,this._tapComplete=v,this._tapError=n||v,this._tapComplete=i||v,r(e)?(this._context=this,this._tapNext=e):e&&(this._context=e,this._tapNext=e.next||v,this._tapError=e.error||v,this._tapComplete=e.complete||v)}_next(t){try{this._tapNext.call(this._context,t)}catch(e){return void this.destination.error(e)}this.destination.next(t)}_error(t){try{this._tapError.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.error(t)}_complete(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()}}const ll=(t=ul)=>sl({hasValue:!1,next(){this.hasValue=!0},complete(){if(!this.hasValue)throw t()}});function ul(){return new Wa}function cl(t=null){return e=>e.lift(new hl(t))}class hl{constructor(t){this.defaultValue=t}call(t,e){return e.subscribe(new dl(t,this.defaultValue))}}class dl extends m{constructor(t,e){super(t),this.defaultValue=e,this.isEmpty=!0}_next(t){this.isEmpty=!1,this.destination.next(t)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}function fl(t,e){const n=arguments.length>=2;return r=>r.pipe(t?Za((e,n)=>t(e,n,r)):X,nl(1),n?cl(e):ll(()=>new Wa))}function pl(t){return function(e){const n=new ml(t),r=e.lift(n);return n.caught=r}}class ml{constructor(t){this.selector=t}call(t,e){return e.subscribe(new gl(t,this.selector,this.caught))}}class gl extends j{constructor(t,e,n){super(t),this.selector=e,this.caught=n}error(t){if(!this.isStopped){let n;try{n=this.selector(t,this.caught)}catch(e){return void super.error(e)}this._unsubscribeAndRecycle();const r=new T(this,void 0,void 0);this.add(r),B(this,n,void 0,void 0,r)}}}function yl(t){return e=>0===t?La():e.lift(new vl(t))}class vl{constructor(t){if(this.total=t,this.total<0)throw new el}call(t,e){return e.subscribe(new bl(t,this.total))}}class bl extends m{constructor(t,e){super(t),this.total=e,this.count=0}_next(t){const e=this.total,n=++this.count;n<=e&&(this.destination.next(t),n===e&&(this.destination.complete(),this.unsubscribe()))}}function xl(t,e){const n=arguments.length>=2;return r=>r.pipe(t?Za((e,n)=>t(e,n,r)):X,yl(1),n?cl(e):ll(()=>new Wa))}class _l{constructor(t,e,n){this.predicate=t,this.thisArg=e,this.source=n}call(t,e){return e.subscribe(new wl(t,this.predicate,this.thisArg,this.source))}}class wl extends m{constructor(t,e,n,r){super(t),this.predicate=e,this.thisArg=n,this.source=r,this.index=0,this.thisArg=n||this}notifyComplete(t){this.destination.next(t),this.destination.complete()}_next(t){let e=!1;try{e=this.predicate.call(this.thisArg,t,this.index++,this.source)}catch(n){return void this.destination.error(n)}e||this.notifyComplete(!1)}_complete(){this.notifyComplete(!0)}}function Sl(t,e){return"function"==typeof e?n=>n.pipe(Sl((n,r)=>H(t(n,r)).pipe(U((t,i)=>e(n,t,r,i))))):e=>e.lift(new Cl(t))}class Cl{constructor(t){this.project=t}call(t,e){return e.subscribe(new El(t,this.project))}}class El extends j{constructor(t,e){super(t),this.project=e,this.index=0}_next(t){let e;const n=this.index++;try{e=this.project(t,n)}catch(r){return void this.destination.error(r)}this._innerSub(e,t,n)}_innerSub(t,e,n){const r=this.innerSubscription;r&&r.unsubscribe();const i=new T(this,void 0,void 0);this.destination.add(i),this.innerSubscription=B(this,t,e,n,i)}_complete(){const{innerSubscription:t}=this;t&&!t.closed||super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=null}notifyComplete(t){this.destination.remove(t),this.innerSubscription=null,this.isStopped&&super._complete()}notifyNext(t,e,n,r,i){this.destination.next(e)}}function kl(...t){return Xa()(ja(...t))}function Al(...t){return e=>{let n=t[t.length-1];N(n)?t.pop():n=null;const r=t.length;return kl(1!==r||n?r>0?q(t,n):La(n):Ba(t[0]),e)}}function Dl(t,e){let n=!1;return arguments.length>=2&&(n=!0),function(r){return r.lift(new Nl(t,e,n))}}class Nl{constructor(t,e,n=!1){this.accumulator=t,this.seed=e,this.hasSeed=n}call(t,e){return e.subscribe(new Tl(t,this.accumulator,this.seed,this.hasSeed))}}class Tl extends m{constructor(t,e,n,r){super(t),this.accumulator=e,this._seed=n,this.hasSeed=r,this.index=0}get seed(){return this._seed}set seed(t){this.hasSeed=!0,this._seed=t}_next(t){if(this.hasSeed)return this._tryNext(t);this.seed=t,this.destination.next(t)}_tryNext(t){const e=this.index++;let n;try{n=this.accumulator(this.seed,t,e)}catch(r){this.destination.error(r)}this.seed=n,this.destination.next(n)}}function Ol(t,e){return G(t,e,1)}function Il(t){return e=>e.lift(new Rl(t))}class Rl{constructor(t){this.callback=t}call(t,e){return e.subscribe(new Fl(t,this.callback))}}class Fl extends m{constructor(t,e){super(t),this.add(new d(e))}}let Ml=null;function $l(){return Ml}const Pl={class:"className",innerHtml:"innerHTML",readonly:"readOnly",tabindex:"tabIndex"},zl={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Ll={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},Bl=(()=>{if(Et.Node)return Et.Node.prototype.contains||function(t){return!!(16&this.compareDocumentPosition(t))}})();class jl extends class extends class{constructor(){this.resourceLoaderType=null}get attrToPropMap(){return this._attrToPropMap}set attrToPropMap(t){this._attrToPropMap=t}}{constructor(){super(),this._animationPrefix=null,this._transitionEnd=null;try{const t=this.createElement("div",document);if(null!=this.getStyle(t,"animationName"))this._animationPrefix="";else{const e=["Webkit","Moz","O","ms"];for(let n=0;n<e.length;n++)if(null!=this.getStyle(t,e[n]+"AnimationName")){this._animationPrefix="-"+e[n].toLowerCase()+"-";break}}const e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};Object.keys(e).forEach(n=>{null!=this.getStyle(t,n)&&(this._transitionEnd=e[n])})}catch(t){this._animationPrefix=null,this._transitionEnd=null}}getDistributedNodes(t){return t.getDistributedNodes()}resolveAndSetHref(t,e,n){t.href=null==n?e:e+"/../"+n}supportsDOMEvents(){return!0}supportsNativeShadowDOM(){return"function"==typeof document.body.createShadowRoot}getAnimationPrefix(){return this._animationPrefix?this._animationPrefix:""}getTransitionEnd(){return this._transitionEnd?this._transitionEnd:""}supportsAnimation(){return null!=this._animationPrefix&&null!=this._transitionEnd}}{parse(t){throw new Error("parse not implemented")}static makeCurrent(){var t;t=new jl,Ml||(Ml=t)}hasProperty(t,e){return e in t}setProperty(t,e,n){t[e]=n}getProperty(t,e){return t[e]}invoke(t,e,n){t[e](...n)}logError(t){window.console&&(console.error?console.error(t):console.log(t))}log(t){window.console&&window.console.log&&window.console.log(t)}logGroup(t){window.console&&window.console.group&&window.console.group(t)}logGroupEnd(){window.console&&window.console.groupEnd&&window.console.groupEnd()}get attrToPropMap(){return Pl}contains(t,e){return Bl.call(t,e)}querySelector(t,e){return t.querySelector(e)}querySelectorAll(t,e){return t.querySelectorAll(e)}on(t,e,n){t.addEventListener(e,n,!1)}onAndCancel(t,e,n){return t.addEventListener(e,n,!1),()=>{t.removeEventListener(e,n,!1)}}dispatchEvent(t,e){t.dispatchEvent(e)}createMouseEvent(t){const e=this.getDefaultDocument().createEvent("MouseEvent");return e.initEvent(t,!0,!0),e}createEvent(t){const e=this.getDefaultDocument().createEvent("Event");return e.initEvent(t,!0,!0),e}preventDefault(t){t.preventDefault(),t.returnValue=!1}isPrevented(t){return t.defaultPrevented||null!=t.returnValue&&!t.returnValue}getInnerHTML(t){return t.innerHTML}getTemplateContent(t){return"content"in t&&this.isTemplateElement(t)?t.content:null}getOuterHTML(t){return t.outerHTML}nodeName(t){return t.nodeName}nodeValue(t){return t.nodeValue}type(t){return t.type}content(t){return this.hasProperty(t,"content")?t.content:t}firstChild(t){return t.firstChild}nextSibling(t){return t.nextSibling}parentElement(t){return t.parentNode}childNodes(t){return t.childNodes}childNodesAsList(t){const e=t.childNodes,n=new Array(e.length);for(let r=0;r<e.length;r++)n[r]=e[r];return n}clearNodes(t){for(;t.firstChild;)t.removeChild(t.firstChild)}appendChild(t,e){t.appendChild(e)}removeChild(t,e){t.removeChild(e)}replaceChild(t,e,n){t.replaceChild(e,n)}remove(t){return t.parentNode&&t.parentNode.removeChild(t),t}insertBefore(t,e,n){t.insertBefore(n,e)}insertAllBefore(t,e,n){n.forEach(n=>t.insertBefore(n,e))}insertAfter(t,e,n){t.insertBefore(n,e.nextSibling)}setInnerHTML(t,e){t.innerHTML=e}getText(t){return t.textContent}setText(t,e){t.textContent=e}getValue(t){return t.value}setValue(t,e){t.value=e}getChecked(t){return t.checked}setChecked(t,e){t.checked=e}createComment(t){return this.getDefaultDocument().createComment(t)}createTemplate(t){const e=this.getDefaultDocument().createElement("template");return e.innerHTML=t,e}createElement(t,e){return(e=e||this.getDefaultDocument()).createElement(t)}createElementNS(t,e,n){return(n=n||this.getDefaultDocument()).createElementNS(t,e)}createTextNode(t,e){return(e=e||this.getDefaultDocument()).createTextNode(t)}createScriptTag(t,e,n){const r=(n=n||this.getDefaultDocument()).createElement("SCRIPT");return r.setAttribute(t,e),r}createStyleElement(t,e){const n=(e=e||this.getDefaultDocument()).createElement("style");return this.appendChild(n,this.createTextNode(t,e)),n}createShadowRoot(t){return t.createShadowRoot()}getShadowRoot(t){return t.shadowRoot}getHost(t){return t.host}clone(t){return t.cloneNode(!0)}getElementsByClassName(t,e){return t.getElementsByClassName(e)}getElementsByTagName(t,e){return t.getElementsByTagName(e)}classList(t){return Array.prototype.slice.call(t.classList,0)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}hasClass(t,e){return t.classList.contains(e)}setStyle(t,e,n){t.style[e]=n}removeStyle(t,e){t.style[e]=""}getStyle(t,e){return t.style[e]}hasStyle(t,e,n){const r=this.getStyle(t,e)||"";return n?r==n:r.length>0}tagName(t){return t.tagName}attributeMap(t){const e=new Map,n=t.attributes;for(let r=0;r<n.length;r++){const t=n.item(r);e.set(t.name,t.value)}return e}hasAttribute(t,e){return t.hasAttribute(e)}hasAttributeNS(t,e,n){return t.hasAttributeNS(e,n)}getAttribute(t,e){return t.getAttribute(e)}getAttributeNS(t,e,n){return t.getAttributeNS(e,n)}setAttribute(t,e,n){t.setAttribute(e,n)}setAttributeNS(t,e,n,r){t.setAttributeNS(e,n,r)}removeAttribute(t,e){t.removeAttribute(e)}removeAttributeNS(t,e,n){t.removeAttributeNS(e,n)}templateAwareRoot(t){return this.isTemplateElement(t)?this.content(t):t}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}getBoundingClientRect(t){try{return t.getBoundingClientRect()}catch(e){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}}getTitle(t){return t.title}setTitle(t,e){t.title=e||""}elementMatches(t,e){return!!this.isElementNode(t)&&(t.matches&&t.matches(e)||t.msMatchesSelector&&t.msMatchesSelector(e)||t.webkitMatchesSelector&&t.webkitMatchesSelector(e))}isTemplateElement(t){return this.isElementNode(t)&&"TEMPLATE"===t.nodeName}isTextNode(t){return t.nodeType===Node.TEXT_NODE}isCommentNode(t){return t.nodeType===Node.COMMENT_NODE}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}hasShadowRoot(t){return null!=t.shadowRoot&&t instanceof HTMLElement}isShadowRoot(t){return t instanceof DocumentFragment}importIntoDoc(t){return document.importNode(this.templateAwareRoot(t),!0)}adoptNode(t){return document.adoptNode(t)}getHref(t){return t.getAttribute("href")}getEventKey(t){let e=t.key;if(null==e){if(e=t.keyIdentifier,null==e)return"Unidentified";e.startsWith("U+")&&(e=String.fromCharCode(parseInt(e.substring(2),16)),3===t.location&&Ll.hasOwnProperty(e)&&(e=Ll[e]))}return zl[e]||e}getGlobalEventTarget(t,e){return"window"===e?window:"document"===e?t:"body"===e?t.body:null}getHistory(){return window.history}getLocation(){return window.location}getBaseHref(t){const e=Vl||(Vl=document.querySelector("base"),Vl)?Vl.getAttribute("href"):null;return null==e?null:(n=e,Ul||(Ul=document.createElement("a")),Ul.setAttribute("href",n),"/"===Ul.pathname.charAt(0)?Ul.pathname:"/"+Ul.pathname);var n}resetBaseElement(){Vl=null}getUserAgent(){return window.navigator.userAgent}setData(t,e,n){this.setAttribute(t,"data-"+e,n)}getData(t,e){return this.getAttribute(t,"data-"+e)}getComputedStyle(t){return getComputedStyle(t)}supportsWebAnimation(){return"function"==typeof Element.prototype.animate}performanceNow(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}supportsCookies(){return!0}getCookie(t){return function(t,e){e=encodeURIComponent(e);for(const n of t.split(";")){const t=n.indexOf("="),[r,i]=-1==t?[n,""]:[n.slice(0,t),n.slice(t+1)];if(r.trim()===e)return decodeURIComponent(i)}return null}(document.cookie,t)}setCookie(t,e){document.cookie=encodeURIComponent(t)+"="+encodeURIComponent(e)}}let Ul,Vl=null;function Wl(){return!!window.history.pushState}const ql=new kt("TRANSITION_ID"),Hl=[{provide:_i,useFactory:function(t,e,n){return()=>{n.get(wi).donePromise.then(()=>{const n=$l();Array.prototype.slice.apply(n.querySelectorAll(e,"style[ng-transition]")).filter(e=>n.getAttribute(e,"ng-transition")===t).forEach(t=>n.remove(t))})}},deps:[ql,Ra,Ae],multi:!0}];class Gl{static init(){var t;t=new Gl,is=t}addToWindow(t){Et.getAngularTestability=(e,n=!0)=>{const r=t.findTestabilityInTree(e,n);if(null==r)throw new Error("Could not find testability for element.");return r},Et.getAllAngularTestabilities=()=>t.getAllTestabilities(),Et.getAllAngularRootElements=()=>t.getAllRootElements(),Et.frameworkStabilizers||(Et.frameworkStabilizers=[]),Et.frameworkStabilizers.push(t=>{const e=Et.getAllAngularTestabilities();let n=e.length,r=!1;const i=function(e){r=r||e,n--,0==n&&t(r)};e.forEach((function(t){t.whenStable(i)}))})}findTestabilityInTree(t,e,n){if(null==e)return null;const r=t.getTestability(e);return null!=r?r:n?$l().isShadowRoot(e)?this.findTestabilityInTree(t,$l().getHost(e),!0):this.findTestabilityInTree(t,$l().parentElement(e),!0):null}}function Yl(t,e){"undefined"!=typeof COMPILED&&COMPILED||((Et.ng=Et.ng||{})[t]=e)}const Kl=(()=>({ApplicationRef:hs,NgZone:Gi}))();function Xl(t){return ws(t)}const Zl=new kt("EventManagerPlugins");class Ql{constructor(t,e){this._zone=e,this._eventNameToPlugin=new Map,t.forEach(t=>t.manager=this),this._plugins=t.slice().reverse()}addEventListener(t,e,n){return this._findPluginFor(e).addEventListener(t,e,n)}addGlobalEventListener(t,e,n){return this._findPluginFor(e).addGlobalEventListener(t,e,n)}getZone(){return this._zone}_findPluginFor(t){const e=this._eventNameToPlugin.get(t);if(e)return e;const n=this._plugins;for(let r=0;r<n.length;r++){const e=n[r];if(e.supports(t))return this._eventNameToPlugin.set(t,e),e}throw new Error("No event manager plugin found for event "+t)}}class Jl{constructor(t){this._doc=t}addGlobalEventListener(t,e,n){const r=$l().getGlobalEventTarget(this._doc,t);if(!r)throw new Error(`Unsupported event target ${r} for event ${e}`);return this.addEventListener(r,e,n)}}class tu{constructor(){this._stylesSet=new Set}addStyles(t){const e=new Set;t.forEach(t=>{this._stylesSet.has(t)||(this._stylesSet.add(t),e.add(t))}),this.onStylesAdded(e)}onStylesAdded(t){}getAllStyles(){return Array.from(this._stylesSet)}}class eu extends tu{constructor(t){super(),this._doc=t,this._hostNodes=new Set,this._styleNodes=new Set,this._hostNodes.add(t.head)}_addStylesToHost(t,e){t.forEach(t=>{const n=this._doc.createElement("style");n.textContent=t,this._styleNodes.add(e.appendChild(n))})}addHost(t){this._addStylesToHost(this._stylesSet,t),this._hostNodes.add(t)}removeHost(t){this._hostNodes.delete(t)}onStylesAdded(t){this._hostNodes.forEach(e=>this._addStylesToHost(t,e))}ngOnDestroy(){this._styleNodes.forEach(t=>$l().remove(t))}}const nu={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},ru=/%COMP%/g;function iu(t,e,n){for(let r=0;r<e.length;r++){let i=e[r];Array.isArray(i)?iu(t,i,n):(i=i.replace(ru,t),n.push(i))}return n}function su(t){return e=>{!1===t(e)&&(e.preventDefault(),e.returnValue=!1)}}class ou{constructor(t,e,n){this.eventManager=t,this.sharedStylesHost=e,this.appId=n,this.rendererByCompId=new Map,this.defaultRenderer=new au(t)}createRenderer(t,e){if(!t||!e)return this.defaultRenderer;switch(e.encapsulation){case jt.Emulated:{let n=this.rendererByCompId.get(e.id);return n||(n=new cu(this.eventManager,this.sharedStylesHost,e,this.appId),this.rendererByCompId.set(e.id,n)),n.applyToHost(t),n}case jt.Native:case jt.ShadowDom:return new hu(this.eventManager,this.sharedStylesHost,t,e);default:if(!this.rendererByCompId.has(e.id)){const t=iu(e.id,e.styles,[]);this.sharedStylesHost.addStyles(t),this.rendererByCompId.set(e.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}class au{constructor(t){this.eventManager=t,this.data=Object.create(null)}destroy(){}createElement(t,e){return e?document.createElementNS(nu[e]||e,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,e){t.appendChild(e)}insertBefore(t,e,n){t&&t.insertBefore(e,n)}removeChild(t,e){t&&t.removeChild(e)}selectRootElement(t,e){let n="string"==typeof t?document.querySelector(t):t;if(!n)throw new Error(`The selector "${t}" did not match any elements`);return e||(n.textContent=""),n}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,e,n,r){if(r){e=r+":"+e;const i=nu[r];i?t.setAttributeNS(i,e,n):t.setAttribute(e,n)}else t.setAttribute(e,n)}removeAttribute(t,e,n){if(n){const r=nu[n];r?t.removeAttributeNS(r,e):t.removeAttribute(`${n}:${e}`)}else t.removeAttribute(e)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}setStyle(t,e,n,r){r&sn.DashCase?t.style.setProperty(e,n,r&sn.Important?"important":""):t.style[e]=n}removeStyle(t,e,n){n&sn.DashCase?t.style.removeProperty(e):t.style[e]=""}setProperty(t,e,n){uu(e,"property"),t[e]=n}setValue(t,e){t.nodeValue=e}listen(t,e,n){return uu(e,"listener"),"string"==typeof t?this.eventManager.addGlobalEventListener(t,e,su(n)):this.eventManager.addEventListener(t,e,su(n))}}const lu=(()=>"@".charCodeAt(0))();function uu(t,e){if(t.charCodeAt(0)===lu)throw new Error(`Found the synthetic ${e} ${t}. Please include either "BrowserAnimationsModule" or "NoopAnimationsModule" in your application.`)}class cu extends au{constructor(t,e,n,r){super(t),this.component=n;const i=iu(r+"-"+n.id,n.styles,[]);e.addStyles(i),this.contentAttr="_ngcontent-%COMP%".replace(ru,r+"-"+n.id),this.hostAttr=function(t){return"_nghost-%COMP%".replace(ru,t)}(r+"-"+n.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,e){const n=super.createElement(t,e);return super.setAttribute(n,this.contentAttr,""),n}}class hu extends au{constructor(t,e,n,r){super(t),this.sharedStylesHost=e,this.hostEl=n,this.component=r,this.shadowRoot=r.encapsulation===jt.ShadowDom?n.attachShadow({mode:"open"}):n.createShadowRoot(),this.sharedStylesHost.addHost(this.shadowRoot);const i=iu(r.id,r.styles,[]);for(let s=0;s<i.length;s++){const t=document.createElement("style");t.textContent=i[s],this.shadowRoot.appendChild(t)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,e){return super.appendChild(this.nodeOrShadowRoot(t),e)}insertBefore(t,e,n){return super.insertBefore(this.nodeOrShadowRoot(t),e,n)}removeChild(t,e){return super.removeChild(this.nodeOrShadowRoot(t),e)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}const du=(()=>"undefined"!=typeof Zone&&Zone.__symbol__||function(t){return"__zone_symbol__"+t})(),fu=du("addEventListener"),pu=du("removeEventListener"),mu={},gu="__zone_symbol__propagationStopped",yu=(()=>{const t="undefined"!=typeof Zone&&Zone[du("BLACK_LISTED_EVENTS")];if(t){const e={};return t.forEach(t=>{e[t]=t}),e}})(),vu=function(t){return!!yu&&yu.hasOwnProperty(t)},bu=function(t){const e=mu[t.type];if(!e)return;const n=this[e];if(!n)return;const r=[t];if(1===n.length){const t=n[0];return t.zone!==Zone.current?t.zone.run(t.handler,this,r):t.handler.apply(this,r)}{const e=n.slice();for(let n=0;n<e.length&&!0!==t[gu];n++){const t=e[n];t.zone!==Zone.current?t.zone.run(t.handler,this,r):t.handler.apply(this,r)}}};class xu extends Jl{constructor(t,e,n){super(t),this.ngZone=e,n&&Ma(n)||this.patchEvent()}patchEvent(){if("undefined"==typeof Event||!Event||!Event.prototype)return;if(Event.prototype.__zone_symbol__stopImmediatePropagation)return;const t=Event.prototype.__zone_symbol__stopImmediatePropagation=Event.prototype.stopImmediatePropagation;Event.prototype.stopImmediatePropagation=function(){this&&(this[gu]=!0),t&&t.apply(this,arguments)}}supports(t){return!0}addEventListener(t,e,n){let r=n;if(!t[fu]||Gi.isInAngularZone()&&!vu(e))t.addEventListener(e,r,!1);else{let n=mu[e];n||(n=mu[e]=du("ANGULAR"+e+"FALSE"));let i=t[n];const s=i&&i.length>0;i||(i=t[n]=[]);const o=vu(e)?Zone.root:Zone.current;if(0===i.length)i.push({zone:o,handler:r});else{let t=!1;for(let e=0;e<i.length;e++)if(i[e].handler===r){t=!0;break}t||i.push({zone:o,handler:r})}s||t[fu](e,bu,!1)}return()=>this.removeEventListener(t,e,r)}removeEventListener(t,e,n){let r=t[pu];if(!r)return t.removeEventListener.apply(t,[e,n,!1]);let i=mu[e],s=i&&t[i];if(!s)return t.removeEventListener.apply(t,[e,n,!1]);let o=!1;for(let a=0;a<s.length;a++)if(s[a].handler===n){o=!0,s.splice(a,1);break}o?0===s.length&&r.apply(t,[e,bu,!1]):t.removeEventListener.apply(t,[e,n,!1])}}const _u={pan:!0,panstart:!0,panmove:!0,panend:!0,pancancel:!0,panleft:!0,panright:!0,panup:!0,pandown:!0,pinch:!0,pinchstart:!0,pinchmove:!0,pinchend:!0,pinchcancel:!0,pinchin:!0,pinchout:!0,press:!0,pressup:!0,rotate:!0,rotatestart:!0,rotatemove:!0,rotateend:!0,rotatecancel:!0,swipe:!0,swipeleft:!0,swiperight:!0,swipeup:!0,swipedown:!0,tap:!0},wu=new kt("HammerGestureConfig"),Su=new kt("HammerLoader");class Cu extends Jl{constructor(t,e,n,r){super(t),this._config=e,this.console=n,this.loader=r}supports(t){return!(!_u.hasOwnProperty(t.toLowerCase())&&!this.isCustomEvent(t)||!window.Hammer&&!this.loader&&(this.console.warn(`The "${t}" event cannot be bound because Hammer.JS is not loaded and no custom loader has been specified.`),1))}addEventListener(t,e,n){const r=this.manager.getZone();if(e=e.toLowerCase(),!window.Hammer&&this.loader){let r=!1,i=()=>{r=!0};return this.loader().then(()=>{if(!window.Hammer)return this.console.warn("The custom HAMMER_LOADER completed, but Hammer.JS is not present."),void(i=()=>{});r||(i=this.addEventListener(t,e,n))}).catch(()=>{this.console.warn(`The "${e}" event cannot be bound because the custom Hammer.JS loader failed.`),i=()=>{}}),()=>{i()}}return r.runOutsideAngular(()=>{const i=this._config.buildHammer(t),s=function(t){r.runGuarded((function(){n(t)}))};return i.on(e,s),()=>{i.off(e,s),"function"==typeof i.destroy&&i.destroy()}})}isCustomEvent(t){return this._config.events.indexOf(t)>-1}}const Eu=["alt","control","meta","shift"],ku={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey};class Au extends Jl{constructor(t){super(t)}supports(t){return null!=Au.parseEventName(t)}addEventListener(t,e,n){const r=Au.parseEventName(e),i=Au.eventCallback(r.fullKey,n,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>$l().onAndCancel(t,r.domEventName,i))}static parseEventName(t){const e=t.toLowerCase().split("."),n=e.shift();if(0===e.length||"keydown"!==n&&"keyup"!==n)return null;const r=Au._normalizeKey(e.pop());let i="";if(Eu.forEach(t=>{const n=e.indexOf(t);n>-1&&(e.splice(n,1),i+=t+".")}),i+=r,0!=e.length||0===r.length)return null;const s={};return s.domEventName=n,s.fullKey=i,s}static getEventFullKey(t){let e="",n=$l().getEventKey(t);return n=n.toLowerCase()," "===n?n="space":"."===n&&(n="dot"),Eu.forEach(r=>{r!=n&&(0,ku[r])(t)&&(e+=r+".")}),e+=n,e}static eventCallback(t,e,n){return r=>{Au.getEventFullKey(r)===t&&n.runGuarded(()=>e(r))}}static _normalizeKey(t){switch(t){case"esc":return"escape";default:return t}}}class Du{}class Nu extends Du{constructor(t){super(),this._doc=t}sanitize(t,e){if(null==e)return null;switch(t){case ye.NONE:return e;case ye.HTML:return e instanceof Ou?e.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(e,"HTML"),function(t,e){let n=null;try{me=me||new Xt(t);let r=e?String(e):"";n=me.getInertBodyElement(r);let i=5,s=r;do{if(0===i)throw new Error("Failed to sanitize html because the input is unstable");i--,r=s,s=n.innerHTML,n=me.getInertBodyElement(r)}while(r!==s);const o=new he,a=o.sanitizeChildren(ge(n)||n);return Kt()&&o.sanitizedSomething&&console.warn("WARNING: sanitizing HTML stripped some content, see http://g.co/ng/security#xss"),a}finally{if(n){const t=ge(n)||n;for(;t.firstChild;)t.removeChild(t.firstChild)}}}(this._doc,String(e)));case ye.STYLE:return e instanceof Iu?e.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(e,"Style"),function(t){if(!(t=String(t).trim()))return"";const e=t.match(xe);return e&&Jt(e[1])===e[1]||t.match(be)&&function(t){let e=!0,n=!0;for(let r=0;r<t.length;r++){const i=t.charAt(r);"'"===i&&n?e=!e:'"'===i&&e&&(n=!n)}return e&&n}(t)?t:(Kt()&&console.warn(`WARNING: sanitizing unsafe style value ${t} (see http://g.co/ng/security#xss).`),"unsafe")}(e));case ye.SCRIPT:if(e instanceof Ru)return e.changingThisBreaksApplicationSecurity;throw this.checkNotSafeValue(e,"Script"),new Error("unsafe value used in a script context");case ye.URL:return e instanceof Mu||e instanceof Fu?e.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(e,"URL"),Jt(String(e)));case ye.RESOURCE_URL:if(e instanceof Mu)return e.changingThisBreaksApplicationSecurity;throw this.checkNotSafeValue(e,"ResourceURL"),new Error("unsafe value used in a resource URL context (see http://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${t} (see http://g.co/ng/security#xss)`)}}checkNotSafeValue(t,e){if(t instanceof Tu)throw new Error(`Required a safe ${e}, got a ${t.getTypeName()} (see http://g.co/ng/security#xss)`)}bypassSecurityTrustHtml(t){return new Ou(t)}bypassSecurityTrustStyle(t){return new Iu(t)}bypassSecurityTrustScript(t){return new Ru(t)}bypassSecurityTrustUrl(t){return new Fu(t)}bypassSecurityTrustResourceUrl(t){return new Mu(t)}}class Tu{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return"SafeValue must use [property]=binding: "+this.changingThisBreaksApplicationSecurity+" (see http://g.co/ng/security#xss)"}}class Ou extends Tu{getTypeName(){return"HTML"}}class Iu extends Tu{getTypeName(){return"Style"}}class Ru extends Tu{getTypeName(){return"Script"}}class Fu extends Tu{getTypeName(){return"URL"}}class Mu extends Tu{getTypeName(){return"ResourceURL"}}const $u=as(Cs,"browser",[{provide:Ai,useValue:"browser"},{provide:ki,useValue:function(){jl.makeCurrent(),Gl.init()},multi:!0},{provide:na,useClass:class extends na{constructor(t){super(),this._doc=t,this._init()}_init(){this.location=$l().getLocation(),this._history=$l().getHistory()}getBaseHrefFromDOM(){return $l().getBaseHref(this._doc)}onPopState(t){$l().getGlobalEventTarget(this._doc,"window").addEventListener("popstate",t,!1)}onHashChange(t){$l().getGlobalEventTarget(this._doc,"window").addEventListener("hashchange",t,!1)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(t){this.location.pathname=t}pushState(t,e,n){Wl()?this._history.pushState(t,e,n):this.location.hash=n}replaceState(t,e,n){Wl()?this._history.replaceState(t,e,n):this.location.hash=n}forward(){this._history.forward()}back(){this._history.back()}getState(){return this._history.state}},deps:[Ra]},{provide:Ra,useFactory:function(){return document},deps:[]}]);function Pu(){return new Ht}class zu{constructor(t){if(t)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(t){return{ngModule:zu,providers:[{provide:Si,useValue:t.appId},{provide:ql,useExisting:Si},Hl]}}}"undefined"!=typeof window&&window;class Lu{constructor(t,e){this.id=t,this.url=e}}class Bu extends Lu{constructor(t,e,n="imperative",r=null){super(t,e),this.navigationTrigger=n,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class ju extends Lu{constructor(t,e,n){super(t,e),this.urlAfterRedirects=n}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Uu extends Lu{constructor(t,e,n){super(t,e),this.reason=n}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Vu extends Lu{constructor(t,e,n){super(t,e),this.error=n}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class Wu extends Lu{constructor(t,e,n,r){super(t,e),this.urlAfterRedirects=n,this.state=r}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class qu extends Lu{constructor(t,e,n,r){super(t,e),this.urlAfterRedirects=n,this.state=r}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Hu extends Lu{constructor(t,e,n,r,i){super(t,e),this.urlAfterRedirects=n,this.state=r,this.shouldActivate=i}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class Gu extends Lu{constructor(t,e,n,r){super(t,e),this.urlAfterRedirects=n,this.state=r}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Yu extends Lu{constructor(t,e,n,r){super(t,e),this.urlAfterRedirects=n,this.state=r}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Ku{constructor(t){this.route=t}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Xu{constructor(t){this.route=t}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Zu{constructor(t){this.snapshot=t}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Qu{constructor(t){this.snapshot=t}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Ju{constructor(t){this.snapshot=t}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class tc{constructor(t){this.snapshot=t}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ec{constructor(t,e,n){this.routerEvent=t,this.position=e,this.anchor=n}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class nc{}class rc{constructor(t){this.params=t||{}}has(t){return this.params.hasOwnProperty(t)}get(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e[0]:e}return null}getAll(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}}function ic(t){return new rc(t)}function sc(t){const e=Error("NavigationCancelingError: "+t);return e.ngNavigationCancelingError=!0,e}function oc(t,e,n){const r=n.path.split("/");if(r.length>t.length)return null;if("full"===n.pathMatch&&(e.hasChildren()||r.length<t.length))return null;const i={};for(let s=0;s<r.length;s++){const e=r[s],n=t[s];if(e.startsWith(":"))i[e.substring(1)]=n;else if(e!==n.path)return null}return{consumed:t.slice(0,r.length),posParams:i}}class ac{constructor(t,e){this.routes=t,this.module=e}}function lc(t,e=""){for(let n=0;n<t.length;n++){const r=t[n];uc(r,cc(e,r))}}function uc(t,e){if(!t)throw new Error(`\n      Invalid configuration of route '${e}': Encountered undefined route.\n      The reason might be an extra comma.\n\n      Example:\n      const routes: Routes = [\n        { path: '', redirectTo: '/dashboard', pathMatch: 'full' },\n        { path: 'dashboard',  component: DashboardComponent },, << two commas\n        { path: 'detail/:id', component: HeroDetailComponent }\n      ];\n    `);if(Array.isArray(t))throw new Error(`Invalid configuration of route '${e}': Array cannot be specified`);if(!t.component&&!t.children&&!t.loadChildren&&t.outlet&&"primary"!==t.outlet)throw new Error(`Invalid configuration of route '${e}': a componentless route without children or loadChildren cannot have a named outlet set`);if(t.redirectTo&&t.children)throw new Error(`Invalid configuration of route '${e}': redirectTo and children cannot be used together`);if(t.redirectTo&&t.loadChildren)throw new Error(`Invalid configuration of route '${e}': redirectTo and loadChildren cannot be used together`);if(t.children&&t.loadChildren)throw new Error(`Invalid configuration of route '${e}': children and loadChildren cannot be used together`);if(t.redirectTo&&t.component)throw new Error(`Invalid configuration of route '${e}': redirectTo and component cannot be used together`);if(t.path&&t.matcher)throw new Error(`Invalid configuration of route '${e}': path and matcher cannot be used together`);if(void 0===t.redirectTo&&!t.component&&!t.children&&!t.loadChildren)throw new Error(`Invalid configuration of route '${e}'. One of the following must be provided: component, redirectTo, children or loadChildren`);if(void 0===t.path&&void 0===t.matcher)throw new Error(`Invalid configuration of route '${e}': routes must have either a path or a matcher specified`);if("string"==typeof t.path&&"/"===t.path.charAt(0))throw new Error(`Invalid configuration of route '${e}': path cannot start with a slash`);if(""===t.path&&void 0!==t.redirectTo&&void 0===t.pathMatch)throw new Error(`Invalid configuration of route '{path: "${e}", redirectTo: "${t.redirectTo}"}': please provide 'pathMatch'. The default value of 'pathMatch' is 'prefix', but often the intent is to use 'full'.`);if(void 0!==t.pathMatch&&"full"!==t.pathMatch&&"prefix"!==t.pathMatch)throw new Error(`Invalid configuration of route '${e}': pathMatch can only be set to 'prefix' or 'full'`);t.children&&lc(t.children,e)}function cc(t,e){return e?t||e.path?t&&!e.path?t+"/":!t&&e.path?e.path:`${t}/${e.path}`:"":t}function hc(t){const e=t.children&&t.children.map(hc),n=e?Object.assign({},t,{children:e}):Object.assign({},t);return!n.component&&(e||n.loadChildren)&&n.outlet&&"primary"!==n.outlet&&(n.component=nc),n}function dc(t,e){const n=Object.keys(t),r=Object.keys(e);if(!n||!r||n.length!=r.length)return!1;let i;for(let s=0;s<n.length;s++)if(i=n[s],t[i]!==e[i])return!1;return!0}function fc(t){return Array.prototype.concat.apply([],t)}function pc(t){return t.length>0?t[t.length-1]:null}function mc(t,e){for(const n in t)t.hasOwnProperty(n)&&e(t[n],n)}function gc(t){return We(t)?t:Ve(t)?H(Promise.resolve(t)):ja(t)}function yc(t,e,n){return n?function(t,e){return dc(t,e)}(t.queryParams,e.queryParams)&&function t(e,n){if(!_c(e.segments,n.segments))return!1;if(e.numberOfChildren!==n.numberOfChildren)return!1;for(const r in n.children){if(!e.children[r])return!1;if(!t(e.children[r],n.children[r]))return!1}return!0}(t.root,e.root):function(t,e){return Object.keys(e).length<=Object.keys(t).length&&Object.keys(e).every(n=>e[n]===t[n])}(t.queryParams,e.queryParams)&&function t(e,n){return function e(n,r,i){if(n.segments.length>i.length)return!!_c(n.segments.slice(0,i.length),i)&&!r.hasChildren();if(n.segments.length===i.length){if(!_c(n.segments,i))return!1;for(const e in r.children){if(!n.children[e])return!1;if(!t(n.children[e],r.children[e]))return!1}return!0}{const t=i.slice(0,n.segments.length),s=i.slice(n.segments.length);return!!_c(n.segments,t)&&!!n.children.primary&&e(n.children.primary,r,s)}}(e,n,n.segments)}(t.root,e.root)}class vc{constructor(t,e,n){this.root=t,this.queryParams=e,this.fragment=n}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=ic(this.queryParams)),this._queryParamMap}toString(){return Ec.serialize(this)}}class bc{constructor(t,e){this.segments=t,this.children=e,this.parent=null,mc(e,(t,e)=>t.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return kc(this)}}class xc{constructor(t,e){this.path=t,this.parameters=e}get parameterMap(){return this._parameterMap||(this._parameterMap=ic(this.parameters)),this._parameterMap}toString(){return Ic(this)}}function _c(t,e){return t.length===e.length&&t.every((t,n)=>t.path===e[n].path)}function wc(t,e){let n=[];return mc(t.children,(t,r)=>{"primary"===r&&(n=n.concat(e(t,r)))}),mc(t.children,(t,r)=>{"primary"!==r&&(n=n.concat(e(t,r)))}),n}class Sc{}class Cc{parse(t){const e=new Pc(t);return new vc(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(t){return`${"/"+function t(e,n){if(!e.hasChildren())return kc(e);if(n){const n=e.children.primary?t(e.children.primary,!1):"",r=[];return mc(e.children,(e,n)=>{"primary"!==n&&r.push(`${n}:${t(e,!1)}`)}),r.length>0?`${n}(${r.join("//")})`:n}{const n=wc(e,(n,r)=>"primary"===r?[t(e.children.primary,!1)]:[`${r}:${t(n,!1)}`]);return`${kc(e)}/(${n.join("//")})`}}(t.root,!0)}${function(t){const e=Object.keys(t).map(e=>{const n=t[e];return Array.isArray(n)?n.map(t=>`${Dc(e)}=${Dc(t)}`).join("&"):`${Dc(e)}=${Dc(n)}`});return e.length?"?"+e.join("&"):""}(t.queryParams)}${"string"==typeof t.fragment?"#"+encodeURI(t.fragment):""}`}}const Ec=new Cc;function kc(t){return t.segments.map(t=>Ic(t)).join("/")}function Ac(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Dc(t){return Ac(t).replace(/%3B/gi,";")}function Nc(t){return Ac(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Tc(t){return decodeURIComponent(t)}function Oc(t){return Tc(t.replace(/\+/g,"%20"))}function Ic(t){return`${Nc(t.path)}${e=t.parameters,Object.keys(e).map(t=>`;${Nc(t)}=${Nc(e[t])}`).join("")}`;var e}const Rc=/^[^\/()?;=#]+/;function Fc(t){const e=t.match(Rc);return e?e[0]:""}const Mc=/^[^=?&#]+/,$c=/^[^?&#]+/;class Pc{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new bc([],{}):new bc([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(n.primary=new bc(t,e)),n}parseSegment(){const t=Fc(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(t),new xc(Tc(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const e=Fc(this.remaining);if(!e)return;this.capture(e);let n="";if(this.consumeOptional("=")){const t=Fc(this.remaining);t&&(n=t,this.capture(n))}t[Tc(e)]=Tc(n)}parseQueryParam(t){const e=function(t){const e=t.match(Mc);return e?e[0]:""}(this.remaining);if(!e)return;this.capture(e);let n="";if(this.consumeOptional("=")){const t=function(t){const e=t.match($c);return e?e[0]:""}(this.remaining);t&&(n=t,this.capture(n))}const r=Oc(e),i=Oc(n);if(t.hasOwnProperty(r)){let e=t[r];Array.isArray(e)||(e=[e],t[r]=e),e.push(i)}else t[r]=i}parseParens(t){const e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const n=Fc(this.remaining),r=this.remaining[n.length];if("/"!==r&&")"!==r&&";"!==r)throw new Error(`Cannot parse url '${this.url}'`);let i=void 0;n.indexOf(":")>-1?(i=n.substr(0,n.indexOf(":")),this.capture(i),this.capture(":")):t&&(i="primary");const s=this.parseChildren();e[i]=1===Object.keys(s).length?s.primary:new bc([],s),this.consumeOptional("//")}return e}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new Error(`Expected "${t}".`)}}class zc{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null}children(t){const e=Lc(t,this._root);return e?e.children.map(t=>t.value):[]}firstChild(t){const e=Lc(t,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(t){const e=Bc(t,this._root);return e.length<2?[]:e[e.length-2].children.map(t=>t.value).filter(e=>e!==t)}pathFromRoot(t){return Bc(t,this._root).map(t=>t.value)}}function Lc(t,e){if(t===e.value)return e;for(const n of e.children){const e=Lc(t,n);if(e)return e}return null}function Bc(t,e){if(t===e.value)return[e];for(const n of e.children){const r=Bc(t,n);if(r.length)return r.unshift(e),r}return[]}class jc{constructor(t,e){this.value=t,this.children=e}toString(){return`TreeNode(${this.value})`}}function Uc(t){const e={};return t&&t.children.forEach(t=>e[t.value.outlet]=t),e}class Vc extends zc{constructor(t,e){super(t),this.snapshot=e,Kc(this,t)}toString(){return this.snapshot.toString()}}function Wc(t,e){const n=function(t,e){const n=new Gc([],{},{},"",{},"primary",e,null,t.root,-1,{});return new Yc("",new jc(n,[]))}(t,e),r=new Ua([new xc("",{})]),i=new Ua({}),s=new Ua({}),o=new Ua({}),a=new Ua(""),l=new qc(r,i,o,a,s,"primary",e,n.root);return l.snapshot=n.root,new Vc(new jc(l,[]),n)}class qc{constructor(t,e,n,r,i,s,o,a){this.url=t,this.params=e,this.queryParams=n,this.fragment=r,this.data=i,this.outlet=s,this.component=o,this._futureSnapshot=a}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(U(t=>ic(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(U(t=>ic(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function Hc(t,e="emptyOnly"){const n=t.pathFromRoot;let r=0;if("always"!==e)for(r=n.length-1;r>=1;){const t=n[r],e=n[r-1];if(t.routeConfig&&""===t.routeConfig.path)r--;else{if(e.component)break;r--}}return function(t){return t.reduce((t,e)=>({params:Object.assign({},t.params,e.params),data:Object.assign({},t.data,e.data),resolve:Object.assign({},t.resolve,e._resolvedData)}),{params:{},data:{},resolve:{}})}(n.slice(r))}class Gc{constructor(t,e,n,r,i,s,o,a,l,u,c){this.url=t,this.params=e,this.queryParams=n,this.fragment=r,this.data=i,this.outlet=s,this.component=o,this.routeConfig=a,this._urlSegment=l,this._lastPathIndex=u,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=ic(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=ic(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(t=>t.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class Yc extends zc{constructor(t,e){super(e),this.url=t,Kc(this,e)}toString(){return Xc(this._root)}}function Kc(t,e){e.value._routerState=t,e.children.forEach(e=>Kc(t,e))}function Xc(t){const e=t.children.length>0?` { ${t.children.map(Xc).join(", ")} } `:"";return`${t.value}${e}`}function Zc(t){if(t.snapshot){const e=t.snapshot,n=t._futureSnapshot;t.snapshot=n,dc(e.queryParams,n.queryParams)||t.queryParams.next(n.queryParams),e.fragment!==n.fragment&&t.fragment.next(n.fragment),dc(e.params,n.params)||t.params.next(n.params),function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!dc(t[n],e[n]))return!1;return!0}(e.url,n.url)||t.url.next(n.url),dc(e.data,n.data)||t.data.next(n.data)}else t.snapshot=t._futureSnapshot,t.data.next(t._futureSnapshot.data)}function Qc(t,e){var n,r;return dc(t.params,e.params)&&_c(n=t.url,r=e.url)&&n.every((t,e)=>dc(t.parameters,r[e].parameters))&&!(!t.parent!=!e.parent)&&(!t.parent||Qc(t.parent,e.parent))}function Jc(t){return"object"==typeof t&&null!=t&&!t.outlets&&!t.segmentPath}function th(t,e,n,r,i){let s={};return r&&mc(r,(t,e)=>{s[e]=Array.isArray(t)?t.map(t=>""+t):""+t}),new vc(n.root===t?e:function t(e,n,r){const i={};return mc(e.children,(e,s)=>{i[s]=e===n?r:t(e,n,r)}),new bc(e.segments,i)}(n.root,t,e),s,i)}class eh{constructor(t,e,n){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=n,t&&n.length>0&&Jc(n[0]))throw new Error("Root segment cannot have matrix parameters");const r=n.find(t=>"object"==typeof t&&null!=t&&t.outlets);if(r&&r!==pc(n))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class nh{constructor(t,e,n){this.segmentGroup=t,this.processChildren=e,this.index=n}}function rh(t){return"object"==typeof t&&null!=t&&t.outlets?t.outlets.primary:""+t}function ih(t,e,n){if(t||(t=new bc([],{})),0===t.segments.length&&t.hasChildren())return sh(t,e,n);const r=function(t,e,n){let r=0,i=e;const s={match:!1,pathIndex:0,commandIndex:0};for(;i<t.segments.length;){if(r>=n.length)return s;const e=t.segments[i],o=rh(n[r]),a=r<n.length-1?n[r+1]:null;if(i>0&&void 0===o)break;if(o&&a&&"object"==typeof a&&void 0===a.outlets){if(!uh(o,a,e))return s;r+=2}else{if(!uh(o,{},e))return s;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}(t,e,n),i=n.slice(r.commandIndex);if(r.match&&r.pathIndex<t.segments.length){const e=new bc(t.segments.slice(0,r.pathIndex),{});return e.children.primary=new bc(t.segments.slice(r.pathIndex),t.children),sh(e,0,i)}return r.match&&0===i.length?new bc(t.segments,{}):r.match&&!t.hasChildren()?oh(t,e,n):r.match?sh(t,0,i):oh(t,e,n)}function sh(t,e,n){if(0===n.length)return new bc(t.segments,{});{const r=function(t){return"object"!=typeof t[0]||void 0===t[0].outlets?{primary:t}:t[0].outlets}(n),i={};return mc(r,(n,r)=>{null!==n&&(i[r]=ih(t.children[r],e,n))}),mc(t.children,(t,e)=>{void 0===r[e]&&(i[e]=t)}),new bc(t.segments,i)}}function oh(t,e,n){const r=t.segments.slice(0,e);let i=0;for(;i<n.length;){if("object"==typeof n[i]&&void 0!==n[i].outlets){const t=ah(n[i].outlets);return new bc(r,t)}if(0===i&&Jc(n[0])){r.push(new xc(t.segments[e].path,n[0])),i++;continue}const s=rh(n[i]),o=i<n.length-1?n[i+1]:null;s&&o&&Jc(o)?(r.push(new xc(s,lh(o))),i+=2):(r.push(new xc(s,{})),i++)}return new bc(r,{})}function ah(t){const e={};return mc(t,(t,n)=>{null!==t&&(e[n]=oh(new bc([],{}),0,t))}),e}function lh(t){const e={};return mc(t,(t,n)=>e[n]=""+t),e}function uh(t,e,n){return t==n.path&&dc(e,n.parameters)}class ch{constructor(t,e,n,r){this.routeReuseStrategy=t,this.futureState=e,this.currState=n,this.forwardEvent=r}activate(t){const e=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,n,t),Zc(this.futureState.root),this.activateChildRoutes(e,n,t)}deactivateChildRoutes(t,e,n){const r=Uc(e);t.children.forEach(t=>{const e=t.value.outlet;this.deactivateRoutes(t,r[e],n),delete r[e]}),mc(r,(t,e)=>{this.deactivateRouteAndItsChildren(t,n)})}deactivateRoutes(t,e,n){const r=t.value,i=e?e.value:null;if(r===i)if(r.component){const i=n.getContext(r.outlet);i&&this.deactivateChildRoutes(t,e,i.children)}else this.deactivateChildRoutes(t,e,n);else i&&this.deactivateRouteAndItsChildren(e,n)}deactivateRouteAndItsChildren(t,e){this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,e):this.deactivateRouteAndOutlet(t,e)}detachAndStoreRouteSubtree(t,e){const n=e.getContext(t.value.outlet);if(n&&n.outlet){const e=n.outlet.detach(),r=n.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:e,route:t,contexts:r})}}deactivateRouteAndOutlet(t,e){const n=e.getContext(t.value.outlet);if(n){const r=Uc(t),i=t.value.component?n.children:e;mc(r,(t,e)=>this.deactivateRouteAndItsChildren(t,i)),n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated())}}activateChildRoutes(t,e,n){const r=Uc(e);t.children.forEach(t=>{this.activateRoutes(t,r[t.value.outlet],n),this.forwardEvent(new tc(t.value.snapshot))}),t.children.length&&this.forwardEvent(new Qu(t.value.snapshot))}activateRoutes(t,e,n){const r=t.value,i=e?e.value:null;if(Zc(r),r===i)if(r.component){const i=n.getOrCreateContext(r.outlet);this.activateChildRoutes(t,e,i.children)}else this.activateChildRoutes(t,e,n);else if(r.component){const e=n.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){const t=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),e.children.onOutletReAttached(t.contexts),e.attachRef=t.componentRef,e.route=t.route.value,e.outlet&&e.outlet.attach(t.componentRef,t.route.value),hh(t.route)}else{const n=function(t){for(let e=t.parent;e;e=e.parent){const t=e.routeConfig;if(t&&t._loadedConfig)return t._loadedConfig;if(t&&t.component)return null}return null}(r.snapshot),i=n?n.module.componentFactoryResolver:null;e.attachRef=null,e.route=r,e.resolver=i,e.outlet&&e.outlet.activateWith(r,i),this.activateChildRoutes(t,null,e.children)}}else this.activateChildRoutes(t,null,n)}}function hh(t){Zc(t.value),t.children.forEach(hh)}function dh(t){return"function"==typeof t}function fh(t){return t instanceof vc}class ph{constructor(t){this.segmentGroup=t||null}}class mh{constructor(t){this.urlTree=t}}function gh(t){return new _(e=>e.error(new ph(t)))}function yh(t){return new _(e=>e.error(new mh(t)))}function vh(t){return new _(e=>e.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${t}'`)))}class bh{constructor(t,e,n,r,i){this.configLoader=e,this.urlSerializer=n,this.urlTree=r,this.config=i,this.allowRedirects=!0,this.ngModule=t.get(Pt)}apply(){return this.expandSegmentGroup(this.ngModule,this.config,this.urlTree.root,"primary").pipe(U(t=>this.createUrlTree(t,this.urlTree.queryParams,this.urlTree.fragment))).pipe(pl(t=>{if(t instanceof mh)return this.allowRedirects=!1,this.match(t.urlTree);if(t instanceof ph)throw this.noMatchError(t);throw t}))}match(t){return this.expandSegmentGroup(this.ngModule,this.config,t.root,"primary").pipe(U(e=>this.createUrlTree(e,t.queryParams,t.fragment))).pipe(pl(t=>{if(t instanceof ph)throw this.noMatchError(t);throw t}))}noMatchError(t){return new Error(`Cannot match any routes. URL Segment: '${t.segmentGroup}'`)}createUrlTree(t,e,n){const r=t.segments.length>0?new bc([],{primary:t}):t;return new vc(r,e,n)}expandSegmentGroup(t,e,n,r){return 0===n.segments.length&&n.hasChildren()?this.expandChildren(t,e,n).pipe(U(t=>new bc([],t))):this.expandSegment(t,n,e,n.segments,r,!0)}expandChildren(t,e,n){return function(t,e){if(0===Object.keys(t).length)return ja({});const n=[],r=[],i={};return mc(t,(t,s)=>{const o=e(s,t).pipe(U(t=>i[s]=t));"primary"===s?n.push(o):r.push(o)}),ja.apply(null,n.concat(r)).pipe(Xa(),fl(),U(()=>i))}(n.children,(n,r)=>this.expandSegmentGroup(t,e,r,n))}expandSegment(t,e,n,r,i,s){return ja(...n).pipe(U(o=>this.expandSegmentAgainstRoute(t,e,n,o,r,i,s).pipe(pl(t=>{if(t instanceof ph)return ja(null);throw t}))),Xa(),xl(t=>!!t),pl((t,n)=>{if(t instanceof Wa||"EmptyError"===t.name){if(this.noLeftoversInUrl(e,r,i))return ja(new bc([],{}));throw new ph(e)}throw t}))}noLeftoversInUrl(t,e,n){return 0===e.length&&!t.children[n]}expandSegmentAgainstRoute(t,e,n,r,i,s,o){return Sh(r)!==s?gh(e):void 0===r.redirectTo?this.matchSegmentAgainstRoute(t,e,r,i):o&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,e,n,r,i,s):gh(e)}expandSegmentAgainstRouteUsingRedirect(t,e,n,r,i,s){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,n,r,s):this.expandRegularSegmentAgainstRouteUsingRedirect(t,e,n,r,i,s)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,e,n,r){const i=this.applyRedirectCommands([],n.redirectTo,{});return n.redirectTo.startsWith("/")?yh(i):this.lineralizeSegments(n,i).pipe(G(n=>{const i=new bc(n,{});return this.expandSegment(t,i,e,n,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,e,n,r,i,s){const{matched:o,consumedSegments:a,lastChild:l,positionalParamSegments:u}=xh(e,r,i);if(!o)return gh(e);const c=this.applyRedirectCommands(a,r.redirectTo,u);return r.redirectTo.startsWith("/")?yh(c):this.lineralizeSegments(r,c).pipe(G(r=>this.expandSegment(t,e,n,r.concat(i.slice(l)),s,!1)))}matchSegmentAgainstRoute(t,e,n,r){if("**"===n.path)return n.loadChildren?this.configLoader.load(t.injector,n).pipe(U(t=>(n._loadedConfig=t,new bc(r,{})))):ja(new bc(r,{}));const{matched:i,consumedSegments:s,lastChild:o}=xh(e,n,r);if(!i)return gh(e);const a=r.slice(o);return this.getChildConfig(t,n,r).pipe(G(t=>{const n=t.module,r=t.routes,{segmentGroup:i,slicedSegments:o}=function(t,e,n,r){return n.length>0&&function(t,e,n){return n.some(n=>wh(t,e,n)&&"primary"!==Sh(n))}(t,n,r)?{segmentGroup:_h(new bc(e,function(t,e){const n={};n.primary=e;for(const r of t)""===r.path&&"primary"!==Sh(r)&&(n[Sh(r)]=new bc([],{}));return n}(r,new bc(n,t.children)))),slicedSegments:[]}:0===n.length&&function(t,e,n){return n.some(n=>wh(t,e,n))}(t,n,r)?{segmentGroup:_h(new bc(t.segments,function(t,e,n,r){const i={};for(const s of n)wh(t,e,s)&&!r[Sh(s)]&&(i[Sh(s)]=new bc([],{}));return Object.assign({},r,i)}(t,n,r,t.children))),slicedSegments:n}:{segmentGroup:t,slicedSegments:n}}(e,s,a,r);return 0===o.length&&i.hasChildren()?this.expandChildren(n,r,i).pipe(U(t=>new bc(s,t))):0===r.length&&0===o.length?ja(new bc(s,{})):this.expandSegment(n,i,r,o,"primary",!0).pipe(U(t=>new bc(s.concat(t.segments),t.children)))}))}getChildConfig(t,e,n){return e.children?ja(new ac(e.children,t)):e.loadChildren?void 0!==e._loadedConfig?ja(e._loadedConfig):function(t,e,n){const r=e.canLoad;return r&&0!==r.length?H(r).pipe(U(r=>{const i=t.get(r);let s;if(function(t){return t&&dh(t.canLoad)}(i))s=i.canLoad(e,n);else{if(!dh(i))throw new Error("Invalid CanLoad guard");s=i(e,n)}return gc(s)})).pipe(Xa(),(i=t=>!0===t,t=>t.lift(new _l(i,void 0,t)))):ja(!0);var i}(t.injector,e,n).pipe(G(n=>n?this.configLoader.load(t.injector,e).pipe(U(t=>(e._loadedConfig=t,t))):function(t){return new _(e=>e.error(sc(`Cannot load children because the guard of the route "path: '${t.path}'" returned false`)))}(e))):ja(new ac([],t))}lineralizeSegments(t,e){let n=[],r=e.root;for(;;){if(n=n.concat(r.segments),0===r.numberOfChildren)return ja(n);if(r.numberOfChildren>1||!r.children.primary)return vh(t.redirectTo);r=r.children.primary}}applyRedirectCommands(t,e,n){return this.applyRedirectCreatreUrlTree(e,this.urlSerializer.parse(e),t,n)}applyRedirectCreatreUrlTree(t,e,n,r){const i=this.createSegmentGroup(t,e.root,n,r);return new vc(i,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(t,e){const n={};return mc(t,(t,r)=>{if("string"==typeof t&&t.startsWith(":")){const i=t.substring(1);n[r]=e[i]}else n[r]=t}),n}createSegmentGroup(t,e,n,r){const i=this.createSegments(t,e.segments,n,r);let s={};return mc(e.children,(e,i)=>{s[i]=this.createSegmentGroup(t,e,n,r)}),new bc(i,s)}createSegments(t,e,n,r){return e.map(e=>e.path.startsWith(":")?this.findPosParam(t,e,r):this.findOrReturn(e,n))}findPosParam(t,e,n){const r=n[e.path.substring(1)];if(!r)throw new Error(`Cannot redirect to '${t}'. Cannot find '${e.path}'.`);return r}findOrReturn(t,e){let n=0;for(const r of e){if(r.path===t.path)return e.splice(n),r;n++}return t}}function xh(t,e,n){if(""===e.path)return"full"===e.pathMatch&&(t.hasChildren()||n.length>0)?{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}:{matched:!0,consumedSegments:[],lastChild:0,positionalParamSegments:{}};const r=(e.matcher||oc)(n,t,e);return r?{matched:!0,consumedSegments:r.consumed,lastChild:r.consumed.length,positionalParamSegments:r.posParams}:{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}}function _h(t){if(1===t.numberOfChildren&&t.children.primary){const e=t.children.primary;return new bc(t.segments.concat(e.segments),e.children)}return t}function wh(t,e,n){return(!(t.hasChildren()||e.length>0)||"full"!==n.pathMatch)&&""===n.path&&void 0!==n.redirectTo}function Sh(t){return t.outlet||"primary"}class Ch{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class Eh{constructor(t,e){this.component=t,this.route=e}}function kh(t,e,n){const r=t._root;return function t(e,n,r,i,s={canDeactivateChecks:[],canActivateChecks:[]}){const o=Uc(n);return e.children.forEach(e=>{!function(e,n,r,i,s={canDeactivateChecks:[],canActivateChecks:[]}){const o=e.value,a=n?n.value:null,l=r?r.getContext(e.value.outlet):null;if(a&&o.routeConfig===a.routeConfig){const u=function(t,e,n){if("function"==typeof n)return n(t,e);switch(n){case"pathParamsChange":return!_c(t.url,e.url);case"pathParamsOrQueryParamsChange":return!_c(t.url,e.url)||!dc(t.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Qc(t,e)||!dc(t.queryParams,e.queryParams);case"paramsChange":default:return!Qc(t,e)}}(a,o,o.routeConfig.runGuardsAndResolvers);u?s.canActivateChecks.push(new Ch(i)):(o.data=a.data,o._resolvedData=a._resolvedData),t(e,n,o.component?l?l.children:null:r,i,s),u&&s.canDeactivateChecks.push(new Eh(l&&l.outlet&&l.outlet.component||null,a))}else a&&Dh(n,l,s),s.canActivateChecks.push(new Ch(i)),t(e,null,o.component?l?l.children:null:r,i,s)}(e,o[e.value.outlet],r,i.concat([e.value]),s),delete o[e.value.outlet]}),mc(o,(t,e)=>Dh(t,r.getContext(e),s)),s}(r,e?e._root:null,n,[r.value])}function Ah(t,e,n){const r=function(t){if(!t)return null;for(let e=t.parent;e;e=e.parent){const t=e.routeConfig;if(t&&t._loadedConfig)return t._loadedConfig}return null}(e);return(r?r.module.injector:n).get(t)}function Dh(t,e,n){const r=Uc(t),i=t.value;mc(r,(t,r)=>{Dh(t,i.component?e?e.children.getContext(r):null:e,n)}),n.canDeactivateChecks.push(new Eh(i.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,i))}const Nh=Symbol("INITIAL_VALUE");function Th(){return Sl(t=>Ha(...t.map(t=>t.pipe(yl(1),Al(Nh)))).pipe(Dl((t,e)=>{let n=!1;return e.reduce((t,r,i)=>{if(t!==Nh)return t;if(r===Nh&&(n=!0),!n){if(!1===r)return r;if(i===e.length-1||fh(r))return r}return t},t)},Nh),Za(t=>t!==Nh),U(t=>fh(t)?t:!0===t),yl(1)))}function Oh(t,e){return null!==t&&e&&e(new Ju(t)),ja(!0)}function Ih(t,e){return null!==t&&e&&e(new Zu(t)),ja(!0)}function Rh(t,e,n){const r=e.routeConfig?e.routeConfig.canActivate:null;return r&&0!==r.length?ja(r.map(r=>Ka(()=>{const i=Ah(r,e,n);let s;if(function(t){return t&&dh(t.canActivate)}(i))s=gc(i.canActivate(e,t));else{if(!dh(i))throw new Error("Invalid CanActivate guard");s=gc(i(e,t))}return s.pipe(xl())}))).pipe(Th()):ja(!0)}function Fh(t,e,n){const r=e[e.length-1],i=e.slice(0,e.length-1).reverse().map(t=>function(t){const e=t.routeConfig?t.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:t,guards:e}:null}(t)).filter(t=>null!==t).map(e=>Ka(()=>ja(e.guards.map(i=>{const s=Ah(i,e.node,n);let o;if(function(t){return t&&dh(t.canActivateChild)}(s))o=gc(s.canActivateChild(r,t));else{if(!dh(s))throw new Error("Invalid CanActivateChild guard");o=gc(s(r,t))}return o.pipe(xl())})).pipe(Th())));return ja(i).pipe(Th())}class Mh{}class $h{constructor(t,e,n,r,i,s){this.rootComponentType=t,this.config=e,this.urlTree=n,this.url=r,this.paramsInheritanceStrategy=i,this.relativeLinkResolution=s}recognize(){try{const t=Lh(this.urlTree.root,[],[],this.config,this.relativeLinkResolution).segmentGroup,e=this.processSegmentGroup(this.config,t,"primary"),n=new Gc([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},"primary",this.rootComponentType,null,this.urlTree.root,-1,{}),r=new jc(n,e),i=new Yc(this.url,r);return this.inheritParamsAndData(i._root),ja(i)}catch(t){return new _(e=>e.error(t))}}inheritParamsAndData(t){const e=t.value,n=Hc(e,this.paramsInheritanceStrategy);e.params=Object.freeze(n.params),e.data=Object.freeze(n.data),t.children.forEach(t=>this.inheritParamsAndData(t))}processSegmentGroup(t,e,n){return 0===e.segments.length&&e.hasChildren()?this.processChildren(t,e):this.processSegment(t,e,e.segments,n)}processChildren(t,e){const n=wc(e,(e,n)=>this.processSegmentGroup(t,e,n));return function(t){const e={};t.forEach(t=>{const n=e[t.value.outlet];if(n){const e=n.url.map(t=>t.toString()).join("/"),r=t.value.url.map(t=>t.toString()).join("/");throw new Error(`Two segments cannot have the same outlet name: '${e}' and '${r}'.`)}e[t.value.outlet]=t.value})}(n),n.sort((t,e)=>"primary"===t.value.outlet?-1:"primary"===e.value.outlet?1:t.value.outlet.localeCompare(e.value.outlet)),n}processSegment(t,e,n,r){for(const s of t)try{return this.processSegmentAgainstRoute(s,e,n,r)}catch(i){if(!(i instanceof Mh))throw i}if(this.noLeftoversInUrl(e,n,r))return[];throw new Mh}noLeftoversInUrl(t,e,n){return 0===e.length&&!t.children[n]}processSegmentAgainstRoute(t,e,n,r){if(t.redirectTo)throw new Mh;if((t.outlet||"primary")!==r)throw new Mh;let i,s=[],o=[];if("**"===t.path){const s=n.length>0?pc(n).parameters:{};i=new Gc(n,s,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,Uh(t),r,t.component,t,Ph(e),zh(e)+n.length,Vh(t))}else{const a=function(t,e,n){if(""===e.path){if("full"===e.pathMatch&&(t.hasChildren()||n.length>0))throw new Mh;return{consumedSegments:[],lastChild:0,parameters:{}}}const r=(e.matcher||oc)(n,t,e);if(!r)throw new Mh;const i={};mc(r.posParams,(t,e)=>{i[e]=t.path});const s=r.consumed.length>0?Object.assign({},i,r.consumed[r.consumed.length-1].parameters):i;return{consumedSegments:r.consumed,lastChild:r.consumed.length,parameters:s}}(e,t,n);s=a.consumedSegments,o=n.slice(a.lastChild),i=new Gc(s,a.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,Uh(t),r,t.component,t,Ph(e),zh(e)+s.length,Vh(t))}const a=function(t){return t.children?t.children:t.loadChildren?t._loadedConfig.routes:[]}(t),{segmentGroup:l,slicedSegments:u}=Lh(e,s,o,a,this.relativeLinkResolution);if(0===u.length&&l.hasChildren()){const t=this.processChildren(a,l);return[new jc(i,t)]}if(0===a.length&&0===u.length)return[new jc(i,[])];const c=this.processSegment(a,l,u,"primary");return[new jc(i,c)]}}function Ph(t){let e=t;for(;e._sourceSegment;)e=e._sourceSegment;return e}function zh(t){let e=t,n=e._segmentIndexShift?e._segmentIndexShift:0;for(;e._sourceSegment;)e=e._sourceSegment,n+=e._segmentIndexShift?e._segmentIndexShift:0;return n-1}function Lh(t,e,n,r,i){if(n.length>0&&function(t,e,n){return n.some(n=>Bh(t,e,n)&&"primary"!==jh(n))}(t,n,r)){const i=new bc(e,function(t,e,n,r){const i={};i.primary=r,r._sourceSegment=t,r._segmentIndexShift=e.length;for(const s of n)if(""===s.path&&"primary"!==jh(s)){const n=new bc([],{});n._sourceSegment=t,n._segmentIndexShift=e.length,i[jh(s)]=n}return i}(t,e,r,new bc(n,t.children)));return i._sourceSegment=t,i._segmentIndexShift=e.length,{segmentGroup:i,slicedSegments:[]}}if(0===n.length&&function(t,e,n){return n.some(n=>Bh(t,e,n))}(t,n,r)){const s=new bc(t.segments,function(t,e,n,r,i,s){const o={};for(const a of r)if(Bh(t,n,a)&&!i[jh(a)]){const n=new bc([],{});n._sourceSegment=t,n._segmentIndexShift="legacy"===s?t.segments.length:e.length,o[jh(a)]=n}return Object.assign({},i,o)}(t,e,n,r,t.children,i));return s._sourceSegment=t,s._segmentIndexShift=e.length,{segmentGroup:s,slicedSegments:n}}const s=new bc(t.segments,t.children);return s._sourceSegment=t,s._segmentIndexShift=e.length,{segmentGroup:s,slicedSegments:n}}function Bh(t,e,n){return(!(t.hasChildren()||e.length>0)||"full"!==n.pathMatch)&&""===n.path&&void 0===n.redirectTo}function jh(t){return t.outlet||"primary"}function Uh(t){return t.data||{}}function Vh(t){return t.resolve||{}}function Wh(t,e,n,r){const i=Ah(t,e,r);return gc(i.resolve?i.resolve(e,n):i(e,n))}function qh(t){return function(e){return e.pipe(Sl(e=>{const n=t(e);return n?H(n).pipe(U(()=>e)):H([e])}))}}class Hh{}class Gh{shouldDetach(t){return!1}store(t,e){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,e){return t.routeConfig===e.routeConfig}}const Yh=new kt("ROUTES");class Kh{constructor(t,e,n,r){this.loader=t,this.compiler=e,this.onLoadStartListener=n,this.onLoadEndListener=r}load(t,e){return this.onLoadStartListener&&this.onLoadStartListener(e),this.loadModuleFactory(e.loadChildren).pipe(U(n=>{this.onLoadEndListener&&this.onLoadEndListener(e);const r=n.create(t);return new ac(fc(r.injector.get(Yh)).map(hc),r)}))}loadModuleFactory(t){return"string"==typeof t?H(this.loader.load(t)):gc(t()).pipe(G(t=>t instanceof zt?ja(t):H(this.compiler.compileModuleAsync(t))))}}class Xh{}class Zh{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,e){return t}}function Qh(t){throw t}function Jh(t,e,n){return e.parse("/")}function td(t,e){return ja(null)}class ed{constructor(t,e,n,r,i,s,o,a){this.rootComponentType=t,this.urlSerializer=e,this.rootContexts=n,this.location=r,this.config=a,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.navigationId=0,this.isNgZoneEnabled=!1,this.events=new A,this.errorHandler=Qh,this.malformedUriErrorHandler=Jh,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:td,afterPreactivation:td},this.urlHandlingStrategy=new Zh,this.routeReuseStrategy=new Gh,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="legacy",this.ngModule=i.get(Pt),this.console=i.get(Ni);const l=i.get(Gi);this.isNgZoneEnabled=l instanceof Gi,this.resetConfig(a),this.currentUrlTree=new vc(new bc([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new Kh(s,o,t=>this.triggerEvent(new Ku(t)),t=>this.triggerEvent(new Xu(t))),this.routerState=Wc(this.currentUrlTree,this.rootComponentType),this.transitions=new Ua({id:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}setupNavigations(t){const e=this.events;return t.pipe(Za(t=>0!==t.id),U(t=>Object.assign({},t,{extractedUrl:this.urlHandlingStrategy.extract(t.rawUrl)})),Sl(t=>{let n=!1,r=!1;return ja(t).pipe(sl(t=>{this.currentNavigation={id:t.id,initialUrl:t.currentRawUrl,extractedUrl:t.extractedUrl,trigger:t.source,extras:t.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign({},this.lastSuccessfulNavigation,{previousNavigation:null}):null}}),Sl(t=>{const n=!this.navigated||t.extractedUrl.toString()!==this.browserUrlTree.toString();if(("reload"===this.onSameUrlNavigation||n)&&this.urlHandlingStrategy.shouldProcessUrl(t.rawUrl))return ja(t).pipe(Sl(t=>{const n=this.transitions.getValue();return e.next(new Bu(t.id,this.serializeUrl(t.extractedUrl),t.source,t.restoredState)),n!==this.transitions.getValue()?za:[t]}),Sl(t=>Promise.resolve(t)),(r=this.ngModule.injector,i=this.configLoader,s=this.urlSerializer,o=this.config,function(t){return t.pipe(Sl(t=>function(t,e,n,r,i){return new bh(t,e,n,r,i).apply()}(r,i,s,t.extractedUrl,o).pipe(U(e=>Object.assign({},t,{urlAfterRedirects:e})))))}),sl(t=>{this.currentNavigation=Object.assign({},this.currentNavigation,{finalUrl:t.urlAfterRedirects})}),function(t,e,n,r,i){return function(s){return s.pipe(G(s=>function(t,e,n,r,i="emptyOnly",s="legacy"){return new $h(t,e,n,r,i,s).recognize()}(t,e,s.urlAfterRedirects,n(s.urlAfterRedirects),r,i).pipe(U(t=>Object.assign({},s,{targetSnapshot:t})))))}}(this.rootComponentType,this.config,t=>this.serializeUrl(t),this.paramsInheritanceStrategy,this.relativeLinkResolution),sl(t=>{"eager"===this.urlUpdateStrategy&&(t.extras.skipLocationChange||this.setBrowserUrl(t.urlAfterRedirects,!!t.extras.replaceUrl,t.id,t.extras.state),this.browserUrlTree=t.urlAfterRedirects)}),sl(t=>{const n=new Wu(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(t.urlAfterRedirects),t.targetSnapshot);e.next(n)}));var r,i,s,o;if(n&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:n,extractedUrl:r,source:i,restoredState:s,extras:o}=t,a=new Bu(n,this.serializeUrl(r),i,s);e.next(a);const l=Wc(r,this.rootComponentType).snapshot;return ja(Object.assign({},t,{targetSnapshot:l,urlAfterRedirects:r,extras:Object.assign({},o,{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=t.rawUrl,this.browserUrlTree=t.urlAfterRedirects,t.resolve(null),za}),qh(t=>{const{targetSnapshot:e,id:n,extractedUrl:r,rawUrl:i,extras:{skipLocationChange:s,replaceUrl:o}}=t;return this.hooks.beforePreactivation(e,{navigationId:n,appliedUrlTree:r,rawUrlTree:i,skipLocationChange:!!s,replaceUrl:!!o})}),sl(t=>{const e=new qu(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(t.urlAfterRedirects),t.targetSnapshot);this.triggerEvent(e)}),U(t=>Object.assign({},t,{guards:kh(t.targetSnapshot,t.currentSnapshot,this.rootContexts)})),function(t,e){return function(n){return n.pipe(G(n=>{const{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:s,canDeactivateChecks:o}}=n;return 0===o.length&&0===s.length?ja(Object.assign({},n,{guardsResult:!0})):function(t,e,n,r){return H(t).pipe(G(t=>function(t,e,n,r,i){const s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;return s&&0!==s.length?ja(s.map(s=>{const o=Ah(s,e,i);let a;if(function(t){return t&&dh(t.canDeactivate)}(o))a=gc(o.canDeactivate(t,e,n,r));else{if(!dh(o))throw new Error("Invalid CanDeactivate guard");a=gc(o(t,e,n,r))}return a.pipe(xl())})).pipe(Th()):ja(!0)}(t.component,t.route,n,e,r)),xl(t=>!0!==t,!0))}(o,r,i,t).pipe(G(n=>n&&"boolean"==typeof n?function(t,e,n,r){return H(e).pipe(Ol(e=>H([Ih(e.route.parent,r),Oh(e.route,r),Fh(t,e.path,n),Rh(t,e.route,n)]).pipe(Xa(),xl(t=>!0!==t,!0))),xl(t=>!0!==t,!0))}(r,s,t,e):ja(n)),U(t=>Object.assign({},n,{guardsResult:t})))}))}}(this.ngModule.injector,t=>this.triggerEvent(t)),sl(t=>{if(fh(t.guardsResult)){const e=sc(`Redirecting to "${this.serializeUrl(t.guardsResult)}"`);throw e.url=t.guardsResult,e}}),sl(t=>{const e=new Hu(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(t.urlAfterRedirects),t.targetSnapshot,!!t.guardsResult);this.triggerEvent(e)}),Za(t=>{if(!t.guardsResult){this.resetUrlToCurrentUrlTree();const n=new Uu(t.id,this.serializeUrl(t.extractedUrl),"");return e.next(n),t.resolve(!1),!1}return!0}),qh(t=>{if(t.guards.canActivateChecks.length)return ja(t).pipe(sl(t=>{const e=new Gu(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(t.urlAfterRedirects),t.targetSnapshot);this.triggerEvent(e)}),(e=this.paramsInheritanceStrategy,n=this.ngModule.injector,function(t){return t.pipe(G(t=>{const{targetSnapshot:r,guards:{canActivateChecks:i}}=t;return i.length?H(i).pipe(Ol(t=>function(t,e,n,r){return function(t,e,n,r){const i=Object.keys(t);if(0===i.length)return ja({});if(1===i.length){const s=i[0];return Wh(t[s],e,n,r).pipe(U(t=>({[s]:t})))}const s={};return H(i).pipe(G(i=>Wh(t[i],e,n,r).pipe(U(t=>(s[i]=t,t))))).pipe(fl(),U(()=>s))}(t._resolve,t,e,r).pipe(U(e=>(t._resolvedData=e,t.data=Object.assign({},t.data,Hc(t,n).resolve),null)))}(t.route,r,e,n)),function(t,e){return arguments.length>=2?function(n){return b(Dl(t,e),nl(1),cl(e))(n)}:function(e){return b(Dl((e,n,r)=>t(e,n,r+1)),nl(1))(e)}}((t,e)=>t),U(e=>t)):ja(t)}))}),sl(t=>{const e=new Yu(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(t.urlAfterRedirects),t.targetSnapshot);this.triggerEvent(e)}));var e,n}),qh(t=>{const{targetSnapshot:e,id:n,extractedUrl:r,rawUrl:i,extras:{skipLocationChange:s,replaceUrl:o}}=t;return this.hooks.afterPreactivation(e,{navigationId:n,appliedUrlTree:r,rawUrlTree:i,skipLocationChange:!!s,replaceUrl:!!o})}),U(t=>{const e=function(t,e,n){const r=function t(e,n,r){if(r&&e.shouldReuseRoute(n.value,r.value.snapshot)){const i=r.value;i._futureSnapshot=n.value;const s=function(e,n,r){return n.children.map(n=>{for(const i of r.children)if(e.shouldReuseRoute(i.value.snapshot,n.value))return t(e,n,i);return t(e,n)})}(e,n,r);return new jc(i,s)}{const r=e.retrieve(n.value);if(r){const t=r.route;return function t(e,n){if(e.value.routeConfig!==n.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(e.children.length!==n.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");n.value._futureSnapshot=e.value;for(let r=0;r<e.children.length;++r)t(e.children[r],n.children[r])}(n,t),t}{const r=new qc(new Ua((i=n.value).url),new Ua(i.params),new Ua(i.queryParams),new Ua(i.fragment),new Ua(i.data),i.outlet,i.component,i),s=n.children.map(n=>t(e,n));return new jc(r,s)}}var i}(t,e._root,n?n._root:void 0);return new Vc(r,e)}(this.routeReuseStrategy,t.targetSnapshot,t.currentRouterState);return Object.assign({},t,{targetRouterState:e})}),sl(t=>{this.currentUrlTree=t.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.rawUrl),this.routerState=t.targetRouterState,"deferred"===this.urlUpdateStrategy&&(t.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,!!t.extras.replaceUrl,t.id,t.extras.state),this.browserUrlTree=t.urlAfterRedirects)}),(i=this.rootContexts,s=this.routeReuseStrategy,o=t=>this.triggerEvent(t),U(t=>(new ch(s,t.targetRouterState,t.currentRouterState,o).activate(i),t))),sl({next(){n=!0},complete(){n=!0}}),Il(()=>{if(!n&&!r){this.resetUrlToCurrentUrlTree();const n=new Uu(t.id,this.serializeUrl(t.extractedUrl),`Navigation ID ${t.id} is not equal to the current navigation id ${this.navigationId}`);e.next(n),t.resolve(!1)}this.currentNavigation=null}),pl(n=>{if(r=!0,(i=n)&&i.ngNavigationCancelingError){const r=fh(n.url);r||(this.navigated=!0,this.resetStateAndUrl(t.currentRouterState,t.currentUrlTree,t.rawUrl));const i=new Uu(t.id,this.serializeUrl(t.extractedUrl),n.message);e.next(i),t.resolve(!1),r&&this.navigateByUrl(n.url)}else{this.resetStateAndUrl(t.currentRouterState,t.currentUrlTree,t.rawUrl);const r=new Vu(t.id,this.serializeUrl(t.extractedUrl),n);e.next(r);try{t.resolve(this.errorHandler(n))}catch(s){t.reject(s)}}var i;return za}));var i,s,o}))}resetRootComponentType(t){this.rootComponentType=t,this.routerState.root.component=this.rootComponentType}getTransition(){const t=this.transitions.value;return t.urlAfterRedirects=this.browserUrlTree,t}setTransition(t){this.transitions.next(Object.assign({},this.getTransition(),t))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(t=>{let e=this.parseUrl(t.url);const n="popstate"===t.type?"popstate":"hashchange",r=t.state&&t.state.navigationId?t.state:null;setTimeout(()=>{this.scheduleNavigation(e,n,r,{replaceUrl:!0})},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(t){this.events.next(t)}resetConfig(t){lc(t),this.config=t.map(hc),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=null)}createUrlTree(t,e={}){const{relativeTo:n,queryParams:r,fragment:i,preserveQueryParams:s,queryParamsHandling:o,preserveFragment:a}=e;Kt()&&s&&console&&console.warn&&console.warn("preserveQueryParams is deprecated, use queryParamsHandling instead.");const l=n||this.routerState.root,u=a?this.currentUrlTree.fragment:i;let c=null;if(o)switch(o){case"merge":c=Object.assign({},this.currentUrlTree.queryParams,r);break;case"preserve":c=this.currentUrlTree.queryParams;break;default:c=r||null}else c=s?this.currentUrlTree.queryParams:r||null;return null!==c&&(c=this.removeEmptyProps(c)),function(t,e,n,r,i){if(0===n.length)return th(e.root,e.root,e,r,i);const s=function(t){if("string"==typeof t[0]&&1===t.length&&"/"===t[0])return new eh(!0,0,t);let e=0,n=!1;const r=t.reduce((t,r,i)=>{if("object"==typeof r&&null!=r){if(r.outlets){const e={};return mc(r.outlets,(t,n)=>{e[n]="string"==typeof t?t.split("/"):t}),[...t,{outlets:e}]}if(r.segmentPath)return[...t,r.segmentPath]}return"string"!=typeof r?[...t,r]:0===i?(r.split("/").forEach((r,i)=>{0==i&&"."===r||(0==i&&""===r?n=!0:".."===r?e++:""!=r&&t.push(r))}),t):[...t,r]},[]);return new eh(n,e,r)}(n);if(s.toRoot())return th(e.root,new bc([],{}),e,r,i);const o=function(t,e,n){if(t.isAbsolute)return new nh(e.root,!0,0);if(-1===n.snapshot._lastPathIndex)return new nh(n.snapshot._urlSegment,!0,0);const r=Jc(t.commands[0])?0:1;return function(t,e,n){let r=t,i=e,s=n;for(;s>i;){if(s-=i,r=r.parent,!r)throw new Error("Invalid number of '../'");i=r.segments.length}return new nh(r,!1,i-s)}(n.snapshot._urlSegment,n.snapshot._lastPathIndex+r,t.numberOfDoubleDots)}(s,e,t),a=o.processChildren?sh(o.segmentGroup,o.index,s.commands):ih(o.segmentGroup,o.index,s.commands);return th(o.segmentGroup,a,e,r,i)}(l,this.currentUrlTree,t,c,u)}navigateByUrl(t,e={skipLocationChange:!1}){Kt()&&this.isNgZoneEnabled&&!Gi.isInAngularZone()&&this.console.warn("Navigation triggered outside Angular zone, did you forget to call 'ngZone.run()'?");const n=fh(t)?t:this.parseUrl(t),r=this.urlHandlingStrategy.merge(n,this.rawUrlTree);return this.scheduleNavigation(r,"imperative",null,e)}navigate(t,e={skipLocationChange:!1}){return function(t){for(let e=0;e<t.length;e++){const n=t[e];if(null==n)throw new Error(`The requested path contains ${n} segment at index ${e}`)}}(t),this.navigateByUrl(this.createUrlTree(t,e),e)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){let e;try{e=this.urlSerializer.parse(t)}catch(n){e=this.malformedUriErrorHandler(n,this.urlSerializer,t)}return e}isActive(t,e){if(fh(t))return yc(this.currentUrlTree,t,e);const n=this.parseUrl(t);return yc(this.currentUrlTree,n,e)}removeEmptyProps(t){return Object.keys(t).reduce((e,n)=>{const r=t[n];return null!=r&&(e[n]=r),e},{})}processNavigations(){this.navigations.subscribe(t=>{this.navigated=!0,this.lastSuccessfulId=t.id,this.events.next(new ju(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,this.currentNavigation=null,t.resolve(!0)},t=>{this.console.warn("Unhandled Navigation Error: ")})}scheduleNavigation(t,e,n,r){const i=this.getTransition();if(i&&"imperative"!==e&&"imperative"===i.source&&i.rawUrl.toString()===t.toString())return Promise.resolve(!0);if(i&&"hashchange"==e&&"popstate"===i.source&&i.rawUrl.toString()===t.toString())return Promise.resolve(!0);if(i&&"popstate"==e&&"hashchange"===i.source&&i.rawUrl.toString()===t.toString())return Promise.resolve(!0);let s=null,o=null;const a=new Promise((t,e)=>{s=t,o=e}),l=++this.navigationId;return this.setTransition({id:l,source:e,restoredState:n,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:t,extras:r,resolve:s,reject:o,promise:a,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),a.catch(t=>Promise.reject(t))}setBrowserUrl(t,e,n,r){const i=this.urlSerializer.serialize(t);r=r||{},this.location.isCurrentPathEqualTo(i)||e?this.location.replaceState(i,"",Object.assign({},r,{navigationId:n})):this.location.go(i,"",Object.assign({},r,{navigationId:n}))}resetStateAndUrl(t,e,n){this.routerState=t,this.currentUrlTree=e,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n),this.resetUrlToCurrentUrlTree()}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",{navigationId:this.lastSuccessfulId})}}class nd{constructor(t,e,n){this.router=t,this.route=e,this.locationStrategy=n,this.commands=[],this.subscription=t.events.subscribe(t=>{t instanceof ju&&this.updateTargetUrlAndHref()})}set routerLink(t){this.commands=null!=t?Array.isArray(t)?t:[t]:[]}set preserveQueryParams(t){Kt()&&console&&console.warn&&console.warn("preserveQueryParams is deprecated, use queryParamsHandling instead."),this.preserve=t}ngOnChanges(t){this.updateTargetUrlAndHref()}ngOnDestroy(){this.subscription.unsubscribe()}onClick(t,e,n,r){if(0!==t||e||n||r)return!0;if("string"==typeof this.target&&"_self"!=this.target)return!0;const i={skipLocationChange:rd(this.skipLocationChange),replaceUrl:rd(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,i),!1}updateTargetUrlAndHref(){this.href=this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree))}get urlTree(){return this.router.createUrlTree(this.commands,{relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,preserveQueryParams:rd(this.preserve),queryParamsHandling:this.queryParamsHandling,preserveFragment:rd(this.preserveFragment)})}}function rd(t){return""===t||!!t}class id{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new sd,this.attachRef=null}}class sd{constructor(){this.contexts=new Map}onChildOutletCreated(t,e){const n=this.getOrCreateContext(t);n.outlet=e,this.contexts.set(t,n)}onChildOutletDestroyed(t){const e=this.getContext(t);e&&(e.outlet=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let e=this.getContext(t);return e||(e=new id,this.contexts.set(t,e)),e}getContext(t){return this.contexts.get(t)||null}}class od{constructor(t,e,n,r,i){this.parentContexts=t,this.location=e,this.resolver=n,this.changeDetector=i,this.activated=null,this._activatedRoute=null,this.activateEvents=new vi,this.deactivateEvents=new vi,this.name=r||"primary",t.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const t=this.parentContexts.getContext(this.name);t&&t.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,t}attach(t,e){this.activated=t,this._activatedRoute=e,this.location.insert(t.hostView)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,e){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=t;const n=(e=e||this.resolver).resolveComponentFactory(t._futureSnapshot.routeConfig.component),r=this.parentContexts.getOrCreateContext(this.name).children,i=new ad(t,r,this.location.injector);this.activated=this.location.createComponent(n,this.location.length,i),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}class ad{constructor(t,e,n){this.route=t,this.childContexts=e,this.parent=n}get(t,e){return t===qc?this.route:t===sd?this.childContexts:this.parent.get(t,e)}}class ld{}class ud{preload(t,e){return e().pipe(pl(()=>ja(null)))}}class cd{preload(t,e){return ja(null)}}class hd{constructor(t,e,n,r,i){this.router=t,this.injector=r,this.preloadingStrategy=i,this.loader=new Kh(e,n,e=>t.triggerEvent(new Ku(e)),e=>t.triggerEvent(new Xu(e)))}setUpPreloading(){this.subscription=this.router.events.pipe(Za(t=>t instanceof ju),Ol(()=>this.preload())).subscribe(()=>{})}preload(){const t=this.injector.get(Pt);return this.processRoutes(t,this.router.config)}ngOnDestroy(){this.subscription.unsubscribe()}processRoutes(t,e){const n=[];for(const r of e)if(r.loadChildren&&!r.canLoad&&r._loadedConfig){const t=r._loadedConfig;n.push(this.processRoutes(t.module,t.routes))}else r.loadChildren&&!r.canLoad?n.push(this.preloadConfig(t,r)):r.children&&n.push(this.processRoutes(t,r.children));return H(n).pipe(Z(),U(t=>{}))}preloadConfig(t,e){return this.preloadingStrategy.preload(e,()=>this.loader.load(t.injector,e).pipe(G(t=>(e._loadedConfig=t,this.processRoutes(t.module,t.routes)))))}}class dd{constructor(t,e,n={}){this.router=t,this.viewportScroller=e,this.options=n,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},n.scrollPositionRestoration=n.scrollPositionRestoration||"disabled",n.anchorScrolling=n.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(t=>{t instanceof Bu?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof ju&&(this.lastId=t.id,this.scheduleScrollEvent(t,this.router.parseUrl(t.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(t=>{t instanceof ec&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,e){this.router.triggerEvent(new ec(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,e))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}const fd=new kt("ROUTER_CONFIGURATION"),pd=new kt("ROUTER_FORROOT_GUARD"),md=[oa,{provide:Sc,useClass:Cc},{provide:ed,useFactory:wd,deps:[hs,Sc,sd,oa,Ae,fs,$i,Yh,fd,[Xh,new ut],[Hh,new ut]]},sd,{provide:qc,useFactory:Sd,deps:[ed]},{provide:fs,useClass:gs},hd,cd,ud,{provide:fd,useValue:{enableTracing:!1}}];function gd(){return new os("Router",ed)}class yd{constructor(t,e){}static forRoot(t,e){return{ngModule:yd,providers:[md,_d(t),{provide:pd,useFactory:xd,deps:[[ed,new ut,new ht]]},{provide:fd,useValue:e||{}},{provide:ia,useFactory:bd,deps:[na,[new lt(sa),new ut],fd]},{provide:dd,useFactory:vd,deps:[ed,$a,fd]},{provide:ld,useExisting:e&&e.preloadingStrategy?e.preloadingStrategy:cd},{provide:os,multi:!0,useFactory:gd},[Cd,{provide:_i,multi:!0,useFactory:Ed,deps:[Cd]},{provide:Ad,useFactory:kd,deps:[Cd]},{provide:Di,multi:!0,useExisting:Ad}]]}}static forChild(t){return{ngModule:yd,providers:[_d(t)]}}}function vd(t,e,n){return n.scrollOffset&&e.setOffset(n.scrollOffset),new dd(t,e,n)}function bd(t,e,n={}){return n.useHash?new la(t,e):new ua(t,e)}function xd(t){if(t)throw new Error("RouterModule.forRoot() called twice. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function _d(t){return[{provide:Me,multi:!0,useValue:t},{provide:Yh,multi:!0,useValue:t}]}function wd(t,e,n,r,i,s,o,a,l={},u,c){const h=new ed(null,e,n,r,i,s,o,fc(a));if(u&&(h.urlHandlingStrategy=u),c&&(h.routeReuseStrategy=c),l.errorHandler&&(h.errorHandler=l.errorHandler),l.malformedUriErrorHandler&&(h.malformedUriErrorHandler=l.malformedUriErrorHandler),l.enableTracing){const t=$l();h.events.subscribe(e=>{t.logGroup("Router Event: "+e.constructor.name),t.log(e.toString()),t.log(e),t.logGroupEnd()})}return l.onSameUrlNavigation&&(h.onSameUrlNavigation=l.onSameUrlNavigation),l.paramsInheritanceStrategy&&(h.paramsInheritanceStrategy=l.paramsInheritanceStrategy),l.urlUpdateStrategy&&(h.urlUpdateStrategy=l.urlUpdateStrategy),l.relativeLinkResolution&&(h.relativeLinkResolution=l.relativeLinkResolution),h}function Sd(t){return t.routerState.root}class Cd{constructor(t){this.injector=t,this.initNavigation=!1,this.resultOfPreactivationDone=new A}appInitializer(){return this.injector.get(ra,Promise.resolve(null)).then(()=>{let t=null;const e=new Promise(e=>t=e),n=this.injector.get(ed),r=this.injector.get(fd);if(this.isLegacyDisabled(r)||this.isLegacyEnabled(r))t(!0);else if("disabled"===r.initialNavigation)n.setUpLocationChangeListener(),t(!0);else{if("enabled"!==r.initialNavigation)throw new Error(`Invalid initialNavigation options: '${r.initialNavigation}'`);n.hooks.afterPreactivation=()=>this.initNavigation?ja(null):(this.initNavigation=!0,t(!0),this.resultOfPreactivationDone),n.initialNavigation()}return e})}bootstrapListener(t){const e=this.injector.get(fd),n=this.injector.get(hd),r=this.injector.get(dd),i=this.injector.get(ed),s=this.injector.get(hs);t===s.components[0]&&(this.isLegacyEnabled(e)?i.initialNavigation():this.isLegacyDisabled(e)&&i.setUpLocationChangeListener(),n.setUpPreloading(),r.init(),i.resetRootComponentType(s.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}isLegacyEnabled(t){return"legacy_enabled"===t.initialNavigation||!0===t.initialNavigation||void 0===t.initialNavigation}isLegacyDisabled(t){return"legacy_disabled"===t.initialNavigation||!1===t.initialNavigation}}function Ed(t){return t.appInitializer.bind(t)}function kd(t){return t.bootstrapListener.bind(t)}const Ad=new kt("Router Initializer");var Dd=Vn({encapsulation:2,styles:[],data:{}});function Nd(t){return Hs(0,[(t()(),Os(0,16777216,null,null,1,"router-outlet",[],null,null,null,null,null)),Zr(1,212992,null,0,od,[sd,An,Xe,[8,null],Se],null,null)],(function(t,e){t(e,1,0)}),null)}function Td(t){return Hs(0,[(t()(),Os(0,0,null,null,1,"ng-component",[],null,null,null,Nd,Dd)),Zr(1,49152,null,0,nc,[],null,null)],null,null)}var Od=Ar("ng-component",nc,Td,{},{},[]),Id=n("mrSG"),Rd=n("zhpf"),Fd=n("dfBD");class Md{constructor(t){this.ngZone=t}ngOnInit(){this.loadModel(),this.createModel()}loadModel(){this.trainingData=Rd.data.csv("./assets/iris/iris.csv",{columnConfigs:{species:{isLabel:!0}}}),console.log("lenght : ",this.trainingData.columnNames())}createModel(){return Id.a(this,void 0,void 0,(function*(){const t=(yield this.trainingData.columnNames()).length-1;this.convertedData=this.trainingData.map(({xs:t,ys:e})=>{const n=["setosa"==e.species?1:0,"virginica"==e.species?1:0,"versicolor"==e.species?1:0];return{xs:Object.values(t),ys:Object.values(n)}}).batch(10),this.model=Rd.sequential(),this.model.add(Rd.layers.dense({inputShape:[t],activation:"sigmoid",units:5})),this.model.add(Rd.layers.dense({activation:"softmax",units:3})),this.model.compile({loss:"categoricalCrossentropy",optimizer:Rd.train.adam(.06)}),Fd.show.modelSummary({name:"Model Summary",tab:"Model Inspection"},this.model),this.doTraining(this.model).then(()=>{const t=Rd.tensor2d([4.4,2.9,1.4,.2],[1,4]);this.predictModel=this.model.predict(t),console.log("prediction : ",this.predictModel),Fd.show.valuesDistribution({name:"Values Distribution",tab:"Model Inspection"},this.predictModel)}).catch(t=>console.log(t))}))}doTraining(t){return Id.a(this,void 0,void 0,(function*(){yield t.fitDataset(this.convertedData,{epochs:100,callbacks:{onEpochEnd:(t,e)=>Id.a(this,void 0,void 0,(function*(){this.ngZone.run(()=>{this.trainInProgress=e.loss,this.noOfEpocs=t}),console.log("Epoch: "+t+" Loss: "+e.loss)}))}})}))}}var $d=Vn({encapsulation:0,styles:[[""]],data:{}});function Pd(t){return Hs(0,[(t()(),Os(0,0,null,null,1,"p",[],null,null,null,null,null)),(t()(),Vs(-1,null,["iris-classifier works!"])),(t()(),Os(2,0,null,null,1,"p",[],null,null,null,null,null)),(t()(),Vs(3,null,["",""])),(t()(),Os(4,0,null,null,1,"p",[],null,null,null,null,null)),(t()(),Vs(5,null,["","----",""]))],null,(function(t,e){var n=e.component;t(e,3,0,n.predictModel),t(e,5,0,n.noOfEpocs,n.trainInProgress)}))}function zd(t){return Hs(0,[(t()(),Os(0,0,null,null,1,"app-iris-classifier",[],null,null,null,Pd,$d)),Zr(1,114688,null,0,Md,[Gi],null,null)],(function(t,e){t(e,1,0)}),null)}var Ld=Ar("app-iris-classifier",Md,zd,{},{},[]);class Bd{}function jd(t,e=null){return{type:2,steps:t,options:e}}function Ud(t){return{type:6,styles:t,offset:null}}function Vd(t){Promise.resolve(null).then(t)}class Wd{constructor(t=0,e=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this.parentPlayer=null,this.totalTime=t+e}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}onStart(t){this._onStartFns.push(t)}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){Vd(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(t=>t()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){}setPosition(t){}getPosition(){return 0}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(t=>t()),e.length=0}}class qd{constructor(t){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=t;let e=0,n=0,r=0;const i=this.players.length;0==i?Vd(()=>this._onFinish()):this.players.forEach(t=>{t.onDone(()=>{++e==i&&this._onFinish()}),t.onDestroy(()=>{++n==i&&this._onDestroy()}),t.onStart(()=>{++r==i&&this._onStart()})}),this.totalTime=this.players.reduce((t,e)=>Math.max(t,e.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this.players.forEach(t=>t.init())}onStart(t){this._onStartFns.push(t)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(t=>t()),this._onStartFns=[])}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(t=>t.play())}pause(){this.players.forEach(t=>t.pause())}restart(){this.players.forEach(t=>t.restart())}finish(){this._onFinish(),this.players.forEach(t=>t.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(t=>t.destroy()),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this.players.forEach(t=>t.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(t){const e=t*this.totalTime;this.players.forEach(t=>{const n=t.totalTime?Math.min(1,e/t.totalTime):1;t.setPosition(n)})}getPosition(){let t=0;return this.players.forEach(e=>{const n=e.getPosition();t=Math.min(n,t)}),t}beforeDestroy(){this.players.forEach(t=>{t.beforeDestroy&&t.beforeDestroy()})}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(t=>t()),e.length=0}}const Hd=new ln("8.2.3");function Gd(t){return null!=t&&""+t!="false"}function Yd(t){return Array.isArray(t)?t:[t]}function Kd(t){return null==t?"":"string"==typeof t?t:t+"px"}function Xd(t){return t instanceof tn?t.nativeElement:t}let Zd;try{Zd="undefined"!=typeof Intl&&Intl.v8BreakIterator}catch(K_){Zd=!1}let Qd,Jd,tf=(()=>{class t{constructor(t){this._platformId=t,this.isBrowser=this._platformId?Fa(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!Zd)&&"undefined"!=typeof CSS&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return t.ngInjectableDef=pt({factory:function(){return new t(Rt(Ai,8))},token:t,providedIn:"root"}),t})();class ef{}function nf(t){return function(){if(null==Qd&&"undefined"!=typeof window)try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>Qd=!0}))}finally{Qd=Qd||!1}return Qd}()?t:!!t.capture}class rf extends d{constructor(t,e){super()}schedule(t,e=0){return this}}class sf extends rf{constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){if(this.closed)return this;this.state=t;const n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(r,this.id,e),this}requestAsyncId(t,e,n=0){return setInterval(t.flush.bind(t,this),n)}recycleAsyncId(t,e,n=0){if(null!==n&&this.delay===n&&!1===this.pending)return e;clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let n=!1,r=void 0;try{this.work(t)}catch(i){n=!0,r=!!i&&i||new Error(i)}if(n)return this.unsubscribe(),r}_unsubscribe(){const t=this.id,e=this.scheduler,n=e.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null}}let of=(()=>{class t{constructor(e,n=t.now){this.SchedulerAction=e,this.now=n}schedule(t,e=0,n){return new this.SchedulerAction(this,t).schedule(n,e)}}return t.now=()=>Date.now(),t})();class af extends of{constructor(t,e=of.now){super(t,()=>af.delegate&&af.delegate!==this?af.delegate.now():e()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(t,e=0,n){return af.delegate&&af.delegate!==this?af.delegate.schedule(t,e,n):super.schedule(t,e,n)}flush(t){const{actions:e}=this;if(this.active)return void e.push(t);let n;this.active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}}const lf=new af(sf);class uf{constructor(t,e){this.dueTime=t,this.scheduler=e}call(t,e){return e.subscribe(new cf(t,this.dueTime,this.scheduler))}}class cf extends m{constructor(t,e,n){super(t),this.dueTime=e,this.scheduler=n,this.debouncedSubscription=null,this.lastValue=null,this.hasValue=!1}_next(t){this.clearDebounce(),this.lastValue=t,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(hf,this.dueTime,this))}_complete(){this.debouncedNext(),this.destination.complete()}debouncedNext(){if(this.clearDebounce(),this.hasValue){const{lastValue:t}=this;this.lastValue=null,this.hasValue=!1,this.destination.next(t)}}clearDebounce(){const t=this.debouncedSubscription;null!==t&&(this.remove(t),t.unsubscribe(),this.debouncedSubscription=null)}}function hf(t){t.debouncedNext()}let df=(()=>{class t{constructor(t){this._platform=t}isDisabled(t){return t.hasAttribute("disabled")}isVisible(t){return function(t){return!!(t.offsetWidth||t.offsetHeight||"function"==typeof t.getClientRects&&t.getClientRects().length)}(t)&&"visible"===getComputedStyle(t).visibility}isTabbable(t){if(!this._platform.isBrowser)return!1;const e=function(t){try{return t.frameElement}catch(K_){return null}}((n=t).ownerDocument&&n.ownerDocument.defaultView||window);var n;if(e){const t=e&&e.nodeName.toLowerCase();if(-1===pf(e))return!1;if((this._platform.BLINK||this._platform.WEBKIT)&&"object"===t)return!1;if((this._platform.BLINK||this._platform.WEBKIT)&&!this.isVisible(e))return!1}let r=t.nodeName.toLowerCase(),i=pf(t);if(t.hasAttribute("contenteditable"))return-1!==i;if("iframe"===r)return!1;if("audio"===r){if(!t.hasAttribute("controls"))return!1;if(this._platform.BLINK)return!0}if("video"===r){if(!t.hasAttribute("controls")&&this._platform.TRIDENT)return!1;if(this._platform.BLINK||this._platform.FIREFOX)return!0}return("object"!==r||!this._platform.BLINK&&!this._platform.WEBKIT)&&!(this._platform.WEBKIT&&this._platform.IOS&&!function(t){let e=t.nodeName.toLowerCase(),n="input"===e&&t.type;return"text"===n||"password"===n||"select"===e||"textarea"===e}(t))&&t.tabIndex>=0}isFocusable(t){return function(t){return!function(t){return function(t){return"input"==t.nodeName.toLowerCase()}(t)&&"hidden"==t.type}(t)&&(function(t){let e=t.nodeName.toLowerCase();return"input"===e||"select"===e||"button"===e||"textarea"===e}(t)||function(t){return function(t){return"a"==t.nodeName.toLowerCase()}(t)&&t.hasAttribute("href")}(t)||t.hasAttribute("contenteditable")||ff(t))}(t)&&!this.isDisabled(t)&&this.isVisible(t)}}return t.ngInjectableDef=pt({factory:function(){return new t(Rt(tf))},token:t,providedIn:"root"}),t})();function ff(t){if(!t.hasAttribute("tabindex")||void 0===t.tabIndex)return!1;let e=t.getAttribute("tabindex");return"-32768"!=e&&!(!e||isNaN(parseInt(e,10)))}function pf(t){if(!ff(t))return null;const e=parseInt(t.getAttribute("tabindex")||"",10);return isNaN(e)?-1:e}class mf{constructor(t,e,n,r,i=!1){this._element=t,this._checker=e,this._ngZone=n,this._document=r,this._hasAttached=!1,this.startAnchorListener=()=>this.focusLastTabbableElement(),this.endAnchorListener=()=>this.focusFirstTabbableElement(),this._enabled=!0,i||this.attachAnchors()}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}destroy(){const t=this._startAnchor,e=this._endAnchor;t&&(t.removeEventListener("focus",this.startAnchorListener),t.parentNode&&t.parentNode.removeChild(t)),e&&(e.removeEventListener("focus",this.endAnchorListener),e.parentNode&&e.parentNode.removeChild(e)),this._startAnchor=this._endAnchor=null}attachAnchors(){return!!this._hasAttached||(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(){return new Promise(t=>{this._executeOnStable(()=>t(this.focusInitialElement()))})}focusFirstTabbableElementWhenReady(){return new Promise(t=>{this._executeOnStable(()=>t(this.focusFirstTabbableElement()))})}focusLastTabbableElementWhenReady(){return new Promise(t=>{this._executeOnStable(()=>t(this.focusLastTabbableElement()))})}_getRegionBoundary(t){let e=this._element.querySelectorAll(`[cdk-focus-region-${t}], [cdkFocusRegion${t}], [cdk-focus-${t}]`);for(let n=0;n<e.length;n++)e[n].hasAttribute("cdk-focus-"+t)?console.warn(`Found use of deprecated attribute 'cdk-focus-${t}', use 'cdkFocusRegion${t}' instead. The deprecated attribute will be removed in 8.0.0.`,e[n]):e[n].hasAttribute("cdk-focus-region-"+t)&&console.warn(`Found use of deprecated attribute 'cdk-focus-region-${t}', use 'cdkFocusRegion${t}' instead. The deprecated attribute will be removed in 8.0.0.`,e[n]);return"start"==t?e.length?e[0]:this._getFirstTabbableElement(this._element):e.length?e[e.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(){const t=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");return t?(t.hasAttribute("cdk-focus-initial")&&console.warn("Found use of deprecated attribute 'cdk-focus-initial', use 'cdkFocusInitial' instead. The deprecated attribute will be removed in 8.0.0",t),Kt()&&!this._checker.isFocusable(t)&&console.warn("Element matching '[cdkFocusInitial]' is not focusable.",t),t.focus(),!0):this.focusFirstTabbableElement()}focusFirstTabbableElement(){const t=this._getRegionBoundary("start");return t&&t.focus(),!!t}focusLastTabbableElement(){const t=this._getRegionBoundary("end");return t&&t.focus(),!!t}hasAttached(){return this._hasAttached}_getFirstTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;let e=t.children||t.childNodes;for(let n=0;n<e.length;n++){let t=e[n].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(e[n]):null;if(t)return t}return null}_getLastTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;let e=t.children||t.childNodes;for(let n=e.length-1;n>=0;n--){let t=e[n].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(e[n]):null;if(t)return t}return null}_createAnchor(){const t=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,t),t.classList.add("cdk-visually-hidden"),t.classList.add("cdk-focus-trap-anchor"),t.setAttribute("aria-hidden","true"),t}_toggleAnchorTabIndex(t,e){t?e.setAttribute("tabindex","0"):e.removeAttribute("tabindex")}_executeOnStable(t){this._ngZone.isStable?t():this._ngZone.onStable.asObservable().pipe(yl(1)).subscribe(t)}}let gf=(()=>{class t{constructor(t,e,n){this._checker=t,this._ngZone=e,this._document=n}create(t,e=!1){return new mf(t,this._checker,this._ngZone,this._document,e)}}return t.ngInjectableDef=pt({factory:function(){return new t(Rt(df),Rt(Gi),Rt(Ra))},token:t,providedIn:"root"}),t})();class yf{constructor(t,e,n){this._elementRef=t,this._focusTrapFactory=e,this._previouslyFocusedElement=null,this._document=n,this.focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement,!0)}get enabled(){return this.focusTrap.enabled}set enabled(t){this.focusTrap.enabled=Gd(t)}get autoCapture(){return this._autoCapture}set autoCapture(t){this._autoCapture=Gd(t)}ngOnDestroy(){this.focusTrap.destroy(),this._previouslyFocusedElement&&(this._previouslyFocusedElement.focus(),this._previouslyFocusedElement=null)}ngAfterContentInit(){this.focusTrap.attachAnchors(),this.autoCapture&&(this._previouslyFocusedElement=this._document.activeElement,this.focusTrap.focusInitialElementWhenReady())}ngDoCheck(){this.focusTrap.hasAttached()||this.focusTrap.attachAnchors()}}const vf=new kt("liveAnnouncerElement",{providedIn:"root",factory:function(){return null}}),bf=new kt("LIVE_ANNOUNCER_DEFAULT_OPTIONS");let xf=(()=>{class t{constructor(t,e,n,r){this._ngZone=e,this._defaultOptions=r,this._document=n,this._liveElement=t||this._createLiveElement()}announce(t,...e){const n=this._defaultOptions;let r,i;return 1===e.length&&"number"==typeof e[0]?i=e[0]:[r,i]=e,this.clear(),clearTimeout(this._previousTimeout),r||(r=n&&n.politeness?n.politeness:"polite"),null==i&&n&&(i=n.duration),this._liveElement.setAttribute("aria-live",r),this._ngZone.runOutsideAngular(()=>new Promise(e=>{clearTimeout(this._previousTimeout),this._previousTimeout=setTimeout(()=>{this._liveElement.textContent=t,e(),"number"==typeof i&&(this._previousTimeout=setTimeout(()=>this.clear(),i))},100)}))}clear(){this._liveElement&&(this._liveElement.textContent="")}ngOnDestroy(){clearTimeout(this._previousTimeout),this._liveElement&&this._liveElement.parentNode&&(this._liveElement.parentNode.removeChild(this._liveElement),this._liveElement=null)}_createLiveElement(){const t=this._document.getElementsByClassName("cdk-live-announcer-element"),e=this._document.createElement("div");for(let n=0;n<t.length;n++)t[n].parentNode.removeChild(t[n]);return e.classList.add("cdk-live-announcer-element"),e.classList.add("cdk-visually-hidden"),e.setAttribute("aria-atomic","true"),e.setAttribute("aria-live","polite"),this._document.body.appendChild(e),e}}return t.ngInjectableDef=pt({factory:function(){return new t(Rt(vf,8),Rt(Gi),Rt(Ra),Rt(bf,8))},token:t,providedIn:"root"}),t})();class _f{constructor(t,e,n,r){this._elementRef=t,this._liveAnnouncer=e,this._contentObserver=n,this._ngZone=r,this._politeness="off"}get politeness(){return this._politeness}set politeness(t){this._politeness="polite"===t||"assertive"===t?t:"off","off"===this._politeness?this._subscription&&(this._subscription.unsubscribe(),this._subscription=null):this._subscription||(this._subscription=this._ngZone.runOutsideAngular(()=>this._contentObserver.observe(this._elementRef).subscribe(()=>{const t=this._elementRef.nativeElement.textContent;t!==this._previousAnnouncedText&&(this._liveAnnouncer.announce(t,this._politeness),this._previousAnnouncedText=t)})))}ngOnDestroy(){this._subscription&&this._subscription.unsubscribe()}}const wf=nf({passive:!0,capture:!0});let Sf=(()=>{class t{constructor(t,e){this._ngZone=t,this._platform=e,this._origin=null,this._windowFocused=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._documentKeydownListener=()=>{this._lastTouchTarget=null,this._setOriginForCurrentEventQueue("keyboard")},this._documentMousedownListener=()=>{this._lastTouchTarget||this._setOriginForCurrentEventQueue("mouse")},this._documentTouchstartListener=t=>{null!=this._touchTimeoutId&&clearTimeout(this._touchTimeoutId),this._lastTouchTarget=t.composedPath?t.composedPath()[0]:t.target,this._touchTimeoutId=setTimeout(()=>this._lastTouchTarget=null,650)},this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=setTimeout(()=>this._windowFocused=!1)}}monitor(t,e=!1){if(!this._platform.isBrowser)return ja(null);const n=Xd(t);if(this._elementInfo.has(n)){let t=this._elementInfo.get(n);return t.checkChildren=e,t.subject.asObservable()}let r={unlisten:()=>{},checkChildren:e,subject:new A};this._elementInfo.set(n,r),this._incrementMonitoredElementCount();let i=t=>this._onFocus(t,n),s=t=>this._onBlur(t,n);return this._ngZone.runOutsideAngular(()=>{n.addEventListener("focus",i,!0),n.addEventListener("blur",s,!0)}),r.unlisten=()=>{n.removeEventListener("focus",i,!0),n.removeEventListener("blur",s,!0)},r.subject.asObservable()}stopMonitoring(t){const e=Xd(t),n=this._elementInfo.get(e);n&&(n.unlisten(),n.subject.complete(),this._setClasses(e),this._elementInfo.delete(e),this._decrementMonitoredElementCount())}focusVia(t,e,n){const r=Xd(t);this._setOriginForCurrentEventQueue(e),"function"==typeof r.focus&&r.focus(n)}ngOnDestroy(){this._elementInfo.forEach((t,e)=>this.stopMonitoring(e))}_toggleClass(t,e,n){n?t.classList.add(e):t.classList.remove(e)}_setClasses(t,e){this._elementInfo.get(t)&&(this._toggleClass(t,"cdk-focused",!!e),this._toggleClass(t,"cdk-touch-focused","touch"===e),this._toggleClass(t,"cdk-keyboard-focused","keyboard"===e),this._toggleClass(t,"cdk-mouse-focused","mouse"===e),this._toggleClass(t,"cdk-program-focused","program"===e))}_setOriginForCurrentEventQueue(t){this._ngZone.runOutsideAngular(()=>{this._origin=t,this._originTimeoutId=setTimeout(()=>this._origin=null,1)})}_wasCausedByTouch(t){let e=t.target;return this._lastTouchTarget instanceof Node&&e instanceof Node&&(e===this._lastTouchTarget||e.contains(this._lastTouchTarget))}_onFocus(t,e){const n=this._elementInfo.get(e);if(!n||!n.checkChildren&&e!==t.target)return;let r=this._origin;r||(r=this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:this._wasCausedByTouch(t)?"touch":"program"),this._setClasses(e,r),this._emitOrigin(n.subject,r),this._lastFocusOrigin=r}_onBlur(t,e){const n=this._elementInfo.get(e);!n||n.checkChildren&&t.relatedTarget instanceof Node&&e.contains(t.relatedTarget)||(this._setClasses(e),this._emitOrigin(n.subject,null))}_emitOrigin(t,e){this._ngZone.run(()=>t.next(e))}_incrementMonitoredElementCount(){1==++this._monitoredElementCount&&this._platform.isBrowser&&this._ngZone.runOutsideAngular(()=>{document.addEventListener("keydown",this._documentKeydownListener,wf),document.addEventListener("mousedown",this._documentMousedownListener,wf),document.addEventListener("touchstart",this._documentTouchstartListener,wf),window.addEventListener("focus",this._windowFocusListener)})}_decrementMonitoredElementCount(){--this._monitoredElementCount||(document.removeEventListener("keydown",this._documentKeydownListener,wf),document.removeEventListener("mousedown",this._documentMousedownListener,wf),document.removeEventListener("touchstart",this._documentTouchstartListener,wf),window.removeEventListener("focus",this._windowFocusListener),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._touchTimeoutId),clearTimeout(this._originTimeoutId))}}return t.ngInjectableDef=pt({factory:function(){return new t(Rt(Gi),Rt(tf))},token:t,providedIn:"root"}),t})();class Cf{constructor(t,e){this._elementRef=t,this._focusMonitor=e,this.cdkFocusChange=new vi,this._monitorSubscription=this._focusMonitor.monitor(this._elementRef,this._elementRef.nativeElement.hasAttribute("cdkMonitorSubtreeFocus")).subscribe(t=>this.cdkFocusChange.emit(t))}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._monitorSubscription.unsubscribe()}}class Ef{}const kf=new ln("8.2.3"),Af=new kt("mat-sanity-checks",{providedIn:"root",factory:function(){return!0}});class Df{constructor(t,e){this._sanityChecksEnabled=t,this._hammerLoader=e,this._hasDoneGlobalChecks=!1,this._hasCheckedHammer=!1,this._document="object"==typeof document&&document?document:null,this._window="object"==typeof window&&window?window:null,this._areChecksEnabled()&&!this._hasDoneGlobalChecks&&(this._checkDoctypeIsDefined(),this._checkThemeIsPresent(),this._checkCdkVersionMatch(),this._hasDoneGlobalChecks=!0)}_areChecksEnabled(){return this._sanityChecksEnabled&&Kt()&&!this._isTestEnv()}_isTestEnv(){const t=this._window;return t&&(t.__karma__||t.jasmine)}_checkDoctypeIsDefined(){this._document&&!this._document.doctype&&console.warn("Current document does not have a doctype. This may cause some Angular Material components not to behave as expected.")}_checkThemeIsPresent(){if(!this._document||!this._document.body||"function"!=typeof getComputedStyle)return;const t=this._document.createElement("div");t.classList.add("mat-theme-loaded-marker"),this._document.body.appendChild(t);const e=getComputedStyle(t);e&&"none"!==e.display&&console.warn("Could not find Angular Material core theme. Most Material components may not work as expected. For more info refer to the theming guide: https://material.angular.io/guide/theming"),this._document.body.removeChild(t)}_checkCdkVersionMatch(){kf.full!==Hd.full&&console.warn("The Angular Material version ("+kf.full+") does not match the Angular CDK version ("+Hd.full+").\nPlease ensure the versions of these two packages exactly match.")}_checkHammerIsAvailable(){!this._hasCheckedHammer&&this._window&&(!this._areChecksEnabled()||this._window.Hammer||this._hammerLoader||console.warn("Could not find HammerJS. Certain Angular Material components may not work correctly."),this._hasCheckedHammer=!0)}}function Nf(t){return class extends t{constructor(...t){super(...t),this._disabled=!1}get disabled(){return this._disabled}set disabled(t){this._disabled=Gd(t)}}}function Tf(t,e){return class extends t{get color(){return this._color}set color(t){const n=t||e;n!==this._color&&(this._color&&this._elementRef.nativeElement.classList.remove("mat-"+this._color),n&&this._elementRef.nativeElement.classList.add("mat-"+n),this._color=n)}constructor(...t){super(...t),this.color=e}}}function Of(t){return class extends t{constructor(...t){super(...t),this._disableRipple=!1}get disableRipple(){return this._disableRipple}set disableRipple(t){this._disableRipple=Gd(t)}}}const If=new kt("MAT_DATE_LOCALE",{providedIn:"root",factory:function(){return Ft(Ti)}});class Rf{constructor(){this._localeChanges=new A}get localeChanges(){return this._localeChanges}deserialize(t){return null==t||this.isDateInstance(t)&&this.isValid(t)?t:this.invalid()}setLocale(t){this.locale=t,this._localeChanges.next()}compareDate(t,e){return this.getYear(t)-this.getYear(e)||this.getMonth(t)-this.getMonth(e)||this.getDate(t)-this.getDate(e)}sameDate(t,e){if(t&&e){let n=this.isValid(t),r=this.isValid(e);return n&&r?!this.compareDate(t,e):n==r}return t==e}clampDate(t,e,n){return e&&this.compareDate(t,e)<0?e:n&&this.compareDate(t,n)>0?n:t}}const Ff=new kt("mat-date-formats");let Mf;try{Mf="undefined"!=typeof Intl}catch(K_){Mf=!1}const $f={long:["January","February","March","April","May","June","July","August","September","October","November","December"],short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],narrow:["J","F","M","A","M","J","J","A","S","O","N","D"]},Pf=Bf(31,t=>String(t+1)),zf={long:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],short:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],narrow:["S","M","T","W","T","F","S"]},Lf=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:Z|(?:(?:\+|-)\d{2}:\d{2}))?)?$/;function Bf(t,e){const n=Array(t);for(let r=0;r<t;r++)n[r]=e(r);return n}class jf extends Rf{constructor(t,e){super(),this.useUtcForDisplay=!0,super.setLocale(t),this.useUtcForDisplay=!e.TRIDENT,this._clampDate=e.TRIDENT||e.EDGE}getYear(t){return t.getFullYear()}getMonth(t){return t.getMonth()}getDate(t){return t.getDate()}getDayOfWeek(t){return t.getDay()}getMonthNames(t){if(Mf){const e=new Intl.DateTimeFormat(this.locale,{month:t,timeZone:"utc"});return Bf(12,t=>this._stripDirectionalityCharacters(this._format(e,new Date(2017,t,1))))}return $f[t]}getDateNames(){if(Mf){const t=new Intl.DateTimeFormat(this.locale,{day:"numeric",timeZone:"utc"});return Bf(31,e=>this._stripDirectionalityCharacters(this._format(t,new Date(2017,0,e+1))))}return Pf}getDayOfWeekNames(t){if(Mf){const e=new Intl.DateTimeFormat(this.locale,{weekday:t,timeZone:"utc"});return Bf(7,t=>this._stripDirectionalityCharacters(this._format(e,new Date(2017,0,t+1))))}return zf[t]}getYearName(t){if(Mf){const e=new Intl.DateTimeFormat(this.locale,{year:"numeric",timeZone:"utc"});return this._stripDirectionalityCharacters(this._format(e,t))}return String(this.getYear(t))}getFirstDayOfWeek(){return 0}getNumDaysInMonth(t){return this.getDate(this._createDateWithOverflow(this.getYear(t),this.getMonth(t)+1,0))}clone(t){return new Date(t.getTime())}createDate(t,e,n){if(e<0||e>11)throw Error(`Invalid month index "${e}". Month index has to be between 0 and 11.`);if(n<1)throw Error(`Invalid date "${n}". Date has to be greater than 0.`);let r=this._createDateWithOverflow(t,e,n);if(r.getMonth()!=e)throw Error(`Invalid date "${n}" for month with index "${e}".`);return r}today(){return new Date}parse(t){return"number"==typeof t?new Date(t):t?new Date(Date.parse(t)):null}format(t,e){if(!this.isValid(t))throw Error("NativeDateAdapter: Cannot format invalid date.");if(Mf){this._clampDate&&(t.getFullYear()<1||t.getFullYear()>9999)&&(t=this.clone(t)).setFullYear(Math.max(1,Math.min(9999,t.getFullYear()))),e=Object.assign({},e,{timeZone:"utc"});const n=new Intl.DateTimeFormat(this.locale,e);return this._stripDirectionalityCharacters(this._format(n,t))}return this._stripDirectionalityCharacters(t.toDateString())}addCalendarYears(t,e){return this.addCalendarMonths(t,12*e)}addCalendarMonths(t,e){let n=this._createDateWithOverflow(this.getYear(t),this.getMonth(t)+e,this.getDate(t));return this.getMonth(n)!=((this.getMonth(t)+e)%12+12)%12&&(n=this._createDateWithOverflow(this.getYear(n),this.getMonth(n),0)),n}addCalendarDays(t,e){return this._createDateWithOverflow(this.getYear(t),this.getMonth(t),this.getDate(t)+e)}toIso8601(t){return[t.getUTCFullYear(),this._2digit(t.getUTCMonth()+1),this._2digit(t.getUTCDate())].join("-")}deserialize(t){if("string"==typeof t){if(!t)return null;if(Lf.test(t)){let e=new Date(t);if(this.isValid(e))return e}}return super.deserialize(t)}isDateInstance(t){return t instanceof Date}isValid(t){return!isNaN(t.getTime())}invalid(){return new Date(NaN)}_createDateWithOverflow(t,e,n){const r=new Date(t,e,n);return t>=0&&t<100&&r.setFullYear(this.getYear(r)-1900),r}_2digit(t){return("00"+t).slice(-2)}_stripDirectionalityCharacters(t){return t.replace(/[\u200e\u200f]/g,"")}_format(t,e){const n=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.format(n)}}const Uf={parse:{dateInput:null},display:{dateInput:{year:"numeric",month:"numeric",day:"numeric"},monthYearLabel:{year:"numeric",month:"short"},dateA11yLabel:{year:"numeric",month:"long",day:"numeric"},monthYearA11yLabel:{year:"numeric",month:"long"}}};class Vf{}class Wf{}let qf=(()=>{class t{isErrorState(t,e){return!!(t&&t.invalid&&(t.touched||e&&e.submitted))}}return t.ngInjectableDef=pt({factory:function(){return new t},token:t,providedIn:"root"}),t})();const Hf=new kt("MAT_HAMMER_OPTIONS"),Gf=["longpress","slide","slidestart","slideend","slideright","slideleft"],Yf={on:()=>{},off:()=>{}};class Kf extends class{constructor(){this.events=[],this.overrides={}}buildHammer(t){const e=new Hammer(t,this.options);e.get("pinch").set({enable:!0}),e.get("rotate").set({enable:!0});for(const n in this.overrides)e.get(n).set(this.overrides[n]);return e}}{constructor(t,e){super(),this._hammerOptions=t,this.events=Gf,e&&e._checkHammerIsAvailable()}buildHammer(t){const e="undefined"!=typeof window?window.Hammer:null;if(!e)return Yf;const n=new e(t,this._hammerOptions||void 0),r=new e.Pan,i=new e.Swipe,s=new e.Press,o=this._createRecognizer(r,{event:"slide",threshold:0},i),a=this._createRecognizer(s,{event:"longpress",time:500});return r.recognizeWith(i),a.recognizeWith(o),n.add([i,s,r,o,a]),n}_createRecognizer(t,e,...n){let r=new t.constructor(e);return n.push(t),n.forEach(t=>r.recognizeWith(t)),r}}class Xf{}const Zf=function(){var t={FADING_IN:0,VISIBLE:1,FADING_OUT:2,HIDDEN:3};return t[t.FADING_IN]="FADING_IN",t[t.VISIBLE]="VISIBLE",t[t.FADING_OUT]="FADING_OUT",t[t.HIDDEN]="HIDDEN",t}();class Qf{constructor(t,e,n){this._renderer=t,this.element=e,this.config=n,this.state=Zf.HIDDEN}fadeOut(){this._renderer.fadeOutRipple(this)}}const Jf={enterDuration:450,exitDuration:400},tp=nf({passive:!0});class ep{constructor(t,e,n,r){this._target=t,this._ngZone=e,this._isPointerDown=!1,this._triggerEvents=new Map,this._activeRipples=new Set,this._onMousedown=t=>{const e=function(t){return 0===t.buttons}(t),n=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;this._target.rippleDisabled||e||n||(this._isPointerDown=!0,this.fadeInRipple(t.clientX,t.clientY,this._target.rippleConfig))},this._onTouchStart=t=>{if(!this._target.rippleDisabled){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const e=t.changedTouches;for(let t=0;t<e.length;t++)this.fadeInRipple(e[t].clientX,e[t].clientY,this._target.rippleConfig)}},this._onPointerUp=()=>{this._isPointerDown&&(this._isPointerDown=!1,this._activeRipples.forEach(t=>{!t.config.persistent&&(t.state===Zf.VISIBLE||t.config.terminateOnPointerUp&&t.state===Zf.FADING_IN)&&t.fadeOut()}))},r.isBrowser&&(this._containerElement=Xd(n),this._triggerEvents.set("mousedown",this._onMousedown).set("mouseup",this._onPointerUp).set("mouseleave",this._onPointerUp).set("touchstart",this._onTouchStart).set("touchend",this._onPointerUp).set("touchcancel",this._onPointerUp))}fadeInRipple(t,e,n={}){const r=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),i=Object.assign({},Jf,n.animation);n.centered&&(t=r.left+r.width/2,e=r.top+r.height/2);const s=n.radius||function(t,e,n){const r=Math.max(Math.abs(t-n.left),Math.abs(t-n.right)),i=Math.max(Math.abs(e-n.top),Math.abs(e-n.bottom));return Math.sqrt(r*r+i*i)}(t,e,r),o=t-r.left,a=e-r.top,l=i.enterDuration,u=document.createElement("div");u.classList.add("mat-ripple-element"),u.style.left=o-s+"px",u.style.top=a-s+"px",u.style.height=2*s+"px",u.style.width=2*s+"px",u.style.backgroundColor=n.color||null,u.style.transitionDuration=l+"ms",this._containerElement.appendChild(u),window.getComputedStyle(u).getPropertyValue("opacity"),u.style.transform="scale(1)";const c=new Qf(this,u,n);return c.state=Zf.FADING_IN,this._activeRipples.add(c),n.persistent||(this._mostRecentTransientRipple=c),this._runTimeoutOutsideZone(()=>{const t=c===this._mostRecentTransientRipple;c.state=Zf.VISIBLE,n.persistent||t&&this._isPointerDown||c.fadeOut()},l),c}fadeOutRipple(t){const e=this._activeRipples.delete(t);if(t===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),this._activeRipples.size||(this._containerRect=null),!e)return;const n=t.element,r=Object.assign({},Jf,t.config.animation);n.style.transitionDuration=r.exitDuration+"ms",n.style.opacity="0",t.state=Zf.FADING_OUT,this._runTimeoutOutsideZone(()=>{t.state=Zf.HIDDEN,n.parentNode.removeChild(n)},r.exitDuration)}fadeOutAll(){this._activeRipples.forEach(t=>t.fadeOut())}setupTriggerEvents(t){const e=Xd(t);e&&e!==this._triggerElement&&(this._removeTriggerEvents(),this._ngZone.runOutsideAngular(()=>{this._triggerEvents.forEach((t,n)=>{e.addEventListener(n,t,tp)})}),this._triggerElement=e)}_runTimeoutOutsideZone(t,e=0){this._ngZone.runOutsideAngular(()=>setTimeout(t,e))}_removeTriggerEvents(){this._triggerElement&&this._triggerEvents.forEach((t,e)=>{this._triggerElement.removeEventListener(e,t,tp)})}}const np=new kt("mat-ripple-global-options");class rp{constructor(t,e,n,r,i){this._elementRef=t,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=r||{},this._rippleRenderer=new ep(this,e,t,n),"NoopAnimations"===i&&(this._globalOptions.animation={enterDuration:0,exitDuration:0})}get disabled(){return this._disabled}set disabled(t){this._disabled=t,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(t){this._trigger=t,this._setupTriggerEventsIfEnabled()}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:Object.assign({},this._globalOptions.animation,this.animation),terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(t,e=0,n){return"number"==typeof t?this._rippleRenderer.fadeInRipple(t,e,Object.assign({},this.rippleConfig,n)):this._rippleRenderer.fadeInRipple(0,0,Object.assign({},this.rippleConfig,t))}}class ip{}class sp{}class op{}function ap(){throw Error("Host already has a portal attached")}class lp{attach(t){return null==t&&function(){throw Error("Attempting to attach a portal to a null PortalOutlet")}(),t.hasAttached()&&ap(),this._attachedHost=t,t.attach(this)}detach(){let t=this._attachedHost;null==t?function(){throw Error("Attempting to detach a portal that is not attached to a host")}():(this._attachedHost=null,t.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(t){this._attachedHost=t}}class up extends lp{constructor(t,e,n,r){super(),this.component=t,this.viewContainerRef=e,this.injector=n,this.componentFactoryResolver=r}}class cp extends lp{constructor(t,e,n){super(),this.templateRef=t,this.viewContainerRef=e,this.context=n}get origin(){return this.templateRef.elementRef}attach(t,e=this.context){return this.context=e,super.attach(t)}detach(){return this.context=void 0,super.detach()}}class hp{constructor(){this._isDisposed=!1}hasAttached(){return!!this._attachedPortal}attach(t){return t||function(){throw Error("Must provide a portal to attach")}(),this.hasAttached()&&ap(),this._isDisposed&&function(){throw Error("This PortalOutlet has already been disposed")}(),t instanceof up?(this._attachedPortal=t,this.attachComponentPortal(t)):t instanceof cp?(this._attachedPortal=t,this.attachTemplatePortal(t)):void function(){throw Error("Attempting to attach an unknown Portal type. BasePortalOutlet accepts either a ComponentPortal or a TemplatePortal.")}()}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(t){this._disposeFn=t}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class dp extends hp{constructor(t,e,n,r){super(),this.outletElement=t,this._componentFactoryResolver=e,this._appRef=n,this._defaultInjector=r}attachComponentPortal(t){const e=(t.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(t.component);let n;return t.viewContainerRef?(n=t.viewContainerRef.createComponent(e,t.viewContainerRef.length,t.injector||t.viewContainerRef.injector),this.setDisposeFn(()=>n.destroy())):(n=e.create(t.injector||this._defaultInjector),this._appRef.attachView(n.hostView),this.setDisposeFn(()=>{this._appRef.detachView(n.hostView),n.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(n)),n}attachTemplatePortal(t){let e=t.viewContainerRef,n=e.createEmbeddedView(t.templateRef,t.context);return n.detectChanges(),n.rootNodes.forEach(t=>this.outletElement.appendChild(t)),this.setDisposeFn(()=>{let t=e.indexOf(n);-1!==t&&e.remove(t)}),n}dispose(){super.dispose(),null!=this.outletElement.parentNode&&this.outletElement.parentNode.removeChild(this.outletElement)}_getComponentRootNode(t){return t.hostView.rootNodes[0]}}class fp extends hp{constructor(t,e){super(),this._componentFactoryResolver=t,this._viewContainerRef=e,this._isInitialized=!1,this.attached=new vi}get portal(){return this._attachedPortal}set portal(t){(!this.hasAttached()||t||this._isInitialized)&&(this.hasAttached()&&super.detach(),t&&super.attach(t),this._attachedPortal=t)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedPortal=null,this._attachedRef=null}attachComponentPortal(t){t.setAttachedHost(this);const e=null!=t.viewContainerRef?t.viewContainerRef:this._viewContainerRef,n=(t.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(t.component),r=e.createComponent(n,e.length,t.injector||e.injector);return super.setDisposeFn(()=>r.destroy()),this._attachedPortal=t,this._attachedRef=r,this.attached.emit(r),r}attachTemplatePortal(t){t.setAttachedHost(this);const e=this._viewContainerRef.createEmbeddedView(t.templateRef,t.context);return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=t,this._attachedRef=e,this.attached.emit(e),e}}class pp{}class mp{constructor(t,e){this._parentInjector=t,this._customTokens=e}get(t,e){const n=this._customTokens.get(t);return void 0!==n?n:this._parentInjector.get(t,e)}}class gp{constructor(t){this.total=t}call(t,e){return e.subscribe(new yp(t,this.total))}}class yp extends m{constructor(t,e){super(t),this.total=e,this.count=0}_next(t){++this.count>this.total&&this.destination.next(t)}}function vp(t){return e=>e.lift(new bp(t))}class bp{constructor(t){this.notifier=t}call(t,e){const n=new xp(t),r=B(n,this.notifier);return r&&!n.seenValue?(n.add(r),e.subscribe(n)):n}}class xp extends j{constructor(t){super(t),this.seenValue=!1}notifyNext(t,e,n,r,i){this.seenValue=!0,this.complete()}notifyComplete(){}}const _p=new Set;let wp,Sp=(()=>{class t{constructor(t){this._platform=t,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):Cp}matchMedia(t){return this._platform.WEBKIT&&function(t){if(!_p.has(t))try{wp||(wp=document.createElement("style"),wp.setAttribute("type","text/css"),document.head.appendChild(wp)),wp.sheet&&(wp.sheet.insertRule(`@media ${t} {.fx-query-test{ }}`,0),_p.add(t))}catch(e){console.error(e)}}(t),this._matchMedia(t)}}return t.ngInjectableDef=pt({factory:function(){return new t(Rt(tf))},token:t,providedIn:"root"}),t})();function Cp(t){return{matches:"all"===t||""===t,media:t,addListener:()=>{},removeListener:()=>{}}}let Ep=(()=>{class t{constructor(t,e){this._mediaMatcher=t,this._zone=e,this._queries=new Map,this._destroySubject=new A}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(t){return kp(Yd(t)).some(t=>this._registerQuery(t).mql.matches)}observe(t){let e=Ha(kp(Yd(t)).map(t=>this._registerQuery(t).observable));return e=kl(e.pipe(yl(1)),e.pipe(t=>t.lift(new gp(1)),function(t,e=lf){return n=>n.lift(new uf(t,e))}(0))),e.pipe(U(t=>{const e={matches:!1,breakpoints:{}};return t.forEach(t=>{e.matches=e.matches||t.matches,e.breakpoints[t.query]=t.matches}),e}))}_registerQuery(t){if(this._queries.has(t))return this._queries.get(t);const e=this._mediaMatcher.matchMedia(t),n={observable:new _(t=>{const n=e=>this._zone.run(()=>t.next(e));return e.addListener(n),()=>{e.removeListener(n)}}).pipe(Al(e),U(e=>({query:t,matches:e.matches})),vp(this._destroySubject)),mql:e};return this._queries.set(t,n),n}}return t.ngInjectableDef=pt({factory:function(){return new t(Rt(Sp),Rt(Gi))},token:t,providedIn:"root"}),t})();function kp(t){return t.map(t=>t.split(",")).reduce((t,e)=>t.concat(e)).map(t=>t.trim())}function Ap(t,e,n,i){return r(n)&&(i=n,n=void 0),i?Ap(t,e,n).pipe(U(t=>l(t)?i(...t):i(t))):new _(r=>{!function t(e,n,r,i,s){let o;if(function(t){return t&&"function"==typeof t.addEventListener&&"function"==typeof t.removeEventListener}(e)){const t=e;e.addEventListener(n,r,s),o=()=>t.removeEventListener(n,r,s)}else if(function(t){return t&&"function"==typeof t.on&&"function"==typeof t.off}(e)){const t=e;e.on(n,r),o=()=>t.off(n,r)}else if(function(t){return t&&"function"==typeof t.addListener&&"function"==typeof t.removeListener}(e)){const t=e;e.addListener(n,r),o=()=>t.removeListener(n,r)}else{if(!e||!e.length)throw new TypeError("Invalid event target");for(let o=0,a=e.length;o<a;o++)t(e[o],n,r,i,s)}i.add(o)}(t,e,(function(t){r.next(arguments.length>1?Array.prototype.slice.call(arguments):t)}),r,n)})}class Dp extends sf{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,n=0){return null!==n&&n>0?super.requestAsyncId(t,e,n):(t.actions.push(this),t.scheduled||(t.scheduled=requestAnimationFrame(()=>t.flush(null))))}recycleAsyncId(t,e,n=0){if(null!==n&&n>0||null===n&&this.delay>0)return super.recycleAsyncId(t,e,n);0===t.actions.length&&(cancelAnimationFrame(e),t.scheduled=void 0)}}class Np extends af{flush(t){this.active=!0,this.scheduled=void 0;const{actions:e}=this;let n,r=-1,i=e.length;t=t||e.shift();do{if(n=t.execute(t.state,t.delay))break}while(++r<i&&(t=e.shift()));if(this.active=!1,n){for(;++r<i&&(t=e.shift());)t.unsubscribe();throw n}}}const Tp=new Np(Dp);class Op{constructor(t){this.durationSelector=t}call(t,e){return e.subscribe(new Ip(t,this.durationSelector))}}class Ip extends j{constructor(t,e){super(t),this.durationSelector=e,this.hasValue=!1}_next(t){if(this.value=t,this.hasValue=!0,!this.throttled){let n;try{const{durationSelector:e}=this;n=e(t)}catch(e){return this.destination.error(e)}const r=B(this,n);!r||r.closed?this.clearThrottle():this.add(this.throttled=r)}}clearThrottle(){const{value:t,hasValue:e,throttled:n}=this;n&&(this.remove(n),this.throttled=null,n.unsubscribe()),e&&(this.value=null,this.hasValue=!1,this.destination.next(t))}notifyNext(t,e,n,r){this.clearThrottle()}notifyComplete(){this.clearThrottle()}}function Rp(t){return!l(t)&&t-parseFloat(t)+1>=0}function Fp(t){const{index:e,period:n,subscriber:r}=t;if(r.next(e),!r.closed){if(-1===n)return r.complete();t.index=e+1,this.schedule(t,n)}}function Mp(t,e=lf){return n=()=>function(t=0,e,n){let r=-1;return Rp(e)?r=Number(e)<1?1:Number(e):N(e)&&(n=e),N(n)||(n=lf),new _(e=>{const i=Rp(t)?t:+t-n.now();return n.schedule(Fp,i,{index:0,period:r,subscriber:e})})}(t,e),function(t){return t.lift(new Op(n))};var n}let $p=(()=>{class t{constructor(t,e){this._ngZone=t,this._platform=e,this._scrolled=new A,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map}register(t){this.scrollContainers.has(t)||this.scrollContainers.set(t,t.elementScrolled().subscribe(()=>this._scrolled.next(t)))}deregister(t){const e=this.scrollContainers.get(t);e&&(e.unsubscribe(),this.scrollContainers.delete(t))}scrolled(t=20){return this._platform.isBrowser?new _(e=>{this._globalSubscription||this._addGlobalListener();const n=t>0?this._scrolled.pipe(Mp(t)).subscribe(e):this._scrolled.subscribe(e);return this._scrolledCount++,()=>{n.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):ja()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((t,e)=>this.deregister(e)),this._scrolled.complete()}ancestorScrolled(t,e){const n=this.getAncestorScrollContainers(t);return this.scrolled(e).pipe(Za(t=>!t||n.indexOf(t)>-1))}getAncestorScrollContainers(t){const e=[];return this.scrollContainers.forEach((n,r)=>{this._scrollableContainsElement(r,t)&&e.push(r)}),e}_scrollableContainsElement(t,e){let n=e.nativeElement,r=t.getElementRef().nativeElement;do{if(n==r)return!0}while(n=n.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>Ap(window.document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return t.ngInjectableDef=pt({factory:function(){return new t(Rt(Gi),Rt(tf))},token:t,providedIn:"root"}),t})();class Pp{}let zp=(()=>{class t{constructor(t,e){this._platform=t,e.runOutsideAngular(()=>{this._change=t.isBrowser?Q(Ap(window,"resize"),Ap(window,"orientationchange")):ja(),this._invalidateCache=this.change().subscribe(()=>this._updateViewportSize())})}ngOnDestroy(){this._invalidateCache.unsubscribe()}getViewportSize(){this._viewportSize||this._updateViewportSize();const t={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),t}getViewportRect(){const t=this.getViewportScrollPosition(),{width:e,height:n}=this.getViewportSize();return{top:t.top,left:t.left,bottom:t.top+n,right:t.left+e,height:n,width:e}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const t=document.documentElement,e=t.getBoundingClientRect();return{top:-e.top||document.body.scrollTop||window.scrollY||t.scrollTop||0,left:-e.left||document.body.scrollLeft||window.scrollX||t.scrollLeft||0}}change(t=20){return t>0?this._change.pipe(Mp(t)):this._change}_updateViewportSize(){this._viewportSize=this._platform.isBrowser?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0}}}return t.ngInjectableDef=pt({factory:function(){return new t(Rt(tf),Rt(Gi))},token:t,providedIn:"root"}),t})();class Lp{constructor(t,e){this._viewportRuler=t,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=e}attach(){}enable(){if(this._canBeEnabled()){const t=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=t.style.left||"",this._previousHTMLStyles.top=t.style.top||"",t.style.left=Kd(-this._previousScrollPosition.left),t.style.top=Kd(-this._previousScrollPosition.top),t.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const t=this._document.documentElement,e=t.style,n=this._document.body.style,r=e.scrollBehavior||"",i=n.scrollBehavior||"";this._isEnabled=!1,e.left=this._previousHTMLStyles.left,e.top=this._previousHTMLStyles.top,t.classList.remove("cdk-global-scrollblock"),e.scrollBehavior=n.scrollBehavior="auto",window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),e.scrollBehavior=r,n.scrollBehavior=i}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const t=this._document.body,e=this._viewportRuler.getViewportSize();return t.scrollHeight>e.height||t.scrollWidth>e.width}}function Bp(){return Error("Scroll strategy has already been attached.")}class jp{constructor(t,e,n,r){this._scrollDispatcher=t,this._ngZone=e,this._viewportRuler=n,this._config=r,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(t){if(this._overlayRef)throw Bp();this._overlayRef=t}enable(){if(this._scrollSubscription)return;const t=this._scrollDispatcher.scrolled(0);this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=t.subscribe(()=>{const t=this._viewportRuler.getViewportScrollPosition().top;Math.abs(t-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=t.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class Up{enable(){}disable(){}attach(){}}function Vp(t,e){return e.some(e=>t.bottom<e.top||t.top>e.bottom||t.right<e.left||t.left>e.right)}function Wp(t,e){return e.some(e=>t.top<e.top||t.bottom>e.bottom||t.left<e.left||t.right>e.right)}class qp{constructor(t,e,n,r){this._scrollDispatcher=t,this._viewportRuler=e,this._ngZone=n,this._config=r,this._scrollSubscription=null}attach(t){if(this._overlayRef)throw Bp();this._overlayRef=t}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const t=this._overlayRef.overlayElement.getBoundingClientRect(),{width:e,height:n}=this._viewportRuler.getViewportSize();Vp(t,[{width:e,height:n,bottom:n,right:e,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let Hp=(()=>{class t{constructor(t,e,n,r){this._scrollDispatcher=t,this._viewportRuler=e,this._ngZone=n,this.noop=()=>new Up,this.close=t=>new jp(this._scrollDispatcher,this._ngZone,this._viewportRuler,t),this.block=()=>new Lp(this._viewportRuler,this._document),this.reposition=t=>new qp(this._scrollDispatcher,this._viewportRuler,this._ngZone,t),this._document=r}}return t.ngInjectableDef=pt({factory:function(){return new t(Rt($p),Rt(zp),Rt(Gi),Rt(Ra))},token:t,providedIn:"root"}),t})();class Gp{constructor(t){if(this.scrollStrategy=new Up,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,t){const e=Object.keys(t);for(const n of e)void 0!==t[n]&&(this[n]=t[n])}}}class Yp{constructor(t,e,n,r,i){this.offsetX=n,this.offsetY=r,this.panelClass=i,this.originX=t.originX,this.originY=t.originY,this.overlayX=e.overlayX,this.overlayY=e.overlayY}}class Kp{constructor(t,e){this.connectionPair=t,this.scrollableViewProperties=e}}function Xp(t,e){if("top"!==e&&"bottom"!==e&&"center"!==e)throw Error(`ConnectedPosition: Invalid ${t} "${e}". Expected "top", "bottom" or "center".`)}function Zp(t,e){if("start"!==e&&"end"!==e&&"center"!==e)throw Error(`ConnectedPosition: Invalid ${t} "${e}". Expected "start", "end" or "center".`)}let Qp=(()=>{class t{constructor(t){this._attachedOverlays=[],this._keydownListener=t=>{const e=this._attachedOverlays;for(let n=e.length-1;n>-1;n--)if(e[n]._keydownEventSubscriptions>0){e[n]._keydownEvents.next(t);break}},this._document=t}ngOnDestroy(){this._detach()}add(t){this.remove(t),this._isAttached||(this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0),this._attachedOverlays.push(t)}remove(t){const e=this._attachedOverlays.indexOf(t);e>-1&&this._attachedOverlays.splice(e,1),0===this._attachedOverlays.length&&this._detach()}_detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return t.ngInjectableDef=pt({factory:function(){return new t(Rt(Ra))},token:t,providedIn:"root"}),t})(),Jp=(()=>{class t{constructor(t){this._document=t}ngOnDestroy(){this._containerElement&&this._containerElement.parentNode&&this._containerElement.parentNode.removeChild(this._containerElement)}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const t=this._document.getElementsByClassName("cdk-overlay-container");for(let n=0;n<t.length;n++)t[n].parentNode.removeChild(t[n]);const e=this._document.createElement("div");e.classList.add("cdk-overlay-container"),this._document.body.appendChild(e),this._containerElement=e}}return t.ngInjectableDef=pt({factory:function(){return new t(Rt(Ra))},token:t,providedIn:"root"}),t})();class tm{constructor(t,e,n,r,i,s,o,a){this._portalOutlet=t,this._host=e,this._pane=n,this._config=r,this._ngZone=i,this._keyboardDispatcher=s,this._document=o,this._location=a,this._backdropElement=null,this._backdropClick=new A,this._attachments=new A,this._detachments=new A,this._locationChanges=d.EMPTY,this._backdropClickHandler=t=>this._backdropClick.next(t),this._keydownEventsObservable=new _(t=>{const e=this._keydownEvents.subscribe(t);return this._keydownEventSubscriptions++,()=>{e.unsubscribe(),this._keydownEventSubscriptions--}}),this._keydownEvents=new A,this._keydownEventSubscriptions=0,r.scrollStrategy&&(this._scrollStrategy=r.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=r.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(t){let e=this._portalOutlet.attach(t);return this._positionStrategy&&this._positionStrategy.attach(this),!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.asObservable().pipe(yl(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&this._location&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),e}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const t=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),t}dispose(){const t=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this.detachBackdrop(),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._host&&this._host.parentNode&&(this._host.parentNode.removeChild(this._host),this._host=null),this._previousHostParent=this._pane=null,t&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick.asObservable()}attachments(){return this._attachments.asObservable()}detachments(){return this._detachments.asObservable()}keydownEvents(){return this._keydownEventsObservable}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(t){t!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=t,this.hasAttached()&&(t.attach(this),this.updatePosition()))}updateSize(t){this._config=Object.assign({},this._config,t),this._updateElementSize()}setDirection(t){this._config=Object.assign({},this._config,{direction:t}),this._updateElementDirection()}addPanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!0)}removePanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!1)}getDirection(){const t=this._config.direction;return t?"string"==typeof t?t:t.value:"ltr"}updateScrollStrategy(t){t!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=t,this.hasAttached()&&(t.attach(this),t.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const t=this._pane.style;t.width=Kd(this._config.width),t.height=Kd(this._config.height),t.minWidth=Kd(this._config.minWidth),t.minHeight=Kd(this._config.minHeight),t.maxWidth=Kd(this._config.maxWidth),t.maxHeight=Kd(this._config.maxHeight)}_togglePointerEvents(t){this._pane.style.pointerEvents=t?"auto":"none"}_attachBackdrop(){this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),"undefined"!=typeof requestAnimationFrame?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add("cdk-overlay-backdrop-showing")})}):this._backdropElement.classList.add("cdk-overlay-backdrop-showing")}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){let t,e=this._backdropElement;if(!e)return;let n=()=>{e&&(e.removeEventListener("click",this._backdropClickHandler),e.removeEventListener("transitionend",n),e.parentNode&&e.parentNode.removeChild(e)),this._backdropElement==e&&(this._backdropElement=null),this._config.backdropClass&&this._toggleClasses(e,this._config.backdropClass,!1),clearTimeout(t)};e.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{e.addEventListener("transitionend",n)}),e.style.pointerEvents="none",t=this._ngZone.runOutsideAngular(()=>setTimeout(n,500))}_toggleClasses(t,e,n){const r=t.classList;Yd(e).forEach(t=>{t&&(n?r.add(t):r.remove(t))})}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const t=this._ngZone.onStable.asObservable().pipe(vp(Q(this._attachments,this._detachments))).subscribe(()=>{this._pane&&this._host&&0!==this._pane.children.length||(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._previousHostParent.removeChild(this._host)),t.unsubscribe())})})}_disposeScrollStrategy(){const t=this._scrollStrategy;t&&(t.disable(),t.detach&&t.detach())}}class em{constructor(t,e,n,r,i){this._viewportRuler=e,this._document=n,this._platform=r,this._overlayContainer=i,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new A,this._resizeSubscription=d.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges.asObservable(),this.setOrigin(t)}get positions(){return this._preferredPositions}attach(t){if(this._overlayRef&&t!==this._overlayRef)throw Error("This position strategy is already attached to an overlay");this._validatePositions(),t.hostElement.classList.add("cdk-overlay-connected-position-bounding-box"),this._overlayRef=t,this._boundingBox=t.hostElement,this._pane=t.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect();const t=this._originRect,e=this._overlayRect,n=this._viewportRect,r=[];let i;for(let s of this._preferredPositions){let o=this._getOriginPoint(t,s),a=this._getOverlayPoint(o,e,s),l=this._getOverlayFit(a,e,n,s);if(l.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(s,o);this._canFitWithFlexibleDimensions(l,a,n)?r.push({position:s,origin:o,overlayRect:e,boundingBoxRect:this._calculateBoundingBoxRect(o,s)}):(!i||i.overlayFit.visibleArea<l.visibleArea)&&(i={overlayFit:l,overlayPoint:a,originPoint:o,position:s,overlayRect:e})}if(r.length){let t=null,e=-1;for(const n of r){const r=n.boundingBoxRect.width*n.boundingBoxRect.height*(n.position.weight||1);r>e&&(e=r,t=n)}return this._isPushed=!1,void this._applyPosition(t.position,t.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(i.position,i.originPoint);this._applyPosition(i.position,i.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&nm(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove("cdk-overlay-connected-position-bounding-box"),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(!this._isDisposed&&(!this._platform||this._platform.isBrowser)){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect();const t=this._lastPosition||this._preferredPositions[0],e=this._getOriginPoint(this._originRect,t);this._applyPosition(t,e)}}withScrollableContainers(t){return this._scrollables=t,this}withPositions(t){return this._preferredPositions=t,-1===t.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(t){return this._viewportMargin=t,this}withFlexibleDimensions(t=!0){return this._hasFlexibleDimensions=t,this}withGrowAfterOpen(t=!0){return this._growAfterOpen=t,this}withPush(t=!0){return this._canPush=t,this}withLockedPosition(t=!0){return this._positionLocked=t,this}setOrigin(t){return this._origin=t,this}withDefaultOffsetX(t){return this._offsetX=t,this}withDefaultOffsetY(t){return this._offsetY=t,this}withTransformOriginOn(t){return this._transformOriginSelector=t,this}_getOriginPoint(t,e){let n,r;if("center"==e.originX)n=t.left+t.width/2;else{const r=this._isRtl()?t.right:t.left,i=this._isRtl()?t.left:t.right;n="start"==e.originX?r:i}return r="center"==e.originY?t.top+t.height/2:"top"==e.originY?t.top:t.bottom,{x:n,y:r}}_getOverlayPoint(t,e,n){let r,i;return r="center"==n.overlayX?-e.width/2:"start"===n.overlayX?this._isRtl()?-e.width:0:this._isRtl()?0:-e.width,i="center"==n.overlayY?-e.height/2:"top"==n.overlayY?0:-e.height,{x:t.x+r,y:t.y+i}}_getOverlayFit(t,e,n,r){let{x:i,y:s}=t,o=this._getOffset(r,"x"),a=this._getOffset(r,"y");o&&(i+=o),a&&(s+=a);let l=0-s,u=s+e.height-n.height,c=this._subtractOverflows(e.width,0-i,i+e.width-n.width),h=this._subtractOverflows(e.height,l,u),d=c*h;return{visibleArea:d,isCompletelyWithinViewport:e.width*e.height===d,fitsInViewportVertically:h===e.height,fitsInViewportHorizontally:c==e.width}}_canFitWithFlexibleDimensions(t,e,n){if(this._hasFlexibleDimensions){const r=n.bottom-e.y,i=n.right-e.x,s=this._overlayRef.getConfig().minHeight,o=this._overlayRef.getConfig().minWidth,a=t.fitsInViewportHorizontally||null!=o&&o<=i;return(t.fitsInViewportVertically||null!=s&&s<=r)&&a}return!1}_pushOverlayOnScreen(t,e,n){if(this._previousPushAmount&&this._positionLocked)return{x:t.x+this._previousPushAmount.x,y:t.y+this._previousPushAmount.y};const r=this._viewportRect,i=Math.max(t.x+e.width-r.right,0),s=Math.max(t.y+e.height-r.bottom,0),o=Math.max(r.top-n.top-t.y,0),a=Math.max(r.left-n.left-t.x,0);let l=0,u=0;return l=e.width<=r.width?a||-i:t.x<this._viewportMargin?r.left-n.left-t.x:0,u=e.height<=r.height?o||-s:t.y<this._viewportMargin?r.top-n.top-t.y:0,this._previousPushAmount={x:l,y:u},{x:t.x+l,y:t.y+u}}_applyPosition(t,e){if(this._setTransformOrigin(t),this._setOverlayElementStyles(e,t),this._setBoundingBoxStyles(e,t),t.panelClass&&this._addPanelClasses(t.panelClass),this._lastPosition=t,this._positionChanges.observers.length){const e=this._getScrollVisibility(),n=new Kp(t,e);this._positionChanges.next(n)}this._isInitialRender=!1}_setTransformOrigin(t){if(!this._transformOriginSelector)return;const e=this._boundingBox.querySelectorAll(this._transformOriginSelector);let n,r=t.overlayY;n="center"===t.overlayX?"center":this._isRtl()?"start"===t.overlayX?"right":"left":"start"===t.overlayX?"left":"right";for(let i=0;i<e.length;i++)e[i].style.transformOrigin=`${n} ${r}`}_calculateBoundingBoxRect(t,e){const n=this._viewportRect,r=this._isRtl();let i,s,o,a,l,u;if("top"===e.overlayY)s=t.y,i=n.height-s+this._viewportMargin;else if("bottom"===e.overlayY)o=n.height-t.y+2*this._viewportMargin,i=n.height-o+this._viewportMargin;else{const e=Math.min(n.bottom-t.y+n.top,t.y),r=this._lastBoundingBoxSize.height;i=2*e,s=t.y-e,i>r&&!this._isInitialRender&&!this._growAfterOpen&&(s=t.y-r/2)}if("end"===e.overlayX&&!r||"start"===e.overlayX&&r)u=n.width-t.x+this._viewportMargin,a=t.x-this._viewportMargin;else if("start"===e.overlayX&&!r||"end"===e.overlayX&&r)l=t.x,a=n.right-t.x;else{const e=Math.min(n.right-t.x+n.left,t.x),r=this._lastBoundingBoxSize.width;a=2*e,l=t.x-e,a>r&&!this._isInitialRender&&!this._growAfterOpen&&(l=t.x-r/2)}return{top:s,left:l,bottom:o,right:u,width:a,height:i}}_setBoundingBoxStyles(t,e){const n=this._calculateBoundingBoxRect(t,e);this._isInitialRender||this._growAfterOpen||(n.height=Math.min(n.height,this._lastBoundingBoxSize.height),n.width=Math.min(n.width,this._lastBoundingBoxSize.width));const r={};if(this._hasExactPosition())r.top=r.left="0",r.bottom=r.right="",r.width=r.height="100%";else{const t=this._overlayRef.getConfig().maxHeight,i=this._overlayRef.getConfig().maxWidth;r.height=Kd(n.height),r.top=Kd(n.top),r.bottom=Kd(n.bottom),r.width=Kd(n.width),r.left=Kd(n.left),r.right=Kd(n.right),r.alignItems="center"===e.overlayX?"center":"end"===e.overlayX?"flex-end":"flex-start",r.justifyContent="center"===e.overlayY?"center":"bottom"===e.overlayY?"flex-end":"flex-start",t&&(r.maxHeight=Kd(t)),i&&(r.maxWidth=Kd(i))}this._lastBoundingBoxSize=n,nm(this._boundingBox.style,r)}_resetBoundingBoxStyles(){nm(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){nm(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(t,e){const n={};if(this._hasExactPosition()){const r=this._viewportRuler.getViewportScrollPosition();nm(n,this._getExactOverlayY(e,t,r)),nm(n,this._getExactOverlayX(e,t,r))}else n.position="static";let r="",i=this._getOffset(e,"x"),s=this._getOffset(e,"y");i&&(r+=`translateX(${i}px) `),s&&(r+=`translateY(${s}px)`),n.transform=r.trim(),this._hasFlexibleDimensions&&this._overlayRef.getConfig().maxHeight&&(n.maxHeight=""),this._hasFlexibleDimensions&&this._overlayRef.getConfig().maxWidth&&(n.maxWidth=""),nm(this._pane.style,n)}_getExactOverlayY(t,e,n){let r={top:null,bottom:null},i=this._getOverlayPoint(e,this._overlayRect,t);this._isPushed&&(i=this._pushOverlayOnScreen(i,this._overlayRect,n));let s=this._overlayContainer.getContainerElement().getBoundingClientRect().top;return i.y-=s,"bottom"===t.overlayY?r.bottom=this._document.documentElement.clientHeight-(i.y+this._overlayRect.height)+"px":r.top=Kd(i.y),r}_getExactOverlayX(t,e,n){let r,i={left:null,right:null},s=this._getOverlayPoint(e,this._overlayRect,t);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,n)),r=this._isRtl()?"end"===t.overlayX?"left":"right":"end"===t.overlayX?"right":"left","right"===r?i.right=this._document.documentElement.clientWidth-(s.x+this._overlayRect.width)+"px":i.left=Kd(s.x),i}_getScrollVisibility(){const t=this._getOriginRect(),e=this._pane.getBoundingClientRect(),n=this._scrollables.map(t=>t.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:Wp(t,n),isOriginOutsideView:Vp(t,n),isOverlayClipped:Wp(e,n),isOverlayOutsideView:Vp(e,n)}}_subtractOverflows(t,...e){return e.reduce((t,e)=>t-Math.max(e,0),t)}_getNarrowedViewportRect(){const t=this._document.documentElement.clientWidth,e=this._document.documentElement.clientHeight,n=this._viewportRuler.getViewportScrollPosition();return{top:n.top+this._viewportMargin,left:n.left+this._viewportMargin,right:n.left+t-this._viewportMargin,bottom:n.top+e-this._viewportMargin,width:t-2*this._viewportMargin,height:e-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(t,e){return"x"===e?null==t.offsetX?this._offsetX:t.offsetX:null==t.offsetY?this._offsetY:t.offsetY}_validatePositions(){if(!this._preferredPositions.length)throw Error("FlexibleConnectedPositionStrategy: At least one position is required.");this._preferredPositions.forEach(t=>{Zp("originX",t.originX),Xp("originY",t.originY),Zp("overlayX",t.overlayX),Xp("overlayY",t.overlayY)})}_addPanelClasses(t){this._pane&&Yd(t).forEach(t=>{""!==t&&-1===this._appliedPanelClasses.indexOf(t)&&(this._appliedPanelClasses.push(t),this._pane.classList.add(t))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(t=>{this._pane.classList.remove(t)}),this._appliedPanelClasses=[])}_getOriginRect(){const t=this._origin;if(t instanceof tn)return t.nativeElement.getBoundingClientRect();if(t instanceof HTMLElement)return t.getBoundingClientRect();const e=t.width||0,n=t.height||0;return{top:t.y,bottom:t.y+n,left:t.x,right:t.x+e,height:n,width:e}}}function nm(t,e){for(let n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}class rm{constructor(t,e,n,r,i,s,o){this._preferredPositions=[],this._positionStrategy=new em(n,r,i,s,o).withFlexibleDimensions(!1).withPush(!1).withViewportMargin(0),this.withFallbackPosition(t,e)}get _isRtl(){return"rtl"===this._overlayRef.getDirection()}get onPositionChange(){return this._positionStrategy.positionChanges}get positions(){return this._preferredPositions}attach(t){this._overlayRef=t,this._positionStrategy.attach(t),this._direction&&(t.setDirection(this._direction),this._direction=null)}dispose(){this._positionStrategy.dispose()}detach(){this._positionStrategy.detach()}apply(){this._positionStrategy.apply()}recalculateLastPosition(){this._positionStrategy.reapplyLastPosition()}withScrollableContainers(t){this._positionStrategy.withScrollableContainers(t)}withFallbackPosition(t,e,n,r){const i=new Yp(t,e,n,r);return this._preferredPositions.push(i),this._positionStrategy.withPositions(this._preferredPositions),this}withDirection(t){return this._overlayRef?this._overlayRef.setDirection(t):this._direction=t,this}withOffsetX(t){return this._positionStrategy.withDefaultOffsetX(t),this}withOffsetY(t){return this._positionStrategy.withDefaultOffsetY(t),this}withLockedPosition(t){return this._positionStrategy.withLockedPosition(t),this}withPositions(t){return this._preferredPositions=t.slice(),this._positionStrategy.withPositions(this._preferredPositions),this}setOrigin(t){return this._positionStrategy.setOrigin(t),this}}class im{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._leftOffset="",this._rightOffset="",this._alignItems="",this._justifyContent="",this._width="",this._height=""}attach(t){const e=t.getConfig();this._overlayRef=t,this._width&&!e.width&&t.updateSize({width:this._width}),this._height&&!e.height&&t.updateSize({height:this._height}),t.hostElement.classList.add("cdk-global-overlay-wrapper"),this._isDisposed=!1}top(t=""){return this._bottomOffset="",this._topOffset=t,this._alignItems="flex-start",this}left(t=""){return this._rightOffset="",this._leftOffset=t,this._justifyContent="flex-start",this}bottom(t=""){return this._topOffset="",this._bottomOffset=t,this._alignItems="flex-end",this}right(t=""){return this._leftOffset="",this._rightOffset=t,this._justifyContent="flex-end",this}width(t=""){return this._overlayRef?this._overlayRef.updateSize({width:t}):this._width=t,this}height(t=""){return this._overlayRef?this._overlayRef.updateSize({height:t}):this._height=t,this}centerHorizontally(t=""){return this.left(t),this._justifyContent="center",this}centerVertically(t=""){return this.top(t),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement.style,n=this._overlayRef.getConfig();t.position=this._cssPosition,t.marginLeft="100%"===n.width?"0":this._leftOffset,t.marginTop="100%"===n.height?"0":this._topOffset,t.marginBottom=this._bottomOffset,t.marginRight=this._rightOffset,"100%"===n.width?e.justifyContent="flex-start":"center"===this._justifyContent?e.justifyContent="center":"rtl"===this._overlayRef.getConfig().direction?"flex-start"===this._justifyContent?e.justifyContent="flex-end":"flex-end"===this._justifyContent&&(e.justifyContent="flex-start"):e.justifyContent=this._justifyContent,e.alignItems="100%"===n.height?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement,n=e.style;e.classList.remove("cdk-global-overlay-wrapper"),n.justifyContent=n.alignItems=t.marginTop=t.marginBottom=t.marginLeft=t.marginRight=t.position="",this._overlayRef=null,this._isDisposed=!0}}let sm=(()=>{class t{constructor(t,e,n,r){this._viewportRuler=t,this._document=e,this._platform=n,this._overlayContainer=r}global(){return new im}connectedTo(t,e,n){return new rm(e,n,t,this._viewportRuler,this._document,this._platform,this._overlayContainer)}flexibleConnectedTo(t){return new em(t,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return t.ngInjectableDef=pt({factory:function(){return new t(Rt(zp),Rt(Ra),Rt(tf),Rt(Jp))},token:t,providedIn:"root"}),t})(),om=0;class am{constructor(t,e,n,r,i,s,o,a,l,u){this.scrollStrategies=t,this._overlayContainer=e,this._componentFactoryResolver=n,this._positionBuilder=r,this._keyboardDispatcher=i,this._injector=s,this._ngZone=o,this._document=a,this._directionality=l,this._location=u}create(t){const e=this._createHostElement(),n=this._createPaneElement(e),r=this._createPortalOutlet(n),i=new Gp(t);return i.direction=i.direction||this._directionality.value,new tm(r,e,n,i,this._ngZone,this._keyboardDispatcher,this._document,this._location)}position(){return this._positionBuilder}_createPaneElement(t){const e=this._document.createElement("div");return e.id="cdk-overlay-"+om++,e.classList.add("cdk-overlay-pane"),t.appendChild(e),e}_createHostElement(){const t=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(t),t}_createPortalOutlet(t){return this._appRef||(this._appRef=this._injector.get(hs)),new dp(t,this._componentFactoryResolver,this._appRef,this._injector)}}const lm=new kt("cdk-connected-overlay-scroll-strategy");function um(t){return()=>t.scrollStrategies.reposition()}class cm{}const hm=new kt("cdk-dir-doc",{providedIn:"root",factory:function(){return Ft(Ra)}});let dm=(()=>{class t{constructor(t){if(this.value="ltr",this.change=new vi,t){const e=t.documentElement?t.documentElement.dir:null,n=(t.body?t.body.dir:null)||e;this.value="ltr"===n||"rtl"===n?n:"ltr"}}ngOnDestroy(){this.change.complete()}}return t.ngInjectableDef=pt({factory:function(){return new t(Rt(hm,8))},token:t,providedIn:"root"}),t})();class fm{}class pm{constructor(){this.data=null,this.hasBackdrop=!0,this.disableClose=!1,this.ariaLabel=null,this.closeOnNavigation=!0,this.autoFocus=!1,this.restoreFocus=!0}}class mm extends hp{constructor(t,e,n,r,i,s){super(),this._elementRef=t,this._changeDetectorRef=e,this._focusTrapFactory=n,this.bottomSheetConfig=s,this._animationState="void",this._animationStateChanged=new vi,this._elementFocusedBeforeOpened=null,this._document=i,this._breakpointSubscription=r.observe(["(min-width: 960px) and (max-width: 1279.99px)","(min-width: 1280px) and (max-width: 1919.99px)","(min-width: 1920px)"]).subscribe(()=>{this._toggleClass("mat-bottom-sheet-container-medium",r.isMatched("(min-width: 960px) and (max-width: 1279.99px)")),this._toggleClass("mat-bottom-sheet-container-large",r.isMatched("(min-width: 1280px) and (max-width: 1919.99px)")),this._toggleClass("mat-bottom-sheet-container-xlarge",r.isMatched("(min-width: 1920px)"))})}attachComponentPortal(t){return this._validatePortalAttached(),this._setPanelClass(),this._savePreviouslyFocusedElement(),this._portalOutlet.attachComponentPortal(t)}attachTemplatePortal(t){return this._validatePortalAttached(),this._setPanelClass(),this._savePreviouslyFocusedElement(),this._portalOutlet.attachTemplatePortal(t)}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.detectChanges())}exit(){this._destroyed||(this._animationState="hidden",this._changeDetectorRef.markForCheck())}ngOnDestroy(){this._breakpointSubscription.unsubscribe(),this._destroyed=!0}_onAnimationDone(t){"hidden"===t.toState?this._restoreFocus():"visible"===t.toState&&this._trapFocus(),this._animationStateChanged.emit(t)}_onAnimationStart(t){this._animationStateChanged.emit(t)}_toggleClass(t,e){const n=this._elementRef.nativeElement.classList;e?n.add(t):n.remove(t)}_validatePortalAttached(){if(this._portalOutlet.hasAttached())throw Error("Attempting to attach bottom sheet content after content is already attached")}_setPanelClass(){const t=this._elementRef.nativeElement,e=this.bottomSheetConfig.panelClass;Array.isArray(e)?e.forEach(e=>t.classList.add(e)):e&&t.classList.add(e)}_trapFocus(){const t=this._elementRef.nativeElement;if(this._focusTrap||(this._focusTrap=this._focusTrapFactory.create(t)),this.bottomSheetConfig.autoFocus)this._focusTrap.focusInitialElementWhenReady();else{const e=this._document.activeElement;e===t||t.contains(e)||t.focus()}}_restoreFocus(){const t=this._elementFocusedBeforeOpened;this.bottomSheetConfig.restoreFocus&&t&&"function"==typeof t.focus&&t.focus(),this._focusTrap&&this._focusTrap.destroy()}_savePreviouslyFocusedElement(){this._elementFocusedBeforeOpened=this._document.activeElement,this._elementRef.nativeElement.focus&&Promise.resolve().then(()=>this._elementRef.nativeElement.focus())}}class gm{}var ym=Vn({encapsulation:2,styles:[".mat-bottom-sheet-container{padding:8px 16px;min-width:100vw;box-sizing:border-box;display:block;outline:0;max-height:80vh;overflow:auto}@media (-ms-high-contrast:active){.mat-bottom-sheet-container{outline:1px solid}}.mat-bottom-sheet-container-large,.mat-bottom-sheet-container-medium,.mat-bottom-sheet-container-xlarge{border-top-left-radius:4px;border-top-right-radius:4px}.mat-bottom-sheet-container-medium{min-width:384px;max-width:calc(100vw - 128px)}.mat-bottom-sheet-container-large{min-width:512px;max-width:calc(100vw - 256px)}.mat-bottom-sheet-container-xlarge{min-width:576px;max-width:calc(100vw - 384px)}"],data:{animation:[{type:7,name:"state",definitions:[{type:0,name:"void, hidden",styles:{type:6,styles:{transform:"translateY(100%)"},offset:null},options:void 0},{type:0,name:"visible",styles:{type:6,styles:{transform:"translateY(0%)"},offset:null},options:void 0},{type:1,expr:"visible => void, visible => hidden",animation:{type:4,styles:null,timings:"375ms cubic-bezier(0.4,0.0,1,1)"},options:null},{type:1,expr:"void => visible",animation:{type:4,styles:null,timings:"195ms cubic-bezier(0.0,0.0,0.2,1)"},options:null}],options:{}}]}});function vm(t){return Hs(0,[(t()(),Ts(0,null,null,0))],null,null)}function bm(t){return Hs(2,[$s(402653184,1,{_portalOutlet:0}),(t()(),Ts(16777216,null,null,1,null,vm)),Zr(2,212992,[[1,4]],0,fp,[Xe,An],{portal:[0,"portal"]},null)],(function(t,e){t(e,2,0,"")}),null)}function xm(t){return Hs(0,[(t()(),Os(0,0,null,null,1,"mat-bottom-sheet-container",[["aria-modal","true"],["class","mat-bottom-sheet-container"],["role","dialog"],["tabindex","-1"]],[[1,"aria-label",0],[40,"@state",0]],[["component","@state.start"],["component","@state.done"]],(function(t,e,n){var r=!0;return"component:@state.start"===e&&(r=!1!==zr(t,1)._onAnimationStart(n)&&r),"component:@state.done"===e&&(r=!1!==zr(t,1)._onAnimationDone(n)&&r),r}),bm,ym)),Zr(1,180224,null,0,mm,[tn,Se,gf,Ep,[2,Ra],pm],null,null)],null,(function(t,e){t(e,0,0,null==zr(e,1).bottomSheetConfig?null:zr(e,1).bottomSheetConfig.ariaLabel,zr(e,1)._animationState)}))}var _m=Ar("mat-bottom-sheet-container",mm,xm,{},{},[]);class wm{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.maxWidth="80vw",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.autoFocus=!0,this.restoreFocus=!0,this.closeOnNavigation=!0}}function Sm(){throw Error("Attempting to attach dialog content after content is already attached")}class Cm extends hp{constructor(t,e,n,r,i){super(),this._elementRef=t,this._focusTrapFactory=e,this._changeDetectorRef=n,this._document=r,this._config=i,this._elementFocusedBeforeDialogWasOpened=null,this._state="enter",this._animationStateChanged=new vi,this._ariaLabelledBy=i.ariaLabelledBy||null}attachComponentPortal(t){return this._portalOutlet.hasAttached()&&Sm(),this._savePreviouslyFocusedElement(),this._portalOutlet.attachComponentPortal(t)}attachTemplatePortal(t){return this._portalOutlet.hasAttached()&&Sm(),this._savePreviouslyFocusedElement(),this._portalOutlet.attachTemplatePortal(t)}_trapFocus(){const t=this._elementRef.nativeElement;if(this._focusTrap||(this._focusTrap=this._focusTrapFactory.create(t)),this._config.autoFocus)this._focusTrap.focusInitialElementWhenReady();else{const e=this._document.activeElement;e===t||t.contains(e)||t.focus()}}_restoreFocus(){const t=this._elementFocusedBeforeDialogWasOpened;this._config.restoreFocus&&t&&"function"==typeof t.focus&&t.focus(),this._focusTrap&&this._focusTrap.destroy()}_savePreviouslyFocusedElement(){this._document&&(this._elementFocusedBeforeDialogWasOpened=this._document.activeElement,this._elementRef.nativeElement.focus&&Promise.resolve().then(()=>this._elementRef.nativeElement.focus()))}_onAnimationDone(t){"enter"===t.toState?this._trapFocus():"exit"===t.toState&&this._restoreFocus(),this._animationStateChanged.emit(t)}_onAnimationStart(t){this._animationStateChanged.emit(t)}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}}let Em=0;class km{constructor(t,e,n,r="mat-dialog-"+Em++){this._overlayRef=t,this._containerInstance=e,this.id=r,this.disableClose=this._containerInstance._config.disableClose,this._afterOpened=new A,this._afterClosed=new A,this._beforeClosed=new A,this._state=0,e._id=r,e._animationStateChanged.pipe(Za(t=>"done"===t.phaseName&&"enter"===t.toState),yl(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),e._animationStateChanged.pipe(Za(t=>"done"===t.phaseName&&"exit"===t.toState),yl(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._overlayRef.dispose()}),t.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._afterClosed.next(this._result),this._afterClosed.complete(),this.componentInstance=null,this._overlayRef.dispose()}),t.keydownEvents().pipe(Za(t=>27===t.keyCode&&!this.disableClose&&!function(t,...e){return e.length?e.some(e=>t[e]):t.altKey||t.shiftKey||t.ctrlKey||t.metaKey}(t))).subscribe(t=>{t.preventDefault(),this.close()})}close(t){this._result=t,this._containerInstance._animationStateChanged.pipe(Za(t=>"start"===t.phaseName),yl(1)).subscribe(e=>{this._beforeClosed.next(t),this._beforeClosed.complete(),this._state=2,this._overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>{this._overlayRef.dispose()},e.totalTime+100)}),this._containerInstance._startExitAnimation(),this._state=1}afterOpened(){return this._afterOpened.asObservable()}afterClosed(){return this._afterClosed.asObservable()}beforeClosed(){return this._beforeClosed.asObservable()}backdropClick(){return this._overlayRef.backdropClick()}keydownEvents(){return this._overlayRef.keydownEvents()}updatePosition(t){let e=this._getPositionStrategy();return t&&(t.left||t.right)?t.left?e.left(t.left):e.right(t.right):e.centerHorizontally(),t&&(t.top||t.bottom)?t.top?e.top(t.top):e.bottom(t.bottom):e.centerVertically(),this._overlayRef.updatePosition(),this}updateSize(t="",e=""){return this._getPositionStrategy().width(t).height(e),this._overlayRef.updatePosition(),this}addPanelClass(t){return this._overlayRef.addPanelClass(t),this}removePanelClass(t){return this._overlayRef.removePanelClass(t),this}afterOpen(){return this.afterOpened()}beforeClose(){return this.beforeClosed()}getState(){return this._state}_getPositionStrategy(){return this._overlayRef.getConfig().positionStrategy}}const Am=new kt("MatDialogData"),Dm=new kt("mat-dialog-default-options"),Nm=new kt("mat-dialog-scroll-strategy");function Tm(t){return()=>t.scrollStrategies.block()}class Om{constructor(t,e,n,r,i,s,o){this._overlay=t,this._injector=e,this._location=n,this._defaultOptions=r,this._parentDialog=s,this._overlayContainer=o,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new A,this._afterOpenedAtThisLevel=new A,this._ariaHiddenElements=new Map,this.afterAllClosed=Ka(()=>this.openDialogs.length?this._afterAllClosed:this._afterAllClosed.pipe(Al(void 0))),this._scrollStrategy=i}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}get afterOpen(){return this.afterOpened}get _afterAllClosed(){const t=this._parentDialog;return t?t._afterAllClosed:this._afterAllClosedAtThisLevel}open(t,e){if((e=function(t,e){return Object.assign({},e,t)}(e,this._defaultOptions||new wm)).id&&this.getDialogById(e.id))throw Error(`Dialog with id "${e.id}" exists already. The dialog id must be unique.`);const n=this._createOverlay(e),r=this._attachDialogContainer(n,e),i=this._attachDialogContent(t,r,n,e);return this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(i),i.afterClosed().subscribe(()=>this._removeOpenDialog(i)),this.afterOpened.next(i),i}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(t){return this.openDialogs.find(e=>e.id===t)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_createOverlay(t){const e=this._getOverlayConfig(t);return this._overlay.create(e)}_getOverlayConfig(t){const e=new Gp({positionStrategy:this._overlay.position().global(),scrollStrategy:t.scrollStrategy||this._scrollStrategy(),panelClass:t.panelClass,hasBackdrop:t.hasBackdrop,direction:t.direction,minWidth:t.minWidth,minHeight:t.minHeight,maxWidth:t.maxWidth,maxHeight:t.maxHeight,disposeOnNavigation:t.closeOnNavigation});return t.backdropClass&&(e.backdropClass=t.backdropClass),e}_attachDialogContainer(t,e){const n=new mp(e&&e.viewContainerRef&&e.viewContainerRef.injector||this._injector,new WeakMap([[wm,e]])),r=new up(Cm,e.viewContainerRef,n,e.componentFactoryResolver);return t.attach(r).instance}_attachDialogContent(t,e,n,r){const i=new km(n,e,this._location,r.id);if(r.hasBackdrop&&n.backdropClick().subscribe(()=>{i.disableClose||i.close()}),t instanceof En)e.attachTemplatePortal(new cp(t,null,{$implicit:r.data,dialogRef:i}));else{const n=this._createInjector(r,i,e),s=e.attachComponentPortal(new up(t,void 0,n));i.componentInstance=s.instance}return i.updateSize(r.width,r.height).updatePosition(r.position),i}_createInjector(t,e,n){const r=t&&t.viewContainerRef&&t.viewContainerRef.injector,i=new WeakMap([[Cm,n],[Am,t.data],[km,e]]);return!t.direction||r&&r.get(dm,null)||i.set(dm,{value:t.direction,change:ja()}),new mp(r||this._injector,i)}_removeOpenDialog(t){const e=this.openDialogs.indexOf(t);e>-1&&(this.openDialogs.splice(e,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((t,e)=>{t?e.setAttribute("aria-hidden",t):e.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),this._afterAllClosed.next()))}_hideNonDialogContentFromAssistiveTechnology(){const t=this._overlayContainer.getContainerElement();if(t.parentElement){const e=t.parentElement.children;for(let n=e.length-1;n>-1;n--){let r=e[n];r===t||"SCRIPT"===r.nodeName||"STYLE"===r.nodeName||r.hasAttribute("aria-live")||(this._ariaHiddenElements.set(r,r.getAttribute("aria-hidden")),r.setAttribute("aria-hidden","true"))}}}_closeDialogs(t){let e=t.length;for(;e--;)t[e].close()}}class Im{}var Rm=Vn({encapsulation:2,styles:[".mat-dialog-container{display:block;padding:24px;border-radius:4px;box-sizing:border-box;overflow:auto;outline:0;width:100%;height:100%;min-height:inherit;max-height:inherit}@media (-ms-high-contrast:active){.mat-dialog-container{outline:solid 1px}}.mat-dialog-content{display:block;margin:0 -24px;padding:0 24px;max-height:65vh;overflow:auto;-webkit-overflow-scrolling:touch}.mat-dialog-title{margin:0 0 20px;display:block}.mat-dialog-actions{padding:8px 0;display:flex;flex-wrap:wrap;min-height:52px;align-items:center;margin-bottom:-24px}.mat-dialog-actions[align=end]{justify-content:flex-end}.mat-dialog-actions[align=center]{justify-content:center}.mat-dialog-actions .mat-button-base+.mat-button-base{margin-left:8px}[dir=rtl] .mat-dialog-actions .mat-button-base+.mat-button-base{margin-left:0;margin-right:8px}"],data:{animation:[{type:7,name:"dialogContainer",definitions:[{type:0,name:"void, exit",styles:{type:6,styles:{opacity:0,transform:"scale(0.7)"},offset:null},options:void 0},{type:0,name:"enter",styles:{type:6,styles:{transform:"none"},offset:null},options:void 0},{type:1,expr:"* => enter",animation:{type:4,styles:{type:6,styles:{transform:"none",opacity:1},offset:null},timings:"150ms cubic-bezier(0, 0, 0.2, 1)"},options:null},{type:1,expr:"* => void, * => exit",animation:{type:4,styles:{type:6,styles:{opacity:0},offset:null},timings:"75ms cubic-bezier(0.4, 0.0, 0.2, 1)"},options:null}],options:{}}]}});function Fm(t){return Hs(0,[(t()(),Ts(0,null,null,0))],null,null)}function Mm(t){return Hs(0,[$s(402653184,1,{_portalOutlet:0}),(t()(),Ts(16777216,null,null,1,null,Fm)),Zr(2,212992,[[1,4]],0,fp,[Xe,An],{portal:[0,"portal"]},null)],(function(t,e){t(e,2,0,"")}),null)}function $m(t){return Hs(0,[(t()(),Os(0,0,null,null,1,"mat-dialog-container",[["aria-modal","true"],["class","mat-dialog-container"],["tabindex","-1"]],[[1,"id",0],[1,"role",0],[1,"aria-labelledby",0],[1,"aria-label",0],[1,"aria-describedby",0],[40,"@dialogContainer",0]],[["component","@dialogContainer.start"],["component","@dialogContainer.done"]],(function(t,e,n){var r=!0;return"component:@dialogContainer.start"===e&&(r=!1!==zr(t,1)._onAnimationStart(n)&&r),"component:@dialogContainer.done"===e&&(r=!1!==zr(t,1)._onAnimationDone(n)&&r),r}),Mm,Rm)),Zr(1,49152,null,0,Cm,[tn,gf,Se,[2,Ra],wm],null,null)],null,(function(t,e){t(e,0,0,zr(e,1)._id,zr(e,1)._config.role,zr(e,1)._config.ariaLabel?null:zr(e,1)._ariaLabelledBy,zr(e,1)._config.ariaLabel,zr(e,1)._config.ariaDescribedBy||null,zr(e,1)._state)}))}var Pm=Ar("mat-dialog-container",Cm,$m,{},{},[]);class zm extends j{constructor(t,e){super(t),this.sources=e,this.completed=0,this.haveValues=0;const n=e.length;this.values=new Array(n);for(let r=0;r<n;r++){const t=B(this,e[r],null,r);t&&this.add(t)}}notifyNext(t,e,n,r,i){this.values[n]=e,i._hasValue||(i._hasValue=!0,this.haveValues++)}notifyComplete(t){const{destination:e,haveValues:n,values:r}=this,i=r.length;t._hasValue?(this.completed++,this.completed===i&&(n===i&&e.next(r),e.complete())):e.complete()}}function Lm(t){return Error(`MatDatepicker: No provider found for ${t}. You must import one of the following modules at your application root: MatNativeDateModule, MatMomentDateModule, or provide a custom implementation.`)}let Bm=(()=>{class t{constructor(){this.changes=new A,this.calendarLabel="Calendar",this.openCalendarLabel="Open calendar",this.prevMonthLabel="Previous month",this.nextMonthLabel="Next month",this.prevYearLabel="Previous year",this.nextYearLabel="Next year",this.prevMultiYearLabel="Previous 20 years",this.nextMultiYearLabel="Next 20 years",this.switchToMonthViewLabel="Choose date",this.switchToMultiYearViewLabel="Choose month and year"}formatYearRange(t,e){return`${t} \u2013 ${e}`}}return t.ngInjectableDef=pt({factory:function(){return new t},token:t,providedIn:"root"}),t})();class jm{constructor(t,e,n,r,i){this.value=t,this.displayValue=e,this.ariaLabel=n,this.enabled=r,this.cssClasses=i}}class Um{constructor(t,e){this._elementRef=t,this._ngZone=e,this.numCols=7,this.activeCell=0,this.cellAspectRatio=1,this.selectedValueChange=new vi}_cellClicked(t){t.enabled&&this.selectedValueChange.emit(t.value)}ngOnChanges(t){const e=t.numCols,{rows:n,numCols:r}=this;(t.rows||e)&&(this._firstRowOffset=n&&n.length&&n[0].length?r-n[0].length:0),(t.cellAspectRatio||e||!this._cellPadding)&&(this._cellPadding=50*this.cellAspectRatio/r+"%"),!e&&this._cellWidth||(this._cellWidth=100/r+"%")}_isActiveCell(t,e){let n=t*this.numCols+e;return t&&(n-=this._firstRowOffset),n==this.activeCell}_focusActiveCell(){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.asObservable().pipe(yl(1)).subscribe(()=>{const t=this._elementRef.nativeElement.querySelector(".mat-calendar-body-active");t&&t.focus()})})}}class Vm{constructor(t,e,n,r){if(this._changeDetectorRef=t,this._dateFormats=e,this._dateAdapter=n,this._dir=r,this.selectedChange=new vi,this._userSelection=new vi,this.activeDateChange=new vi,!this._dateAdapter)throw Lm("DateAdapter");if(!this._dateFormats)throw Lm("MAT_DATE_FORMATS");this._activeDate=this._dateAdapter.today()}get activeDate(){return this._activeDate}set activeDate(t){const e=this._activeDate,n=this._getValidDateOrNull(this._dateAdapter.deserialize(t))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(n,this.minDate,this.maxDate),this._hasSameMonthAndYear(e,this._activeDate)||this._init()}get selected(){return this._selected}set selected(t){this._selected=this._getValidDateOrNull(this._dateAdapter.deserialize(t)),this._selectedDate=this._getDateInCurrentMonth(this._selected)}get minDate(){return this._minDate}set minDate(t){this._minDate=this._getValidDateOrNull(this._dateAdapter.deserialize(t))}get maxDate(){return this._maxDate}set maxDate(t){this._maxDate=this._getValidDateOrNull(this._dateAdapter.deserialize(t))}ngAfterContentInit(){this._init()}_dateSelected(t){if(this._selectedDate!=t){const e=this._dateAdapter.getYear(this.activeDate),n=this._dateAdapter.getMonth(this.activeDate),r=this._dateAdapter.createDate(e,n,t);this.selectedChange.emit(r)}this._userSelection.emit()}_handleCalendarBodyKeydown(t){const e=this._activeDate,n=this._isRtl();switch(t.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,n?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,n?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-7);break;case 40:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,7);break;case 36:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1-this._dateAdapter.getDate(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,this._dateAdapter.getNumDaysInMonth(this._activeDate)-this._dateAdapter.getDate(this._activeDate));break;case 33:this.activeDate=t.altKey?this._dateAdapter.addCalendarYears(this._activeDate,-1):this._dateAdapter.addCalendarMonths(this._activeDate,-1);break;case 34:this.activeDate=t.altKey?this._dateAdapter.addCalendarYears(this._activeDate,1):this._dateAdapter.addCalendarMonths(this._activeDate,1);break;case 13:case 32:return void(this.dateFilter&&!this.dateFilter(this._activeDate)||(this._dateSelected(this._dateAdapter.getDate(this._activeDate)),this._userSelection.emit(),t.preventDefault()));default:return}this._dateAdapter.compareDate(e,this.activeDate)&&this.activeDateChange.emit(this.activeDate),this._focusActiveCell(),t.preventDefault()}_init(){this._selectedDate=this._getDateInCurrentMonth(this.selected),this._todayDate=this._getDateInCurrentMonth(this._dateAdapter.today()),this._monthLabel=this._dateAdapter.getMonthNames("short")[this._dateAdapter.getMonth(this.activeDate)].toLocaleUpperCase();let t=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),1);this._firstWeekOffset=(7+this._dateAdapter.getDayOfWeek(t)-this._dateAdapter.getFirstDayOfWeek())%7,this._initWeekdays(),this._createWeekCells(),this._changeDetectorRef.markForCheck()}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_initWeekdays(){const t=this._dateAdapter.getFirstDayOfWeek(),e=this._dateAdapter.getDayOfWeekNames("narrow");let n=this._dateAdapter.getDayOfWeekNames("long").map((t,n)=>({long:t,narrow:e[n]}));this._weekdays=n.slice(t).concat(n.slice(0,t))}_createWeekCells(){const t=this._dateAdapter.getNumDaysInMonth(this.activeDate),e=this._dateAdapter.getDateNames();this._weeks=[[]];for(let n=0,r=this._firstWeekOffset;n<t;n++,r++){7==r&&(this._weeks.push([]),r=0);const t=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),n+1),i=this._shouldEnableDate(t),s=this._dateAdapter.format(t,this._dateFormats.display.dateA11yLabel),o=this.dateClass?this.dateClass(t):void 0;this._weeks[this._weeks.length-1].push(new jm(n+1,e[n],s,i,o))}}_shouldEnableDate(t){return!!t&&(!this.dateFilter||this.dateFilter(t))&&(!this.minDate||this._dateAdapter.compareDate(t,this.minDate)>=0)&&(!this.maxDate||this._dateAdapter.compareDate(t,this.maxDate)<=0)}_getDateInCurrentMonth(t){return t&&this._hasSameMonthAndYear(t,this.activeDate)?this._dateAdapter.getDate(t):null}_hasSameMonthAndYear(t,e){return!(!t||!e||this._dateAdapter.getMonth(t)!=this._dateAdapter.getMonth(e)||this._dateAdapter.getYear(t)!=this._dateAdapter.getYear(e))}_getValidDateOrNull(t){return this._dateAdapter.isDateInstance(t)&&this._dateAdapter.isValid(t)?t:null}_isRtl(){return this._dir&&"rtl"===this._dir.value}}class Wm{constructor(t,e,n){if(this._changeDetectorRef=t,this._dateAdapter=e,this._dir=n,this.selectedChange=new vi,this.yearSelected=new vi,this.activeDateChange=new vi,!this._dateAdapter)throw Lm("DateAdapter");this._activeDate=this._dateAdapter.today()}get activeDate(){return this._activeDate}set activeDate(t){let e=this._activeDate;const n=this._getValidDateOrNull(this._dateAdapter.deserialize(t))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(n,this.minDate,this.maxDate),qm(this._dateAdapter,e,this._activeDate,this.minDate,this.maxDate)||this._init()}get selected(){return this._selected}set selected(t){this._selected=this._getValidDateOrNull(this._dateAdapter.deserialize(t)),this._selectedYear=this._selected&&this._dateAdapter.getYear(this._selected)}get minDate(){return this._minDate}set minDate(t){this._minDate=this._getValidDateOrNull(this._dateAdapter.deserialize(t))}get maxDate(){return this._maxDate}set maxDate(t){this._maxDate=this._getValidDateOrNull(this._dateAdapter.deserialize(t))}ngAfterContentInit(){this._init()}_init(){this._todayYear=this._dateAdapter.getYear(this._dateAdapter.today());const t=this._dateAdapter.getYear(this._activeDate)-Hm(this._dateAdapter,this.activeDate,this.minDate,this.maxDate);this._years=[];for(let e=0,n=[];e<24;e++)n.push(t+e),4==n.length&&(this._years.push(n.map(t=>this._createCellForYear(t))),n=[]);this._changeDetectorRef.markForCheck()}_yearSelected(t){this.yearSelected.emit(this._dateAdapter.createDate(t,0,1));let e=this._dateAdapter.getMonth(this.activeDate),n=this._dateAdapter.getNumDaysInMonth(this._dateAdapter.createDate(t,e,1));this.selectedChange.emit(this._dateAdapter.createDate(t,e,Math.min(this._dateAdapter.getDate(this.activeDate),n)))}_handleCalendarBodyKeydown(t){const e=this._activeDate,n=this._isRtl();switch(t.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,n?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,n?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-4);break;case 40:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,4);break;case 36:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-Hm(this._dateAdapter,this.activeDate,this.minDate,this.maxDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,24-Hm(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)-1);break;case 33:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,t.altKey?-240:-24);break;case 34:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,t.altKey?240:24);break;case 13:case 32:this._yearSelected(this._dateAdapter.getYear(this._activeDate));break;default:return}this._dateAdapter.compareDate(e,this.activeDate)&&this.activeDateChange.emit(this.activeDate),this._focusActiveCell(),t.preventDefault()}_getActiveCell(){return Hm(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_createCellForYear(t){let e=this._dateAdapter.getYearName(this._dateAdapter.createDate(t,0,1));return new jm(t,e,e,this._shouldEnableYear(t))}_shouldEnableYear(t){if(null==t||this.maxDate&&t>this._dateAdapter.getYear(this.maxDate)||this.minDate&&t<this._dateAdapter.getYear(this.minDate))return!1;if(!this.dateFilter)return!0;for(let e=this._dateAdapter.createDate(t,0,1);this._dateAdapter.getYear(e)==t;e=this._dateAdapter.addCalendarDays(e,1))if(this.dateFilter(e))return!0;return!1}_getValidDateOrNull(t){return this._dateAdapter.isDateInstance(t)&&this._dateAdapter.isValid(t)?t:null}_isRtl(){return this._dir&&"rtl"===this._dir.value}}function qm(t,e,n,r,i){const s=t.getYear(e),o=t.getYear(n),a=Gm(t,r,i);return Math.floor((s-a)/24)===Math.floor((o-a)/24)}function Hm(t,e,n,r){return((t.getYear(e)-Gm(t,n,r))%24+24)%24}function Gm(t,e,n){let r=0;return n?r=t.getYear(n)-24+1:e&&(r=t.getYear(e)),r}class Ym{constructor(t,e,n,r){if(this._changeDetectorRef=t,this._dateFormats=e,this._dateAdapter=n,this._dir=r,this.selectedChange=new vi,this.monthSelected=new vi,this.activeDateChange=new vi,!this._dateAdapter)throw Lm("DateAdapter");if(!this._dateFormats)throw Lm("MAT_DATE_FORMATS");this._activeDate=this._dateAdapter.today()}get activeDate(){return this._activeDate}set activeDate(t){let e=this._activeDate;const n=this._getValidDateOrNull(this._dateAdapter.deserialize(t))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(n,this.minDate,this.maxDate),this._dateAdapter.getYear(e)!==this._dateAdapter.getYear(this._activeDate)&&this._init()}get selected(){return this._selected}set selected(t){this._selected=this._getValidDateOrNull(this._dateAdapter.deserialize(t)),this._selectedMonth=this._getMonthInCurrentYear(this._selected)}get minDate(){return this._minDate}set minDate(t){this._minDate=this._getValidDateOrNull(this._dateAdapter.deserialize(t))}get maxDate(){return this._maxDate}set maxDate(t){this._maxDate=this._getValidDateOrNull(this._dateAdapter.deserialize(t))}ngAfterContentInit(){this._init()}_monthSelected(t){const e=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),t,1);this.monthSelected.emit(e);const n=this._dateAdapter.getNumDaysInMonth(e);this.selectedChange.emit(this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),t,Math.min(this._dateAdapter.getDate(this.activeDate),n)))}_handleCalendarBodyKeydown(t){const e=this._activeDate,n=this._isRtl();switch(t.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,n?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,n?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-4);break;case 40:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,4);break;case 36:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-this._dateAdapter.getMonth(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,11-this._dateAdapter.getMonth(this._activeDate));break;case 33:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,t.altKey?-10:-1);break;case 34:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,t.altKey?10:1);break;case 13:case 32:this._monthSelected(this._dateAdapter.getMonth(this._activeDate));break;default:return}this._dateAdapter.compareDate(e,this.activeDate)&&this.activeDateChange.emit(this.activeDate),this._focusActiveCell(),t.preventDefault()}_init(){this._selectedMonth=this._getMonthInCurrentYear(this.selected),this._todayMonth=this._getMonthInCurrentYear(this._dateAdapter.today()),this._yearLabel=this._dateAdapter.getYearName(this.activeDate);let t=this._dateAdapter.getMonthNames("short");this._months=[[0,1,2,3],[4,5,6,7],[8,9,10,11]].map(e=>e.map(e=>this._createCellForMonth(e,t[e]))),this._changeDetectorRef.markForCheck()}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_getMonthInCurrentYear(t){return t&&this._dateAdapter.getYear(t)==this._dateAdapter.getYear(this.activeDate)?this._dateAdapter.getMonth(t):null}_createCellForMonth(t,e){let n=this._dateAdapter.format(this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),t,1),this._dateFormats.display.monthYearA11yLabel);return new jm(t,e.toLocaleUpperCase(),n,this._shouldEnableMonth(t))}_shouldEnableMonth(t){const e=this._dateAdapter.getYear(this.activeDate);if(null==t||this._isYearAndMonthAfterMaxDate(e,t)||this._isYearAndMonthBeforeMinDate(e,t))return!1;if(!this.dateFilter)return!0;for(let n=this._dateAdapter.createDate(e,t,1);this._dateAdapter.getMonth(n)==t;n=this._dateAdapter.addCalendarDays(n,1))if(this.dateFilter(n))return!0;return!1}_isYearAndMonthAfterMaxDate(t,e){if(this.maxDate){const n=this._dateAdapter.getYear(this.maxDate),r=this._dateAdapter.getMonth(this.maxDate);return t>n||t===n&&e>r}return!1}_isYearAndMonthBeforeMinDate(t,e){if(this.minDate){const n=this._dateAdapter.getYear(this.minDate),r=this._dateAdapter.getMonth(this.minDate);return t<n||t===n&&e<r}return!1}_getValidDateOrNull(t){return this._dateAdapter.isDateInstance(t)&&this._dateAdapter.isValid(t)?t:null}_isRtl(){return this._dir&&"rtl"===this._dir.value}}class Km{constructor(t,e,n,r,i){this._intl=t,this.calendar=e,this._dateAdapter=n,this._dateFormats=r,this.calendar.stateChanges.subscribe(()=>i.markForCheck())}get periodButtonText(){if("month"==this.calendar.currentView)return this._dateAdapter.format(this.calendar.activeDate,this._dateFormats.display.monthYearLabel).toLocaleUpperCase();if("year"==this.calendar.currentView)return this._dateAdapter.getYearName(this.calendar.activeDate);const t=this._dateAdapter.getYear(this.calendar.activeDate)-Hm(this._dateAdapter,this.calendar.activeDate,this.calendar.minDate,this.calendar.maxDate),e=t+24-1,n=this._dateAdapter.getYearName(this._dateAdapter.createDate(t,0,1)),r=this._dateAdapter.getYearName(this._dateAdapter.createDate(e,0,1));return this._intl.formatYearRange(n,r)}get periodButtonLabel(){return"month"==this.calendar.currentView?this._intl.switchToMultiYearViewLabel:this._intl.switchToMonthViewLabel}get prevButtonLabel(){return{month:this._intl.prevMonthLabel,year:this._intl.prevYearLabel,"multi-year":this._intl.prevMultiYearLabel}[this.calendar.currentView]}get nextButtonLabel(){return{month:this._intl.nextMonthLabel,year:this._intl.nextYearLabel,"multi-year":this._intl.nextMultiYearLabel}[this.calendar.currentView]}currentPeriodClicked(){this.calendar.currentView="month"==this.calendar.currentView?"multi-year":"month"}previousClicked(){this.calendar.activeDate="month"==this.calendar.currentView?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,-1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,"year"==this.calendar.currentView?-1:-24)}nextClicked(){this.calendar.activeDate="month"==this.calendar.currentView?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,"year"==this.calendar.currentView?1:24)}previousEnabled(){return!this.calendar.minDate||!this.calendar.minDate||!this._isSameView(this.calendar.activeDate,this.calendar.minDate)}nextEnabled(){return!this.calendar.maxDate||!this._isSameView(this.calendar.activeDate,this.calendar.maxDate)}_isSameView(t,e){return"month"==this.calendar.currentView?this._dateAdapter.getYear(t)==this._dateAdapter.getYear(e)&&this._dateAdapter.getMonth(t)==this._dateAdapter.getMonth(e):"year"==this.calendar.currentView?this._dateAdapter.getYear(t)==this._dateAdapter.getYear(e):qm(this._dateAdapter,t,e,this.calendar.minDate,this.calendar.maxDate)}}class Xm{constructor(t,e,n,r){if(this._dateAdapter=e,this._dateFormats=n,this._changeDetectorRef=r,this._moveFocusOnNextTick=!1,this.startView="month",this.selectedChange=new vi,this.yearSelected=new vi,this.monthSelected=new vi,this._userSelection=new vi,this.stateChanges=new A,!this._dateAdapter)throw Lm("DateAdapter");if(!this._dateFormats)throw Lm("MAT_DATE_FORMATS");this._intlChanges=t.changes.subscribe(()=>{r.markForCheck(),this.stateChanges.next()})}get startAt(){return this._startAt}set startAt(t){this._startAt=this._getValidDateOrNull(this._dateAdapter.deserialize(t))}get selected(){return this._selected}set selected(t){this._selected=this._getValidDateOrNull(this._dateAdapter.deserialize(t))}get minDate(){return this._minDate}set minDate(t){this._minDate=this._getValidDateOrNull(this._dateAdapter.deserialize(t))}get maxDate(){return this._maxDate}set maxDate(t){this._maxDate=this._getValidDateOrNull(this._dateAdapter.deserialize(t))}get activeDate(){return this._clampedActiveDate}set activeDate(t){this._clampedActiveDate=this._dateAdapter.clampDate(t,this.minDate,this.maxDate),this.stateChanges.next(),this._changeDetectorRef.markForCheck()}get currentView(){return this._currentView}set currentView(t){this._currentView=t,this._moveFocusOnNextTick=!0,this._changeDetectorRef.markForCheck()}ngAfterContentInit(){this._calendarHeaderPortal=new up(this.headerComponent||Km),this.activeDate=this.startAt||this._dateAdapter.today(),this._currentView=this.startView}ngAfterViewChecked(){this._moveFocusOnNextTick&&(this._moveFocusOnNextTick=!1,this.focusActiveCell())}ngOnDestroy(){this._intlChanges.unsubscribe(),this.stateChanges.complete()}ngOnChanges(t){const e=t.minDate||t.maxDate||t.dateFilter;if(e&&!e.firstChange){const t=this._getCurrentViewComponent();t&&(this._changeDetectorRef.detectChanges(),t._init())}this.stateChanges.next()}focusActiveCell(){this._getCurrentViewComponent()._focusActiveCell()}updateTodaysDate(){("month"==this.currentView?this.monthView:"year"==this.currentView?this.yearView:this.multiYearView).ngAfterContentInit()}_dateSelected(t){this._dateAdapter.sameDate(t,this.selected)||this.selectedChange.emit(t)}_yearSelectedInMultiYearView(t){this.yearSelected.emit(t)}_monthSelectedInYearView(t){this.monthSelected.emit(t)}_userSelected(){this._userSelection.emit()}_goToDateInView(t,e){this.activeDate=t,this.currentView=e}_getValidDateOrNull(t){return this._dateAdapter.isDateInstance(t)&&this._dateAdapter.isValid(t)?t:null}_getCurrentViewComponent(){return this.monthView||this.yearView||this.multiYearView}}const Zm=new kt("mat-datepicker-scroll-strategy");function Qm(t){return()=>t.scrollStrategies.reposition()}class Jm{constructor(t){this._elementRef=t}}const tg=Tf(Jm);class eg extends tg{constructor(t){super(t)}ngAfterViewInit(){this._calendar.focusActiveCell()}}class ng{}let rg=(()=>{class t{create(t){return"undefined"==typeof MutationObserver?null:new MutationObserver(t)}}return t.ngInjectableDef=pt({factory:function(){return new t},token:t,providedIn:"root"}),t})(),ig=(()=>{class t{constructor(t){this._mutationObserverFactory=t,this._observedElements=new Map}ngOnDestroy(){this._observedElements.forEach((t,e)=>this._cleanupObserver(e))}observe(t){const e=Xd(t);return new _(t=>{const n=this._observeElement(e).subscribe(t);return()=>{n.unsubscribe(),this._unobserveElement(e)}})}_observeElement(t){if(this._observedElements.has(t))this._observedElements.get(t).count++;else{const e=new A,n=this._mutationObserverFactory.create(t=>e.next(t));n&&n.observe(t,{characterData:!0,childList:!0,subtree:!0}),this._observedElements.set(t,{observer:n,stream:e,count:1})}return this._observedElements.get(t).stream}_unobserveElement(t){this._observedElements.has(t)&&(this._observedElements.get(t).count--,this._observedElements.get(t).count||this._cleanupObserver(t))}_cleanupObserver(t){if(this._observedElements.has(t)){const{observer:e,stream:n}=this._observedElements.get(t);e&&e.disconnect(),n.complete(),this._observedElements.delete(t)}}}return t.ngInjectableDef=pt({factory:function(){return new t(Rt(rg))},token:t,providedIn:"root"}),t})();class sg{}const og=["mat-button","mat-flat-button","mat-icon-button","mat-raised-button","mat-stroked-button","mat-mini-fab","mat-fab"];class ag{constructor(t){this._elementRef=t}}const lg=Tf(Nf(Of(ag)));class ug extends lg{constructor(t,e,n){super(t),this._focusMonitor=e,this._animationMode=n,this.isRoundButton=this._hasHostAttributes("mat-fab","mat-mini-fab"),this.isIconButton=this._hasHostAttributes("mat-icon-button");for(const r of og)this._hasHostAttributes(r)&&this._getHostElement().classList.add(r);t.nativeElement.classList.add("mat-button-base"),this._focusMonitor.monitor(this._elementRef,!0),this.isRoundButton&&(this.color="accent")}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}focus(t="program",e){this._focusMonitor.focusVia(this._getHostElement(),t,e)}_getHostElement(){return this._elementRef.nativeElement}_isRippleDisabled(){return this.disableRipple||this.disabled}_hasHostAttributes(...t){return t.some(t=>this._getHostElement().hasAttribute(t))}}class cg extends ug{constructor(t,e,n){super(e,t,n)}_haltDisabledEvents(t){this.disabled&&(t.preventDefault(),t.stopImmediatePropagation())}}class hg{}function dg(){return"undefined"!=typeof process}function fg(t){switch(t.length){case 0:return new Wd;case 1:return t[0];default:return new qd(t)}}function pg(t,e,n,r,i={},s={}){const o=[],a=[];let l=-1,u=null;if(r.forEach(t=>{const n=t.offset,r=n==l,c=r&&u||{};Object.keys(t).forEach(n=>{let r=n,a=t[n];if("offset"!==n)switch(r=e.normalizePropertyName(r,o),a){case"!":a=i[n];break;case"*":a=s[n];break;default:a=e.normalizeStyleValue(n,r,a,o)}c[r]=a}),r||a.push(c),u=c,l=n}),o.length){const t="\n - ";throw new Error(`Unable to animate due to the following errors:${t}${o.join(t)}`)}return a}function mg(t,e,n,r){switch(e){case"start":t.onStart(()=>r(n&&gg(n,"start",t)));break;case"done":t.onDone(()=>r(n&&gg(n,"done",t)));break;case"destroy":t.onDestroy(()=>r(n&&gg(n,"destroy",t)))}}function gg(t,e,n){const r=n.totalTime,i=yg(t.element,t.triggerName,t.fromState,t.toState,e||t.phaseName,null==r?t.totalTime:r,!!n.disabled),s=t._data;return null!=s&&(i._data=s),i}function yg(t,e,n,r,i="",s=0,o){return{element:t,triggerName:e,fromState:n,toState:r,phaseName:i,totalTime:s,disabled:!!o}}function vg(t,e,n){let r;return t instanceof Map?(r=t.get(e),r||t.set(e,r=n)):(r=t[e],r||(r=t[e]=n)),r}function bg(t){const e=t.indexOf(":");return[t.substring(1,e),t.substr(e+1)]}let xg=(t,e)=>!1,_g=(t,e)=>!1,wg=(t,e,n)=>[];const Sg=dg();(Sg||"undefined"!=typeof Element)&&(xg=(t,e)=>t.contains(e),_g=(()=>{if(Sg||Element.prototype.matches)return(t,e)=>t.matches(e);{const t=Element.prototype,e=t.matchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector||t.webkitMatchesSelector;return e?(t,n)=>e.apply(t,[n]):_g}})(),wg=(t,e,n)=>{let r=[];if(n)r.push(...t.querySelectorAll(e));else{const n=t.querySelector(e);n&&r.push(n)}return r});let Cg=null,Eg=!1;function kg(t){Cg||(Cg=("undefined"!=typeof document?document.body:null)||{},Eg=!!Cg.style&&"WebkitAppearance"in Cg.style);let e=!0;return Cg.style&&!function(t){return"ebkit"==t.substring(1,6)}(t)&&(e=t in Cg.style,!e&&Eg)&&(e="Webkit"+t.charAt(0).toUpperCase()+t.substr(1)in Cg.style),e}const Ag=_g,Dg=xg,Ng=wg;function Tg(t){const e={};return Object.keys(t).forEach(n=>{const r=n.replace(/([a-z])([A-Z])/g,"$1-$2");e[r]=t[n]}),e}class Og{validateStyleProperty(t){return kg(t)}matchesElement(t,e){return Ag(t,e)}containsElement(t,e){return Dg(t,e)}query(t,e,n){return Ng(t,e,n)}computeStyle(t,e,n){return n||""}animate(t,e,n,r,i,s=[],o){return new Wd(n,r)}}let Ig=(()=>{class t{}return t.NOOP=new Og,t})();function Rg(t){if("number"==typeof t)return t;const e=t.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:Fg(parseFloat(e[1]),e[2])}function Fg(t,e){switch(e){case"s":return 1e3*t;default:return t}}function Mg(t,e,n){return t.hasOwnProperty("duration")?t:function(t,e,n){let r,i=0,s="";if("string"==typeof t){const n=t.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===n)return e.push(`The provided timing value "${t}" is invalid.`),{duration:0,delay:0,easing:""};r=Fg(parseFloat(n[1]),n[2]);const o=n[3];null!=o&&(i=Fg(parseFloat(o),n[4]));const a=n[5];a&&(s=a)}else r=t;if(!n){let n=!1,s=e.length;r<0&&(e.push("Duration values below 0 are not allowed for this animation step."),n=!0),i<0&&(e.push("Delay values below 0 are not allowed for this animation step."),n=!0),n&&e.splice(s,0,`The provided timing value "${t}" is invalid.`)}return{duration:r,delay:i,easing:s}}(t,e,n)}function $g(t,e={}){return Object.keys(t).forEach(n=>{e[n]=t[n]}),e}function Pg(t,e,n={}){if(e)for(let r in t)n[r]=t[r];else $g(t,n);return n}function zg(t,e,n){return n?e+":"+n+";":""}function Lg(t){let e="";for(let n=0;n<t.style.length;n++){const r=t.style.item(n);e+=zg(0,r,t.style.getPropertyValue(r))}for(const n in t.style)t.style.hasOwnProperty(n)&&!n.startsWith("_")&&(e+=zg(0,n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),t.style[n]));t.setAttribute("style",e)}function Bg(t,e,n){t.style&&(Object.keys(e).forEach(r=>{const i=Yg(r);n&&!n.hasOwnProperty(r)&&(n[r]=t.style[i]),t.style[i]=e[r]}),dg()&&Lg(t))}function jg(t,e){t.style&&(Object.keys(e).forEach(e=>{const n=Yg(e);t.style[n]=""}),dg()&&Lg(t))}function Ug(t){return Array.isArray(t)?1==t.length?t[0]:jd(t):t}const Vg=new RegExp("{{\\s*(.+?)\\s*}}","g");function Wg(t){let e=[];if("string"==typeof t){const n=t.toString();let r;for(;r=Vg.exec(n);)e.push(r[1]);Vg.lastIndex=0}return e}function qg(t,e,n){const r=t.toString(),i=r.replace(Vg,(t,r)=>{let i=e[r];return e.hasOwnProperty(r)||(n.push("Please provide a value for the animation param "+r),i=""),i.toString()});return i==r?t:i}function Hg(t){const e=[];let n=t.next();for(;!n.done;)e.push(n.value),n=t.next();return e}const Gg=/-+([a-z0-9])/g;function Yg(t){return t.replace(Gg,(...t)=>t[1].toUpperCase())}function Kg(t,e){return 0===t||0===e}function Xg(t,e,n){const r=Object.keys(n);if(r.length&&e.length){let s=e[0],o=[];if(r.forEach(t=>{s.hasOwnProperty(t)||o.push(t),s[t]=n[t]}),o.length)for(var i=1;i<e.length;i++){let n=e[i];o.forEach((function(e){n[e]=Qg(t,e)}))}}return e}function Zg(t,e,n){switch(e.type){case 7:return t.visitTrigger(e,n);case 0:return t.visitState(e,n);case 1:return t.visitTransition(e,n);case 2:return t.visitSequence(e,n);case 3:return t.visitGroup(e,n);case 4:return t.visitAnimate(e,n);case 5:return t.visitKeyframes(e,n);case 6:return t.visitStyle(e,n);case 8:return t.visitReference(e,n);case 9:return t.visitAnimateChild(e,n);case 10:return t.visitAnimateRef(e,n);case 11:return t.visitQuery(e,n);case 12:return t.visitStagger(e,n);default:throw new Error("Unable to resolve animation metadata node #"+e.type)}}function Qg(t,e){return window.getComputedStyle(t)[e]}function Jg(t,e){const n=[];return"string"==typeof t?t.split(/\s*,\s*/).forEach(t=>function(t,e,n){if(":"==t[0]){const r=function(t,e){switch(t){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,e)=>parseFloat(e)>parseFloat(t);case":decrement":return(t,e)=>parseFloat(e)<parseFloat(t);default:return e.push(`The transition alias value "${t}" is not supported`),"* => *"}}(t,n);if("function"==typeof r)return void e.push(r);t=r}const r=t.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==r||r.length<4)return n.push(`The provided transition expression "${t}" is not supported`),e;const i=r[1],s=r[2],o=r[3];e.push(ny(i,o)),"<"!=s[0]||"*"==i&&"*"==o||e.push(ny(o,i))}(t,n,e)):n.push(t),n}const ty=new Set(["true","1"]),ey=new Set(["false","0"]);function ny(t,e){const n=ty.has(t)||ey.has(t),r=ty.has(e)||ey.has(e);return(i,s)=>{let o="*"==t||t==i,a="*"==e||e==s;return!o&&n&&"boolean"==typeof i&&(o=i?ty.has(t):ey.has(t)),!a&&r&&"boolean"==typeof s&&(a=s?ty.has(e):ey.has(e)),o&&a}}const ry=new RegExp("s*:selfs*,?","g");function iy(t,e,n){return new sy(t).build(e,n)}class sy{constructor(t){this._driver=t}build(t,e){const n=new oy(e);return this._resetContextStyleTimingState(n),Zg(this,Ug(t),n)}_resetContextStyleTimingState(t){t.currentQuerySelector="",t.collectedStyles={},t.collectedStyles[""]={},t.currentTime=0}visitTrigger(t,e){let n=e.queryCount=0,r=e.depCount=0;const i=[],s=[];return"@"==t.name.charAt(0)&&e.errors.push("animation triggers cannot be prefixed with an `@` sign (e.g. trigger('@foo', [...]))"),t.definitions.forEach(t=>{if(this._resetContextStyleTimingState(e),0==t.type){const n=t,r=n.name;r.toString().split(/\s*,\s*/).forEach(t=>{n.name=t,i.push(this.visitState(n,e))}),n.name=r}else if(1==t.type){const i=this.visitTransition(t,e);n+=i.queryCount,r+=i.depCount,s.push(i)}else e.errors.push("only state() and transition() definitions can sit inside of a trigger()")}),{type:7,name:t.name,states:i,transitions:s,queryCount:n,depCount:r,options:null}}visitState(t,e){const n=this.visitStyle(t.styles,e),r=t.options&&t.options.params||null;if(n.containsDynamicStyles){const i=new Set,s=r||{};if(n.styles.forEach(t=>{if(ay(t)){const e=t;Object.keys(e).forEach(t=>{Wg(e[t]).forEach(t=>{s.hasOwnProperty(t)||i.add(t)})})}}),i.size){const n=Hg(i.values());e.errors.push(`state("${t.name}", ...) must define default values for all the following style substitutions: ${n.join(", ")}`)}}return{type:0,name:t.name,style:n,options:r?{params:r}:null}}visitTransition(t,e){e.queryCount=0,e.depCount=0;const n=Zg(this,Ug(t.animation),e);return{type:1,matchers:Jg(t.expr,e.errors),animation:n,queryCount:e.queryCount,depCount:e.depCount,options:ly(t.options)}}visitSequence(t,e){return{type:2,steps:t.steps.map(t=>Zg(this,t,e)),options:ly(t.options)}}visitGroup(t,e){const n=e.currentTime;let r=0;const i=t.steps.map(t=>{e.currentTime=n;const i=Zg(this,t,e);return r=Math.max(r,e.currentTime),i});return e.currentTime=r,{type:3,steps:i,options:ly(t.options)}}visitAnimate(t,e){const n=function(t,e){let n=null;if(t.hasOwnProperty("duration"))n=t;else if("number"==typeof t)return uy(Mg(t,e).duration,0,"");const r=t;if(r.split(/\s+/).some(t=>"{"==t.charAt(0)&&"{"==t.charAt(1))){const t=uy(0,0,"");return t.dynamic=!0,t.strValue=r,t}return n=n||Mg(r,e),uy(n.duration,n.delay,n.easing)}(t.timings,e.errors);let r;e.currentAnimateTimings=n;let i=t.styles?t.styles:Ud({});if(5==i.type)r=this.visitKeyframes(i,e);else{let i=t.styles,s=!1;if(!i){s=!0;const t={};n.easing&&(t.easing=n.easing),i=Ud(t)}e.currentTime+=n.duration+n.delay;const o=this.visitStyle(i,e);o.isEmptyStep=s,r=o}return e.currentAnimateTimings=null,{type:4,timings:n,style:r,options:null}}visitStyle(t,e){const n=this._makeStyleAst(t,e);return this._validateStyleAst(n,e),n}_makeStyleAst(t,e){const n=[];Array.isArray(t.styles)?t.styles.forEach(t=>{"string"==typeof t?"*"==t?n.push(t):e.errors.push(`The provided style string value ${t} is not allowed.`):n.push(t)}):n.push(t.styles);let r=!1,i=null;return n.forEach(t=>{if(ay(t)){const e=t,n=e.easing;if(n&&(i=n,delete e.easing),!r)for(let t in e)if(e[t].toString().indexOf("{{")>=0){r=!0;break}}}),{type:6,styles:n,easing:i,offset:t.offset,containsDynamicStyles:r,options:null}}_validateStyleAst(t,e){const n=e.currentAnimateTimings;let r=e.currentTime,i=e.currentTime;n&&i>0&&(i-=n.duration+n.delay),t.styles.forEach(t=>{"string"!=typeof t&&Object.keys(t).forEach(n=>{if(!this._driver.validateStyleProperty(n))return void e.errors.push(`The provided animation property "${n}" is not a supported CSS property for animations`);const s=e.collectedStyles[e.currentQuerySelector],o=s[n];let a=!0;o&&(i!=r&&i>=o.startTime&&r<=o.endTime&&(e.errors.push(`The CSS property "${n}" that exists between the times of "${o.startTime}ms" and "${o.endTime}ms" is also being animated in a parallel animation between the times of "${i}ms" and "${r}ms"`),a=!1),i=o.startTime),a&&(s[n]={startTime:i,endTime:r}),e.options&&function(t,e,n){const r=e.params||{},i=Wg(t);i.length&&i.forEach(t=>{r.hasOwnProperty(t)||n.push(`Unable to resolve the local animation param ${t} in the given list of values`)})}(t[n],e.options,e.errors)})})}visitKeyframes(t,e){const n={type:5,styles:[],options:null};if(!e.currentAnimateTimings)return e.errors.push("keyframes() must be placed inside of a call to animate()"),n;let r=0;const i=[];let s=!1,o=!1,a=0;const l=t.steps.map(t=>{const n=this._makeStyleAst(t,e);let l=null!=n.offset?n.offset:function(t){if("string"==typeof t)return null;let e=null;if(Array.isArray(t))t.forEach(t=>{if(ay(t)&&t.hasOwnProperty("offset")){const n=t;e=parseFloat(n.offset),delete n.offset}});else if(ay(t)&&t.hasOwnProperty("offset")){const n=t;e=parseFloat(n.offset),delete n.offset}return e}(n.styles),u=0;return null!=l&&(r++,u=n.offset=l),o=o||u<0||u>1,s=s||u<a,a=u,i.push(u),n});o&&e.errors.push("Please ensure that all keyframe offsets are between 0 and 1"),s&&e.errors.push("Please ensure that all keyframe offsets are in order");const u=t.steps.length;let c=0;r>0&&r<u?e.errors.push("Not all style() steps within the declared keyframes() contain offsets"):0==r&&(c=1/(u-1));const h=u-1,d=e.currentTime,f=e.currentAnimateTimings,p=f.duration;return l.forEach((t,r)=>{const s=c>0?r==h?1:c*r:i[r],o=s*p;e.currentTime=d+f.delay+o,f.duration=o,this._validateStyleAst(t,e),t.offset=s,n.styles.push(t)}),n}visitReference(t,e){return{type:8,animation:Zg(this,Ug(t.animation),e),options:ly(t.options)}}visitAnimateChild(t,e){return e.depCount++,{type:9,options:ly(t.options)}}visitAnimateRef(t,e){return{type:10,animation:this.visitReference(t.animation,e),options:ly(t.options)}}visitQuery(t,e){const n=e.currentQuerySelector,r=t.options||{};e.queryCount++,e.currentQuery=t;const[i,s]=function(t){const e=!!t.split(/\s*,\s*/).find(t=>":self"==t);return e&&(t=t.replace(ry,"")),[t=t.replace(/@\*/g,".ng-trigger").replace(/@\w+/g,t=>".ng-trigger-"+t.substr(1)).replace(/:animating/g,".ng-animating"),e]}(t.selector);e.currentQuerySelector=n.length?n+" "+i:i,vg(e.collectedStyles,e.currentQuerySelector,{});const o=Zg(this,Ug(t.animation),e);return e.currentQuery=null,e.currentQuerySelector=n,{type:11,selector:i,limit:r.limit||0,optional:!!r.optional,includeSelf:s,animation:o,originalSelector:t.selector,options:ly(t.options)}}visitStagger(t,e){e.currentQuery||e.errors.push("stagger() can only be used inside of query()");const n="full"===t.timings?{duration:0,delay:0,easing:"full"}:Mg(t.timings,e.errors,!0);return{type:12,animation:Zg(this,Ug(t.animation),e),timings:n,options:null}}}class oy{constructor(t){this.errors=t,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles={},this.options=null}}function ay(t){return!Array.isArray(t)&&"object"==typeof t}function ly(t){var e;return t?(t=$g(t)).params&&(t.params=(e=t.params)?$g(e):null):t={},t}function uy(t,e,n){return{duration:t,delay:e,easing:n}}function cy(t,e,n,r,i,s,o=null,a=!1){return{type:1,element:t,keyframes:e,preStyleProps:n,postStyleProps:r,duration:i,delay:s,totalTime:i+s,easing:o,subTimeline:a}}class hy{constructor(){this._map=new Map}consume(t){let e=this._map.get(t);return e?this._map.delete(t):e=[],e}append(t,e){let n=this._map.get(t);n||this._map.set(t,n=[]),n.push(...e)}has(t){return this._map.has(t)}clear(){this._map.clear()}}const dy=new RegExp(":enter","g"),fy=new RegExp(":leave","g");function py(t,e,n,r,i,s={},o={},a,l,u=[]){return(new my).buildKeyframes(t,e,n,r,i,s,o,a,l,u)}class my{buildKeyframes(t,e,n,r,i,s,o,a,l,u=[]){l=l||new hy;const c=new yy(t,e,l,r,i,u,[]);c.options=a,c.currentTimeline.setStyles([s],null,c.errors,a),Zg(this,n,c);const h=c.timelines.filter(t=>t.containsAnimation());if(h.length&&Object.keys(o).length){const t=h[h.length-1];t.allowOnlyTimelineStyles()||t.setStyles([o],null,c.errors,a)}return h.length?h.map(t=>t.buildKeyframes()):[cy(e,[],[],[],0,0,"",!1)]}visitTrigger(t,e){}visitState(t,e){}visitTransition(t,e){}visitAnimateChild(t,e){const n=e.subInstructions.consume(e.element);if(n){const r=e.createSubContext(t.options),i=e.currentTimeline.currentTime,s=this._visitSubInstructions(n,r,r.options);i!=s&&e.transformIntoNewTimeline(s)}e.previousNode=t}visitAnimateRef(t,e){const n=e.createSubContext(t.options);n.transformIntoNewTimeline(),this.visitReference(t.animation,n),e.transformIntoNewTimeline(n.currentTimeline.currentTime),e.previousNode=t}_visitSubInstructions(t,e,n){let r=e.currentTimeline.currentTime;const i=null!=n.duration?Rg(n.duration):null,s=null!=n.delay?Rg(n.delay):null;return 0!==i&&t.forEach(t=>{const n=e.appendInstructionToTimeline(t,i,s);r=Math.max(r,n.duration+n.delay)}),r}visitReference(t,e){e.updateOptions(t.options,!0),Zg(this,t.animation,e),e.previousNode=t}visitSequence(t,e){const n=e.subContextCount;let r=e;const i=t.options;if(i&&(i.params||i.delay)&&(r=e.createSubContext(i),r.transformIntoNewTimeline(),null!=i.delay)){6==r.previousNode.type&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=gy);const t=Rg(i.delay);r.delayNextStep(t)}t.steps.length&&(t.steps.forEach(t=>Zg(this,t,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>n&&r.transformIntoNewTimeline()),e.previousNode=t}visitGroup(t,e){const n=[];let r=e.currentTimeline.currentTime;const i=t.options&&t.options.delay?Rg(t.options.delay):0;t.steps.forEach(s=>{const o=e.createSubContext(t.options);i&&o.delayNextStep(i),Zg(this,s,o),r=Math.max(r,o.currentTimeline.currentTime),n.push(o.currentTimeline)}),n.forEach(t=>e.currentTimeline.mergeTimelineCollectedStyles(t)),e.transformIntoNewTimeline(r),e.previousNode=t}_visitTiming(t,e){if(t.dynamic){const n=t.strValue;return Mg(e.params?qg(n,e.params,e.errors):n,e.errors)}return{duration:t.duration,delay:t.delay,easing:t.easing}}visitAnimate(t,e){const n=e.currentAnimateTimings=this._visitTiming(t.timings,e),r=e.currentTimeline;n.delay&&(e.incrementTime(n.delay),r.snapshotCurrentStyles());const i=t.style;5==i.type?this.visitKeyframes(i,e):(e.incrementTime(n.duration),this.visitStyle(i,e),r.applyStylesToKeyframe()),e.currentAnimateTimings=null,e.previousNode=t}visitStyle(t,e){const n=e.currentTimeline,r=e.currentAnimateTimings;!r&&n.getCurrentStyleProperties().length&&n.forwardFrame();const i=r&&r.easing||t.easing;t.isEmptyStep?n.applyEmptyStep(i):n.setStyles(t.styles,i,e.errors,e.options),e.previousNode=t}visitKeyframes(t,e){const n=e.currentAnimateTimings,r=e.currentTimeline.duration,i=n.duration,s=e.createSubContext().currentTimeline;s.easing=n.easing,t.styles.forEach(t=>{s.forwardTime((t.offset||0)*i),s.setStyles(t.styles,t.easing,e.errors,e.options),s.applyStylesToKeyframe()}),e.currentTimeline.mergeTimelineCollectedStyles(s),e.transformIntoNewTimeline(r+i),e.previousNode=t}visitQuery(t,e){const n=e.currentTimeline.currentTime,r=t.options||{},i=r.delay?Rg(r.delay):0;i&&(6===e.previousNode.type||0==n&&e.currentTimeline.getCurrentStyleProperties().length)&&(e.currentTimeline.snapshotCurrentStyles(),e.previousNode=gy);let s=n;const o=e.invokeQuery(t.selector,t.originalSelector,t.limit,t.includeSelf,!!r.optional,e.errors);e.currentQueryTotal=o.length;let a=null;o.forEach((n,r)=>{e.currentQueryIndex=r;const o=e.createSubContext(t.options,n);i&&o.delayNextStep(i),n===e.element&&(a=o.currentTimeline),Zg(this,t.animation,o),o.currentTimeline.applyStylesToKeyframe(),s=Math.max(s,o.currentTimeline.currentTime)}),e.currentQueryIndex=0,e.currentQueryTotal=0,e.transformIntoNewTimeline(s),a&&(e.currentTimeline.mergeTimelineCollectedStyles(a),e.currentTimeline.snapshotCurrentStyles()),e.previousNode=t}visitStagger(t,e){const n=e.parentContext,r=e.currentTimeline,i=t.timings,s=Math.abs(i.duration),o=s*(e.currentQueryTotal-1);let a=s*e.currentQueryIndex;switch(i.duration<0?"reverse":i.easing){case"reverse":a=o-a;break;case"full":a=n.currentStaggerTime}const l=e.currentTimeline;a&&l.delayNextStep(a);const u=l.currentTime;Zg(this,t.animation,e),e.previousNode=t,n.currentStaggerTime=r.currentTime-u+(r.startTime-n.currentTimeline.startTime)}}const gy={};class yy{constructor(t,e,n,r,i,s,o,a){this._driver=t,this.element=e,this.subInstructions=n,this._enterClassName=r,this._leaveClassName=i,this.errors=s,this.timelines=o,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=gy,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=a||new vy(this._driver,e,0),o.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(t,e){if(!t)return;const n=t;let r=this.options;null!=n.duration&&(r.duration=Rg(n.duration)),null!=n.delay&&(r.delay=Rg(n.delay));const i=n.params;if(i){let t=r.params;t||(t=this.options.params={}),Object.keys(i).forEach(n=>{e&&t.hasOwnProperty(n)||(t[n]=qg(i[n],t,this.errors))})}}_copyOptions(){const t={};if(this.options){const e=this.options.params;if(e){const n=t.params={};Object.keys(e).forEach(t=>{n[t]=e[t]})}}return t}createSubContext(t=null,e,n){const r=e||this.element,i=new yy(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,n||0));return i.previousNode=this.previousNode,i.currentAnimateTimings=this.currentAnimateTimings,i.options=this._copyOptions(),i.updateOptions(t),i.currentQueryIndex=this.currentQueryIndex,i.currentQueryTotal=this.currentQueryTotal,i.parentContext=this,this.subContextCount++,i}transformIntoNewTimeline(t){return this.previousNode=gy,this.currentTimeline=this.currentTimeline.fork(this.element,t),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(t,e,n){const r={duration:null!=e?e:t.duration,delay:this.currentTimeline.currentTime+(null!=n?n:0)+t.delay,easing:""},i=new by(this._driver,t.element,t.keyframes,t.preStyleProps,t.postStyleProps,r,t.stretchStartingKeyframe);return this.timelines.push(i),r}incrementTime(t){this.currentTimeline.forwardTime(this.currentTimeline.duration+t)}delayNextStep(t){t>0&&this.currentTimeline.delayNextStep(t)}invokeQuery(t,e,n,r,i,s){let o=[];if(r&&o.push(this.element),t.length>0){t=(t=t.replace(dy,"."+this._enterClassName)).replace(fy,"."+this._leaveClassName);let e=this._driver.query(this.element,t,1!=n);0!==n&&(e=n<0?e.slice(e.length+n,e.length):e.slice(0,n)),o.push(...e)}return i||0!=o.length||s.push(`\`query("${e}")\` returned zero elements. (Use \`query("${e}", { optional: true })\` if you wish to allow this.)`),o}}class vy{constructor(t,e,n,r){this._driver=t,this.element=e,this.startTime=n,this._elementTimelineStylesLookup=r,this.duration=0,this._previousKeyframe={},this._currentKeyframe={},this._keyframes=new Map,this._styleSummary={},this._pendingStyles={},this._backFill={},this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._localTimelineStyles=Object.create(this._backFill,{}),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(e),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(e,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.getCurrentStyleProperties().length>0;default:return!0}}getCurrentStyleProperties(){return Object.keys(this._currentKeyframe)}get currentTime(){return this.startTime+this.duration}delayNextStep(t){const e=1==this._keyframes.size&&Object.keys(this._pendingStyles).length;this.duration||e?(this.forwardTime(this.currentTime+t),e&&this.snapshotCurrentStyles()):this.startTime+=t}fork(t,e){return this.applyStylesToKeyframe(),new vy(this._driver,t,e||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=Object.create(this._backFill,{}),this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(t){this.applyStylesToKeyframe(),this.duration=t,this._loadKeyframe()}_updateStyle(t,e){this._localTimelineStyles[t]=e,this._globalTimelineStyles[t]=e,this._styleSummary[t]={time:this.currentTime,value:e}}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(t){t&&(this._previousKeyframe.easing=t),Object.keys(this._globalTimelineStyles).forEach(t=>{this._backFill[t]=this._globalTimelineStyles[t]||"*",this._currentKeyframe[t]="*"}),this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(t,e,n,r){e&&(this._previousKeyframe.easing=e);const i=r&&r.params||{},s=function(t,e){const n={};let r;return t.forEach(t=>{"*"===t?(r=r||Object.keys(e),r.forEach(t=>{n[t]="*"})):Pg(t,!1,n)}),n}(t,this._globalTimelineStyles);Object.keys(s).forEach(t=>{const e=qg(s[t],i,n);this._pendingStyles[t]=e,this._localTimelineStyles.hasOwnProperty(t)||(this._backFill[t]=this._globalTimelineStyles.hasOwnProperty(t)?this._globalTimelineStyles[t]:"*"),this._updateStyle(t,e)})}applyStylesToKeyframe(){const t=this._pendingStyles,e=Object.keys(t);0!=e.length&&(this._pendingStyles={},e.forEach(e=>{this._currentKeyframe[e]=t[e]}),Object.keys(this._localTimelineStyles).forEach(t=>{this._currentKeyframe.hasOwnProperty(t)||(this._currentKeyframe[t]=this._localTimelineStyles[t])}))}snapshotCurrentStyles(){Object.keys(this._localTimelineStyles).forEach(t=>{const e=this._localTimelineStyles[t];this._pendingStyles[t]=e,this._updateStyle(t,e)})}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const t=[];for(let e in this._currentKeyframe)t.push(e);return t}mergeTimelineCollectedStyles(t){Object.keys(t._styleSummary).forEach(e=>{const n=this._styleSummary[e],r=t._styleSummary[e];(!n||r.time>n.time)&&this._updateStyle(e,r.value)})}buildKeyframes(){this.applyStylesToKeyframe();const t=new Set,e=new Set,n=1===this._keyframes.size&&0===this.duration;let r=[];this._keyframes.forEach((i,s)=>{const o=Pg(i,!0);Object.keys(o).forEach(n=>{const r=o[n];"!"==r?t.add(n):"*"==r&&e.add(n)}),n||(o.offset=s/this.duration),r.push(o)});const i=t.size?Hg(t.values()):[],s=e.size?Hg(e.values()):[];if(n){const t=r[0],e=$g(t);t.offset=0,e.offset=1,r=[t,e]}return cy(this.element,r,i,s,this.duration,this.startTime,this.easing,!1)}}class by extends vy{constructor(t,e,n,r,i,s,o=!1){super(t,e,s.delay),this.element=e,this.keyframes=n,this.preStyleProps=r,this.postStyleProps=i,this._stretchStartingKeyframe=o,this.timings={duration:s.duration,delay:s.delay,easing:s.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let t=this.keyframes,{delay:e,duration:n,easing:r}=this.timings;if(this._stretchStartingKeyframe&&e){const i=[],s=n+e,o=e/s,a=Pg(t[0],!1);a.offset=0,i.push(a);const l=Pg(t[0],!1);l.offset=xy(o),i.push(l);const u=t.length-1;for(let r=1;r<=u;r++){let o=Pg(t[r],!1);o.offset=xy((e+o.offset*n)/s),i.push(o)}n=s,e=0,r="",t=i}return cy(this.element,t,this.preStyleProps,this.postStyleProps,n,e,r,!0)}}function xy(t,e=3){const n=Math.pow(10,e-1);return Math.round(t*n)/n}class _y{}class wy extends _y{normalizePropertyName(t,e){return Yg(t)}normalizeStyleValue(t,e,n,r){let i="";const s=n.toString().trim();if(Sy[e]&&0!==n&&"0"!==n)if("number"==typeof n)i="px";else{const e=n.match(/^[+-]?[\d\.]+([a-z]*)$/);e&&0==e[1].length&&r.push(`Please provide a CSS unit value for ${t}:${n}`)}return s+i}}const Sy=(()=>function(t){const e={};return t.forEach(t=>e[t]=!0),e}("width,height,minWidth,minHeight,maxWidth,maxHeight,left,top,bottom,right,fontSize,outlineWidth,outlineOffset,paddingTop,paddingLeft,paddingBottom,paddingRight,marginTop,marginLeft,marginBottom,marginRight,borderRadius,borderWidth,borderTopWidth,borderLeftWidth,borderRightWidth,borderBottomWidth,textIndent,perspective".split(",")))();function Cy(t,e,n,r,i,s,o,a,l,u,c,h,d){return{type:0,element:t,triggerName:e,isRemovalTransition:i,fromState:n,fromStyles:s,toState:r,toStyles:o,timelines:a,queriedElements:l,preStyleProps:u,postStyleProps:c,totalTime:h,errors:d}}const Ey={};class ky{constructor(t,e,n){this._triggerName=t,this.ast=e,this._stateStyles=n}match(t,e,n,r){return function(t,e,n,r,i){return t.some(t=>t(e,n,r,i))}(this.ast.matchers,t,e,n,r)}buildStyles(t,e,n){const r=this._stateStyles["*"],i=this._stateStyles[t],s=r?r.buildStyles(e,n):{};return i?i.buildStyles(e,n):s}build(t,e,n,r,i,s,o,a,l,u){const c=[],h=this.ast.options&&this.ast.options.params||Ey,d=this.buildStyles(n,o&&o.params||Ey,c),f=a&&a.params||Ey,p=this.buildStyles(r,f,c),m=new Set,g=new Map,y=new Map,v="void"===r,b={params:Object.assign({},h,f)},x=u?[]:py(t,e,this.ast.animation,i,s,d,p,b,l,c);let _=0;if(x.forEach(t=>{_=Math.max(t.duration+t.delay,_)}),c.length)return Cy(e,this._triggerName,n,r,v,d,p,[],[],g,y,_,c);x.forEach(t=>{const n=t.element,r=vg(g,n,{});t.preStyleProps.forEach(t=>r[t]=!0);const i=vg(y,n,{});t.postStyleProps.forEach(t=>i[t]=!0),n!==e&&m.add(n)});const w=Hg(m.values());return Cy(e,this._triggerName,n,r,v,d,p,x,w,g,y,_)}}class Ay{constructor(t,e){this.styles=t,this.defaultParams=e}buildStyles(t,e){const n={},r=$g(this.defaultParams);return Object.keys(t).forEach(e=>{const n=t[e];null!=n&&(r[e]=n)}),this.styles.styles.forEach(t=>{if("string"!=typeof t){const i=t;Object.keys(i).forEach(t=>{let s=i[t];s.length>1&&(s=qg(s,r,e)),n[t]=s})}}),n}}class Dy{constructor(t,e){this.name=t,this.ast=e,this.transitionFactories=[],this.states={},e.states.forEach(t=>{this.states[t.name]=new Ay(t.style,t.options&&t.options.params||{})}),Ny(this.states,"true","1"),Ny(this.states,"false","0"),e.transitions.forEach(e=>{this.transitionFactories.push(new ky(t,e,this.states))}),this.fallbackTransition=new ky(t,{type:1,animation:{type:2,steps:[],options:null},matchers:[(t,e)=>!0],options:null,queryCount:0,depCount:0},this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(t,e,n,r){return this.transitionFactories.find(i=>i.match(t,e,n,r))||null}matchStyles(t,e,n){return this.fallbackTransition.buildStyles(t,e,n)}}function Ny(t,e,n){t.hasOwnProperty(e)?t.hasOwnProperty(n)||(t[n]=t[e]):t.hasOwnProperty(n)&&(t[e]=t[n])}const Ty=new hy;class Oy{constructor(t,e,n){this.bodyNode=t,this._driver=e,this._normalizer=n,this._animations={},this._playersById={},this.players=[]}register(t,e){const n=[],r=iy(this._driver,e,n);if(n.length)throw new Error("Unable to build the animation due to the following errors: "+n.join("\n"));this._animations[t]=r}_buildPlayer(t,e,n){const r=t.element,i=pg(0,this._normalizer,0,t.keyframes,e,n);return this._driver.animate(r,i,t.duration,t.delay,t.easing,[],!0)}create(t,e,n={}){const r=[],i=this._animations[t];let s;const o=new Map;if(i?(s=py(this._driver,e,i,"ng-enter","ng-leave",{},{},n,Ty,r),s.forEach(t=>{const e=vg(o,t.element,{});t.postStyleProps.forEach(t=>e[t]=null)})):(r.push("The requested animation doesn't exist or has already been destroyed"),s=[]),r.length)throw new Error("Unable to create the animation due to the following errors: "+r.join("\n"));o.forEach((t,e)=>{Object.keys(t).forEach(n=>{t[n]=this._driver.computeStyle(e,n,"*")})});const a=fg(s.map(t=>{const e=o.get(t.element);return this._buildPlayer(t,{},e)}));return this._playersById[t]=a,a.onDestroy(()=>this.destroy(t)),this.players.push(a),a}destroy(t){const e=this._getPlayer(t);e.destroy(),delete this._playersById[t];const n=this.players.indexOf(e);n>=0&&this.players.splice(n,1)}_getPlayer(t){const e=this._playersById[t];if(!e)throw new Error("Unable to find the timeline player referenced by "+t);return e}listen(t,e,n,r){const i=yg(e,"","","");return mg(this._getPlayer(t),n,i,r),()=>{}}command(t,e,n,r){if("register"==n)return void this.register(t,r[0]);if("create"==n)return void this.create(t,e,r[0]||{});const i=this._getPlayer(t);switch(n){case"play":i.play();break;case"pause":i.pause();break;case"reset":i.reset();break;case"restart":i.restart();break;case"finish":i.finish();break;case"init":i.init();break;case"setPosition":i.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(t)}}}const Iy=[],Ry={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},Fy={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0};class My{constructor(t,e=""){this.namespaceId=e;const n=t&&t.hasOwnProperty("value");if(this.value=null!=(r=n?t.value:t)?r:null,n){const e=$g(t);delete e.value,this.options=e}else this.options={};var r;this.options.params||(this.options.params={})}get params(){return this.options.params}absorbOptions(t){const e=t.params;if(e){const t=this.options.params;Object.keys(e).forEach(n=>{null==t[n]&&(t[n]=e[n])})}}}const $y=new My("void");class Py{constructor(t,e,n){this.id=t,this.hostElement=e,this._engine=n,this.players=[],this._triggers={},this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+t,Wy(e,this._hostClassName)}listen(t,e,n,r){if(!this._triggers.hasOwnProperty(e))throw new Error(`Unable to listen on the animation trigger event "${n}" because the animation trigger "${e}" doesn't exist!`);if(null==n||0==n.length)throw new Error(`Unable to listen on the animation trigger "${e}" because the provided event is undefined!`);if("start"!=(i=n)&&"done"!=i)throw new Error(`The provided animation trigger event "${n}" for the animation trigger "${e}" is not supported!`);var i;const s=vg(this._elementListeners,t,[]),o={name:e,phase:n,callback:r};s.push(o);const a=vg(this._engine.statesByElement,t,{});return a.hasOwnProperty(e)||(Wy(t,"ng-trigger"),Wy(t,"ng-trigger-"+e),a[e]=$y),()=>{this._engine.afterFlush(()=>{const t=s.indexOf(o);t>=0&&s.splice(t,1),this._triggers[e]||delete a[e]})}}register(t,e){return!this._triggers[t]&&(this._triggers[t]=e,!0)}_getTrigger(t){const e=this._triggers[t];if(!e)throw new Error(`The provided animation trigger "${t}" has not been registered!`);return e}trigger(t,e,n,r=!0){const i=this._getTrigger(e),s=new Ly(this.id,e,t);let o=this._engine.statesByElement.get(t);o||(Wy(t,"ng-trigger"),Wy(t,"ng-trigger-"+e),this._engine.statesByElement.set(t,o={}));let a=o[e];const l=new My(n,this.id);if(!(n&&n.hasOwnProperty("value"))&&a&&l.absorbOptions(a.options),o[e]=l,a||(a=$y),"void"!==l.value&&a.value===l.value){if(!function(t,e){const n=Object.keys(t),r=Object.keys(e);if(n.length!=r.length)return!1;for(let i=0;i<n.length;i++){const r=n[i];if(!e.hasOwnProperty(r)||t[r]!==e[r])return!1}return!0}(a.params,l.params)){const e=[],n=i.matchStyles(a.value,a.params,e),r=i.matchStyles(l.value,l.params,e);e.length?this._engine.reportError(e):this._engine.afterFlush(()=>{jg(t,n),Bg(t,r)})}return}const u=vg(this._engine.playersByElement,t,[]);u.forEach(t=>{t.namespaceId==this.id&&t.triggerName==e&&t.queued&&t.destroy()});let c=i.matchTransition(a.value,l.value,t,l.params),h=!1;if(!c){if(!r)return;c=i.fallbackTransition,h=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:e,transition:c,fromState:a,toState:l,player:s,isFallbackTransition:h}),h||(Wy(t,"ng-animate-queued"),s.onStart(()=>{qy(t,"ng-animate-queued")})),s.onDone(()=>{let e=this.players.indexOf(s);e>=0&&this.players.splice(e,1);const n=this._engine.playersByElement.get(t);if(n){let t=n.indexOf(s);t>=0&&n.splice(t,1)}}),this.players.push(s),u.push(s),s}deregister(t){delete this._triggers[t],this._engine.statesByElement.forEach((e,n)=>{delete e[t]}),this._elementListeners.forEach((e,n)=>{this._elementListeners.set(n,e.filter(e=>e.name!=t))})}clearElementCache(t){this._engine.statesByElement.delete(t),this._elementListeners.delete(t);const e=this._engine.playersByElement.get(t);e&&(e.forEach(t=>t.destroy()),this._engine.playersByElement.delete(t))}_signalRemovalForInnerTriggers(t,e,n=!1){this._engine.driver.query(t,".ng-trigger",!0).forEach(t=>{if(t.__ng_removed)return;const n=this._engine.fetchNamespacesByElement(t);n.size?n.forEach(n=>n.triggerLeaveAnimation(t,e,!1,!0)):this.clearElementCache(t)})}triggerLeaveAnimation(t,e,n,r){const i=this._engine.statesByElement.get(t);if(i){const s=[];if(Object.keys(i).forEach(e=>{if(this._triggers[e]){const n=this.trigger(t,e,"void",r);n&&s.push(n)}}),s.length)return this._engine.markElementAsRemoved(this.id,t,!0,e),n&&fg(s).onDone(()=>this._engine.processLeaveNode(t)),!0}return!1}prepareLeaveAnimationListeners(t){const e=this._elementListeners.get(t);if(e){const n=new Set;e.forEach(e=>{const r=e.name;if(n.has(r))return;n.add(r);const i=this._triggers[r].fallbackTransition,s=this._engine.statesByElement.get(t)[r]||$y,o=new My("void"),a=new Ly(this.id,r,t);this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:r,transition:i,fromState:s,toState:o,player:a,isFallbackTransition:!0})})}}removeNode(t,e){const n=this._engine;if(t.childElementCount&&this._signalRemovalForInnerTriggers(t,e,!0),this.triggerLeaveAnimation(t,e,!0))return;let r=!1;if(n.totalAnimations){const e=n.players.length?n.playersByQueriedElement.get(t):[];if(e&&e.length)r=!0;else{let e=t;for(;e=e.parentNode;)if(n.statesByElement.get(e)){r=!0;break}}}this.prepareLeaveAnimationListeners(t),r?n.markElementAsRemoved(this.id,t,!1,e):(n.afterFlush(()=>this.clearElementCache(t)),n.destroyInnerAnimations(t),n._onRemovalComplete(t,e))}insertNode(t,e){Wy(t,this._hostClassName)}drainQueuedTransitions(t){const e=[];return this._queue.forEach(n=>{const r=n.player;if(r.destroyed)return;const i=n.element,s=this._elementListeners.get(i);s&&s.forEach(e=>{if(e.name==n.triggerName){const r=yg(i,n.triggerName,n.fromState.value,n.toState.value);r._data=t,mg(n.player,e.phase,r,e.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):e.push(n)}),this._queue=[],e.sort((t,e)=>{const n=t.transition.ast.depCount,r=e.transition.ast.depCount;return 0==n||0==r?n-r:this._engine.driver.containsElement(t.element,e.element)?1:-1})}destroy(t){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,t)}elementContainsData(t){let e=!1;return this._elementListeners.has(t)&&(e=!0),e=!!this._queue.find(e=>e.element===t)||e,e}}class zy{constructor(t,e,n){this.bodyNode=t,this.driver=e,this._normalizer=n,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(t,e)=>{}}_onRemovalComplete(t,e){this.onRemovalComplete(t,e)}get queuedPlayers(){const t=[];return this._namespaceList.forEach(e=>{e.players.forEach(e=>{e.queued&&t.push(e)})}),t}createNamespace(t,e){const n=new Py(t,e,this);return e.parentNode?this._balanceNamespaceList(n,e):(this.newHostElements.set(e,n),this.collectEnterElement(e)),this._namespaceLookup[t]=n}_balanceNamespaceList(t,e){const n=this._namespaceList.length-1;if(n>=0){let r=!1;for(let i=n;i>=0;i--)if(this.driver.containsElement(this._namespaceList[i].hostElement,e)){this._namespaceList.splice(i+1,0,t),r=!0;break}r||this._namespaceList.splice(0,0,t)}else this._namespaceList.push(t);return this.namespacesByHostElement.set(e,t),t}register(t,e){let n=this._namespaceLookup[t];return n||(n=this.createNamespace(t,e)),n}registerTrigger(t,e,n){let r=this._namespaceLookup[t];r&&r.register(e,n)&&this.totalAnimations++}destroy(t,e){if(!t)return;const n=this._fetchNamespace(t);this.afterFlush(()=>{this.namespacesByHostElement.delete(n.hostElement),delete this._namespaceLookup[t];const e=this._namespaceList.indexOf(n);e>=0&&this._namespaceList.splice(e,1)}),this.afterFlushAnimationsDone(()=>n.destroy(e))}_fetchNamespace(t){return this._namespaceLookup[t]}fetchNamespacesByElement(t){const e=new Set,n=this.statesByElement.get(t);if(n){const t=Object.keys(n);for(let r=0;r<t.length;r++){const i=n[t[r]].namespaceId;if(i){const t=this._fetchNamespace(i);t&&e.add(t)}}}return e}trigger(t,e,n,r){if(By(e)){const i=this._fetchNamespace(t);if(i)return i.trigger(e,n,r),!0}return!1}insertNode(t,e,n,r){if(!By(e))return;const i=e.__ng_removed;if(i&&i.setForRemoval){i.setForRemoval=!1,i.setForMove=!0;const t=this.collectedLeaveElements.indexOf(e);t>=0&&this.collectedLeaveElements.splice(t,1)}if(t){const r=this._fetchNamespace(t);r&&r.insertNode(e,n)}r&&this.collectEnterElement(e)}collectEnterElement(t){this.collectedEnterElements.push(t)}markElementAsDisabled(t,e){e?this.disabledNodes.has(t)||(this.disabledNodes.add(t),Wy(t,"ng-animate-disabled")):this.disabledNodes.has(t)&&(this.disabledNodes.delete(t),qy(t,"ng-animate-disabled"))}removeNode(t,e,n,r){if(By(e)){const i=t?this._fetchNamespace(t):null;if(i?i.removeNode(e,r):this.markElementAsRemoved(t,e,!1,r),n){const n=this.namespacesByHostElement.get(e);n&&n.id!==t&&n.removeNode(e,r)}}else this._onRemovalComplete(e,r)}markElementAsRemoved(t,e,n,r){this.collectedLeaveElements.push(e),e.__ng_removed={namespaceId:t,setForRemoval:r,hasAnimation:n,removedBeforeQueried:!1}}listen(t,e,n,r,i){return By(e)?this._fetchNamespace(t).listen(e,n,r,i):()=>{}}_buildInstruction(t,e,n,r,i){return t.transition.build(this.driver,t.element,t.fromState.value,t.toState.value,n,r,t.fromState.options,t.toState.options,e,i)}destroyInnerAnimations(t){let e=this.driver.query(t,".ng-trigger",!0);e.forEach(t=>this.destroyActiveAnimationsForElement(t)),0!=this.playersByQueriedElement.size&&(e=this.driver.query(t,".ng-animating",!0),e.forEach(t=>this.finishActiveQueriedAnimationOnElement(t)))}destroyActiveAnimationsForElement(t){const e=this.playersByElement.get(t);e&&e.forEach(t=>{t.queued?t.markedForDestroy=!0:t.destroy()})}finishActiveQueriedAnimationOnElement(t){const e=this.playersByQueriedElement.get(t);e&&e.forEach(t=>t.finish())}whenRenderingDone(){return new Promise(t=>{if(this.players.length)return fg(this.players).onDone(()=>t());t()})}processLeaveNode(t){const e=t.__ng_removed;if(e&&e.setForRemoval){if(t.__ng_removed=Ry,e.namespaceId){this.destroyInnerAnimations(t);const n=this._fetchNamespace(e.namespaceId);n&&n.clearElementCache(t)}this._onRemovalComplete(t,e.setForRemoval)}this.driver.matchesElement(t,".ng-animate-disabled")&&this.markElementAsDisabled(t,!1),this.driver.query(t,".ng-animate-disabled",!0).forEach(t=>{this.markElementAsDisabled(t,!1)})}flush(t=-1){let e=[];if(this.newHostElements.size&&(this.newHostElements.forEach((t,e)=>this._balanceNamespaceList(t,e)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let n=0;n<this.collectedEnterElements.length;n++)Wy(this.collectedEnterElements[n],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const n=[];try{e=this._flushAnimations(n,t)}finally{for(let t=0;t<n.length;t++)n[t]()}}else for(let n=0;n<this.collectedLeaveElements.length;n++)this.processLeaveNode(this.collectedLeaveElements[n]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(t=>t()),this._flushFns=[],this._whenQuietFns.length){const t=this._whenQuietFns;this._whenQuietFns=[],e.length?fg(e).onDone(()=>{t.forEach(t=>t())}):t.forEach(t=>t())}}reportError(t){throw new Error("Unable to process animations due to the following failed trigger transitions\n "+t.join("\n"))}_flushAnimations(t,e){const n=new hy,r=[],i=new Map,s=[],o=new Map,a=new Map,l=new Map,u=new Set;this.disabledNodes.forEach(t=>{u.add(t);const e=this.driver.query(t,".ng-animate-queued",!0);for(let n=0;n<e.length;n++)u.add(e[n])});const c=this.bodyNode,h=Array.from(this.statesByElement.keys()),d=Vy(h,this.collectedEnterElements),f=new Map;let p=0;d.forEach((t,e)=>{const n="ng-enter"+p++;f.set(e,n),t.forEach(t=>Wy(t,n))});const m=[],g=new Set,y=new Set;for(let T=0;T<this.collectedLeaveElements.length;T++){const t=this.collectedLeaveElements[T],e=t.__ng_removed;e&&e.setForRemoval&&(m.push(t),g.add(t),e.hasAnimation?this.driver.query(t,".ng-star-inserted",!0).forEach(t=>g.add(t)):y.add(t))}const v=new Map,b=Vy(h,Array.from(g));b.forEach((t,e)=>{const n="ng-leave"+p++;v.set(e,n),t.forEach(t=>Wy(t,n))}),t.push(()=>{d.forEach((t,e)=>{const n=f.get(e);t.forEach(t=>qy(t,n))}),b.forEach((t,e)=>{const n=v.get(e);t.forEach(t=>qy(t,n))}),m.forEach(t=>{this.processLeaveNode(t)})});const x=[],_=[];for(let T=this._namespaceList.length-1;T>=0;T--)this._namespaceList[T].drainQueuedTransitions(e).forEach(t=>{const e=t.player,i=t.element;if(x.push(e),this.collectedEnterElements.length){const t=i.__ng_removed;if(t&&t.setForMove)return void e.destroy()}const u=!c||!this.driver.containsElement(c,i),h=v.get(i),d=f.get(i),p=this._buildInstruction(t,n,d,h,u);if(p.errors&&p.errors.length)_.push(p);else{if(u)return e.onStart(()=>jg(i,p.fromStyles)),e.onDestroy(()=>Bg(i,p.toStyles)),void r.push(e);if(t.isFallbackTransition)return e.onStart(()=>jg(i,p.fromStyles)),e.onDestroy(()=>Bg(i,p.toStyles)),void r.push(e);p.timelines.forEach(t=>t.stretchStartingKeyframe=!0),n.append(i,p.timelines),s.push({instruction:p,player:e,element:i}),p.queriedElements.forEach(t=>vg(o,t,[]).push(e)),p.preStyleProps.forEach((t,e)=>{const n=Object.keys(t);if(n.length){let t=a.get(e);t||a.set(e,t=new Set),n.forEach(e=>t.add(e))}}),p.postStyleProps.forEach((t,e)=>{const n=Object.keys(t);let r=l.get(e);r||l.set(e,r=new Set),n.forEach(t=>r.add(t))})}});if(_.length){const t=[];_.forEach(e=>{t.push(`@${e.triggerName} has failed due to:\n`),e.errors.forEach(e=>t.push(`- ${e}\n`))}),x.forEach(t=>t.destroy()),this.reportError(t)}const w=new Map,S=new Map;s.forEach(t=>{const e=t.element;n.has(e)&&(S.set(e,e),this._beforeAnimationBuild(t.player.namespaceId,t.instruction,w))}),r.forEach(t=>{const e=t.element;this._getPreviousPlayers(e,!1,t.namespaceId,t.triggerName,null).forEach(t=>{vg(w,e,[]).push(t),t.destroy()})});const C=m.filter(t=>Gy(t,a,l)),E=new Map;Uy(E,this.driver,y,l,"*").forEach(t=>{Gy(t,a,l)&&C.push(t)});const k=new Map;d.forEach((t,e)=>{Uy(k,this.driver,new Set(t),a,"!")}),C.forEach(t=>{const e=E.get(t),n=k.get(t);E.set(t,Object.assign({},e,n))});const A=[],D=[],N={};s.forEach(t=>{const{element:e,player:s,instruction:o}=t;if(n.has(e)){if(u.has(e))return s.onDestroy(()=>Bg(e,o.toStyles)),s.disabled=!0,s.overrideTotalTime(o.totalTime),void r.push(s);let t=N;if(S.size>1){let n=e;const r=[];for(;n=n.parentNode;){const e=S.get(n);if(e){t=e;break}r.push(n)}r.forEach(e=>S.set(e,t))}const n=this._buildAnimation(s.namespaceId,o,w,i,k,E);if(s.setRealPlayer(n),t===N)A.push(s);else{const e=this.playersByElement.get(t);e&&e.length&&(s.parentPlayer=fg(e)),r.push(s)}}else jg(e,o.fromStyles),s.onDestroy(()=>Bg(e,o.toStyles)),D.push(s),u.has(e)&&r.push(s)}),D.forEach(t=>{const e=i.get(t.element);if(e&&e.length){const n=fg(e);t.setRealPlayer(n)}}),r.forEach(t=>{t.parentPlayer?t.syncPlayerEvents(t.parentPlayer):t.destroy()});for(let T=0;T<m.length;T++){const t=m[T],e=t.__ng_removed;if(qy(t,"ng-leave"),e&&e.hasAnimation)continue;let n=[];if(o.size){let e=o.get(t);e&&e.length&&n.push(...e);let r=this.driver.query(t,".ng-animating",!0);for(let t=0;t<r.length;t++){let e=o.get(r[t]);e&&e.length&&n.push(...e)}}const r=n.filter(t=>!t.destroyed);r.length?Hy(this,t,r):this.processLeaveNode(t)}return m.length=0,A.forEach(t=>{this.players.push(t),t.onDone(()=>{t.destroy();const e=this.players.indexOf(t);this.players.splice(e,1)}),t.play()}),A}elementContainsData(t,e){let n=!1;const r=e.__ng_removed;return r&&r.setForRemoval&&(n=!0),this.playersByElement.has(e)&&(n=!0),this.playersByQueriedElement.has(e)&&(n=!0),this.statesByElement.has(e)&&(n=!0),this._fetchNamespace(t).elementContainsData(e)||n}afterFlush(t){this._flushFns.push(t)}afterFlushAnimationsDone(t){this._whenQuietFns.push(t)}_getPreviousPlayers(t,e,n,r,i){let s=[];if(e){const e=this.playersByQueriedElement.get(t);e&&(s=e)}else{const e=this.playersByElement.get(t);if(e){const t=!i||"void"==i;e.forEach(e=>{e.queued||(t||e.triggerName==r)&&s.push(e)})}}return(n||r)&&(s=s.filter(t=>!(n&&n!=t.namespaceId||r&&r!=t.triggerName))),s}_beforeAnimationBuild(t,e,n){const r=e.element,i=e.isRemovalTransition?void 0:t,s=e.isRemovalTransition?void 0:e.triggerName;for(const o of e.timelines){const t=o.element,a=t!==r,l=vg(n,t,[]);this._getPreviousPlayers(t,a,i,s,e.toState).forEach(t=>{const e=t.getRealPlayer();e.beforeDestroy&&e.beforeDestroy(),t.destroy(),l.push(t)})}jg(r,e.fromStyles)}_buildAnimation(t,e,n,r,i,s){const o=e.triggerName,a=e.element,l=[],u=new Set,c=new Set,h=e.timelines.map(e=>{const h=e.element;u.add(h);const d=h.__ng_removed;if(d&&d.removedBeforeQueried)return new Wd(e.duration,e.delay);const f=h!==a,p=function(t){const e=[];return function t(e,n){for(let r=0;r<e.length;r++){const i=e[r];i instanceof qd?t(i.players,n):n.push(i)}}(t,e),e}((n.get(h)||Iy).map(t=>t.getRealPlayer())).filter(t=>!!t.element&&t.element===h),m=i.get(h),g=s.get(h),y=pg(0,this._normalizer,0,e.keyframes,m,g),v=this._buildPlayer(e,y,p);if(e.subTimeline&&r&&c.add(h),f){const e=new Ly(t,o,h);e.setRealPlayer(v),l.push(e)}return v});l.forEach(t=>{vg(this.playersByQueriedElement,t.element,[]).push(t),t.onDone(()=>function(t,e,n){let r;if(t instanceof Map){if(r=t.get(e),r){if(r.length){const t=r.indexOf(n);r.splice(t,1)}0==r.length&&t.delete(e)}}else if(r=t[e],r){if(r.length){const t=r.indexOf(n);r.splice(t,1)}0==r.length&&delete t[e]}return r}(this.playersByQueriedElement,t.element,t))}),u.forEach(t=>Wy(t,"ng-animating"));const d=fg(h);return d.onDestroy(()=>{u.forEach(t=>qy(t,"ng-animating")),Bg(a,e.toStyles)}),c.forEach(t=>{vg(r,t,[]).push(d)}),d}_buildPlayer(t,e,n){return e.length>0?this.driver.animate(t.element,e,t.duration,t.delay,t.easing,n):new Wd(t.duration,t.delay)}}class Ly{constructor(t,e,n){this.namespaceId=t,this.triggerName=e,this.element=n,this._player=new Wd,this._containsRealPlayer=!1,this._queuedCallbacks={},this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(t){this._containsRealPlayer||(this._player=t,Object.keys(this._queuedCallbacks).forEach(e=>{this._queuedCallbacks[e].forEach(n=>mg(t,e,void 0,n))}),this._queuedCallbacks={},this._containsRealPlayer=!0,this.overrideTotalTime(t.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(t){this.totalTime=t}syncPlayerEvents(t){const e=this._player;e.triggerCallback&&t.onStart(()=>e.triggerCallback("start")),t.onDone(()=>this.finish()),t.onDestroy(()=>this.destroy())}_queueEvent(t,e){vg(this._queuedCallbacks,t,[]).push(e)}onDone(t){this.queued&&this._queueEvent("done",t),this._player.onDone(t)}onStart(t){this.queued&&this._queueEvent("start",t),this._player.onStart(t)}onDestroy(t){this.queued&&this._queueEvent("destroy",t),this._player.onDestroy(t)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(t){this.queued||this._player.setPosition(t)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(t){const e=this._player;e.triggerCallback&&e.triggerCallback(t)}}function By(t){return t&&1===t.nodeType}function jy(t,e){const n=t.style.display;return t.style.display=null!=e?e:"none",n}function Uy(t,e,n,r,i){const s=[];n.forEach(t=>s.push(jy(t)));const o=[];r.forEach((n,r)=>{const s={};n.forEach(t=>{const n=s[t]=e.computeStyle(r,t,i);n&&0!=n.length||(r.__ng_removed=Fy,o.push(r))}),t.set(r,s)});let a=0;return n.forEach(t=>jy(t,s[a++])),o}function Vy(t,e){const n=new Map;if(t.forEach(t=>n.set(t,[])),0==e.length)return n;const r=new Set(e),i=new Map;return e.forEach(t=>{const e=function t(e){if(!e)return 1;let s=i.get(e);if(s)return s;const o=e.parentNode;return s=n.has(o)?o:r.has(o)?1:t(o),i.set(e,s),s}(t);1!==e&&n.get(e).push(t)}),n}function Wy(t,e){if(t.classList)t.classList.add(e);else{let n=t.$$classes;n||(n=t.$$classes={}),n[e]=!0}}function qy(t,e){if(t.classList)t.classList.remove(e);else{let n=t.$$classes;n&&delete n[e]}}function Hy(t,e,n){fg(n).onDone(()=>t.processLeaveNode(e))}function Gy(t,e,n){const r=n.get(t);if(!r)return!1;let i=e.get(t);return i?r.forEach(t=>i.add(t)):e.set(t,r),n.delete(t),!0}class Yy{constructor(t,e,n){this.bodyNode=t,this._driver=e,this._triggerCache={},this.onRemovalComplete=(t,e)=>{},this._transitionEngine=new zy(t,e,n),this._timelineEngine=new Oy(t,e,n),this._transitionEngine.onRemovalComplete=(t,e)=>this.onRemovalComplete(t,e)}registerTrigger(t,e,n,r,i){const s=t+"-"+r;let o=this._triggerCache[s];if(!o){const t=[],e=iy(this._driver,i,t);if(t.length)throw new Error(`The animation trigger "${r}" has failed to build due to the following errors:\n - ${t.join("\n - ")}`);o=function(t,e){return new Dy(t,e)}(r,e),this._triggerCache[s]=o}this._transitionEngine.registerTrigger(e,r,o)}register(t,e){this._transitionEngine.register(t,e)}destroy(t,e){this._transitionEngine.destroy(t,e)}onInsert(t,e,n,r){this._transitionEngine.insertNode(t,e,n,r)}onRemove(t,e,n,r){this._transitionEngine.removeNode(t,e,r||!1,n)}disableAnimations(t,e){this._transitionEngine.markElementAsDisabled(t,e)}process(t,e,n,r){if("@"==n.charAt(0)){const[t,i]=bg(n);this._timelineEngine.command(t,e,i,r)}else this._transitionEngine.trigger(t,e,n,r)}listen(t,e,n,r,i){if("@"==n.charAt(0)){const[t,r]=bg(n);return this._timelineEngine.listen(t,e,r,i)}return this._transitionEngine.listen(t,e,n,r,i)}flush(t=-1){this._transitionEngine.flush(t)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}function Ky(t,e){let n=null,r=null;return Array.isArray(e)&&e.length?(n=Zy(e[0]),e.length>1&&(r=Zy(e[e.length-1]))):e&&(n=Zy(e)),n||r?new Xy(t,n,r):null}let Xy=(()=>{class t{constructor(e,n,r){this._element=e,this._startStyles=n,this._endStyles=r,this._state=0;let i=t.initialStylesByElement.get(e);i||t.initialStylesByElement.set(e,i={}),this._initialStyles=i}start(){this._state<1&&(this._startStyles&&Bg(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Bg(this._element,this._initialStyles),this._endStyles&&(Bg(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(t.initialStylesByElement.delete(this._element),this._startStyles&&(jg(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(jg(this._element,this._endStyles),this._endStyles=null),Bg(this._element,this._initialStyles),this._state=3)}}return t.initialStylesByElement=new WeakMap,t})();function Zy(t){let e=null;const n=Object.keys(t);for(let r=0;r<n.length;r++){const i=n[r];Qy(i)&&(e=e||{},e[i]=t[i])}return e}function Qy(t){return"display"===t||"position"===t}class Jy{constructor(t,e,n,r,i,s,o){this._element=t,this._name=e,this._duration=n,this._delay=r,this._easing=i,this._fillMode=s,this._onDoneFn=o,this._finished=!1,this._destroyed=!1,this._startTime=0,this._position=0,this._eventFn=t=>this._handleCallback(t)}apply(){!function(t,e){const n=sv(t,"").trim();n.length&&(function(t,e){let n=0;for(let r=0;r<t.length;r++)","===t.charAt(r)&&n++}(n),e=`${n}, ${e}`),iv(t,"",e)}(this._element,`${this._duration}ms ${this._easing} ${this._delay}ms 1 normal ${this._fillMode} ${this._name}`),rv(this._element,this._eventFn,!1),this._startTime=Date.now()}pause(){tv(this._element,this._name,"paused")}resume(){tv(this._element,this._name,"running")}setPosition(t){const e=ev(this._element,this._name);this._position=t*this._duration,iv(this._element,"Delay",`-${this._position}ms`,e)}getPosition(){return this._position}_handleCallback(t){const e=t._ngTestManualTimestamp||Date.now(),n=1e3*parseFloat(t.elapsedTime.toFixed(3));t.animationName==this._name&&Math.max(e-this._startTime,0)>=this._delay&&n>=this._duration&&this.finish()}finish(){this._finished||(this._finished=!0,this._onDoneFn(),rv(this._element,this._eventFn,!0))}destroy(){this._destroyed||(this._destroyed=!0,this.finish(),function(t,e){const n=sv(t,"").split(","),r=nv(n,e);r>=0&&(n.splice(r,1),iv(t,"",n.join(",")))}(this._element,this._name))}}function tv(t,e,n){iv(t,"PlayState",n,ev(t,e))}function ev(t,e){const n=sv(t,"");return n.indexOf(",")>0?nv(n.split(","),e):nv([n],e)}function nv(t,e){for(let n=0;n<t.length;n++)if(t[n].indexOf(e)>=0)return n;return-1}function rv(t,e,n){n?t.removeEventListener("animationend",e):t.addEventListener("animationend",e)}function iv(t,e,n,r){const i="animation"+e;if(null!=r){const e=t.style[i];if(e.length){const t=e.split(",");t[r]=n,n=t.join(",")}}t.style[i]=n}function sv(t,e){return t.style["animation"+e]}class ov{constructor(t,e,n,r,i,s,o,a){this.element=t,this.keyframes=e,this.animationName=n,this._duration=r,this._delay=i,this._finalStyles=o,this._specialStyles=a,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._started=!1,this.currentSnapshot={},this._state=0,this.easing=s||"linear",this.totalTime=r+i,this._buildStyler()}onStart(t){this._onStartFns.push(t)}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}destroy(){this.init(),this._state>=4||(this._state=4,this._styler.destroy(),this._flushStartFns(),this._flushDoneFns(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}_flushDoneFns(){this._onDoneFns.forEach(t=>t()),this._onDoneFns=[]}_flushStartFns(){this._onStartFns.forEach(t=>t()),this._onStartFns=[]}finish(){this.init(),this._state>=3||(this._state=3,this._styler.finish(),this._flushStartFns(),this._specialStyles&&this._specialStyles.finish(),this._flushDoneFns())}setPosition(t){this._styler.setPosition(t)}getPosition(){return this._styler.getPosition()}hasStarted(){return this._state>=2}init(){this._state>=1||(this._state=1,this._styler.apply(),this._delay&&this._styler.pause())}play(){this.init(),this.hasStarted()||(this._flushStartFns(),this._state=2,this._specialStyles&&this._specialStyles.start()),this._styler.resume()}pause(){this.init(),this._styler.pause()}restart(){this.reset(),this.play()}reset(){this._styler.destroy(),this._buildStyler(),this._styler.apply()}_buildStyler(){this._styler=new Jy(this.element,this.animationName,this._duration,this._delay,this.easing,"forwards",()=>this.finish())}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(t=>t()),e.length=0}beforeDestroy(){this.init();const t={};if(this.hasStarted()){const e=this._state>=3;Object.keys(this._finalStyles).forEach(n=>{"offset"!=n&&(t[n]=e?this._finalStyles[n]:Qg(this.element,n))})}this.currentSnapshot=t}}class av extends Wd{constructor(t,e){super(),this.element=t,this._startingStyles={},this.__initialized=!1,this._styles=Tg(e)}init(){!this.__initialized&&this._startingStyles&&(this.__initialized=!0,Object.keys(this._styles).forEach(t=>{this._startingStyles[t]=this.element.style[t]}),super.init())}play(){this._startingStyles&&(this.init(),Object.keys(this._styles).forEach(t=>this.element.style.setProperty(t,this._styles[t])),super.play())}destroy(){this._startingStyles&&(Object.keys(this._startingStyles).forEach(t=>{const e=this._startingStyles[t];e?this.element.style.setProperty(t,e):this.element.style.removeProperty(t)}),this._startingStyles=null,super.destroy())}}class lv{constructor(){this._count=0,this._head=document.querySelector("head"),this._warningIssued=!1}validateStyleProperty(t){return kg(t)}matchesElement(t,e){return Ag(t,e)}containsElement(t,e){return Dg(t,e)}query(t,e,n){return Ng(t,e,n)}computeStyle(t,e,n){return window.getComputedStyle(t)[e]}buildKeyframeElement(t,e,n){n=n.map(t=>Tg(t));let r=`@keyframes ${e} {\n`,i="";n.forEach(t=>{i=" ";const e=parseFloat(t.offset);r+=`${i}${100*e}% {\n`,i+=" ",Object.keys(t).forEach(e=>{const n=t[e];switch(e){case"offset":return;case"easing":return void(n&&(r+=`${i}animation-timing-function: ${n};\n`));default:return void(r+=`${i}${e}: ${n};\n`)}}),r+=i+"}\n"}),r+="}\n";const s=document.createElement("style");return s.innerHTML=r,s}animate(t,e,n,r,i,s=[],o){o&&this._notifyFaultyScrubber();const a=s.filter(t=>t instanceof ov),l={};Kg(n,r)&&a.forEach(t=>{let e=t.currentSnapshot;Object.keys(e).forEach(t=>l[t]=e[t])});const u=function(t){let e={};return t&&(Array.isArray(t)?t:[t]).forEach(t=>{Object.keys(t).forEach(n=>{"offset"!=n&&"easing"!=n&&(e[n]=t[n])})}),e}(e=Xg(t,e,l));if(0==n)return new av(t,u);const c="gen_css_kf_"+this._count++,h=this.buildKeyframeElement(t,c,e);document.querySelector("head").appendChild(h);const d=Ky(t,e),f=new ov(t,e,c,n,r,i,u,d);return f.onDestroy(()=>{var t;(t=h).parentNode.removeChild(t)}),f}_notifyFaultyScrubber(){this._warningIssued||(console.warn("@angular/animations: please load the web-animations.js polyfill to allow programmatic access...\n","  visit http://bit.ly/IWukam to learn more about using the web-animation-js polyfill."),this._warningIssued=!0)}}class uv{constructor(t,e,n,r){this.element=t,this.keyframes=e,this.options=n,this._specialStyles=r,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this.time=0,this.parentPlayer=null,this.currentSnapshot={},this._duration=n.duration,this._delay=n.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const t=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,t,this.options),this._finalKeyframe=t.length?t[t.length-1]:{},this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_triggerWebAnimation(t,e,n){return t.animate(e,n)}onStart(t){this._onStartFns.push(t)}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(t=>t()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}setPosition(t){this.domPlayer.currentTime=t*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const t={};this.hasStarted()&&Object.keys(this._finalKeyframe).forEach(e=>{"offset"!=e&&(t[e]=this._finished?this._finalKeyframe[e]:Qg(this.element,e))}),this.currentSnapshot=t}triggerCallback(t){const e="start"==t?this._onStartFns:this._onDoneFns;e.forEach(t=>t()),e.length=0}}class cv{constructor(){this._isNativeImpl=/\{\s*\[native\s+code\]\s*\}/.test(hv().toString()),this._cssKeyframesDriver=new lv}validateStyleProperty(t){return kg(t)}matchesElement(t,e){return Ag(t,e)}containsElement(t,e){return Dg(t,e)}query(t,e,n){return Ng(t,e,n)}computeStyle(t,e,n){return window.getComputedStyle(t)[e]}overrideWebAnimationsSupport(t){this._isNativeImpl=t}animate(t,e,n,r,i,s=[],o){if(!o&&!this._isNativeImpl)return this._cssKeyframesDriver.animate(t,e,n,r,i,s);const a={duration:n,delay:r,fill:0==r?"both":"forwards"};i&&(a.easing=i);const l={},u=s.filter(t=>t instanceof uv);Kg(n,r)&&u.forEach(t=>{let e=t.currentSnapshot;Object.keys(e).forEach(t=>l[t]=e[t])});const c=Ky(t,e=Xg(t,e=e.map(t=>Pg(t,!1)),l));return new uv(t,e,a,c)}}function hv(){return"undefined"!=typeof window&&void 0!==window.document&&Element.prototype.animate||{}}class dv extends Bd{constructor(t,e){super(),this._nextAnimationId=0,this._renderer=t.createRenderer(e.body,{id:"0",encapsulation:jt.None,styles:[],data:{animation:[]}})}build(t){const e=this._nextAnimationId.toString();this._nextAnimationId++;const n=Array.isArray(t)?jd(t):t;return mv(this._renderer,null,e,"register",[n]),new fv(e,this._renderer)}}class fv extends class{}{constructor(t,e){super(),this._id=t,this._renderer=e}create(t,e){return new pv(this._id,t,e||{},this._renderer)}}class pv{constructor(t,e,n,r){this.id=t,this.element=e,this._renderer=r,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",n)}_listen(t,e){return this._renderer.listen(this.element,`@@${this.id}:${t}`,e)}_command(t,...e){return mv(this._renderer,this.element,this.id,t,e)}onDone(t){this._listen("done",t)}onStart(t){this._listen("start",t)}onDestroy(t){this._listen("destroy",t)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset")}setPosition(t){this._command("setPosition",t)}getPosition(){return 0}}function mv(t,e,n,r,i){return t.setProperty(e,`@@${n}:${r}`,i)}class gv{constructor(t,e,n){this.delegate=t,this.engine=e,this._zone=n,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),e.onRemovalComplete=(t,e)=>{e&&e.parentNode(t)&&e.removeChild(t.parentNode,t)}}createRenderer(t,e){const n=this.delegate.createRenderer(t,e);if(!(t&&e&&e.data&&e.data.animation)){let t=this._rendererCache.get(n);return t||(t=new yv("",n,this.engine),this._rendererCache.set(n,t)),t}const r=e.id,i=e.id+"-"+this._currentId;return this._currentId++,this.engine.register(i,t),e.data.animation.forEach(e=>this.engine.registerTrigger(r,i,t,e.name,e)),new vv(this,i,n,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(t,e,n){t>=0&&t<this._microtaskId?this._zone.run(()=>e(n)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(t=>{const[e,n]=t;e(n)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([e,n]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}class yv{constructor(t,e,n){this.namespaceId=t,this.delegate=e,this.engine=n,this.destroyNode=this.delegate.destroyNode?t=>e.destroyNode(t):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy()}createElement(t,e){return this.delegate.createElement(t,e)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}appendChild(t,e){this.delegate.appendChild(t,e),this.engine.onInsert(this.namespaceId,e,t,!1)}insertBefore(t,e,n){this.delegate.insertBefore(t,e,n),this.engine.onInsert(this.namespaceId,e,t,!0)}removeChild(t,e,n){this.engine.onRemove(this.namespaceId,e,this.delegate,n)}selectRootElement(t,e){return this.delegate.selectRootElement(t,e)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,e,n,r){this.delegate.setAttribute(t,e,n,r)}removeAttribute(t,e,n){this.delegate.removeAttribute(t,e,n)}addClass(t,e){this.delegate.addClass(t,e)}removeClass(t,e){this.delegate.removeClass(t,e)}setStyle(t,e,n,r){this.delegate.setStyle(t,e,n,r)}removeStyle(t,e,n){this.delegate.removeStyle(t,e,n)}setProperty(t,e,n){"@"==e.charAt(0)&&"@.disabled"==e?this.disableAnimations(t,!!n):this.delegate.setProperty(t,e,n)}setValue(t,e){this.delegate.setValue(t,e)}listen(t,e,n){return this.delegate.listen(t,e,n)}disableAnimations(t,e){this.engine.disableAnimations(t,e)}}class vv extends yv{constructor(t,e,n,r){super(e,n,r),this.factory=t,this.namespaceId=e}setProperty(t,e,n){"@"==e.charAt(0)?"."==e.charAt(1)&&"@.disabled"==e?this.disableAnimations(t,n=void 0===n||!!n):this.engine.process(this.namespaceId,t,e.substr(1),n):this.delegate.setProperty(t,e,n)}listen(t,e,n){if("@"==e.charAt(0)){const r=function(t){switch(t){case"body":return document.body;case"document":return document;case"window":return window;default:return t}}(t);let i=e.substr(1),s="";return"@"!=i.charAt(0)&&([i,s]=function(t){const e=t.indexOf(".");return[t.substring(0,e),t.substr(e+1)]}(i)),this.engine.listen(this.namespaceId,r,i,s,t=>{this.factory.scheduleListenerCallback(t._data||-1,n,t)})}return this.delegate.listen(t,e,n)}}class bv extends Yy{constructor(t,e,n){super(t.body,e,n)}}function xv(){return"function"==typeof hv()?new cv:new lv}function _v(){return new wy}function wv(t,e,n){return new gv(t,e,n)}const Sv=new kt("AnimationModuleType");class Cv{}var Ev=Vn({encapsulation:2,styles:[".mat-button .mat-button-focus-overlay,.mat-icon-button .mat-button-focus-overlay{opacity:0}.mat-button:hover .mat-button-focus-overlay,.mat-stroked-button:hover .mat-button-focus-overlay{opacity:.04}@media (hover:none){.mat-button:hover .mat-button-focus-overlay,.mat-stroked-button:hover .mat-button-focus-overlay{opacity:0}}.mat-button,.mat-flat-button,.mat-icon-button,.mat-stroked-button{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:0;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible}.mat-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner{border:0}.mat-button[disabled],.mat-flat-button[disabled],.mat-icon-button[disabled],.mat-stroked-button[disabled]{cursor:default}.mat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-button.cdk-program-focused .mat-button-focus-overlay,.mat-flat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-flat-button.cdk-program-focused .mat-button-focus-overlay,.mat-icon-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-icon-button.cdk-program-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner{border:0}.mat-raised-button{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:0;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0,0,0);transition:background .4s cubic-bezier(.25,.8,.25,1),box-shadow 280ms cubic-bezier(.4,0,.2,1)}.mat-raised-button::-moz-focus-inner{border:0}.mat-raised-button[disabled]{cursor:default}.mat-raised-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-raised-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-raised-button::-moz-focus-inner{border:0}._mat-animation-noopable.mat-raised-button{transition:none;animation:none}.mat-stroked-button{border:1px solid currentColor;padding:0 15px;line-height:34px}.mat-stroked-button .mat-button-focus-overlay,.mat-stroked-button .mat-button-ripple.mat-ripple{top:-1px;left:-1px;right:-1px;bottom:-1px}.mat-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:0;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0,0,0);transition:background .4s cubic-bezier(.25,.8,.25,1),box-shadow 280ms cubic-bezier(.4,0,.2,1);min-width:0;border-radius:50%;width:56px;height:56px;padding:0;flex-shrink:0}.mat-fab::-moz-focus-inner{border:0}.mat-fab[disabled]{cursor:default}.mat-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-fab::-moz-focus-inner{border:0}._mat-animation-noopable.mat-fab{transition:none;animation:none}.mat-fab .mat-button-wrapper{padding:16px 0;display:inline-block;line-height:24px}.mat-mini-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:0;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0,0,0);transition:background .4s cubic-bezier(.25,.8,.25,1),box-shadow 280ms cubic-bezier(.4,0,.2,1);min-width:0;border-radius:50%;width:40px;height:40px;padding:0;flex-shrink:0}.mat-mini-fab::-moz-focus-inner{border:0}.mat-mini-fab[disabled]{cursor:default}.mat-mini-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-mini-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-mini-fab::-moz-focus-inner{border:0}._mat-animation-noopable.mat-mini-fab{transition:none;animation:none}.mat-mini-fab .mat-button-wrapper{padding:8px 0;display:inline-block;line-height:24px}.mat-icon-button{padding:0;min-width:0;width:40px;height:40px;flex-shrink:0;line-height:40px;border-radius:50%}.mat-icon-button .mat-icon,.mat-icon-button i{line-height:24px}.mat-button-focus-overlay,.mat-button-ripple.mat-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-button-ripple.mat-ripple:not(:empty){transform:translateZ(0)}.mat-button-focus-overlay{opacity:0;transition:opacity .2s cubic-bezier(.35,0,.25,1),background-color .2s cubic-bezier(.35,0,.25,1)}._mat-animation-noopable .mat-button-focus-overlay{transition:none}@media (-ms-high-contrast:active){.mat-button-focus-overlay{background-color:#fff}}@media (-ms-high-contrast:black-on-white){.mat-button-focus-overlay{background-color:#000}}.mat-button-ripple-round{border-radius:50%;z-index:1}.mat-button .mat-button-wrapper>*,.mat-fab .mat-button-wrapper>*,.mat-flat-button .mat-button-wrapper>*,.mat-icon-button .mat-button-wrapper>*,.mat-mini-fab .mat-button-wrapper>*,.mat-raised-button .mat-button-wrapper>*,.mat-stroked-button .mat-button-wrapper>*{vertical-align:middle}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button{display:block;font-size:inherit;width:2.5em;height:2.5em}@media (-ms-high-contrast:active){.mat-button,.mat-fab,.mat-flat-button,.mat-icon-button,.mat-mini-fab,.mat-raised-button{outline:solid 1px}}"],data:{}});function kv(t){return Hs(2,[$s(671088640,1,{ripple:0}),(t()(),Os(1,0,null,null,1,"span",[["class","mat-button-wrapper"]],null,null,null,null,null)),js(null,0),(t()(),Os(3,0,null,null,1,"div",[["class","mat-button-ripple mat-ripple"],["matRipple",""]],[[2,"mat-button-ripple-round",null],[2,"mat-ripple-unbounded",null]],null,null,null,null)),Zr(4,212992,[[1,4]],0,rp,[tn,Gi,tf,[2,np],[2,Sv]],{centered:[0,"centered"],disabled:[1,"disabled"],trigger:[2,"trigger"]},null),(t()(),Os(5,0,null,null,0,"div",[["class","mat-button-focus-overlay"]],null,null,null,null,null))],(function(t,e){var n=e.component;t(e,4,0,n.isIconButton,n._isRippleDisabled(),n._getHostElement())}),(function(t,e){var n=e.component;t(e,3,0,n.isRoundButton||n.isIconButton,zr(e,4).unbounded)}))}var Av=Vn({encapsulation:2,styles:[".mat-button .mat-button-focus-overlay,.mat-icon-button .mat-button-focus-overlay{opacity:0}.mat-button:hover .mat-button-focus-overlay,.mat-stroked-button:hover .mat-button-focus-overlay{opacity:.04}@media (hover:none){.mat-button:hover .mat-button-focus-overlay,.mat-stroked-button:hover .mat-button-focus-overlay{opacity:0}}.mat-button,.mat-flat-button,.mat-icon-button,.mat-stroked-button{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:0;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible}.mat-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner{border:0}.mat-button[disabled],.mat-flat-button[disabled],.mat-icon-button[disabled],.mat-stroked-button[disabled]{cursor:default}.mat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-button.cdk-program-focused .mat-button-focus-overlay,.mat-flat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-flat-button.cdk-program-focused .mat-button-focus-overlay,.mat-icon-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-icon-button.cdk-program-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner{border:0}.mat-raised-button{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:0;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0,0,0);transition:background .4s cubic-bezier(.25,.8,.25,1),box-shadow 280ms cubic-bezier(.4,0,.2,1)}.mat-raised-button::-moz-focus-inner{border:0}.mat-raised-button[disabled]{cursor:default}.mat-raised-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-raised-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-raised-button::-moz-focus-inner{border:0}._mat-animation-noopable.mat-raised-button{transition:none;animation:none}.mat-stroked-button{border:1px solid currentColor;padding:0 15px;line-height:34px}.mat-stroked-button .mat-button-focus-overlay,.mat-stroked-button .mat-button-ripple.mat-ripple{top:-1px;left:-1px;right:-1px;bottom:-1px}.mat-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:0;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0,0,0);transition:background .4s cubic-bezier(.25,.8,.25,1),box-shadow 280ms cubic-bezier(.4,0,.2,1);min-width:0;border-radius:50%;width:56px;height:56px;padding:0;flex-shrink:0}.mat-fab::-moz-focus-inner{border:0}.mat-fab[disabled]{cursor:default}.mat-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-fab::-moz-focus-inner{border:0}._mat-animation-noopable.mat-fab{transition:none;animation:none}.mat-fab .mat-button-wrapper{padding:16px 0;display:inline-block;line-height:24px}.mat-mini-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:0;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0,0,0);transition:background .4s cubic-bezier(.25,.8,.25,1),box-shadow 280ms cubic-bezier(.4,0,.2,1);min-width:0;border-radius:50%;width:40px;height:40px;padding:0;flex-shrink:0}.mat-mini-fab::-moz-focus-inner{border:0}.mat-mini-fab[disabled]{cursor:default}.mat-mini-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-mini-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-mini-fab::-moz-focus-inner{border:0}._mat-animation-noopable.mat-mini-fab{transition:none;animation:none}.mat-mini-fab .mat-button-wrapper{padding:8px 0;display:inline-block;line-height:24px}.mat-icon-button{padding:0;min-width:0;width:40px;height:40px;flex-shrink:0;line-height:40px;border-radius:50%}.mat-icon-button .mat-icon,.mat-icon-button i{line-height:24px}.mat-button-focus-overlay,.mat-button-ripple.mat-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-button-ripple.mat-ripple:not(:empty){transform:translateZ(0)}.mat-button-focus-overlay{opacity:0;transition:opacity .2s cubic-bezier(.35,0,.25,1),background-color .2s cubic-bezier(.35,0,.25,1)}._mat-animation-noopable .mat-button-focus-overlay{transition:none}@media (-ms-high-contrast:active){.mat-button-focus-overlay{background-color:#fff}}@media (-ms-high-contrast:black-on-white){.mat-button-focus-overlay{background-color:#000}}.mat-button-ripple-round{border-radius:50%;z-index:1}.mat-button .mat-button-wrapper>*,.mat-fab .mat-button-wrapper>*,.mat-flat-button .mat-button-wrapper>*,.mat-icon-button .mat-button-wrapper>*,.mat-mini-fab .mat-button-wrapper>*,.mat-raised-button .mat-button-wrapper>*,.mat-stroked-button .mat-button-wrapper>*{vertical-align:middle}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button{display:block;font-size:inherit;width:2.5em;height:2.5em}@media (-ms-high-contrast:active){.mat-button,.mat-fab,.mat-flat-button,.mat-icon-button,.mat-mini-fab,.mat-raised-button{outline:solid 1px}}"],data:{}});function Dv(t){return Hs(2,[$s(671088640,1,{ripple:0}),(t()(),Os(1,0,null,null,1,"span",[["class","mat-button-wrapper"]],null,null,null,null,null)),js(null,0),(t()(),Os(3,0,null,null,1,"div",[["class","mat-button-ripple mat-ripple"],["matRipple",""]],[[2,"mat-button-ripple-round",null],[2,"mat-ripple-unbounded",null]],null,null,null,null)),Zr(4,212992,[[1,4]],0,rp,[tn,Gi,tf,[2,np],[2,Sv]],{centered:[0,"centered"],disabled:[1,"disabled"],trigger:[2,"trigger"]},null),(t()(),Os(5,0,null,null,0,"div",[["class","mat-button-focus-overlay"]],null,null,null,null,null))],(function(t,e){var n=e.component;t(e,4,0,n.isIconButton,n._isRippleDisabled(),n._getHostElement())}),(function(t,e){var n=e.component;t(e,3,0,n.isRoundButton||n.isIconButton,zr(e,4).unbounded)}))}var Nv=Vn({encapsulation:2,styles:[],data:{}});function Tv(t){return Hs(2,[(t()(),Os(0,0,null,null,12,"div",[["class","mat-calendar-header"]],null,null,null,null,null)),(t()(),Os(1,0,null,null,11,"div",[["class","mat-calendar-controls"]],null,null,null,null,null)),(t()(),Os(2,0,null,null,4,"button",[["cdkAriaLive","polite"],["class","mat-calendar-period-button"],["mat-button",""],["type","button"]],[[1,"aria-label",0],[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"]],(function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.currentPeriodClicked()&&r),r}),kv,Ev)),Zr(3,180224,null,0,ug,[tn,Sf,[2,Sv]],null,null),Zr(4,147456,null,0,_f,[tn,xf,ig,Gi],{politeness:[0,"politeness"]},null),(t()(),Vs(5,0,["",""])),(t()(),Os(6,0,null,0,0,"div",[["class","mat-calendar-arrow"]],[[2,"mat-calendar-invert",null]],null,null,null,null)),(t()(),Os(7,0,null,null,0,"div",[["class","mat-calendar-spacer"]],null,null,null,null,null)),js(null,0),(t()(),Os(9,0,null,null,1,"button",[["class","mat-calendar-previous-button"],["mat-icon-button",""],["type","button"]],[[1,"aria-label",0],[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"]],(function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.previousClicked()&&r),r}),kv,Ev)),Zr(10,180224,null,0,ug,[tn,Sf,[2,Sv]],{disabled:[0,"disabled"]},null),(t()(),Os(11,0,null,null,1,"button",[["class","mat-calendar-next-button"],["mat-icon-button",""],["type","button"]],[[1,"aria-label",0],[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"]],(function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.nextClicked()&&r),r}),kv,Ev)),Zr(12,180224,null,0,ug,[tn,Sf,[2,Sv]],{disabled:[0,"disabled"]},null)],(function(t,e){var n=e.component;t(e,4,0,"polite"),t(e,10,0,!n.previousEnabled()),t(e,12,0,!n.nextEnabled())}),(function(t,e){var n=e.component;t(e,2,0,n.periodButtonLabel,zr(e,3).disabled||null,"NoopAnimations"===zr(e,3)._animationMode),t(e,5,0,n.periodButtonText),t(e,6,0,"month"!=n.calendar.currentView),t(e,9,0,n.prevButtonLabel,zr(e,10).disabled||null,"NoopAnimations"===zr(e,10)._animationMode),t(e,11,0,n.nextButtonLabel,zr(e,12).disabled||null,"NoopAnimations"===zr(e,12)._animationMode)}))}function Ov(t){return Hs(0,[(t()(),Os(0,0,null,null,1,"mat-calendar-header",[],null,null,null,Tv,Nv)),Zr(1,49152,null,0,Km,[Bm,Xm,[2,Rf],[2,Ff],Se],null,null)],null,null)}var Iv=Ar("mat-calendar-header",Km,Ov,{},{},["*"]),Rv=Vn({encapsulation:2,styles:[".mat-calendar{display:block}.mat-calendar-header{padding:8px 8px 0 8px}.mat-calendar-content{padding:0 8px 8px 8px;outline:0}.mat-calendar-controls{display:flex;margin:5% calc(33% / 7 - 16px)}.mat-calendar-spacer{flex:1 1 auto}.mat-calendar-period-button{min-width:0}.mat-calendar-arrow{display:inline-block;width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-top-width:5px;border-top-style:solid;margin:0 0 0 5px;vertical-align:middle}.mat-calendar-arrow.mat-calendar-invert{transform:rotate(180deg)}[dir=rtl] .mat-calendar-arrow{margin:0 5px 0 0}.mat-calendar-next-button,.mat-calendar-previous-button{position:relative}.mat-calendar-next-button::after,.mat-calendar-previous-button::after{top:0;left:0;right:0;bottom:0;position:absolute;content:'';margin:15.5px;border:0 solid currentColor;border-top-width:2px}[dir=rtl] .mat-calendar-next-button,[dir=rtl] .mat-calendar-previous-button{transform:rotate(180deg)}.mat-calendar-previous-button::after{border-left-width:2px;transform:translateX(2px) rotate(-45deg)}.mat-calendar-next-button::after{border-right-width:2px;transform:translateX(-2px) rotate(45deg)}.mat-calendar-table{border-spacing:0;border-collapse:collapse;width:100%}.mat-calendar-table-header th{text-align:center;padding:0 0 8px 0}.mat-calendar-table-header-divider{position:relative;height:1px}.mat-calendar-table-header-divider::after{content:'';position:absolute;top:0;left:-8px;right:-8px;height:1px}"],data:{}});function Fv(t){return Hs(0,[(t()(),Ts(0,null,null,0))],null,null)}function Mv(t){return Hs(0,[(t()(),Os(0,0,null,null,1,"mat-month-view",[],null,[[null,"activeDateChange"],[null,"selectedChange"],[null,"_userSelection"]],(function(t,e,n){var r=!0,i=t.component;return"activeDateChange"===e&&(r=!1!==(i.activeDate=n)&&r),"selectedChange"===e&&(r=!1!==i._dateSelected(n)&&r),"_userSelection"===e&&(r=!1!==i._userSelected()&&r),r}),Zv,Kv)),Zr(1,1097728,[[1,4]],0,Vm,[Se,[2,Ff],[2,Rf],[2,dm]],{activeDate:[0,"activeDate"],selected:[1,"selected"],minDate:[2,"minDate"],maxDate:[3,"maxDate"],dateFilter:[4,"dateFilter"],dateClass:[5,"dateClass"]},{selectedChange:"selectedChange",_userSelection:"_userSelection",activeDateChange:"activeDateChange"})],(function(t,e){var n=e.component;t(e,1,0,n.activeDate,n.selected,n.minDate,n.maxDate,n.dateFilter,n.dateClass)}),null)}function $v(t){return Hs(0,[(t()(),Os(0,0,null,null,1,"mat-year-view",[],null,[[null,"activeDateChange"],[null,"monthSelected"],[null,"selectedChange"]],(function(t,e,n){var r=!0,i=t.component;return"activeDateChange"===e&&(r=!1!==(i.activeDate=n)&&r),"monthSelected"===e&&(r=!1!==i._monthSelectedInYearView(n)&&r),"selectedChange"===e&&(r=!1!==i._goToDateInView(n,"month")&&r),r}),Jv,Qv)),Zr(1,1097728,[[2,4]],0,Ym,[Se,[2,Ff],[2,Rf],[2,dm]],{activeDate:[0,"activeDate"],selected:[1,"selected"],minDate:[2,"minDate"],maxDate:[3,"maxDate"],dateFilter:[4,"dateFilter"]},{selectedChange:"selectedChange",monthSelected:"monthSelected",activeDateChange:"activeDateChange"})],(function(t,e){var n=e.component;t(e,1,0,n.activeDate,n.selected,n.minDate,n.maxDate,n.dateFilter)}),null)}function Pv(t){return Hs(0,[(t()(),Os(0,0,null,null,1,"mat-multi-year-view",[],null,[[null,"activeDateChange"],[null,"yearSelected"],[null,"selectedChange"]],(function(t,e,n){var r=!0,i=t.component;return"activeDateChange"===e&&(r=!1!==(i.activeDate=n)&&r),"yearSelected"===e&&(r=!1!==i._yearSelectedInMultiYearView(n)&&r),"selectedChange"===e&&(r=!1!==i._goToDateInView(n,"year")&&r),r}),eb,tb)),Zr(1,1097728,[[3,4]],0,Wm,[Se,[2,Rf],[2,dm]],{activeDate:[0,"activeDate"],selected:[1,"selected"],minDate:[2,"minDate"],maxDate:[3,"maxDate"],dateFilter:[4,"dateFilter"]},{selectedChange:"selectedChange",yearSelected:"yearSelected",activeDateChange:"activeDateChange"})],(function(t,e){var n=e.component;t(e,1,0,n.activeDate,n.selected,n.minDate,n.maxDate,n.dateFilter)}),null)}function zv(t){return Hs(2,[$s(671088640,1,{monthView:0}),$s(671088640,2,{yearView:0}),$s(671088640,3,{multiYearView:0}),(t()(),Ts(16777216,null,null,1,null,Fv)),Zr(4,212992,null,0,fp,[Xe,An],{portal:[0,"portal"]},null),(t()(),Os(5,0,null,null,8,"div",[["cdkMonitorSubtreeFocus",""],["class","mat-calendar-content"],["tabindex","-1"]],null,null,null,null,null)),Zr(6,16384,null,0,Ea,[],{ngSwitch:[0,"ngSwitch"]},null),Zr(7,147456,null,0,Cf,[tn,Sf],null,null),(t()(),Ts(16777216,null,null,1,null,Mv)),Zr(9,278528,null,0,ka,[An,En,Ea],{ngSwitchCase:[0,"ngSwitchCase"]},null),(t()(),Ts(16777216,null,null,1,null,$v)),Zr(11,278528,null,0,ka,[An,En,Ea],{ngSwitchCase:[0,"ngSwitchCase"]},null),(t()(),Ts(16777216,null,null,1,null,Pv)),Zr(13,278528,null,0,ka,[An,En,Ea],{ngSwitchCase:[0,"ngSwitchCase"]},null)],(function(t,e){var n=e.component;t(e,4,0,n._calendarHeaderPortal),t(e,6,0,n.currentView),t(e,9,0,"month"),t(e,11,0,"year"),t(e,13,0,"multi-year")}),null)}var Lv=Vn({encapsulation:2,styles:[".mat-calendar-body{min-width:224px}.mat-calendar-body-label{height:0;line-height:0;text-align:left;padding-left:4.71429%;padding-right:4.71429%}.mat-calendar-body-cell{position:relative;height:0;line-height:0;text-align:center;outline:0;cursor:pointer}.mat-calendar-body-disabled{cursor:default}.mat-calendar-body-cell-content{position:absolute;top:5%;left:5%;display:flex;align-items:center;justify-content:center;box-sizing:border-box;width:90%;height:90%;line-height:1;border-width:1px;border-style:solid;border-radius:999px}@media (-ms-high-contrast:active){.mat-calendar-body-cell-content{border:none}}@media (-ms-high-contrast:active){.mat-calendar-body-selected,.mat-datepicker-popup:not(:empty){outline:solid 1px}.mat-calendar-body-today{outline:dotted 1px}.cdk-keyboard-focused .mat-calendar-body-active>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected),.cdk-program-focused .mat-calendar-body-active>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected){outline:dotted 2px}}[dir=rtl] .mat-calendar-body-label{text-align:right}"],data:{}});function Bv(t){return Hs(0,[(t()(),Os(0,0,null,null,2,"tr",[["aria-hidden","true"]],null,null,null,null,null)),(t()(),Os(1,0,null,null,1,"td",[["class","mat-calendar-body-label"]],[[1,"colspan",0],[4,"paddingTop",null],[4,"paddingBottom",null]],null,null,null,null)),(t()(),Vs(2,null,["",""]))],null,(function(t,e){var n=e.component;t(e,1,0,n.numCols,n._cellPadding,n._cellPadding),t(e,2,0,n.label)}))}function jv(t){return Hs(0,[(t()(),Os(0,0,null,null,1,"td",[["aria-hidden","true"],["class","mat-calendar-body-label"]],[[1,"colspan",0],[4,"paddingTop",null],[4,"paddingBottom",null]],null,null,null,null)),(t()(),Vs(1,null,["",""]))],null,(function(t,e){var n=e.component;t(e,0,0,n._firstRowOffset,n._cellPadding,n._cellPadding),t(e,1,0,n._firstRowOffset>=n.labelMinRequiredCells?n.label:"")}))}function Uv(t){return Hs(0,[(t()(),Os(0,0,null,null,4,"td",[["class","mat-calendar-body-cell"],["role","button"]],[[8,"tabIndex",0],[2,"mat-calendar-body-disabled",null],[2,"mat-calendar-body-active",null],[1,"aria-label",0],[1,"aria-disabled",0],[1,"aria-selected",0],[4,"width",null],[4,"paddingTop",null],[4,"paddingBottom",null]],[[null,"click"]],(function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component._cellClicked(t.context.$implicit)&&r),r}),null,null)),Qr(512,null,pa,ma,[xn,_n,tn,on]),Zr(2,278528,null,0,ya,[pa],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),(t()(),Os(3,0,null,null,1,"div",[["class","mat-calendar-body-cell-content"]],[[2,"mat-calendar-body-selected",null],[2,"mat-calendar-body-today",null]],null,null,null,null)),(t()(),Vs(4,null,["",""]))],(function(t,e){t(e,2,0,"mat-calendar-body-cell",e.context.$implicit.cssClasses)}),(function(t,e){var n=e.component;t(e,0,0,n._isActiveCell(e.parent.context.index,e.context.index)?0:-1,!e.context.$implicit.enabled,n._isActiveCell(e.parent.context.index,e.context.index),e.context.$implicit.ariaLabel,!e.context.$implicit.enabled||null,n.selectedValue===e.context.$implicit.value,n._cellWidth,n._cellPadding,n._cellPadding),t(e,3,0,n.selectedValue===e.context.$implicit.value,n.todayValue===e.context.$implicit.value),t(e,4,0,e.context.$implicit.displayValue)}))}function Vv(t){return Hs(0,[(t()(),Os(0,0,null,null,4,"tr",[["role","row"]],null,null,null,null,null)),(t()(),Ts(16777216,null,null,1,null,jv)),Zr(2,16384,null,0,_a,[An,En],{ngIf:[0,"ngIf"]},null),(t()(),Ts(16777216,null,null,1,null,Uv)),Zr(4,278528,null,0,ba,[An,En,xn],{ngForOf:[0,"ngForOf"]},null)],(function(t,e){t(e,2,0,0===e.context.index&&e.component._firstRowOffset),t(e,4,0,e.context.$implicit)}),null)}function Wv(t){return Hs(2,[(t()(),Ts(16777216,null,null,1,null,Bv)),Zr(1,16384,null,0,_a,[An,En],{ngIf:[0,"ngIf"]},null),(t()(),Ts(16777216,null,null,1,null,Vv)),Zr(3,278528,null,0,ba,[An,En,xn],{ngForOf:[0,"ngForOf"]},null)],(function(t,e){var n=e.component;t(e,1,0,n._firstRowOffset<n.labelMinRequiredCells),t(e,3,0,n.rows)}),null)}var qv=Vn({encapsulation:2,styles:[".mat-datepicker-content{display:block;border-radius:4px}.mat-datepicker-content .mat-calendar{width:296px;height:354px}.mat-datepicker-content-touch{display:block;max-height:80vh;overflow:auto;margin:-24px}.mat-datepicker-content-touch .mat-calendar{min-width:250px;min-height:312px;max-width:750px;max-height:788px}@media all and (orientation:landscape){.mat-datepicker-content-touch .mat-calendar{width:64vh;height:80vh}}@media all and (orientation:portrait){.mat-datepicker-content-touch .mat-calendar{width:80vw;height:100vw}}"],data:{animation:[{type:7,name:"transformPanel",definitions:[{type:0,name:"void",styles:{type:6,styles:{opacity:0,transform:"scale(1, 0.8)"},offset:null},options:void 0},{type:1,expr:"void => enter",animation:{type:4,styles:{type:6,styles:{opacity:1,transform:"scale(1, 1)"},offset:null},timings:"120ms cubic-bezier(0, 0, 0.2, 1)"},options:null},{type:1,expr:"* => void",animation:{type:4,styles:{type:6,styles:{opacity:0},offset:null},timings:"100ms linear"},options:null}],options:{}},{type:7,name:"fadeInCalendar",definitions:[{type:0,name:"void",styles:{type:6,styles:{opacity:0},offset:null},options:void 0},{type:0,name:"enter",styles:{type:6,styles:{opacity:1},offset:null},options:void 0},{type:1,expr:"void => *",animation:{type:4,styles:null,timings:"120ms 100ms cubic-bezier(0.55, 0, 0.55, 0.2)"},options:null}],options:{}}]}});function Hv(t){return Hs(2,[$s(671088640,1,{_calendar:0}),(t()(),Os(1,0,null,null,4,"mat-calendar",[["cdkTrapFocus",""],["class","mat-calendar"]],[[8,"id",0],[24,"@fadeInCalendar",0]],[[null,"selectedChange"],[null,"yearSelected"],[null,"monthSelected"],[null,"_userSelection"]],(function(t,e,n){var r=!0,i=t.component;return"selectedChange"===e&&(r=!1!==i.datepicker.select(n)&&r),"yearSelected"===e&&(r=!1!==i.datepicker._selectYear(n)&&r),"monthSelected"===e&&(r=!1!==i.datepicker._selectMonth(n)&&r),"_userSelection"===e&&(r=!1!==i.datepicker.close()&&r),r}),zv,Rv)),Qr(512,null,pa,ma,[xn,_n,tn,on]),Zr(3,278528,null,0,ya,[pa],{ngClass:[0,"ngClass"]},null),Zr(4,1458176,null,0,yf,[tn,gf,Ra],{enabled:[0,"enabled"]},null),Zr(5,10141696,[[1,4]],0,Xm,[Bm,[2,Rf],[2,Ff],Se],{headerComponent:[0,"headerComponent"],startAt:[1,"startAt"],startView:[2,"startView"],selected:[3,"selected"],minDate:[4,"minDate"],maxDate:[5,"maxDate"],dateFilter:[6,"dateFilter"],dateClass:[7,"dateClass"]},{selectedChange:"selectedChange",yearSelected:"yearSelected",monthSelected:"monthSelected",_userSelection:"_userSelection"})],(function(t,e){var n=e.component;t(e,3,0,n.datepicker.panelClass),t(e,4,0,""),t(e,5,0,n.datepicker.calendarHeaderComponent,n.datepicker.startAt,n.datepicker.startView,n.datepicker._selected,n.datepicker._minDate,n.datepicker._maxDate,n.datepicker._dateFilter,n.datepicker.dateClass)}),(function(t,e){t(e,1,0,e.component.datepicker.id,"enter")}))}function Gv(t){return Hs(0,[(t()(),Os(0,0,null,null,1,"mat-datepicker-content",[["class","mat-datepicker-content"]],[[40,"@transformPanel",0],[2,"mat-datepicker-content-touch",null]],null,null,Hv,qv)),Zr(1,4243456,null,0,eg,[tn],null,null)],null,(function(t,e){t(e,0,0,"enter",zr(e,1).datepicker.touchUi)}))}var Yv=Ar("mat-datepicker-content",eg,Gv,{color:"color"},{},[]),Kv=Vn({encapsulation:2,styles:[],data:{}});function Xv(t){return Hs(0,[(t()(),Os(0,0,null,null,1,"th",[["scope","col"]],[[1,"aria-label",0]],null,null,null,null)),(t()(),Vs(1,null,["",""]))],null,(function(t,e){t(e,0,0,e.context.$implicit.long),t(e,1,0,e.context.$implicit.narrow)}))}function Zv(t){return Hs(2,[$s(671088640,1,{_matCalendarBody:0}),(t()(),Os(1,0,null,null,8,"table",[["class","mat-calendar-table"],["role","presentation"]],null,null,null,null,null)),(t()(),Os(2,0,null,null,5,"thead",[["class","mat-calendar-table-header"]],null,null,null,null,null)),(t()(),Os(3,0,null,null,2,"tr",[],null,null,null,null,null)),(t()(),Ts(16777216,null,null,1,null,Xv)),Zr(5,278528,null,0,ba,[An,En,xn],{ngForOf:[0,"ngForOf"]},null),(t()(),Os(6,0,null,null,1,"tr",[],null,null,null,null,null)),(t()(),Os(7,0,null,null,0,"th",[["aria-hidden","true"],["class","mat-calendar-table-header-divider"],["colspan","7"]],null,null,null,null,null)),(t()(),Os(8,0,null,null,1,"tbody",[["aria-readonly","true"],["class","mat-calendar-body"],["mat-calendar-body",""],["role","grid"]],null,[[null,"selectedValueChange"],[null,"keydown"]],(function(t,e,n){var r=!0,i=t.component;return"selectedValueChange"===e&&(r=!1!==i._dateSelected(n)&&r),"keydown"===e&&(r=!1!==i._handleCalendarBodyKeydown(n)&&r),r}),Wv,Lv)),Zr(9,573440,[[1,4]],0,Um,[tn,Gi],{label:[0,"label"],rows:[1,"rows"],todayValue:[2,"todayValue"],selectedValue:[3,"selectedValue"],labelMinRequiredCells:[4,"labelMinRequiredCells"],activeCell:[5,"activeCell"]},{selectedValueChange:"selectedValueChange"})],(function(t,e){var n=e.component;t(e,5,0,n._weekdays),t(e,9,0,n._monthLabel,n._weeks,n._todayDate,n._selectedDate,3,n._dateAdapter.getDate(n.activeDate)-1)}),null)}var Qv=Vn({encapsulation:2,styles:[],data:{}});function Jv(t){return Hs(2,[$s(671088640,1,{_matCalendarBody:0}),(t()(),Os(1,0,null,null,5,"table",[["class","mat-calendar-table"],["role","presentation"]],null,null,null,null,null)),(t()(),Os(2,0,null,null,2,"thead",[["class","mat-calendar-table-header"]],null,null,null,null,null)),(t()(),Os(3,0,null,null,1,"tr",[],null,null,null,null,null)),(t()(),Os(4,0,null,null,0,"th",[["class","mat-calendar-table-header-divider"],["colspan","4"]],null,null,null,null,null)),(t()(),Os(5,0,null,null,1,"tbody",[["aria-readonly","true"],["class","mat-calendar-body"],["mat-calendar-body",""],["role","grid"]],null,[[null,"selectedValueChange"],[null,"keydown"]],(function(t,e,n){var r=!0,i=t.component;return"selectedValueChange"===e&&(r=!1!==i._monthSelected(n)&&r),"keydown"===e&&(r=!1!==i._handleCalendarBodyKeydown(n)&&r),r}),Wv,Lv)),Zr(6,573440,[[1,4]],0,Um,[tn,Gi],{label:[0,"label"],rows:[1,"rows"],todayValue:[2,"todayValue"],selectedValue:[3,"selectedValue"],labelMinRequiredCells:[4,"labelMinRequiredCells"],numCols:[5,"numCols"],activeCell:[6,"activeCell"],cellAspectRatio:[7,"cellAspectRatio"]},{selectedValueChange:"selectedValueChange"})],(function(t,e){var n=e.component;t(e,6,0,n._yearLabel,n._months,n._todayMonth,n._selectedMonth,2,4,n._dateAdapter.getMonth(n.activeDate),4/7)}),null)}var tb=Vn({encapsulation:2,styles:[],data:{}});function eb(t){return Hs(2,[$s(671088640,1,{_matCalendarBody:0}),(t()(),Os(1,0,null,null,5,"table",[["class","mat-calendar-table"],["role","presentation"]],null,null,null,null,null)),(t()(),Os(2,0,null,null,2,"thead",[["class","mat-calendar-table-header"]],null,null,null,null,null)),(t()(),Os(3,0,null,null,1,"tr",[],null,null,null,null,null)),(t()(),Os(4,0,null,null,0,"th",[["class","mat-calendar-table-header-divider"],["colspan","4"]],null,null,null,null,null)),(t()(),Os(5,0,null,null,1,"tbody",[["aria-readonly","true"],["class","mat-calendar-body"],["mat-calendar-body",""],["role","grid"]],null,[[null,"selectedValueChange"],[null,"keydown"]],(function(t,e,n){var r=!0,i=t.component;return"selectedValueChange"===e&&(r=!1!==i._yearSelected(n)&&r),"keydown"===e&&(r=!1!==i._handleCalendarBodyKeydown(n)&&r),r}),Wv,Lv)),Zr(6,573440,[[1,4]],0,Um,[tn,Gi],{rows:[0,"rows"],todayValue:[1,"todayValue"],selectedValue:[2,"selectedValue"],numCols:[3,"numCols"],activeCell:[4,"activeCell"],cellAspectRatio:[5,"cellAspectRatio"]},{selectedValueChange:"selectedValueChange"})],(function(t,e){var n=e.component;t(e,6,0,n._years,n._todayYear,n._selectedYear,4,n._getActiveCell(),4/7)}),null)}const nb=new kt("mat-tooltip-scroll-strategy");function rb(t){return()=>t.scrollStrategies.reposition({scrollThrottle:20})}class ib{constructor(t,e){this._changeDetectorRef=t,this._breakpointObserver=e,this._visibility="initial",this._closeOnInteraction=!1,this._onHide=new A,this._isHandset=this._breakpointObserver.observe("(max-width: 599.99px) and (orientation: portrait), (max-width: 959.99px) and (orientation: landscape)")}show(t){this._hideTimeoutId&&(clearTimeout(this._hideTimeoutId),this._hideTimeoutId=null),this._closeOnInteraction=!0,this._showTimeoutId=setTimeout(()=>{this._visibility="visible",this._showTimeoutId=null,this._markForCheck()},t)}hide(t){this._showTimeoutId&&(clearTimeout(this._showTimeoutId),this._showTimeoutId=null),this._hideTimeoutId=setTimeout(()=>{this._visibility="hidden",this._hideTimeoutId=null,this._markForCheck()},t)}afterHidden(){return this._onHide.asObservable()}isVisible(){return"visible"===this._visibility}ngOnDestroy(){this._onHide.complete()}_animationStart(){this._closeOnInteraction=!1}_animationDone(t){const e=t.toState;"hidden"!==e||this.isVisible()||this._onHide.next(),"visible"!==e&&"hidden"!==e||(this._closeOnInteraction=!0)}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_markForCheck(){this._changeDetectorRef.markForCheck()}}class sb{}var ob=Vn({encapsulation:2,styles:[".mat-tooltip-panel{pointer-events:none!important}.mat-tooltip{color:#fff;border-radius:4px;margin:14px;max-width:250px;padding-left:8px;padding-right:8px;overflow:hidden;text-overflow:ellipsis}@media (-ms-high-contrast:active){.mat-tooltip{outline:solid 1px}}.mat-tooltip-handset{margin:24px;padding-left:16px;padding-right:16px}"],data:{animation:[{type:7,name:"state",definitions:[{type:0,name:"initial, void, hidden",styles:{type:6,styles:{opacity:0,transform:"scale(0)"},offset:null},options:void 0},{type:0,name:"visible",styles:{type:6,styles:{transform:"scale(1)"},offset:null},options:void 0},{type:1,expr:"* => visible",animation:{type:4,styles:{type:5,steps:[{type:6,styles:{opacity:0,transform:"scale(0)",offset:0},offset:null},{type:6,styles:{opacity:.5,transform:"scale(0.99)",offset:.5},offset:null},{type:6,styles:{opacity:1,transform:"scale(1)",offset:1},offset:null}]},timings:"200ms cubic-bezier(0, 0, 0.2, 1)"},options:null},{type:1,expr:"* => hidden",animation:{type:4,styles:{type:6,styles:{opacity:0},offset:null},timings:"100ms cubic-bezier(0, 0, 0.2, 1)"},options:null}],options:{}}]}});function ab(t){return Hs(2,[(t()(),Os(0,0,null,null,4,"div",[["class","mat-tooltip"]],[[2,"mat-tooltip-handset",null],[24,"@state",0]],[[null,"@state.start"],[null,"@state.done"]],(function(t,e,n){var r=!0,i=t.component;return"@state.start"===e&&(r=!1!==i._animationStart()&&r),"@state.done"===e&&(r=!1!==i._animationDone(n)&&r),r}),null,null)),Qr(512,null,pa,ma,[xn,_n,tn,on]),Zr(2,278528,null,0,ya,[pa],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),(e=131072,n=Oa,r=[Se],Jr(-1,e|=16,null,0,n,n,r)),(t()(),Vs(4,null,["",""]))],(function(t,e){t(e,2,0,"mat-tooltip",e.component.tooltipClass)}),(function(t,e){var n,r=e.component;t(e,0,0,null==(n=function(t,e,n,r){if(Be.isWrapped(r)){r=Be.unwrap(r);const e=t.def.nodes[0].bindingIndex+0,n=Be.unwrap(t.oldValues[e]);t.oldValues[e]=new Be(n)}return r}(e,0,0,zr(e,3).transform(r._isHandset)))?null:n.matches,r._visibility),t(e,4,0,r.message)}));var e,n,r}function lb(t){return Hs(0,[(t()(),Os(0,0,null,null,1,"mat-tooltip-component",[["aria-hidden","true"]],[[4,"zoom",null]],[["body","click"]],(function(t,e,n){var r=!0;return"body:click"===e&&(r=!1!==zr(t,1)._handleBodyInteraction()&&r),r}),ab,ob)),Zr(1,180224,null,0,ib,[Se,Ep],null,null)],null,(function(t,e){t(e,0,0,"visible"===zr(e,1)._visibility?1:null)}))}var ub=Ar("mat-tooltip-component",ib,lb,{},{},[]);class cb{constructor(t,e){this._overlayRef=e,this._afterDismissed=new A,this._afterOpened=new A,this._onAction=new A,this._dismissedByAction=!1,this.containerInstance=t,this.onAction().subscribe(()=>this.dismiss()),t._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}dismissWithAction(){this._onAction.closed||(this._dismissedByAction=!0,this._onAction.next(),this._onAction.complete())}closeWithAction(){this.dismissWithAction()}_dismissAfter(t){this._durationTimeoutId=setTimeout(()=>this.dismiss(),t)}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._onAction.closed||this._onAction.complete(),this._afterDismissed.next({dismissedByAction:this._dismissedByAction}),this._afterDismissed.complete(),this._dismissedByAction=!1}afterDismissed(){return this._afterDismissed.asObservable()}afterOpened(){return this.containerInstance._onEnter}onAction(){return this._onAction.asObservable()}}const hb=new kt("MatSnackBarData");class db{constructor(){this.politeness="assertive",this.announcementMessage="",this.duration=0,this.data=null,this.horizontalPosition="center",this.verticalPosition="bottom"}}class fb{constructor(t,e){this.snackBarRef=t,this.data=e}action(){this.snackBarRef.dismissWithAction()}get hasAction(){return!!this.data.action}}class pb extends hp{constructor(t,e,n,r){super(),this._ngZone=t,this._elementRef=e,this._changeDetectorRef=n,this.snackBarConfig=r,this._destroyed=!1,this._onExit=new A,this._onEnter=new A,this._animationState="void",this._role="assertive"!==r.politeness||r.announcementMessage?"off"===r.politeness?null:"status":"alert"}attachComponentPortal(t){return this._assertNotAttached(),this._applySnackBarClasses(),this._portalOutlet.attachComponentPortal(t)}attachTemplatePortal(t){return this._assertNotAttached(),this._applySnackBarClasses(),this._portalOutlet.attachTemplatePortal(t)}onAnimationEnd(t){const{fromState:e,toState:n}=t;if(("void"===n&&"void"!==e||"hidden"===n)&&this._completeExit(),"visible"===n){const t=this._onEnter;this._ngZone.run(()=>{t.next(),t.complete()})}}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.detectChanges())}exit(){return this._animationState="hidden",this._onExit}ngOnDestroy(){this._destroyed=!0,this._completeExit()}_completeExit(){this._ngZone.onMicrotaskEmpty.asObservable().pipe(yl(1)).subscribe(()=>{this._onExit.next(),this._onExit.complete()})}_applySnackBarClasses(){const t=this._elementRef.nativeElement,e=this.snackBarConfig.panelClass;e&&(Array.isArray(e)?e.forEach(e=>t.classList.add(e)):t.classList.add(e)),"center"===this.snackBarConfig.horizontalPosition&&t.classList.add("mat-snack-bar-center"),"top"===this.snackBarConfig.verticalPosition&&t.classList.add("mat-snack-bar-top")}_assertNotAttached(){if(this._portalOutlet.hasAttached())throw Error("Attempting to attach snack bar content after content is already attached")}}class mb{}var gb=Vn({encapsulation:2,styles:[".mat-snack-bar-container{border-radius:4px;box-sizing:border-box;display:block;margin:24px;max-width:33vw;min-width:344px;padding:14px 16px;min-height:48px;transform-origin:center}@media (-ms-high-contrast:active){.mat-snack-bar-container{border:solid 1px}}.mat-snack-bar-handset{width:100%}.mat-snack-bar-handset .mat-snack-bar-container{margin:8px;max-width:100%;min-width:0;width:100%}"],data:{animation:[{type:7,name:"state",definitions:[{type:0,name:"void, hidden",styles:{type:6,styles:{transform:"scale(0.8)",opacity:0},offset:null},options:void 0},{type:0,name:"visible",styles:{type:6,styles:{transform:"scale(1)",opacity:1},offset:null},options:void 0},{type:1,expr:"* => visible",animation:{type:4,styles:null,timings:"150ms cubic-bezier(0, 0, 0.2, 1)"},options:null},{type:1,expr:"* => void, * => hidden",animation:{type:4,styles:{type:6,styles:{opacity:0},offset:null},timings:"75ms cubic-bezier(0.4, 0.0, 1, 1)"},options:null}],options:{}}]}});function yb(t){return Hs(0,[(t()(),Ts(0,null,null,0))],null,null)}function vb(t){return Hs(0,[$s(402653184,1,{_portalOutlet:0}),(t()(),Ts(16777216,null,null,1,null,yb)),Zr(2,212992,[[1,4]],0,fp,[Xe,An],{portal:[0,"portal"]},null)],(function(t,e){t(e,2,0,"")}),null)}function bb(t){return Hs(0,[(t()(),Os(0,0,null,null,1,"snack-bar-container",[["class","mat-snack-bar-container"]],[[1,"role",0],[40,"@state",0]],[["component","@state.done"]],(function(t,e,n){var r=!0;return"component:@state.done"===e&&(r=!1!==zr(t,1).onAnimationEnd(n)&&r),r}),vb,gb)),Zr(1,180224,null,0,pb,[Gi,tn,Se,db],null,null)],null,(function(t,e){t(e,0,0,zr(e,1)._role,zr(e,1)._animationState)}))}var xb=Ar("snack-bar-container",pb,bb,{},{},[]),_b=Vn({encapsulation:2,styles:[".mat-simple-snackbar{display:flex;justify-content:space-between;align-items:center;line-height:20px;opacity:1}.mat-simple-snackbar-action{flex-shrink:0;margin:-8px -8px -8px 8px}.mat-simple-snackbar-action button{max-height:36px;min-width:0}[dir=rtl] .mat-simple-snackbar-action{margin-left:-8px;margin-right:8px}"],data:{}});function wb(t){return Hs(0,[(t()(),Os(0,0,null,null,3,"div",[["class","mat-simple-snackbar-action"]],null,null,null,null,null)),(t()(),Os(1,0,null,null,2,"button",[["mat-button",""]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"]],(function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.action()&&r),r}),kv,Ev)),Zr(2,180224,null,0,ug,[tn,Sf,[2,Sv]],null,null),(t()(),Vs(3,0,["",""]))],null,(function(t,e){var n=e.component;t(e,1,0,zr(e,2).disabled||null,"NoopAnimations"===zr(e,2)._animationMode),t(e,3,0,n.data.action)}))}function Sb(t){return Hs(2,[(t()(),Os(0,0,null,null,1,"span",[],null,null,null,null,null)),(t()(),Vs(1,null,["",""])),(t()(),Ts(16777216,null,null,1,null,wb)),Zr(3,16384,null,0,_a,[An,En],{ngIf:[0,"ngIf"]},null)],(function(t,e){t(e,3,0,e.component.hasAction)}),(function(t,e){t(e,1,0,e.component.data.message)}))}function Cb(t){return Hs(0,[(t()(),Os(0,0,null,null,1,"simple-snack-bar",[["class","mat-simple-snackbar"]],null,null,null,Sb,_b)),Zr(1,49152,null,0,fb,[cb,hb],null,null)],null,null)}var Eb=Ar("simple-snack-bar",fb,Cb,{},{},[]);class kb{constructor(t){this._elementRef=t}}const Ab=Tf(kb);class Db extends Ab{constructor(t,e,n){super(t),this._platform=e,this._document=n}ngAfterViewInit(){Kt()&&this._platform.isBrowser&&(this._checkToolbarMixedModes(),this._toolbarRows.changes.subscribe(()=>this._checkToolbarMixedModes()))}_checkToolbarMixedModes(){this._toolbarRows.length&&Array.from(this._elementRef.nativeElement.childNodes).filter(t=>!(t.classList&&t.classList.contains("mat-toolbar-row"))).filter(t=>t.nodeType!==(this._document?this._document.COMMENT_NODE:8)).some(t=>!(!t.textContent||!t.textContent.trim()))&&function(){throw Error("MatToolbar: Attempting to combine different toolbar modes. Either specify multiple `<mat-toolbar-row>` elements explicitly or just place content inside of a `<mat-toolbar>` for a single row.")}()}}class Nb{}var Tb=Vn({encapsulation:2,styles:["@media (-ms-high-contrast:active){.mat-toolbar{outline:solid 1px}}.mat-toolbar-row,.mat-toolbar-single-row{display:flex;box-sizing:border-box;padding:0 16px;width:100%;flex-direction:row;align-items:center;white-space:nowrap}.mat-toolbar-multiple-rows{display:flex;box-sizing:border-box;flex-direction:column;width:100%}.mat-toolbar-multiple-rows{min-height:64px}.mat-toolbar-row,.mat-toolbar-single-row{height:64px}@media (max-width:599px){.mat-toolbar-multiple-rows{min-height:56px}.mat-toolbar-row,.mat-toolbar-single-row{height:56px}}"],data:{}});function Ob(t){return Hs(2,[js(null,0),js(null,1)],null,null)}class Ib{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?()=>{this.headers=new Map,t.split("\n").forEach(t=>{const e=t.indexOf(":");if(e>0){const n=t.slice(0,e),r=n.toLowerCase(),i=t.slice(e+1).trim();this.maybeSetNormalizedName(n,r),this.headers.has(r)?this.headers.get(r).push(i):this.headers.set(r,[i])}})}:()=>{this.headers=new Map,Object.keys(t).forEach(e=>{let n=t[e];const r=e.toLowerCase();"string"==typeof n&&(n=[n]),n.length>0&&(this.headers.set(r,n),this.maybeSetNormalizedName(e,r))})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const e=this.headers.get(t.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,e){return this.clone({name:t,value:e,op:"a"})}set(t,e){return this.clone({name:t,value:e,op:"s"})}delete(t,e){return this.clone({name:t,value:e,op:"d"})}maybeSetNormalizedName(t,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,t)}init(){this.lazyInit&&(this.lazyInit instanceof Ib?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(e=>{this.headers.set(e,t.headers.get(e)),this.normalizedNames.set(e,t.normalizedNames.get(e))})}clone(t){const e=new Ib;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof Ib?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([t]),e}applyUpdate(t){const e=t.name.toLowerCase();switch(t.op){case"a":case"s":let n=t.value;if("string"==typeof n&&(n=[n]),0===n.length)return;this.maybeSetNormalizedName(t.name,e);const r=("a"===t.op?this.headers.get(e):void 0)||[];r.push(...n),this.headers.set(e,r);break;case"d":const i=t.value;if(i){let t=this.headers.get(e);if(!t)return;t=t.filter(t=>-1===i.indexOf(t)),0===t.length?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,t)}else this.headers.delete(e),this.normalizedNames.delete(e)}}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>t(this.normalizedNames.get(e),this.headers.get(e)))}}class Rb{encodeKey(t){return Fb(t)}encodeValue(t){return Fb(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}function Fb(t){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/gi,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%2B/gi,"+").replace(/%3D/gi,"=").replace(/%3F/gi,"?").replace(/%2F/gi,"/")}class Mb{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new Rb,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function(t,e){const n=new Map;return t.length>0&&t.split("&").forEach(t=>{const r=t.indexOf("="),[i,s]=-1==r?[e.decodeKey(t),""]:[e.decodeKey(t.slice(0,r)),e.decodeValue(t.slice(r+1))],o=n.get(i)||[];o.push(s),n.set(i,o)}),n}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(e=>{const n=t.fromObject[e];this.map.set(e,Array.isArray(n)?n:[n])})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const e=this.map.get(t);return e?e[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,e){return this.clone({param:t,value:e,op:"a"})}set(t,e){return this.clone({param:t,value:e,op:"s"})}delete(t,e){return this.clone({param:t,value:e,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const e=this.encoder.encodeKey(t);return this.map.get(t).map(t=>e+"="+this.encoder.encodeValue(t)).join("&")}).join("&")}clone(t){const e=new Mb({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat([t]),e}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const e=("a"===t.op?this.map.get(t.param):void 0)||[];e.push(t.value),this.map.set(t.param,e);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let e=this.map.get(t.param)||[];const n=e.indexOf(t.value);-1!==n&&e.splice(n,1),e.length>0?this.map.set(t.param,e):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}function $b(t){return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer}function Pb(t){return"undefined"!=typeof Blob&&t instanceof Blob}function zb(t){return"undefined"!=typeof FormData&&t instanceof FormData}class Lb{constructor(t,e,n,r){let i;if(this.url=e,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function(t){switch(t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||r?(this.body=void 0!==n?n:null,i=r):i=n,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.params&&(this.params=i.params)),this.headers||(this.headers=new Ib),this.params){const t=this.params.toString();if(0===t.length)this.urlWithParams=e;else{const n=e.indexOf("?");this.urlWithParams=e+(-1===n?"?":n<e.length-1?"&":"")+t}}else this.params=new Mb,this.urlWithParams=e}serializeBody(){return null===this.body?null:$b(this.body)||Pb(this.body)||zb(this.body)||"string"==typeof this.body?this.body:this.body instanceof Mb?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||zb(this.body)?null:Pb(this.body)?this.body.type||null:$b(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Mb?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||Array.isArray(this.body)?"application/json":null}clone(t={}){const e=t.method||this.method,n=t.url||this.url,r=t.responseType||this.responseType,i=void 0!==t.body?t.body:this.body,s=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,o=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let a=t.headers||this.headers,l=t.params||this.params;return void 0!==t.setHeaders&&(a=Object.keys(t.setHeaders).reduce((e,n)=>e.set(n,t.setHeaders[n]),a)),t.setParams&&(l=Object.keys(t.setParams).reduce((e,n)=>e.set(n,t.setParams[n]),l)),new Lb(e,n,i,{params:l,headers:a,reportProgress:o,responseType:r,withCredentials:s})}}const Bb=function(){var t={Sent:0,UploadProgress:1,ResponseHeader:2,DownloadProgress:3,Response:4,User:5};return t[t.Sent]="Sent",t[t.UploadProgress]="UploadProgress",t[t.ResponseHeader]="ResponseHeader",t[t.DownloadProgress]="DownloadProgress",t[t.Response]="Response",t[t.User]="User",t}();class jb extends class{constructor(t,e=200,n="OK"){this.headers=t.headers||new Ib,this.status=void 0!==t.status?t.status:e,this.statusText=t.statusText||n,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}{constructor(t={}){super(t),this.type=Bb.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new jb({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}function Ub(t,e){return{body:e,headers:t.headers,observe:t.observe,params:t.params,reportProgress:t.reportProgress,responseType:t.responseType,withCredentials:t.withCredentials}}class Vb{constructor(t){this.handler=t}request(t,e,n={}){let r;if(t instanceof Lb)r=t;else{let i=void 0;i=n.headers instanceof Ib?n.headers:new Ib(n.headers);let s=void 0;n.params&&(s=n.params instanceof Mb?n.params:new Mb({fromObject:n.params})),r=new Lb(t,e,void 0!==n.body?n.body:null,{headers:i,params:s,reportProgress:n.reportProgress,responseType:n.responseType||"json",withCredentials:n.withCredentials})}const i=ja(r).pipe(Ol(t=>this.handler.handle(t)));if(t instanceof Lb||"events"===n.observe)return i;const s=i.pipe(Za(t=>t instanceof jb));switch(n.observe||"body"){case"body":switch(r.responseType){case"arraybuffer":return s.pipe(U(t=>{if(null!==t.body&&!(t.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return t.body}));case"blob":return s.pipe(U(t=>{if(null!==t.body&&!(t.body instanceof Blob))throw new Error("Response is not a Blob.");return t.body}));case"text":return s.pipe(U(t=>{if(null!==t.body&&"string"!=typeof t.body)throw new Error("Response is not a string.");return t.body}));case"json":default:return s.pipe(U(t=>t.body))}case"response":return s;default:throw new Error(`Unreachable: unhandled observe type ${n.observe}}`)}}delete(t,e={}){return this.request("DELETE",t,e)}get(t,e={}){return this.request("GET",t,e)}head(t,e={}){return this.request("HEAD",t,e)}jsonp(t,e){return this.request("JSONP",t,{params:(new Mb).append(e,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,e={}){return this.request("OPTIONS",t,e)}patch(t,e,n={}){return this.request("PATCH",t,Ub(n,e))}post(t,e,n={}){return this.request("POST",t,Ub(n,e))}put(t,e,n={}){return this.request("PUT",t,Ub(n,e))}}function Wb(t){return Error(`Unable to find icon with the name "${t}"`)}function qb(t){return Error(`The URL provided to MatIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${t}".`)}function Hb(t){return Error(`The literal provided to MatIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${t}".`)}class Gb{constructor(t,e){this.options=e,t.nodeName?this.svgElement=t:this.url=t}}let Yb=(()=>{class t{constructor(t,e,n,r){this._httpClient=t,this._sanitizer=e,this._errorHandler=r,this._svgIconConfigs=new Map,this._iconSetConfigs=new Map,this._cachedIconsByUrl=new Map,this._inProgressUrlFetches=new Map,this._fontCssClassesByAlias=new Map,this._defaultFontSetClass="material-icons",this._document=n}addSvgIcon(t,e,n){return this.addSvgIconInNamespace("",t,e,n)}addSvgIconLiteral(t,e,n){return this.addSvgIconLiteralInNamespace("",t,e,n)}addSvgIconInNamespace(t,e,n,r){return this._addSvgIconConfig(t,e,new Gb(n,r))}addSvgIconLiteralInNamespace(t,e,n,r){const i=this._sanitizer.sanitize(ye.HTML,n);if(!i)throw Hb(n);const s=this._createSvgElementForSingleIcon(i,r);return this._addSvgIconConfig(t,e,new Gb(s,r))}addSvgIconSet(t,e){return this.addSvgIconSetInNamespace("",t,e)}addSvgIconSetLiteral(t,e){return this.addSvgIconSetLiteralInNamespace("",t,e)}addSvgIconSetInNamespace(t,e,n){return this._addSvgIconSetConfig(t,new Gb(e,n))}addSvgIconSetLiteralInNamespace(t,e,n){const r=this._sanitizer.sanitize(ye.HTML,e);if(!r)throw Hb(e);const i=this._svgElementFromString(r);return this._addSvgIconSetConfig(t,new Gb(i,n))}registerFontClassAlias(t,e=t){return this._fontCssClassesByAlias.set(t,e),this}classNameForFontAlias(t){return this._fontCssClassesByAlias.get(t)||t}setDefaultFontSetClass(t){return this._defaultFontSetClass=t,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(t){const e=this._sanitizer.sanitize(ye.RESOURCE_URL,t);if(!e)throw qb(t);const n=this._cachedIconsByUrl.get(e);return n?ja(Kb(n)):this._loadSvgIconFromConfig(new Gb(t)).pipe(sl(t=>this._cachedIconsByUrl.set(e,t)),U(t=>Kb(t)))}getNamedSvgIcon(t,e=""){const n=Xb(e,t),r=this._svgIconConfigs.get(n);if(r)return this._getSvgFromConfig(r);const i=this._iconSetConfigs.get(e);return i?this._getSvgFromIconSetConfigs(t,i):(s=Wb(n),new _(t=>t.error(s)));var s}ngOnDestroy(){this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(t){return t.svgElement?ja(Kb(t.svgElement)):this._loadSvgIconFromConfig(t).pipe(sl(e=>t.svgElement=e),U(t=>Kb(t)))}_getSvgFromIconSetConfigs(t,e){const n=this._extractIconWithNameFromAnySet(t,e);return n?ja(n):function t(...e){let n;return"function"==typeof e[e.length-1]&&(n=e.pop()),1===e.length&&l(e[0])&&(e=e[0]),0===e.length?za:n?t(e).pipe(U(t=>n(...t))):new _(t=>new zm(t,e))}(e.filter(t=>!t.svgElement).map(t=>this._loadSvgIconSetFromConfig(t).pipe(pl(e=>{const n=`Loading icon set URL: ${this._sanitizer.sanitize(ye.RESOURCE_URL,t.url)} failed: ${e.message}`;return this._errorHandler?this._errorHandler.handleError(new Error(n)):console.error(n),ja(null)})))).pipe(U(()=>{const n=this._extractIconWithNameFromAnySet(t,e);if(!n)throw Wb(t);return n}))}_extractIconWithNameFromAnySet(t,e){for(let n=e.length-1;n>=0;n--){const r=e[n];if(r.svgElement){const e=this._extractSvgIconFromSet(r.svgElement,t,r.options);if(e)return e}}return null}_loadSvgIconFromConfig(t){return this._fetchUrl(t.url).pipe(U(e=>this._createSvgElementForSingleIcon(e,t.options)))}_loadSvgIconSetFromConfig(t){return t.svgElement?ja(t.svgElement):this._fetchUrl(t.url).pipe(U(e=>(t.svgElement||(t.svgElement=this._svgElementFromString(e)),t.svgElement)))}_createSvgElementForSingleIcon(t,e){const n=this._svgElementFromString(t);return this._setSvgAttributes(n,e),n}_extractSvgIconFromSet(t,e,n){const r=t.querySelector(`[id="${e}"]`);if(!r)return null;const i=r.cloneNode(!0);if(i.removeAttribute("id"),"svg"===i.nodeName.toLowerCase())return this._setSvgAttributes(i,n);if("symbol"===i.nodeName.toLowerCase())return this._setSvgAttributes(this._toSvgElement(i),n);const s=this._svgElementFromString("<svg></svg>");return s.appendChild(i),this._setSvgAttributes(s,n)}_svgElementFromString(t){const e=this._document.createElement("DIV");e.innerHTML=t;const n=e.querySelector("svg");if(!n)throw Error("<svg> tag not found");return n}_toSvgElement(t){const e=this._svgElementFromString("<svg></svg>"),n=t.attributes;for(let r=0;r<n.length;r++){const{name:t,value:i}=n[r];"id"!==t&&e.setAttribute(t,i)}for(let r=0;r<t.childNodes.length;r++)t.childNodes[r].nodeType===this._document.ELEMENT_NODE&&e.appendChild(t.childNodes[r].cloneNode(!0));return e}_setSvgAttributes(t,e){return t.setAttribute("fit",""),t.setAttribute("height","100%"),t.setAttribute("width","100%"),t.setAttribute("preserveAspectRatio","xMidYMid meet"),t.setAttribute("focusable","false"),e&&e.viewBox&&t.setAttribute("viewBox",e.viewBox),t}_fetchUrl(t){if(!this._httpClient)throw Error("Could not find HttpClient provider for use with Angular Material icons. Please include the HttpClientModule from @angular/common/http in your app imports.");if(null==t)throw Error(`Cannot fetch icon from URL "${t}".`);const e=this._sanitizer.sanitize(ye.RESOURCE_URL,t);if(!e)throw qb(t);const n=this._inProgressUrlFetches.get(e);if(n)return n;const r=this._httpClient.get(e,{responseType:"text"}).pipe(Il(()=>this._inProgressUrlFetches.delete(e)),ot());return this._inProgressUrlFetches.set(e,r),r}_addSvgIconConfig(t,e,n){return this._svgIconConfigs.set(Xb(t,e),n),this}_addSvgIconSetConfig(t,e){const n=this._iconSetConfigs.get(t);return n?n.push(e):this._iconSetConfigs.set(t,[e]),this}}return t.ngInjectableDef=pt({factory:function(){return new t(Rt(Vb,8),Rt(Du),Rt(Ra,8),Rt(Ht,8))},token:t,providedIn:"root"}),t})();function Kb(t){return t.cloneNode(!0)}function Xb(t,e){return t+":"+e}class Zb{constructor(t){this._elementRef=t}}const Qb=Tf(Zb),Jb=new kt("mat-icon-location",{providedIn:"root",factory:function(){const t=Ft(Ra),e=t?t.location:null;return{getPathname:()=>e?e.pathname+e.search:""}}}),tx=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],ex=tx.map(t=>`[${t}]`).join(", "),nx=/^url\(['"]?#(.*?)['"]?\)$/;class rx extends Qb{constructor(t,e,n,r,i){super(t),this._iconRegistry=e,this._location=r,this._errorHandler=i,this._inline=!1,n||t.nativeElement.setAttribute("aria-hidden","true")}get inline(){return this._inline}set inline(t){this._inline=Gd(t)}get fontSet(){return this._fontSet}set fontSet(t){this._fontSet=this._cleanupFontValue(t)}get fontIcon(){return this._fontIcon}set fontIcon(t){this._fontIcon=this._cleanupFontValue(t)}_splitIconName(t){if(!t)return["",""];const e=t.split(":");switch(e.length){case 1:return["",e[0]];case 2:return e;default:throw Error(`Invalid icon name: "${t}"`)}}ngOnChanges(t){const e=t.svgIcon;if(e)if(this.svgIcon){const[t,e]=this._splitIconName(this.svgIcon);this._iconRegistry.getNamedSvgIcon(e,t).pipe(yl(1)).subscribe(t=>this._setSvgElement(t),n=>{const r=`Error retrieving icon ${t}:${e}! ${n.message}`;this._errorHandler?this._errorHandler.handleError(new Error(r)):console.error(r)})}else e.previousValue&&this._clearSvgElement();this._usingFontIcon()&&this._updateFontIconClasses()}ngOnInit(){this._usingFontIcon()&&this._updateFontIconClasses()}ngAfterViewChecked(){const t=this._elementsWithExternalReferences;if(t&&this._location&&t.size){const t=this._location.getPathname();t!==this._previousPath&&(this._previousPath=t,this._prependPathToReferences(t))}}ngOnDestroy(){this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(t){this._clearSvgElement();const e=t.querySelectorAll("style");for(let n=0;n<e.length;n++)e[n].textContent+=" ";if(this._location){const e=this._location.getPathname();this._previousPath=e,this._cacheChildrenWithExternalReferences(t),this._prependPathToReferences(e)}this._elementRef.nativeElement.appendChild(t)}_clearSvgElement(){const t=this._elementRef.nativeElement;let e=t.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();e--;){const n=t.childNodes[e];1===n.nodeType&&"svg"!==n.nodeName.toLowerCase()||t.removeChild(n)}}_updateFontIconClasses(){if(!this._usingFontIcon())return;const t=this._elementRef.nativeElement,e=this.fontSet?this._iconRegistry.classNameForFontAlias(this.fontSet):this._iconRegistry.getDefaultFontSetClass();e!=this._previousFontSetClass&&(this._previousFontSetClass&&t.classList.remove(this._previousFontSetClass),e&&t.classList.add(e),this._previousFontSetClass=e),this.fontIcon!=this._previousFontIconClass&&(this._previousFontIconClass&&t.classList.remove(this._previousFontIconClass),this.fontIcon&&t.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(t){return"string"==typeof t?t.trim().split(" ")[0]:t}_prependPathToReferences(t){const e=this._elementsWithExternalReferences;e&&e.forEach((e,n)=>{e.forEach(e=>{n.setAttribute(e.name,`url('${t}#${e.value}')`)})})}_cacheChildrenWithExternalReferences(t){const e=t.querySelectorAll(ex),n=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let r=0;r<e.length;r++)tx.forEach(t=>{const i=e[r],s=i.getAttribute(t),o=s?s.match(nx):null;if(o){let e=n.get(i);e||(e=[],n.set(i,e)),e.push({name:t,value:o[1]})}})}}class ix{}var sx=Vn({encapsulation:2,styles:[".mat-icon{background-repeat:no-repeat;display:inline-block;fill:currentColor;height:24px;width:24px}.mat-icon.mat-icon-inline{font-size:inherit;height:inherit;line-height:inherit;width:inherit}[dir=rtl] .mat-icon-rtl-mirror{transform:scale(-1,1)}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon{display:block}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button .mat-icon{margin:auto}"],data:{}});function ox(t){return Hs(2,[js(null,0)],null,null)}class ax{constructor(){}ngOnInit(){}}var lx=Vn({encapsulation:0,styles:[[".example-spacer[_ngcontent-%COMP%]{flex:1 1 auto;color:#fff}.toolbar[_ngcontent-%COMP%]{top:0;left:0;right:0;height:60px;display:flex;align-items:center;background-color:#1976d2;color:#fff;font-weight:600}.toolbar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 16px}"]],data:{}});function ux(t){return Hs(0,[(t()(),Os(0,0,null,null,16,"p",[],null,null,null,null,null)),(t()(),Os(1,0,null,null,15,"mat-toolbar",[["class","toolbar mat-toolbar"]],[[2,"mat-toolbar-multiple-rows",null],[2,"mat-toolbar-single-row",null]],null,null,Ob,Tb)),Zr(2,4243456,null,1,Db,[tn,tf,Ra],null,null),$s(603979776,1,{_toolbarRows:1}),(t()(),Os(4,0,null,0,4,"button",[["aria-label","Example icon-button with menu icon"],["class","example-icon"],["mat-icon-button",""]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],null,null,kv,Ev)),Zr(5,180224,null,0,ug,[tn,Sf,[2,Sv]],null,null),(t()(),Os(6,0,null,0,2,"mat-icon",[["class","mat-icon notranslate"],["role","img"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,ox,sx)),Zr(7,9158656,null,0,rx,[tn,Yb,[8,null],[2,Jb],[2,Ht]],null,null),(t()(),Vs(-1,0,["menu"])),(t()(),Os(9,0,null,0,1,"span",[],null,null,null,null,null)),(t()(),Vs(-1,null,["Welcome"])),(t()(),Os(11,0,null,0,0,"span",[["class","example-spacer"]],null,null,null,null,null)),(t()(),Os(12,0,null,0,4,"a",[["mat-button",""],["routerLink","/iris"]],[[1,"target",0],[8,"href",4],[1,"tabindex",0],[1,"disabled",0],[1,"aria-disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"]],(function(t,e,n){var r=!0;return"click"===e&&(r=!1!==zr(t,13).onClick(n.button,n.ctrlKey,n.metaKey,n.shiftKey)&&r),"click"===e&&(r=!1!==zr(t,14)._haltDisabledEvents(n)&&r),r}),Dv,Av)),Zr(13,671744,null,0,nd,[ed,qc,ia],{routerLink:[0,"routerLink"]},null),Zr(14,180224,null,0,cg,[Sf,tn,[2,Sv]],null,null),(t()(),Os(15,0,null,0,1,"span",[["class","example-spacer"]],null,null,null,null,null)),(t()(),Vs(-1,null,["Iris Classifier"]))],(function(t,e){t(e,7,0),t(e,13,0,"/iris")}),(function(t,e){t(e,1,0,zr(e,2)._toolbarRows.length>0,0===zr(e,2)._toolbarRows.length),t(e,4,0,zr(e,5).disabled||null,"NoopAnimations"===zr(e,5)._animationMode),t(e,6,0,zr(e,7).inline,"primary"!==zr(e,7).color&&"accent"!==zr(e,7).color&&"warn"!==zr(e,7).color),t(e,12,0,zr(e,13).target,zr(e,13).href,zr(e,14).disabled?-1:zr(e,14).tabIndex||0,zr(e,14).disabled||null,zr(e,14).disabled.toString(),"NoopAnimations"===zr(e,14)._animationMode)}))}var cx=Vn({encapsulation:0,styles:[[""]],data:{}});function hx(t){return Hs(0,[(t()(),Os(0,0,null,null,1,"app-headers",[],null,null,null,ux,lx)),Zr(1,114688,null,0,ax,[],null,null),(t()(),Os(2,16777216,null,null,1,"router-outlet",[],null,null,null,null,null)),Zr(3,212992,null,0,od,[sd,An,Xe,[8,null],Se],null,null)],(function(t,e){t(e,1,0),t(e,3,0)}),null)}function dx(t){return Hs(0,[(t()(),Os(0,0,null,null,1,"app-root",[],null,null,null,hx,cx)),Zr(1,49152,null,0,ea,[],null,null)],null,null)}var fx=Ar("app-root",ea,dx,{},{},[]);class px{}const mx={addFlexToParent:!0,addOrientationBps:!1,disableDefaultBps:!1,disableVendorPrefixes:!1,serverLoaded:!1,useColumnBasisZero:!0,printWithBreakpoints:[],mediaTriggerAutoRestore:!0,ssrObserveBreakpoints:[]},gx=new kt("Flex Layout token, config options for the library",{providedIn:"root",factory:()=>mx}),yx=new kt("FlexLayoutServerLoaded",{providedIn:"root",factory:()=>!1}),vx=new kt("Flex Layout token, collect all breakpoints into one provider",{providedIn:"root",factory:()=>null});class bx{constructor(t){this.template=t}}class xx{}function _x(t){const{subscriber:e,counter:n,period:r}=t;e.next(n),this.schedule({subscriber:e,counter:n+1,period:r},r)}function wx(t,e){for(let n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function Sx(t,e){const n=e?"":"none";wx(t.style,{touchAction:e?"":"none",webkitUserDrag:e?"":"none",webkitTapHighlightColor:e?"":"transparent",userSelect:n,msUserSelect:n,webkitUserSelect:n,MozUserSelect:n})}function Cx(t){const e=t.toLowerCase().indexOf("ms")>-1?1:1e3;return parseFloat(t)*e}function Ex(t,e){return t.getPropertyValue(e).split(",").map(t=>t.trim())}const kx=nf({passive:!0}),Ax=nf({passive:!1});class Dx{constructor(t,e,n,r,i,s){this._config=e,this._document=n,this._ngZone=r,this._viewportRuler=i,this._dragDropRegistry=s,this._passiveTransform={x:0,y:0},this._activeTransform={x:0,y:0},this._moveEvents=new A,this._pointerMoveSubscription=d.EMPTY,this._pointerUpSubscription=d.EMPTY,this._scrollSubscription=d.EMPTY,this._resizeSubscription=d.EMPTY,this._boundaryElement=null,this._nativeInteractionsEnabled=!0,this._handles=[],this._disabledHandles=new Set,this._direction="ltr",this.dragStartDelay=0,this._disabled=!1,this.beforeStarted=new A,this.started=new A,this.released=new A,this.ended=new A,this.entered=new A,this.exited=new A,this.dropped=new A,this.moved=this._moveEvents.asObservable(),this._pointerDown=t=>{if(this.beforeStarted.next(),this._handles.length){const e=this._handles.find(e=>{const n=t.target;return!!n&&(n===e||e.contains(n))});!e||this._disabledHandles.has(e)||this.disabled||this._initializeDragSequence(e,t)}else this.disabled||this._initializeDragSequence(this._rootElement,t)},this._pointerMove=t=>{if(!this._hasStartedDragging){const e=this._getPointerPositionOnPage(t);if(Math.abs(e.x-this._pickupPositionOnPage.x)+Math.abs(e.y-this._pickupPositionOnPage.y)>=this._config.dragStartThreshold){if(!(Date.now()>=this._dragStartTime+(this.dragStartDelay||0)))return void this._endDragSequence(t);this._dropContainer&&this._dropContainer.isDragging()||(this._hasStartedDragging=!0,this._ngZone.run(()=>this._startDragSequence(t)))}return}this._boundaryElement&&(this._previewRect&&(this._previewRect.width||this._previewRect.height)||(this._previewRect=(this._preview||this._rootElement).getBoundingClientRect()));const e=this._getConstrainedPointerPosition(t);if(this._hasMoved=!0,t.preventDefault(),this._updatePointerDirectionDelta(e),this._dropContainer)this._updateActiveDropContainer(e);else{const t=this._activeTransform;t.x=e.x-this._pickupPositionOnPage.x+this._passiveTransform.x,t.y=e.y-this._pickupPositionOnPage.y+this._passiveTransform.y,this._applyRootElementTransform(t.x,t.y),"undefined"!=typeof SVGElement&&this._rootElement instanceof SVGElement&&this._rootElement.setAttribute("transform",`translate(${t.x} ${t.y})`)}this._moveEvents.observers.length&&this._ngZone.run(()=>{this._moveEvents.next({source:this,pointerPosition:e,event:t,distance:this._getDragDistance(e),delta:this._pointerDirectionDelta})})},this._pointerUp=t=>{this._endDragSequence(t)},this.withRootElement(t),s.registerDragItem(this)}get disabled(){return this._disabled||!(!this._dropContainer||!this._dropContainer.disabled)}set disabled(t){const e=Gd(t);e!==this._disabled&&(this._disabled=e,this._toggleNativeDragInteractions())}getPlaceholderElement(){return this._placeholder}getRootElement(){return this._rootElement}withHandles(t){return this._handles=t.map(t=>Xd(t)),this._handles.forEach(t=>Sx(t,!1)),this._toggleNativeDragInteractions(),this}withPreviewTemplate(t){return this._previewTemplate=t,this}withPlaceholderTemplate(t){return this._placeholderTemplate=t,this}withRootElement(t){const e=Xd(t);return e!==this._rootElement&&(this._rootElement&&this._removeRootElementListeners(this._rootElement),e.addEventListener("mousedown",this._pointerDown,Ax),e.addEventListener("touchstart",this._pointerDown,kx),this._initialTransform=void 0,this._rootElement=e),this}withBoundaryElement(t){return this._boundaryElement=t?Xd(t):null,this._resizeSubscription.unsubscribe(),t&&(this._resizeSubscription=this._viewportRuler.change(10).subscribe(()=>this._containInsideBoundaryOnResize())),this}dispose(){this._removeRootElementListeners(this._rootElement),this.isDragging()&&Ix(this._rootElement),this._destroyPreview(),this._destroyPlaceholder(),this._dragDropRegistry.removeDragItem(this),this._removeSubscriptions(),this.beforeStarted.complete(),this.started.complete(),this.released.complete(),this.ended.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this._moveEvents.complete(),this._handles=[],this._disabledHandles.clear(),this._dropContainer=void 0,this._boundaryElement=this._rootElement=this._placeholderTemplate=this._previewTemplate=this._nextSibling=null}isDragging(){return this._hasStartedDragging&&this._dragDropRegistry.isDragging(this)}reset(){this._rootElement.style.transform=this._initialTransform||"",this._activeTransform={x:0,y:0},this._passiveTransform={x:0,y:0}}disableHandle(t){this._handles.indexOf(t)>-1&&this._disabledHandles.add(t)}enableHandle(t){this._disabledHandles.delete(t)}withDirection(t){return this._direction=t,this}_withDropContainer(t){this._dropContainer=t}getFreeDragPosition(){const t=this.isDragging()?this._activeTransform:this._passiveTransform;return{x:t.x,y:t.y}}setFreeDragPosition(t){return this._activeTransform={x:0,y:0},this._passiveTransform.x=t.x,this._passiveTransform.y=t.y,this._dropContainer||this._applyRootElementTransform(t.x,t.y),this}_sortFromLastPointerPosition(){const t=this._pointerPositionAtLastDirectionChange;t&&this._dropContainer&&this._updateActiveDropContainer(t)}_removeSubscriptions(){this._pointerMoveSubscription.unsubscribe(),this._pointerUpSubscription.unsubscribe(),this._scrollSubscription.unsubscribe()}_destroyPreview(){this._preview&&Ix(this._preview),this._previewRef&&this._previewRef.destroy(),this._preview=this._previewRef=null}_destroyPlaceholder(){this._placeholder&&Ix(this._placeholder),this._placeholderRef&&this._placeholderRef.destroy(),this._placeholder=this._placeholderRef=null}_endDragSequence(t){this._dragDropRegistry.isDragging(this)&&(this._removeSubscriptions(),this._dragDropRegistry.stopDragging(this),this._toggleNativeDragInteractions(),this._handles&&(this._rootElement.style.webkitTapHighlightColor=this._rootElementTapHighlight),this._hasStartedDragging&&(this.released.next({source:this}),this._dropContainer?(this._dropContainer._stopScrolling(),this._animatePreviewToPlaceholder().then(()=>{this._cleanupDragArtifacts(t),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)})):(this._passiveTransform.x=this._activeTransform.x,this._passiveTransform.y=this._activeTransform.y,this._ngZone.run(()=>{this.ended.next({source:this,distance:this._getDragDistance(this._getPointerPositionOnPage(t))})}),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this))))}_startDragSequence(t){if(this.started.next({source:this}),Rx(t)&&(this._lastTouchEventTime=Date.now()),this._toggleNativeDragInteractions(),this._dropContainer){const t=this._rootElement;this._nextSibling=t.nextSibling;const n=this._preview=this._createPreviewElement(),r=this._placeholder=this._createPlaceholderElement();t.style.display="none",this._document.body.appendChild(t.parentNode.replaceChild(r,t)),(e=this._document,e.fullscreenElement||e.webkitFullscreenElement||e.mozFullScreenElement||e.msFullscreenElement||e.body).appendChild(n),this._dropContainer.start()}var e}_initializeDragSequence(t,e){e.stopPropagation();const n=this.isDragging(),r=Rx(e),i=!r&&0!==e.button,s=this._rootElement,o=!r&&this._lastTouchEventTime&&this._lastTouchEventTime+800>Date.now();if(e.target&&e.target.draggable&&"mousedown"===e.type&&e.preventDefault(),n||i||o)return;this._handles.length&&(this._rootElementTapHighlight=s.style.webkitTapHighlightColor,s.style.webkitTapHighlightColor="transparent"),this._hasStartedDragging=this._hasMoved=!1,this._initialContainer=this._dropContainer,this._removeSubscriptions(),this._pointerMoveSubscription=this._dragDropRegistry.pointerMove.subscribe(this._pointerMove),this._pointerUpSubscription=this._dragDropRegistry.pointerUp.subscribe(this._pointerUp),this._scrollSubscription=this._dragDropRegistry.scroll.pipe(Al(null)).subscribe(()=>{this._scrollPosition=this._viewportRuler.getViewportScrollPosition()}),this._boundaryElement&&(this._boundaryRect=this._boundaryElement.getBoundingClientRect()),this._pickupPositionInElement=this._previewTemplate&&this._previewTemplate.template?{x:0,y:0}:this._getPointerPositionInElement(t,e);const a=this._pickupPositionOnPage=this._getPointerPositionOnPage(e);this._pointerDirectionDelta={x:0,y:0},this._pointerPositionAtLastDirectionChange={x:a.x,y:a.y},this._dragStartTime=Date.now(),this._dragDropRegistry.startDragging(this,e)}_cleanupDragArtifacts(t){this._rootElement.style.display="",this._nextSibling?this._nextSibling.parentNode.insertBefore(this._rootElement,this._nextSibling):Xd(this._initialContainer.element).appendChild(this._rootElement),this._destroyPreview(),this._destroyPlaceholder(),this._boundaryRect=this._previewRect=void 0,this._ngZone.run(()=>{const e=this._dropContainer,n=e.getItemIndex(this),r=this._getPointerPositionOnPage(t),i=this._getDragDistance(this._getPointerPositionOnPage(t)),s=e._isOverContainer(r.x,r.y);this.ended.next({source:this,distance:i}),this.dropped.next({item:this,currentIndex:n,previousIndex:this._initialContainer.getItemIndex(this),container:e,previousContainer:this._initialContainer,isPointerOverContainer:s,distance:i}),e.drop(this,n,this._initialContainer,s,i),this._dropContainer=this._initialContainer})}_updateActiveDropContainer({x:t,y:e}){let n=this._initialContainer._getSiblingContainerFromPosition(this,t,e);!n&&this._dropContainer!==this._initialContainer&&this._initialContainer._isOverContainer(t,e)&&(n=this._initialContainer),n&&n!==this._dropContainer&&this._ngZone.run(()=>{this.exited.next({item:this,container:this._dropContainer}),this._dropContainer.exit(this),this._dropContainer=n,this._dropContainer.enter(this,t,e),this.entered.next({item:this,container:n,currentIndex:n.getItemIndex(this)})}),this._dropContainer._startScrollingIfNecessary(t,e),this._dropContainer._sortItem(this,t,e,this._pointerDirectionDelta),this._preview.style.transform=Nx(t-this._pickupPositionInElement.x,e-this._pickupPositionInElement.y)}_createPreviewElement(){const t=this._previewTemplate,e=t?t.template:null;let n;if(e){const r=t.viewContainer.createEmbeddedView(e,t.context);n=Fx(r,this._document),this._previewRef=r,n.style.transform=Nx(this._pickupPositionOnPage.x,this._pickupPositionOnPage.y)}else{const t=this._rootElement,e=t.getBoundingClientRect();n=Tx(t),n.style.width=e.width+"px",n.style.height=e.height+"px",n.style.transform=Nx(e.left,e.top)}return wx(n.style,{pointerEvents:"none",margin:"0",position:"fixed",top:"0",left:"0",zIndex:"1000"}),Sx(n,!1),n.classList.add("cdk-drag-preview"),n.setAttribute("dir",this._direction),n}_animatePreviewToPlaceholder(){if(!this._hasMoved)return Promise.resolve();const t=this._placeholder.getBoundingClientRect();this._preview.classList.add("cdk-drag-animating"),this._preview.style.transform=Nx(t.left,t.top);const e=function(t){const e=getComputedStyle(t),n=Ex(e,"transition-property"),r=n.find(t=>"transform"===t||"all"===t);if(!r)return 0;const i=n.indexOf(r),s=Ex(e,"transition-duration"),o=Ex(e,"transition-delay");return Cx(s[i])+Cx(o[i])}(this._preview);return 0===e?Promise.resolve():this._ngZone.runOutsideAngular(()=>new Promise(t=>{const n=e=>{(!e||e.target===this._preview&&"transform"===e.propertyName)&&(this._preview.removeEventListener("transitionend",n),t(),clearTimeout(r))},r=setTimeout(n,1.5*e);this._preview.addEventListener("transitionend",n)}))}_createPlaceholderElement(){const t=this._placeholderTemplate,e=t?t.template:null;let n;return e?(this._placeholderRef=t.viewContainer.createEmbeddedView(e,t.context),n=Fx(this._placeholderRef,this._document)):n=Tx(this._rootElement),n.classList.add("cdk-drag-placeholder"),n}_getPointerPositionInElement(t,e){const n=this._rootElement.getBoundingClientRect(),r=t===this._rootElement?null:t,i=r?r.getBoundingClientRect():n,s=Rx(e)?e.targetTouches[0]:e;return{x:i.left-n.left+(s.pageX-i.left-this._scrollPosition.left),y:i.top-n.top+(s.pageY-i.top-this._scrollPosition.top)}}_getPointerPositionOnPage(t){const e=Rx(t)?t.touches[0]||t.changedTouches[0]:t;return{x:e.pageX-this._scrollPosition.left,y:e.pageY-this._scrollPosition.top}}_getConstrainedPointerPosition(t){const e=this._getPointerPositionOnPage(t),n=this.constrainPosition?this.constrainPosition(e,this):e,r=this._dropContainer?this._dropContainer.lockAxis:null;if("x"===this.lockAxis||"x"===r?n.y=this._pickupPositionOnPage.y:"y"!==this.lockAxis&&"y"!==r||(n.x=this._pickupPositionOnPage.x),this._boundaryRect){const{x:t,y:e}=this._pickupPositionInElement,r=this._boundaryRect,i=this._previewRect,s=r.top+e,o=r.bottom-(i.height-e);n.x=Ox(n.x,r.left+t,r.right-(i.width-t)),n.y=Ox(n.y,s,o)}return n}_updatePointerDirectionDelta(t){const{x:e,y:n}=t,r=this._pointerDirectionDelta,i=this._pointerPositionAtLastDirectionChange,s=Math.abs(e-i.x),o=Math.abs(n-i.y);return s>this._config.pointerDirectionChangeThreshold&&(r.x=e>i.x?1:-1,i.x=e),o>this._config.pointerDirectionChangeThreshold&&(r.y=n>i.y?1:-1,i.y=n),r}_toggleNativeDragInteractions(){if(!this._rootElement||!this._handles)return;const t=this._handles.length>0||!this.isDragging();t!==this._nativeInteractionsEnabled&&(this._nativeInteractionsEnabled=t,Sx(this._rootElement,t))}_removeRootElementListeners(t){t.removeEventListener("mousedown",this._pointerDown,Ax),t.removeEventListener("touchstart",this._pointerDown,kx)}_applyRootElementTransform(t,e){const n=Nx(t,e);null==this._initialTransform&&(this._initialTransform=this._rootElement.style.transform||""),this._rootElement.style.transform=this._initialTransform?n+" "+this._initialTransform:n}_getDragDistance(t){const e=this._pickupPositionOnPage;return e?{x:t.x-e.x,y:t.y-e.y}:{x:0,y:0}}_cleanupCachedDimensions(){this._boundaryRect=this._previewRect=void 0}_containInsideBoundaryOnResize(){let{x:t,y:e}=this._passiveTransform;if(0===t&&0===e||this.isDragging()||!this._boundaryElement)return;const n=this._boundaryElement.getBoundingClientRect(),r=this._rootElement.getBoundingClientRect(),i=n.left-r.left,s=r.right-n.right,o=n.top-r.top,a=r.bottom-n.bottom;n.width>r.width?(i>0&&(t+=i),s>0&&(t-=s)):t=0,n.height>r.height?(o>0&&(e+=o),a>0&&(e-=a)):e=0,t===this._passiveTransform.x&&e===this._passiveTransform.y||this.setFreeDragPosition({y:e,x:t})}}function Nx(t,e){return`translate3d(${Math.round(t)}px, ${Math.round(e)}px, 0)`}function Tx(t){const e=t.cloneNode(!0),n=e.querySelectorAll("[id]"),r=t.querySelectorAll("canvas");e.removeAttribute("id");for(let i=0;i<n.length;i++)n[i].removeAttribute("id");if(r.length){const t=e.querySelectorAll("canvas");for(let e=0;e<r.length;e++){const n=t[e].getContext("2d");n&&n.drawImage(r[e],0,0)}}return e}function Ox(t,e,n){return Math.max(e,Math.min(n,t))}function Ix(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function Rx(t){return"t"===t.type[0]}function Fx(t,e){const n=t.rootNodes[0];if(n.nodeType!==e.ELEMENT_NODE){const t=e.createElement("div");return t.appendChild(n),t}return n}function Mx(t,e){return Math.max(0,Math.min(e,t))}let $x=0;class Px{constructor(t,e,n,r,i){this._dragDropRegistry=e,this._ngZone=r,this._viewportRuler=i,this.id="cdk-drop-list-ref-"+$x++,this.disabled=!1,this.sortingDisabled=!1,this.autoScrollDisabled=!1,this.enterPredicate=()=>!0,this.beforeStarted=new A,this.entered=new A,this.exited=new A,this.dropped=new A,this.sorted=new A,this._isDragging=!1,this._itemPositions=[],this._scrollPosition={top:0,left:0},this._viewportScrollPosition={top:0,left:0},this._previousSwap={drag:null,delta:0},this._siblings=[],this._orientation="vertical",this._activeSiblings=new Set,this._direction="ltr",this._viewportScrollSubscription=d.EMPTY,this._verticalScrollDirection=0,this._horizontalScrollDirection=0,this._stopScrollTimers=new A,this._handleScroll=()=>{if(!this.isDragging())return;const t=Xd(this.element);this._updateAfterScroll(this._scrollPosition,t.scrollTop,t.scrollLeft)},this._startScrollInterval=()=>{this._stopScrolling(),function(t=0,e=lf){return(!Rp(t)||t<0)&&(t=0),e&&"function"==typeof e.schedule||(e=lf),new _(n=>(n.add(e.schedule(_x,t,{subscriber:n,counter:0,period:t})),n))}(0,Tp).pipe(vp(this._stopScrollTimers)).subscribe(()=>{const t=this._scrollNode;1===this._verticalScrollDirection?Ux(t,-2):2===this._verticalScrollDirection&&Ux(t,2),1===this._horizontalScrollDirection?Vx(t,-2):2===this._horizontalScrollDirection&&Vx(t,2)})};const s=this.element=Xd(t);this._shadowRoot=function(t){if(function(){if(null==Jd){const t="undefined"!=typeof document?document.head:null;Jd=!(!t||!t.createShadowRoot&&!t.attachShadow)}return Jd}()){const e=t.getRootNode?t.getRootNode():null;if(e instanceof ShadowRoot)return e}return null}(s)||n,e.registerDropContainer(this)}dispose(){this._stopScrolling(),this._stopScrollTimers.complete(),this._removeListeners(),this.beforeStarted.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this.sorted.complete(),this._activeSiblings.clear(),this._scrollNode=null,this._dragDropRegistry.removeDropContainer(this)}isDragging(){return this._isDragging}start(){const t=Xd(this.element);this.beforeStarted.next(),this._isDragging=!0,this._cacheItems(),this._siblings.forEach(t=>t._startReceiving(this)),this._removeListeners(),this._ngZone?this._ngZone.runOutsideAngular(()=>t.addEventListener("scroll",this._handleScroll)):t.addEventListener("scroll",this._handleScroll),this._viewportRuler&&this._listenToScrollEvents()}enter(t,e,n){this.start();let r=this.sortingDisabled?this._draggables.indexOf(t):-1;-1===r&&(r=this._getItemIndexFromPointerPosition(t,e,n));const i=this._activeDraggables,s=i.indexOf(t),o=t.getPlaceholderElement();let a=i[r];if(a===t&&(a=i[r+1]),s>-1&&i.splice(s,1),a&&!this._dragDropRegistry.isDragging(a)){const e=a.getRootElement();e.parentElement.insertBefore(o,e),i.splice(r,0,t)}else Xd(this.element).appendChild(o),i.push(t);o.style.transform="",this._cacheItemPositions(),this.entered.next({item:t,container:this,currentIndex:this.getItemIndex(t)})}exit(t){this._reset(),this.exited.next({item:t,container:this})}drop(t,e,n,r,i={x:0,y:0}){this._reset(),this.dropped.next({item:t,currentIndex:e,previousIndex:n.getItemIndex(t),container:this,previousContainer:n,isPointerOverContainer:r,distance:i})}withItems(t){return this._draggables=t,t.forEach(t=>t._withDropContainer(this)),this.isDragging()&&this._cacheItems(),this}withDirection(t){return this._direction=t,this}connectedTo(t){return this._siblings=t.slice(),this}withOrientation(t){return this._orientation=t,this}getItemIndex(t){return this._isDragging?Lx("horizontal"===this._orientation&&"rtl"===this._direction?this._itemPositions.slice().reverse():this._itemPositions,e=>e.drag===t):this._draggables.indexOf(t)}isReceiving(){return this._activeSiblings.size>0}_sortItem(t,e,n,r){if(this.sortingDisabled||!this._isPointerNearDropContainer(e,n))return;const i=this._itemPositions,s=this._getItemIndexFromPointerPosition(t,e,n,r);if(-1===s&&i.length>0)return;const o="horizontal"===this._orientation,a=Lx(i,e=>e.drag===t),l=i[s],u=i[a].clientRect,c=l.clientRect,h=a>s?1:-1;this._previousSwap.drag=l.drag,this._previousSwap.delta=o?r.x:r.y;const d=this._getItemOffsetPx(u,c,h),f=this._getSiblingOffsetPx(a,i,h),p=i.slice();!function(t,e,n){const r=Mx(e,t.length-1),i=Mx(n,t.length-1);if(r===i)return;const s=t[r],o=i<r?-1:1;for(let a=r;a!==i;a+=o)t[a]=t[a+o];t[i]=s}(i,a,s),this.sorted.next({previousIndex:a,currentIndex:s,container:this,item:t}),i.forEach((e,n)=>{if(p[n]===e)return;const r=e.drag===t,i=r?d:f,s=r?t.getPlaceholderElement():e.drag.getRootElement();e.offset+=i,o?(s.style.transform=`translate3d(${Math.round(e.offset)}px, 0, 0)`,zx(e.clientRect,0,i)):(s.style.transform=`translate3d(0, ${Math.round(e.offset)}px, 0)`,zx(e.clientRect,i,0))})}_startScrollingIfNecessary(t,e){if(this.autoScrollDisabled)return;let n,r=0,i=0;if(this._isPointerNearDropContainer(t,e)){const s=Xd(this.element);[r,i]=function(t,e,n,r){const i=Wx(e,r),s=qx(e,n);let o=0,a=0;if(i){const e=t.scrollTop;1===i?e>0&&(o=1):t.scrollHeight-e>t.clientHeight&&(o=2)}if(s){const e=t.scrollLeft;1===s?e>0&&(a=1):t.scrollWidth-e>t.clientWidth&&(a=2)}return[o,a]}(s,this._clientRect,t,e),(r||i)&&(n=s)}if(this._viewportRuler&&!r&&!i){const{width:s,height:o}=this._viewportRuler.getViewportSize(),a={width:s,height:o,top:0,right:s,bottom:o,left:0};r=Wx(a,e),i=qx(a,t),n=window}!n||r===this._verticalScrollDirection&&i===this._horizontalScrollDirection&&n===this._scrollNode||(this._verticalScrollDirection=r,this._horizontalScrollDirection=i,this._scrollNode=n,(r||i)&&n?this._ngZone?this._ngZone.runOutsideAngular(this._startScrollInterval):this._startScrollInterval():this._stopScrolling())}_stopScrolling(){this._stopScrollTimers.next()}_cacheOwnPosition(){const t=Xd(this.element);this._clientRect=jx(t),this._scrollPosition={top:t.scrollTop,left:t.scrollLeft}}_cacheItemPositions(){const t="horizontal"===this._orientation;this._itemPositions=this._activeDraggables.map(t=>{const e=this._dragDropRegistry.isDragging(t)?t.getPlaceholderElement():t.getRootElement();return{drag:t,offset:0,clientRect:jx(e)}}).sort((e,n)=>t?e.clientRect.left-n.clientRect.left:e.clientRect.top-n.clientRect.top)}_reset(){this._isDragging=!1,this._activeDraggables.forEach(t=>t.getRootElement().style.transform=""),this._siblings.forEach(t=>t._stopReceiving(this)),this._activeDraggables=[],this._itemPositions=[],this._previousSwap.drag=null,this._previousSwap.delta=0,this._stopScrolling(),this._removeListeners()}_getSiblingOffsetPx(t,e,n){const r="horizontal"===this._orientation,i=e[t].clientRect,s=e[t+-1*n];let o=i[r?"width":"height"]*n;if(s){const t=r?"left":"top",e=r?"right":"bottom";-1===n?o-=s.clientRect[t]-i[e]:o+=i[t]-s.clientRect[e]}return o}_isPointerNearDropContainer(t,e){const{top:n,right:r,bottom:i,left:s,width:o,height:a}=this._clientRect,l=.05*o,u=.05*a;return e>n-u&&e<i+u&&t>s-l&&t<r+l}_getItemOffsetPx(t,e,n){const r="horizontal"===this._orientation;let i=r?e.left-t.left:e.top-t.top;return-1===n&&(i+=r?e.width-t.width:e.height-t.height),i}_getItemIndexFromPointerPosition(t,e,n,r){const i="horizontal"===this._orientation;return Lx(this._itemPositions,({drag:s,clientRect:o},a,l)=>{if(s===t)return l.length<2;if(r){const t=i?r.x:r.y;if(s===this._previousSwap.drag&&t===this._previousSwap.delta)return!1}return i?e>=Math.floor(o.left)&&e<=Math.floor(o.right):n>=Math.floor(o.top)&&n<=Math.floor(o.bottom)})}_cacheItems(){this._activeDraggables=this._draggables.slice(),this._cacheItemPositions(),this._cacheOwnPosition()}_updateAfterScroll(t,e,n,r){const i=t.top-e,s=t.left-n;r&&zx(r,i,s),this._itemPositions.forEach(({clientRect:t})=>{zx(t,i,s)}),this._itemPositions.forEach(({drag:t})=>{this._dragDropRegistry.isDragging(t)&&t._sortFromLastPointerPosition()}),t.top=e,t.left=n}_removeListeners(){Xd(this.element).removeEventListener("scroll",this._handleScroll),this._viewportScrollSubscription.unsubscribe()}_isOverContainer(t,e){return Bx(this._clientRect,t,e)}_getSiblingContainerFromPosition(t,e,n){return this._siblings.find(r=>r._canReceive(t,e,n))}_canReceive(t,e,n){if(!this.enterPredicate(t,this)||!Bx(this._clientRect,e,n))return!1;const r=this._shadowRoot.elementFromPoint(e,n);if(!r)return!1;const i=Xd(this.element);return r===i||i.contains(r)}_startReceiving(t){const e=this._activeSiblings;e.has(t)||(e.add(t),this._cacheOwnPosition(),this._listenToScrollEvents())}_stopReceiving(t){this._activeSiblings.delete(t),this._viewportScrollSubscription.unsubscribe()}_listenToScrollEvents(){this._viewportScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._viewportScrollSubscription=this._dragDropRegistry.scroll.subscribe(()=>{if(this.isDragging()){const t=this._viewportRuler.getViewportScrollPosition();this._updateAfterScroll(this._viewportScrollPosition,t.top,t.left,this._clientRect)}else this.isReceiving()&&this._cacheOwnPosition()})}}function zx(t,e,n){t.top+=e,t.bottom=t.top+t.height,t.left+=n,t.right=t.left+t.width}function Lx(t,e){for(let n=0;n<t.length;n++)if(e(t[n],n,t))return n;return-1}function Bx(t,e,n){const{top:r,bottom:i,left:s,right:o}=t;return n>=r&&n<=i&&e>=s&&e<=o}function jx(t){const e=t.getBoundingClientRect();return{top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.width,height:e.height}}function Ux(t,e){t===window?t.scrollBy(0,e):t.scrollTop+=e}function Vx(t,e){t===window?t.scrollBy(e,0):t.scrollLeft+=e}function Wx(t,e){const{top:n,bottom:r,height:i}=t,s=.05*i;return e>=n-s&&e<=n+s?1:e>=r-s&&e<=r+s?2:0}function qx(t,e){const{left:n,right:r,width:i}=t,s=.05*i;return e>=n-s&&e<=n+s?1:e>=r-s&&e<=r+s?2:0}const Hx=nf({passive:!1,capture:!0});let Gx=(()=>{class t{constructor(t,e){this._ngZone=t,this._dropInstances=new Set,this._dragInstances=new Set,this._activeDragInstances=new Set,this._globalListeners=new Map,this.pointerMove=new A,this.pointerUp=new A,this.scroll=new A,this._preventDefaultWhileDragging=t=>{this._activeDragInstances.size&&t.preventDefault()},this._document=e}registerDropContainer(t){if(!this._dropInstances.has(t)){if(this.getDropContainer(t.id))throw Error(`Drop instance with id "${t.id}" has already been registered.`);this._dropInstances.add(t)}}registerDragItem(t){this._dragInstances.add(t),1===this._dragInstances.size&&this._ngZone.runOutsideAngular(()=>{this._document.addEventListener("touchmove",this._preventDefaultWhileDragging,Hx)})}removeDropContainer(t){this._dropInstances.delete(t)}removeDragItem(t){this._dragInstances.delete(t),this.stopDragging(t),0===this._dragInstances.size&&this._document.removeEventListener("touchmove",this._preventDefaultWhileDragging,Hx)}startDragging(t,e){if(!this._activeDragInstances.has(t)&&(this._activeDragInstances.add(t),1===this._activeDragInstances.size)){const t=e.type.startsWith("touch"),n=t?"touchend":"mouseup";this._globalListeners.set(t?"touchmove":"mousemove",{handler:t=>this.pointerMove.next(t),options:Hx}).set(n,{handler:t=>this.pointerUp.next(t),options:!0}).set("scroll",{handler:t=>this.scroll.next(t),options:!0}).set("selectstart",{handler:this._preventDefaultWhileDragging,options:Hx}),this._ngZone.runOutsideAngular(()=>{this._globalListeners.forEach((t,e)=>{this._document.addEventListener(e,t.handler,t.options)})})}}stopDragging(t){this._activeDragInstances.delete(t),0===this._activeDragInstances.size&&this._clearGlobalListeners()}isDragging(t){return this._activeDragInstances.has(t)}getDropContainer(t){return Array.from(this._dropInstances).find(e=>e.id===t)}ngOnDestroy(){this._dragInstances.forEach(t=>this.removeDragItem(t)),this._dropInstances.forEach(t=>this.removeDropContainer(t)),this._clearGlobalListeners(),this.pointerMove.complete(),this.pointerUp.complete()}_clearGlobalListeners(){this._globalListeners.forEach((t,e)=>{this._document.removeEventListener(e,t.handler,t.options)}),this._globalListeners.clear()}}return t.ngInjectableDef=pt({factory:function(){return new t(Rt(Gi),Rt(Ra))},token:t,providedIn:"root"}),t})();const Yx={dragStartThreshold:5,pointerDirectionChangeThreshold:5};let Kx=(()=>{class t{constructor(t,e,n,r){this._document=t,this._ngZone=e,this._viewportRuler=n,this._dragDropRegistry=r}createDrag(t,e=Yx){return new Dx(t,e,this._document,this._ngZone,this._viewportRuler,this._dragDropRegistry)}createDropList(t){return new Px(t,this._dragDropRegistry,this._document,this._ngZone,this._viewportRuler)}}return t.ngInjectableDef=pt({factory:function(){return new t(Rt(Ra),Rt(Gi),Rt(zp),Rt(Gx))},token:t,providedIn:"root"}),t})();class Xx{}const Zx=new kt("mat-autocomplete-scroll-strategy");function Qx(t){return()=>t.scrollStrategies.reposition()}class Jx{}class t_{}let e_=(()=>{class t{constructor(){this.changes=new A,this.optionalLabel="Optional"}}return t.ngInjectableDef=pt({factory:function(){return new t},token:t,providedIn:"root"}),t})();function n_(t){return t||new e_}class r_{}const i_=new kt("mat-menu-scroll-strategy");function s_(t){return()=>t.scrollStrategies.reposition()}class o_{}class a_{}const l_=new kt("mat-select-scroll-strategy");function u_(t){return()=>t.scrollStrategies.reposition()}class c_{}let h_=(()=>{class t{constructor(){this.changes=new A,this.itemsPerPageLabel="Items per page:",this.nextPageLabel="Next page",this.previousPageLabel="Previous page",this.firstPageLabel="First page",this.lastPageLabel="Last page",this.getRangeLabel=(t,e,n)=>{if(0==n||0==e)return"0 of "+n;const r=t*e;return`${r+1} \u2013 ${r<(n=Math.max(n,0))?Math.min(r+e,n):r+e} of ${n}`}}}return t.ngInjectableDef=pt({factory:function(){return new t},token:t,providedIn:"root"}),t})();function d_(t){return t||new h_}class f_{}let p_=(()=>{class t{constructor(){this.changes=new A,this.sortButtonLabel=t=>"Change sorting for "+t}}return t.ngInjectableDef=pt({factory:function(){return new t},token:t,providedIn:"root"}),t})();function m_(t){return t||new p_}class g_{}class y_{}class v_{}class b_{}class x_{}class __{}class w_{}class S_{}const C_=new kt("mat-chips-default-options");class E_{}class k_{}class A_{}class D_{}class N_{}class T_{}class O_{}class I_{}class R_{}class F_{}class M_{}class $_{}class P_{}class z_{}class L_{}class B_{}class j_{}class U_{}class V_{}class W_{}class q_{}class H_{}class G_{constructor(t,e){Ma(e)&&!t&&console.warn("Warning: Flex Layout loaded on the server without FlexLayoutServerModule")}static withConfig(t,e=[]){return{ngModule:G_,providers:t.serverLoaded?[{provide:gx,useValue:Object.assign({},mx,t)},{provide:vx,useValue:e,multi:!0},{provide:yx,useValue:!0}]:[{provide:gx,useValue:Object.assign({},mx,t)},{provide:vx,useValue:e,multi:!0}]}}}var Y_=Qo(ta,[ea],(function(t){return function(t){const e={},n=[];let r=!1;for(let i=0;i<t.length;i++){const s=t[i];s.token===Ee&&!0===s.value&&(r=!0),1073741824&s.flags&&n.push(s.token),s.index=i,e[Un(s.token)]=s}return{factory:null,providersByKey:e,providers:t,modules:n,isRoot:r}}([xr(512,Xe,Ze,[[8,[Od,Ld,_m,Pm,Yv,Iv,ub,xb,Eb,fx]],[3,Xe],Pt]),xr(5120,Ti,As,[[3,Ti]]),xr(4608,da,fa,[Ti,[2,ha]]),xr(5120,fi,Ds,[Gi]),xr(5120,Si,Ci,[]),xr(5120,xn,Es,[]),xr(5120,_n,ks,[]),xr(4608,Du,Nu,[Ra]),xr(6144,ve,null,[Du]),xr(4608,wu,Kf,[[2,Hf],[2,Df]]),xr(5120,Zl,(function(t,e,n,r,i,s,o,a){return[new xu(t,e,n),new Au(r),new Cu(i,s,o,a)]}),[Ra,Gi,Ai,Ra,Ra,wu,Ni,[2,Su]]),xr(4608,Ql,Ql,[Zl,Gi]),xr(135680,eu,eu,[Ra]),xr(4608,ou,ou,[Ql,eu,Si]),xr(5120,Ig,xv,[]),xr(5120,_y,_v,[]),xr(4608,Yy,bv,[Ra,Ig,_y]),xr(5120,rn,wv,[ou,Yy,Gi]),xr(6144,tu,null,[eu]),xr(4608,ts,ts,[Gi]),xr(5120,qc,Sd,[ed]),xr(4608,cd,cd,[]),xr(6144,ld,null,[cd]),xr(135680,hd,hd,[ed,fs,$i,Ae,ld]),xr(4608,ud,ud,[]),xr(5120,dd,vd,[ed,$a,fd]),xr(5120,Ad,kd,[Cd]),xr(5120,Di,(function(t,e,n){return[t,(r=e,i=n,()=>{if(Fa(i)){const t=Array.from(r.querySelectorAll("[class*=flex-layout-]")),e=/\bflex-layout-.+?\b/g;t.forEach(t=>{t.classList.contains("flex-layout-ssr")&&t.parentNode?t.parentNode.removeChild(t):t.className.replace(e,"")})}})];var r,i}),[Ad,Ra,Ai]),xr(4608,Bd,dv,[rn,Ra]),xr(4608,rg,rg,[]),xr(135680,Sf,Sf,[Gi,tf]),xr(4608,bx,bx,[En]),xr(4608,Kx,Kx,[Ra,Gi,zp,Gx]),xr(4608,am,am,[Hp,Jp,Xe,sm,Qp,Ae,Gi,Ra,dm,[2,oa]]),xr(5120,lm,um,[am]),xr(5120,Zx,Qx,[am]),xr(4608,qf,qf,[]),xr(5120,e_,n_,[[3,e_]]),xr(5120,Nm,Tm,[am]),xr(135680,Om,Om,[am,Ae,[2,oa],[2,Dm],Nm,[3,Om],Jp]),xr(4608,Bm,Bm,[]),xr(5120,Zm,Qm,[am]),xr(5120,i_,s_,[am]),xr(4608,Rf,jf,[[2,If],tf]),xr(5120,l_,u_,[am]),xr(5120,nb,rb,[am]),xr(5120,h_,d_,[[3,h_]]),xr(5120,p_,m_,[[3,p_]]),xr(1073742336,Ia,Ia,[]),xr(1024,Ht,Pu,[]),xr(1024,os,(function(){return[gd()]}),[]),xr(512,Cd,Cd,[Ae]),xr(1024,_i,(function(t,e){return[(n=t,Yl("probe",Xl),Yl("coreTokens",Object.assign({},Kl,(n||[]).reduce((t,e)=>(t[e.name]=e.token,t),{}))),()=>Xl),Ed(e)];var n}),[[2,os],Cd]),xr(512,wi,wi,[[2,_i]]),xr(131584,hs,hs,[Gi,Ni,Ae,Ht,Xe,wi]),xr(1073742336,Ns,Ns,[hs]),xr(1073742336,zu,zu,[[3,zu]]),xr(1024,pd,xd,[[3,ed]]),xr(512,Sc,Cc,[]),xr(512,sd,sd,[]),xr(256,fd,{},[]),xr(1024,ia,bd,[na,[2,sa],fd]),xr(512,oa,oa,[ia,na]),xr(512,$i,$i,[]),xr(512,fs,gs,[$i,[2,ps]]),xr(1024,Yh,(function(){return[[{path:"iris",component:Md}]]}),[]),xr(1024,ed,wd,[hs,Sc,sd,oa,Ae,fs,$i,Yh,fd,[2,Xh],[2,Hh]]),xr(1073742336,yd,yd,[[2,pd],[2,ed]]),xr(1073742336,y_,y_,[]),xr(1073742336,Cv,Cv,[]),xr(1073742336,ef,ef,[]),xr(1073742336,sg,sg,[]),xr(1073742336,Ef,Ef,[]),xr(1073742336,fm,fm,[]),xr(1073742336,t_,t_,[]),xr(1073742336,v_,v_,[]),xr(1073742336,xx,xx,[]),xr(1073742336,Xx,Xx,[]),xr(1073742336,Df,Df,[[2,Af],[2,Su]]),xr(1073742336,ip,ip,[]),xr(1073742336,sp,sp,[]),xr(1073742336,op,op,[]),xr(1073742336,pp,pp,[]),xr(1073742336,Pp,Pp,[]),xr(1073742336,cm,cm,[]),xr(1073742336,Jx,Jx,[]),xr(1073742336,b_,b_,[]),xr(1073742336,gm,gm,[]),xr(1073742336,hg,hg,[]),xr(1073742336,x_,x_,[]),xr(1073742336,__,__,[]),xr(1073742336,w_,w_,[]),xr(1073742336,S_,S_,[]),xr(1073742336,E_,E_,[]),xr(1073742336,ix,ix,[]),xr(1073742336,r_,r_,[]),xr(1073742336,Im,Im,[]),xr(1073742336,ng,ng,[]),xr(1073742336,k_,k_,[]),xr(1073742336,A_,A_,[]),xr(1073742336,D_,D_,[]),xr(1073742336,Xf,Xf,[]),xr(1073742336,N_,N_,[]),xr(1073742336,T_,T_,[]),xr(1073742336,O_,O_,[]),xr(1073742336,I_,I_,[]),xr(1073742336,R_,R_,[]),xr(1073742336,o_,o_,[]),xr(1073742336,a_,a_,[]),xr(1073742336,Vf,Vf,[]),xr(1073742336,Wf,Wf,[]),xr(1073742336,c_,c_,[]),xr(1073742336,sb,sb,[]),xr(1073742336,f_,f_,[]),xr(1073742336,F_,F_,[]),xr(1073742336,M_,M_,[]),xr(1073742336,$_,$_,[]),xr(1073742336,P_,P_,[]),xr(1073742336,z_,z_,[]),xr(1073742336,L_,L_,[]),xr(1073742336,B_,B_,[]),xr(1073742336,mb,mb,[]),xr(1073742336,g_,g_,[]),xr(1073742336,j_,j_,[]),xr(1073742336,U_,U_,[]),xr(1073742336,Nb,Nb,[]),xr(1073742336,V_,V_,[]),xr(1073742336,px,px,[]),xr(1073742336,W_,W_,[]),xr(1073742336,q_,q_,[]),xr(1073742336,H_,H_,[]),xr(1073742336,G_,G_,[[2,yx],Ai]),xr(1073742336,ta,ta,[]),xr(256,Ee,!0,[]),xr(256,Sv,"BrowserAnimations",[]),xr(256,C_,{separatorKeyCodes:[13]},[]),xr(256,Ff,Uf,[])])}));(function(){if(Yt)throw new Error("Cannot enable prod mode after platform setup.");Gt=!1})(),$u().bootstrapModuleFactory(Y_).catch(t=>console.error(t))},zhpP:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(e){s(e)}}function a(t){try{l(r.throw(t))}catch(e){s(e)}}function l(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(o,a)}l((r=r.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i(n("etOl")),o=n("Ewl0"),a=n("YYB2"),l=n("jke5");e.linechart=function(t,e,n={}){return r(this,void 0,void 0,(function*(){const r=Array.isArray(e.values[0])?e.values:[e.values],i=r[0].length,c=e.series?e.series:r.map((t,e)=>"Series "+(e+1));a.assert(c.length===r.length,"Must have an equal number of series labels as there are data series"),null!=n.seriesColors&&a.assert(n.seriesColors.length===r.length,"Must have an equal number of series colors as there are data series");const h=[];for(let t=0;t<i;t++){const e={x:t};c.forEach((n,i)=>{e[n]=r[i][t].y,e[n+"-name"]=n}),h.push(e)}const d=Object.assign({},u,n),f={x:{field:"x",type:d.xType,title:d.xLabel},tooltip:[{field:"x",type:"quantitative"},...c.map(t=>({field:t,type:"quantitative"}))]},p=c.map(t=>({data:void 0,mark:{type:"line",clip:!0},encoding:{y:{field:t,type:d.yType,title:d.yLabel,scale:d.zoomToFit?{zero:!1}:null!=d.yAxisDomain?{domain:d.yAxisDomain}:void 0},color:{field:t+"-name",type:"nominal",legend:{values:c,title:null},scale:{range:d.seriesColors}}}})),m=l.getDrawArea(t),g={width:d.width||o.getDefaultWidth(m),height:d.height||o.getDefaultHeight(m),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:d.fontSize,titleFontSize:d.fontSize},text:{fontSize:d.fontSize},legend:{labelFontSize:d.fontSize,titleFontSize:d.fontSize}},data:{values:h},encoding:f,layer:[...p,{mark:"rule",selection:{hover:{type:"single",on:"mouseover",nearest:!0,clear:"mouseout"}},encoding:{color:{value:"grey",condition:{selection:{not:"hover"},value:"transparent"}}}}]};return yield s.default(m,g,{actions:!1,mode:"vega-lite",defaultStyle:!1}),Promise.resolve()}))};const u={xLabel:"x",yLabel:"y",xType:"quantitative",yType:"quantitative",zoomToFit:!1,fontSize:11}},zhpf:function(t,e,n){"use strict";n.r(e);var r={};n.r(r),n.d(r,"shuffle",(function(){return st})),n.d(r,"clamp",(function(){return ot})),n.d(r,"nearestLargerEven",(function(){return at})),n.d(r,"sum",(function(){return lt})),n.d(r,"randUniform",(function(){return ut})),n.d(r,"distSquared",(function(){return ct})),n.d(r,"assert",(function(){return ht})),n.d(r,"assertShapesMatch",(function(){return dt})),n.d(r,"assertNonNull",(function(){return ft})),n.d(r,"flatten",(function(){return pt})),n.d(r,"sizeFromShape",(function(){return mt})),n.d(r,"isScalarShape",(function(){return gt})),n.d(r,"arraysEqual",(function(){return yt})),n.d(r,"isInt",(function(){return vt})),n.d(r,"tanh",(function(){return bt})),n.d(r,"sizeToSquarishShape",(function(){return xt})),n.d(r,"createShuffledIndices",(function(){return _t})),n.d(r,"rightPad",(function(){return wt})),n.d(r,"repeatedTry",(function(){return St})),n.d(r,"inferFromImplicitShape",(function(){return Ct})),n.d(r,"parseAxisParam",(function(){return Et})),n.d(r,"squeezeShape",(function(){return kt})),n.d(r,"getTypedArrayFromDType",(function(){return At})),n.d(r,"getArrayFromDType",(function(){return Dt})),n.d(r,"checkConversionForErrors",(function(){return Nt})),n.d(r,"isValidDtype",(function(){return Tt})),n.d(r,"hasEncodingLoss",(function(){return Ot})),n.d(r,"isTypedArray",(function(){return It})),n.d(r,"bytesPerElement",(function(){return Rt})),n.d(r,"bytesFromStringArray",(function(){return Ft})),n.d(r,"isString",(function(){return Mt})),n.d(r,"isBoolean",(function(){return $t})),n.d(r,"isNumber",(function(){return Pt})),n.d(r,"inferDtype",(function(){return zt})),n.d(r,"isFunction",(function(){return Lt})),n.d(r,"nearestDivisor",(function(){return Bt})),n.d(r,"computeStrides",(function(){return jt})),n.d(r,"toTypedArray",(function(){return Ut})),n.d(r,"toNestedArray",(function(){return Vt})),n.d(r,"makeOnesTypedArray",(function(){return Wt})),n.d(r,"makeZerosTypedArray",(function(){return qt})),n.d(r,"makeZerosNestedTypedArray",(function(){return Ht})),n.d(r,"now",(function(){return Gt})),n.d(r,"assertNonNegativeIntegerDimensions",(function(){return Yt})),n.d(r,"fetch",(function(){return Kt})),n.d(r,"encodeString",(function(){return Xt})),n.d(r,"decodeString",(function(){return Zt})),n.d(r,"locToIndex",(function(){return Qt})),n.d(r,"indexToLoc",(function(){return Jt}));var i={};n.r(i),n.d(i,"makeTypesMatch",(function(){return be})),n.d(i,"assertTypesMatch",(function(){return xe})),n.d(i,"isTensorInList",(function(){return _e})),n.d(i,"getTensorsInContainer",(function(){return we}));var s={};n.r(s),n.d(s,"isMobile",(function(){return Ae})),n.d(s,"isBrowser",(function(){return De}));var o={};n.r(o),n.d(o,"assertParamsValid",(function(){return Qn})),n.d(o,"maskToAxes",(function(){return Jn})),n.d(o,"computeOutShape",(function(){return tr})),n.d(o,"stridesWithElidedDims",(function(){return er})),n.d(o,"startIndicesWithElidedDims",(function(){return ir})),n.d(o,"stopIndicesWithElidedDims",(function(){return sr})),n.d(o,"stridesForAxis",(function(){return or})),n.d(o,"startForAxis",(function(){return ar})),n.d(o,"stopForAxis",(function(){return lr})),n.d(o,"isSliceContinous",(function(){return ur})),n.d(o,"computeFlatOffset",(function(){return cr})),n.d(o,"parseSliceParams",(function(){return hr}));var a={};n.r(a),n.d(a,"segOpComputeOptimalWindowSize",(function(){return fi})),n.d(a,"computeOutShape",(function(){return pi})),n.d(a,"collectGatherOpShapeInfo",(function(){return mi}));var l={};n.r(l),n.d(l,"TEST_EPSILON_FLOAT16",(function(){return Os})),n.d(l,"expectArraysClose",(function(){return Is})),n.d(l,"testEpsilon",(function(){return Rs})),n.d(l,"expectPromiseToFail",(function(){return Ms})),n.d(l,"expectArraysEqual",(function(){return $s})),n.d(l,"expectNumbersClose",(function(){return Ps})),n.d(l,"expectValuesInRange",(function(){return Ls})),n.d(l,"expectArrayBuffersEqual",(function(){return Bs}));var u={};n.r(u),n.d(u,"validateUpdateShape",(function(){return na})),n.d(u,"validateInput",(function(){return ra})),n.d(u,"calculateShapes",(function(){return ia}));var c={};n.r(c),n.d(c,"conv2d",(function(){return ya})),n.d(c,"depthwiseConv2d",(function(){return xa})),n.d(c,"matMul",(function(){return _a}));var h={};n.r(h),n.d(h,"abs",(function(){return $e})),n.d(h,"acos",(function(){return Pe})),n.d(h,"acosh",(function(){return ze})),n.d(h,"add",(function(){return Le})),n.d(h,"addN",(function(){return Be})),n.d(h,"all",(function(){return Ze})),n.d(h,"any",(function(){return Qe})),n.d(h,"argMax",(function(){return Je})),n.d(h,"argMin",(function(){return tn})),n.d(h,"asin",(function(){return en})),n.d(h,"asinh",(function(){return nn})),n.d(h,"atan",(function(){return rn})),n.d(h,"atan2",(function(){return sn})),n.d(h,"atanh",(function(){return on})),n.d(h,"avgPool",(function(){return _n})),n.d(h,"avgPool3d",(function(){return Vn})),n.d(h,"basicLSTMCell",(function(){return pr})),n.d(h,"batchToSpaceND",(function(){return mr})),n.d(h,"batchNorm",(function(){return yr})),n.d(h,"batchNorm2d",(function(){return vr})),n.d(h,"batchNorm3d",(function(){return br})),n.d(h,"batchNorm4d",(function(){return xr})),n.d(h,"broadcastTo",(function(){return wr})),n.d(h,"buffer",(function(){return Sr})),n.d(h,"cast",(function(){return an})),n.d(h,"ceil",(function(){return Cr})),n.d(h,"clipByValue",(function(){return Er})),n.d(h,"clone",(function(){return _r})),n.d(h,"complex",(function(){return kr})),n.d(h,"concat",(function(){return Yn})),n.d(h,"concat1d",(function(){return Ar})),n.d(h,"concat2d",(function(){return Dr})),n.d(h,"concat3d",(function(){return Nr})),n.d(h,"concat4d",(function(){return Tr})),n.d(h,"conv1d",(function(){return Ir})),n.d(h,"conv2d",(function(){return Or})),n.d(h,"conv2dTranspose",(function(){return Fr})),n.d(h,"conv3d",(function(){return Mr})),n.d(h,"conv3dTranspose",(function(){return Pr})),n.d(h,"cos",(function(){return zr})),n.d(h,"cosh",(function(){return Lr})),n.d(h,"cumsum",(function(){return Br})),n.d(h,"depthToSpace",(function(){return jr})),n.d(h,"depthwiseConv2d",(function(){return Ur})),n.d(h,"diag",(function(){return Vr})),n.d(h,"dilation2d",(function(){return Wr})),n.d(h,"div",(function(){return Hr})),n.d(h,"divNoNan",(function(){return Jr})),n.d(h,"dot",(function(){return ti})),n.d(h,"elu",(function(){return ei})),n.d(h,"equal",(function(){return Xr})),n.d(h,"erf",(function(){return ni})),n.d(h,"exp",(function(){return ri})),n.d(h,"expandDims",(function(){return ii})),n.d(h,"expm1",(function(){return si})),n.d(h,"eye",(function(){return ai})),n.d(h,"fft",(function(){return li})),n.d(h,"fill",(function(){return ui})),n.d(h,"floor",(function(){return ci})),n.d(h,"floorDiv",(function(){return qr})),n.d(h,"gather",(function(){return gi})),n.d(h,"greater",(function(){return yi})),n.d(h,"greaterEqual",(function(){return vi})),n.d(h,"ifft",(function(){return bi})),n.d(h,"imag",(function(){return xi})),n.d(h,"irfft",(function(){return Ci})),n.d(h,"isFinite",(function(){return Ei})),n.d(h,"isInf",(function(){return ki})),n.d(h,"isNaN",(function(){return Ai})),n.d(h,"leakyRelu",(function(){return Ni})),n.d(h,"less",(function(){return Ti})),n.d(h,"lessEqual",(function(){return Oi})),n.d(h,"linspace",(function(){return Ii})),n.d(h,"localResponseNormalization",(function(){return Ri})),n.d(h,"log",(function(){return Fi})),n.d(h,"log1p",(function(){return Mi})),n.d(h,"logSigmoid",(function(){return qi})),n.d(h,"logSoftmax",(function(){return Ki})),n.d(h,"logSumExp",(function(){return Xi})),n.d(h,"logicalAnd",(function(){return Zi})),n.d(h,"logicalNot",(function(){return Qi})),n.d(h,"logicalOr",(function(){return Ji})),n.d(h,"logicalXor",(function(){return ts})),n.d(h,"matMul",(function(){return Kn})),n.d(h,"max",(function(){return Hi})),n.d(h,"maxPool",(function(){return es})),n.d(h,"maxPool3d",(function(){return ns})),n.d(h,"maxPoolWithArgmax",(function(){return rs})),n.d(h,"maximum",(function(){return Di})),n.d(h,"mean",(function(){return os})),n.d(h,"min",(function(){return as})),n.d(h,"minimum",(function(){return ls})),n.d(h,"mod",(function(){return us})),n.d(h,"moments",(function(){return hs})),n.d(h,"mul",(function(){return Xn})),n.d(h,"multiRNNCell",(function(){return ds})),n.d(h,"multinomial",(function(){return fs})),n.d(h,"neg",(function(){return Vi})),n.d(h,"notEqual",(function(){return ps})),n.d(h,"oneHot",(function(){return ms})),n.d(h,"ones",(function(){return ss})),n.d(h,"onesLike",(function(){return gs})),n.d(h,"outerProduct",(function(){return ys})),n.d(h,"pad",(function(){return vs})),n.d(h,"pad1d",(function(){return bs})),n.d(h,"pad2d",(function(){return xs})),n.d(h,"pad3d",(function(){return _s})),n.d(h,"pad4d",(function(){return ws})),n.d(h,"pool",(function(){return Cs})),n.d(h,"pow",(function(){return Es})),n.d(h,"prelu",(function(){return ks})),n.d(h,"print",(function(){return As})),n.d(h,"prod",(function(){return Ds})),n.d(h,"rand",(function(){return Ns})),n.d(h,"randomGamma",(function(){return Ws})),n.d(h,"randomNormal",(function(){return qs})),n.d(h,"randomUniform",(function(){return Hs})),n.d(h,"range",(function(){return Ys})),n.d(h,"real",(function(){return _i})),n.d(h,"reciprocal",(function(){return Ks})),n.d(h,"relu",(function(){return Xs})),n.d(h,"relu6",(function(){return Zs})),n.d(h,"reshape",(function(){return Ke})),n.d(h,"reverse",(function(){return wi})),n.d(h,"reverse1d",(function(){return Qs})),n.d(h,"reverse2d",(function(){return Js})),n.d(h,"reverse3d",(function(){return to})),n.d(h,"reverse4d",(function(){return eo})),n.d(h,"rfft",(function(){return io})),n.d(h,"round",(function(){return so})),n.d(h,"rsqrt",(function(){return oo})),n.d(h,"scalar",(function(){return Si})),n.d(h,"selu",(function(){return ao})),n.d(h,"separableConv2d",(function(){return lo})),n.d(h,"setdiff1dAsync",(function(){return uo})),n.d(h,"sigmoid",(function(){return Zn})),n.d(h,"sign",(function(){return co})),n.d(h,"sin",(function(){return ho})),n.d(h,"sinh",(function(){return fo})),n.d(h,"slice",(function(){return dr})),n.d(h,"slice1d",(function(){return po})),n.d(h,"slice2d",(function(){return mo})),n.d(h,"slice3d",(function(){return go})),n.d(h,"slice4d",(function(){return yo})),n.d(h,"softmax",(function(){return vo})),n.d(h,"softplus",(function(){return Wi})),n.d(h,"spaceToBatchND",(function(){return Ss})),n.d(h,"split",(function(){return ro})),n.d(h,"sqrt",(function(){return bo})),n.d(h,"square",(function(){return cs})),n.d(h,"squaredDifference",(function(){return xo})),n.d(h,"squeeze",(function(){return _o})),n.d(h,"stack",(function(){return wo})),n.d(h,"step",(function(){return So})),n.d(h,"stridedSlice",(function(){return Co})),n.d(h,"sub",(function(){return Gi})),n.d(h,"sum",(function(){return Yi})),n.d(h,"tan",(function(){return Eo})),n.d(h,"tanh",(function(){return fr})),n.d(h,"tensor",(function(){return Gn})),n.d(h,"tensor1d",(function(){return Gs})),n.d(h,"tensor2d",(function(){return ko})),n.d(h,"tensor3d",(function(){return Ao})),n.d(h,"tensor4d",(function(){return Do})),n.d(h,"tensor5d",(function(){return No})),n.d(h,"tensor6d",(function(){return To})),n.d(h,"tile",(function(){return oi})),n.d(h,"topk",(function(){return Oo})),n.d(h,"truncatedNormal",(function(){return Io})),n.d(h,"unsortedSegmentSum",(function(){return Ro})),n.d(h,"unstack",(function(){return Fo})),n.d(h,"variable",(function(){return Mo})),n.d(h,"where",(function(){return Zr})),n.d(h,"whereAsync",(function(){return Po})),n.d(h,"zeros",(function(){return is})),n.d(h,"zerosLike",(function(){return Qr})),n.d(h,"op",(function(){return Me})),n.d(h,"image",(function(){return ol})),n.d(h,"linalg",(function(){return al})),n.d(h,"losses",(function(){return ll})),n.d(h,"spectral",(function(){return il})),n.d(h,"fused",(function(){return c})),n.d(h,"signal",(function(){return sl})),n.d(h,"booleanMaskAsync",(function(){return zo})),n.d(h,"equalStrict",(function(){return Lo})),n.d(h,"greaterEqualStrict",(function(){return Bo})),n.d(h,"greaterStrict",(function(){return jo})),n.d(h,"lessEqualStrict",(function(){return Uo})),n.d(h,"lessStrict",(function(){return Vo})),n.d(h,"notEqualStrict",(function(){return Wo})),n.d(h,"addStrict",(function(){return qo})),n.d(h,"divStrict",(function(){return Ho})),n.d(h,"maximumStrict",(function(){return Go})),n.d(h,"minimumStrict",(function(){return Yo})),n.d(h,"modStrict",(function(){return Ko})),n.d(h,"mulStrict",(function(){return Xo})),n.d(h,"powStrict",(function(){return Zo})),n.d(h,"squaredDifferenceStrict",(function(){return Qo})),n.d(h,"subStrict",(function(){return Jo})),n.d(h,"transpose",(function(){return Xe})),n.d(h,"norm",(function(){return ta})),n.d(h,"movingAverage",(function(){return ea})),n.d(h,"scatterND",(function(){return sa})),n.d(h,"sparseToDense",(function(){return oa})),n.d(h,"gatherND",(function(){return aa})),n.d(h,"dropout",(function(){return la})),n.d(h,"enclosingPowerOfTwo",(function(){return ua})),n.d(h,"cosineWindow",(function(){return ca})),n.d(h,"inTopKAsync",(function(){return ha}));var d={};n.r(d),n.d(d,"copyModel",(function(){return Nl})),n.d(d,"listModels",(function(){return Al})),n.d(d,"moveModel",(function(){return Tl})),n.d(d,"removeModel",(function(){return Dl})),n.d(d,"browserFiles",(function(){return Xl})),n.d(d,"browserHTTPRequest",(function(){return su})),n.d(d,"concatenateArrayBuffers",(function(){return ml})),n.d(d,"decodeWeights",(function(){return hl})),n.d(d,"encodeWeights",(function(){return cl})),n.d(d,"fromMemory",(function(){return lu})),n.d(d,"getLoadHandlers",(function(){return Sl})),n.d(d,"getModelArtifactsInfoForJSON",(function(){return yl})),n.d(d,"getSaveHandlers",(function(){return wl})),n.d(d,"http",(function(){return iu})),n.d(d,"isHTTPScheme",(function(){return nu})),n.d(d,"loadWeights",(function(){return Jl})),n.d(d,"registerLoadRouter",(function(){return _l})),n.d(d,"registerSaveRouter",(function(){return xl})),n.d(d,"weightsLoaderFactory",(function(){return tu})),n.d(d,"withSaveHandler",(function(){return uu}));var f={};n.r(f),n.d(f,"confusionMatrix",(function(){return cu}));var p={};n.r(p),n.d(p,"toPixels",(function(){return du})),n.d(p,"fromPixels",(function(){return fu}));var m={};n.r(m),n.d(m,"prepareAndValidate",(function(){return pu}));var g={};n.r(g),n.d(g,"Serializable",(function(){return mu})),n.d(g,"SerializationMap",(function(){return gu})),n.d(g,"registerClass",(function(){return yu}));var y={};n.r(y),n.d(y,"upcastType",(function(){return ye})),n.d(y,"prepareAndValidate",(function(){return pu})),n.d(y,"validateUpdateShape",(function(){return na})),n.d(y,"validateInput",(function(){return ra})),n.d(y,"calculateShapes",(function(){return ia})),n.d(y,"segment_util",(function(){return a})),n.d(y,"castTensor",(function(){return tc})),n.d(y,"reshapeTensor",(function(){return ec})),n.d(y,"linspaceImpl",(function(){return nc})),n.d(y,"axesAreInnerMostDims",(function(){return je})),n.d(y,"combineLocations",(function(){return Ue})),n.d(y,"computeOutAndReduceShapes",(function(){return Ve})),n.d(y,"expandShapeToKeepDim",(function(){return We})),n.d(y,"assertAxesAreInnerMostDims",(function(){return qe})),n.d(y,"getAxesPermutation",(function(){return He})),n.d(y,"getUndoAxesPermutation",(function(){return Ge})),n.d(y,"getInnerMostAxes",(function(){return Ye})),n.d(y,"getBroadcastDims",(function(){return Gr})),n.d(y,"getReductionAxes",(function(){return Yr})),n.d(y,"assertAndGetBroadcastShape",(function(){return Kr})),n.d(y,"assertParamsConsistent",(function(){return Wn})),n.d(y,"computeOutShape",(function(){return qn})),n.d(y,"computeDilation2DInfo",(function(){return ln})),n.d(y,"computePool2DInfo",(function(){return un})),n.d(y,"computePool3DInfo",(function(){return cn})),n.d(y,"computeConv2DInfo",(function(){return hn})),n.d(y,"computeConv3DInfo",(function(){return dn})),n.d(y,"computeDefaultPad",(function(){return fn})),n.d(y,"tupleValuesAreOne",(function(){return vn})),n.d(y,"eitherStridesOrDilationsAreOne",(function(){return bn})),n.d(y,"convertConv2DDataFormat",(function(){return xn})),n.d(y,"getFusedDyActivation",(function(){return fa})),n.d(y,"getFusedBiasGradient",(function(){return pa})),n.d(y,"applyActivation",(function(){return ma})),n.d(y,"shouldFuse",(function(){return ga})),n.d(y,"PARALLELIZE_THRESHOLD",(function(){return hi})),n.d(y,"computeOptimalWindowSize",(function(){return di})),n.d(y,"getImageCenter",(function(){return Tu})),n.d(y,"getReshaped",(function(){return Ou})),n.d(y,"getPermuted",(function(){return Iu})),n.d(y,"getReshapedPermuted",(function(){return Ru})),n.d(y,"getSliceBeginCoords",(function(){return Fu})),n.d(y,"getSliceSize",(function(){return Mu})),n.d(y,"SELU_SCALEALPHA",(function(){return $u})),n.d(y,"SELU_SCALE",(function(){return Pu})),n.d(y,"ERF_P",(function(){return zu})),n.d(y,"ERF_A1",(function(){return Lu})),n.d(y,"ERF_A2",(function(){return Bu})),n.d(y,"ERF_A3",(function(){return ju})),n.d(y,"ERF_A4",(function(){return Uu})),n.d(y,"ERF_A5",(function(){return Vu})),n.d(y,"warn",(function(){return Wu})),n.d(y,"log",(function(){return qu})),n.d(y,"mergeRealAndImagArrays",(function(){return Hu})),n.d(y,"splitRealAndImagArrays",(function(){return Gu})),n.d(y,"complexWithEvenIndex",(function(){return Yu})),n.d(y,"complexWithOddIndex",(function(){return Ku})),n.d(y,"getComplexWithIndex",(function(){return Xu})),n.d(y,"assignToTypedArray",(function(){return Zu})),n.d(y,"exponents",(function(){return Qu})),n.d(y,"exponent",(function(){return Ju})),n.d(y,"prepareSplitSize",(function(){return no}));var v={};n.r(v),n.d(v,"nonMaxSuppressionV3Impl",(function(){return Ra})),n.d(v,"nonMaxSuppressionV4Impl",(function(){return Fa})),n.d(v,"nonMaxSuppressionV5Impl",(function(){return Ma})),n.d(v,"split",(function(){return rc})),n.d(v,"tile",(function(){return ic})),n.d(v,"topkImpl",(function(){return sc})),n.d(v,"whereImpl",(function(){return $o}));var b={};n.r(b),n.d(b,"maxNorm",(function(){return Xh})),n.d(b,"unitNorm",(function(){return Zh})),n.d(b,"nonNeg",(function(){return Qh})),n.d(b,"minMaxNorm",(function(){return Jh}));var x={};n.r(x),n.d(x,"zeros",(function(){return rf})),n.d(x,"ones",(function(){return sf})),n.d(x,"constant",(function(){return of})),n.d(x,"randomUniform",(function(){return af})),n.d(x,"randomNormal",(function(){return lf})),n.d(x,"truncatedNormal",(function(){return uf})),n.d(x,"identity",(function(){return cf})),n.d(x,"varianceScaling",(function(){return hf})),n.d(x,"glorotUniform",(function(){return df})),n.d(x,"glorotNormal",(function(){return ff})),n.d(x,"heNormal",(function(){return pf})),n.d(x,"heUniform",(function(){return mf})),n.d(x,"leCunNormal",(function(){return gf})),n.d(x,"leCunUniform",(function(){return yf})),n.d(x,"orthogonal",(function(){return vf}));var _={};n.r(_),n.d(_,"inputLayer",(function(){return Qg})),n.d(_,"elu",(function(){return Jg})),n.d(_,"reLU",(function(){return ty})),n.d(_,"leakyReLU",(function(){return ey})),n.d(_,"prelu",(function(){return ny})),n.d(_,"softmax",(function(){return ry})),n.d(_,"thresholdedReLU",(function(){return iy})),n.d(_,"conv1d",(function(){return sy})),n.d(_,"conv2d",(function(){return oy})),n.d(_,"conv2dTranspose",(function(){return ay})),n.d(_,"conv3d",(function(){return ly})),n.d(_,"separableConv2d",(function(){return uy})),n.d(_,"cropping2D",(function(){return cy})),n.d(_,"upSampling2d",(function(){return hy})),n.d(_,"depthwiseConv2d",(function(){return dy})),n.d(_,"activation",(function(){return fy})),n.d(_,"dense",(function(){return py})),n.d(_,"dropout",(function(){return my})),n.d(_,"spatialDropout1d",(function(){return gy})),n.d(_,"flatten",(function(){return yy})),n.d(_,"repeatVector",(function(){return vy})),n.d(_,"reshape",(function(){return by})),n.d(_,"permute",(function(){return xy})),n.d(_,"embedding",(function(){return _y})),n.d(_,"add",(function(){return wy})),n.d(_,"average",(function(){return Sy})),n.d(_,"concatenate",(function(){return Cy})),n.d(_,"maximum",(function(){return Ey})),n.d(_,"minimum",(function(){return ky})),n.d(_,"multiply",(function(){return Ay})),n.d(_,"dot",(function(){return Dy})),n.d(_,"batchNormalization",(function(){return Ny})),n.d(_,"layerNormalization",(function(){return Ty})),n.d(_,"zeroPadding2d",(function(){return Oy})),n.d(_,"averagePooling1d",(function(){return Iy})),n.d(_,"avgPool1d",(function(){return Ry})),n.d(_,"avgPooling1d",(function(){return Fy})),n.d(_,"averagePooling2d",(function(){return My})),n.d(_,"avgPool2d",(function(){return $y})),n.d(_,"avgPooling2d",(function(){return Py})),n.d(_,"averagePooling3d",(function(){return zy})),n.d(_,"avgPool3d",(function(){return Ly})),n.d(_,"avgPooling3d",(function(){return By})),n.d(_,"globalAveragePooling1d",(function(){return jy})),n.d(_,"globalAveragePooling2d",(function(){return Uy})),n.d(_,"globalMaxPooling1d",(function(){return Vy})),n.d(_,"globalMaxPooling2d",(function(){return Wy})),n.d(_,"maxPooling1d",(function(){return qy})),n.d(_,"maxPooling2d",(function(){return Hy})),n.d(_,"maxPooling3d",(function(){return Gy})),n.d(_,"gru",(function(){return Yy})),n.d(_,"gruCell",(function(){return Ky})),n.d(_,"lstm",(function(){return Xy})),n.d(_,"lstmCell",(function(){return Zy})),n.d(_,"simpleRNN",(function(){return Qy})),n.d(_,"simpleRNNCell",(function(){return Jy})),n.d(_,"rnn",(function(){return tv})),n.d(_,"stackedRNNCells",(function(){return ev})),n.d(_,"bidirectional",(function(){return nv})),n.d(_,"timeDistributed",(function(){return rv})),n.d(_,"globalMaxPool1d",(function(){return iv})),n.d(_,"globalMaxPool2d",(function(){return sv})),n.d(_,"maxPool1d",(function(){return ov})),n.d(_,"maxPool2d",(function(){return av})),n.d(_,"Layer",(function(){return $f})),n.d(_,"RNN",(function(){return Lg})),n.d(_,"RNNCell",(function(){return Bg})),n.d(_,"input",(function(){return tm})),n.d(_,"gaussianNoise",(function(){return lv})),n.d(_,"gaussianDropout",(function(){return uv})),n.d(_,"alphaDropout",(function(){return cv})),n.d(_,"masking",(function(){return hv}));var w={};n.r(w),n.d(w,"binaryAccuracy",(function(){return dv})),n.d(w,"binaryCrossentropy",(function(){return fv})),n.d(w,"sparseCategoricalAccuracy",(function(){return pv})),n.d(w,"categoricalAccuracy",(function(){return mv})),n.d(w,"categoricalCrossentropy",(function(){return gv})),n.d(w,"precision",(function(){return yv})),n.d(w,"recall",(function(){return vv})),n.d(w,"cosineProximity",(function(){return bv})),n.d(w,"meanAbsoluteError",(function(){return xv})),n.d(w,"meanAbsolutePercentageError",(function(){return _v})),n.d(w,"MAPE",(function(){return wv})),n.d(w,"mape",(function(){return Sv})),n.d(w,"meanSquaredError",(function(){return Cv})),n.d(w,"MSE",(function(){return Ev})),n.d(w,"mse",(function(){return kv}));var S={};n.r(S),n.d(S,"modelFromJSON",(function(){return Kp}));var C={};n.r(C),n.d(C,"l1l2",(function(){return Av})),n.d(C,"l1",(function(){return Dv})),n.d(C,"l2",(function(){return Nv}));var E={};n.r(E),n.d(E,"json",(function(){return Yv}));var k={};n.r(k),n.d(k,"json",(function(){return Kv}));var A={};n.r(A),n.d(A,"json",(function(){return Xv}));var D={};n.r(D),n.d(D,"json",(function(){return Zv}));var N={};n.r(N),n.d(N,"json",(function(){return Qv}));var T={};n.r(T),n.d(T,"json",(function(){return Jv}));var O={};n.r(O),n.d(O,"json",(function(){return tb}));var I={};n.r(I),n.d(I,"json",(function(){return eb}));var R={};n.r(R),n.d(R,"json",(function(){return nb}));var F={};n.r(F),n.d(F,"json",(function(){return rb}));var M={};n.r(M),n.d(M,"json",(function(){return ib}));var $={};n.r($),n.d($,"json",(function(){return sb}));var P={};n.r(P),n.d(P,"json",(function(){return ob}));var z={};n.r(z),n.d(z,"json",(function(){return ab}));var L={};n.r(L),n.d(L,"json",(function(){return lb}));var B={};n.r(B),n.d(B,"json",(function(){return ub}));var j={};n.r(j),n.d(j,"array",(function(){return mx})),n.d(j,"Dataset",(function(){return fx})),n.d(j,"zip",(function(){return gx})),n.d(j,"CSVDataset",(function(){return Cx})),n.d(j,"TextLineDataset",(function(){return vx})),n.d(j,"csv",(function(){return zx})),n.d(j,"func",(function(){return Lx})),n.d(j,"generator",(function(){return Bx})),n.d(j,"microphone",(function(){return Ux})),n.d(j,"webcam",(function(){return jx})),n.d(j,"FileDataSource",(function(){return $x})),n.d(j,"URLDataSource",(function(){return Px})),n.d(j,"version_data",(function(){return Vx}));var U={};n.r(U),n.d(U,"maxImpl",(function(){return o_})),n.d(U,"transposeImpl",(function(){return a_}));class V{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}setPlatform(t,e){null!=this.platform&&console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`),this.platformName=t,this.platform=e}registerFlag(t,e,n){if(this.flagRegistry[t]={evaluationFn:e,setHook:n},null!=this.urlFlags[t]){const e=this.urlFlags[t];console.warn(`Setting feature override from URL ${t}: ${e}.`),this.set(t,e)}}async getAsync(t){return t in this.flags||(this.flags[t]=await this.evaluateFlag(t)),this.flags[t]}get(t){if(t in this.flags)return this.flags[t];const e=this.evaluateFlag(t);if(e instanceof Promise)throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=e,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,e){if(null==this.flagRegistry[t])throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=e,null!=this.flagRegistry[t].setHook&&this.flagRegistry[t].setHook(e)}evaluateFlag(t){if(null==this.flagRegistry[t])throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(void 0===this.global||void 0===this.global.location||void 0===this.global.location.search)return;const t=function(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...n)=>(function(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}(e,n[0],n[1]),n.join("="))),e}(this.global.location.search);"tfjsflags"in t&&t.tfjsflags.split(",").forEach(t=>{const[e,n]=t.split(":");this.urlFlags[e]=function(t,e){if("true"===(e=e.toLowerCase())||"false"===e)return"true"===e;if(""+ +e===e)return+e;throw new Error(`Could not parse value flag value ${e} for flag ${t}.`)}(e,n)})}}function W(){return H}let q,H=null;function G(){if(null==q){let t;if("undefined"!=typeof window)t=window;else if("undefined"!=typeof global)t=global;else if("undefined"!=typeof process)t=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");t=self}q=t}return q}function Y(t,e){const n=function(){const t=G();return null==t._tfGlobals&&(t._tfGlobals=new Map),t._tfGlobals}();if(n.has(t))return n.get(t);{const r=e();return n.set(t,r),n.get(t)}}const K=Y("kernelRegistry",()=>new Map),X=Y("gradRegistry",()=>new Map);function Z(t,e){const n=it(t,e);return K.get(n)}function Q(t){return X.get(t)}function J(t){const e=K.entries(),n=[];for(;;){const{done:r,value:i}=e.next();if(r)break;const[s,o]=i,[a]=s.split("_");a===t&&n.push(o)}return n}function tt(t){const{kernelName:e,backendName:n}=t,r=it(e,n);K.has(r)&&console.warn(`The kernel '${e}' for backend '${n}' is already registered`),K.set(r,t)}function et(t){const{kernelName:e}=t;X.has(e)&&W().getBool("DEBUG")&&console.warn(`Overriding the gradient for '${e}'`),X.set(e,t)}function nt(t,e){const n=it(t,e);if(!K.has(n))throw new Error(`The kernel '${t}' for backend '${e}' is not registered`);K.delete(n)}function rt(t){if(!X.has(t))throw new Error(`The gradient '${t}' for backend is not registered`);X.delete(t)}function it(t,e){return`${e}_${t}`}function st(t){let e=t.length,n=0,r=0;for(;e>0;)r=Math.random()*e|0,e--,n=t[e],t[e]=t[r],t[r]=n}function ot(t,e,n){return Math.max(t,Math.min(e,n))}function at(t){return t%2==0?t:t+1}function lt(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}function ut(t,e){const n=Math.random();return e*n+(1-n)*t}function ct(t,e){let n=0;for(let r=0;r<t.length;r++){const i=Number(t[r])-Number(e[r]);n+=i*i}return n}function ht(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function dt(t,e,n=""){ht(yt(t,e),()=>n+` Shapes ${t} and ${e} must match`)}function ft(t){ht(null!=t,()=>"The input to the tensor constructor must be a non-null value.")}function pt(t,e=[],n=!1){if(null==e&&(e=[]),Array.isArray(t)||It(t)&&!n)for(let r=0;r<t.length;++r)pt(t[r],e,n);else e.push(t);return e}function mt(t){if(0===t.length)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function gt(t){return 0===t.length}function yt(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function vt(t){return t%1==0}function bt(t){if(null!=Math.tanh)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;{const e=Math.exp(2*t);return(e-1)/(e+1)}}function xt(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function _t(t){const e=new Uint32Array(t);for(let n=0;n<t;++n)e[n]=n;return st(e),e}function wt(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function St(t,e=(t=>0),n){return new Promise((r,i)=>{let s=0;const o=()=>{if(t())return void r();s++;const a=e(s);null!=n&&s>=n?i():setTimeout(o,a)};o()})}function Ct(t,e){let n=1,r=-1;for(let s=0;s<t.length;++s)if(t[s]>=0)n*=t[s];else if(-1===t[s]){if(-1!==r)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${s}`);r=s}else if(t[s]<0)throw Error(`Shapes can not be < 0. Found ${t[s]} at dim ${s}`);if(-1===r){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(0===n)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!=0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const i=t.slice();return i[r]=e/n,i}function Et(t,e){const n=e.length;return ht((t=null==t?e.map((t,e)=>e):[].concat(t)).every(t=>t>=-n&&t<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis `+t),ht(t.every(t=>vt(t)),()=>"All values in axis param must be integers but got axis "+t),t.map(t=>t<0?n+t:t)}function kt(t,e){const n=[],r=[],i=null!=e&&Array.isArray(e)&&0===e.length,s=null==e||i?null:Et(e,t).sort();let o=0;for(let a=0;a<t.length;++a){if(null!=s){if(s[o]===a&&1!==t[a])throw new Error(`Can't squeeze axis ${a} since its dim '${t[a]}' is not 1`);(null==s[o]||s[o]>a)&&1===t[a]&&(n.push(t[a]),r.push(a)),s[o]<=a&&o++}1!==t[a]&&(n.push(t[a]),r.push(a))}return{newShape:n,keptDims:r}}function At(t,e){let n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else{if("bool"!==t)throw new Error("Unknown data type "+t);n=new Uint8Array(e)}return n}function Dt(t,e){let n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else if("bool"===t)n=new Uint8Array(e);else{if("string"!==t)throw new Error("Unknown data type "+t);n=new Array(e)}return n}function Nt(t,e){for(let n=0;n<t.length;n++){const r=t[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${e} being uploaded contains ${r}.`)}}function Tt(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}function Ot(t,e){return!("complex64"===e||"float32"===e&&"complex64"!==t||"int32"===e&&"float32"!==t&&"complex64"!==t||"bool"===e&&"bool"===t)}function It(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function Rt(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error("Unknown dtype "+t)}function Ft(t){if(null==t)return 0;let e=0;return t.forEach(t=>e+=t.length),e}function Mt(t){return"string"==typeof t||t instanceof String}function $t(t){return"boolean"==typeof t}function Pt(t){return"number"==typeof t}function zt(t){return Array.isArray(t)?zt(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":Pt(t)?"float32":Mt(t)?"string":$t(t)?"bool":"float32"}function Lt(t){return!!(t&&t.constructor&&t.call&&t.apply)}function Bt(t,e){for(let n=e;n<t;++n)if(t%n==0)return n;return t}function jt(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function Ut(t,e){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=pt(t)),W().getBool("DEBUG")&&Nt(t,e),function(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}(t,e))return t;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){const e=new Uint8Array(t.length);for(let n=0;n<e.length;++n)0!==Math.round(t[n])&&(e[n]=1);return e}throw new Error("Unknown data type "+e)}function Vt(t,e){if(0===t.length)return e[0];const n=t.reduce((t,e)=>t*e);if(0===n)return[];if(n!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}.`);return function t(e,n,r){const i=new Array;if(1===n.length){const t=n[0];for(let n=0;n<t;n++)i[n]=r[e+n]}else{const s=n[0],o=n.slice(1),a=o.reduce((t,e)=>t*e);for(let n=0;n<s;n++)i[n]=t(e+n*a,o,r)}return i}(0,t,e)}function Wt(t,e){const n=qt(t,e);for(let r=0;r<n.length;r++)n[r]=1;return n}function qt(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error("Unknown data type "+e)}function Ht(t,e){const n=t.reduce((t,e)=>t*e,1);if(null==e||"float32"===e)return Vt(t,new Float32Array(n));if("int32"===e)return Vt(t,new Int32Array(n));if("bool"===e)return Vt(t,new Uint8Array(n));throw new Error("Unknown data type "+e)}function Gt(){return W().platform.now()}function Yt(t){t.forEach(e=>{ht(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`)})}function Kt(t,e){return W().platform.fetch(t,e)}function Xt(t,e="utf-8"){return e=e||"utf-8",W().platform.encode(t,e)}function Zt(t,e="utf-8"){return e=e||"utf-8",W().platform.decode(t,e)}function Qt(t,e,n){if(0===e)return 0;if(1===e)return t[0];let r=t[t.length-1];for(let i=0;i<t.length-1;++i)r+=n[i]*t[i];return r}function Jt(t,e,n){if(0===e)return[];if(1===e)return[t];const r=new Array(e);for(let i=0;i<r.length-1;++i)r[i]=Math.floor(t/n[i]),t-=r[i]*n[i];return r[r.length-1]=t,r}class te{constructor(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new ee)}profileKernel(t,e,n){let r;const i=this.backendTimer.time(()=>{r=n()});return r.map(e=>{e.data().then(n=>{!function(t,e,n){if("float32"!==e)return!1;for(let r=0;r<t.length;r++){const e=t[r];if(isNaN(e)||!isFinite(e))return console.warn(`Found ${e} in the result of '${n}'`),!0}}(n,e.dtype,t)})}),{kernelName:t,outputs:r,inputs:e,timeMs:i.then(t=>t.kernelMs),extraInfo:i.then(t=>null!=t.getExtraProfileInfo?t.getExtraProfileInfo():"")}}logKernelProfile(t){const{kernelName:e,outputs:n,timeMs:r,inputs:i,extraInfo:s}=t;n.forEach(t=>{Promise.all([t.data(),r,s]).then(n=>{this.logger.logKernelProfile(e,t,n[0],n[1],i,n[2])})})}}class ee{logKernelProfile(t,e,n,r,i,s){const o="number"==typeof r?wt(r+"ms",9):r.error,a=wt(t,25),l=e.rank,u=e.size,c=wt(e.shape.toString(),14);let h="";for(const d in i){const t=i[d];if(null!=t){const n=t.shape||e.shape,r=n.length;h+=`${d}: ${r}D ${r>0?n:""} `}}console.log(`%c${a}\t%c${o}\t%c${l}D ${c}\t%c${u}\t%c${h}\t%c${s}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}function ne(t,e,n){let r;return r=Array.isArray(t)?parseFloat(t[0].toFixed(7))+" + "+parseFloat(t[1].toFixed(7))+"j":Mt(t)?`'${t}'`:"bool"===n?re(t):parseFloat(t.toFixed(7)).toString(),wt(r,e)}function re(t){return 0===t?"false":"true"}function ie(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}class se{constructor(t,e,n){if(this.dtype=e,this.shape=t.slice(),this.size=mt(t),null!=n){const t=n.length;ht(t===this.size,()=>`Length of values '${t}' does not match the size inferred by the shape '${this.size}'.`)}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||Dt(e,this.size),this.strides=jt(t)}set(t,...e){0===e.length&&(e=[0]),ht(e.length===this.rank,()=>`The number of provided coordinates (${e.length}) must match the rank (${this.rank})`);const n=this.locToIndex(e);this.values[n]=t}get(...t){0===t.length&&(t=[0]);let e=0;for(const r of t){if(r<0||r>=this.shape[e])throw new Error(`Requested out of range element at ${t}.   Buffer shape=`+this.shape);e++}let n=t[t.length-1];for(let r=0;r<t.length-1;++r)n+=this.strides[r]*t[r];return this.values[n]}locToIndex(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];let e=t[t.length-1];for(let n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e}indexToLoc(t){if(0===this.rank)return[];if(1===this.rank)return[t];const e=new Array(this.shape.length);for(let n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e}get rank(){return this.shape.length}toTensor(){return oe().makeTensor(this.values,this.shape,this.dtype)}}let oe=null,ae=null,le=null;class ue{constructor(t,e,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=mt(t),this.strides=jt(t),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const t=await this.data();return ae.buffer(this.shape,this.dtype,t)}bufferSync(){return ae.buffer(this.shape,this.dtype,this.dataSync())}async array(){const t=await this.data();return Vt(this.shape,t)}arraySync(){return Vt(this.shape,this.dataSync())}async data(){this.throwIfDisposed();const t=oe().read(this.dataId);if("string"===this.dtype){const n=await t;try{return n.map(t=>Zt(t))}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t}dataSync(){this.throwIfDisposed();const t=oe().readSync(this.dataId);if("string"===this.dtype)try{return t.map(t=>Zt(t))}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}async bytes(){this.throwIfDisposed();const t=await oe().read(this.dataId);return"string"===this.dtype?t:new Uint8Array(t.buffer)}dispose(){this.isDisposed||(oe().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return ae.print(this,t)}clone(){return this.throwIfDisposed(),ae.clone(this)}toString(t=!1){return function(t,e,n,r){const i=jt(e),s=function(t,e,n,r){const i=mt(e),s=r[r.length-1],o=new Array(s).fill(0),a=e.length,l="complex64"===n?ie(t):t;if(a>1)for(let u=0;u<i/s;u++){const t=u*s;for(let e=0;e<s;e++)o[e]=Math.max(o[e],ne(l[t+e],0,n).length)}return o}(t,e,n,i),o=e.length,a=function t(e,n,r,i,s,o=!0){const a="complex64"===r?2:1,l=n[0],u=n.length;if(0===u)return"complex64"===r?[ne(ie(e)[0],0,r)]:"bool"===r?[re(e[0])]:[e[0].toString()];if(1===u){if(l>20){let t=Array.from(e.slice(0,3*a)),n=Array.from(e.slice((l-3)*a,l*a));return"complex64"===r&&(t=ie(t),n=ie(n)),["["+t.map((t,e)=>ne(t,s[e],r)).join(", ")+", ..., "+n.map((t,e)=>ne(t,s[l-3+e],r)).join(", ")+"]"]}return["["+("complex64"===r?ie(e):Array.from(e)).map((t,e)=>ne(t,s[e],r)).join(", ")+"]"]}const c=n.slice(1),h=i.slice(1),d=i[0]*a,f=[];if(l>20){for(let n=0;n<3;n++){const i=n*d;f.push(...t(e.slice(i,i+d),c,r,h,s,!1))}f.push("...");for(let n=l-3;n<l;n++){const i=n*d;f.push(...t(e.slice(i,i+d),c,r,h,s,n===l-1))}}else for(let g=0;g<l;g++){const n=g*d;f.push(...t(e.slice(n,n+d),c,r,h,s,g===l-1))}const p=2===u?",":"";f[0]="["+f[0]+p;for(let g=1;g<f.length-1;g++)f[g]=" "+f[g]+p;let m=",\n";for(let g=2;g<u;g++)m+="\n";return f[f.length-1]=" "+f[f.length-1]+"]"+(o?"":m),f}(t,e,n,i,s),l=["Tensor"];return r&&(l.push("  dtype: "+n),l.push("  rank: "+o),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(t=>"    "+t).join("\n")),l.join("\n")}(this.dataSync(),this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),ae.cast(this,t)}variable(t=!0,e,n){return this.throwIfDisposed(),oe().makeVariable(this,t,e,n)}}Object.defineProperty(ue,Symbol.hasInstance,{value:t=>!!t&&null!=t.dataId&&null!=t.shape&&null!=t.dtype});class ce extends ue{constructor(t,e,n,r){super(t.shape,t.dtype,t.dataId,r),this.trainable=e,this.name=n}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!yt(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);oe().disposeTensor(this),this.dataId=t.dataId,oe().incRef(this,null)}dispose(){oe().disposeVariable(this),this.isDisposedInternal=!0}}var he,de,fe,pe,me;Object.defineProperty(ce,Symbol.hasInstance,{value:t=>t instanceof ue&&null!=t.assign&&t.assign instanceof Function}),function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"}(he||(he={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(de||(de={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(fe||(fe={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(pe||(pe={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(me||(me={}));const ge={float32:pe,int32:de,bool:fe,complex64:me};function ye(t,e){if("string"===t||"string"===e){if("string"===t&&"string"===e)return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return ge[t][e]}function ve(t){return ye(t,"int32")}function be(t,e){if(t.dtype===e.dtype)return[t,e];const n=ye(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function xe(t,e){ht(t.dtype===e.dtype,()=>`The dtypes of the first(${t.dtype}) and second(${e.dtype}) input must match`)}function _e(t,e){return e.some(e=>e.id===t.id)}function we(t){const e=[];return function t(e,n,r){if(null==e)return;if(e instanceof ue)return void n.push(e);if(i=e,!Array.isArray(i)&&"object"!=typeof i)return;var i;const s=e;for(const o in s){const e=s[o];r.has(e)||(r.add(e),t(e,n,r))}}(t,e,new Set),e}class Se{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}dispose(){for(const t in this.registeredVariables)this.registeredVariables[t].dispose()}}class Ce{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Se}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then(()=>{});if(null!=this.backendInstance)return;const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e];if(await this.initializeBackend(n).success)return void(await this.setBackend(n))}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(null==this.backendInstance){const{name:t,asyncInit:e}=this.initializeBackendsAndReturnBest();if(e)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry)){if(!(t in this.registryFactory))return null;{const{asyncInit:e}=this.initializeBackend(t);if(e)return null}}return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,e,n=1){return t in this.registryFactory?(console.warn(t+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[t]={factory:e,priority:n},!0)}async setBackend(t){if(null==this.registryFactory[t])throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,null==this.registry[t]){this.backendInstance=null;const{success:e,asyncInit:n}=this.initializeBackend(t);if(!(n?await e:e))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new te(this.backendInstance),!0}setupRegisteredKernels(){J(this.backendName).forEach(t=>{null!=t.setupFunc&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(t){J(t).forEach(e=>{null!=e.disposeFunc&&e.disposeFunc(this.registry[t])})}initializeBackend(t){const e=this.registryFactory[t];if(null==e)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{const n=e.factory();if(Promise.resolve(n)===n){const e=++this.pendingBackendInitId,r=n.then(n=>!(e<this.pendingBackendInitId||(this.registry[t]=n,this.pendingBackendInit=null,0))).catch(n=>(e<this.pendingBackendInitId||(this.pendingBackendInit=null,console.warn(`Initialization of backend ${t} failed`),console.warn(n.stack||n.message)),!1));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}return this.registry[t]=n,{success:!0,asyncInit:!1}}catch(n){return console.warn(`Initialization of backend ${t} failed`),console.warn(n.stack||n.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(t+" backend not found in registry");this.backendName===t&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((t,e)=>this.registryFactory[e].priority-this.registryFactory[t].priority)}initializeBackendsAndReturnBest(){const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e],{success:r,asyncInit:i}=this.initializeBackend(n);if(i||r)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,e){const n=this.state.tensorInfo.get(e),r=n.backend,i=this.readSync(e);r.disposeData(e),n.backend=t,t.move(e,i,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,e){let n,r=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=t}return this.scopedRun(()=>this.startScope(r),()=>this.endScope(n),()=>(n=e(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n))}scopedRun(t,e,n){t();try{const t=n();return e(),t}catch(r){throw e(),r}}nextTensorId(){return Ce.nextTensorId++}nextVariableId(){return Ce.nextVariableId++}clone(t){const e=this.makeTensorFromDataId(t.dataId,t.shape,t.dtype);return this.addTapeNode(this.state.activeScope.name,{x:t},[e],t=>({x:()=>Ee.runKernelFunc(e=>e.cast(t,"float32"),{x:t},null,"Cast",{dtype:"float32"})}),[],{}),e}runKernel(t,e,n,r,i){return this.runKernelFunc(null,e,null,t,n,r,i)}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,e,n){const r=this.backend.numDataIds();let i=0;n.forEach(t=>{i+="complex64"===t.dtype?3:1});const s=r-e-i-this.state.numDataMovesStack[this.state.numDataMovesStack.length-1];if(s>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${s} data ids) after running '${t}'`)}runKernelFunc(t,e,n,r,i,s,o){let a,l=[];const u=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");const c=this.state.numBytes,h=this.state.numTensors;let d;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);const f=Z(r,this.backendName);let p,m;if(null!=f)d=()=>{const t=this.backend.numDataIds();p=f.kernelFunc({inputs:e,attrs:i,backend:this.backend});const n=Array.isArray(p)?p:[p];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(r,t,n);const a=n.map(({dataId:t,shape:e,dtype:n})=>this.makeTensorFromDataId(t,e,n));if(u){let t=this.getTensorsForGradient(r,e,a);if(null==t){null==o&&(o=[]);const e=a.filter((t,e)=>o[e]);t=(s||[]).slice().concat(e)}l=this.saveTensorsForBackwardMode(t)}return a};else{const e=t=>{u&&(l=t.map(t=>this.keep(this.clone(t))))};d=()=>{const n=this.backend.numDataIds();p=this.tidy(()=>t(this.backend,e));const i=Array.isArray(p)?p:[p];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(r,n,i),i}}return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(m=this.profiler.profileKernel(r,e,()=>d()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(m),a=m.outputs):a=d()}),u&&this.addTapeNode(r,e,a,n,l,i),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-c,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-h,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(e).map(t=>null!=e[t]?e[t].shape:null),outputShapes:a.map(t=>t.shape),kernelTimeMs:m.timeMs,extraInfo:m.extraInfo}),Array.isArray(p)?a:a[0]}saveTensorsForBackwardMode(t){return t.map(t=>this.keep(this.clone(t)))}getTensorsForGradient(t,e,n){const r=Q(t);if(null!=r){const t=r.inputsToSave||[],i=r.outputsToSave||[];let s;r.saveAllInputs?(ht(Array.isArray(e),()=>"saveAllInputs is true, expected inputs to be an array."),s=Object.keys(e).map(t=>e[t])):s=t.map(t=>e[t]);const o=n.filter((t,e)=>i[e]);return s.concat(o)}return null}makeTensor(t,e,n,r){if(null==t)throw new Error("Values passed to engine.makeTensor() are null");r=r||this.backend;let i=t;"string"===(n=n||"float32")&&Mt(t[0])&&(i=t.map(t=>Xt(t)));const s=r.write(i,e,n),o=new ue(e,n,s,this.nextTensorId());if(this.incRef(o,r),"string"===n){const t=this.state.tensorInfo.get(s),e=Ft(i);this.state.numBytes+=e-t.bytes,t.bytes=e}return o}makeTensorFromDataId(t,e,n,r){const i=new ue(e,n=n||"float32",t,this.nextTensorId());return this.incRef(i,r),i}makeVariable(t,e=!0,n,r){n=n||this.nextVariableId().toString(),null!=r&&r!==t.dtype&&(t=t.cast(r));const i=new ce(t,e,n,this.nextTensorId());if(null!=this.state.registeredVariables[i.name])throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}incRef(t,e){const n=this.state.tensorInfo.has(t.dataId)?this.state.tensorInfo.get(t.dataId).refCount:0;if(this.state.numTensors++,"string"===t.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;let n=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(n=t.size*Rt(t.dtype)),this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:n,refCount:0}),this.state.numBytes+=n}this.state.tensorInfo.get(t.dataId).refCount++,t instanceof ce||this.track(t)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;this.state.numTensors--,"string"===t.dtype&&this.state.numStringTensors--;const e=this.state.tensorInfo.get(t.dataId);e.refCount<=1?("complex64"!==t.dtype&&(this.state.numBytes-=e.bytes),this.state.numDataBuffers--,e.backend.disposeData(t.dataId),this.state.tensorInfo.delete(t.dataId)):this.state.tensorInfo.get(t.dataId).refCount--}disposeVariables(){for(const t in this.state.registeredVariables)this.disposeVariable(this.state.registeredVariables[t])}disposeVariable(t){this.disposeTensor(t),null!=this.state.registeredVariables[t.name]&&delete this.state.registeredVariables[t.name]}memory(){const t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;const e=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(t=>t.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(t,e,n,r,i,s){const o={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:n,saved:i},a=Q(t);null!=a&&(r=a.gradFunc),null!=r&&(o.gradient=t=>(t=t.map((t,e)=>{if(null==t){const t=n[e],r=qt(t.size,t.dtype);return this.makeTensor(r,t.shape,t.dtype)}return t}),r(t.length>1?t:t[0],i,s))),this.state.activeTape.push(o)}keep(t){return t.kept=!0,t}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){const e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e}endScope(t){const e=we(t),n=new Set(e.map(t=>t.id));for(let i=0;i<this.state.activeScope.track.length;i++){const t=this.state.activeScope.track[i];t.kept||n.has(t.id)||t.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],e.forEach(t=>{t.kept||t.scopeId!==r.id||this.track(t)})}gradients(t,e,n,r=!1){if(ht(e.length>0,()=>"gradients() received an empty list of xs."),null!=n&&"float32"!==n.dtype)throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);const i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",t));ht(i instanceof ue,()=>"The result y returned by f() must be a tensor.");const s=function(t,e,n){const r={},i={};for(let l=0;l<e.length;l++)r[e[l].id]=!0;for(let l=0;l<t.length;l++){const n=t[l],s=n.inputs;for(const t in s){const o=s[t];let a=!1;for(let t=0;t<e.length;t++)if(r[o.id]){n.outputs.forEach(t=>r[t.id]=!0),a=!0,i[n.id]=!0;break}if(a)break}}const s={};s[n.id]=!0;const o={};for(let l=t.length-1;l>=0;l--){const e=t[l],n=e.inputs;for(let t=0;t<e.outputs.length;t++)if(s[e.outputs[t].id]){for(const t in n)s[n[t].id]=!0,o[e.id]=!0;break}}const a=[];for(let l=0;l<t.length;l++){const e=t[l];if(i[e.id]&&o[e.id]){const t={};for(const i in e.inputs){const n=e.inputs[i];r[n.id]&&(t[i]=n)}const n=Object.assign({},e);n.inputs=t,n.outputs=e.outputs,a.push(n)}}return a}(this.state.activeTape,e,i);if(!r&&0===s.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const t={};t[i.id]=null==n?function(t){const e=Wt(mt(t),"float32");return Ee.makeTensor(e,t,"float32")}(i.shape):n,function(t,e,n,r){for(let i=e.length-1;i>=0;i--){const s=e[i],o=[];if(s.outputs.forEach(e=>{const n=t[e.id];o.push(null!=n?n:null)}),null==s.gradient)throw new Error(`Cannot compute gradient: gradient function not found for ${s.kernelName}.`);const a=s.gradient(o);for(const e in s.inputs){if(!(e in a))throw new Error(`Cannot backprop through input ${e}. Available gradients found: ${Object.keys(a)}.`);const i=n(()=>a[e]());if("float32"!==i.dtype)throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input ${e} must have 'float32' dtype, but has '${i.dtype}'`);const o=s.inputs[e];if(!yt(i.shape,o.shape))throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input '${e}' has shape '${i.shape}', which does not match the shape of the input '${o.shape}'`);if(null==t[o.id])t[o.id]=i;else{const e=t[o.id];t[o.id]=r(e,i),e.dispose()}}}}(t,s,t=>this.tidy(t),ke);const r=e.map(e=>t[e.id]);return 0===this.state.gradientDepth&&(this.state.activeTape.forEach(t=>{for(const e of t.saved)e.dispose()}),this.state.activeTape=null),{value:i,grads:r}})}customGrad(t){return ht(Lt(t),()=>"The f passed in customGrad(f) must be a function."),(...e)=>{let n;ht(e.every(t=>t instanceof ue),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");const r={};return e.forEach((t,e)=>{r[e]=t}),this.runKernelFunc((r,i)=>(n=t(...e,i),ht(n.value instanceof ue,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),ht(Lt(n.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),n.value),r,(t,r)=>{const i=n.gradFunc(t,r),s=Array.isArray(i)?i:[i];ht(s.length===e.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),ht(s.every(t=>t instanceof ue),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const o={};return s.forEach((t,e)=>{o[e]=()=>t}),o})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}async time(t){const e=Gt(),n=await this.backend.time(t);return n.wallMs=Gt()-e,n}track(t){return null!=this.state.activeScope&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Se;for(const t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}Ce.nextTensorId=0,Ce.nextVariableId=0;const Ee=function(){const t=G();if(null==t._tfengine){const e=new V(t);t._tfengine=new Ce(e)}return H=t._tfengine.ENV,oe=()=>t._tfengine,t._tfengine}();function ke(t,e){return Ee.runKernelFunc((n,r)=>{const i=n.add(t,e);return r([t,e]),i},{a:t,b:e},null,"Add")}function Ae(){if("undefined"!=typeof navigator&&null!=navigator){const t=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function De(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}const Ne=W();let Te;function Oe(t,e){let n=t;if(It(t))return"string"===e?[]:[t.length];if(!Array.isArray(t))return[];const r=[];for(;Array.isArray(n)||It(n)&&"string"!==e;)r.push(n.length),n=n[0];return Array.isArray(t)&&W().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function t(e,n,r){if(r=r||[],!Array.isArray(e)&&!It(e))return void ht(0===n.length,()=>`Element arr[${r.join("][")}] is a primitive, but should be an array/TypedArray of ${n[0]} elements`);ht(n.length>0,()=>`Element arr[${r.join("][")}] should be a primitive, but is an array of ${e.length} elements`),ht(e.length===n[0],()=>`Element arr[${r.join("][")}] should have ${n[0]} elements, but has ${e.length} elements`);const i=n.slice(1);for(let s=0;s<e.length;++s)t(e[s],i,r.concat(s))}(t,r,[]),r}function Ie(t,e,n,r){if(null!=t&&("numeric"!==t&&t!==e||"numeric"===t&&"string"===e))throw new Error(`Argument '${n}' passed to '${r}' must be ${t} tensor, but got ${e} tensor`)}function Re(t,e,n,r="numeric"){if(t instanceof ue)return Ie(r,t.dtype,e,n),t;let i=zt(t);if("string"!==i&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),Ie(r,i,e,n),null==t||!It(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${null==t?"null":t.constructor.name}'`);const s=Oe(t,i);It(t)||Array.isArray(t)||(t=[t]);const o="string"!==i?Ut(t,i):pt(t,[],!0);return Ee.makeTensor(o,s,i)}function Fe(t,e,n,r="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map((t,r)=>Re(t,`${e}[${r}]`,n),r)}function Me(t){const e=Object.keys(t);if(1!==e.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");let n=e[0];const r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));const i=(...t)=>{Ee.startScope(n);try{const e=r(...t);return e instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),Ee.endScope(e),e}catch(e){throw Ee.endScope(null),e}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}Ne.registerFlag("DEBUG",()=>!1,t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Ne.registerFlag("IS_BROWSER",()=>De()),Ne.registerFlag("IS_NODE",()=>"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node),Ne.registerFlag("IS_CHROME",()=>"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)),Ne.registerFlag("PROD",()=>!1),Ne.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Ne.getBool("DEBUG")),Ne.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0),Ne.registerFlag("IS_TEST",()=>!1),W().get("IS_BROWSER")&&W().setPlatform("browser",new class{fetch(t,e){return fetch(t,e)}now(){return performance.now()}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Browser's encoder only supports utf-8, but got "+e);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,e){return new TextDecoder(e).decode(t)}}),W().get("IS_NODE")&&W().setPlatform("node",new class{constructor(){this.util=n(2),this.textEncoder=new this.util.TextEncoder}fetch(t,e){return null!=W().global.fetch?W().global.fetch(t,e):(null==Te&&(Te=n(1)),Te(t,e))}now(){const t=process.hrtime();return 1e3*t[0]+t[1]/1e6}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Node built-in encoder only supports utf-8, but got "+e);return this.textEncoder.encode(t)}decode(t,e){return 0===t.length?"":new this.util.TextDecoder(e).decode(t)}});const $e=Me({abs_:function(t){const e=Re(t,"x","abs");return Ee.runKernelFunc((t,n)=>(n([e]),"complex64"===e.dtype?t.complexAbs(e):t.abs(e)),{x:e},null,"Abs")}}),Pe=Me({acos_:function(t){const e=Re(t,"x","acos");return Ee.runKernelFunc((t,n)=>{const r=t.acos(e);return n([e]),r},{x:e},null,"Acos")}}),ze=Me({acosh_:function(t){const e=Re(t,"x","acosh");return Ee.runKernelFunc((t,n)=>{const r=t.acosh(e);return n([e]),r},{x:e},null,"Acosh")}}),Le=Me({add_:function(t,e){let n=Re(t,"a","add"),r=Re(e,"b","add");return[n,r]=be(n,r),Ee.runKernelFunc((t,e)=>{const i=t.add(n,r);return e([n,r]),i},{a:n,b:r},null,"Add")}}),Be=Me({addN_:function(t){ht(Array.isArray(t),()=>"The argument passed to tf.addN() must be a list of tensors"),ht(t.length>=1,()=>"Must pass at least one tensor to tf.addN(), but got "+t.length);const e=t.map((t,e)=>Re(t,"tensors"+e,"addN")),n=e[0];return e.forEach(t=>{if(t.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(t=>{if(!yt(t.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}),Ee.runKernelFunc((t,n)=>{const r=t.addN(e);return n(e),r},e,null,"AddN")}});function je(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function Ue(t,e,n){const r=t.length+e.length,i=[];let s=0,o=0;for(let a=0;a<r;a++)-1===n.indexOf(a)?i.push(t[s++]):i.push(e[o++]);return i}function Ve(t,e){const n=[],r=t.length;for(let i=0;i<r;i++)-1===e.indexOf(i)&&n.push(t[i]);return[n,e.map(e=>t[e])]}function We(t,e){return Ue(t,e.map(t=>1),e)}function qe(t,e,n){ht(je(e,n),()=>t+" supports only inner-most axes for now. "+`Got axes ${e} and rank-${n} input.`)}function He(t,e){if(je(t,e))return null;const n=[];for(let r=0;r<e;++r)-1===t.indexOf(r)&&n.push(r);return t.forEach(t=>n.push(t)),n}function Ge(t){return t.map((t,e)=>[e,t]).sort((t,e)=>t[1]-e[1]).map(t=>t[0])}function Ye(t,e){const n=[];for(let r=e-t;r<e;++r)n.push(r);return n}const Ke=Me({reshape_:function(t,e){const n=Re(t,"x","reshape",null);return e=Ct(e,n.size),ht(n.size===mt(e),()=>"new shape and old shape must have the same number of elements."),Ee.runKernelFunc((t,r)=>(r([n]),t.reshape(n,e)),{x:n},null,"Reshape",{shape:e})}}),Xe=Me({transpose_:function(t,e){const n=Re(t,"x","transpose");return null==e&&(e=n.shape.map((t,e)=>e).reverse()),ht(n.rank===e.length,()=>`Error in transpose: rank of input ${n.rank} must match length of perm ${e}.`),e.forEach(t=>{ht(t>=0&&t<n.rank,()=>"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+e)}),n.rank<=1?n.clone():Ee.runKernelFunc(t=>t.transpose(n,e),{x:n},null,"Transpose",{perm:e})}}),Ze=Me({all_:function(t,e=null,n=!1){let r=Re(t,"x","all","bool");return Ee.runKernelFunc(t=>{const i=Et(e,r.shape);let s=i;const o=He(s,r.rank);null!=o&&(r=Xe(r,o),s=Ye(s.length,r.rank));const a=t.all(r,s);if(n){const t=We(a.shape,i);return Ke(a,t)}return a},{x:r},null,"All",{axis:e,keepDims:n})}}),Qe=Me({any_:function(t,e=null,n=!1){let r=Re(t,"x","any","bool");return Ee.runKernelFunc(t=>{const i=Et(e,r.shape);let s=i;const o=He(s,r.rank);null!=o&&(r=Xe(r,o),s=Ye(s.length,r.rank));const a=t.any(r,s);if(n){const t=We(a.shape,i);return Ke(a,t)}return a},{x:r},null,"Any",{axis:e,keepDims:n})}}),Je=Me({argMax_:function(t,e=0){let n=Re(t,"x","argMax");return Ee.runKernelFunc((t,r)=>{r([n]);let i=Et(e,n.shape);const s=He(i,n.rank);return null!=s&&(n=Xe(n,s),i=Ye(i.length,n.rank)),t.argMax(n,i[0])},{x:n},null,"ArgMax",{axis:e})}}),tn=Me({argMin_:function(t,e=0){let n=Re(t,"x","argMin");return Ee.runKernelFunc((t,r)=>{r([n]),null==e&&(e=0);let i=Et(e,n.shape);const s=He(i,n.rank);return null!=s&&(n=Xe(n,s),i=Ye(i.length,n.rank)),t.argMin(n,i[0])},{x:n},null,"ArgMin",{axis:e})}}),en=Me({asin_:function(t){const e=Re(t,"x","asin");return Ee.runKernelFunc((t,n)=>{const r=t.asin(e);return n([e]),r},{x:e},null,"Asin")}}),nn=Me({asinh_:function(t){const e=Re(t,"x","asinh");return Ee.runKernelFunc((t,n)=>{const r=t.asinh(e);return n([e]),r},{x:e},null,"Asinh")}}),rn=Me({atan_:function(t){const e=Re(t,"x","atan");return Ee.runKernelFunc((t,n)=>{const r=t.atan(e);return n([e]),r},{x:e},null,"Atan")}}),sn=Me({atan2_:function(t,e){let n=Re(t,"a","atan2"),r=Re(e,"b","atan2");return[n,r]=be(n,r),Ee.runKernelFunc((t,e)=>{const i=t.atan2(n,r);return e([n,r]),i},{a:n,b:r},null,"Atan2")}}),on=Me({atanh_:function(t){const e=Re(t,"x","atanh");return Ee.runKernelFunc((t,n)=>{const r=t.atanh(e);return n([e]),r},{x:e},null,"Atanh")}}),an=Me({cast_:function(t,e){const n=Re(t,"x","cast");if(!Tt(e))throw new Error("Failed to cast to unknown dtype "+e);if("string"===e&&"string"!==n.dtype||"string"!==e&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");return Ee.runKernelFunc(t=>t.cast(n,e),{x:n},null,"Cast",{dtype:e})}});function ln(t,e,n,r,i="NHWC",s){return hn(t,[...e,t[3]],n,s,r,null,null,xn(i))}function un(t,e,n,r,i,s,o="channelsLast"){const[a,l]=pn(e);let u;if("channelsLast"===o)u=[a,l,t[3],t[3]];else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat "+o);u=[a,l,t[1],t[1]]}return hn(t,u,n,r,i,s,!1,o)}function cn(t,e,n,r,i,s,o="NDHWC"){const[a,l,u]=mn(e);let c,h;if("NDHWC"===o)h="channelsLast",c=[a,l,u,t[4],t[4]];else{if("NCDHW"!==o)throw new Error("Unknown dataFormat "+o);h="channelsFirst",c=[a,l,u,t[1],t[1]]}return dn(t,c,n,r,i,!1,h,s)}function hn(t,e,n,r,i,s,o=!1,a="channelsLast"){let[l,u,c,h]=[-1,-1,-1,-1];if("channelsLast"===a)[l,u,c,h]=t;else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);[l,h,u,c]=t}const[d,f,,p]=e,[m,g]=pn(n),[y,v]=pn(r),b=gn(d,y),x=gn(f,v),{padInfo:_,outHeight:w,outWidth:S}=function(t,e,n,r,i,s,o,a,l){let u,c,h;if("number"==typeof t){u={top:t,bottom:t,left:t,right:t,type:0===t?"VALID":"NUMBER"};const i=function(t,e,n,r,i){null==r&&(r=fn(t,e,n));const s=t[1],o=yn((t[0]-e+2*r)/n+1,i);ht(vt(o),()=>`The output # of rows (${o}) must be an integer. Change the stride and/or zero pad parameters`);const a=yn((s-e+2*r)/n+1,i);return ht(vt(a),()=>`The output # of columns (${a}) must be an integer. Change the stride and/or zero pad parameters`),[o,a]}([e,n],s,r,t,a);c=i[0],h=i[1]}else if("same"===t){c=Math.ceil(e/r),h=Math.ceil(n/i);const t=Math.max(0,(c-1)*r+s-e),a=Math.max(0,(h-1)*i+o-n),l=Math.floor(t/2),d=t-l,f=Math.floor(a/2);u={top:l,bottom:d,left:f,right:a-f,type:"SAME"}}else if("valid"===t)u={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((e-s+1)/r),h=Math.ceil((n-o+1)/i);else{if("object"!=typeof t)throw Error("Unknown padding parameter: "+t);{const d="channelsLast"===l?t[1][0]:t[2][0],f="channelsLast"===l?t[1][1]:t[2][1],p="channelsLast"===l?t[2][0]:t[3][0],m="channelsLast"===l?t[2][1]:t[3][1];u={top:d,bottom:f,left:p,right:m,type:0===d&&0===f&&0===p&&0===m?"VALID":"EXPLICIT"},c=yn((e-s+d+f)/r+1,a),h=yn((n-o+p+m)/i+1,a)}}return{padInfo:u,outHeight:c,outWidth:h}}(i,u,c,m,g,b,x,s,a),C=o?p*h:p;let E;return"channelsFirst"===a?E=[l,C,w,S]:"channelsLast"===a&&(E=[l,w,S,C]),{batchSize:l,dataFormat:a,inHeight:u,inWidth:c,inChannels:h,outHeight:w,outWidth:S,outChannels:C,padInfo:_,strideHeight:m,strideWidth:g,filterHeight:d,filterWidth:f,effectiveFilterHeight:b,effectiveFilterWidth:x,dilationHeight:y,dilationWidth:v,inShape:t,outShape:E,filterShape:e}}function dn(t,e,n,r,i,s=!1,o="channelsLast",a){let[l,u,c,h,d]=[-1,-1,-1,-1,-1];if("channelsLast"===o)[l,u,c,h,d]=t;else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat "+o);[l,d,u,c,h]=t}const[f,p,m,,g]=e,[y,v,b]=mn(n),[x,_,w]=mn(r),S=gn(f,x),C=gn(p,_),E=gn(m,w),{padInfo:k,outDepth:A,outHeight:D,outWidth:N}=function(t,e,n,r,i,s,o,a,l,u,c){let h,d,f,p;if("number"==typeof t){h={top:t,bottom:t,left:t,right:t,front:t,back:t,type:0===t?"VALID":"NUMBER"};const s=function(t,e,n,r,i,s){null==i&&(i=fn(t,e,r));const o=t[1],a=t[2],l=yn((t[0]-e+2*i)/r+1,s);ht(vt(l),()=>`The output # of depths (${l}) must be an integer. Change the stride and/or zero pad parameters`);const u=yn((o-e+2*i)/r+1,s);ht(vt(u),()=>`The output # of rows (${u}) must be an integer. Change the stride and/or zero pad parameters`);const c=yn((a-e+2*i)/r+1,s);return ht(vt(c),()=>`The output # of columns (${c}) must be an integer. Change the stride and/or zero pad parameters`),[l,u,c,1]}([e,n,r,1],a,0,i,t,c);d=s[0],f=s[1],p=s[2]}else if("same"===t){d=Math.ceil(e/i),f=Math.ceil(n/s),p=Math.ceil(r/o);const t=(d-1)*i+a-e,c=(f-1)*s+l-n,m=(p-1)*o+u-r,g=Math.floor(t/2),y=t-g,v=Math.floor(c/2),b=c-v,x=Math.floor(m/2);h={top:v,bottom:b,left:x,right:m-x,front:g,back:y,type:"SAME"}}else{if("valid"!==t)throw Error("Unknown padding parameter: "+t);h={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},d=Math.ceil((e-a+1)/i),f=Math.ceil((n-l+1)/s),p=Math.ceil((r-u+1)/o)}return{padInfo:h,outDepth:d,outHeight:f,outWidth:p}}(i,u,c,h,y,v,b,S,C,E,a),T=s?g*d:g;let O;return"channelsFirst"===o?O=[l,T,A,D,N]:"channelsLast"===o&&(O=[l,A,D,N,T]),{batchSize:l,dataFormat:o,inDepth:u,inHeight:c,inWidth:h,inChannels:d,outDepth:A,outHeight:D,outWidth:N,outChannels:T,padInfo:k,strideDepth:y,strideHeight:v,strideWidth:b,filterDepth:f,filterHeight:p,filterWidth:m,effectiveFilterDepth:S,effectiveFilterHeight:C,effectiveFilterWidth:E,dilationDepth:x,dilationHeight:_,dilationWidth:w,inShape:t,outShape:O,filterShape:e}}function fn(t,e,n,r=1){const i=gn(e,r);return Math.floor((t[0]*(n-1)-n+i)/2)}function pn(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function mn(t){return"number"==typeof t?[t,t,t]:t}function gn(t,e){return e<=1?t:t+(t-1)*(e-1)}function yn(t,e){if(!e)return t;switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error("Unknown roundingMode "+e)}}function vn(t){const[e,n,r]=pn(t);return 1===e&&1===n&&1===r}function bn(t,e){return vn(t)||vn(e)}function xn(t){if("NHWC"===t)return"channelsLast";if("NCHW"===t)return"channelsFirst";throw new Error("Unknown dataFormat "+t)}const _n=Me({avgPool_:function(t,e,n,r,i){const s=Re(t,"x","avgPool","float32");ht(bn(n,1),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`);let o=s,a=!1;3===s.rank&&(a=!0,o=Ke(s,[1,s.shape[0],s.shape[1],s.shape[2]])),ht(4===o.rank,()=>`Error in avgPool: x must be rank 4 but got rank ${o.rank}.`),null!=i&&ht(vt(r),()=>`Error in avgPool: pad must be an integer when using, dimRoundingMode ${i} but got pad ${r}.`);let l=Ee.runKernelFunc((t,s)=>{const a=un(o.shape,e,n,1,r,i);return s([o]),1===a.filterWidth&&1===a.filterHeight&&yt(a.inShape,a.outShape)?o.clone():t.avgPool(o,a)},{x:o},null,"AvgPool",{filterSize:e,strides:n,pad:r,dimRoundingMode:i});return l=an(l,s.dtype),a?Ke(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});function wn(){W().set("PROD",!0)}function Sn(){W().set("DEBUG",!0)}function Cn(){W().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function En(t){W().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function kn(){Ee.disposeVariables()}function An(){return Ee}function Dn(){return Ee.memory()}function Nn(t){return Ee.profile(t)}function Tn(t,e){return Ee.tidy(t,e)}function On(t){we(t).forEach(t=>t.dispose())}function In(t){return Ee.keep(t)}function Rn(t){return Ee.time(t)}function Fn(t){return Ee.setBackend(t)}function Mn(){return Ee.ready()}function $n(){return Ee.backendName}function Pn(t){Ee.removeBackend(t)}function zn(t){return Ee.findBackend(t)}function Ln(t){return Ee.findBackendFactory(t)}function Bn(t,e,n=1){return Ee.registerBackend(t,e,n)}function jn(){return Ee.backend}function Un(t,e){W().setPlatform(t,e)}le=En;const Vn=Me({avgPool3d_:function(t,e,n,r,i,s="NDHWC",o){null==o?o=[1,1,1]:En("dilations is deprecated, this field will be gone in v3.0.0.");const a=Re(t,"x","avgPool3d","float32");let l=a,u=!1;4===a.rank&&(u=!0,l=Ke(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),ht(5===l.rank,()=>`Error in avgPool3d: x must be rank 5 but got rank ${l.rank}.`),ht("NDHWC"===s,()=>"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+s),ht(bn(n,o),()=>`Error in avgPool3d: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),null!=i&&ht(vt(r),()=>`Error in avgPool3d: pad must be an integer when using, dimRoundingMode ${i} but got pad ${r}.`);let c=Ee.runKernelFunc((t,a)=>{null==o&&(o=[1,1,1]);const u=cn(l.shape,e,n,o,r,i,s);return a([l]),t.avgPool3d(l,u)},{x:l},null,"AvgPool3D",{filterSize:e,strides:n,pad:r,dimRoundingMode:i,dataFormat:s,dilations:o});return c=an(c,l.dtype),u?Ke(c,[c.shape[1],c.shape[2],c.shape[3],c.shape[4]]):c}});function Wn(t,e){const n=t[0].length;t.forEach((t,e)=>{ht(t.length===n,()=>`Error in concat${n}D: rank of tensors[${e}] must be the same as the rank of the rest (${n})`)}),ht(e>=0&&e<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);const r=t[0];t.forEach((t,i)=>{for(let s=0;s<n;s++)ht(s===e||t[s]===r[s],()=>`Error in concat${n}D: Shape of tensors[${i}] (${t}) does not match the shape of the rest (${r}) along the non-concatenated axis ${i}.`)})}function qn(t,e){const n=t[0].slice();for(let r=1;r<t.length;r++)n[e]+=t[r][e];return n}function Hn(t,e,n,r){if(null==r&&(r=zt(t)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!It(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=e){Yt(e);const t=mt(e),r=mt(n);ht(t===r,()=>`Based on the provided shape, [${e}], the tensor should have ${t} values but has ${r}`);for(let i=0;i<n.length;++i){const t=n[i],r=i!==n.length-1||t!==mt(e.slice(i));ht(n[i]===e[i]||!r,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `)}}return It(t)||Array.isArray(t)||(t=[t]),e=e||n,t="string"!==r?Ut(t,r):pt(t,[],!0),Ee.makeTensor(t,e,r)}function Gn(t,e,n){return Hn(t,e,Oe(t,n),n)}const Yn=Me({concat_:function(t,e=0){ht(t.length>=1,()=>"Pass at least one tensor to concat");let n=Fe(t,"tensors","concat");"complex64"===n[0].dtype&&n.forEach(t=>{if("complex64"!==t.dtype)throw new Error(`Cannot concatenate complex64 tensors with a tensor\n          with dtype ${t.dtype}. `)});const r=Et(e,n[0].shape)[0],i=qn(n.map(t=>t.shape),r);return 0===mt(i)?Gn([],i):(n=n.filter(t=>t.size>0),1===n.length?n[0]:(Wn(n.map(t=>t.shape),r),Ee.runKernelFunc((t,e)=>{const i=t.concat(n,r);return e(n),i},n,null,"Concat",{axis:e})))}}),Kn=Me({matMul_:function(t,e,n=!1,r=!1){let i=Re(t,"a","matMul"),s=Re(e,"b","matMul");[i,s]=be(i,s),ht(i.rank>=2&&s.rank>=2&&i.rank===s.rank,()=>`Error in matMul: inputs must have the same rank of at least 2, got ranks ${i.rank} and ${s.rank}.`);const o=n?i.shape[i.rank-2]:i.shape[i.rank-1],a=r?s.shape[s.rank-1]:s.shape[s.rank-2],l=n?i.shape[i.rank-1]:i.shape[i.rank-2],u=r?s.shape[s.rank-2]:s.shape[s.rank-1],c=i.shape.slice(0,-2),h=s.shape.slice(0,-2),d=mt(c),f=mt(h);ht(yt(c,h),()=>`Error in matMul: outer dimensions (${c}) and (${h}) of Tensors with shapes ${i.shape} and `+s.shape+" must match."),ht(o===a,()=>`Error in matMul: inner shapes (${o}) and (${a}) of Tensors with shapes ${i.shape} and ${s.shape} and transposeA=${n} and transposeB=${r} must match.`);const p=i.shape.slice(0,-2).concat([l,u]),m=Ke(i,n?[d,o,l]:[d,l,o]),g=Ke(s,r?[f,u,a]:[f,a,u]),y=Ee.runKernelFunc((t,e)=>(e([m,g]),t.batchMatMul(m,g,n,r)),{a:m,b:g},null,"BatchMatMul",{transposeA:n,transposeB:r});return Ke(y,p)}}),Xn=Me({mul_:function(t,e){let n=Re(t,"a","mul"),r=Re(e,"b","mul");return[n,r]=be(n,r),Ee.runKernelFunc((t,e)=>{const i=t.multiply(n,r);return e([n,r]),i},{a:n,b:r},null,"Multiply")}}),Zn=Me({sigmoid_:function(t){const e=Re(t,"x","sigmoid");return Ee.runKernelFunc((t,n)=>{const r=t.sigmoid(e);return n([r]),r},{x:e},null,"Sigmoid")}});function Qn(t,e,n){ht(t.rank===e.length,()=>`Error in slice${t.rank}D: Length of begin ${e} must match the rank of the array (${t.rank}).`),ht(t.rank===n.length,()=>`Error in slice${t.rank}D: Length of size ${n} must match the rank of the array (${t.rank}).`);for(let r=0;r<t.rank;++r)ht(e[r]+n[r]<=t.shape[r],()=>`Error in slice${t.rank}D: begin[${r}] + size[${r}] (${e[r]+n[r]}) would overflow input.shape[${r}] (${t.shape[r]})`)}function Jn(t){const e=[];let n=0;for(;t>0;)1&t&&e.push(n),t/=2,n++;return e}function tr(t,e,n){const r=[];for(let i=0;i<t.length;i++)r[i]=Math.ceil((e[i]-t[i])/n[i]);return r}function er(t,e,n,r){const i=[...t];for(let s=i.length;s<r.length;s++)i.push(1);for(let s=0;s<n;s++)0===s?i[e]=1:(i.splice(e,0,1),i.pop());return i}function nr(t,e,n){return n<=t?n:n-(e-1)}function rr(t,e){const n=[];for(let r=0;r<t;r++)n.push(e+r);return n}function ir(t,e,n,r,i){const s=[...i],o=rr(n,e);for(let a=0;a<s.length;a++)if(o.indexOf(a)>-1)s[a]=0;else{const i=nr(e,n,a);let o=r[i];t&1<<i&&(o=0),s[a]=o}return s}function sr(t,e,n,r,i){const s=[...i],o=rr(n,e);for(let a=0;a<s.length;a++)if(o.indexOf(a)>-1)s[a]=Number.MAX_SAFE_INTEGER;else{const i=nr(e,n,a);let o=r[i];t&1<<i&&(o=Number.MAX_SAFE_INTEGER),s[a]=o}for(let a=0;a<s.length;a++){const t=i[a];s[a]<0&&(s[a]+=t),s[a]=ot(0,s[a],i[a])}return s}function or(t,e,n){let r=t[e];return(n&1<<e||null==r)&&(r=1),r}function ar(t,e,n,r,i,s){let o=e[i];(t&1<<i||s&1<<i||null==o)&&(o=(n[i]||1)>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);const a=r[i];return o<0&&(o+=a),o=ot(0,o,a-1),o}function lr(t,e,n,r,i,s){let o=e[i];const a=n[i]||1;(t&1<<i||s&1<<i||null==o)&&(o=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);const l=r[i];return o<0&&(o+=l),o=a>0?ot(0,o,l):ot(-1,o,l-1),o}function ur(t,e,n){let r=n.length;for(let i=0;i<n.length;i++)if(n[i]>1){r=i;break}for(let i=r+1;i<n.length;i++)if(e[i]>0||n[i]!==t[i])return!1;return!0}function cr(t,e){let n=t.length>0?t[t.length-1]:1;for(let r=0;r<t.length-1;r++)n+=t[r]*e[r];return n}function hr(t,e,n){let r,i;return r="number"==typeof e?[e,...new Array(t.rank-1).fill(0)]:e.length<t.rank?e.concat(new Array(t.rank-e.length).fill(0)):e.slice(),r.forEach(t=>{ht(-1!==t,()=>"slice() does not support negative begin indexing.")}),i=null==n?new Array(t.rank).fill(-1):"number"==typeof n?[n,...new Array(t.rank-1).fill(-1)]:n.length<t.rank?n.concat(new Array(t.rank-n.length).fill(-1)):n,i=i.map((e,n)=>e>=0?e:(ht(-1===e,()=>`Negative size values should be exactly -1 but got ${e} for the slice() size at index ${n}.`),t.shape[n]-r[n])),[r,i]}const dr=Me({slice_:function(t,e,n){const r=Re(t,"x","slice");if(0===r.rank)throw new Error("Slicing scalar is not possible");const[i,s]=hr(r,e,n);return Qn(r,i,s),Ee.runKernelFunc((t,e)=>(e([r]),t.slice(r,i,s)),{x:r},null,"Slice",{begin:e,size:n})}}),fr=Me({tanh_:function(t){const e=Re(t,"x","tanh");return Ee.runKernelFunc((t,n)=>{const r=t.tanh(e);return n([r]),r},{x:e},null,"Tanh")}}),pr=Me({basicLSTMCell_:function(t,e,n,r,i,s){const o=Re(t,"forgetBias","basicLSTMCell"),a=Re(e,"lstmKernel","basicLSTMCell"),l=Re(n,"lstmBias","basicLSTMCell"),u=Re(r,"data","basicLSTMCell"),c=Re(i,"c","basicLSTMCell"),h=Re(s,"h","basicLSTMCell"),d=Yn([u,h],1),f=Kn(d,a),p=Le(f,l),m=p.shape[1]/4,g=[p.shape[0],m],y=dr(p,[0,0],g),v=dr(p,[0,m],g),b=dr(p,[0,2*m],g),x=dr(p,[0,3*m],g),_=Le(Xn(Zn(y),fr(v)),Xn(c,Zn(Le(o,b))));return[_,Xn(fr(_),Zn(x))]}}),mr=Me({batchToSpaceND_:function(t,e,n){const r=Re(t,"x","batchToSpaceND"),i=e.reduce((t,e)=>t*e);return ht(r.rank>=1+e.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${e.length}`),ht(n.length===e.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`),ht(r.shape[0]%i==0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${i}`),Ee.runKernelFunc(t=>t.batchToSpaceND(r,e,n),{x:r},null,"BatchToSpaceND",{blockShape:e,crops:n})}});function gr(t){return null==t?null:0===t.rank?Ke(t,[t.size]):1===t.rank?t:2===t.rank?Ke(t,[1,1,t.shape[0],t.shape[1]]):3===t.rank?Ke(t,[1,t.shape[0],t.shape[1],t.shape[2]]):t}const yr=Me({batchNorm_:function(t,e,n,r,i,s){null==s&&(s=.001);const o=Re(t,"x","batchNorm"),a=Re(e,"mean","batchNorm"),l=Re(n,"variance","batchNorm");let u,c;null!=i&&(u=Re(i,"scale","batchNorm")),null!=r&&(c=Re(r,"offset","batchNorm")),ht(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),ht(null==c||a.rank===c.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),ht(null==u||a.rank===u.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const h=function(t){let e;return e=0===t.rank||1===t.rank?Ke(t,[1,1,1,t.size]):2===t.rank?Ke(t,[1,1,t.shape[0],t.shape[1]]):3===t.rank?Ke(t,[1,t.shape[0],t.shape[1],t.shape[2]]):t,e}(o),d=Ee.runKernelFunc((t,e)=>(e([h,a,l,u]),t.batchNorm(h,gr(a),gr(l),gr(c),gr(u),s)),{x:h,scale:u,offset:c,mean:a,variance:l},null,"FusedBatchNorm",{varianceEpsilon:s});return Ke(d,o.shape)}}),vr=Me({batchNorm2d_:function(t,e,n,r,i,s){const o=Re(t,"x","batchNorm"),a=Re(e,"mean","batchNorm"),l=Re(n,"variance","batchNorm");let u,c;return null!=i&&(u=Re(i,"scale","batchNorm")),null!=r&&(c=Re(r,"offset","batchNorm")),ht(2===o.rank,()=>"Error in batchNorm2D: x must be rank 2 but got rank "+o.rank+"."),ht(2===a.rank||1===a.rank,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),ht(2===l.rank||1===l.rank,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),null!=u&&ht(2===u.rank||1===u.rank,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${u.rank}.`),null!=c&&ht(2===c.rank||1===c.rank,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${c.rank}.`),yr(o,a,l,c,u,s)}}),br=Me({batchNorm3d_:function(t,e,n,r,i,s){const o=Re(t,"x","batchNorm"),a=Re(e,"mean","batchNorm"),l=Re(n,"variance","batchNorm");let u,c;return null!=i&&(u=Re(i,"scale","batchNorm")),null!=r&&(c=Re(r,"offset","batchNorm")),ht(3===o.rank,()=>"Error in batchNorm3D: x must be rank 3 but got rank "+o.rank+"."),ht(3===a.rank||1===a.rank,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),ht(3===l.rank||1===l.rank,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),null!=u&&ht(3===u.rank||1===u.rank,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${u.rank}.`),null!=c&&ht(3===c.rank||1===c.rank,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${c.rank}.`),yr(o,a,l,c,u,s)}}),xr=Me({batchNorm4d_:function(t,e,n,r,i,s){const o=Re(t,"x","batchNorm"),a=Re(e,"mean","batchNorm"),l=Re(n,"variance","batchNorm");let u,c;return null!=i&&(u=Re(i,"scale","batchNorm")),null!=r&&(c=Re(r,"offset","batchNorm")),ht(4===o.rank,()=>"Error in batchNorm4D: x must be rank 4 but got rank "+o.rank+"."),ht(4===a.rank||1===a.rank,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),ht(4===l.rank||1===l.rank,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),null!=u&&ht(4===u.rank||1===u.rank,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${u.rank}.`),null!=c&&ht(4===c.rank||1===c.rank,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${c.rank}.`),yr(o,a,l,c,u,s)}}),_r=Me({clone_:function(t){const e=Re(t,"x","clone",null);return Ee.runKernelFunc(()=>Ee.makeTensorFromDataId(e.dataId,e.shape,e.dtype),{x:e},null,"Identity")}}),wr=Me({broadcastTo_:function(t,e){let n=Re(t,"broadcastTo","x");const r=n.shape;if(e.some(t=>!(t>0)||t%1!=0))throw new Error(`broadcastTo(): Invalid broadcast shape [${e}].`);if(e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const t=n.shape.slice();for(;t.length<e.length;)t.unshift(1);n=Ke(n,t)}const i=n.shape,s=Array.from(e);for(let o=e.length-1;o>=0;o--)if(i[o]===e[o])s[o]=1;else if(1!==n.shape[o])throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${e}].`);return 0===s.map((t,e)=>t>1?e:-1).filter(t=>t>=0).length?_r(n):Ee.runKernelFunc(t=>t.tile(n,s),{x:n},null,"BroadcastTo",{shape:e,inputShape:i})}});function Sr(t,e="float32",n){return e=e||"float32",Yt(t),new se(t,e,n)}const Cr=Me({ceil_:function(t){const e=Re(t,"x","ceil");return Ee.runKernelFunc(t=>t.ceil(e),{x:e},null,"Ceil")}}),Er=Me({clipByValue_:function(t,e,n){const r=Re(t,"x","clipByValue");return ht(e<=n,()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`),Ee.runKernelFunc((t,i)=>{const s=t.clip(r,e,n);return i([r]),s},{x:r},null,"ClipByValue",{clipValueMin:e,clipValueMax:n})}}),kr=Me({complex_:function(t,e){const n=Re(t,"real","complex"),r=Re(e,"imag","complex");return dt(n.shape,r.shape,`real and imag shapes, ${n.shape} and ${r.shape}, must match in call to tf.complex().`),Ee.runKernelFunc(t=>t.complex(n,r),{real:n,imag:r},null,"Complex")}}),Ar=Me({concat1d_:function(t){return Yn(t,0)}}),Dr=Me({concat2d_:function(t,e){return Yn(t,e)}}),Nr=Me({concat3d_:function(t,e){return Yn(t,e)}}),Tr=Me({concat4d_:function(t,e){return Yn(t,e)}}),Or=Me({conv2d_:function(t,e,n,r,i="NHWC",s=[1,1],o){const a=Re(t,"x","conv2d"),l=Re(e,"filter","conv2d");let u=a,c=!1;3===a.rank&&(c=!0,u=Ke(a,[1,a.shape[0],a.shape[1],a.shape[2]])),ht(4===u.rank,()=>`Error in conv2d: input must be rank 4, but got rank ${u.rank}.`),ht(4===l.rank,()=>"Error in conv2d: filter must be rank 4, but got rank "+l.rank+"."),null!=o&&ht(vt(r),()=>`Error in conv2d: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`);const h="NHWC"===i?u.shape[3]:u.shape[1];ht(h===l.shape[2],()=>`Error in conv2d: depth of input (${h}) must match input depth for filter ${l.shape[2]}.`),ht(bn(n,s),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`);const d=Ee.runKernelFunc((t,e)=>{const a=xn(i),c=hn(u.shape,l.shape,n,s,r,o,!1,a),h=t.conv2d(u,l,c);return e([u,l]),h},{x:u,filter:l},null,"Conv2D",{strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:o});return c?Ke(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),Ir=Me({conv1d_:function(t,e,n,r,i="NWC",s=1,o){const a=Re(t,"x","conv1d"),l=Re(e,"filter","conv1d");let u=a,c=!1;2===a.rank&&(c=!0,u=Ke(a,[1,a.shape[0],a.shape[1]])),ht(3===u.rank,()=>`Error in conv1d: input must be rank 3, but got rank ${u.rank}.`),ht(3===l.rank,()=>"Error in conv1d: filter must be rank 3, but got rank "+l.rank+"."),null!=o&&ht(vt(r),()=>`Error in conv1d: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`),ht(u.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${u.shape[2]}) must match input depth for filter ${l.shape[1]}.`),ht(bn(n,s),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${s}'`),ht("NWC"===i,()=>`Error in conv1d: got dataFormat of ${i} but only NWC is currently supported.`);const h=Ke(l,[1,l.shape[0],l.shape[1],l.shape[2]]),d=Ke(u,[u.shape[0],1,u.shape[1],u.shape[2]]),f=Or(d,h,[1,n],r,"NHWC",[1,s],o);return Ke(f,c?[f.shape[2],f.shape[3]]:[f.shape[0],f.shape[2],f.shape[3]])}}),Rr=Me({conv2DBackpropInput_:function(t,e,n,r,i,s="NHWC",o){ht(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let a=t,l=e,u=!1;3===e.rank&&(u=!0,l=Ke(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),ht(4===a.length,()=>"Error in conv2dDerInput: inShape must be length 4, but got length "+a.length+"."),ht(4===l.rank,()=>"Error in conv2dDerInput: dy must be rank 4, but got rank "+l.rank),ht(4===n.rank,()=>"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank);const c="NHWC"===s?a[3]:a[1],h="NHWC"===s?l.shape[3]:l.shape[1];ht(c===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${c}) must match input depth for filter ${n.shape[2]}.`),ht(h===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${h}) must match output depth for filter ${n.shape[3]}.`),null!=o&&ht(vt(i),()=>`Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode ${o} but got pad ${i}.`);const d=Ee.runKernelFunc((t,e)=>{const u=xn(s),c=hn(a,n.shape,r,1,i,o,!1,u),h=t.conv2dDerInput(l,n,c);return e([l,n]),h},{dy:l,filter:n},null,"Conv2DBackpropInput",{strides:r,pad:i,dataFormat:s,dimRoundingMode:o,inputShape:a});return u?Ke(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),Fr=Me({conv2dTranspose_:function(t,e,n,r,i,s){const o=Re(t,"x","conv2dTranspose"),a=Re(e,"filter","conv2dTranspose");return Rr(n,o,a,r,i,"NHWC",s)}}),Mr=Me({conv3d_:function(t,e,n,r,i="NDHWC",s=[1,1,1]){const o=Re(t,"x","conv3d"),a=Re(e,"filter","conv3d");let l=o,u=!1;4===o.rank&&(u=!0,l=Ke(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),ht(5===l.rank,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),ht(5===a.rank,()=>"Error in conv3d: filter must be rank 5, but got rank "+a.rank+"."),ht(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),ht(bn(n,s),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`),ht("NDHWC"===i,()=>`Error in conv3d: got dataFormat of ${i} but only NDHWC is currently supported.`);const c=Ee.runKernelFunc((t,e)=>{const i=dn(l.shape,a.shape,n,s,r),o=t.conv3d(l,a,i);return e([l,a]),o},{x:l,filter:a},null,"Conv3D",{strides:n,pad:r,dataFormat:i,dilations:s});return u?Ke(c,[c.shape[1],c.shape[2],c.shape[3],c.shape[4]]):c}}),$r=Me({conv3DBackpropInput_:function(t,e,n,r,i){ht(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let s=t,o=e,a=!1;4===e.rank&&(a=!0,o=Ke(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),s=[1,t[0],t[1],t[2],t[3]]);const l=s[4],u=o.shape[4];ht(5===s.length,()=>"Error in conv3dDerInput: inShape must be length 5, but got length "+s.length+"."),ht(5===o.rank,()=>"Error in conv3dDerInput: dy must be rank 5, but got rank "+o.rank),ht(5===n.rank,()=>"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank),ht(l===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[3]}.`),ht(u===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${u}) must match output depth for filter ${n.shape[4]}.`);const c=Ee.runKernelFunc(t=>{const e=dn(s,n.shape,r,1,i);return t.conv3dDerInput(o,n,e)},{dy:o},null,"Conv3DBackpropInputV2",{pad:i});return a?Ke(c,[c.shape[1],c.shape[2],c.shape[3],c.shape[4]]):c}}),Pr=Me({conv3dTranspose_:function(t,e,n,r,i){const s=Re(t,"x","conv3dTranspose"),o=Re(e,"filter","conv3dTranspose");return $r(n,s,o,r,i)}}),zr=Me({cos_:function(t){const e=Re(t,"x","cos");return Ee.runKernelFunc((t,n)=>{const r=t.cos(e);return n([e]),r},{x:e},null,"Cos")}}),Lr=Me({cosh_:function(t){const e=Re(t,"x","cosh");return Ee.runKernelFunc((t,n)=>{const r=t.cosh(e);return n([e]),r},{x:e},null,"Cosh")}}),Br=Me({cumsum_:function(t,e=0,n=!1,r=!1){const i=Re(t,"x","cumsum");return Ee.runKernelFunc((t,s)=>{const o=He([e],i.rank);let a=i;null!=o&&(a=Xe(i,o));const l=Ye(1,i.rank)[0];let u=t.cumsum(a,l,n,r);if(s([i]),null!=o){const t=Ge(o);u=Xe(u,t)}return u},{x:i},null,"Cumsum",{axis:e,exclusive:n,reverse:r})}}),jr=Me({depthToSpace_:function(t,e,n="NHWC"){const r=Re(t,"x","depthToSpace"),i="NHWC"===n?r.shape[1]:r.shape[2],s="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];return ht(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying\n    ${i} and ${e}  for depthToSpace with input shape\n    ${r.shape}`),ht(s*e>=0,()=>`Negative dimension size caused by overflow when multiplying\n    ${s} and ${e} for depthToSpace with input shape\n        ${r.shape}`),ht(o%(e*e)==0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${r.shape}`),Ee.runKernelFunc(t=>t.depthToSpace(r,e,n),{x:r},null,"DepthToSpace",{blockSize:e,dataFormat:n})}}),Ur=Me({depthwiseConv2d_:function(t,e,n,r,i="NHWC",s=[1,1],o){const a=Re(t,"x","depthwiseConv2d"),l=Re(e,"filter","depthwiseConv2d");let u=a,c=!1;3===a.rank&&(c=!0,u=Ke(a,[1,a.shape[0],a.shape[1],a.shape[2]])),ht(4===u.rank,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${u.rank}.`),ht(4===l.rank,()=>"Error in depthwiseConv2d: filter must be rank 4, but got rank "+l.rank+"."),ht(u.shape[3]===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${u.shape[3]}) must match the inChannels dimension in filter ${l.shape[2]}.`),null!=o&&ht(vt(r),()=>`Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`);const h=Ee.runKernelFunc((t,e)=>{null==s&&(s=[1,1]),ht(bn(n,s),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`);const i=hn(u.shape,l.shape,n,s,r,o,!0),a=t.depthwiseConv2D(u,l,i);return e([u,l]),a},{x:u,filter:l},null,"DepthwiseConv2dNative",{strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:o});return c?Ke(h,[h.shape[1],h.shape[2],h.shape[3]]):h}}),Vr=Me({diag_:function(t){const e=Re(t,"x","diag");return Ee.runKernelFunc(n=>{const r=Ke(e,[e.size]),i=n.diag(r),s=[...t.shape,...t.shape];return Ke(i,s)},{x:e},null,"Diag")}}),Wr=Me({dilation2d_:function(t,e,n,r,i=[1,1],s="NHWC"){const o=Re(t,"x","dilation2d"),a=Re(e,"filter","dilation2d");ht(3===o.rank||4===o.rank,()=>"Error in dilation2d: input must be rank 3 or 4, but got rank "+o.rank+"."),ht(3===a.rank,()=>"Error in dilation2d: filter must be rank 3, but got rank "+a.rank+"."),ht("NHWC"===s,()=>"Error in dilation2d: Only NHWC is currently supported, but got dataFormat of "+s);let l=o,u=!1;3===o.rank&&(l=Ke(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=!0);const c=Ee.runKernel("Dilation2D",{x:l,filter:a},{strides:n,pad:r,dilations:i});return u?Ke(c,[c.shape[1],c.shape[2],c.shape[3]]):c}}),qr=Me({floorDiv_:function(t,e){let n=Re(t,"a","floorDiv"),r=Re(e,"b","floorDiv");return[n,r]=be(n,r),Ee.runKernelFunc((t,e)=>{const i=t.floorDiv(n,r);return e([n,r]),i},{a:n,b:r},null,"FloorDiv")}}),Hr=Me({div_:function(t,e){let n=Re(t,"a","div"),r=Re(e,"b","div");return[n,r]=be(n,r),"int32"===n.dtype&&"int32"===r.dtype?qr(n,r):Ee.runKernelFunc((t,e)=>{const i=t.realDivide(n,r);return e([n,r]),i},{a:n,b:r},null,"Div",{})}});function Gr(t,e){const n=t.length,r=[];for(let i=0;i<n;i++){const s=n-1-i,o=t[s]||1;(e[e.length-1-i]||1)>1&&1===o&&r.unshift(s)}return r}function Yr(t,e){const n=[];for(let r=0;r<e.length;r++){const i=t[t.length-r-1],s=e.length-r-1,o=e[s];(null==i||1===i&&o>1)&&n.unshift(s)}return n}function Kr(t,e){const n=[],r=Math.max(t.length,e.length);for(let i=0;i<r;i++){let r=t[t.length-i-1];null==r&&(r=1);let s=e[e.length-i-1];if(null==s&&(s=1),1===r)n.unshift(s);else if(1===s)n.unshift(r);else{if(r!==s)throw Error(`Operands could not be broadcast together with shapes ${t} and ${e}.`);n.unshift(r)}}return n}const Xr=Me({equal_:function(t,e){let n=Re(t,"a","equal"),r=Re(e,"b","equal");return[n,r]=be(n,r),Kr(n.shape,r.shape),Ee.runKernelFunc(t=>t.equal(n,r),{a:n,b:r},null,"Equal")}}),Zr=Me({where_:function(t,e,n){const r=Re(e,"a","where"),i=Re(n,"b","where"),s=Re(t,"condition","where","bool"),o=Kr(r.shape,i.shape),a=wr(r,o),l=wr(i,o);return 1===s.rank&&ht(s.shape[0]===r.shape[0],()=>"The first dimension of `a` must match the size of `condition`."),1!==s.rank&&dt(s.shape,l.shape,"Error in where: "),Ee.runKernelFunc((t,e)=>{const n=t.select(s,a,l);return e([s]),n},{condition:s,t:a,e:l},null,"SelectV2")}}),Qr=Me({zerosLike_:function(t){const e=Re(t,"x","zerosLike");return Ee.runKernelFunc(t=>t.zerosLike(e),{x:e},null,"ZerosLike")}}),Jr=Me({divNoNan_:function(t,e){let n=Re(t,"a","div"),r=Re(e,"b","div");[n,r]=be(n,r);const i=Hr(n,r),s=Qr(i),o=Xr(r,s);return Zr(o,s,i)}}),ti=Me({dot_:function(t,e){const n=Re(t,"t1","dot"),r=Re(e,"t2","dot");ht(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${r.rank}.`);const i=1===n.rank?n.size:n.shape[1],s=1===r.rank?r.size:r.shape[0];if(ht(i===s,()=>`Error in dot: inner dimensions of inputs must match, but got ${i} and ${s}.`),1===n.rank&&1===r.rank){const t=Ke(n,[1,-1]),e=Ke(r,[-1,1]),i=Kn(t,e);return Ke(i,[])}if(1===n.rank&&2===r.rank){const t=Ke(n,[1,-1]),e=Ke(r,[r.shape[0],r.shape[1]]),i=Kn(t,e);return Ke(i,[i.size])}if(2===n.rank&&1===r.rank){const t=Ke(r,[-1,1]),e=Kn(n,t);return Ke(e,[e.size])}{const t=Ke(r,[r.shape[0],r.shape[1]]);return Kn(n,t)}}}),ei=Me({elu_:function(t){const e=Re(t,"x","elu");return Ee.runKernelFunc((t,n)=>{const r=t.elu(e);return n([r]),r},{x:e},null,"Elu")}}),ni=Me({erf_:function(t){let e=Re(t,"x","erf");return ht("int32"===e.dtype||"float32"===e.dtype,()=>"Input dtype must be `int32` or `float32`."),"int32"===e.dtype&&(e=an(e,"float32")),Ee.runKernelFunc((t,n)=>{const r=t.erf(e);return n([e]),r},{x:e},null,"Erf")}}),ri=Me({exp_:function(t){const e=Re(t,"x","exp");return Ee.runKernelFunc((t,n)=>{const r=t.exp(e);return n([r]),r},{x:e},null,"Exp")}}),ii=Me({expandDims_:function(t,e=0){const n=Re(t,"x","expandDims",null);ht(e<=n.rank,()=>"Axis must be <= rank of the tensor");const r=n.shape.slice();return e<0&&(ht(-(n.rank+1)<=e,()=>`Axis must be in the interval [${-(n.rank+1)}, ${n.rank}]`),e=n.rank+e+1),r.splice(e,0,1),Ke(n,r)}}),si=Me({expm1_:function(t){const e=Re(t,"x","expm1");return Ee.runKernelFunc((t,n)=>{const r=t.expm1(e);return n([e]),r},{x:e},null,"Expm1")}}),oi=Me({tile_:function(t,e){const n=Re(t,"x","tile",null);return ht(n.rank===e.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`),Ee.runKernelFunc((t,r)=>{const i=t.tile(n,e);return r([n]),i},{x:n},null,"Tile",{reps:e},[n])}}),ai=Me({eye_:function(t,e,n,r="float32"){null==e&&(e=t);const i=Sr([t,e],r),s=t<=e?t:e;for(let a=0;a<s;++a)i.set(1,a,a);const o=Ke(i.toTensor(),[t,e]);if(null==n)return o;if(1===n.length)return oi(ii(o,0),[n[0],1,1]);if(2===n.length)return oi(ii(ii(o,0),0),[n[0],n[1],1,1]);if(3===n.length)return oi(ii(ii(ii(o,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}}),li=Me({fft_:function(t){return ht("complex64"===t.dtype,()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`),Ee.runKernelFunc(e=>{const n=t.shape[t.shape.length-1],r=t.as2D(t.size/n,n);return e.fft(r).reshape(t.shape)},{input:t},null,"FFT")}});function ui(t,e,n){return Ee.runKernelFunc(r=>r.fill(t,e,n),{},null,"Fill",{shape:t,value:e,dtype:n})}const ci=Me({floor_:function(t){const e=Re(t,"x","floor");return Ee.runKernelFunc(t=>t.floor(e),{x:e},null,"Floor")}}),hi=30;function di(t){return t<=hi?t:Bt(t,Math.floor(Math.sqrt(t)))}function fi(t,e){let n,r=!1;for(t<=hi?(n=t,r=!0):n=Bt(t,Math.floor(Math.sqrt(t)));!r;)n>e||n===t?r=!0:n=Bt(t,n+1);return n}function pi(t,e,n){const r=[],i=t.length;for(let s=0;s<i;s++)r.push(s!==e?t[s]:n);return r}function mi(t,e,n){const r=t.shape[n],i=[];let s=1,o=1;for(let a=0;a<n;a++)i.push(t.shape[a]),s*=t.shape[a];for(let a=0;a<e.rank;a++)i.push(e.shape[a]);for(let a=n+1;a<t.rank;a++)i.push(t.shape[a]),o*=t.shape[a];return{batchSize:s,sliceSize:o,dimSize:r,outputShape:i}}const gi=Me({gather_:function(t,e,n=0){const r=Re(t,"x","gather"),i=Re(e,"indices","gather","int32");return Ee.runKernelFunc((t,e)=>{const s=Et(n,r.shape)[0],o=mi(r,i,s),a=t.gather(r,Ke(i,[i.size]),s);return e([r,i]),Ke(a,o.outputShape)},{x:r,indices:i},null,"GatherV2",{axis:n})}}),yi=Me({greater_:function(t,e){let n=Re(t,"a","greater"),r=Re(e,"b","greater");return[n,r]=be(n,r),Kr(n.shape,r.shape),Ee.runKernelFunc(t=>t.greater(n,r),{a:n,b:r},null,"Greater")}}),vi=Me({greaterEqual_:function(t,e){let n=Re(t,"a","greaterEqual"),r=Re(e,"b","greaterEqual");return[n,r]=be(n,r),Kr(n.shape,r.shape),Ee.runKernelFunc((t,e)=>{const i=t.greaterEqual(n,r);return e([n,r]),i},{a:n,b:r},null,"GreaterEqual")}}),bi=Me({ifft_:function(t){return ht("complex64"===t.dtype,()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`),Ee.runKernelFunc(e=>{const n=t.shape[t.shape.length-1],r=Ke(t,[t.size/n,n]),i=e.ifft(r);return Ke(i,t.shape)},{input:t},null,"IFFT")}}),xi=Me({imag_:function(t){const e=Re(t,"input","imag");return Ee.runKernelFunc(t=>t.imag(e),{input:e},null,"Imag")}}),_i=Me({real_:function(t){const e=Re(t,"input","real");return Ee.runKernelFunc(t=>t.real(e),{input:e},null,"Real")}}),wi=Me({reverse_:function(t,e){const n=Re(t,"x","reverse");return Ee.runKernelFunc(t=>{const r=Et(e,n.shape);if(0===n.rank)return _r(n);const i=t.reverse(n,r);return Ke(i,n.shape)},{x:n},null,"Reverse",{dims:e})}});function Si(t,e){if((It(t)&&"string"!==e||Array.isArray(t))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===e&&It(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Hn(t,[],[],e)}const Ci=Me({irfft_:function(t){const e=t.shape[t.shape.length-1],n=t.size/e;let r;if(e<=2){const i=Ke(t,[n,e]);r=bi(i)}else{const i=[n,2*(e-1)],s=Ke(_i(t),[n,e]),o=Ke(xi(t),[n,e]),a=wi(dr(s,[0,1],[n,e-2]),1),l=Xn(wi(dr(o,[0,1],[n,e-2]),1),Si(-1)),u=Yn([s,a],1),c=Yn([o,l],1),h=Ke(kr(u,c),[i[0],i[1]]);r=bi(h)}if(r=_i(r),3===t.rank&&0!==t.shape[0]){const e=r,n=t.shape[0];r=Ke(r,[n,r.shape[0]/n,r.shape[1]]),e.dispose()}return r}}),Ei=Me({isFinite_:function(t){const e=Re(t,"x","isFinite");return Ee.runKernelFunc(t=>t.isFinite(e),{x:e},null,"IsFinite")}}),ki=Me({isInf_:function(t){const e=Re(t,"x","isInf");return Ee.runKernelFunc(t=>t.isInf(e),{x:e},null,"IsInf")}}),Ai=Me({isNaN_:function(t){const e=Re(t,"x","isNaN");return Ee.runKernelFunc(t=>t.isNaN(e),{x:e},null,"IsNan")}}),Di=Me({maximum_:function(t,e){let n=Re(t,"a","maximum"),r=Re(e,"b","maximum");return[n,r]=be(n,r),"bool"===n.dtype&&(n=an(n,"int32"),r=an(r,"int32")),Kr(n.shape,r.shape),Ee.runKernelFunc((t,e)=>{const i=t.maximum(n,r);return e([n,r]),i},{a:n,b:r},null,"Maximum")}}),Ni=Me({leakyRelu_:function(t,e=.2){const n=Re(t,"x","leakyRelu");return Di(Xn(Si(e),n),n)}}),Ti=Me({less_:function(t,e){let n=Re(t,"a","less"),r=Re(e,"b","less");return[n,r]=be(n,r),Kr(n.shape,r.shape),Ee.runKernelFunc(t=>t.less(n,r),{a:n,b:r},null,"Less")}}),Oi=Me({lessEqual_:function(t,e){let n=Re(t,"a","lessEqual"),r=Re(e,"b","lessEqual");return[n,r]=be(n,r),Kr(n.shape,r.shape),Ee.runKernelFunc((t,e)=>{const i=t.lessEqual(n,r);return e([n,r]),i},{a:n,b:r},null,"LessEqual")}});function Ii(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");return Ee.runKernelFunc(r=>r.linspace(t,e,n),{},null,"LinSpace",{start:t,stop:e,num:n})}const Ri=Me({localResponseNormalization_:function(t,e=5,n=1,r=1,i=.5){const s=Re(t,"x","localResponseNormalization");ht(4===s.rank||3===s.rank,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ${s.rank}.`),ht(vt(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=s,a=!1;3===s.rank&&(a=!0,o=Ke(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const l=Ee.runKernelFunc((t,s)=>{const a=t.localResponseNormalization4D(o,e,n,r,i);return s([o,a]),a},{x:o},null,"LRN",{depthRadius:e,bias:n,alpha:r,beta:i});return a?Ke(l,[l.shape[1],l.shape[2],l.shape[3]]):l}}),Fi=Me({log_:function(t){const e=Re(t,"x","log");return Ee.runKernelFunc((t,n)=>{const r=t.log(e);return n([e]),r},{x:e},null,"Log")}}),Mi=Me({log1p_:function(t){const e=Re(t,"x","log1p");return Ee.runKernelFunc((t,n)=>{const r=t.log1p(e);return n([e]),r},{x:e},null,"Log1p")}});function $i(t){return ht(Lt(t),()=>"The f passed in grad(f) must be a function"),(e,n)=>{const r=Re(e,"x","tf.grad",null),i=null!=n?Re(n,"dy","tf.grad"):null;return Ee.tidy(()=>{const{value:e,grads:n}=Ee.gradients(()=>t(r),[r],i);return null!=i&&dt(e.shape,i.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),Ui(n),n[0]})}}function Pi(t){return ht(Lt(t),()=>"The f passed in grads(f) must be a function"),(e,n)=>{ht(Array.isArray(e),()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s");const r=Fe(e,"args","tf.grads",null),i=null!=n?Re(n,"dy","tf.grads"):null;return Ee.tidy(()=>{const{value:e,grads:n}=Ee.gradients(()=>t(...r),r,i);return null!=i&&dt(e.shape,i.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Ui(n),n})}}function zi(t){return ht(Lt(t),()=>"The f passed in valueAndGrad(f) must be a function"),(e,n)=>{ht(e instanceof ue,()=>"The x passed in valueAndGrad(f)(x) must be a tensor"),ht(null==n||n instanceof ue,()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");const{grads:r,value:i}=Ee.gradients(()=>t(e),[e],n);return Ui(r),{grad:r[0],value:i}}}function Li(t){return ht(Lt(t),()=>"The f passed in valueAndGrads(f) must be a function"),(e,n)=>{ht(Array.isArray(e)&&e.every(t=>t instanceof ue),()=>"The args passed in valueAndGrads(f)(args) must be array of tensors"),ht(null==n||n instanceof ue,()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");const r=Ee.gradients(()=>t(...e),e,n);return null!=n&&dt(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Ui(r.grads),r}}function Bi(t,e){ht(Lt(t),()=>"The f passed in variableGrads(f) must be a function"),ht(null==e||Array.isArray(e)&&e.every(t=>t instanceof ce),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=null!=e;if(!n){e=[];for(const t in Ee.registeredVariables)e.push(Ee.registeredVariables[t])}const r=n?e.filter(t=>!t.trainable):null,i=e.length;ht((e=e.filter(t=>t.trainable)).length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${i} variables is trainable.`);const{value:s,grads:o}=Ee.gradients(t,e,null,!0);ht(o.some(t=>null!=t),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),ht(0===s.rank,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${s.rank} tensor`);const a={};return e.forEach((t,e)=>{null!=o[e]&&(a[t.name]=o[e])}),null!=r&&r.forEach(t=>a[t.name]=null),{value:s,grads:a}}function ji(t){return Ee.customGrad(t)}function Ui(t){if(t.filter(t=>null==t).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}const Vi=Me({neg_:function(t){const e=Re(t,"x","neg");return Ee.runKernelFunc(t=>t.neg(e),{x:e},null,"Negate")}}),Wi=Me({softplus_:function(t){const e=Re(t,"x","softplus");return Ee.runKernelFunc((t,n)=>{const r=t.softplus(e);return n([e]),r},{x:e},null,"Softplus")}}),qi=Me({logSigmoid_:function(t){const e=Re(t,"x","logSigmoid");return ji(t=>({value:Vi(Wi(Vi(t))),gradFunc:e=>Xn(e,Zn(Vi(t)))}))(e)}}),Hi=Me({max_:function(t,e=null,n=!1){const r=Re(t,"x","max");return Ee.runKernelFunc((t,i)=>{let s=Et(e,r.shape);const o=He(s,r.rank);let a=r;null!=o&&(a=Xe(r,o),s=Ye(s.length,a.rank));const l=t.max(a,s);null!=o&&a.dispose();let u=l;if(n){const t=We(u.shape,Et(e,r.shape));u=Ke(u,t),l.dispose()}return i([r,u]),u},{x:r},null,"Max",{reductionIndices:e,keepDims:n})}}),Gi=Me({sub_:function(t,e){let n=Re(t,"a","sub"),r=Re(e,"b","sub");return[n,r]=be(n,r),Ee.runKernelFunc((t,e)=>{const i=t.subtract(n,r);return e([n,r]),i},{a:n,b:r},null,"Sub")}}),Yi=Me({sum_:function(t,e=null,n=!1){let r=Re(t,"x","sum");return"bool"===r.dtype&&(r=an(r,"int32")),Ee.runKernelFunc((t,i)=>{i([r]);const s=Et(e,r.shape),o=He(s,r.rank);let a=s,l=r;null!=o&&(l=Xe(r,o),a=Ye(a.length,r.rank));let u=t.sum(l,a);if(n){const t=We(u.shape,s);u=Ke(u,t)}return u},{x:r},null,"Sum",{axis:e,keepDims:n})}}),Ki=Me({logSoftmax_:function(t,e=-1){const n=Re(t,"logits","logSoftmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);return Ee.runKernelFunc((n,r)=>{const i=Hi(t,e,!0),s=Gi(t,i),o=Gi(an(s,"float32"),Fi(Yi(ri(s),e,!0)));return r([o]),o},{logits:n},null,"LogSoftmax",{axis:e})}}),Xi=Me({logSumExp_:function(t,e=null,n=!1){const r=Re(t,"x","logSumExp"),i=Et(e,r.shape),s=Hi(r,i,!0),o=Gi(r,s),a=ri(o),l=Yi(a,i),u=Fi(l),c=Le(Ke(s,u.shape),u);if(n){const t=We(c.shape,i);return Ke(c,t)}return c}}),Zi=Me({logicalAnd_:function(t,e){const n=Re(t,"a","logicalAnd","bool"),r=Re(e,"b","logicalAnd","bool");return Kr(n.shape,r.shape),Ee.runKernelFunc(t=>t.logicalAnd(n,r),{a:n,b:r},null,"LogicalAnd")}}),Qi=Me({logicalNot_:function(t){const e=Re(t,"x","logicalNot","bool");return Ee.runKernelFunc(t=>t.logicalNot(e),{x:e},null,"LogicalNot")}}),Ji=Me({logicalOr_:function(t,e){const n=Re(t,"a","logicalOr","bool"),r=Re(e,"b","logicalOr","bool");return Kr(n.shape,r.shape),Ee.runKernelFunc(t=>t.logicalOr(n,r),{a:n,b:r},null,"LogicalOr")}}),ts=Me({logicalXor_:function(t,e){const n=Re(t,"a","logicalXor","bool"),r=Re(e,"b","logicalXor","bool");return Kr(n.shape,r.shape),Zi(Ji(t,e),Qi(Zi(t,e)))}}),es=Me({maxPool_:function(t,e,n,r,i){const s=Re(t,"x","maxPool");let o=s,a=!1;3===s.rank&&(a=!0,o=Ke(s,[1,s.shape[0],s.shape[1],s.shape[2]])),ht(4===o.rank,()=>`Error in maxPool: input must be rank 4 but got rank ${o.rank}.`),ht(bn(n,1),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`),null!=i&&ht(vt(r),()=>`Error in maxPool: pad must be an integer when using, dimRoundingMode ${i} but got pad ${r}.`);const l=Ee.runKernelFunc((t,s)=>{const a=un(o.shape,e,n,1,r,i);let l;return l=1===a.filterWidth&&1===a.filterHeight&&yt(a.inShape,a.outShape)?o.clone():t.maxPool(o,a),s([o,l]),l},{x:o},null,"MaxPool",{filterSize:e,strides:n,pad:r,dimRoundingMode:i});return a?Ke(l,[l.shape[1],l.shape[2],l.shape[3]]):l}}),ns=Me({maxPool3d_:function(t,e=[1,1,1],n,r,i,s="NDHWC",o){null==o?o=[1,1,1]:En("dilations is deprecated, this field will be gone in v3.0.0.");const a=Re(t,"x","maxPool3d");let l=a,u=!1;4===a.rank&&(u=!0,l=Ke(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),ht(5===l.rank,()=>`Error in maxPool3d: x must be rank 5 but got rank ${l.rank}.`),ht("NDHWC"===s,()=>"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+s),ht(bn(n,o),()=>`Error in maxPool3d: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),null!=i&&ht(vt(r),()=>`Error in maxPool3d: pad must be an integer when using, dimRoundingMode ${i} but got pad ${r}.`);const c=Ee.runKernelFunc((t,a)=>{null==o&&(o=[1,1,1]);const u=cn(l.shape,e,n,o,r,i,s),c=t.maxPool3d(l,u);return a([l,c]),c},{x:l},null,"MaxPool3D",{filterSize:e,strides:n,pad:r,dimRoundingMode:i,dataFormat:s,dilations:o});return u?Ke(c,[c.shape[1],c.shape[2],c.shape[3],c.shape[4]]):c}}),rs=Me({maxPoolWithArgmax_:function(t,e,n,r,i=!1){const s=Re(t,"x","maxPoolWithArgmax"),o=Ee.runKernel("MaxPoolWithArgmax",{x:s},{filterSize:e,strides:n,pad:r,includeBatchInIndex:i});return{result:o[0],indexes:o[1]}}});function is(t,e="float32"){if("complex64"===e){const e=is(t,"float32"),n=is(t,"float32");return kr(e,n)}const n=qt(mt(t),e);return Ee.makeTensor(n,t,e)}function ss(t,e="float32"){if("complex64"===e){const e=ss(t,"float32"),n=is(t,"float32");return kr(e,n)}const n=Wt(mt(t),e);return Ee.makeTensor(n,t,e)}const os=Me({mean_:function(t,e=null,n=!1){const r=Re(t,"x","mean"),i=Et(e,r.shape),s=mt(Ve(r.shape,i)[1]);return ji(t=>{const r=Si(s),o=r.dtype===t.dtype?t:an(t,r.dtype),a=Hr(o,r);return{value:Yi(a,e,n),gradFunc:e=>{const n=t.shape.slice();i.forEach(t=>{n[t]=1});const r=Ke(e,n);return Hr(Xn(r,ss(t.shape,"float32")),s)}}})(r)}}),as=Me({min_:function(t,e=null,n=!1){const r=Re(t,"x","min");return Ee.runKernelFunc((t,i)=>{const s=Et(e,r.shape);let o=s;const a=He(o,r.rank);let l=r;null!=a&&(l=Xe(r,a),o=Ye(o.length,r.rank));const u=t.min(l,o);null!=a&&l.dispose();let c=u;if(n){const t=We(c.shape,s);c=Ke(u,t),u.dispose()}return i([r,c]),c},{x:r},null,"Min",{axis:e,keepDims:n})}}),ls=Me({minimum_:function(t,e){let n=Re(t,"a","minimum"),r=Re(e,"b","minimum");return[n,r]=be(n,r),"bool"===n.dtype&&(n=an(n,"int32"),r=an(r,"int32")),Kr(n.shape,r.shape),Ee.runKernelFunc((t,e)=>{const i=t.minimum(n,r);return e([n,r]),i},{a:n,b:r},null,"Minimum")}}),us=Me({mod_:function(t,e){let n=Re(t,"a","mod"),r=Re(e,"b","mod");return[n,r]=be(n,r),Ee.runKernelFunc((t,e)=>{const i=t.mod(n,r);return e([n,r]),i},{a:n,b:r},null,"Mod")}}),cs=Me({square_:function(t){const e=Re(t,"x","square");return Ee.runKernelFunc((t,n)=>(n([e]),t.square(e)),{x:e},null,"Square",{},[e],[])}}),hs=Me({moments_:function(t,e=null,n=!1){const r=Et(e,(t=Re(t,"x","moments")).shape),i=os(t,r,n);let s=i.shape;n||(s=We(i.shape,r));const o=cs(Gi(an(t,"float32"),Ke(i,s)));return{mean:i,variance:os(o,r,n)}}}),ds=Me({multiRNNCell_:function(t,e,n,r){const i=Re(e,"data","multiRNNCell"),s=Fe(n,"c","multiRNNCell"),o=Fe(r,"h","multiRNNCell");let a=i;const l=[];for(let h=0;h<t.length;h++){const e=t[h](a,s[h],o[h]);l.push(e[0]),l.push(e[1]),a=e[1]}const u=[],c=[];for(let h=0;h<l.length;h+=2)u.push(l[h]),c.push(l[h+1]);return[u,c]}}),fs=Me({multinomial_:function(t,e,n,r=!1){const i=Re(t,"logits","multinomial"),s=i.size,o=i.rank;if(s<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+s+".");if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+o);n=n||Math.random();const a=1===o?Ke(i,[1,-1]):i,l=Ee.runKernelFunc(t=>t.multinomial(a,r,e,n),{logits2D:a});return 1===o?Ke(l,[l.size]):l}}),ps=Me({notEqual_:function(t,e){let n=Re(t,"a","notEqual"),r=Re(e,"b","notEqual");return[n,r]=be(n,r),Kr(n.shape,r.shape),Ee.runKernelFunc(t=>t.notEqual(n,r),{a:n,b:r},null,"NotEqual")}}),ms=Me({oneHot_:function(t,e,n=1,r=0){if(e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);const i=Re(t,"indices","oneHot","int32"),s=[...i.shape,e];return Ee.runKernelFunc((t,o)=>(o([i]),Ke(t.oneHot(Ke(i,[i.size]),e,n,r),s)),{indices:i},null,"OneHot",{depth:e,onValue:n,offValue:r})}}),gs=Me({onesLike_:function(t){const e=Re(t,"x","onesLike");return Ee.runKernelFunc((t,n)=>{if("complex64"===e.dtype){const t=gs(_i(e)),n=Qr(xi(e));return kr(t,n)}return t.onesLike(e)},{x:e},null,"OnesLike")}}),ys=Me({outerProduct_:function(t,e){const n=Re(t,"v1","outerProduct"),r=Re(e,"v2","outerProduct");ht(1===n.rank&&1===r.rank,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${r.rank}.`);const i=Ke(n,[-1,1]),s=Ke(r,[1,-1]);return Kn(i,s)}}),vs=Me({pad_:function(t,e,n=0){const r=Re(t,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");return Ee.runKernelFunc((t,i)=>(i([r]),t.pad(r,e,n)),{x:r},null,"PadV2",{paddings:e,constantValue:n})}}),bs=Me({pad1d_:function(t,e,n=0){return ht(2===e.length,()=>"Invalid number of paddings. Must be length of 2."),vs(t,[e],n)}}),xs=Me({pad2d_:function(t,e,n=0){return ht(2===e.length&&2===e[0].length&&2===e[1].length,()=>"Invalid number of paddings. Must be length of 2 each."),vs(t,e,n)}}),_s=Me({pad3d_:function(t,e,n=0){return ht(3===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length,()=>"Invalid number of paddings. Must be length of 2 each."),vs(t,e,n)}}),ws=Me({pad4d_:function(t,e,n=0){return ht(4===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length&&2===e[3].length,()=>"Invalid number of paddings. Must be length of 2 each."),vs(t,e,n)}}),Ss=Me({spaceToBatchND_:function(t,e,n){const r=Re(t,"x","spaceToBatchND");return ht(r.rank>=1+e.length,()=>`input rank ${r.rank} should be > than [blockShape] ${e.length}`),ht(n.length===e.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`),ht(r.shape.reduce((t,r,i)=>i>0&&i<=e.length?t&&(r+n[i-1][0]+n[i-1][1])%e[i-1]==0:t,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`),Ee.runKernelFunc(t=>t.spaceToBatchND(r,e,n),{x:r},null,"SpaceToBatchND",{blockShape:e,paddings:n})}}),Cs=Me({pool_:function(t,e,n,r,i,s){null==i&&(i=[1,1]),null==s&&(s=1),0===r&&(r="valid");const o=Re(t,"x","maxPool");let a=o,l=!1;3===o.rank&&(l=!0,a=Ke(o,[1,o.shape[0],o.shape[1],o.shape[2]])),ht(bn(s,i),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${s} and dilations '${i}'`);const u=un(a.shape,e,s,i,r),c=[u.dilationHeight,u.dilationWidth];let h;h="same"===r?function(t,e){const n=t.map((t,n)=>t+(t-1)*(e[n]-1)).map(t=>t-1),r=n.map(t=>Math.floor(t/2)),i=n.map((t,e)=>t-r[e]);return n.map((t,e)=>[r[e],i[e]])}([u.filterHeight,u.filterWidth],c):[[0,0],[0,0]];const d=1===c[0]&&1===c[1],[f,p]=function(t,e,n){const r=n.map(t=>t[0]),i=n.map(t=>t[1]),s=t.concat(r,i),o=e.map((t,e)=>(t-s[e]%t)%t),a=i.map((t,e)=>t+o[e]);return[e.map((t,e)=>[r[e],a[e]]),e.map((t,e)=>[0,o[e]])]}([u.inHeight,u.inWidth],c,h),m=d?r:"valid",g=d?a:Ss(a,c,f),y=("avg"===n?()=>_n(g,e,s,m):()=>es(g,e,s,m))(),v=d?y:mr(y,c,p);return l?Ke(v,[v.shape[1],v.shape[2],v.shape[3]]):v}}),Es=Me({pow_:function(t,e){let n=Re(t,"base","pow"),r=Re(e,"exp","pow");return[n,r]=be(n,r),Ee.runKernelFunc((t,e)=>{const i=t.pow(n,r);return e([n,r,i]),i},{a:n,b:r},null,"Pow")}}),ks=Me({prelu_:function(t,e){const n=Re(t,"x","prelu"),r=Re(e,"alpha","prelu");return Ee.runKernelFunc((t,e)=>{const i=t.prelu(n,r);return e([n,r]),i},{x:n,alpha:r},null,"Prelu")}});function As(t,e=!1){console.log(t.toString(e))}const Ds=Me({prod_:function(t,e=null,n=!1){let r=Re(t,"x","prod");return Ee.runKernelFunc(t=>{"bool"===r.dtype&&(r=an(r,"int32"));const i=Et(e,r.shape),s=He(i,r.rank);let o=i,a=r;null!=s&&(a=Xe(r,s),o=Ye(o.length,r.rank));let l=t.prod(a,o);if(n){const t=We(l.shape,i);l=Ke(l,t)}return l},{x:r},null,"Prod",{axis:e,keepDims:n})}}),Ns=Me({rand_:function(t,e,n){const r=mt(t);let i=null;if(null==n||"float32"===n)i=new Float32Array(r);else if("int32"===n)i=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);i=new Uint8Array(r)}for(let s=0;s<r;s++)i[s]=e();return Ee.makeTensor(i,t,n)}});var Ts=n("YSVl");const Os=.1;function Is(t,e,n){return null==n&&(n=Rs()),Fs(t,e,(t,e)=>zs(t,e,n))}function Rs(){return 32===Ee.backend.floatPrecision()?.001:Os}function Fs(t,e,n){let r=!0;if((It(t)||It(e))&&(r=!1),It(t)&&It(e)&&(r=!0),r){const n=t.constructor.name,r=e.constructor.name;if(n!==r)throw new Error(`Arrays are of different type. Actual: ${n}. Expected: `+r)}if(Array.isArray(t)&&Array.isArray(e)){const n=Oe(t),r=Oe(e);if(!yt(n,r))throw new Error(`Arrays have different shapes. Actual: [${n}]. Expected: [${r}]`)}const i=It(t)?t:pt(t),s=It(e)?e:pt(e);if(i.length!==s.length)throw new Error(`Arrays have different lengths actual: ${i.length} vs expected: ${s.length}.\nActual:   ${i}.\nExpected: ${s}.`);for(let o=0;o<s.length;++o){const t=i[o],e=s[o];if(!n(t,e))throw new Error(`Arrays differ: actual[${o}] = ${t}, expected[${o}] = ${e}.\nActual:   ${i}.\nExpected: ${s}.`)}}function Ms(t,e){t().then(()=>e.fail(),()=>e())}function $s(t,e){const n="string"==typeof e||"number"==typeof e||"boolean"==typeof e?[e]:e;return Mt(t)||Mt(t[0])||Mt(e)||Mt(e[0])?Fs(t,n,(t,e)=>t==e):Fs(t,e,(t,e)=>zs(t,e,0))}function Ps(t,e,n){if(null==n&&(n=Rs()),!zs(t,e,n))throw new Error(`Numbers differ: actual === ${t}, expected === ${e}`)}function zs(t,e,n){return!isFinite(t)&&!isFinite(e)||!(isNaN(t)||isNaN(e)||Math.abs(t-e)>n)}function Ls(t,e,n){for(let r=0;r<t.length;r++)if(t[r]<e||t[r]>n)throw new Error(`Value out of range:${t[r]} low: ${e}, high: ${n}`)}function Bs(t,e){expect(new Float32Array(t)).toEqual(new Float32Array(e))}class js{constructor(t,e,n,r,i){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);const s=i||Math.random();this.random=Ts.alea(s.toString())}nextValue(){if(!isNaN(this.nextVal)){const t=this.nextVal;return this.nextVal=NaN,t}let t,e,n=!1;for(;!n;){let r,i,s;do{r=2*this.random()-1,i=2*this.random()-1,s=r*r+i*i}while(s>=1||0===s);const o=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*r*o,e=this.mean+this.stdDev*i*o,this.truncated&&!this.isValidTruncated(t)||(n=!0)}return this.truncated&&!this.isValidTruncated(e)||(this.nextVal=this.convertValue(e)),this.convertValue(t)}convertValue(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}}class Us{constructor(t,e,n,r){this.alpha=t,this.beta=1/e,this.dtype=n;const i=r||Math.random();this.randu=Ts.alea(i.toString()),this.randn=new js(0,1,n,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let t,e,n,r,i,s;for(;;){do{r=this.randn.nextValue(),s=1+this.c*r}while(s<=0);if(s*=s*s,t=r*r,e=1-.331*t*t,n=.5*t+this.d*(1-s+Math.log(s)),i=this.randu(),i<e||Math.log(i)<n)break}return s*=1/this.beta*this.d,this.alpha<1&&(s*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(s)}convertValue(t){return"float32"===this.dtype?t:Math.round(t)}}class Vs{constructor(t=0,e=1,n,r){if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=t,this.range=e-t,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${e} <= 1 and dtype is not float`);this.random=Ts.alea(r)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}const Ws=Me({randomGamma_:function(t,e,n=1,r="float32",i){if(null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);const s=new Us(e,n,r,i),o=Sr(t,r);for(let a=0;a<o.values.length;a++)o.values[a]=s.nextValue();return o.toTensor()}}),qs=Me({randomNormal_:function(t,e=0,n=1,r,i){if(null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);const s=new js(e,n,r,!1,i),o=Sr(t,r);for(let a=0;a<o.values.length;a++)o.values[a]=s.nextValue();return o.toTensor()}}),Hs=Me({randomUniform_:function(t,e=0,n=1,r="float32",i){const s=Sr(t,r),o=new Vs(e,n,null,i);for(let a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}});function Gs(t,e){ft(t);const n=Oe(t,e);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Hn(t,null,n,e)}function Ys(t,e,n=1,r="float32"){if(0===n)throw new Error("Cannot have a step of zero");return Ee.runKernelFunc(()=>{if(t===e||t<e&&n<0||e<t&&n>1)return is([0],r);const i=qt(Math.abs(Math.ceil((e-t)/n)),r);e<t&&1===n&&(n=-1),i[0]=t;for(let t=1;t<i.length;t++)i[t]=i[t-1]+n;return Gs(i,r)},{},null,"Range",{start:t,stop:e,step:n,dtype:r})}const Ks=Me({reciprocal_:function(t){const e=Re(t,"x","reciprocal");return Ee.runKernelFunc((t,n)=>{const r=t.reciprocal(e);return n([e]),r},{x:e},null,"Reciprocal")}}),Xs=Me({relu_:function(t){const e=Re(t,"x","relu");return Ee.runKernelFunc((t,n)=>(n([e]),"bool"===e.dtype?an(e,"int32"):t.relu(e)),{x:e},null,"Relu")}}),Zs=Me({relu6_:function(t){const e=Re(t,"x","relu6");return Ee.runKernelFunc((t,n)=>(n([e]),"bool"===e.dtype?an(e,"int32"):t.relu6(e)),{x:e},null,"Relu6")}}),Qs=Me({reverse1d_:function(t){const e=Re(t,"x","reverse");return ht(1===e.rank,()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`),wi(e,0)}}),Js=Me({reverse2d_:function(t,e){const n=Re(t,"x","reverse");return ht(2===n.rank,()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`),wi(n,e)}}),to=Me({reverse3d_:function(t,e){const n=Re(t,"x","reverse");return ht(3===n.rank,()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`),wi(n,e)}}),eo=Me({reverse4d_:function(t,e){const n=Re(t,"x","reverse");return ht(4===n.rank,()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`),wi(n,e)}});function no(t,e,n=0){let r=[];if("number"==typeof e)ht(t.shape[n]%e==0,()=>"Number of splits must evenly divide the axis."),r=new Array(e).fill(t.shape[n]/e);else{ht(e.reduce((t,e)=>(-1===e&&(t+=1),t),0)<=1,()=>"There should be only one negative value in split array.");const i=e.indexOf(-1);if(-1!==i){const r=e.reduce((t,e)=>e>0?t+e:t);e[i]=t.shape[n]-r}ht(t.shape[n]===e.reduce((t,e)=>t+e),()=>"The sum of sizes must match the size of the axis dimension."),r=e}return r}const ro=Me({split_:function(t,e,n=0){const r=Re(t,"x","split");return Ee.runKernelFunc((t,i)=>{const s=Et(n,r.shape)[0],o=no(r,e,s);return t.split(r,o,s)},{x:r},null,"SplitV",{numOrSizeSplits:e,axis:n})}}),io=Me({rfft_:function(t,e){ht("float32"===t.dtype,()=>"The dtype for rfft() must be real value but got "+t.dtype);let n=t.shape[t.shape.length-1];const r=t.size/n;let i;if(null!=e&&e<n){const r=t.shape.map(t=>0),s=t.shape.map(t=>t);s[t.shape.length-1]=e,i=dr(t,r,s),n=e}else if(null!=e&&e>n){const r=t.shape.map(t=>t);r[t.shape.length-1]=e-n,i=Yn([t,is(r)],t.shape.length-1),n=e}else i=t;const s=Qr(i),o=Ke(kr(i,s),[r,n]),a=li(o),l=Math.floor(n/2)+1,u=_i(a),c=xi(a),h=ro(u,[l,n-l],u.shape.length-1),d=ro(c,[l,n-l],c.shape.length-1),f=i.shape.slice();return f[i.shape.length-1]=l,Ke(kr(h[0],d[0]),f)}}),so=Me({round_:function(t){const e=Re(t,"x","round");return Ee.runKernelFunc(t=>t.round(e),{x:e},null,"Round")}}),oo=Me({rsqrt_:function(t){const e=Re(t,"x","rsqrt");return Ee.runKernelFunc((t,n)=>{const r=t.rsqrt(e);return n([e]),r},{x:e},null,"Rsqrt")}}),ao=Me({selu_:function(t){const e=Re(t,"x","selu");return Ee.runKernelFunc((t,n)=>{const r=t.selu(e);return n([e]),r},{x:e},null,"Selu")}}),lo=Me({separableConv2d_:function(t,e,n,r,i,s=[1,1],o="NHWC"){const a=Re(t,"x","separableConv2d"),l=Re(e,"depthwiseFilter","separableConv2d"),u=Re(n,"pointwiseFilter","separableConv2d");let c=a,h=!1;if(3===a.rank&&(h=!0,c=Ke(a,[1,a.shape[0],a.shape[1],a.shape[2]])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");ht(4===c.rank,()=>`Error in separableConv2d: input must be rank 4, but got rank ${c.rank}.`),ht(4===l.rank,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),ht(4===u.rank,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),ht(1===u.shape[0],()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${u.shape[0]}.`),ht(1===u.shape[1],()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${u.shape[1]}.`);const d=l.shape[2],f=l.shape[3];ht(u.shape[2]===d*f,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${d*f}, but got ${u.shape[2]}.`);const p=Ur(c,l,r,i,o,s),m=Or(p,u,1,"valid",o);return h?Ke(m,[m.shape[1],m.shape[2],m.shape[3]]):m}}),uo=async function(t,e){const n=Re(t,"x","setdiff1d"),r=Re(e,"y","setdiff1d");ht(n.dtype===r.dtype,()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${r.dtype}).`),ht(1===n.rank,()=>`x should be 1D tensor, but got x (${n.shape}).`),ht(1===r.rank,()=>`y should be 1D tensor, but got y (${r.shape}).`);const i=await n.data(),s=await r.data(),o=new Set(s);let a=0;for(let c=0;c<i.length;c++)o.has(i[c])||a++;const l=new se([a],n.dtype),u=new se([a],"int32");for(let c=0,h=0;c<i.length;c++)o.has(i[c])||(l.values[h]=i[c],u.values[h]=c,h++);return[l.toTensor(),u.toTensor()]},co=Me({sign_:function(t){const e=Re(t,"x","sign");return Ee.runKernelFunc(t=>t.sign(e),{x:e},null,"Sign")}}),ho=Me({sin_:function(t){const e=Re(t,"x","sin");return Ee.runKernelFunc((t,n)=>{const r=t.sin(e);return n([e]),r},{x:e},null,"Sin")}}),fo=Me({sinh_:function(t){const e=Re(t,"x","sinh");return Ee.runKernelFunc((t,n)=>{const r=t.sinh(e);return n([e]),r},{x:e},null,"Sinh")}}),po=Me({slice1d_:function(t,e,n){const r=Re(t,"x","slice1d");return ht(1===r.rank,()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`),dr(r,[e],[n])}}),mo=Me({slice2d_:function(t,e,n){const r=Re(t,"x","slice2d");return ht(2===r.rank,()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`),dr(r,e,n)}}),go=Me({slice3d_:function(t,e,n){const r=Re(t,"x","slice3d");return ht(3===r.rank,()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`),dr(r,e,n)}}),yo=Me({slice4d_:function(t,e,n){const r=Re(t,"x","slice4d");return ht(4===r.rank,()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`),dr(r,e,n)}}),vo=Me({softmax_:function(t,e=-1){const n=Re(t,"logits","softmax","float32");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);return Ee.runKernelFunc((t,r)=>{const i=t.softmax(n,e);return r([i]),i},{logits:n},null,"Softmax",{dim:e})}}),bo=Me({sqrt_:function(t){const e=Re(t,"x","sqrt");return Ee.runKernelFunc((t,n)=>{const r=t.sqrt(e);return n([e]),r},{x:e},null,"Sqrt")}}),xo=Me({squaredDifference_:function(t,e){let n=Re(t,"a","squaredDifference"),r=Re(e,"b","squaredDifference");return[n,r]=be(n,r),Kr(n.shape,r.shape),Ee.runKernelFunc((t,e)=>{const i=t.squaredDifference(n,r);return e([n,r]),i},{a:n,b:r},null,"SquaredDifference",{})}}),_o=Me({squeeze_:function(t,e){const n=Re(t,"x","squeeze");return Ke(n,kt(n.shape,e).newShape)}}),wo=Me({stack_:function(t,e=0){const n=Fe(t,"tensors","stack");if(ht(n.length>=1,()=>"Pass at least one tensor to tf.stack"),1===n.length)return ii(n[0],e);const r=n[0].shape,i=n[0].dtype;ht(e<=n[0].rank,()=>"Axis must be <= rank of the tensor"),n.forEach(t=>{dt(r,t.shape,"All tensors passed to stack must have matching shapes"),ht(i===t.dtype,()=>"All tensors passed to stack must have matching dtypes")});const s=n.map(t=>ii(t,e));return Yn(s,e)}}),So=Me({step_:function(t,e=0){const n=Re(t,"x","step");return Ee.runKernelFunc(t=>t.step(n,e),{x:n},null,"Step",{alpha:e})}}),Co=Me({stridedSlice_:function(t,e,n,r,i=0,s=0,o=0,a=0,l=0){null==r&&(r=new Array(e.length));let u=Re(t,"x","stridedSlice");return Ee.runKernelFunc(t=>{const c=Jn(o);if(c.length>1)throw new Error("Multiple ellipses in slice is not allowed.");if(0!==o&&0!==a)throw new Error("Using both ellipsisMask and newAxisMask is not yet supported.");if(0!==o&&0!==l)throw new Error("Using both ellipsisMask and shrinkAxisMask is not yet supported.");const h=u.rank-e.length,d=Jn(a),f=u.shape.slice();if(d.forEach(t=>{e[t]=0,n[t]=1,f.splice(t,0,1)}),u=Ke(u,f),c.length&&h>0){const t=c[0],o=h+1;e=ir(i,t,o,e,u.shape),n=sr(s,t,o,n,u.shape),r=er(r,t,o,u.shape)}else for(let a=0;a<u.rank;a++)e[a]=ar(i,e,r,u.shape,a,o),n[a]=lr(s,n,r,u.shape,a,o),r[a]=or(r,a,o);const p=Jn(l);p.forEach(t=>{n[t]=e[t]+1,r[t]=1});const m=tr(e,n,r),g=m.filter((t,e)=>-1===p.indexOf(e));if(r.every(t=>1===t))return Ke(dr(u,e,m),g);const y=t.stridedSlice(u,e,n,r);return Ke(y,g)},{x:u},null,"StridedSlice",{begin:e,end:n,strides:r,beginMask:i,endMask:s,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l})}}),Eo=Me({tan_:function(t){const e=Re(t,"x","tan");return Ee.runKernelFunc((t,n)=>{const r=t.tan(e);return n([e]),r},{x:e},null,"Tan")}});function ko(t,e,n){if(ft(t),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");const r=Oe(t,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Hn(t,e,r,n)}function Ao(t,e,n){if(ft(t),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");const r=Oe(t,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Hn(t,e,r,n)}function Do(t,e,n){if(ft(t),null!=e&&4!==e.length)throw new Error("tensor4d() requires shape to have four numbers");const r=Oe(t,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Hn(t,e,r,n)}function No(t,e,n){if(ft(t),null!=e&&5!==e.length)throw new Error("tensor5d() requires shape to have five numbers");const r=Oe(t,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Hn(t,e,r,n)}function To(t,e,n){if(ft(t),null!=e&&6!==e.length)throw new Error("tensor6d() requires shape to have six numbers");const r=Oe(t,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Hn(t,e=e||r,r,n)}const Oo=Me({topk_:function(t,e=1,n=!0){const r=Re(t,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");const i=r.shape[r.shape.length-1];if(e>i)throw new Error(`'k' passed to topk() must be <= the last dimension (${i}) but got `+e);const s={x:r},o={k:e,sorted:n},[a,l]=Ee.runKernelFunc(t=>t.topk(r,e,n),s,null,"TopK",o);return{values:a,indices:l}}}),Io=Me({truncatedNormal_:function(t,e=0,n=1,r,i){if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");const s=new js(e,n,r,!0,i),o=Sr(t,r);for(let a=0;a<o.values.length;a++)o.values[a]=s.nextValue();return o.toTensor()}}),Ro=Me({unsortedSegmentSum_:function(t,e,n){const r=Re(t,"x","unsortedSegmentSum"),i=Re(e,"segmentIds","unsortedSegmentSum","int32");return ht(vt(n),()=>"numSegments must be of dtype int"),Ee.runKernelFunc((t,e)=>{const s=t.unsortedSegmentSum(r,i,n);return e([i]),s},{x:r,segmentIds:i},null,"UnsortedSegmentSum",{numSegments:n})}}),Fo=Me({unstack_:function(t,e=0){const n=Re(t,"x","unstack");return ht(e>=-n.shape.length&&e<n.shape.length,()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`),e<0&&(e+=n.shape.length),Ee.runKernelFunc(t=>t.unstack(n,e),{value:n},null,"Unpack",{axis:e})}});function Mo(t,e=!0,n,r){return Ee.makeVariable(t,e,n,r)}function $o(t,e){const n=[];for(let s=0;s<e.length;s++)e[s]&&n.push(s);const r=Sr(t,"int32"),i=Sr([n.length,t.length],"int32");for(let s=0;s<n.length;s++){const e=r.indexToLoc(n[s]);i.values.set(e,s*t.length)}return i.toTensor()}const Po=async function(t){const e=Re(t,"condition","whereAsync","bool"),n=await e.data(),r=$o(e.shape,n);return t!==e&&e.dispose(),r},zo=async function(t,e,n){const r=Re(t,"tensor","boolMask"),i=Re(e,"mask","boolMask","bool"),s=null==n?0:n,o=i.rank,a=r.shape;ht(o>0,()=>"mask cannot be scalar"),dt(a.slice(s,s+o),i.shape,"mask's shape must match the first K dimensions of tensor's shape,");let l=1;for(let m=s;m<s+o;m++)l*=a[m];const u=a.slice(0,s).concat([l],a.slice(s+o)),c=Ke(r,u),h=Ke(i,[-1]),d=await Po(h),f=_o(d,[1]),p=gi(c,f,s);return t!==r&&r.dispose(),e!==i&&i.dispose(),f.dispose(),c.dispose(),h.dispose(),d.dispose(),p},Lo=Me({equalStrict_:function(t,e){En("strict variants of ops have been deprecated and will be removed in future");const n=Re(t,"a","equalStrict"),r=Re(e,"b","equalStrict");return dt(n.shape,r.shape,"Error in equalStrict: "),Xr(n,r)}}),Bo=Me({greaterEqualStrict_:function(t,e){En("strict variants of ops have been deprecated and will be removed in future");const n=Re(t,"a","greaterEqualStrict"),r=Re(e,"b","greaterEqualStrict");return dt(n.shape,r.shape,"Error in greaterEqualStrict: "),vi(n,r)}}),jo=Me({greaterStrict_:function(t,e){En("strict variants of ops have been deprecated and will be removed in future");const n=Re(t,"a","greaterStrict"),r=Re(e,"b","greaterStrict");return dt(n.shape,r.shape,"Error in greaterStrict: "),yi(n,r)}}),Uo=Me({lessEqualStrict_:function(t,e){En("strict variants of ops have been deprecated and will be removed in future");const n=Re(t,"a","lessEqualStrict"),r=Re(e,"b","lessEqualStrict");return dt(n.shape,r.shape,"Error in lessEqualStrict: "),Oi(n,r)}}),Vo=Me({lessStrict_:function(t,e){En("strict variants of ops have been deprecated and will be removed in future");const n=Re(t,"a","lessStrict"),r=Re(e,"b","lessStrict");return dt(n.shape,r.shape,"Error in lessStrict: "),Ti(n,r)}}),Wo=Me({notEqualStrict_:function(t,e){En("strict variants of ops have been deprecated and will be removed in future");const n=Re(t,"a","notEqualStrict"),r=Re(e,"b","notEqualStrict");return dt(n.shape,r.shape,"Error in notEqualStrict: "),ps(n,r)}}),qo=Me({addStrict_:function(t,e){En("strict variants of ops have been deprecated and will be removed in future");const n=Re(t,"a","addStrict"),r=Re(e,"b","addStrict");return dt(n.shape,r.shape,"Error in addStrict: "),Le(n,r)}}),Ho=Me({divStrict_:function(t,e){En("strict variants of ops have been deprecated and will be removed in future");const n=Re(t,"a","div"),r=Re(e,"b","div");return dt(n.shape,r.shape,"Error in divideStrict: "),Hr(n,r)}}),Go=Me({maximumStrict_:function(t,e){En("strict variants of ops have been deprecated and will be removed in future");const n=Re(t,"a","maximumStrict"),r=Re(e,"b","maximumStrict");return dt(n.shape,r.shape,"Error in maximumStrict: "),Di(n,r)}}),Yo=Me({minimumStrict_:function(t,e){En("strict variants of ops have been deprecated and will be removed in future");const n=Re(t,"a","minimumStrict"),r=Re(e,"b","minimumStrict");return dt(n.shape,r.shape,"Error in minimumStrict: "),ls(n,r)}}),Ko=Me({modStrict_:function(t,e){En("strict variants of ops have been deprecated and will be removed in future");const n=Re(t,"a","modStrict"),r=Re(e,"b","modStrict");return dt(n.shape,r.shape,"Error in modStrict: "),us(n,r)}}),Xo=Me({mulStrict_:function(t,e){En("strict variants of ops have been deprecated and will be removed in future");const n=Re(t,"a","mul"),r=Re(e,"b","mul");return dt(n.shape,r.shape,"Error in multiplyStrict: "),Xn(n,r)}}),Zo=Me({powStrict_:function(t,e){return En("strict variants of ops have been deprecated and will be removed in future"),dt(t.shape,e.shape,"Error in powStrict: "),Es(t,e)}}),Qo=Me({squaredDifferenceStrict_:function(t,e){En("strict variants of ops have been deprecated and will be removed in future");const n=Re(t,"a","squaredDifferenceStrict"),r=Re(e,"b","squaredDifferenceStrict");return dt(n.shape,r.shape,"Error in squaredDifferenceStrict: "),xo(n,r)}}),Jo=Me({subStrict_:function(t,e){En("strict variants of ops have been deprecated and will be removed in future");const n=Re(t,"a","subStrict"),r=Re(e,"b","subStrict");return dt(n.shape,r.shape,"Error in subStrict: "),Gi(n,r)}}),ta=Me({norm_:function(t,e="euclidean",n=null,r=!1){const i=function t(e,n,r=null){if(0===e.rank)return $e(e);if(1!==e.rank&&null===r)return t(Ke(e,[-1]),n,r);if(1===e.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return Yi($e(e),r);if(n===1/0)return Hi($e(e),r);if(n===-1/0)return as($e(e),r);if("euclidean"===n||2===n)return bo(Yi(Es($e(e),Si(2,"int32")),r));throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return Hi(Yi($e(e),r[0]),r[1]-1);if(n===1/0)return Hi(Yi($e(e),r[1]),r[0]);if(n===-1/0)return as(Yi($e(e),r[1]),r[0]);if("fro"===n||"euclidean"===n)return bo(Yi(cs(e),r));throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(t=Re(t,"x","norm"),e,n);let s=i.shape;if(r){const e=Et(n,t.shape);s=We(i.shape,e)}return Ke(i,s)}}),ea=Me({movingAverage_:function(t,e,n,r,i=!0){const s=Re(t,"v","movingAverage"),o=Re(e,"x","movingAverage"),a=Re(n,"decay","movingAverage");xe(s,o),ht(yt(s.shape,o.shape),()=>"Shape mismatch in v and x");const l=Si(1),u=Gi(l,a);let c=Xn(Gi(o,s),u);if(i){ht(null!=r,()=>"When using zeroDebias: true, step is required.");const t=Re(r,"step","movingAverage");c=Hr(c,Gi(l,Es(a,t)))}return Le(s,c)}});function na(t,e,n){const r=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,s="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+`, indices.shape: ${e.shape}, shape: ${t}`+`, sliceDim: ${r}, and batchDim: ${i}.`;if(n.rank<i)throw new Error(s+` update.rank < ${i}. `);if(t.length<r+(n.rank-i))throw new Error(s+" Output shape length < "+(r+(n.rank-i)));if(n.rank!==i+t.length-r)throw new Error(s+" update.rank != "+(i+t.length-r));for(let o=0;o<i;++o)if(n.shape[o]!==e.shape[o])throw new Error(s+` updates.shape[${o}] (${n.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<n.rank-i;++o)if(n.shape[o+i]!==t[o+r])throw new Error(s+` updates.shape[${o+i}] (${n.shape[o+i]}) != shape[${o+i}] (${t[o+i]})`)}function ra(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if("int32"!==e.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===e.size)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(0===t.size)throw new Error("Updates specified for empty output. updates shape: "+t.shape)}na(n,e,t)}function ia(t,e,n){const r=e.shape.length,i=r>1?e.shape[r-1]:1,s=n.length;let o=1;for(let l=i;l<s;++l)o*=n[l];const a=i<1?1:i;return{sliceRank:i,numUpdates:mt(e.shape)/a,sliceSize:o,strides:[...jt(n.slice(0,i)),1],outputSize:mt(n)}}const sa=Me({scatterND_:function(t,e,n){const r=Re(t,"indices","scatterND","int32"),i=Re(e,"updates","scatterND");return ra(i,r,n),Ee.runKernelFunc(t=>t.scatterND(r,i,n),{indices:r,updates:i},null,"ScatterNd",{shape:n})}}),oa=Me({sparseToDense_:function(t,e,n,r=0){const i=Re(t,"sparseIndices","sparseToDense","int32"),s=Re(e,"sparseValues","sparseToDense"),o=Re(r,"defaultValue","sparseToDense",s.dtype);return function(t,e,n,r){if("int32"!==t.dtype)throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${t.shape}.`);const i=t.rank>0?t.shape[0]:1,s=t.rank>1?t.shape[1]:1;if(n.length!==s)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${s}.`);if(0!==e.rank&&(1!==e.rank||e.size!==i))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${i}]`);if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,s,n,o),Ee.runKernelFunc(t=>t.sparseToDense(i,s,n,o),{sparseIndices:i,sparseValues:s,defaultValue:o},null,"SparseToDense",{outputShape:n})}}),aa=Me({gatherND_:function(t,e){const n=Re(e,"indices","gatherND","int32"),r=Re(t,"x","gatherND");return Ee.runKernelFunc(t=>t.gatherND(r,n),{params:r,indices:n},null,"GatherNd")}}),la=Me({dropout_:function(t,e,n,r){const i=Re(t,"x","dropout");if(ht("float32"===i.dtype,()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${i.dtype} tensor instead.`),ht(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),0===e)return t instanceof ue?i.clone():i;const s=function(t,e){if(null==e)return t.shape.slice();if(yt(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let r=0;r<t.shape.length;r++)n.push(null==e[r]&&null!=t.shape[r]?t.shape[r]:e[r]);return n}return e}(i,n),o=1-e,a=Hr(ci(Le(Hs(s,0,1,"float32",r),o)),o);return Xn(i,a)}});function ua(t){return Math.floor(Math.pow(2,Math.ceil(Math.log(t)/Math.log(2))))}function ca(t,e,n){const r=1-t%2,i=new Float32Array(t);for(let s=0;s<t;++s){const o=2*Math.PI*s/(t+r-1);i[s]=e-n*Math.cos(o)}return Gs(i,"float32")}const ha=async function(t,e,n=1){const r=Re(t,"predictions","inTopK"),i=Re(e,"targets","inTopK");ht(r.rank>1,()=>"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank),ht(r.rank-1===i.rank,()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${r.rank} and targets rank ${i.rank}`),dt(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const s=r.shape[r.shape.length-1];ht(n>0&&n<=s,()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${s}), but got ${n}`);const o=await r.data(),a=await i.data(),[l,u]=[o.length/s,s],c=At("bool",l);for(let h=0;h<l;h++){const t=h*u,e=o.subarray(t,t+u),r=[];for(let n=0;n<e.length;n++)r.push({value:e[n],index:n});r.sort((t,e)=>e.value-t.value),c[h]=0;for(let i=0;i<n;i++)if(r[i].index===a[h]){c[h]=1;break}}return t!==r&&r.dispose(),e!==i&&i.dispose(),Gn(c,i.shape,"bool")},da=Me({conv2DBackpropFilter_:function(t,e,n,r,i,s="NHWC",o){let a=t;3===t.rank&&(a=Ke(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;3===l.rank&&(l=Ke(e,[1,e.shape[0],e.shape[1],e.shape[2]])),ht(4===a.rank,()=>"Error in conv2dDerFilter: input must be rank 4, but got shape "+a.shape+"."),ht(4===l.rank,()=>"Error in conv2dDerFilter: dy must be rank 4, but got shape "+l.shape+"."),ht(4===n.length,()=>"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+".");const u="NHWC"===s?a.shape[3]:a.shape[1],c="NHWC"===s?l.shape[3]:l.shape[1];return ht(u===n[2],()=>`Error in conv2dDerFilter: depth of input ${u}) must match input depth in filter (${n[2]}.`),ht(c===n[3],()=>`Error in conv2dDerFilter: depth of dy (${c}) must match output depth for filter (${n[3]}).`),null!=o&&ht(vt(i),()=>`Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode ${o} but got pad ${i}.`),Ee.runKernelFunc(t=>{const e=xn(s),u=hn(a.shape,n,r,1,i,o,!1,e);return t.conv2dDerFilter(a,l,u)},{x:a,dy:l},null,"Conv2DBackpropFilter",{strides:r,pad:i,dataFormat:s,dimRoundingMode:o})}});function fa(t,e,n){if(null==n||"linear"===n)return t;if("relu"===n)return Xn(t,So(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function pa(t,e){let n=e;const r=Yr(t.shape,e.shape);return r.length>0&&(n=Yi(n,r)),Ke(n,t.shape)}function ma(t,e,n){if("linear"===e)return t;if("relu"===e)return Xs(t);if("elu"===e)return ei(t);if("relu6"===e)return Zs(t);if("prelu"===e)return ks(t,n);throw new Error(`Unknown fused activation ${e}.`)}const ga=(t,e)=>!(t>0)||"linear"===e,ya=Me({fusedConv2d_:function({x:t,filter:e,strides:n,pad:r,dataFormat:i="NHWC",dilations:s=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:u}){if(!1===ga(Ee.state.gradientDepth,l=l||"linear")){let c=Or(t,e,n,r,i,s,o);return null!=a&&(c=Le(c,a)),ma(c,l,u)}const c=Re(t,"x","conv2d"),h=Re(e,"filter","conv2d");let d=c,f=!1;3===c.rank&&(f=!0,d=Ke(c,[1,c.shape[0],c.shape[1],c.shape[2]])),ht(4===d.rank,()=>"Error in fused conv2d: input must be rank 4, but got rank "+d.rank+"."),ht(4===h.rank,()=>"Error in fused conv2d: filter must be rank 4, but got rank "+h.rank+"."),null!=o&&ht(vt(r),()=>`Error in fused conv2d: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`),ht(d.shape[3]===h.shape[2],()=>`Error in conv2d: depth of input (${d.shape[3]}) must match input depth for filter ${h.shape[2]}.`),ht(bn(n,s),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`),ht("NHWC"===i,()=>`Error in conv2d: got dataFormat of ${i} but only NHWC is currently supported.`);const p=hn(d.shape,h.shape,n,s,r,o);let m,g;null!=a&&(m=Re(a,"bias","fused conv2d"),[m]=be(m,c),Kr(p.outShape,m.shape)),null!=u&&(g=Re(u,"prelu weights","fused conv2d"));const y=(t,e)=>{const[i,o,a,u]=e,c=fa(t,a,l);ht(vn(s),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const h=[Rr(o.shape,c,i,n,r),da(o,c,i.shape,n,r)];if(null!=u){const t=pa(u,c);h.push(t)}return h},v=t=>t.fusedConv2d({input:d,filter:h,convInfo:p,bias:m,activation:l,preluActivationWeights:g}),b={x:d,filter:h,bias:m,preluActivationWeights:g},x={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:o,activation:l};return null==a?ji((t,e,n)=>{let r=Ee.runKernelFunc(v,b,null,"FusedConv2D",x);return n([e,t,r]),f&&(r=Ke(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:y}})(d,h):ji((t,e,n,r)=>{let i=Ee.runKernelFunc(v,b,null,"FusedConv2D",x);return r([e,t,i,n]),f&&(i=Ke(i,[i.shape[1],i.shape[2],i.shape[3]])),{value:i,gradFunc:y}})(d,h,m)}}),va=Me({depthwiseConv2dNativeBackpropFilter_:function(t,e,n,r){let i=t;3===t.rank&&(i=Ke(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let s=e;return 3===s.rank&&(s=Ke(e,[1,e.shape[0],e.shape[1],e.shape[2]])),Ee.runKernelFunc(t=>t.depthwiseConv2DDerFilter(i,s,r),{x:i,dy:s},null,"DepthwiseConv2dNativeBackpropFilter")}}),ba=Me({depthwiseConv2dNativeBackpropInput_:function(t,e,n,r){let i=e,s=!1;3===e.rank&&(s=!0,i=Ke(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const o=Ee.runKernelFunc(t=>t.depthwiseConv2DDerInput(i,n,r),{dy:i},null,"DepthwiseConv2dNativeBackpropInput");return s?Ke(o,[o.shape[1],o.shape[2],o.shape[3]]):o}}),xa=Me({fusedDepthwiseConv2d_:function({x:t,filter:e,strides:n,pad:r,dataFormat:i="NHWC",dilations:s=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:u}){if(!1===ga(Ee.state.gradientDepth,l)){let c=Ur(t,e,n,r,i,s,o);return null!=a&&(c=Le(c,a)),ma(c,l,u)}const c=Re(t,"x","depthwiseConv2d"),h=Re(e,"filter","depthwiseConv2d");let d=c,f=!1;3===c.rank&&(f=!0,d=Ke(c,[1,c.shape[0],c.shape[1],c.shape[2]])),ht(4===d.rank,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${d.rank}.`),ht(4===h.rank,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${h.rank}.`),ht(d.shape[3]===h.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${d.shape[3]}) must match the inChannels dimension in filter ${h.shape[2]}.`),null==s&&(s=[1,1]),ht(bn(n,s),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`),null!=o&&ht(vt(r),()=>`Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode ${o} but got pad ${r}.`);const p=hn(d.shape,h.shape,n,s,r,o,!0);let m,g;null!=a&&(m=Re(a,"bias","fused conv2d"),[m]=be(m,c),Kr(p.outShape,m.shape)),null!=u&&(g=Re(u,"prelu weights","fused depthwiseConv2d"));const y=(t,e)=>{ht(vn(s),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${s}'`);const[n,r,i,o]=e,a=fa(t,i,l),u=ba(r.shape,a,n,p),c=va(r,a,n.shape,p);return null!=o?[u,c,pa(m,a)]:[u,c]},v=t=>t.fusedDepthwiseConv2D({input:d,filter:h,convInfo:p,bias:m,activation:l,preluActivationWeights:g}),b={x:d,filter:h,bias:m,preluActivationWeights:g},x={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:o,activation:l};return null==a?ji((t,e,n)=>{let r=Ee.runKernelFunc(v,b,null,"FusedDepthwiseConv2D",x);return n([e,t,r]),f&&(r=Ke(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:y}})(d,h):ji((t,e,n,r)=>{let i=Ee.runKernelFunc(v,b,null,"FusedDepthwiseConv2D",x);return r([e,t,i,n]),f&&(i=Ke(i,[i.shape[1],i.shape[2],i.shape[3]])),{value:i,gradFunc:y}})(d,h,m)}}),_a=Me({fusedMatMul_:function({a:t,b:e,transposeA:n=!1,transposeB:r=!1,bias:i,activation:s="linear",preluActivationWeights:o}){if(!1===ga(Ee.state.gradientDepth,s)){let a=Kn(t,e,n,r);return null!=i&&(a=Le(a,i)),ma(a,s,o)}let a=Re(t,"a","fused matMul"),l=Re(e,"b","fused matMul");[a,l]=be(a,l);const u=n?a.shape[a.rank-2]:a.shape[a.rank-1],c=r?l.shape[l.rank-1]:l.shape[l.rank-2],h=n?a.shape[a.rank-1]:a.shape[a.rank-2],d=r?l.shape[l.rank-2]:l.shape[l.rank-1],f=a.shape.slice(0,-2),p=l.shape.slice(0,-2),m=mt(f),g=mt(p);ht(a.rank>=2&&l.rank>=2&&a.rank===l.rank,()=>`Error in fused matMul: inputs must have the same rank of at least 2, got ranks ${a.rank} and ${l.rank}.`),ht(yt(f,p),()=>`Error in fused matMul: outer dimensions (${f}) and (${p}) of Tensors with shapes ${a.shape} and `+l.shape+" must match."),ht(u===c,()=>`Error in fused matMul: inner shapes (${u}) and (${c}) of Tensors with shapes ${a.shape} and ${l.shape} and transposeA=${n} and transposeB=${r} must match.`);const y=a.shape.slice(0,-2).concat([h,d]),v=Ke(a,n?[m,u,h]:[m,h,u]),b=Ke(l,r?[g,d,c]:[g,c,d]);let x,_;null!=i&&(x=Re(i,"bias","fused matMul"),[x]=be(x,a),Kr(y,x.shape)),null!=o&&(_=Re(o,"prelu weights","fused matMul"));const w=(t,e)=>{const[o,a,l,u]=e,c=fa(Ke(t,l.shape),l,s);let h,d;return n||r?!n&&r?(h=Kn(c,a,!1,!1),d=Kn(c,o,!0,!1)):n&&!r?(h=Kn(a,c,!1,!0),d=Kn(o,c,!1,!1)):(h=Kn(a,c,!0,!0),d=Kn(c,o,!0,!0)):(h=Kn(c,a,!1,!0),d=Kn(o,c,!0,!1)),null!=i?[h,d,pa(u,c)]:[h,d]},S=t=>t.fusedBatchMatMul({a:v,b,transposeA:n,transposeB:r,bias:x,activation:s,preluActivationWeights:_}),C={a:v,b,bias:x,preluActivationWeights:_},E={transposeA:n,transposeB:r,activation:s};return null==i?ji((t,e,n)=>{const r=Ee.runKernelFunc(S,C,null,"_FusedMatMul",E);return n([t,e,r]),{value:Ke(r,y),gradFunc:w}})(v,b):ji((t,e,n,r)=>{const i=Ee.runKernelFunc(S,C,null,"_FusedMatMul",E);return r([t,e,i,n]),{value:Ke(i,y),gradFunc:w}})(v,b,x)}}),wa=Me({hammingWindow_:function(t){return ca(t,.54,.46)}}),Sa=Me({hannWindow_:function(t){return ca(t,.5,.5)}}),Ca=Me({frame_:function(t,e,n,r=!1,i=0){let s=0;const o=[];for(;s+e<=t.size;)o.push(dr(t,s,e)),s+=n;if(r)for(;s<t.size;){const r=s+e-t.size,a=Yn([dr(t,s,e-r),ui([r],i)]);o.push(a),s+=n}return 0===o.length?ko([],[0,e]):Ke(Yn(o),[o.length,e])}}),Ea=Me({stft_:function(t,e,n,r,i=Sa){null==r&&(r=ua(e));const s=Ca(t,e,n),o=Xn(s,i(e)),a=[];for(let l=0;l<s.shape[0];l++)a.push(io(dr(o,[l,0],[1,e]),r));return Yn(a)}}),ka=Me({cropAndResize_:function(t,e,n,r,i,s){const o=Re(t,"image","cropAndResize"),a=Re(e,"boxes","cropAndResize","float32"),l=Re(n,"boxInd","cropAndResize","int32");i=i||"bilinear",s=s||0;const u=a.shape[0];return ht(4===o.rank,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),ht(2===a.rank&&4===a.shape[1],()=>`Error in cropAndResize: boxes must be have size [${u},4] but had shape ${a.shape}.`),ht(1===l.rank&&l.shape[0]===u,()=>`Error in cropAndResize: boxInd must be have size [${u}] but had shape ${a.shape}.`),ht(2===r.length,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`),ht(r[0]>=1&&r[1]>=1,()=>"cropSize must be atleast [1,1], but was "+r),ht("bilinear"===i||"nearest"===i,()=>"method must be bilinear or nearest, but was "+i),Ee.runKernelFunc(t=>t.cropAndResize(o,a,l,r,i,s),{image:o,boxes:a,boxInd:l},null,"CropAndResize",{method:i,extrapolationValue:s,cropSize:r})}}),Aa=Me({flipLeftRight_:function(t){const e=Re(t,"image","flipLeftRight","float32");return ht(4===e.rank,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`),Ee.runKernel("FlipLeftRight",{image:e},{})}}),Da=Me({rotateWithOffset_:function(t,e,n=0,r=.5){const i=Re(t,"image","rotateWithOffset","float32");return ht(4===i.rank,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${i.rank}.`),Ee.runKernel("RotateWithOffset",{image:i},{radians:e,fillValue:n,center:r})}});function Na(t,e,n,r,i,s){null==r&&(r=.5),null==i&&(i=Number.NEGATIVE_INFINITY),null==s&&(s=0);const o=t.shape[0];return n=Math.min(n,o),ht(0<=r&&r<=1,()=>`iouThreshold must be in [0, 1], but was '${r}'`),ht(2===t.rank,()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`),ht(4===t.shape[1],()=>"boxes must have 4 columns, but 2nd dimension was "+t.shape[1]),ht(1===e.rank,()=>"scores must be a 1D tensor"),ht(e.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was `+e.shape[0]),ht(0<=s&&s<=1,()=>`softNmsSigma must be in [0, 1], but was '${s}'`),{maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:s}}const Ta=Me({nonMaxSuppression_:function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY){const s=Re(t,"boxes","nonMaxSuppression"),o=Re(e,"scores","nonMaxSuppression"),a=Na(s,o,n,r,i);return Ee.runKernelFunc(t=>t.nonMaxSuppression(s,o,n,r,i),{boxes:s,scores:o},null,"NonMaxSuppressionV3",{maxOutputSize:n=a.maxOutputSize,iouThreshold:r=a.iouThreshold,scoreThreshold:i=a.scoreThreshold})}});function Oa(t,e,n){const r=function(t,e,n){return function(t,e,n){let r=0,i=t.length,s=0,o=!1;for(;r<i;){s=r+(i-r>>>1);const a=n(e,t[s]);a>0?r=s+1:(i=s,o=!a)}return o?r:-r-1}(t,e,n||Ia)}(t,e,n);t.splice(r<0?-(r+1):r,0,e)}function Ia(t,e){return t>e?1:t<e?-1:0}function Ra(t,e,n,r,i){return $a(t,e,n,r,i,0).selectedIndices}function Fa(t,e,n,r,i,s){return $a(t,e,n,r,i,0,!1,s,!0)}function Ma(t,e,n,r,i,s){return $a(t,e,n,r,i,s,!0)}function $a(t,e,n,r,i,s,o=!1,a=!1,l=!1){const u=[];for(let g=0;g<e.length;g++)e[g]>i&&u.push({score:e[g],boxIndex:g,suppressBeginIndex:0});u.sort(La);const c=s>0?-.5/s:0,h=[],d=[];for(;h.length<n&&u.length>0;){const e=u.pop(),{score:n,boxIndex:s,suppressBeginIndex:o}=e;if(n<i)break;let a=!1;for(let l=h.length-1;l>=o;--l){const n=Pa(t,s,h[l]);if(n>=r){a=!0;break}if(e.score=e.score*za(r,c,n),e.score<=i)break}e.suppressBeginIndex=h.length,a||(e.score===n?(h.push(s),d.push(e.score)):e.score>i&&Oa(u,e,La))}const f=h.length,p=n-f;a&&p>0&&(h.push(...new Array(p).fill(0)),d.push(...new Array(p).fill(0)));const m={selectedIndices:Gs(h,"int32")};return o&&(m.selectedScores=Gs(d,"float32")),l&&(m.validOutputs=Si(f,"int32")),m}function Pa(t,e,n){const r=t.subarray(4*e,4*e+4),i=t.subarray(4*n,4*n+4),s=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),l=Math.max(r[1],r[3]),u=Math.min(i[0],i[2]),c=Math.min(i[1],i[3]),h=Math.max(i[0],i[2]),d=Math.max(i[1],i[3]),f=(a-s)*(l-o),p=(h-u)*(d-c);if(f<=0||p<=0)return 0;const m=Math.max(s,u),g=Math.max(o,c),y=Math.min(a,h),v=Math.min(l,d),b=Math.max(y-m,0)*Math.max(v-g,0);return b/(f+p-b)}function za(t,e,n){const r=Math.exp(e*n*n);return n<=t?r:0}function La(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}const Ba=Me({nonMaxSuppressionWithScore_:function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY,s=0){const o=Re(t,"boxes","nonMaxSuppression"),a=Re(e,"scores","nonMaxSuppression"),l=Na(o,a,n,r,i,s),u=Ee.runKernel("NonMaxSuppressionV5",{boxes:o,scores:a},{maxOutputSize:n=l.maxOutputSize,iouThreshold:r=l.iouThreshold,scoreThreshold:i=l.scoreThreshold,softNmsSigma:s=l.softNmsSigma});return{selectedIndices:u[0],selectedScores:u[1]}}}),ja=Me({nonMaxSuppressionPadded_:function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY,s=!1){const o=Re(t,"boxes","nonMaxSuppression"),a=Re(e,"scores","nonMaxSuppression"),l=Na(o,a,n,r,i,null),u=Ee.runKernel("NonMaxSuppressionV4",{boxes:o,scores:a},{maxOutputSize:l.maxOutputSize,iouThreshold:l.iouThreshold,scoreThreshold:l.scoreThreshold,padToMaxOutputSize:s});return{selectedIndices:u[0],validOutputs:u[1]}}}),Ua=Me({resizeBilinear_:function(t,e,n=!1){const r=Re(t,"images","resizeBilinear");ht(3===r.rank||4===r.rank,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),ht(2===e.length,()=>"Error in resizeBilinear: new shape must 2D, but got shape "+e+".");let i=r,s=!1;3===r.rank&&(s=!0,i=Ke(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const[o,a]=e,l=Ee.runKernelFunc((t,e)=>(e([i]),t.resizeBilinear(i,o,a,n)),{images:i},null,"ResizeBilinear",{alignCorners:n,size:e});return s?Ke(l,[l.shape[1],l.shape[2],l.shape[3]]):l}}),Va=Me({resizeNearestNeighbor_:function(t,e,n=!1){const r=Re(t,"images","resizeNearestNeighbor");ht(3===r.rank||4===r.rank,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),ht(2===e.length,()=>"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."),ht("float32"===r.dtype||"int32"===r.dtype,()=>"`images` must have `int32` or `float32` as dtype");let i=r,s=!1;3===r.rank&&(s=!0,i=Ke(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const[o,a]=e,l=Ee.runKernelFunc((t,e)=>(e([i]),t.resizeNearestNeighbor(i,o,a,n)),{images:i},null,"ResizeNearestNeighbor",{alignCorners:n,size:e});return s?Ke(l,[l.shape[1],l.shape[2],l.shape[3]]):l}}),Wa=Me({bandPart_:function(t,e,n){ht(e%1==0,()=>`bandPart(): numLower must be an integer, got ${e}.`),ht(n%1==0,()=>`bandPart(): numUpper must be an integer, got ${n}.`);const r=Re(t,"a","bandPart");ht(r.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`);const i=r.shape,[s,o]=r.shape.slice(-2);if(!(e<=s))throw new Error(`bandPart(): numLower (${e}) must not be greater than the number of rows (${s}).`);if(!(n<=o))throw new Error(`bandPart(): numUpper (${n}) must not be greater than the number of columns (${o}).`);e<0&&(e=s),n<0&&(n=o);const a=Ke(Ys(0,s,1,"int32"),[-1,1]),l=Ys(0,o,1,"int32"),u=Gi(a,l),c=Zi(Oi(u,Si(+e,"int32")),vi(u,Si(-n,"int32"))),h=is([s,o],r.dtype);return Ke(wo(Fo(Ke(r,[-1,s,o])).map(t=>Zr(c,t,h))),i)}}),qa=Me({gramSchmidt_:function(t){let e;if(Array.isArray(t)){e=!1,ht(null!=t&&t.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const n=t[0].shape[0];for(let e=1;e<t.length;++e)ht(t[e].shape[0]===n,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[e].shape[0]} vs. ${n})`)}else e=!0,t=ro(t,t.shape[0],0).map(t=>_o(t,[0]));ht(t.length<=t[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`);const n=[],r=t;for(let i=0;i<t.length;++i)n.push(Ee.tidy(()=>{let t=r[i];if(i>0)for(let e=0;e<i;++e){const r=Xn(Yi(Xn(n[e],t)),n[e]);t=Gi(t,r)}return Hr(t,ta(t,"euclidean"))}));return e?wo(n,0):n}});function Ha(t,e=!1){return Ee.tidy(()=>{ht(2===t.shape.length,()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`);const n=t.shape[0],r=t.shape[1];let i=ai(n),s=_r(t);const o=ko([[1]],[1,1]);let a=_r(o);const l=n>=r?r:n;for(let t=0;t<l;++t){const e=s,l=a,u=i;[a,s,i]=Ee.tidy(()=>{const e=dr(s,[t,t],[n-t,1]),l=ta(e),u=dr(s,[t,t],[1,1]),c=Zr(yi(u,0),ko([[-1]]),ko([[1]])),h=Gi(u,Xn(c,l)),d=Hr(e,h);a=1===d.shape[0]?_r(o):Yn([o,dr(d,[1,0],[d.shape[0]-1,d.shape[1]])],0);const f=Vi(Hr(Kn(c,h),l)),p=dr(s,[t,0],[n-t,r]),m=Xn(f,a),g=Xe(a);if(0===t)s=Gi(p,Kn(m,Kn(g,p)));else{const e=Gi(p,Kn(m,Kn(g,p)));s=Yn([dr(s,[0,0],[t,r]),e],0)}const y=Xe(m),v=dr(i,[0,t],[n,i.shape[1]-t]);if(0===t)i=Gi(v,Kn(Kn(v,a),y));else{const e=Gi(v,Kn(Kn(v,a),y));i=Yn([dr(i,[0,0],[n,t]),e],1)}return[a,s,i]}),On([e,l,u])}return!e&&n>r&&(i=dr(i,[0,0],[n,r]),s=dr(s,[0,0],[r,r])),[i,s]})}const Ga=Me({qr_:function(t,e=!1){if(ht(t.rank>=2,()=>"qr() requires input tensor to have a rank >= 2, but got rank "+t.rank),2===t.rank)return Ha(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce((t,e)=>t*e),r=Fo(Ke(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),i=[],s=[];return r.forEach(t=>{const[n,r]=Ha(t,e);i.push(n),s.push(r)}),[Ke(wo(i,0),t.shape),Ke(wo(s,0),t.shape)]}}});var Ya;!function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Ya||(Ya={}));const Ka=Me({computeWeightedLoss_:function(t,e,n=Ya.SUM_BY_NONZERO_WEIGHTS){const r=Re(t,"losses","computeWeightedLoss");let i=null;null!=e&&(i=Re(e,"weights","computeWeightedLoss"));const s=null==i?r:Xn(r,i);if(n===Ya.NONE)return s;if(n===Ya.SUM)return Yi(s);if(n===Ya.MEAN){if(null==i)return os(s);{const t=r.size/i.size,e=Hr(Yi(s),Yi(i));return t>1?Hr(e,Si(t)):e}}if(n===Ya.SUM_BY_NONZERO_WEIGHTS){if(null==i)return Hr(Yi(s),Si(r.size));{const t=Xn(i,ss(r.shape)),e=an(Yi(ps(t,Si(0))),"float32");return Hr(Yi(s),e)}}throw Error("Unknown reduction: "+n)}}),Xa=Me({absoluteDifference_:function(t,e,n,r=Ya.SUM_BY_NONZERO_WEIGHTS){const i=Re(t,"labels","absoluteDifference"),s=Re(e,"predictions","absoluteDifference");let o=null;null!=n&&(o=Re(n,"weights","absoluteDifference")),dt(i.shape,s.shape,"Error in absoluteDifference: ");const a=$e(Gi(i,s));return Ka(a,o,r)}}),Za=Me({cosineDistance_:function(t,e,n,r,i=Ya.SUM_BY_NONZERO_WEIGHTS){const s=Re(t,"labels","cosineDistance"),o=Re(e,"predictions","cosineDistance");let a=null;null!=r&&(a=Re(r,"weights","cosineDistance")),dt(s.shape,o.shape,"Error in cosineDistance: ");const l=Si(1),u=Gi(l,Yi(Xn(s,o),n,!0));return Ka(u,a,i)}}),Qa=Me({hingeLoss_:function(t,e,n,r=Ya.SUM_BY_NONZERO_WEIGHTS){let i=Re(t,"labels","hingeLoss");const s=Re(e,"predictions","hingeLoss");let o=null;null!=n&&(o=Re(n,"weights","hingeLoss")),dt(i.shape,s.shape,"Error in hingeLoss: ");const a=Si(1);i=Gi(Xn(Si(2),i),a);const l=Xs(Gi(a,Xn(i,s)));return Ka(l,o,r)}}),Ja=Me({huberLoss_:function(t,e,n,r=1,i=Ya.SUM_BY_NONZERO_WEIGHTS){const s=Re(t,"labels","huberLoss"),o=Re(e,"predictions","huberLoss");let a=null;null!=n&&(a=Re(n,"weights","huberLoss")),dt(s.shape,o.shape,"Error in huberLoss: ");const l=Si(r),u=$e(Gi(o,s)),c=ls(u,l),h=Gi(u,c),d=Le(Xn(Si(.5),cs(c)),Xn(l,h));return Ka(d,a,i)}}),tl=Me({logLoss_:function(t,e,n,r=1e-7,i=Ya.SUM_BY_NONZERO_WEIGHTS){const s=Re(t,"labels","logLoss"),o=Re(e,"predictions","logLoss");let a=null;null!=n&&(a=Re(n,"weights","logLoss")),dt(s.shape,o.shape,"Error in logLoss: ");const l=Si(1),u=Si(r),c=Vi(Xn(s,Fi(Le(o,u)))),h=Xn(Gi(l,s),Fi(Le(Gi(l,o),u))),d=Gi(c,h);return Ka(d,a,i)}}),el=Me({meanSquaredError_:function(t,e,n,r=Ya.SUM_BY_NONZERO_WEIGHTS){const i=Re(t,"labels","meanSquaredError"),s=Re(e,"predictions","meanSquaredError");let o=null;null!=n&&(o=Re(n,"weights","meanSquaredError")),dt(i.shape,s.shape,"Error in meanSquaredError: ");const a=xo(i,s);return Ka(a,o,r)}}),nl=Me({sigmoidCrossEntropy_:function(t,e,n,r=0,i=Ya.SUM_BY_NONZERO_WEIGHTS){let s=Re(t,"multiClassLabels","sigmoidCrossEntropy");const o=Re(e,"logits","sigmoidCrossEntropy");let a=null;if(null!=n&&(a=Re(n,"weights","sigmoidCrossEntropy")),dt(s.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){const t=Si(r),e=Si(1),n=Si(.5);s=Le(Xn(s,Gi(e,t)),Xn(n,t))}const l=function(t,e){const n=Re(t,"labels","sigmoidCrossEntropyWithLogits"),r=Re(e,"logits","sigmoidCrossEntropyWithLogits");dt(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");const i=Xs(r),s=Xn(r,n),o=Mi(ri(Vi($e(r))));return Le(Gi(i,s),o)}(s,o);return Ka(l,a,i)}}),rl=Me({softmaxCrossEntropy_:function(t,e,n,r=0,i=Ya.SUM_BY_NONZERO_WEIGHTS){let s=Re(t,"onehotLabels","softmaxCrossEntropy");const o=Re(e,"logits","softmaxCrossEntropy");let a=null;if(null!=n&&(a=Re(n,"weights","softmaxCrossEntropy")),dt(s.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){const t=Si(r),e=Si(1),n=Si(s.shape[1]);s=Le(Xn(s,Gi(e,t)),Hr(t,n))}const l=function(t,e,n=-1){if(-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was `+n);return ji((t,e,r)=>{const i=Xi(e,[n],!0),s=Gi(an(e,"float32"),i);r([t,s]);const o=Vi(Xn(s,t));return{value:Yi(o,[n]),gradFunc:(t,e)=>{const[r,i]=e,s=We(t.shape,[n]);return[Xn(Ke(t,s),Gi(an(r,"float32"),ri(i))),Xn(Ke(t,s),Gi(ri(i),an(r,"float32")))]}}})(t,e)}(s,o);return Ka(l,a,i)}}),il={fft:li,ifft:bi,rfft:io,irfft:Ci},sl={hammingWindow:wa,hannWindow:Sa,frame:Ca,stft:Ea},ol={flipLeftRight:Aa,resizeNearestNeighbor:Va,resizeBilinear:Ua,rotateWithOffset:Da,cropAndResize:ka,nonMaxSuppression:Ta,nonMaxSuppressionAsync:async function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY){const s=Re(t,"boxes","nonMaxSuppressionAsync"),o=Re(e,"scores","nonMaxSuppressionAsync"),a=Na(s,o,n,r,i);n=a.maxOutputSize,r=a.iouThreshold,i=a.scoreThreshold;const l=await Promise.all([s.data(),o.data()]),u=Ra(l[0],l[1],n,r,i);return s!==t&&s.dispose(),o!==e&&o.dispose(),u},nonMaxSuppressionWithScore:Ba,nonMaxSuppressionWithScoreAsync:async function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY,s=0){const o=Re(t,"boxes","nonMaxSuppressionAsync"),a=Re(e,"scores","nonMaxSuppressionAsync"),l=Na(o,a,n,r,i,s);n=l.maxOutputSize,r=l.iouThreshold,i=l.scoreThreshold,s=l.softNmsSigma;const u=await Promise.all([o.data(),a.data()]),c=Ma(u[0],u[1],n,r,i,s);return o!==t&&o.dispose(),a!==e&&a.dispose(),c},nonMaxSuppressionPadded:ja,nonMaxSuppressionPaddedAsync:async function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY,s=!1){const o=Re(t,"boxes","nonMaxSuppressionAsync"),a=Re(e,"scores","nonMaxSuppressionAsync"),l=Na(o,a,n,r,i,null),u=l.maxOutputSize,c=l.iouThreshold,h=l.scoreThreshold,[d,f]=await Promise.all([o.data(),a.data()]),p=Fa(d,f,u,c,h,s);return o!==t&&o.dispose(),a!==e&&a.dispose(),p}},al={bandPart:Wa,gramSchmidt:qa,qr:Ga},ll={absoluteDifference:Xa,computeWeightedLoss:Ka,cosineDistance:Za,hingeLoss:Qa,huberLoss:Ja,logLoss:tl,meanSquaredError:el,sigmoidCrossEntropy:nl,softmaxCrossEntropy:rl};ae=h;const ul={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};async function cl(t,e){const n=[],r=[],i=Array.isArray(t)?t.map(t=>t.name):Object.keys(t);for(let s=0;s<i.length;++s){const o=i[s],a=Array.isArray(t)?t[s].tensor:t[o];if("float32"!==a.dtype&&"int32"!==a.dtype&&"bool"!==a.dtype&&"string"!==a.dtype&&"complex64"!==a.dtype)throw new Error(`Unsupported dtype in weight '${o}': ${a.dtype}`);const l={name:o,shape:a.shape,dtype:a.dtype};if("string"===a.dtype){const t=new Promise(async t=>{const e=await a.bytes(),n=e.reduce((t,e)=>t+e.length,0)+4*e.length,r=new Uint8Array(n);let i=0;for(let s=0;s<e.length;s++){const t=e[s],n=new Uint8Array(new Uint32Array([t.length]).buffer);r.set(n,i),i+=4,r.set(t,i),i+=t.length}t(r)});r.push(t)}else r.push(a.data());null!=e&&(l.group=e),n.push(l)}return{data:dl(await Promise.all(r)),specs:n}}function hl(t,e){const n={};let r,i=0;for(const s of e){const e=s.name,o=s.dtype,a=s.shape,l=mt(a);let u;if("quantization"in s){const n=s.quantization;if("uint8"===n.dtype||"uint16"===n.dtype){if(!("min"in n)||!("scale"in n))throw new Error(`Weight ${s.name} with quantization ${n.dtype} doesn't have corresponding metadata min and scale.`)}else{if("float16"!==n.dtype)throw new Error(`Weight ${s.name} has unknown quantization dtype ${n.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);if("float32"!==o)throw new Error(`Weight ${s.name} is quantized with ${n.dtype} which only supports weights of type float32 not ${o}.`)}const a=ul[n.dtype],c=t.slice(i,i+l*a),h="uint8"===n.dtype?new Uint8Array(c):new Uint16Array(c);if("float32"===o)if("uint8"===n.dtype||"uint16"===n.dtype){u=new Float32Array(h.length);for(let t=0;t<h.length;t++)u[t]=h[t]*n.scale+n.min}else{if("float16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type float32.`);void 0===r&&(r=vl()),u=r(h)}else{if("int32"!==o)throw new Error(`Unsupported dtype in weight '${e}': ${o}`);if("uint8"!==n.dtype&&"uint16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type int32.`);u=new Int32Array(h.length);for(let t=0;t<h.length;t++)u[t]=Math.round(h[t]*n.scale+n.min)}i+=l*a}else if("string"===o){const e=mt(s.shape);u=[];for(let n=0;n<e;n++){const e=new Uint32Array(t.slice(i,i+4))[0];i+=4;const n=new Uint8Array(t.slice(i,i+e));u.push(n),i+=e}}else{const r=ul[o],s=t.slice(i,i+l*r);if("float32"===o)u=new Float32Array(s);else if("int32"===o)u=new Int32Array(s);else if("bool"===o)u=new Uint8Array(s);else{if("complex64"!==o)throw new Error(`Unsupported dtype in weight '${e}': ${o}`);{u=new Float32Array(s);const t=new Float32Array(u.length/2),r=new Float32Array(u.length/2);for(let e=0;e<t.length;e++)t[e]=u[2*e],r[e]=u[2*e+1];const i=Gn(t,a,"float32"),o=Gn(r,a,"float32");n[e]=kr(i,o)}}i+=l*r}"complex64"!==o&&(n[e]=Gn(u,a,o))}return n}function dl(t){if(null===t)throw new Error("Invalid input value: "+JSON.stringify(t));let e=0;const n=[];t.forEach(t=>{if(e+=t.byteLength,n.push(t.byteLength===t.buffer.byteLength?t:new t.constructor(t)),!(t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+t.constructor.name)});const r=new Uint8Array(e);let i=0;return n.forEach(t=>{r.set(new Uint8Array(t.buffer),i),i+=t.byteLength}),r.buffer}const fl="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function pl(t){return fl?Buffer.byteLength(t):new Blob([t]).size}function ml(t){if(1===t.length)return t[0];let e=0;t.forEach(t=>{e+=t.byteLength});const n=new Uint8Array(e);let r=0;return t.forEach(t=>{n.set(new Uint8Array(t),r),r+=t.byteLength}),n.buffer}function gl(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);const e=t.split("/");return e[e.length-1]}function yl(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:pl(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:pl(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}function vl(){const t=function(){const t=t=>{let e=t<<13,n=0;for(;0==(8388608&e);)n-=8388608,e<<=1;return e&=-8388609,n+=947912704,e|n},e=new Uint32Array(2048);e[0]=0;for(let n=1;n<1024;n++)e[n]=t(n);for(let n=1024;n<2048;n++)e[n]=939524096+(n-1024<<13);return e}(),e=function(){const t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}(),n=function(){const t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}();return r=>{const i=new ArrayBuffer(4*r.length),s=new Uint32Array(i);for(let o=0;o<r.length;o++){const i=r[o];s[o]=t[n[i>>10]+(1023&i)]+e[i>>10]}return new Float32Array(i)}}class bl{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==bl.instance&&(bl.instance=new bl),bl.instance}static registerSaveRouter(t){bl.getInstance().saveRouters.push(t)}static registerLoadRouter(t){bl.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return bl.getHandlers(t,"save")}static getLoadHandlers(t,e){return bl.getHandlers(t,"load",e)}static getHandlers(t,e,n){const r=[];return("load"===e?bl.getInstance().loadRouters:bl.getInstance().saveRouters).forEach(e=>{const i=e(t,n);null!==i&&r.push(i)}),r}}const xl=t=>bl.registerSaveRouter(t),_l=t=>bl.registerLoadRouter(t),wl=t=>bl.getSaveHandlers(t),Sl=(t,e)=>bl.getLoadHandlers(t,e);class Cl{constructor(){this.managers={}}static getInstance(){return null==Cl.instance&&(Cl.instance=new Cl),Cl.instance}static registerManager(t,e){ht(null!=t,()=>"scheme must not be undefined or null."),t.endsWith("://")&&(t=t.slice(0,t.indexOf("://"))),ht(t.length>0,()=>"scheme must not be an empty string.");const n=Cl.getInstance();ht(null==n.managers[t],()=>`A model store manager is already registered for scheme '${t}'.`),n.managers[t]=e}static getManager(t){const e=this.getInstance().managers[t];if(null==e)throw new Error(`Cannot find model manager for scheme '${t}'`);return e}static getSchemes(){return Object.keys(this.getInstance().managers)}}function El(t){if(-1===t.indexOf("://"))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Cl.getSchemes().join(","));return{scheme:t.split("://")[0],path:t.split("://")[1]}}async function kl(t,e,n=!1){ht(t!==e,()=>`Old path and new path are the same: '${t}'`);const r=bl.getLoadHandlers(t);ht(r.length>0,()=>`Copying failed because no load handler is found for source URL ${t}.`),ht(r.length<2,()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${t}.`);const i=r[0],s=bl.getSaveHandlers(e);ht(s.length>0,()=>`Copying failed because no save handler is found for destination URL ${e}.`),ht(s.length<2,()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${e}.`);const o=s[0],a=El(t).scheme,l=El(t).path,u=a===El(t).scheme,c=await i.load();n&&u&&await Cl.getManager(a).removeModel(l);const h=await o.save(c);return n&&!u&&await Cl.getManager(a).removeModel(l),h.modelArtifactsInfo}async function Al(){const t=Cl.getSchemes(),e={};for(const n of t){const t=await Cl.getManager(n).listModels();for(const r in t)e[n+"://"+r]=t[r]}return e}async function Dl(t){const e=El(t);return Cl.getManager(e.scheme).removeModel(e.path)}async function Nl(t,e){return kl(t,e,!1)}async function Tl(t,e){return kl(t,e,!0)}function Ol(){if(!W().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t="undefined"==typeof window?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function Il(t){const e=t.result;e.createObjectStore("models_store",{keyPath:"modelPath"}),e.createObjectStore("model_info_store",{keyPath:"modelPath"})}class Rl{constructor(t){if(this.indexedDB=Ol(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,t)}async load(){return this.databaseAction(this.modelPath)}databaseAction(t,e){return new Promise((t,n)=>{const r=this.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=()=>Il(r),r.onsuccess=()=>{const i=r.result;if(null==e){const e=i.transaction("models_store","readonly"),r=e.objectStore("models_store").get(this.modelPath);r.onsuccess=()=>{if(null==r.result)return i.close(),n(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));t(r.result.modelArtifacts)},r.onerror=t=>(i.close(),n(r.error)),e.oncomplete=()=>i.close()}else{const r=yl(e),s=i.transaction("model_info_store","readwrite");let o=s.objectStore("model_info_store");const a=o.put({modelPath:this.modelPath,modelArtifactsInfo:r});let l;a.onsuccess=()=>{l=i.transaction("models_store","readwrite");const a=l.objectStore("models_store").put({modelPath:this.modelPath,modelArtifacts:e,modelArtifactsInfo:r});a.onsuccess=()=>t({modelArtifactsInfo:r}),a.onerror=t=>{o=s.objectStore("model_info_store");const e=o.delete(this.modelPath);e.onsuccess=()=>(i.close(),n(a.error)),e.onerror=t=>(i.close(),n(a.error))}},a.onerror=t=>(i.close(),n(a.error)),s.oncomplete=()=>{null==l?i.close():l.oncomplete=()=>i.close()}}},r.onerror=t=>n(r.error)})}}Rl.URL_SCHEME="indexeddb://";const Fl=t=>{return W().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Rl.URL_SCHEME)?(e=t.slice(Rl.URL_SCHEME.length),new Rl(e)):null;var e};bl.registerSaveRouter(Fl),bl.registerLoadRouter(Fl);class Ml{constructor(){this.indexedDB=Ol()}async listModels(){return new Promise((t,e)=>{const n=this.indexedDB.open("tensorflowjs",1);n.onupgradeneeded=()=>Il(n),n.onsuccess=()=>{const r=n.result,i=r.transaction("model_info_store","readonly"),s=i.objectStore("model_info_store").getAll();s.onsuccess=()=>{const e={};for(const t of s.result)e[t.modelPath]=t.modelArtifactsInfo;t(e)},s.onerror=t=>(r.close(),e(s.error)),i.oncomplete=()=>r.close()},n.onerror=t=>e(n.error)})}async removeModel(t){var e;return t=(e=t).startsWith(Rl.URL_SCHEME)?e.slice(Rl.URL_SCHEME.length):e,new Promise((e,n)=>{const r=this.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=()=>Il(r),r.onsuccess=()=>{const i=r.result,s=i.transaction("model_info_store","readwrite"),o=s.objectStore("model_info_store"),a=o.get(t);let l;a.onsuccess=()=>{if(null==a.result)return i.close(),n(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{const r=o.delete(t),s=()=>{l=i.transaction("models_store","readwrite");const r=l.objectStore("models_store").delete(t);r.onsuccess=()=>e(a.result.modelArtifactsInfo),r.onerror=t=>n(a.error)};r.onsuccess=s,r.onerror=t=>(s(),i.close(),n(a.error))}},a.onerror=t=>(i.close(),n(a.error)),s.oncomplete=()=>{null==l?i.close():l.oncomplete=()=>i.close()}},r.onerror=t=>n(r.error)})}}if(W().getBool("IS_BROWSER"))try{Cl.registerManager(Rl.URL_SCHEME,new Ml)}catch(MC){}const $l="tensorflowjs_models",Pl="info",zl="model_topology",Ll="weight_specs",Bl="weight_data",jl="model_metadata";function Ul(t){return{info:[$l,t,Pl].join("/"),topology:[$l,t,zl].join("/"),weightSpecs:[$l,t,Ll].join("/"),weightData:[$l,t,Bl].join("/"),modelMetadata:[$l,t,jl].join("/")}}function Vl(t){const e=t.split("/");if(e.length<3)throw new Error("Invalid key format: "+t);return e.slice(1,e.length-1).join("/")}class Wl{constructor(t){if(!W().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=Ul(this.modelPath)}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),r=yl(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(t){if(fl)return Buffer.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let r=0,i=e.length;r<i;r++)n+=String.fromCharCode(e[r]);return btoa(n)}(t.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata})),{modelArtifactsInfo:r}}catch(MC){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const t=JSON.parse(this.LS.getItem(this.keys.info));if(null==t)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const e={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);e.modelTopology=n;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==r)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);e.weightSpecs=r;const i=this.LS.getItem(this.keys.modelMetadata);if(null!=i){const t=JSON.parse(i);e.format=t.format,e.generatedBy=t.generatedBy,e.convertedBy=t.convertedBy,e.userDefinedMetadata=t.userDefinedMetadata}const s=this.LS.getItem(this.keys.weightData);if(null==s)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return e.weightData=function(t){if(fl){const e=Buffer.from(t,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let r=0;r<e.length;++r)n.set([e.charCodeAt(r)],r);return n.buffer}(s),e}}Wl.URL_SCHEME="localstorage://";const ql=t=>{return W().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Wl.URL_SCHEME)?(e=t.slice(Wl.URL_SCHEME.length),new Wl(e)):null;var e};bl.registerSaveRouter(ql),bl.registerLoadRouter(ql);class Hl{constructor(){ht(W().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),ht("undefined"==typeof window||void 0!==window.localStorage,()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const t={},e=$l+"/",n="/"+Pl;for(let r=0;r<this.LS.length;++r){const i=this.LS.key(r);i.startsWith(e)&&i.endsWith(n)&&(t[Vl(i)]=JSON.parse(this.LS.getItem(i)))}return t}async removeModel(t){var e;const n=Ul(t=(e=t).startsWith(Wl.URL_SCHEME)?e.slice(Wl.URL_SCHEME.length):e);if(null==this.LS.getItem(n.info))throw new Error(`Cannot find model at path '${t}'`);const r=JSON.parse(this.LS.getItem(n.info));return this.LS.removeItem(n.info),this.LS.removeItem(n.topology),this.LS.removeItem(n.weightSpecs),this.LS.removeItem(n.weightData),r}}if(W().getBool("IS_BROWSER"))try{Cl.registerManager(Wl.URL_SCHEME,new Hl)}catch(MC){}function Gl(t){return new Promise(t=>setTimeout(t)).then(t)}class Yl{constructor(t){if(!W().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(Yl.URL_SCHEME)&&(t=t.slice(Yl.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelTopologyFileName=t+".json",this.weightDataFileName=t+".weights.bin"}async save(t){if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");const e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"}));if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const n=window.URL.createObjectURL(new Blob([JSON.stringify({modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}]})],{type:"application/json"})),r=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor;if(r.download=this.modelTopologyFileName,r.href=n,await Gl(()=>r.dispatchEvent(new MouseEvent("click"))),null!=t.weightData){const t=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor;t.download=this.weightDataFileName,t.href=e,await Gl(()=>t.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:yl(t)}}}}Yl.URL_SCHEME="downloads://";class Kl{constructor(t){if(null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}async load(){const t=this.files[0],e=this.files.slice(1);return new Promise((n,r)=>{const i=new FileReader;i.onload=i=>{const s=JSON.parse(i.target.result),o=s.modelTopology;if(null==o)return void r(new Error("modelTopology field is missing from file "+t.name));0===e.length&&n({modelTopology:o});const a=s.weightsManifest;if(null==a)return void r(new Error("weightManifest field is missing from file "+t.name));let l;try{l=this.checkManifestAndWeightFiles(a,e)}catch(MC){return void r(MC)}const u=[],c=[],h=[];a.forEach(t=>{t.paths.forEach(t=>{c.push(t),h.push(null)}),u.push(...t.weights)}),a.forEach(t=>{t.paths.forEach(t=>{const e=new FileReader;e.onload=e=>{const r=e.target.result,i=c.indexOf(t);h[i]=r,-1===h.indexOf(null)&&n({modelTopology:o,weightSpecs:u,weightData:ml(h),format:s.format,generatedBy:s.generatedBy,convertedBy:s.convertedBy,userDefinedMetadata:s.userDefinedMetadata})},e.onerror=e=>r(`Failed to weights data from file of path '${t}'.`),e.readAsArrayBuffer(l[t])})})},i.onerror=e=>r(`Failed to read model topology and weights manifest JSON from file '${t.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),i.readAsText(t)})}checkManifestAndWeightFiles(t,e){const n=[],r=e.map(t=>gl(t.name)),i={};for(const s of t)s.paths.forEach(t=>{const s=gl(t);if(-1!==n.indexOf(s))throw new Error(`Duplicate file basename found in weights manifest: '${s}'`);if(n.push(s),-1===r.indexOf(s))throw new Error(`Weight file with basename '${s}' is not provided.`);i[t]=e[r.indexOf(s)]});if(n.length!==e.length)throw new Error(`Mismatch in the number of files in weights manifest (${n.length}) and the number of weight files provided (${e.length}).`);return i}}function Xl(t){return new Kl(t)}function Zl(t,e,n,r){!function(t){ht(null!=t&&Array.isArray(t)&&t.length>0,()=>"promises must be a none empty array")}(t),function(t,e){ht(t>=0&&t<=1,()=>"Progress fraction must be in range [0, 1], but got startFraction "+t),ht(e>=0&&e<=1,()=>"Progress fraction must be in range [0, 1], but got endFraction "+e),ht(e>=t,()=>`startFraction must be no more than endFraction, but got startFraction ${t} and endFraction `+e)}(n=null==n?0:n,r=null==r?1:r);let i=0;return Promise.all(t.map(s=>(s.then(s=>{const o=n+ ++i/t.length*(r-n);return e(o),s}),s)))}async function Ql(t,e){null==e&&(e={});const n=null==e.fetchFunc?W().platform.fetch:e.fetchFunc,r=t.map(t=>n(t,e.requestInit,{isBinary:!0})),i=(null==e.onProgress?await Promise.all(r):await Zl(r,e.onProgress,0,.5)).map(t=>t.arrayBuffer());return null==e.onProgress?await Promise.all(i):await Zl(i,e.onProgress,.5,1)}async function Jl(t,e="",n,r){return tu(t=>Ql(t,{requestInit:r}))(t,e,n)}function tu(t){return async(e,n="",r)=>{const i=e.map(()=>!1),s={},o=null!=r?r.map(()=>!1):[],a=[];if(e.forEach((t,e)=>{let n=0;t.weights.forEach(t=>{const l=ul["quantization"in t?t.quantization.dtype:t.dtype]*mt(t.shape),u=()=>{i[e]=!0,null==s[e]&&(s[e]=[]),s[e].push({manifestEntry:t,groupOffset:n,sizeBytes:l})};null!=r?r.forEach((e,n)=>{e===t.name&&(u(),o[n]=!0)}):u(),a.push(t.name),n+=l})}),!o.every(t=>t)){const t=r.filter((t,e)=>!o[e]);throw new Error("Could not find weights in manifest with names: "+t.join(", ")+". \nManifest JSON has weights with names: "+a.join(", ")+".")}const l=i.reduce((t,e,n)=>(e&&t.push(n),t),[]),u=[];l.forEach(t=>{e[t].paths.forEach(t=>{const e=n+(n.endsWith("/")?"":"/")+t;u.push(e)})});const c=await t(u),h={};let d=0;return l.forEach(t=>{const n=e[t].paths.length;let r=0;for(let e=0;e<n;e++)r+=c[d+e].byteLength;const i=new ArrayBuffer(r),o=new Uint8Array(i);let a=0;for(let e=0;e<n;e++){const t=new Uint8Array(c[d+e]);o.set(t,a),a+=t.byteLength}s[t].forEach(t=>{const e=hl(i.slice(t.groupOffset,t.groupOffset+t.sizeBytes),[t.manifestEntry]);for(const n in e)h[n]=e[n]}),d+=n}),h}}bl.registerSaveRouter(t=>W().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Yl.URL_SCHEME)?function(t="model"){return new Yl(t)}(t.slice(Yl.URL_SCHEME.length)):null);class eu{constructor(t,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,null!=e.fetchFunc?(ht("function"==typeof e.fetchFunc,()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=e.fetchFunc):this.fetch=W().platform.fetch,ht(null!=t&&t.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(t)&&ht(2===t.length,()=>`URL paths for http must have a length of 2, (actual length is ${t.length}).`),this.path=t,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);e.body=new FormData,e.body.append("model.json",new Blob([JSON.stringify({modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata,weightsManifest:[{paths:["./model.weights.bin"],weights:t.weightSpecs}]})],{type:"application/json"}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin");const n=await this.fetch(this.path,e);if(n.ok)return{modelArtifactsInfo:yl(t),responses:[n]};throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+n.status+".")}async load(){const t=await this.fetch(this.path,this.requestInit);if(!t.ok)throw new Error(`Request to ${this.path} failed with status code `+t.status+". Please verify this URL points to the model JSON of the model to load.");let e;try{e=await t.json()}catch(c){let t=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?t+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":t+=" Please make sure the server is serving valid JSON for this request.",new Error(t)}const n=e.modelTopology,r=e.weightsManifest,i=e.generatedBy,s=e.convertedBy,o=e.format,a=e.userDefinedMetadata;if(null==n&&null==r)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);let l,u;if(null!=r){const t=await this.loadWeights(r);[l,u]=t}return{modelTopology:n,weightSpecs:l,weightData:u,userDefinedMetadata:a,generatedBy:i,convertedBy:s,format:o}}async loadWeights(t){const e=Array.isArray(this.path)?this.path[1]:this.path,[n,r]=function(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?");return[t.substring(0,e)+"/",n>e?t.substring(n):""]}(e),i=this.weightPathPrefix||n,s=[];for(const a of t)s.push(...a.weights);const o=[];return t.forEach(t=>{t.paths.forEach(t=>{o.push(i+t+r)})}),[s,ml(await Ql(o,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress}))]}}function nu(t){return null!=t.match(eu.URL_SCHEME_REGEX)}eu.URL_SCHEME_REGEX=/^https?:\/\//;const ru=(t,e)=>{if("undefined"==typeof fetch&&(null==e||null==e.fetchFunc))return null;{let n=!0;if(n=Array.isArray(t)?t.every(t=>nu(t)):nu(t),n)return iu(t,e)}return null};function iu(t,e){return new eu(t,e)}function su(t,e){return iu(t,e)}bl.registerSaveRouter(ru),bl.registerLoadRouter(ru);class ou{constructor(t){this.modelArtifacts=t}async load(){return this.modelArtifacts}}class au{constructor(t){this.saveHandler=t}async save(t){return this.saveHandler(t)}}function lu(t,e,n,r){return 1===arguments.length?null!=t.modelTopology||null!=t.weightSpecs?new ou(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new ou({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new ou({modelTopology:t,weightSpecs:e,weightData:n,trainingConfig:r}))}function uu(t){return new au(t)}const cu=Me({confusionMatrix_:function(t,e,n){const r=Re(t,"labels","confusionMatrix"),i=Re(e,"predictions","confusionMatrix");ht(null==n||n>0&&Number.isInteger(n),()=>"If provided, numClasses must be a positive integer, but got "+n),ht(1===r.rank,()=>"Expected the rank of labels to be 1, but got "+r.rank),ht(1===i.rank,()=>"Expected the rank of predictions to be 1, but got "+i.rank),ht(r.shape[0]===i.shape[0],()=>`Mismatch in the number of examples: ${r.shape[0]} vs. ${i.shape[0]}. Labels and predictions should have the same number of elements.`),ht(n>0&&Number.isInteger(n),()=>"numClasses is required to be a positive integer, but got "+n);const s=ms(an(r,"int32"),n),o=ms(an(i,"int32"),n),a=Xe(s);return an(Kn(a,o),"int32")}});let hu;async function du(t,e){let n=Re(t,"img","toPixels");if(!(t instanceof ue)){const t=n;n=an(t,"int32"),t.dispose()}if(2!==n.rank&&3!==n.rank)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${n.rank}.`);const[r,i]=n.shape.slice(0,2),s=2===n.rank?1:n.shape[2];if(s>4||2===s)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+s);const o=await n.data(),a=as(n),l=Hi(n),u=await Promise.all([a.data(),l.data()]),c=u[0][0],h=u[1][0];if(a.dispose(),l.dispose(),"float32"===n.dtype){if(c<0||h>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but got range [${c} - ${h}].`)}else{if("int32"!==n.dtype)throw new Error(`Unsupported type for toPixels: ${n.dtype}. Please use float32 or int32 tensors.`);if(c<0||h>255)throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but got range [${c} - ${h}].`)}const d="float32"===n.dtype?255:1,f=new Uint8ClampedArray(i*r*4);for(let p=0;p<r*i;++p){let t,e,n,r;1===s?(t=o[p]*d,e=o[p]*d,n=o[p]*d,r=255):3===s?(t=o[3*p]*d,e=o[3*p+1]*d,n=o[3*p+2]*d,r=255):4===s&&(t=o[4*p]*d,e=o[4*p+1]*d,n=o[4*p+2]*d,r=o[4*p+3]*d);const i=4*p;f[i+0]=Math.round(t),f[i+1]=Math.round(e),f[i+2]=Math.round(n),f[i+3]=Math.round(r)}if(null!=e){e.width=i,e.height=r;const t=e.getContext("2d"),n=new ImageData(f,i,r);t.putImageData(n,0,0)}return n!==t&&n.dispose(),f}const fu=Me({fromPixels_:function(t,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,i=!1,s=!1,o=!1;if(t.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&t instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement)i=!0;else if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement)s=!0;else{if(null==t.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+t.constructor.name);o=!0}if(i){const e=2;if(i&&t.readyState<e)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}if(null!=Z("FromPixels",Ee.backendName))return Ee.runKernel("FromPixels",{pixels:t},{numChannels:e});const[a,l]=i?[t.videoWidth,t.videoHeight]:[t.width,t.height];let u,c;if(o?u=t.getContext("2d").getImageData(0,0,a,l).data:r||n?u=t.data:(s||i)&&(null==hu&&(hu=document.createElement("canvas").getContext("2d")),hu.canvas.width=a,hu.canvas.height=l,hu.drawImage(t,0,0,a,l),u=hu.getImageData(0,0,a,l).data),4===e)c=new Int32Array(u);else{const t=a*l;c=new Int32Array(t*e);for(let n=0;n<t;n++)for(let t=0;t<e;++t)c[n*e+t]=u[4*n+t]}return Ao(c,[l,a,e],"int32")}});function pu(t,e){if(t.rank<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.rank<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if("int32"!==e.dtype)throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[e.rank-1]>t.rank)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[e.rank-1]} vs. ${t.rank}`);if(0===t.size)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const n=e.shape,r=n[n.length-1];let i=1;for(let u=0;u<n.length-1;++u)i*=n[u];const s=t.shape,o=n.slice();o.pop();let a=1;for(let u=r;u<t.rank;++u)a*=s[u],o.push(s[u]);const l=[...jt(t.shape).map(t=>t/a),1].slice(0,r);return[o,i,a,l]}class mu{getClassName(){return this.constructor.className}static fromConfig(t,e){return new t(e)}}class gu{constructor(){this.classNameMap={}}static getMap(){return null==gu.instance&&(gu.instance=new gu),gu.instance}static register(t){gu.getMap().classNameMap[t.className]=[t,t.fromConfig]}}function yu(t){ht(null!=t.className,()=>"Class being registered does not have the static className property defined."),ht("string"==typeof t.className,()=>"className is required to be a string, but got type "+typeof t.className),ht(t.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),gu.register(t)}class vu extends mu{minimize(t,e=!1,n){const{value:r,grads:i}=this.computeGradients(t,n);if(null!=n){const t=n.map(t=>({name:t.name,tensor:i[t.name]}));this.applyGradients(t)}else this.applyGradients(i);return On(i),e?r:(r.dispose(),null)}get iterations(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(t,e){return Bi(t,e)}dispose(){null!=this.iterations_&&On(this.iterations_)}async saveIterations(){return null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:Si(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(t){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())}async extractIterations(t){return this.iterations_=(await t[0].tensor.data())[0],t.slice(1)}}Object.defineProperty(vu,Symbol.hasInstance,{value:t=>null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients});class bu extends vu{constructor(t,e,n=null){super(),this.learningRate=t,this.rho=e,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],null==n&&(this.epsilon=Ee.backend.epsilon())}applyGradients(t){(Array.isArray(t)?t.map(t=>t.name):Object.keys(t)).forEach((e,n)=>{const r=Ee.registeredVariables[e];null==this.accumulatedGrads[n]&&(this.accumulatedGrads[n]={originalName:e+"/accum_grad",variable:Tn(()=>Qr(r).variable(!1))}),null==this.accumulatedUpdates[n]&&(this.accumulatedUpdates[n]={originalName:e+"/accum_var",variable:Tn(()=>Qr(r).variable(!1))});const i=Array.isArray(t)?t[n].tensor:t[e];if(null==i)return;const s=this.accumulatedGrads[n].variable,o=this.accumulatedUpdates[n].variable;Tn(()=>{const t=Le(Xn(s,this.rho),Xn(cs(i),1-this.rho)),e=Xn(Hr(bo(Le(o,this.epsilon)),bo(Le(s,this.epsilon))),i),n=Le(Xn(o,this.rho),Xn(cs(e),1-this.rho));s.assign(t),o.assign(n);const a=Le(Xn(e,-this.learningRate),r);r.assign(a)})}),this.incrementIterations()}dispose(){null!=this.accumulatedUpdates&&(On(this.accumulatedGrads.map(t=>t.variable)),On(this.accumulatedUpdates.map(t=>t.variable)))}async getWeights(){const t=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(t.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(t){const e=(t=await this.extractIterations(t)).length/2;this.accumulatedGrads=t.slice(0,e).map(t=>({originalName:t.name,variable:t.tensor.variable(!1)})),this.accumulatedUpdates=t.slice(e,2*e).map(t=>({originalName:t.name,variable:t.tensor.variable(!1)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.rho,e.epsilon)}}bu.className="Adadelta",yu(bu);class xu extends vu{constructor(t,e=.1){super(),this.learningRate=t,this.initialAccumulatorValue=e,this.accumulatedGrads=[]}applyGradients(t){(Array.isArray(t)?t.map(t=>t.name):Object.keys(t)).forEach((e,n)=>{const r=Ee.registeredVariables[e];if(null==this.accumulatedGrads[n]){const t=!1;this.accumulatedGrads[n]={originalName:e+"/accumulator",variable:Tn(()=>ui(r.shape,this.initialAccumulatorValue).variable(t))}}const i=Array.isArray(t)?t[n].tensor:t[e];if(null==i)return;const s=this.accumulatedGrads[n].variable;Tn(()=>{const t=Le(s,cs(i));s.assign(t);const e=Le(Xn(Hr(i,bo(Le(t,Ee.backend.epsilon()))),-this.learningRate),r);r.assign(e)})}),this.incrementIterations()}dispose(){null!=this.accumulatedGrads&&On(this.accumulatedGrads.map(t=>t.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(t){t=await this.extractIterations(t),this.accumulatedGrads=t.map(t=>({originalName:t.name,variable:t.tensor.variable(!1)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(t,e){return new t(e.learningRate,e.initialAccumulatorValue)}}xu.className="Adagrad",yu(xu);class _u extends vu{constructor(t,e,n,r=null){super(),this.learningRate=t,this.beta1=e,this.beta2=n,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],Tn(()=>{this.accBeta1=Si(e).variable(),this.accBeta2=Si(n).variable()}),null==r&&(this.epsilon=Ee.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map(t=>t.name):Object.keys(t);Tn(()=>{const n=Gi(1,this.accBeta1),r=Gi(1,this.accBeta2);e.forEach((e,i)=>{const s=Ee.registeredVariables[e];null==this.accumulatedFirstMoment[i]&&(this.accumulatedFirstMoment[i]={originalName:e+"/m",variable:Tn(()=>Qr(s).variable(!1))}),null==this.accumulatedSecondMoment[i]&&(this.accumulatedSecondMoment[i]={originalName:e+"/v",variable:Tn(()=>Qr(s).variable(!1))});const o=Array.isArray(t)?t[i].tensor:t[e];if(null==o)return;const a=this.accumulatedFirstMoment[i].variable,l=this.accumulatedSecondMoment[i].variable,u=Le(Xn(a,this.beta1),Xn(o,1-this.beta1)),c=Le(Xn(l,this.beta2),Xn(cs(o),1-this.beta2)),h=Hr(u,n),d=Hr(c,r);a.assign(u),l.assign(c);const f=Le(Xn(Hr(h,Le(bo(d),this.epsilon)),-this.learningRate),s);s.assign(f)}),this.accBeta1.assign(Xn(this.accBeta1,this.beta1)),this.accBeta2.assign(Xn(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&On(this.accumulatedFirstMoment.map(t=>t.variable)),null!=this.accumulatedSecondMoment&&On(this.accumulatedSecondMoment.map(t=>t.variable))}async getWeights(){const t=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(t.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(t){t=await this.extractIterations(t),Tn(()=>{this.accBeta1.assign(Es(this.beta1,this.iterations_+1)),this.accBeta2.assign(Es(this.beta2,this.iterations_+1))});const e=t.length/2;this.accumulatedFirstMoment=t.slice(0,e).map(t=>({originalName:t.name,variable:t.tensor.variable(!1)})),this.accumulatedSecondMoment=t.slice(e,2*e).map(t=>({originalName:t.name,variable:t.tensor.variable(!1)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)}}_u.className="Adam",yu(_u);class wu extends vu{constructor(t,e,n,r=null,i=0){super(),this.learningRate=t,this.beta1=e,this.beta2=n,this.epsilon=r,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],Tn(()=>{this.iteration=Si(0).variable(),this.accBeta1=Si(e).variable()}),null==r&&(this.epsilon=Ee.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map(t=>t.name):Object.keys(t);Tn(()=>{const n=Gi(1,this.accBeta1),r=Hr(-this.learningRate,Le(Xn(this.iteration,this.decay),1));e.forEach((e,i)=>{const s=Ee.registeredVariables[e];null==this.accumulatedFirstMoment[i]&&(this.accumulatedFirstMoment[i]={originalName:e+"/m",variable:Qr(s).variable(!1)}),null==this.accumulatedWeightedInfNorm[i]&&(this.accumulatedWeightedInfNorm[i]={originalName:e+"/v",variable:Qr(s).variable(!1)});const o=Array.isArray(t)?t[i].tensor:t[e];if(null==o)return;const a=this.accumulatedFirstMoment[i].variable,l=this.accumulatedWeightedInfNorm[i].variable,u=Le(Xn(a,this.beta1),Xn(o,1-this.beta1)),c=Xn(l,this.beta2),h=$e(o),d=Di(c,h);a.assign(u),l.assign(d);const f=Le(Xn(Hr(r,n),Hr(u,Le(d,this.epsilon))),s);s.assign(f)}),this.iteration.assign(Le(this.iteration,1)),this.accBeta1.assign(Xn(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&On(this.accumulatedFirstMoment.map(t=>t.variable)),null!=this.accumulatedWeightedInfNorm&&On(this.accumulatedWeightedInfNorm.map(t=>t.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(t){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)}}wu.className="Adamax",yu(wu);class Su extends vu{constructor(t){super(),this.learningRate=t,this.setLearningRate(t)}applyGradients(t){(Array.isArray(t)?t.map(t=>t.name):Object.keys(t)).forEach((e,n)=>{const r=Array.isArray(t)?t[n].tensor:t[e];if(null==r)return;const i=Ee.registeredVariables[e];Tn(()=>{const t=Le(Xn(this.c,r),i);i.assign(t)})}),this.incrementIterations()}setLearningRate(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=In(Si(-t))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(t){if(0!==(t=await this.extractIterations(t)).length)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(t,e){return new t(e.learningRate)}}Su.className="SGD",yu(Su);class Cu extends Su{constructor(t,e,n=!1){super(t),this.learningRate=t,this.momentum=e,this.useNesterov=n,this.accumulations=[],this.m=Si(this.momentum)}applyGradients(t){(Array.isArray(t)?t.map(t=>t.name):Object.keys(t)).forEach((e,n)=>{const r=Ee.registeredVariables[e];if(null==this.accumulations[n]){const t=!1;this.accumulations[n]={originalName:e+"/momentum",variable:Tn(()=>Qr(r).variable(t))}}const i=this.accumulations[n].variable,s=Array.isArray(t)?t[n].tensor:t[e];null!=s&&Tn(()=>{let t;const e=Le(Xn(this.m,i),s);t=Le(Xn(this.c,this.useNesterov?Le(s,Xn(e,this.m)):e),r),i.assign(e),r.assign(t)})}),this.incrementIterations()}dispose(){this.m.dispose(),null!=this.accumulations&&On(this.accumulations.map(t=>t.variable))}setMomentum(t){this.momentum=t}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(t){t=await this.extractIterations(t),this.accumulations=t.map(t=>({originalName:t.name,variable:t.tensor.variable(!1)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)}}Cu.className="Momentum",yu(Cu);class Eu extends vu{constructor(t,e=.9,n=0,r=null,i=!1){if(super(),this.learningRate=t,this.decay=e,this.momentum=n,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,null==r&&(this.epsilon=Ee.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(t){(Array.isArray(t)?t.map(t=>t.name):Object.keys(t)).forEach((e,n)=>{const r=Ee.registeredVariables[e];null==this.accumulatedMeanSquares[n]&&(this.accumulatedMeanSquares[n]={originalName:e+"/rms",variable:Tn(()=>Qr(r).variable(!1))}),null==this.accumulatedMoments[n]&&(this.accumulatedMoments[n]={originalName:e+"/momentum",variable:Tn(()=>Qr(r).variable(!1))}),null==this.accumulatedMeanGrads[n]&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:e+"/mg",variable:Tn(()=>Qr(r).variable(!1))});const i=Array.isArray(t)?t[n].tensor:t[e];if(null==i)return;const s=this.accumulatedMeanSquares[n].variable,o=this.accumulatedMoments[n].variable;Tn(()=>{const t=Le(Xn(s,this.decay),Xn(cs(i),1-this.decay));if(this.centered){const e=this.accumulatedMeanGrads[n].variable,a=Le(Xn(e,this.decay),Xn(i,1-this.decay)),l=Hr(Xn(i,this.learningRate),bo(Gi(t,Le(cs(a),this.epsilon)))),u=Le(Xn(o,this.momentum),l);s.assign(t),e.assign(a),o.assign(u);const c=Gi(r,u);r.assign(c)}else{const t=Le(Xn(s,this.decay),Xn(cs(i),1-this.decay)),e=Le(Xn(o,this.momentum),Hr(Xn(i,this.learningRate),bo(Le(t,this.epsilon))));s.assign(t),o.assign(e);const n=Gi(r,e);r.assign(n)}})}),this.incrementIterations()}dispose(){null!=this.accumulatedMeanSquares&&On(this.accumulatedMeanSquares.map(t=>t.variable)),null!=this.accumulatedMeanGrads&&this.centered&&On(this.accumulatedMeanGrads.map(t=>t.variable)),null!=this.accumulatedMoments&&On(this.accumulatedMoments.map(t=>t.variable))}async getWeights(){const t=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&t.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(t.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(t){t=await this.extractIterations(t);const e=this.centered?t.length/3:t.length/2;this.accumulatedMeanSquares=t.slice(0,e).map(t=>({originalName:t.name,variable:t.tensor.variable(!1)})),this.accumulatedMoments=t.slice(e,2*e).map(t=>({originalName:t.name,variable:t.tensor.variable(!1)})),this.centered&&(this.accumulatedMeanGrads=t.slice(2*e,3*e).map(t=>({originalName:t.name,variable:t.tensor.variable(!1)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)}}Eu.className="RMSProp",yu(Eu);class ku{static sgd(t){return new Su(t)}static momentum(t,e,n=!1){return new Cu(t,e,n)}static rmsprop(t,e=.9,n=0,r=null,i=!1){return new Eu(t,e,n,r,i)}static adam(t=.001,e=.9,n=.999,r=null){return new _u(t,e,n,r)}static adadelta(t=.001,e=.95,n=null){return new bu(t,e,n)}static adamax(t=.002,e=.9,n=.999,r=null,i=0){return new wu(t,e,n,r,i)}static adagrad(t,e=.1){return new xu(t,e)}}const Au={sgd:ku.sgd,momentum:ku.momentum,adadelta:ku.adadelta,adagrad:ku.adagrad,rmsprop:ku.rmsprop,adamax:ku.adamax,adam:ku.adam},Du="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:t=>t();function Nu(){return new Promise(t=>Du(()=>t()))}function Tu(t,e,n){return[n*("number"==typeof t?t:t[0]),e*("number"==typeof t?t:t[1])]}function Ou(t,e,n,r=!0){let i=[];if(r)i=i.concat(e.slice(0)),i.push(t[0]/n),i=i.concat(t.slice(1));else{i=i.concat(t[0]);const n=e.length;for(let r=0;r<n;++r)i=i.concat([t[r+1]/e[r],e[r]]);i=i.concat(t.slice(n+1))}return i}function Iu(t,e,n=!0){const r=[];if(n){r.push(e);for(let n=e+1;n<t;++n)n<=2*e?(r.push(n),r.push(n-(e+1))):r.push(n)}else{const n=[],i=[];for(let r=1;r<t;++r)r>=2*e+1||r%2==1?i.push(r):n.push(r);r.push(...n),r.push(0),r.push(...i)}return r}function Ru(t,e,n,r=!0){const i=[];i.push(r?t[0]/n:t[0]*n);for(let s=1;s<t.length;++s)i.push(s<=e.length?r?e[s-1]*t[s]:t[s]/e[s-1]:t[s]);return i}function Fu(t,e){const n=[0];for(let r=0;r<e;++r)n.push(t[r][0]);return n}function Mu(t,e,n){const r=t.slice(0,1);for(let i=0;i<n;++i)r.push(t[i+1]-e[i][0]-e[i][1]);return r}const $u=1.7580993408473768,Pu=1.0507009873554805,zu=.3275911,Lu=.254829592,Bu=-.284496736,ju=1.421413741,Uu=-1.453152027,Vu=1.061405429;function Wu(...t){W().getBool("IS_TEST")||console.warn(...t)}function qu(...t){W().getBool("IS_TEST")||console.log(...t)}function Hu(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(2*t.length);for(let r=0;r<n.length;r+=2)n[r]=t[r/2],n[r+1]=e[r/2];return n}function Gu(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let r=0;r<t.length;r+=2)e[r/2]=t[r],n[r/2]=t[r+1];return{real:e,imag:n}}function Yu(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let i=0;i<t.length;i+=4)n[Math.floor(i/4)]=t[i],r[Math.floor(i/4)]=t[i+1];return{real:n,imag:r}}function Ku(t){const e=Math.floor(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let i=2;i<t.length;i+=4)n[Math.floor(i/4)]=t[i],r[Math.floor(i/4)]=t[i+1];return{real:n,imag:r}}function Xu(t,e){return{real:t[2*e],imag:t[2*e+1]}}function Zu(t,e,n,r){t[2*r]=e,t[2*r+1]=n}function Qu(t,e){const n=new Float32Array(t/2),r=new Float32Array(t/2);for(let i=0;i<Math.ceil(t/2);i++){const s=(e?2:-2)*Math.PI*(i/t);n[i]=Math.cos(s),r[i]=Math.sin(s)}return{real:n,imag:r}}function Ju(t,e,n){const r=(n?2:-2)*Math.PI*(t/e);return{real:Math.cos(r),imag:Math.sin(r)}}function tc(t,e,n){if("complex64"===e){if("complex64"===t.dtype)return t.clone();const e=is(t.shape),r=an(t,"float32"),i=n.complex(r,e);return e.dispose(),r.dispose(),i}if(!Ot(t.dtype,e))return Ee.makeTensorFromDataId(t.dataId,t.shape,e);if("complex64"===t.dtype){const r=n.real(t),i=an(r,e);return r.dispose(),i}if("int32"===e)return n.int(t);if("bool"===e){const e=Si(0,t.dtype),r=n.notEqual(t,e);return e.dispose(),r}throw new Error(`Error in Cast: failed to cast ${t.dtype} to ${e}`)}function ec(t,e){return Ee.makeTensorFromDataId(t.dataId,e,t.dtype)}function nc(t,e,n){const r=(e-t)/(n-1),i=qt(n,"float32");i[0]=t;for(let s=1;s<i.length;s++)i[s]=i[s-1]+r;return Gs(i,"float32")}function rc(t,e,n){const r=new Array(t.rank).fill(0),i=t.shape.slice();return e.map(e=>{const s=[...i];s[n]=e;const o=dr(t,r,s);return r[n]+=e,o})}function ic(t,e){const n=new Array(t.rank);for(let i=0;i<n.length;i++)n[i]=t.shape[i]*e[i];const r=Sr(n,t.dtype);for(let i=0;i<r.values.length;++i){const e=r.indexToLoc(i),n=new Array(t.rank);for(let r=0;r<n.length;r++)n[r]=e[r]%t.shape[r];const s=t.locToIndex(n);r.values[i]=t.values[s]}return r.toTensor()}function sc(t,e,n,r,i){const s=e[e.length-1],[o,a]=[t.length/s,s],l=At(n,o*r),u=At("int32",o*r);for(let h=0;h<o;h++){const e=h*a,n=t.subarray(e,e+a),i=[];for(let t=0;t<n.length;t++)i.push({value:n[t],index:t});i.sort((t,e)=>e.value-t.value);const s=h*r,o=l.subarray(s,s+r),c=u.subarray(s,s+r);for(let t=0;t<r;t++)o[t]=i[t].value,c[t]=i[t].index}const c=e.slice();return c[c.length-1]=r,[Gn(l,c,n),Gn(u,c,"int32")]}class oc{constructor(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}get(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)}set(t,e){this.dataIdsCount++,this.data.set(t,e)}has(t){return this.data.has(t)}delete(t){return this.dataIdsCount--,this.data.delete(t)}numDataIds(){return this.dataIdsCount}}class ac{time(t){return lc("time")}read(t){return lc("read")}readSync(t){return lc("readSync")}numDataIds(){return lc("numDataIds")}disposeData(t){return lc("disposeData")}write(t,e,n){return lc("write")}move(t,e,n,r){return lc("move")}memory(){return lc("memory")}floatPrecision(){return lc("floatPrecision")}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}batchMatMul(t,e,n,r){return lc("batchMatMul")}fusedBatchMatMul({}){return lc("fusedBatchMatMul")}slice(t,e,n){return lc("slice")}stridedSlice(t,e,n,r){return lc("stridedSlice")}unstack(t,e){return lc("unstack")}reverse(t,e){return lc("reverse")}concat(t,e){return lc("concat")}neg(t){return lc("neg")}add(t,e){return lc("add")}addN(t){return lc("addN")}subtract(t,e){return lc("subtract")}multiply(t,e){return lc("multiply")}realDivide(t,e){return lc("realDivide")}floorDiv(t,e){return lc("floorDiv")}sum(t,e){return lc("sum")}prod(t,e){return lc("prod")}unsortedSegmentSum(t,e,n){return lc("unsortedSegmentSum")}argMin(t,e){return lc("argMin")}argMax(t,e){return lc("argMax")}equal(t,e){return lc("equal")}notEqual(t,e){return lc("notEqual")}less(t,e){return lc("less")}lessEqual(t,e){return lc("lessEqual")}greater(t,e){return lc("greater")}greaterEqual(t,e){return lc("greaterEqual")}logicalNot(t){return lc("logicalNot")}logicalAnd(t,e){return lc("logicalAnd")}logicalOr(t,e){return lc("logicalOr")}where(t){return lc("where")}select(t,e,n){return lc("select")}topk(t,e,n){return lc("topk")}min(t,e){return lc("min")}minimum(t,e){return lc("minimum")}mod(t,e){return lc("mod")}max(t,e){return lc("max")}maximum(t,e){return lc("maximum")}all(t,e){return lc("all")}any(t,e){return lc("any")}squaredDifference(t,e){return lc("squaredDifference")}ceil(t){return lc("ceil")}floor(t){return lc("floor")}round(t){return lc("round")}sign(t){return lc("sign")}isNaN(t){return lc("isNaN")}isInf(t){return lc("isInf")}isFinite(t){return lc("isFinite")}pow(t,e){return lc("pow")}exp(t){return lc("exp")}expm1(t){return lc("expm1")}softmax(t,e){return lc("softmax")}log(t){return lc("log")}log1p(t){return lc("log1p")}sqrt(t){return lc("sqrt")}rsqrt(t){return lc("rsqrt")}square(t){return lc("square")}reciprocal(t){return lc("reciprocal")}relu(t){return lc("relu")}relu6(t){return lc("relu6")}prelu(t,e){return lc("prelu")}elu(t){return lc("elu")}eluDer(t,e){return lc("eluDer")}selu(t){return lc("selu")}int(t){return lc("int")}clip(t,e,n){return lc("clip")}abs(t){return lc("abs")}complexAbs(t){return lc("complexAbs")}sigmoid(t){return lc("sigmoid")}softplus(t){return lc("softplus")}sin(t){return lc("sin")}cos(t){return lc("cos")}tan(t){return lc("tan")}asin(t){return lc("asin")}acos(t){return lc("acos")}atan(t){return lc("atan")}atan2(t,e){return lc("atan2")}sinh(t){return lc("sinh")}cosh(t){return lc("cosh")}tanh(t){return lc("tanh")}asinh(t){return lc("asinh")}acosh(t){return lc("acosh")}atanh(t){return lc("atanh")}erf(t){return lc("erf")}step(t,e){return lc("step")}fusedConv2d({}){return lc("fusedConv2d")}conv2d(t,e,n){return lc("conv2d")}conv2dDerInput(t,e,n){return lc("conv2dDerInput")}conv2dDerFilter(t,e,n){return lc("conv2dDerFilter")}fusedDepthwiseConv2D({}){return lc("fusedDepthwiseConv2D")}depthwiseConv2D(t,e,n){return lc("depthwiseConv2D")}depthwiseConv2DDerInput(t,e,n){return lc("depthwiseConv2DDerInput")}depthwiseConv2DDerFilter(t,e,n){return lc("depthwiseConv2DDerFilter")}conv3d(t,e,n){return lc("conv3d")}conv3dDerInput(t,e,n){return lc("conv3dDerInput")}conv3dDerFilter(t,e,n){return lc("conv3dDerFilter")}maxPool(t,e){return lc("maxPool")}maxPoolBackprop(t,e,n,r){return lc("maxPoolBackprop")}avgPool(t,e){return lc("avgPool")}avgPoolBackprop(t,e,n){return lc("avgPoolBackprop")}avgPool3d(t,e){return lc("avgPool3d")}avgPool3dBackprop(t,e,n){return lc("avgPool3dBackprop")}maxPool3d(t,e){return lc("maxPool3d")}maxPool3dBackprop(t,e,n,r){return lc("maxPool3dBackprop")}reshape(t,e){return lc("reshape")}cast(t,e){return lc("cast")}tile(t,e){return lc("tile")}pad(t,e,n){return lc("pad")}transpose(t,e){return lc("transpose")}gather(t,e,n){return lc("gather")}gatherND(t,e){return lc("gatherND")}scatterND(t,e,n){return lc("scatterND")}batchToSpaceND(t,e,n){return lc("batchToSpaceND")}spaceToBatchND(t,e,n){return lc("spaceToBatchND")}resizeBilinear(t,e,n,r){return lc("resizeBilinear")}resizeBilinearBackprop(t,e,n){return lc("resizeBilinearBackprop")}resizeNearestNeighbor(t,e,n,r){return lc("resizeNearestNeighbor")}resizeNearestNeighborBackprop(t,e,n){return lc("resizeNearestNeighborBackprop")}batchNorm(t,e,n,r,i,s){return lc("batchNorm")}localResponseNormalization4D(t,e,n,r,i){return lc("localResponseNormalization4D")}LRNGrad(t,e,n,r,i,s,o){return lc("LRNGrad")}multinomial(t,e,n,r){return lc("multinomial")}oneHot(t,e,n,r){return lc("oneHot")}cumsum(t,e,n,r){return lc("cumsum")}nonMaxSuppression(t,e,n,r,i){return lc("nonMaxSuppression")}fft(t){return lc("fft")}ifft(t){return lc("ifft")}complex(t,e){return lc("complex")}real(t){return lc("real")}imag(t){return lc("imag")}cropAndResize(t,e,n,r,i,s){return lc("cropAndResize")}depthToSpace(t,e,n){return lc("depthToSpace")}split(t,e,n){return lc("split")}sparseToDense(t,e,n,r){return lc("sparseToDense")}diag(t){return lc("diag")}fill(t,e,n){return lc("fill")}onesLike(t){return lc("onesLike")}zerosLike(t){return lc("zerosLike")}linspace(t,e,n){return lc("linspace")}dispose(){return lc("dispose")}}function lc(t){throw new Error(`'${t}' not yet implemented or not found in the registry. Did you forget to import the kernel?`)}const uc={kernelName:"Abs",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Xn(t,So(an(n,"float32"),-1))}}},cc={kernelName:"Acos",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const e=cs(an(n,"float32")),r=bo(Gi(Si(1),e));return Vi(Hr(t,r))}}}},hc={kernelName:"Acosh",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const e=bo(Gi(cs(an(n,"float32")),1));return Hr(t,e)}}}},dc={kernelName:"Add",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=Kr(n.shape,r.shape);return{a:()=>{let e=t;const r=Yr(n.shape,i);return r.length>0&&(e=Yi(e,r)),Ke(e,n.shape)},b:()=>{let e=t;const n=Yr(r.shape,i);return n.length>0&&(e=Yi(e,n)),Ke(e,r.shape)}}}},fc={kernelName:"ArgMax",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Qr(n)}}},pc={kernelName:"ArgMin",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Qr(n)}}},mc={kernelName:"Asin",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Hr(t,bo(Gi(Si(1),cs(an(n,"float32")))))}}},gc={kernelName:"Asinh",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const e=bo(Le(Si(1),cs(an(n,"float32"))));return Hr(t,e)}}}},yc={kernelName:"Atan2",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=Kr(n.shape,r.shape);return{a:()=>{const e=Le(cs(n),cs(r));let s=Xn(t,Hr(r,e));const o=Yr(n.shape,i);return o.length>0&&(s=Yi(s,o)),Ke(s,n.shape)},b:()=>{const e=Le(cs(n),cs(r));let s=Vi(Xn(t,Hr(n,e)));const o=Yr(r.shape,i);return o.length>0&&(s=Yi(s,o)),Ke(s,r.shape)}}}},vc={kernelName:"Atan",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Hr(t,Le(cs(an(n,"float32")),1))}}},bc={kernelName:"Atanh",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Hr(t,Gi(Si(1),cs(an(n,"float32"))))}}},xc=Me({avgPool3dBackprop_:function(t,e,n,r,i=[1,1,1],s,o){const a=Re(t,"dy","avgPool3dBackprop"),l=Re(e,"input","avgPool3dBackprop");let u=a,c=l,h=!1;4===l.rank&&(h=!0,u=Ke(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),c=Ke(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),ht(5===u.rank,()=>"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+u.rank+"."),ht(5===c.rank,()=>"Error in avgPool3dBackprop: input must be rank 5 but got rank "+c.rank+"."),ht(bn(r,i),()=>`Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides ${r} and dilations '${i}'`),null!=o&&ht(vt(s),()=>`Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode ${o} but got pad ${s}.`);const d=Ee.runKernelFunc(t=>{const e=cn(c.shape,n,r,i,s,o);return t.avgPool3dBackprop(u,c,e)},{dy:u,input:c},null,"AvgPool3DBackprop",{filterSize:n,strides:r,dilations:i,pad:s,dimRoundingMode:o});return h?Ke(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}}),_c={kernelName:"AvgPool3D",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{filterSize:i,strides:s,dilations:o,pad:a,dimRoundingMode:l}=n,u=null==o?[1,1,1]:o;return{x:()=>xc(t,r,i,s,u,a,l)}}},wc=Me({avgPoolBackprop_:function(t,e,n,r,i){const s=Re(t,"dy","avgPoolBackprop"),o=Re(e,"input","avgPoolBackprop");ht(o.rank===s.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${s.rank})`);let a=o,l=s,u=!1;3===o.rank&&(u=!0,a=Ke(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=Ke(s,[1,s.shape[0],s.shape[1],s.shape[2]])),ht(4===l.rank,()=>"Error in avgPoolBackprop: dy must be rank 4 but got rank "+l.rank+"."),ht(4===a.rank,()=>"Error in avgPoolBackprop: input must be rank 4 but got rank "+a.rank+".");const c=Ee.runKernelFunc(t=>{const e=un(a.shape,n,r,1,i);return t.avgPoolBackprop(l,a,e)},{dy:l,input:a},null,"AvgPoolBackprop",{filterSize:n,strides:r,pad:i});return u?Ke(c,[c.shape[1],c.shape[2],c.shape[3]]):c}}),Sc={kernelName:"AvgPool",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{filterSize:i,strides:s,pad:o}=n;return{x:()=>wc(t,r,i,s,o)}}},Cc={kernelName:"BatchMatMul",inputsToSave:["a","b"],gradFunc:(t,e,n)=>{const[r,i]=e,{transposeA:s,transposeB:o}=n;return s||o?!s&&o?{a:()=>Kn(t,i,!1,!1),b:()=>Kn(t,r,!0,!1)}:s&&!o?{a:()=>Kn(i,t,!1,!0),b:()=>Kn(r,t,!1,!1)}:{a:()=>Kn(i,t,!0,!0),b:()=>Kn(t,r,!0,!0)}:{a:()=>Kn(t,i,!1,!0),b:()=>Kn(r,t,!0,!1)}}},Ec={kernelName:"BatchToSpaceND",gradFunc:(t,e,n)=>{const{blockShape:r,crops:i}=n;return{x:()=>Ss(t,r,i)}}},kc={kernelName:"BroadcastTo",gradFunc:(t,e,n)=>{const r=n.inputShape,i=n.shape,s=Array.from(i);for(let a=r.length-1;a>=0;a--)if(r[a]===i[a])s[a]=1;else if(1!==r[a])throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${i}].`);const o=[];for(let a=0;a<s.length;a++)s[a]>1&&o.push(a);return{x:()=>Yi(t,o,!0)}}},Ac={kernelName:"Ceil",gradFunc:t=>({x:()=>Qr(t)})},Dc={kernelName:"ClipByValue",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{clipValueMin:i,clipValueMax:s}=n;return{x:()=>Zr(Zi(vi(r,i),Oi(r,s)),t,Qr(t))}}},Nc={kernelName:"Concat",saveAllInputs:!0,gradFunc:(t,e,n)=>{const r=e.map(t=>t.shape),{axis:i}=n,s=Et(i,e[0].shape)[0],o=r.map(t=>t[s]);return ro(t,o,s).map(t=>()=>t)}},Tc={kernelName:"Conv2D",inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[r,i]=e,{dilations:s,strides:o,pad:a,dataFormat:l}=n;return ht(vn(s),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`),{x:()=>Rr(r.shape,t,i,o,a,l),filter:()=>da(r,t,i.shape,o,a,l)}}},Oc={kernelName:"Conv2DBackpropInput",inputsToSave:["dy","filter"],gradFunc:(t,e,n)=>{const[r,i]=e,{strides:s,pad:o,dataFormat:a,dimRoundingMode:l}=n;return{dy:()=>Or(t,i,s,o,a,1,l),filter:()=>da(t,r,i.shape,s,o,a,l)}}},Ic=Me({conv3DBackpropFilter_:function(t,e,n,r,i){let s=t;4===t.rank&&(s=Ke(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));let o=e;return 4===o.rank&&(o=Ke(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),ht(5===s.rank,()=>"Error in conv3dDerFilter: input must be rank 5, but got shape "+s.shape+"."),ht(5===o.rank,()=>"Error in conv3dDerFilter: dy must be rank 5, but got shape "+o.shape+"."),ht(5===n.length,()=>"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."),ht(s.shape[4]===n[3],()=>`Error in conv3dDerFilter: depth of input ${s.shape[4]}) must match input depth in filter (${n[3]}.`),ht(o.shape[4]===n[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${n[4]}).`),Ee.runKernelFunc(t=>{const e=dn(s.shape,n,r,1,i);return t.conv3dDerFilter(s,o,e)},{x:s,y:o},null,"Conv3DBackpropFilterV2",{strides:r,pad:i})}}),Rc={kernelName:"Conv3D",inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:r,strides:i,pad:s}=n;ht(vn(r),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);const[o,a]=e;return{x:()=>$r(o.shape,t,a,i,s),filter:()=>Ic(o,t,a.shape,i,s)}}},Fc={kernelName:"Cos",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Xn(Vi(ho(an(n,"float32"))),t)}}},Mc={kernelName:"Cosh",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Xn(fo(an(n,"float32")),t)}}},$c={kernelName:"Cumsum",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{axis:i,exclusive:s,reverse:o}=n;return{x:()=>{const e=He([i],r.rank);let n=Br(t,i,s,!o);return null!=e&&(n=Xe(n,e)),n}}}},Pc={kernelName:"DepthwiseConv2dNative",inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:r,strides:i,pad:s,dimRoundingMode:o}=n,a=null==r?[1,1]:r;ht(vn(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,u]=e;ht(4===l.rank,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),ht(4===u.rank,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${u.rank}.`),ht(l.shape[3]===u.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`),ht(bn(i,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${i} and dilations '${a}'.`),null!=o&&ht(vt(s),()=>`Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ${o} but got pad ${s}.`);const c=hn(l.shape,u.shape,i,a,s,o,!0);return{x:()=>ba(l.shape,t,u,c),filter:()=>va(l,t,u.shape,c)}}},zc={kernelName:"Dilation2D",inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[r,i]=e,s={x:r,filter:i,dy:t},o={x:r,filter:i,dy:t};return{x:()=>Ee.runKernel("Dilation2DBackpropInput",s,n),filter:()=>Ee.runKernel("Dilation2DBackpropFilter",o,n)}}},Lc={kernelName:"Div",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=Kr(n.shape,r.shape);return{a:()=>{const e=Hr(t,an(r,"float32")),s=Yr(n.shape,i);return s.length>0?Ke(Yi(e,s),n.shape):e},b:()=>{let e=Xn(t,an(n,"float32"));const s=Yr(r.shape,i);s.length>0&&(e=Ke(Yi(e,s),r.shape));const o=cs(r);return Vi(Hr(e,an(o,"float32")))}}}},Bc={kernelName:"Elu",outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e,r=e=>e.eluDer(t,n),i={dy:t,y:n};return{x:()=>Ee.runKernelFunc(r,i,null,"EluGrad")}}},jc={kernelName:"Erf",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,r=Xn(ri(Vi(cs(n))),2/Math.sqrt(Math.PI));return{x:()=>Xn(t,r)}}},Uc={kernelName:"Exp",outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Xn(t,n)}}},Vc={kernelName:"Expm1",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Xn(t,ri(n))}}},Wc={kernelName:"Floor",gradFunc:t=>({x:()=>Qr(t)})},qc={kernelName:"FloorDiv",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=Kr(n.shape,r.shape);return{a:()=>{const e=Hr(t,an(r,"float32")),s=Yr(n.shape,i);return s.length>0?Ke(Yi(e,s),n.shape):e},b:()=>{let e=Xn(t,an(n,"float32"));const s=Yr(r.shape,i);s.length>0&&(e=Ke(Yi(e,s),r.shape));const o=cs(r);return Vi(Hr(e,an(o,"float32")))}}}},Hc={kernelName:"FusedBatchNorm",inputsToSave:["x","mean","variance","scale"],gradFunc:(t,e,n)=>{const{varianceEpsilon:r}=n,[i,s,o,a]=e,l=null==a?Si(1):a,u=Yr(s.shape,i.shape),c=[];if(1===s.rank){for(let t=0;t<i.shape.length-1;++t)c.push(i.shape[t]);c.push(1)}const h=Gi(i,s),d=Xn(t,l),f=oo(Le(o,Si(r))),p=Xn(Xn(Xn(f,f),f),Si(-.5));return{x:()=>Ke(Xn(Xn(t,1===s.rank?oi(Ke(f,[1,1,1,s.shape[0]]),c):f),l),i.shape),mean:()=>{let t=Xn(Xn(f,Si(-1)),d);return 1===s.rank&&(t=Yi(t,u)),Ke(t,s.shape)},variance:()=>{let t=Xn(Xn(p,h),d);return 1===s.rank&&(t=Yi(t,u)),Ke(t,s.shape)},scale:()=>{const e=Xn(h,f);let n=Xn(t,e);return 1===s.rank&&(n=Yi(n,u)),Ke(n,s.shape)},offset:()=>{let e=t;return 1===s.rank&&(e=Yi(e,u)),Ke(e,s.shape)}}}},Gc={kernelName:"GatherV2",inputsToSave:["x","indices"],gradFunc:(t,e,n)=>{const[r,i]=e,{axis:s}=n,o=Et(s,r.shape)[0];return{x:()=>{const e=r.shape,n=i.size,a=e.slice(0,o),l=a.length,u=e.slice(s,e.length).slice(1),c=u.length,h=Yc(0,l),d=Yc(l+1,l+1+c),f=Kc([a,[n],u]),p=Ke(t,f),m=Ke(i,[n]),g=Kc([[l],h,d]),y=Xe(p,g);let v=Ro(y,m,r.shape[o]);const b=Ge(g);return v=Xe(v,b),v},indices:()=>i}}};function Yc(t,e){const n=[];for(let r=t;r<e;++r)n.push(r);return n}function Kc(t){const e=[];for(let n=0;n<t.length;++n)for(let r=0;r<t[n].length;++r)e.push(t[n][r]);return e}const Xc={kernelName:"GreaterEqual",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e;return{a:()=>Qr(n),b:()=>Qr(r)}}},Zc={kernelName:"Identity",gradFunc:t=>({x:()=>an(t,"float32")})},Qc={kernelName:"IsFinite",gradFunc:t=>({x:()=>Qr(t)})},Jc={kernelName:"IsInf",gradFunc:t=>({x:()=>Qr(t)})},th={kernelName:"IsNan",gradFunc:t=>({x:()=>Qr(t)})},eh={kernelName:"Log1p",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Hr(t,Le(n,1))}}},nh={kernelName:"Log",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Hr(t,an(n,"float32"))}}},rh={kernelName:"LogSoftmax",inputsToSave:[],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r]=e,{axis:i}=n;return{logits:()=>{const e=ri(r);return Gi(t,Xn(Yi(t,i,!0),e))}}}},ih=Me({localResponseNormalizationBackprop_:function(t,e,n,r=5,i=1,s=1,o=.5){return Ee.runKernelFunc(a=>a.LRNGrad(n,t,e,r,i,s,o),{x:t,y:e,dy:n},null,"LRNBackprop",{depthRadius:r,bias:i,alpha:s,beta:o})}}),sh={kernelName:"LRN",inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r,i]=e,{depthRadius:s,bias:o,alpha:a,beta:l}=n;return{x:()=>ih(r,i,t,s,o,a,l)}}};function oh(t,e,n,r,i){return e.rank<n.rank&&(e=Ke(e,We(e.shape,r))),t.rank<n.rank&&(t=Ke(t,We(t.shape,r))),{x:()=>{const r=Xn(t,an(Xr(n,e),t.dtype));return null==i?r:Xe(r,i)}}}const ah={kernelName:"Max",inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const r=n,{reductionIndices:i}=r,[s,o]=e,a=Et(i,s.shape),l=He(a,s.rank),u=oh(t,o,s,a,l);return{x:()=>{let t=u.x();return null!=l&&(t=Xe(t)),t}}}},lh={kernelName:"Maximum",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e;return{a:()=>Xn(t,an(vi(n,r),"float32")),b:()=>Xn(t,an(Ti(n,r),"float32"))}}},uh=Me({maxPool3dBackprop_:function(t,e,n,r,i,s=[1,1,1],o,a){const l=Re(t,"dy","maxPool3dBackprop"),u=Re(e,"input","maxPool3dBackprop"),c=Re(n,"output","maxPool3dBackprop");let h=l,d=u,f=c,p=!1;4===u.rank&&(p=!0,h=Ke(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),d=Ke(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),f=Ke(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),ht(5===h.rank,()=>"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+h.rank+"."),ht(5===d.rank,()=>"Error in maxPool3dBackprop: input must be rank 5 but got rank "+d.rank+"."),ht(5===f.rank,()=>"Error in maxPool3dBackprop: output must be rank 5 but got rank "+f.rank+"."),ht(bn(i,s),()=>`Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides ${i} and dilations '${s}'`),null!=a&&ht(vt(o),()=>`Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode ${a} but got pad ${o}.`);const m=Ee.runKernelFunc(t=>{const e=cn(d.shape,r,i,s,o,a);return t.maxPool3dBackprop(h,d,f,e)},{dy:h,input:d,output:f},null,"MaxPool3DBackprop",{filterSize:r,strides:i,dilations:s,pad:o,dimRoundingMode:a});return p?Ke(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}}),ch={kernelName:"MaxPool3D",inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r,i]=e,{filterSize:s,strides:o,dilations:a,pad:l,dimRoundingMode:u}=n,c=null==a?[1,1,1]:a;return{x:()=>uh(t,r,i,s,o,c,l,u)}}},hh=Me({maxPoolBackprop_:function(t,e,n,r,i,s,o){const a=Re(t,"dy","maxPoolBackprop"),l=Re(e,"input","maxPoolBackprop"),u=Re(n,"output","maxPoolBackprop");return ht(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),ht(4===a.rank,()=>"Error in maxPoolBackprop: dy must be rank 4 but got rank "+a.rank+"."),ht(4===l.rank,()=>"Error in maxPoolBackprop: input must be rank 4 but got rank "+l.rank+"."),null!=o&&ht(vt(s),()=>`Error in maxPoolBackprop: pad must be an integer when using, dimRoundingMode ${o} but got pad ${s}.`),Ee.runKernelFunc(t=>{const e=un(l.shape,r,i,1,s,o);return t.maxPoolBackprop(a,l,u,e)},{dy:a,input:l,output:u},null,"MaxPoolBackprop",{filterSize:r,strides:i,pad:s,dimRoundingMode:o})}}),dh={kernelName:"PadV2",inputsToSave:["x"],gradFunc:(t,e,n)=>{const r=e[0],{paddings:i}=n,s=i.map(t=>t[0]);return{x:()=>dr(t,s,r.shape)}}},fh={kernelName:"SpaceToBatchND",gradFunc:(t,e,n)=>{const{blockShape:r,paddings:i}=n;return{x:()=>mr(t,r,i)}}},ph={kernelName:"SplitV",gradFunc:(t,e,n)=>{const{axis:r}=n;return{x:()=>Yn(t,r)}}},mh=[uc,cc,hc,dc,{kernelName:"AddN",saveAllInputs:!0,gradFunc:(t,e)=>{const n={};return e.forEach((e,r)=>{n[r]=()=>t.clone()}),n}},fc,pc,mc,gc,yc,vc,bc,_c,Sc,Cc,Ec,kc,{kernelName:"Cast",gradFunc:t=>({x:()=>t.clone()})},Ac,Dc,Nc,Oc,Tc,Rc,Fc,Mc,$c,Pc,zc,Lc,Bc,jc,Uc,Vc,qc,Wc,Hc,Gc,Xc,Zc,Qc,Jc,th,eh,nh,rh,sh,ah,ah,lh,ch,{kernelName:"MaxPool",inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r,i]=e,{filterSize:s,strides:o,pad:a}=n;return{x:()=>hh(t,r,i,s,o,a)}}},{kernelName:"Min",inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const r=n,{axis:i}=r,[s,o]=e,a=Et(i,s.shape),l=He(a,s.rank),u=oh(t,o,s,a,l);return{x:()=>{let t=u.x();return null!=l&&(t=Xe(t)),t}}}},{kernelName:"Minimum",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e;return{a:()=>Xn(t,an(Oi(n,r),"float32")),b:()=>Xn(t,an(yi(n,r),"float32"))}}},{kernelName:"Mod",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=Kr(n.shape,r.shape);return{a:()=>{const e=Yr(n.shape,i);return e.length>0?Ke(Yi(t,e),n.shape):t},b:()=>{const e=Xn(t,Vi(ci(Hr(n,r)))),s=Yr(r.shape,i);return s.length>0?Ke(Yi(e,s),r.shape):e}}}},{kernelName:"Multiply",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=Kr(n.shape,r.shape);return{a:()=>{const e=Xn(t,an(r,"float32")),s=Yr(n.shape,i);return s.length>0?Ke(Yi(e,s),n.shape):e},b:()=>{const e=Xn(t,an(n,"float32")),s=Yr(r.shape,i);return s.length>0?Ke(Yi(e,s),r.shape):e}}}},{kernelName:"Negate",gradFunc:t=>({x:()=>Vi(t)})},{kernelName:"OneHot",inputsToSave:["indices"],gradFunc:(t,e)=>{const n=e[0];return{indices:()=>is(n.shape,"float32")}}},{kernelName:"OnesLike",gradFunc:t=>({x:()=>Qr(t)})},dh,dh,{kernelName:"Pow",inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(t,e)=>{const[n,r,i]=e,s=n,o=r,a=Kr(s.shape,o.shape);return{a:()=>{const e=an(o,"float32");let n=Xn(t,Xn(e,Es(s,Gi(e,Si(1)))));const r=Yr(s.shape,a);return r.length>0&&(n=Yi(n,r)),Ke(n,s.shape)},b:()=>{const e=yi(s,0),n=Zr(e,Fi(s),Qr(s));let r=Xn(t,Xn(i,n));const l=Yr(o.shape,a);return l.length>0&&(r=Yi(r,l)),Ke(r,o.shape)}}}},{kernelName:"Prelu",inputsToSave:["x","alpha"],gradFunc:(t,e)=>{const[n,r]=e,i=yi(n,0);return{x:()=>Zr(i,t,Xn(t,r)),alpha:()=>{let e=Zr(i,Qr(t),Xn(t,n));const s=Yr(r.shape,t.shape);return s.length>0&&(e=Yi(e,s)),Ke(e,r.shape)}}}},{kernelName:"Reciprocal",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Hr(t,Vi(cs(n)))}}},{kernelName:"Relu6",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,r=Xn(Oi(n,6),So(n));return{x:()=>Xn(t,an(r,"float32"))}}},{kernelName:"Relu",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Xn(t,an(So(n),"float32"))}}},{kernelName:"Reshape",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ke(t,n.shape)}}},{kernelName:"ResizeBilinear",inputsToSave:["images"],gradFunc:(t,e,n)=>{const[r]=e,i=e=>{const{alignCorners:i}=n;return e.resizeBilinearBackprop(t,r,i)},s={images:r};return{images:()=>Ee.runKernelFunc(i,s,null,"ResizeBilinearGrad",n)}}},{kernelName:"ResizeNearestNeighbor",inputsToSave:["images"],gradFunc:(t,e,n)=>{const[r]=e,i=e=>{const{alignCorners:i}=n;return e.resizeNearestNeighborBackprop(t,r,i)},s={images:r};return{images:()=>Ee.runKernelFunc(i,s,null,"ResizeNearestNeighborGrad",n)}}},{kernelName:"Reverse",gradFunc:(t,e,n)=>{const{dims:r}=n,i=Et(r,t.shape);return{x:()=>wi(t,i)}}},{kernelName:"Round",gradFunc:t=>({x:()=>Qr(t)})},{kernelName:"Rsqrt",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Vi(Hr(t,Xn(Es(n,1.5),2)))}}},{kernelName:"SelectV2",inputsToSave:["condition"],gradFunc:(t,e)=>{const[n]=e;return{condition:()=>an(Qr(n),"float32"),t:()=>Xn(t,an(n,t.dtype)),e:()=>Xn(t,an(Qi(n),t.dtype))}}},{kernelName:"Selu",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const e=yi(n,Si(0)),r=Si($u),i=Si(Pu),s=Xn(t,i),o=Xn(Xn(t,r),ri(an(n,"float32")));return Zr(e,s,o)}}}},{kernelName:"Sigmoid",outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Xn(t,Xn(n,Gi(Si(1),n)))}}},{kernelName:"Sign",gradFunc:t=>({x:()=>Qr(t)})},{kernelName:"Sin",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Xn(zr(an(n,"float32")),t)}}},{kernelName:"Sinh",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Xn(Lr(an(n,"float32")),t)}}},{kernelName:"Slice",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{begin:i,size:s}=n,o=r.shape,[a,l]=hr(r,i,s),u=[];for(let c=0;c<t.rank;c++)u.push([a[c],o[c]-a[c]-l[c]]);return{x:()=>vs(t,u)}}},{kernelName:"Softmax",outputsToSave:[!0],gradFunc:(t,e,n)=>{const[r]=e,{dim:i}=n,s=Xn(t,r);return{logits:()=>Gi(s,Xn(Yi(s,[i],!0),r))}}},{kernelName:"Softplus",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Xn(t,Zn(n))}}},fh,fh,ph,ph,{kernelName:"Sqrt",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Hr(t,Xn(bo(an(n,"float32")),2))}}},{kernelName:"SquaredDifference",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=Si(2);return{a:()=>Xn(t,Xn(i,Gi(n,r))),b:()=>Xn(t,Xn(i,Gi(r,n)))}}},{kernelName:"Square",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Xn(t,Xn(an(n,"float32"),2))}}},{kernelName:"Step",gradFunc:t=>({x:()=>Qr(t)})},{kernelName:"Sub",inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,r]=e,i=Kr(n.shape,r.shape);return{a:()=>{let e=t;const r=Yr(n.shape,i);return r.length>0&&(e=Yi(e,r)),Ke(e,n.shape)},b:()=>{let e=t;const n=Yr(r.shape,i);return n.length>0&&(e=Yi(e,n)),Ke(Vi(e),r.shape)}}}},{kernelName:"Sum",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,i=r.shape.slice(),{axis:s}=n;Et(s,r.shape).forEach(t=>{i[t]=1});const o=Ke(t,i),a=Xn(o,ss(r.shape,"float32"));return{x:()=>a}}},{kernelName:"Tan",inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Hr(t,cs(zr(n)))}}},{kernelName:"Tanh",outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Xn(Gi(Si(1),cs(n)),t)}}},{kernelName:"Tile",inputsToSave:["x"],gradFunc:(t,e,n)=>{const[r]=e,{reps:i}=n;return{x:()=>{let e=Qr(r);if(1===r.rank)for(let n=0;n<i[0];++n)e=Le(e,dr(t,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(let n=0;n<i[0];++n)for(let s=0;s<i[1];++s)e=Le(e,dr(t,[n*r.shape[0],s*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(let n=0;n<i[0];++n)for(let s=0;s<i[1];++s)for(let o=0;o<i[2];++o)e=Le(e,dr(t,[n*r.shape[0],s*r.shape[1],o*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(let n=0;n<i[0];++n)for(let s=0;s<i[1];++s)for(let o=0;o<i[2];++o)for(let a=0;a<i[3];++a)e=Le(e,dr(t,[n*r.shape[0],s*r.shape[1],o*r.shape[2],a*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return e}}}},{kernelName:"Transpose",gradFunc:(t,e,n)=>{const r=n,{perm:i}=r,s=Ge(i);return{x:()=>Xe(t,s)}}},{kernelName:"Unpack",gradFunc:(t,e,n)=>{const r=n,{axis:i}=r;return{value:()=>wo(t,i)}}},{kernelName:"UnsortedSegmentSum",inputsToSave:["segmentIds"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>function(t,e){const n=Di(e,Qr(e)),r=gi(t,n);let i=vi(e,Si(0,"int32"));const s=r.rank-i.rank;for(let a=0;a<s;++a)i=ii(i,a+1);i=Zi(i,ss(r.shape,"bool"));const o=Qr(r);return Zr(i,r,o)}(t,n)}}},{kernelName:"ZerosLike",gradFunc:t=>({x:()=>Qr(t)})}];for(const $C of mh)et($C);let gh;function yh(){return null==gh&&(gh=jn().epsilon()),gh}ue.prototype.abs=function(){return this.throwIfDisposed(),$e(this)},ue.prototype.acos=function(){return this.throwIfDisposed(),Pe(this)},ue.prototype.acosh=function(){return this.throwIfDisposed(),ze(this)},ue.prototype.addStrict=function(t){return this.throwIfDisposed(),qo(this,t)},ue.prototype.add=function(t){return this.throwIfDisposed(),Le(this,t)},ue.prototype.all=function(t,e){return this.throwIfDisposed(),Ze(this,t,e)},ue.prototype.any=function(t,e){return this.throwIfDisposed(),Qe(this,t,e)},ue.prototype.argMax=function(t){return this.throwIfDisposed(),Je(this,t)},ue.prototype.argMin=function(t){return this.throwIfDisposed(),tn(this,t)},ue.prototype.asScalar=function(){return this.throwIfDisposed(),ht(1===this.size,()=>"The array must have only 1 element."),Ke(this,[])},ue.prototype.asType=function(t){return this.throwIfDisposed(),an(this,t)},ue.prototype.as1D=function(){return this.throwIfDisposed(),Ke(this,[this.size])},ue.prototype.as2D=function(t,e){return this.throwIfDisposed(),Ke(this,[t,e])},ue.prototype.as3D=function(t,e,n){return this.throwIfDisposed(),Ke(this,[t,e,n])},ue.prototype.as4D=function(t,e,n,r){return this.throwIfDisposed(),Ke(this,[t,e,n,r])},ue.prototype.as5D=function(t,e,n,r,i){return this.throwIfDisposed(),Ke(this,[t,e,n,r,i])},ue.prototype.asin=function(){return this.throwIfDisposed(),en(this)},ue.prototype.asinh=function(){return this.throwIfDisposed(),nn(this)},ue.prototype.atan=function(){return this.throwIfDisposed(),rn(this)},ue.prototype.atan2=function(t){return this.throwIfDisposed(),sn(this,t)},ue.prototype.atanh=function(){return this.throwIfDisposed(),on(this)},ue.prototype.avgPool=function(t,e,n,r){return this.throwIfDisposed(),_n(this,t,e,n,r)},ue.prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),mr(this,t,e)},ue.prototype.batchNorm=function(t,e,n,r,i){return this.throwIfDisposed(),yr(this,t,e,n,r,i)},ue.prototype.broadcastTo=function(t){return this.throwIfDisposed(),wr(this,t)},ue.prototype.cast=function(t){return this.throwIfDisposed(),an(this,t)},ue.prototype.ceil=function(){return this.throwIfDisposed(),Cr(this)},ue.prototype.clipByValue=function(t,e){return this.throwIfDisposed(),Er(this,t,e)},ue.prototype.concat=function(t,e){return this.throwIfDisposed(),t instanceof ue&&(t=[t]),Yn([this,...t],e)},ue.prototype.conv1d=function(t,e,n,r,i,s){return this.throwIfDisposed(),Ir(this,t,e,n,r,i,s)},ue.prototype.conv2dTranspose=function(t,e,n,r,i){return this.throwIfDisposed(),Fr(this,t,e,n,r,i)},ue.prototype.conv2d=function(t,e,n,r,i,s){return this.throwIfDisposed(),Or(this,t,e,n,r,i,s)},ue.prototype.cos=function(){return this.throwIfDisposed(),zr(this)},ue.prototype.cosh=function(){return this.throwIfDisposed(),Lr(this)},ue.prototype.cumsum=function(t,e,n){return this.throwIfDisposed(),Br(this,t,e,n)},ue.prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),jr(this,t,e)},ue.prototype.depthwiseConv2D=function(t,e,n,r,i,s){return En("depthwiseConv2D is deprecated, use depthwiseConv2d instead"),this.throwIfDisposed(),Ur(this,t,e,n,r,i,s)},ue.prototype.depthwiseConv2d=function(t,e,n,r,i,s){return this.throwIfDisposed(),Ur(this,t,e,n,r,i,s)},ue.prototype.dilation2d=function(t,e,n,r,i){return this.throwIfDisposed(),Wr(this,t,e,n,r,i)},ue.prototype.divNoNan=function(t){return this.throwIfDisposed(),Jr(this,t)},ue.prototype.divStrict=function(t){return this.throwIfDisposed(),Ho(this,t)},ue.prototype.div=function(t){return this.throwIfDisposed(),Hr(this,t)},ue.prototype.dot=function(t){return this.throwIfDisposed(),ti(this,t)},ue.prototype.elu=function(){return this.throwIfDisposed(),ei(this)},ue.prototype.equalStrict=function(t){return this.throwIfDisposed(),Lo(this,t)},ue.prototype.equal=function(t){return this.throwIfDisposed(),Xr(this,t)},ue.prototype.erf=function(){return this.throwIfDisposed(),ni(this)},ue.prototype.exp=function(){return this.throwIfDisposed(),ri(this)},ue.prototype.expandDims=function(t){return this.throwIfDisposed(),ii(this,t)},ue.prototype.expm1=function(){return this.throwIfDisposed(),si(this)},ue.prototype.fft=function(){return this.throwIfDisposed(),li(this)},ue.prototype.flatten=function(){return this.throwIfDisposed(),Ke(this,[this.size])},ue.prototype.floor=function(){return this.throwIfDisposed(),ci(this)},ue.prototype.floorDiv=function(t){return this.throwIfDisposed(),qr(this,t)},ue.prototype.gather=function(t,e){return this.throwIfDisposed(),gi(this,t,e)},ue.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),Bo(this,t)},ue.prototype.greaterEqual=function(t){return this.throwIfDisposed(),vi(this,t)},ue.prototype.greaterStrict=function(t){return this.throwIfDisposed(),jo(this,t)},ue.prototype.greater=function(t){return this.throwIfDisposed(),yi(this,t)},ue.prototype.ifft=function(){return this.throwIfDisposed(),bi(this)},ue.prototype.irfft=function(){return this.throwIfDisposed(),Ci(this)},ue.prototype.isFinite=function(){return this.throwIfDisposed(),Ei(this)},ue.prototype.isInf=function(){return this.throwIfDisposed(),ki(this)},ue.prototype.isNaN=function(){return this.throwIfDisposed(),Ai(this)},ue.prototype.leakyRelu=function(t){return this.throwIfDisposed(),Ni(this,t)},ue.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),Uo(this,t)},ue.prototype.lessEqual=function(t){return this.throwIfDisposed(),Oi(this,t)},ue.prototype.lessStrict=function(t){return this.throwIfDisposed(),Vo(this,t)},ue.prototype.less=function(t){return this.throwIfDisposed(),Ti(this,t)},ue.prototype.localResponseNormalization=function(t,e,n,r){return this.throwIfDisposed(),Ri(this,t,e,n,r)},ue.prototype.logSigmoid=function(){return this.throwIfDisposed(),qi(this)},ue.prototype.logSoftmax=function(t){return this.throwIfDisposed(),Ki(this,t)},ue.prototype.logSumExp=function(t,e){return this.throwIfDisposed(),Xi(this,t,e)},ue.prototype.log=function(){return this.throwIfDisposed(),Fi(this)},ue.prototype.log1p=function(){return this.throwIfDisposed(),Mi(this)},ue.prototype.logicalAnd=function(t){return this.throwIfDisposed(),Zi(this,t)},ue.prototype.logicalNot=function(){return this.throwIfDisposed(),Qi(this)},ue.prototype.logicalOr=function(t){return this.throwIfDisposed(),Ji(this,t)},ue.prototype.logicalXor=function(t){return this.throwIfDisposed(),ts(this,t)},ue.prototype.matMul=function(t,e,n){return this.throwIfDisposed(),Kn(this,t,e,n)},ue.prototype.maxPool=function(t,e,n,r){return this.throwIfDisposed(),es(this,t,e,n,r)},ue.prototype.max=function(t,e){return this.throwIfDisposed(),Hi(this,t,e)},ue.prototype.maximumStrict=function(t){return this.throwIfDisposed(),Go(this,t)},ue.prototype.maximum=function(t){return this.throwIfDisposed(),Di(this,t)},ue.prototype.mean=function(t,e){return this.throwIfDisposed(),os(this,t,e)},ue.prototype.min=function(t,e){return this.throwIfDisposed(),as(this,t,e)},ue.prototype.minimumStrict=function(t){return this.throwIfDisposed(),Yo(this,t)},ue.prototype.minimum=function(t){return this.throwIfDisposed(),ls(this,t)},ue.prototype.modStrict=function(t){return this.throwIfDisposed(),Ko(this,t)},ue.prototype.mod=function(t){return this.throwIfDisposed(),us(this,t)},ue.prototype.mulStrict=function(t){return this.throwIfDisposed(),Xo(this,t)},ue.prototype.mul=function(t){return this.throwIfDisposed(),Xn(this,t)},ue.prototype.neg=function(){return this.throwIfDisposed(),Vi(this)},ue.prototype.norm=function(t,e,n){return this.throwIfDisposed(),ta(this,t,e,n)},ue.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),Wo(this,t)},ue.prototype.notEqual=function(t){return this.throwIfDisposed(),ps(this,t)},ue.prototype.oneHot=function(t,e=1,n=0){return this.throwIfDisposed(),ms(this,t,e,n)},ue.prototype.onesLike=function(){return this.throwIfDisposed(),gs(this)},ue.prototype.pad=function(t,e){return this.throwIfDisposed(),vs(this,t,e)},ue.prototype.pool=function(t,e,n,r,i){return this.throwIfDisposed(),Cs(this,t,e,n,r,i)},ue.prototype.powStrict=function(t){return this.throwIfDisposed(),Zo(this,t)},ue.prototype.pow=function(t){return this.throwIfDisposed(),Es(this,t)},ue.prototype.prelu=function(t){return this.throwIfDisposed(),ks(this,t)},ue.prototype.prod=function(t,e){return this.throwIfDisposed(),Ds(this,t,e)},ue.prototype.reciprocal=function(){return this.throwIfDisposed(),Ks(this)},ue.prototype.relu=function(){return this.throwIfDisposed(),Xs(this)},ue.prototype.relu6=function(){return this.throwIfDisposed(),Zs(this)},ue.prototype.reshapeAs=function(t){return this.throwIfDisposed(),Ke(this,t.shape)},ue.prototype.reshape=function(t){return this.throwIfDisposed(),Ke(this,t)},ue.prototype.resizeBilinear=function(t,e){return this.throwIfDisposed(),Ua(this,t,e)},ue.prototype.resizeNearestNeighbor=function(t,e){return this.throwIfDisposed(),Va(this,t,e)},ue.prototype.reverse=function(t){return this.throwIfDisposed(),wi(this,t)},ue.prototype.rfft=function(){return this.throwIfDisposed(),io(this)},ue.prototype.round=function(){return this.throwIfDisposed(),so(this)},ue.prototype.rsqrt=function(){return this.throwIfDisposed(),oo(this)},ue.prototype.selu=function(){return this.throwIfDisposed(),ao(this)},ue.prototype.separableConv2d=function(t,e,n,r,i,s){return this.throwIfDisposed(),lo(this,t,e,n,r,i,s)},ue.prototype.sigmoid=function(){return this.throwIfDisposed(),Zn(this)},ue.prototype.sign=function(){return this.throwIfDisposed(),co(this)},ue.prototype.sin=function(){return this.throwIfDisposed(),ho(this)},ue.prototype.sinh=function(){return this.throwIfDisposed(),fo(this)},ue.prototype.slice=function(t,e){return this.throwIfDisposed(),dr(this,t,e)},ue.prototype.softmax=function(t){return this.throwIfDisposed(),vo(this,t)},ue.prototype.softplus=function(){return this.throwIfDisposed(),Wi(this)},ue.prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),Ss(this,t,e)},ue.prototype.split=function(t,e){return this.throwIfDisposed(),ro(this,t,e)},ue.prototype.sqrt=function(){return this.throwIfDisposed(),bo(this)},ue.prototype.square=function(){return this.throwIfDisposed(),cs(this)},ue.prototype.squaredDifference=function(t){return this.throwIfDisposed(),xo(this,t)},ue.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),Qo(this,t)},ue.prototype.squeeze=function(t){return this.throwIfDisposed(),_o(this,t)},ue.prototype.stack=function(t,e){this.throwIfDisposed();const n=t instanceof ue?[this,t]:[this,...t];return wo(n,e)},ue.prototype.step=function(t){return this.throwIfDisposed(),So(this,t)},ue.prototype.stridedSlice=function(t,e,n,r,i,s,o,a){return this.throwIfDisposed(),Co(this,t,e,n,r,i,s,o,a)},ue.prototype.subStrict=function(t){return this.throwIfDisposed(),Jo(this,t)},ue.prototype.sub=function(t){return this.throwIfDisposed(),Gi(this,t)},ue.prototype.sum=function(t,e){return this.throwIfDisposed(),Yi(this,t,e)},ue.prototype.tan=function(){return this.throwIfDisposed(),Eo(this)},ue.prototype.tanh=function(){return this.throwIfDisposed(),fr(this)},ue.prototype.tile=function(t){return this.throwIfDisposed(),oi(this,t)},ue.prototype.toBool=function(){return this.throwIfDisposed(),an(this,"bool")},ue.prototype.toFloat=function(){return this.throwIfDisposed(),an(this,"float32")},ue.prototype.toInt=function(){return this.throwIfDisposed(),an(this,"int32")},ue.prototype.topk=function(t,e){return this.throwIfDisposed(),Oo(this,t,e)},ue.prototype.transpose=function(t){return this.throwIfDisposed(),Xe(this,t)},ue.prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),Ro(this,t,e)},ue.prototype.unstack=function(t){return this.throwIfDisposed(),Fo(this,t)},ue.prototype.where=function(t,e){return this.throwIfDisposed(),Zr(t,this,e)},ue.prototype.zerosLike=function(){return this.throwIfDisposed(),Qr(this)};class vh extends Error{constructor(t){super(t),Object.setPrototypeOf(this,vh.prototype)}}class bh extends Error{constructor(t){super(t),Object.setPrototypeOf(this,bh.prototype)}}class xh extends Error{constructor(t){super(t),Object.setPrototypeOf(this,xh.prototype)}}class _h extends Error{constructor(t){super(t),Object.setPrototypeOf(this,_h.prototype)}}class wh extends Error{constructor(t){super(t),Object.setPrototypeOf(this,wh.prototype)}}function Sh(t,e){if(Array.isArray(t)){let n=[];for(let r=0;r<e;r++)n=n.concat(t);return n}{const n=new Array(e);return n.fill(t),n}}function Ch(t,e){if(!t)throw new wh(e)}function Eh(t,e){let n=0;for(const r of t)r===e&&n++;return n}function kh(t){return 1===t.length?t[0]:t}function Ah(t){return Array.isArray(t)?t:[t]}function Dh(t){const e=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==e[0]?e:"private"+e}function Nh(t){return t.length<=1||-1===t.indexOf("_")?t:t.replace(/[_]+(\w|$)/g,(t,e)=>e.toUpperCase())}Error;let Th={};function Oh(t){if(null==t)return null;const e={};return e.className=t.getClassName(),e.config=t.getConfig(),e}function Ih(t,e={},n={},r="object",i=!1){if("string"==typeof t){const i=t;let s;if(i in n)s=n[i];else if(i in Th)s=Th[i];else if(s=e[i],null==s)throw new xh(`Unknown ${r}: ${t}. This may be due to one of the following reasons:\n1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return s}{const s=t;if(null==s.className||null==s.config)throw new xh(r+": Improper config format: "+JSON.stringify(s)+".\n'className' and 'config' must set.");const o=s.className;let a,l;if(o in n?[a,l]=n[o]:o in Th?[a,l]=Th.className:o in e&&([a,l]=e[o]),null==a)throw new xh(`Unknown ${r}: ${o}. This may be due to one of the following reasons:\n1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(null!=l){const t={};for(const n of Object.keys(Th))t[n]=Th[n];for(const i of Object.keys(n))t[i]=n[i];s.config.customObjects=t;const e=Object.assign({},Th);for(const i of Object.keys(n))Th[i]=n[i];!function t(e){if(null!=e&&"object"==typeof e)if(Array.isArray(e))e.forEach(e=>t(e));else{const n=Object.keys(e);for(const r of n){const n=e[r];null!=n&&"object"==typeof n&&(Array.isArray(n)||"ndarray"!==n.type||"number"!=typeof n.value?t(n):e[r]=n.value)}}}(s.config);const r=l(a,s.config,n,i);return Th=Object.assign({},e),r}{const t=Object.assign({},Th);for(const r of Object.keys(n))Th[r]=n[r];const e=new a(s.config);return Th=Object.assign({},t),e}}}function Rh(t,e){return-1*function(t,e){return t<e?-1:t>e?1:0}(t,e)}function Fh(t){if(null==t)return t;const e=[];for(const n of t)-1===e.indexOf(n)&&e.push(n);return e}function Mh(t){if(null==t)throw new xh("Invalid value in obj: "+JSON.stringify(t));for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}function $h(t,e,n){if(null!=n&&t.indexOf(n)<0)throw new xh(`${n} is not a valid ${e}.  Valid values are ${t} or null/undefined.`)}function Ph(t,e,n=0,r=1/0){return Ch(n>=0),Ch(r>=n),Array.isArray(t)&&t.length>=n&&t.length<=r&&t.every(t=>typeof t===e)}function zh(t,e){Array.isArray(t)?(r.assert(t.length>0,()=>e+" is unexpectedly an empty array."),t.forEach((t,n)=>zh(t,`element ${n+1} of ${e}`))):r.assert(Number.isInteger(t)&&t>0,()=>`Expected ${e} to be a positive integer, but got `+function t(e){return null===e?"null":Array.isArray(e)?"["+e.map(e=>t(e)).join(",")+"]":"string"==typeof e?`"${e}"`:""+e}(t)+".")}function Lh(t){return"relu"===t?"relu":"linear"===t?"linear":"elu"===t?"elu":null}function Bh(t,e){return Tn(()=>bo(Yi(Xn(t,t),e,!0)))}class jh extends g.Serializable{getConfig(){return{}}}class Uh extends jh{constructor(t){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=null!=t.maxValue?t.maxValue:this.defaultMaxValue,this.axis=null!=t.axis?t.axis:this.defaultAxis}apply(t){return Tn(()=>{const e=Bh(t,this.axis),n=Er(e,0,this.maxValue);return Xn(t,Hr(n,Le(yh(),e)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}Uh.className="MaxNorm",g.registerClass(Uh);class Vh extends jh{constructor(t){super(),this.defaultAxis=0,this.axis=null!=t.axis?t.axis:this.defaultAxis}apply(t){return Tn(()=>Hr(t,Le(yh(),Bh(t,this.axis))))}getConfig(){return{axis:this.axis}}}Vh.className="UnitNorm",g.registerClass(Vh);class Wh extends jh{apply(t){return Xs(t)}}Wh.className="NonNeg",g.registerClass(Wh);class qh extends jh{constructor(t){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=null!=t.minValue?t.minValue:this.defaultMinValue,this.maxValue=null!=t.maxValue?t.maxValue:this.defaultMaxValue,this.rate=null!=t.rate?t.rate:this.defaultRate,this.axis=null!=t.axis?t.axis:this.defaultAxis}apply(t){return Tn(()=>{const e=Bh(t,this.axis),n=Le(Xn(this.rate,Er(e,this.minValue,this.maxValue)),Xn(1-this.rate,e));return Xn(t,Hr(n,Le(yh(),e)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}qh.className="MinMaxNorm",g.registerClass(qh);const Hh={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Gh(t){return Oh(t)}function Yh(t,e={}){return Ih(t,g.SerializationMap.getMap().classNameMap,e,"constraint")}function Kh(t){return null==t?null:"string"==typeof t?Yh({className:t in Hh?Hh[t]:t,config:{}}):t instanceof jh?t:Yh(t)}function Xh(t){return new Uh(t)}function Zh(t){return new Vh(t)}function Qh(){return new Wh}function Jh(t){return new qh(t)}const td=["channelsFirst","channelsLast"],ed=["valid","same","causal"],nd=["max","avg"],rd=["sum","mul","concat","ave"],id=new Map;function sd(t){$h(td,"DataFormat",t)}function od(t){$h(ed,"PaddingMode",t)}function ad(t){$h(nd,"PoolMode",t)}const ld=[];function ud(t,e){ld.push(t);try{const t=e();return ld.pop(),t}catch(n){throw ld.pop(),n}}function cd(t){if(!fd(t))throw new Error("Not a valid tensor name: '"+t+"'");return(0===ld.length?"":ld.join("/")+"/")+t}function hd(t){if(!fd(t))throw new Error("Not a valid tensor name: '"+t+"'");id.has(t)||id.set(t,0);const e=id.get(t);if(id.set(t,id.get(t)+1),e>0){const n=`${t}_${e}`;return id.set(n,1),n}return t}const dd=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function fd(t){return!!t.match(dd)}function pd(t,e,n){null==e&&(e=0),null==n&&(n=t.length);let r=1;for(let i=e;i<n;++i)r*=t[i];return r}function md(t){return Gs(t=Array.isArray(t)?new Float32Array(t):t)}function gd(t){return as(md(t)).dataSync()[0]}function yd(t){return Hi(md(t)).dataSync()[0]}function vd(t,e){if(e<t)throw new xh(`end (${e}) < begin (${t}) is forbidden.`);const n=[];for(let r=t;r<e;++r)n.push(r);return n}function bd(t,e){return t.asType(e)}function xd(t,e=-1){const n=t.shape.slice();return e<0&&(e=n.length+e+1),n.splice(e,0,1),t.reshape(n)}function _d(t,e,n){return Tn(()=>{switch(t.rank){case 1:return po(t,e,n);case 2:return mo(t,[e,0],[n,t.shape[1]]);case 3:return go(t,[e,0,0],[n,t.shape[1],t.shape[2]]);case 4:return yo(t,[e,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3]]);case 5:return dr(t,[e,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return dr(t,[e,0,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new xh("sliceAlongFirstAxis() received an unsupported tensor rank: "+t.rank)}})}function wd(t,e,n){return Tn(()=>{switch(t.rank){case 1:return po(t,e,n);case 2:return mo(t,[0,e],[t.shape[0],n]);case 3:return go(t,[0,0,e],[t.shape[0],t.shape[1],n]);case 4:return yo(t,[0,0,0,e],[t.shape[0],t.shape[1],t.shape[2],n]);default:throw new xh("sliceAlongLastAxis() received an unsupported tensor rank: "+t.rank)}})}function Sd(t,e,n,r){return Tn(()=>{switch(t.rank){case 1:return po(t,e,n);case 2:switch(r){case 1:return _d(t,e,n);case 2:return wd(t,e,n);default:throw new xh("The axis is not within the rank of the tensor "+r)}case 3:switch(r){case 1:return _d(t,e,n);case 2:return go(t,[0,e,0],[t.shape[0],n,t.shape[2]]);case 3:return wd(t,e,n);default:throw new xh("The axis is not within the rank of the tensor "+r)}case 4:switch(r){case 1:return _d(t,e,n);case 2:return yo(t,[0,e,0,0],[t.shape[0],n,t.shape[2],t.shape[3]]);case 3:return yo(t,[0,0,e,0],[t.shape[0],t.shape[1],n,t.shape[3]]);case 4:return wd(t,e,n);default:throw new xh("The axis is not within the rank of the tensor "+r)}default:throw new xh("sliceAlongLastAxis() received an unsupported tensor rank: "+t.rank)}})}function Cd(t,e=-1){let n;return e<0&&(n=t[0].rank,e=0!==n?n:0),e===t[0].rank&&(e=-1),Yn(t,e)}function Ed(t,e){switch(t.rank){case 1:return Ar([t,e]);case 2:return Dr([t,e],0);case 3:return Nr([t,e],0);case 4:return Tr([t,e],0);default:throw new xh("concatAlongFirstAxis() received an unsupported tensor rank: "+t.rank)}}function kd(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new xh(`The length of input n (${e.length}) does not match the number of dimensions in input x (${t.rank})`);return oi(t,e)}function Ad(t,e=0,n=1,r,i){return qs(t,e,n,r,i)}function Dd(t,e,n,r){if(t.rank<2||e.rank<2)throw new _h(`dot requires both inputs to be rank >= 2 but got x shape = ${t.shape} and y shape = ${e.shape}`);if(e.rank>=3&&t.shape.slice(-1)[0]!==e.shape.slice(-2)[0])throw new _h(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${t.shape} and  y shape = `+e.shape);if(2===t.rank&&2===e.rank)return c.matMul({a:t,b:e,transposeA:!1,transposeB:!1,bias:r?Od(t.rank,r,"channelsLast"):null,activation:n});{const i=t.shape.slice(),s=i.pop();t=t.reshape([-1,s]);const o=e.shape.slice(),a=o.pop(),l=o.pop(),u=[...o,a],h=Array.from({length:e.rank},(t,n)=>0===n?e.rank-2:n<=e.rank-2?n-1:n);e=e.transpose(h).reshape([l,-1]);const d=[...i,...u];return c.matMul({a:t,b:e,transposeA:!1,transposeB:!1,bias:r?Od(t.rank,r,"channelsLast"):null,activation:n}).reshape(d)}}function Nd(t,e,n){return Tn(()=>(e=Array.isArray(e)?Gs(e,"int32"):e.toInt(),gi(t,e,n)))}function Td(t){return Xn(t,t)}function Od(t,e,n){const r=e.shape;if(1!==e.rank&&e.rank!==t)throw new xh("Unexpected bias dimensions: "+e.rank+"; expected it to be 1 or "+t);if(5===t){if("channelsFirst"===n)return e.reshape(1===r.length?[1,r[0],1,1,1]:[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return e.reshape(1===r.length?[1,1,1,1,r[0]]:[1].concat(r))}else if(4===t){if("channelsFirst"===n)return e.reshape(1===r.length?[1,r[0],1,1]:[1,r[2],r[0],r[1]]);if("channelsLast"===n)return e.reshape(1===r.length?[1,1,1,r[0]]:[1].concat(r))}else if(3===t){if("channelsFirst"===n)return e.reshape(1===r.length?[1,r[0],1]:[1,r[1],r[0]]);if("channelsLast"===n)return e.reshape(1===r.length?[1,1,r[0]]:[1].concat(r))}else if(t<3)return e;throw new xh("Unsupported input rank by biasAdd: "+e.rank)}function Id(t,e,n){return Tn(()=>(null==n&&(n="channelsLast"),sd(n),t.add(Od(t.rank,e,n))))}function Rd(t,e,n,r){return Tn(()=>la(t,e,n,r))}function Fd(t,e,n=!1){return n?t():e()}const Md=["fanIn","fanOut","fanAvg"],$d=["normal","uniform","truncatedNormal"];class Pd extends g.Serializable{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class zd extends Pd{apply(t,e){return is(t,e)}}zd.className="Zeros",g.registerClass(zd);class Ld extends Pd{apply(t,e){return ss(t,e)}}Ld.className="Ones",g.registerClass(Ld);class Bd extends Pd{constructor(t){if(super(),"object"!=typeof t)throw new xh("Expected argument of type ConstantConfig but got "+t);if(void 0===t.value)throw new xh("config must have value set but got "+t);this.value=t.value}apply(t,e){return Tn(()=>Xn(Si(this.value),ss(t,e)))}getConfig(){return{value:this.value}}}Bd.className="Constant",g.registerClass(Bd);class jd extends Pd{constructor(t){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=t.minval||this.DEFAULT_MINVAL,this.maxval=t.maxval||this.DEFAULT_MAXVAL,this.seed=t.seed}apply(t,e){return Hs(t,this.minval,this.maxval,e)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}jd.className="RandomUniform",g.registerClass(jd);class Ud extends Pd{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,e){if("float32"!==(e=e||"float32")&&"int32"!==e)throw new _h(`randomNormal does not support dType ${e}.`);return Ad(t,this.mean,this.stddev,e,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}Ud.className="RandomNormal",g.registerClass(Ud);class Vd extends Pd{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,e){if("float32"!==(e=e||"float32")&&"int32"!==e)throw new _h(`truncatedNormal does not support dType ${e}.`);return Io(t,this.mean,this.stddev,e,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}Vd.className="TruncatedNormal",g.registerClass(Vd);class Wd extends Pd{constructor(t){super(),this.gain=null!=t.gain?t.gain:1}apply(t,e){return Tn(()=>{if(2!==t.length||t[0]!==t[1])throw new xh("Identity matrix initializer can only be used for 2D square matrices.");return Xn(this.gain,ai(t[0]))})}getConfig(){return{gain:this.gain}}}Wd.className="Identity",g.registerClass(Wd);class qd extends Pd{constructor(t){if(super(),t.scale<0)throw new xh("scale must be a positive float. Got: "+t.scale);this.scale=null==t.scale?1:t.scale,this.mode=null==t.mode?"fanIn":t.mode,$h(Md,"FanMode",this.mode),this.distribution=null==t.distribution?"normal":t.distribution,function(t){$h($d,"Distribution",t)}(this.distribution),this.seed=t.seed}apply(t,e){const n=function(t,e="channelsLast"){let n,r;if(sd(e),2===t.length)n=t[0],r=t[1];else if(-1!==[3,4,5].indexOf(t.length)){if("channelsFirst"===e){const e=pd(t,2);n=t[1]*e,r=t[0]*e}else if("channelsLast"===e){const e=pd(t,0,t.length-2);n=t[t.length-2]*e,r=t[t.length-1]*e}}else{const e=pd(t);n=Math.sqrt(e),r=Math.sqrt(e)}return[n,r]}(t),r=n[0],i=n[1];let s=this.scale;if(s/="fanIn"===this.mode?Math.max(1,r):"fanOut"===this.mode?Math.max(1,i):Math.max(1,(r+i)/2),"normal"===this.distribution){const n=Math.sqrt(s);if("float32"!==(e=e||"float32")&&"int32"!==e)throw new _h(`${this.getClassName()} does not support dType ${e}.`);return Io(t,0,n,e,this.seed)}{const n=Math.sqrt(3*s);return Hs(t,-n,n,e)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}qd.className="VarianceScaling",g.registerClass(qd);class Hd extends qd{constructor(t){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:null==t?null:t.seed})}getClassName(){return qd.className}}Hd.className="GlorotUniform",g.registerClass(Hd);class Gd extends qd{constructor(t){super({scale:1,mode:"fanAvg",distribution:"normal",seed:null==t?null:t.seed})}getClassName(){return qd.className}}Gd.className="GlorotNormal",g.registerClass(Gd);class Yd extends qd{constructor(t){super({scale:2,mode:"fanIn",distribution:"normal",seed:null==t?null:t.seed})}getClassName(){return qd.className}}Yd.className="HeNormal",g.registerClass(Yd);class Kd extends qd{constructor(t){super({scale:2,mode:"fanIn",distribution:"uniform",seed:null==t?null:t.seed})}getClassName(){return qd.className}}Kd.className="HeUniform",g.registerClass(Kd);class Xd extends qd{constructor(t){super({scale:1,mode:"fanIn",distribution:"normal",seed:null==t?null:t.seed})}getClassName(){return qd.className}}Xd.className="LeCunNormal",g.registerClass(Xd);class Zd extends qd{constructor(t){super({scale:1,mode:"fanIn",distribution:"uniform",seed:null==t?null:t.seed})}getClassName(){return qd.className}}Zd.className="LeCunNormal",g.registerClass(Zd);class Qd extends Pd{constructor(t){if(super(),this.DEFAULT_GAIN=1,this.gain=null==t.gain?this.DEFAULT_GAIN:t.gain,this.seed=t.seed,null!=this.seed)throw new _h("Random seed is not implemented for Orthogonal Initializer yet.")}apply(t,e){return Tn(()=>{if(2!==t.length)throw new _h("The Orthogonal Initializer does not support non-2D shapes yet.");t[0]*t[1]>2e3&&console.warn(`Orthogonal initializer is being called on a matrix with more than 2000 (${t[0]*t[1]}) elements: Slowness may result.`);const e=Ad(t[0]>t[1]?[t[1],t[0]]:t,0,1,"float32");let n=al.gramSchmidt(e);return t[0]>t[1]&&(n=n.transpose()),Xn(this.gain,n)})}getConfig(){return{gain:this.gain,seed:this.seed}}}Qd.className="Orthogonal",g.registerClass(Qd);const Jd={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function tf(t,e={}){return Ih(t,g.SerializationMap.getMap().classNameMap,e,"initializer")}function ef(t){return Oh(t)}function nf(t){if("string"==typeof t){const e=t in Jd?Jd[t]:t;if("GlorotNormal"===e)return new Gd;if("GlorotUniform"===e)return new Hd;if("HeNormal"===e)return new Yd;if("HeUniform"===e)return new Kd;if("LeCunNormal"===e)return new Xd;if("LeCunUniform"===e)return new Zd;{const t={};return t.className=e,t.config={},tf(t)}}return t instanceof Pd?t:tf(t)}function rf(){return new zd}function sf(){return new Ld}function of(t){return new Bd(t)}function af(t){return new jd(t)}function lf(t){return new Ud(t)}function uf(t){return new Vd(t)}function cf(t){return new Wd(t)}function hf(t){return new qd(t)}function df(t){return new Hd(t)}function ff(t){return new Gd(t)}function pf(t){return new Yd(t)}function mf(t){return new Kd(t)}function gf(t){return new Xd(t)}function yf(t){return new Zd(t)}function vf(t){return new Qd(t)}let bf=0;function xf(){return bf++}const _f={};function wf(t=""){return t in _f||(_f[t]=0),_f[t]+=1,t+_f[t].toString()}function Sf(t){return Array.isArray(t)&&Array.isArray(t[0])}function Cf(t){return 0===t.length?[]:Array.isArray(t[0])?t:[t]}function Ef(t){let e;if(Array.isArray(t)){if(1!==t.length)throw new xh("Expected Tensor length to be 1; got "+t.length);e=t[0]}else e=t;return e}function kf(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(1===t.length)return(t=t)[0];throw new xh("Expected exactly 1 Shape; got "+t.length)}return t}function Af(t){let e=0;for(const n of t)e+=0===n.shape.length?1:n.shape.reduce((t,e)=>t*e);return e}class Df{constructor(t,e="float32",n="Variable",r=!0,i=null){this.dtype=null==e?"float32":e,this.shape=t.shape,this.id=xf(),this.originalName=cd(n=null==n?"Variable":n),this.name=hd(this.originalName),this.trainable_=r,this.constraint=i,this.val=Mo(t,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(t){return this.assertNotDisposed(),function(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}(this.val,t),this.val.id!==t.id&&(this.val.assign(t),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(t){this.trainable_=t,this.val.trainable=t}}function Nf(t){return t.map(t=>t.read())}function Tf(t){t.forEach(t=>{t[0].write(t[1])})}class Of{constructor(t){this.dtype=t.dtype,this.shape=t.shape,this.ndim=null!=t.shape?t.shape.length:t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}}}class If{constructor(t,e,n,r,i,s,o){this.dtype=t,this.shape=e,this.sourceLayer=n,this.inputs=r,this.callArgs=i,this.outputTensorIndex=o,this.id=xf(),null!=s&&(this.originalName=cd(s),this.name=hd(this.originalName)),this.rank=e.length}}let Rf=0;class Ff{constructor(t,e){this.callArgs=e,this.id=Rf++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;for(const n of t.inboundLayers)null!=n&&n.outboundNodes.push(this);t.outboundLayer.inboundNodes.push(this)}getConfig(){const t=[];for(const e of this.inboundLayers)t.push(null!=e?e.name:null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let Mf=0;class $f extends g.Serializable{constructor(t={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=Mf++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let e=t.name;if(!e){const t=this.getClassName();e=Dh(t)+"_"+wf(t)}if(this.name=e,this.trainable_=null==t.trainable||t.trainable,null!=t.inputShape||null!=t.batchInputShape){let e;if(null!=t.batchInputShape)e=t.batchInputShape;else if(null!=t.inputShape){let n=null;null!=t.batchSize&&(n=t.batchSize),e=[n].concat(t.inputShape)}this.batchInputShape=e;let n=t.dtype;null==n&&(n=t.inputDType),null==n&&(n="float32"),this.dtype=n}this.initialWeights=null!=t.weights?t.weights:null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(t,e){return t.name+"_ib-"+e.toString()}getNodeAtIndex(t,e){if(0===this.inboundNodes.length)throw new bh(`The layer has never been called and thus has no defined ${e}.`);if(this.inboundNodes.length<=t)throw new xh(`Asked to get ${e} at node ${t}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[t]}getInputAt(t){return kh(this.getNodeAtIndex(t,"input").inputTensors)}getOutputAt(t){return kh(this.getNodeAtIndex(t,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new vh("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new vh("Layer "+this.name+" is not connected, no input to return.");return kh(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(0===this.inboundNodes.length)throw new vh("Layer "+this.name+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new vh("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return kh(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(t=>t())}get updates(){return this._updates}get built(){return this._built}set built(t){this._built=t}get trainable(){return this.trainable_}set trainable(t){this._trainableWeights.forEach(e=>e.trainable=t),this.trainable_=t}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(t=>t.trainable):[]}set trainableWeights(t){this._trainableWeights=t}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(t=>!t.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(t){this._nonTrainableWeights=t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(t){if(t=Ah(t),null==this.inputSpec||0===this.inputSpec.length)return;const e=Ah(this.inputSpec);if(t.length!==e.length)throw new xh(`Layer ${this.name} expects ${e.length} inputs, but it received ${t.length} input tensors. Input received: `+t);for(let n=0;n<t.length;n++){const r=t[n],i=e[n];if(null==i)continue;const s=r.rank;if(null!=i.ndim&&s!==i.ndim)throw new xh(`Input ${n} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${s}`);if(null!=i.maxNDim&&s>i.maxNDim)throw new xh(`Input ${n} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${s}`);if(null!=i.minNDim&&s<i.minNDim)throw new xh(`Input ${n} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${s}.`);if(null!=i.dtype&&r.dtype!==i.dtype)throw new xh(`Input ${n} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${r.dtype}.`);if(i.axes){const t=r.shape;for(const e in i.axes){const r=Number(e),s=i.axes[e],o=r>=0?t[r]:t[t.length+r];if(null!=s&&-1===[s,null].indexOf(o))throw new xh(`Input ${n} is incompatible with layer ${this.name}: expected axis ${r} of input shape to have value ${s} but got shape ${t}.`)}}if(null!=i.shape)for(let t=0;t<i.shape.length;++t){const e=i.shape[t],s=r.shape[t];if(null!=e&&null!=s&&e!==s)throw new xh(`Input ${n} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${r.shape}.`)}}}call(t,e){return t}invokeCallHook(t,e){null!=this._callHook&&this._callHook(t,e)}setCallHook(t){this._callHook=t}clearCallHook(){this._callHook=null}apply(t,e){e=e||{},this.assertNotDisposed();const n=Ah(t);let r=!0;for(const s of n)if(!(s instanceof If)){r=!1;break}let i=!0;for(const s of n)if(s instanceof If){i=!1;break}if(r===i)throw new xh("Arguments to apply() must be all SymbolicTensors or all Tensors");return ud(this.name,()=>{if(!this.built){this.assertInputCompatibility(t);const e=[];for(const n of Ah(t))e.push(n.shape);this.build(kh(e)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),null===this._refCount&&i&&(this._refCount=1)}if(this.assertInputCompatibility(t),i){let r=this.call(t,e);const i=Ah(r),s=[];for(let t of i)-1!==n.indexOf(t)&&(t=t.clone()),s.push(t);if(r=kh(s),null!=this.activityRegularizer)throw new _h("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return r}{const n=function(t){t=Ah(t);const e=[];for(const n of t)e.push(n.shape);return kh(e)}(t),r=this.computeOutputShape(n);let i;const s="float32";if(this.warnOnIncompatibleInputShape(Array.isArray(t)?n[0]:n),i=null!=r&&r.length>0&&Array.isArray(r[0])?r.map((n,r)=>new If(s,n,this,Ah(t),e,this.name,r)):new If(s,r,this,Ah(t),e,this.name),this.addInboundNode(t,i,null,null,n,r,e),this._refCount++,null!=this.activityRegularizer)throw new _h("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}})}warnOnIncompatibleInputShape(t){if(null!=this.batchInputShape)if(t.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+JSON.stringify(t)+") does not match that of the "+`batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer `+this.name);else{let e=!1;this.batchInputShape.forEach((n,r)=>{null!=n&&null!=t[r]&&t[r]!==n&&(e=!0)}),e&&console.warn(`The shape of the input tensor (${JSON.stringify(t)}) does not match the expectation of layer ${this.name}: `+JSON.stringify(this.batchInputShape))}}get outputShape(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new vh(`The layer ${this.name} has never been called and thus has no defined output shape.`);const t=[];for(const e of this.inboundNodes){const n=JSON.stringify(e.outputShapes);-1===t.indexOf(n)&&t.push(n)}if(1===t.length){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&1===t.length?t[0]:t}throw new vh(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new bh(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Af(this.weights)}build(t){this.built=!0}getWeights(t=!1){return Nf(t?this.trainableWeights:this.weights)}setWeights(t){Tn(()=>{const e=this.weights;if(e.length!==t.length)throw new xh(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${t.length}, but the layer was expecting ${e.length} weights. Provided weights: ${t}...`);if(0===e.length)return;const n=[],i=Nf(e);for(let s=0;s<i.length;++s){const o=i[s],a=e[s],l=t[s];if(!r.arraysEqual(o.shape,l.shape))throw new xh(`Layer weight shape ${o.shape} not compatible with provided weight shape `+l.shape);n.push([a,l])}Tf(n)})}addWeight(t,e,n,r,i,s,o){if(-1!==this._addedWeightNames.indexOf(t))throw new xh(`Duplicate weight name ${t} for layer ${this.name}`);this._addedWeightNames.push(t),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=nf("zeros"));const a=r.apply(e,n),l=new Df(a,n,t,s,o);return a.dispose(),null!=i&&this.addLoss(()=>i.apply(l.read())),null==s&&(s=!0),s?this._trainableWeights.push(l):this._nonTrainableWeights.push(l),l}setFastWeightInitDuringBuild(t){this.fastWeightInitDuringBuild=t}addLoss(t){null==t||Array.isArray(t)&&0===t.length||(t=Ah(t),null!=this._losses&&this.losses.push(...t))}computeOutputShape(t){return t}computeMask(t,e){if(!this.supportsMasking){if(null!=e){if(!Array.isArray(e))throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);e.forEach(t=>{if(null!=t)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)})}return null}return e}addInboundNode(t,e,n,r,i,s,o=null){const a=Ah(t);e=Ah(e),n=Ah(n),r=Ah(r),i=Cf(i),s=Cf(s);const l=[],u=[],c=[];for(const h of a)l.push(h.sourceLayer),u.push(h.nodeIndex),c.push(h.tensorIndex);new Ff({outboundLayer:this,inboundLayers:l,nodeIndices:u,tensorIndices:c,inputTensors:a,outputTensors:e,inputMasks:n,outputMasks:r,inputShapes:i,outputShapes:s},o);for(let h=0;h<e.length;h++)e[h].sourceLayer=this,e[h].nodeIndex=this.inboundNodes.length-1,e[h].tensorIndex=h}getConfig(){const t={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(t.batchInputShape=this.batchInputShape),null!=this.dtype&&(t.dtype=this.dtype),t}disposeWeights(){return this.weights.forEach(t=>t.dispose()),this.weights.length}assertNotDisposed(){if(0===this._refCount)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(null===this._refCount)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let t=0;return 0==--this._refCount&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}}}class Pf extends $f{constructor(t){if(super({dtype:t.dtype,name:null!=t.name?t.name:wf("input").toString()}),null==t.batchSize&&(t.batchSize=null),null==t.sparse&&(t.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=t.sparse,null!=t.inputShape&&null!=t.batchInputShape)throw new xh("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let e=t.batchInputShape;if(null==e){if(null==t.inputShape)throw new xh("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");e=[t.batchSize].concat(t.inputShape)}else if(null!=t.batchSize)throw new xh("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const n=t.dtype||"float32";this.batchInputShape=e,this.dtype=n,this.inputSpec=[{shape:e}];const r=new If(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new Ff({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[e],outputShapes:[e]})}apply(t,e){throw new xh("Cannot pass any input to an InputLayer's apply() method. InputLayer name: "+this.name)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}function zf(t){if(null==t.batchShape&&null==t.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=t.batchShape&&null!=t.shape)throw new xh("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=t.batchShape;null!=t.shape&&null==e&&(e=[null].concat(t.shape));let n=t.dtype;return null==n&&(n="float32"),new Pf({batchInputShape:e,name:t.name,dtype:n,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}async function Lf(t){if(null==t)return;const e=[],n=[],r=[];for(const i in t){const s=t[i];if("number"!=typeof s){const t=s;e.push(t.data()),n.push(i),r.push(t)}}if(e.length>0){const i=await Promise.all(e);for(let e=0;e<i.length;++e)t[n[e]]=i[e][0];On(r)}}function Bf(t){if(null!=t)for(const e in t){const n=t[e];"number"!=typeof n&&n.dispose()}}var jf;Pf.className="InputLayer",g.registerClass(Pf),function(t){t[t.SILENT=0]="SILENT",t[t.VERBOSE=1]="VERBOSE"}(jf||(jf={}));class Uf{constructor(){this.validationData=null}setParams(t){this.params=t}async onEpochBegin(t,e){}async onEpochEnd(t,e){}async onBatchBegin(t,e){}async onBatchEnd(t,e){}async onTrainBegin(t){}async onTrainEnd(t){}setModel(t){}}class Vf{constructor(t,e=10){null==t&&(t=[]),this.callbacks=t,this.queueLength=e}append(t){this.callbacks.push(t)}setParams(t){for(const e of this.callbacks)e.setParams(t)}setModel(t){for(const e of this.callbacks)e.setModel(t)}async onEpochBegin(t,e){null==e&&(e={});for(const n of this.callbacks)await n.onEpochBegin(t,e)}async onEpochEnd(t,e){null==e&&(e={});for(const n of this.callbacks)await n.onEpochEnd(t,e)}async onBatchBegin(t,e){null==e&&(e={});for(const n of this.callbacks)await n.onBatchBegin(t,e)}async onBatchEnd(t,e){null==e&&(e={});for(const n of this.callbacks)await n.onBatchEnd(t,e)}async onTrainBegin(t){null==t&&(t={});for(const e of this.callbacks)await e.onTrainBegin(t)}async onTrainEnd(t){null==t&&(t={});for(const e of this.callbacks)await e.onTrainEnd(t)}}class Wf extends Uf{constructor(){super()}async onEpochBegin(t){this.seen=0,this.totals={}}async onBatchEnd(t,e){null==e&&(e={});const n=null==e.size?0:e.size;this.seen+=n;for(const r in e){const t=e[r];if("number"==typeof t)this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+t*n;else{let e;r in this.totals?e=this.totals[r]:this.totals[r]=0;const i=Tn(()=>Le(this.totals[r],Xn(t,n)));this.totals[r]=i,null!=e&&e.dispose()}}}async onEpochEnd(t,e){if(null!=e)for(const n of this.params.metrics)null!=this.totals[n]&&("number"==typeof this.totals[n]?e[n]=this.totals[n]/this.seen:Tn(()=>{const t=Xn(Hr(1,this.seen),this.totals[n]);e[n]=t,this.totals[n].dispose(),In(e[n])}))}}class qf extends Uf{async onTrainBegin(t){this.epoch=[],this.history={}}async onEpochEnd(t,e){null==e&&(e={}),this.epoch.push(t);for(const n in e)null==this.history[n]&&(this.history[n]=[]),this.history[n].push(e[n])}async syncData(){const t=[],e=[],n=[];for(const i in this.history){const r=this.history[i];for(let s=0;s<r.length;++s)"number"!=typeof r[s]&&(t.push(r[s].data()),e.push(i),n.push(s))}const r=await Promise.all(t);for(let i=0;i<r.length;++i)this.history[e[i]][n[i]].dispose(),this.history[e[i]][n[i]]=r[i][0]}}class Hf extends Uf{constructor(t,e){if(super(),this.currentEpoch=0,this.yieldEvery=e||"auto","auto"===this.yieldEvery&&(this.yieldEvery=125),"never"===this.yieldEvery&&null!=t.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");r.isNumber(this.yieldEvery)&&(this.maybeWait=function(t,e){let n,i=r.now();return(...s)=>{const o=r.now();return o-i<e||(i=o,n=t(...s)),n}}(this.maybeWait.bind(this),this.yieldEvery)),this.trainBegin=t.onTrainBegin,this.trainEnd=t.onTrainEnd,this.epochBegin=t.onEpochBegin,this.epochEnd=t.onEpochEnd,this.batchBegin=t.onBatchBegin,this.batchEnd=t.onBatchEnd,this.yield=t.onYield}async maybeWait(t,e,n){const r=[];null!=this.yield&&(await Lf(n),r.push(this.yield(t,e,n))),r.push(Nu()),await Promise.all(r)}async onEpochBegin(t,e){this.currentEpoch=t,null!=this.epochBegin&&(await Lf(e),await this.epochBegin(t,e))}async onEpochEnd(t,e){const n=[];null!=this.epochEnd&&(await Lf(e),n.push(this.epochEnd(t,e))),"epoch"===this.yieldEvery&&n.push(Nu()),await Promise.all(n)}async onBatchBegin(t,e){null!=this.batchBegin&&(await Lf(e),await this.batchBegin(t,e))}async onBatchEnd(t,e){const n=[];null!=this.batchEnd&&(await Lf(e),n.push(this.batchEnd(t,e))),"batch"===this.yieldEvery?n.push(Nu()):r.isNumber(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,t,e)),await Promise.all(n)}async onTrainBegin(t){null!=this.trainBegin&&(await Lf(t),await this.trainBegin(t))}async onTrainEnd(t){null!=this.trainEnd&&(await Lf(t),await this.trainEnd(t))}}function Gf(t,e){return null==t&&(t={}),t instanceof Uf?[t]:Array.isArray(t)&&t[0]instanceof Uf?t:Ah(t).map(t=>new Hf(t,e))}class Yf{constructor(){}static registerCallbackConstructor(t,e){r.assert(t>=0&&Number.isInteger(t),()=>"Verbosity level is expected to be an integer >= 0, but got "+t),Yf.checkForDuplicate(e),null==Yf.constructors[t]&&(Yf.constructors[t]=[]),Yf.constructors[t].push(e)}static checkForDuplicate(t){for(const e in Yf.constructors)Yf.constructors[+e].forEach(e=>{if(e===t)throw new xh("Duplicate callback constructor.")})}static clear(){Yf.constructors={}}static createCallbacks(t){const e=[];for(const n in Yf.constructors){const r=+n;t>=r&&e.push(...Yf.constructors[r])}return e.map(t=>new t)}}function Kf(t,e,n,r,i,s,o,a,l){const u=new qf,c=[new Wf,...Yf.createCallbacks(e)];null!=t&&c.push(...t),c.push(u);const h=new Vf(c);return h.setParams({epochs:n,initialEpoch:r,samples:i,steps:s,batchSize:o,verbose:e,doValidation:a,metrics:l}),{callbackList:h,history:u}}function Xf(t,e={},n=!1){return Ih(t,g.SerializationMap.getMap().classNameMap,e,"layer",n)}function Zf(t,e){return Tn(()=>{"float32"!==t.dtype&&(t=t.asType("float32"));const n=Yi(Td(t),e,!0),r=ui(n.shape,yh()),i=bo(Di(n,r));return Hr(t,i)})}function Qf(t,e){return Tn(()=>os(Td(Gi(e,t)),-1))}function Jf(t,e){return Tn(()=>os($e(Gi(e,t)),-1))}function tp(t,e){return Tn(()=>{const n=Gi(t,e),r=Er($e(t),yh(),Number.MAX_VALUE),i=$e(Hr(n,r));return Xn(100,os(i,-1))})}function ep(t,e,n=!1){return Tn(()=>{if(n)e=vo(e);else{const t=Yi(e,e.shape.length-1,!0);e=Hr(e,t)}return e=Er(e,yh(),1-yh()),Vi(Yi(Xn(t.toFloat(),Fi(e)),e.shape.length-1))})}function np(t,e,n=!1){return Tn(()=>{const r=ci(function(t){const e=[pd(t.shape)];return t.reshape(e)}(t)).toInt(),i=(e=Er(e,yh(),1-yh())).shape;return ep(ms(r,i[i.length-1]).reshape(i),e,n)})}function rp(t,e){return Tn(()=>{let n;return n=Er(e,yh(),1-yh()),n=Fi(Hr(n,Gi(1,n))),os(function(t,e){if(!r.arraysEqual(t.shape,e.shape))throw new xh(`logits and labels must have the same shape, but got shapes ${JSON.stringify(t.shape)} and ${JSON.stringify(e.shape)}`);return Tn(()=>{const n=e.relu(),r=e.abs().neg();return n.sub(e.mul(t)).add(r.exp().log1p())})}(t,n),-1)})}function ip(t,e){return Tn(()=>{const n=Zf(t,-1),r=Zf(e,-1),i=Xn(n,r);return Vi(Yi(i,-1))})}Yf.constructors={};const sp={meanSquaredError:Qf,meanAbsoluteError:Jf,meanAbsolutePercentageError:tp,meanSquaredLogarithmicError:function(t,e){return Tn(()=>{const n=Er(e,yh(),Number.MAX_VALUE),r=Fi(Le(1,n)),i=Er(t,yh(),Number.MAX_VALUE),s=Fi(Le(1,i));return os(Td(Gi(r,s)),-1)})},squaredHinge:function(t,e){return Tn(()=>{const n=Di(0,Gi(1,Xn(t,e)));return os(Td(n),-1)})},hinge:function(t,e){return Tn(()=>{const n=Di(0,Gi(1,Xn(t,e)));return os(n,-1)})},categoricalHinge:function(t,e){return Tn(()=>{const n=Yi(Xn(t,e),-1),r=Hi(Xn(Gi(1,t),e),-1);return Di(0,Le(1,Gi(r,n)))})},logcosh:function(t,e){return Tn(()=>{const n=Math.log(2),r=Gi(e,t),i=Gi(Le(r,Wi(Xn(-2,r))),n);return os(i,-1)})},categoricalCrossentropy:ep,sparseCategoricalCrossentropy:np,binaryCrossentropy:rp,kullbackLeiblerDivergence:function(t,e){return Tn(()=>{const n=Er(t,yh(),1),r=Er(e,yh(),1);return Yi(Xn(t,Fi(Hr(n,r))),-1)})},poisson:function(t,e){return Tn(()=>{const n=Fi(Le(yh(),e));return os(Gi(e,Xn(t,n)),-1)})},cosineProximity:ip};function op(t){if("string"==typeof t){if(t in sp)return sp[t];let e="Unknown loss "+t;throw t.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${t}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new xh(e)}return t}function ap(t,e){return Tn(()=>{const n=Xn(.5,gs(e)),r=bd(yi(e,n),t.dtype);return os(Xr(t,r),-1)})}function lp(t,e){return Tn(()=>bd(Xr(Je(t,-1),Je(e,-1)),"float32"))}function up(t,e){return Tn(()=>Zi(t.equal(1),e.equal(1)).sum().cast("float32"))}function cp(t,e){return Tn(()=>{const n=up(t,e),r=function(t,e){return Tn(()=>Zi(t.equal(0),e.equal(1)).sum().cast("float32"))}(t,e),i=n.add(r);return Zr(yi(i,0),n.div(i),0).cast("float32")})}function hp(t,e){return rp(t,e)}function dp(t,e){return t.rank===e.rank&&(t=t.squeeze([t.rank-1])),(e=e.argMax(-1)).dtype!==t.dtype&&(e=e.asType(t.dtype)),Xr(t,e).asType("float32")}const fp=ep,pp=np,mp={binaryAccuracy:ap,categoricalAccuracy:lp,precision:cp,categoricalCrossentropy:fp,sparseCategoricalCrossentropy:pp,mse:Qf,MSE:Qf,mae:Jf,MAE:Jf,mape:tp,MAPE:tp,cosine:ip};function gp(t){if("string"==typeof t&&t in mp)return mp[t];if("string"!=typeof t&&null!=t)return t;throw new xh("Unknown metric "+t)}function yp(t){if(Ch(null!==t,"Unknown LossOrMetricFn "+t),"string"==typeof t)return t;{let e;for(const n of Object.keys(sp))if(sp[n]===t){e=n;break}if(void 0!==e)return e;for(const n of Object.keys(mp))if(mp[n]===t){e=n;break}return void 0!==e?e:t.name}}function vp(t,e,n=!1){if(null==t||"object"!=typeof t||Object.getPrototypeOf(t)!==Object.prototype||!function t(e){if(null===e)return!0;if("object"==typeof e){if(Object.getPrototypeOf(e)===Object.prototype){const n=Object.keys(e);for(const r of n){if("string"!=typeof r)return!1;if(!t(e[r]))return!1}return!0}if(Array.isArray(e)){for(const n of e)if(!t(n))return!1;return!0}return!1}{const t=typeof e;return"string"===t||"number"===t||"boolean"===t}}(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const n=JSON.stringify(t);n.length>1048576&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${n.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= 1048576.`)}}function bp(t,e,n=console.log){let r="";for(let i=0;i<t.length;++i)i>0&&(r=r.slice(0,r.length-1)+" "),r+=t[i],r=r.slice(0,e[i]),r+=" ".repeat(e[i]-r.length);n(r)}function xp(t,e,n){let r;try{r=JSON.stringify(t.outputShape)}catch(MC){r="multiple"}bp([`${t.name} (${t.getClassName()})`,r,t.countParams().toString()],e,n)}function _p(t,e,n,r){let i;try{i=JSON.stringify(t.outputShape)}catch(MC){i="multiple"}const s=[];for(const u of t.inboundNodes)if(!(null!=n&&n.length>0&&-1===n.indexOf(u)))for(let t=0;t<u.inboundLayers.length;++t)s.push(`${u.inboundLayers[t].name}[${u.nodeIndices[t]}][${u.tensorIndices[t]}]`);const o=t.name,a=t.getClassName(),l=0===s.length?"":s[0];bp([`${o} (${a})`,i,t.countParams().toString(),l],e,r);for(let u=1;u<s.length;++u)bp(["","","",s[u]],e,r)}function wp(t,e,n){return("inboundNodes"===t||"outputLayers"===t||"inputLayers"===t)&&0===e&&"string"==typeof n}function Sp(t,e){if(null===t)return null;if("string"==typeof t)return Nh(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){const n=[],r=t.length;for(let i=0;i<r;++i){const r=t[i];wp(e,i,r)?n.push(r):n.push(Sp(r,e))}return n}{const e={};for(const n of Object.keys(t)){const r=t[n];if("name"===n&&"string"==typeof r)e[n]=r;else{const t=Nh(n);e[t]=Sp(r,t)}}return e}}class Cp{constructor(t){if(this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof Cp)for(const e in t.id2Value)this.id2Value[e]=t.id2Value[e],e in t.id2Mask&&(this.id2Mask[e]=t.id2Mask[e]);else{if(null==t)return;for(const e of t)this.add(e.key,e.value)}}add(t,e,n){if(null!=this.id2Value[t.id])throw new xh(`Duplicate key: name=${t.name}, id=${t.id}`);return this.id2Value[t.id]=function(t,e){if(null==t.dtype||t.dtype===e.dtype)return e;try{return an(e,t.dtype)}catch(MC){throw new xh(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${t.name}' (${t.dtype}).`)}}(t,e),this.name2Id[t.name]=t.id,null!=n&&(this.id2Mask[t.id]=n),this}addFeed(t){this.add(t.key,t.value)}hasKey(t){return null!=this.id2Value[t.id]}names(){return Object.keys(this.name2Id)}getValue(t){if(t instanceof If){if(null==this.id2Value[t.id])throw new xh("Nonexistent key: "+t.name);return this.id2Value[t.id]}{const e=this.name2Id[t];if(null==e)throw new xh("Feed dict has no SymbolicTensor name: "+t);return this.id2Value[e]}}getMask(t){if(t instanceof If){if(null==this.id2Value[t.id])throw new xh("Nonexistent key: "+t.name);return this.id2Mask[t.id]}{const e=this.name2Id[t];if(null==e)throw new xh("Feed dict has no SymbolicTensor name: "+t);return this.id2Mask[e]}}disposeMasks(){null!=this.id2Mask&&On(this.id2Mask)}}const Ep={},kp={};function Ap(t,e,n,i){const s=null!=n&&n.training,o=Array.isArray(t),a=o?t:[t],l=a.map(t=>t.name),u=[],c=e.names();for(const r of l)-1!==c.indexOf(r)?u.push(e.getValue(r)):u.push(null);null!=i&&(i.maxNumTensors=-1/0,i.minNumTensors=1/0);const h=l.join(",")+"|"+e.names().join(",");let d,f;if(null==Ep[h]){const t=function(t,e){r.assert(null!=t&&t.length>0,()=>"Expected at least one fetch, got none");let n=[],i={};if(1===t.length){const r=Np(t[0],e);n=r.sorted,i=r.recipientMap}else{const r=new Set;for(const s of t){const{sorted:t,recipientMap:o}=Np(s,e);for(const e of t)r.has(e.name)||(n.push(e),r.add(e.name));for(const e in o)null==i[e]&&(i[e]=new Set),o[e].forEach(t=>i[e].add(t))}}return{sorted:n,recipientCounts:Dp(i)}}(a,e);d=t.sorted,f=t.recipientCounts,Ep[h]=d,kp[h]=f}d=Ep[h],f={},s||Object.assign(f,kp[h]);const p=new Cp(e);for(let r=0;r<d.length;++r){if(null!=i){const t=Dn().numTensors;t>i.maxNumTensors&&(i.maxNumTensors=t),t<i.minNumTensors&&(i.minNumTensors=t)}const t=d[r],o=t.sourceLayer;if(o instanceof Pf)continue;const a=[],c=[],h=[];let m=!1;for(const n of t.inputs){const t=p.getValue(n),r=p.getMask(n);a.push(t),c.push(r),null!=r&&(m=!0),s||(f[n.name]--,0!==f[n.name]||e.hasKey(n)||-1!==l.indexOf(n.name)||t.isDisposed||!0===n.sourceLayer.stateful||h.push(t))}m&&((n=n||{}).mask=c[0]);const g=Ah(o.apply(a,n));let y=null;o.supportsMasking&&(y=o.computeMask(a,c));const v=Tp(t),b=Array.isArray(v)?v:[v];for(let e=0;e<b.length;++e){p.hasKey(b[e])||p.add(b[e],g[e],Array.isArray(y)?y[0]:y);const t=l.indexOf(b[e].name);-1!==t&&(u[t]=g[e])}s||On(h)}return p.disposeMasks(),o?u:u[0]}function Dp(t){const e={};for(const n in t)e[n]=t[n].size;return e}function Np(t,e){const n=new Set,r=[],i={};for(const a of e.names())n.add(a);const s=[],o=[];for(s.push(t);s.length>0;){const t=s[s.length-1];if(n.has(t.name)){s.pop();continue}const e=o[o.length-1]===s.length-1;if(0===t.inputs.length||e)s.pop(),r.push(t),n.add(t.name),e&&o.pop();else{o.push(s.length-1);for(const e of t.inputs)null==i[e.name]&&(i[e.name]=new Set),i[e.name].add(t.name),n.has(e.name)||s.push(e)}}return{sorted:r,recipientMap:i}}function Tp(t){let e;if(1===t.sourceLayer.inboundNodes.length)e=t.sourceLayer.output;else{let n=null;for(let e=0;e<t.sourceLayer.inboundNodes.length;++e)for(const r of t.sourceLayer.inboundNodes[e].outputTensors)if(r.id===t.id){n=e;break}e=t.sourceLayer.getOutputAt(n)}return e}class Op extends $f{constructor(t){if(super({}),this.containerNodes=new Set,this.name=t.name,null==this.name){const t=this.getClassName().toLowerCase();this.name=wf(t)}if(this.supportsMasking=!1,this.trainable_=!0,this.inputs=Array.isArray(t.inputs)?t.inputs.slice():[t.inputs],this.outputs=Array.isArray(t.outputs)?t.outputs.slice():[t.outputs],Fh(this.inputs).length!==this.inputs.length)throw new xh("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+this.inputs.map(t=>t.name));Fh(this.outputs).length!==this.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+this.outputs.map(t=>t.name)),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const y of this.outputs){const t=y.nodeIndex,e=y.tensorIndex;this.outputLayers.push(y.sourceLayer),this.outputLayersNodeIndices.push(t),this.outputLayersTensorIndices.push(e)}for(const y of this.inputs){const t=y.sourceLayer,e=y.nodeIndex,n=y.tensorIndex;Ch(0===e,"input layer has >1 nodes"),Ch(0===n,"input layer has >1 tensors"),this.inputLayers.push(t),this.inputLayersNodeIndices.push(e),this.inputLayersTensorIndices.push(n)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let y=0;y<this.inputLayers.length;y++){const e=this.inputLayers[y];if(!(e instanceof Pf))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${t.inputs}. Input ${y} (0-based) originates from layer type ${e.getClassName()}.`);this.inputNames.push(e.name),this.feedInputShapes.push(e.batchInputShape),this.feedInputNames.push(e.name)}for(const y of this.outputLayers)this.outputNames.push(y.name);this.internalInputShapes=this.inputs.map(t=>t.shape),this.internalOutputShapes=this.outputs.map(t=>t.shape);const e={},n={},r={},i={},s={},o=[],a=(t,e,n,r,i,l)=>{null!=r&&null!=i&&null!=l||(r=t.sourceLayer,i=t.nodeIndex,l=t.tensorIndex);const u=r.inboundNodes[i];if(-1!==n.indexOf(u))throw new bh(`The tensor ${t.name} at layer "${r.name}" is part of a cycle.`);if(-1!==e.indexOf(u))return;this.containerNodes.add(Op.nodeKey(r,i)),r.id in s||(s[r.id]=Object.keys(s).length),-1===n.indexOf(u)&&n.push(u);const c=u.inboundLayers.length;for(let s=0;s<c;s++)a(u.inputTensors[s],e,n,u.inboundLayers[s],u.nodeIndices[s],u.tensorIndices[s]);for(e.push(u);n.indexOf(u)>=0;)n.splice(n.indexOf(u),1);o.push(u)},l=[],u=[];for(const y of this.outputs)a(y,l,u);const c=o.slice().reverse();for(const y of c){n[y.id]=y,y.id in e||(e[y.id]=0);let t=e[y.id];t=Math.max(t,null==r[y.outboundLayer.id]?0:r[y.outboundLayer.id]),r[y.outboundLayer.id]=t,i[y.outboundLayer.id]=y.outboundLayer,e[y.id]=t;for(let r=0;r<y.inboundLayers.length;r++){const i=y.inboundLayers[r].inboundNodes[y.nodeIndices[r]];e[i.id]=Math.max(t+1,null==e[i.id]?0:e[i.id]),n[i.id]=i}}const h={};for(const y in e){const t=e[y];t in h||(h[t]=[]),h[t].push(n[y])}const d={};for(const y in r){const t=r[y];t in d||(d[t]=[]),d[t].push(i[y])}let f=Object.keys(d).map(t=>parseInt(t,10)).sort(Rh);this.layers=[];for(const y of f){const t=d[y];t.sort((t,e)=>{const n=s[t.id],r=s[e.id];return n<r?-1:n>r?1:0});for(const e of t)e instanceof Op&&this.internalContainerRefs.push(e),this.layers.push(e)}this.layersByDepth=d,f=Object.keys(h).map(t=>parseInt(t,10)).sort(Rh);const p=this.inputs.slice(),m=[];for(const y of f)for(const t of h[y]){const e=t.outboundLayer;if(null!=e){for(const n of t.inputTensors)if(-1===p.indexOf(n))throw new bh("Graph disconnected: cannot obtain value for tensor "+n+` at layer "${e.name}". The following previous layers were accessed without issue: `+m);for(const e of t.outputTensors)p.push(e);m.push(e.name)}}this.nodesByDepth=h;const g=this.layers.map(t=>t.name);for(const y of g){const t=g.filter(t=>t===y).length;if(1!==t)throw new bh(`The name "${y}" is used ${t} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(g))}this.outboundNodes=[],this.inboundNodes=[],new Ff({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(t=>null),outputMasks:this.outputs.map(t=>null),inputShapes:this.inputs.map(t=>t.shape),outputShapes:this.outputs.map(t=>t.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(0===this._refCount)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const t={refCountAfterDispose:null,numDisposedVariables:0};if(0==--this._refCount){for(const e of this.layers)t.numDisposedVariables+=e.dispose().numDisposedVariables;for(const e of this.internalContainerRefs)t.numDisposedVariables+=e.dispose().numDisposedVariables}return t.refCountAfterDispose=this._refCount,t}get trainable(){return this.trainable_}set trainable(t){this.layers.forEach(e=>{e._trainableWeights.forEach(e=>e.trainable=t)}),this.trainable_=t}get trainableWeights(){if(this._trainableWeights.length>0)throw new xh("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let t=[];for(const e of this.layers)t=t.concat(e.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const e of this.layers)t.push(...e.nonTrainableWeights);if(!this.trainable){const e=[];for(const t of this.layers)e.push(...t.trainableWeights);return e.concat(t)}return t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(t,e=!0){const n={};let r=0;for(const s of this.layers)for(const t of s.weights){if(null!=n[t.originalName])throw new xh("Duplicate weight name: "+t.originalName);n[t.originalName]=t,r++}const i=[];for(const s in t){let r=s;if(null==n[s]){const t=s.split("/");r=t.slice(0,-2).concat([t[t.length-1]]).join("/")}if(null!=n[r])i.push([n[r],t[s]]);else if(e)throw new xh("Provided weight data has no target variable: "+s);delete n[r]}if(e){const t=[];for(const e in n)t.push(e);if(t.length>0)throw new xh(`${t.length} of ${r} weights are not set: `+t)}Tf(i)}updatedConfig(){const t=this.getConfig(),e={};return e.className=this.getClassName(),e.config=t,e.kerasVersion="tfjs-layers 2.3.0",e.backend="TensorFlow.js",e}toJSON(t,e=!0){const n=function t(e,n){if(null==e)return null;if("string"==typeof e)return Dh(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){const r=[],i=e.length;for(let s=0;s<i;++s){const i=e[s];wp(n,s,i)?r.push(i):r.push(t(i,n))}return r}{const n={};for(const r of Object.keys(e)){const i=e[r];n[Dh(r)]="name"!==r&&"className"!==r||"string"!=typeof i?t(i,r):i}return n}}(this.updatedConfig());return e?JSON.stringify(n):n}call(t,e){return Tn(()=>{t=Ah(t);const n=new Cp;for(let e=0;e<this.inputs.length;++e)n.add(this.inputs[e],t[e]);return Ap(this.outputs,n,e)})}computeMask(t,e){return Tn(()=>{let n;return t=Ah(t),n=null==e?Sh(null,t.length):Ah(e),this.runInternalGraph(t,n)[1]})}computeOutputShape(t){const e=Cf(t);if(e.length!==this.inputLayers.length)throw new xh(`Invalid inputShape argument ${t}: model has ${this.inputLayers.length} tensor inputs.`);const n={};for(let o=0;o<e.length;o++)n[this.inputLayers[o].name+"_0_0"]=e[o];const r=Object.keys(this.nodesByDepth).map(t=>parseInt(t,10)).sort(Rh);if(r.length>1)for(const o of r){const t=this.nodesByDepth[o];for(const e of t){const t=e.outboundLayer;if(-1!==this.inputLayers.map(t=>t.id).indexOf(t.id))continue;const r=[];for(let o=0;o<e.inboundLayers.length;o++)r.push(n[`${e.inboundLayers[o].name}_${e.nodeIndices[o]}_${e.tensorIndices[o]}`]);const i=Cf(t.computeOutputShape(kh(r))),s=t.inboundNodes.indexOf(e);for(let e=0;e<i.length;e++)n[`${t.name}_${s}_${e}`]=i[e]}}const i=[],s=[];for(let o=0;o<this.outputLayers.length;o++)s.push(`${this.outputLayers[o].name}_${this.outputLayersNodeIndices[o]}_${this.outputLayersTensorIndices[o]}`);for(let o=0;o<s.length;o++){const t=s[o];Ch(t in n),i.push(n[t])}return kh(i)}runInternalGraph(t,e){null==e&&(e=Sh(null,t.length));const n={};for(let a=0;a<this.inputs.length;++a)n[this.inputs[a].id]=[t[a],e[a]];const r=Object.keys(this.nodesByDepth).map(t=>parseInt(t,10)).sort(Rh);for(const a of r){const t=this.nodesByDepth[a];for(const e of t){const t=e.outboundLayer,r=e.inputTensors,i=e.outputTensors,s=new Array;for(const e of r)e.id in n&&s.push(n[e.id]);if(s.length===r.length){let r,o,a,l,u={};if(null!=e.callArgs&&(u=e.callArgs),1===s.length){const[e,n]=s[0];null==u.mask&&(u.mask=n),a=Ah(t.call(e,u)),l=Ah(t.computeMask(e,n)),r=[e],o=[n]}else r=s.map(t=>t[0]),o=s.map(t=>t[1]),null==u.mask&&(u.mask=o),a=Ah(t.call(r,u)),l=Ah(t.computeMask(r,o));if(t.activityRegularizer)throw new _h("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let t=0;t<i.length;++t)n[i[t].id]=[a[t],l[t]]}}}const i=[],s=[],o=[];for(const a of this.outputs){Ch(a.id in n,`Could not compute output ${a.name} : ${a.id}`);const[t,e]=n[a.id];o.push(t.shape),i.push(t),s.push(e)}return[i,s,o]}buildNodeConversionMap(t){const e={};let n;for(const r of this.layers){n=r instanceof Op?1:0;for(let t=0;t<r.inboundNodes.length;t++){const i=Op.nodeKey(r,t);this.containerNodes.has(i)&&(e[i]=n,n+=1)}}return e}getLayer(t,e){if(null!=e){if(this.layers.length<=e)throw new xh(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}if(null==t)throw new xh("Provide either a layer name or layer index");for(const n of this.layers)if(n.name===t)return n;throw new xh("No such layer: "+t)}calculateLosses(){return Tn(()=>{const t=[];for(const e of this.layers)for(let n=0;n<e.inboundNodes.length;++n){const r=Op.nodeKey(e,n);this.containerNodes.has(r)&&t.push(...e.calculateLosses())}return t})}getConfig(){const t={name:this.name},e=this.buildNodeConversionMap(this.layers),n=[];for(const s of this.layers){const t=s.getClassName(),r=s.getConfig(),i=[];for(let n=0;n<s.inboundNodes.length;n++){const t=s.inboundNodes[n],r=Op.nodeKey(s,n);let o={};if(this.containerNodes.has(r)){if(t.callArgs)try{JSON.stringify(t.callArgs),o=t.callArgs}catch(MC){console.warn(`Layer ${s.name} was passed non-serializable keyword arguments: `+t.callArgs+". They will not be included in the serialized model (and thus will be missing at deserialization time)."),o={}}if(t.inboundLayers.length>0){const n=[];for(let r=0;r<t.inboundLayers.length;r++){const i=t.inboundLayers[r],s=t.tensorIndices[r];let a=e[Op.nodeKey(i,t.nodeIndices[r])];null==a&&(a=0),n.push([i.name,a,s,o])}i.push(n)}}}const o={};o.name=s.name,o.className=t,o.config=r,o.inboundNodes=i,n.push(o)}t.layers=n;const r=[];for(let s=0;s<this.inputLayers.length;s++){const t=this.inputLayers[s],n=Op.nodeKey(t,this.inputLayersNodeIndices[s]);if(!this.containerNodes.has(n))continue;let i=e[n];null==i&&(i=0),r.push([t.name,i,this.inputLayersTensorIndices[s]])}t.inputLayers=r;const i=[];for(let s=0;s<this.outputLayers.length;s++){const t=this.outputLayers[s],n=Op.nodeKey(t,this.outputLayersNodeIndices[s]);if(!this.containerNodes.has(n))continue;let r=e[n];null==r&&(r=0),i.push([t.name,r,this.outputLayersTensorIndices[s]])}return t.outputLayers=i,t}static fromConfig(t,e,n={},r=!1){const i={},s={};function o(t,e){t.name in s?s[t.name].push(e):s[t.name]=[e]}function a(t,e){const n=[];let r;for(const s of e){const a=s[0],l=s[1],u=s[2];if(r=null==s[3]?{}:s[3],!(a in i))return void o(t,e);const c=i[a];if(c.inboundNodes.length<=l)return void o(t,e);n.push(c.inboundNodes[l].outputTensors[u])}n.length>0&&t.apply(kh(n),r)}function l(t){const n=t.name,s=Xf(t,null!=e.customObjects?e.customObjects:{});s.setFastWeightInitDuringBuild(r),i[n]=s,t.inboundNodes.forEach(t=>{if(!(t instanceof Array))throw new xh("Corrupted configuration, expected array for nodeData: "+t);o(s,t)})}const u=e.name,c=e.layers;for(const m of c)l(m);for(;!Mh(s);)for(const t of c){const e=i[t.name];if(e.name in s){const t=s[e.name];delete s[e.name];for(const n of t)a(e,n)}}const h=[],d=[],f=e.inputLayers;for(const m of f){const t=m[0],e=m[1],n=m[2];Ch(t in i),h.push(i[t].inboundNodes[e].outputTensors[n])}const p=e.outputLayers;for(const m of p){const t=m[0],e=m[1],n=m[2];Ch(t in i),d.push(i[t].inboundNodes[e].outputTensors[n])}return new t({inputs:h,outputs:d,name:u})}get stateful(){if(this._stateful)throw new xh("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const t of this.layers)if(t.stateful)return!0;return!1}resetStates(){Tn(()=>{this.layers.forEach(t=>{t.stateful&&t.resetStates()})})}}function Ip(t,e){return function(t,e,n){const r=e.length;if(null==t||Array.isArray(t)&&0===t.length)return e.map(t=>null);if(1===r)return Array.isArray(t)&&1===t.length?t:"object"==typeof t&&e[0]in t?[t[e[0]]]:[t];if(Array.isArray(t)){if(t.length!==r)throw new Error(`Provided classWeight is an array of ${t.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return t}if("object"==typeof t&&Object.keys(t).length>0&&"object"==typeof t[Object.keys(t)[0]]){const n=[];return e.forEach(e=>{n.push(e in t?t[e]:null)}),n}throw new Error(`The model has multiple (${r}) outputs, so classWeight must be either an array with ${r} elements or an object with ${e} keys. Provided classWeight not understood: ${JSON.stringify(t)}`)}(t,e)}async function Rp(t,e,n,r){if(null!=e||null!=r)throw new Error("Support sampleWeight is not implemented yet");if(null!=n){const e=Tn(()=>{if(1===t.shape.length)return t.clone();if(2===t.shape.length){if(t.shape[1]>1)return t.argMax(1);if(1===t.shape[1])return t.reshape([t.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${t.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}throw new Error(`Unexpected rank of target (y) tensor (${t.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),r=Array.from(await e.data());On(e);const i=[];return r.forEach(t=>{if(null==n[t])throw new Error(`classWeight must contain all classes in the training data. The class ${t} exists in the data but not in classWeight`);i.push(n[t])}),Gs(i,"float32")}return null}function Fp(t,e){return Xn(t,e)}function Mp(t,e){let n,i;n=e.xs,i=e.ys,r.assert(null!=n&&null!=i,()=>"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+e);const s=$p("input",t.inputNames,n),o=$p("output",t.outputNames,i),a=s[0].shape[0];r.assert(s.length===t.inputs.length,()=>`LayersModel has ${t.inputs.length} inputs, but the dataset provides ${s.length} inputs.  (Expected input keys: `+JSON.stringify(t.inputNames)+")"),r.assert(o.length===t.outputs.length,()=>`LayersModel has ${t.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: `+JSON.stringify(t.outputNames)+")");for(let l=0;l<s.length;l++)r.assert(s[l].shape[0]===a,()=>`Batch size mismatch: input ${t.inputNames[l]} has ${s[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);for(let l=0;l<o.length;l++)r.assert(o[l].shape[0]===a,()=>`Batch size mismatch: output ${t.outputNames[l]} has ${o[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);return{xs:s,ys:o}}function $p(t,e,n){if(n instanceof ue)return[n];if(Array.isArray(n))return r.assert(n.length===e.length,()=>`Received an array of ${n.length} Tensors, but expected ${e.length} to match the ${t} keys ${e}.`),n;{const r=[];for(const i of e){if(null==n[i])throw new xh(`The feature data generated by the dataset lacks the required ${t} key '${i}'.`);r.push(n[i])}return r}}function Pp(t){return"function"==typeof t.iterator}function zp(t){r.assert(t>0&&Number.isInteger(t),()=>"batchSize is required to be a positive integer, but got "+t)}function Lp(t,e,n){return null==t?[null]:Array.isArray(t)?t.map(t=>_d(t,e,n-e)):_d(t,e,n-e)}function Bp(t,e){return Tn(()=>null==t?null:Array.isArray(t)?t.map(t=>Bp(t,e)):Nd(t,"int32"===e.dtype?e:e.toInt()))}function jp(t,e){const n=[];let r=0,i=null;for(;r<t;)i=r+e,i>=t&&(i=t),n.push([r,i]),r=i;return n}function Up(t){const e=[];t instanceof ue&&(t=[t]);for(let n=0;n<t.length;++n){const r=t[n];if(1===r.rank)e.push(xd(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(r)}}return e}function Vp(t,e){if(null==t)return;const n=[];if(e instanceof ue)n.push(e.id);else if(Array.isArray(e))e.forEach(t=>n.push(t.id));else if(null!=e)for(const i in e)n.push(e[i].id);const r=[];if(t instanceof ue)-1===n.indexOf(t.id)&&r.push(t);else if(Array.isArray(t))t.forEach(t=>{-1===n.indexOf(t.id)&&r.push(t)});else if(null!=t)for(const i in t){const e=t[i];-1===n.indexOf(e.id)&&r.push(e)}r.forEach(t=>{t.isDisposed||t.dispose()})}function Wp(t){return Array.isArray(t)}function qp(t){return!function(t){return t instanceof ue}(t)&&!Wp(t)}function Hp(t,e,n,r=!0,i=""){if(null==e||0===e.length){if(null!=t){let e=!1;if(Wp(t)&&t.length>0)e=!0;else if(qp(t)){for(const n in t)if(t.hasOwnProperty(n)){e=!0;break}}else e=!0;if(e)throw new xh(`Error when checking model ${i} expected no data, but got `+t)}return[]}if(null==t)return e.map(t=>null);let s;if(qp(t)){t=t,s=[];for(const n of e){if(null==t[n])throw new xh(`No data provided for "${n}". Need data for each key in: `+e);s.push(t[n])}}else if(Wp(t)){if((t=t).length!==e.length)throw new xh(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): `+t);s=t}else{if(t=t,e.length>1)throw new xh(`The model ${i} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape `+t.shape);s=[t]}if(s=Up(s),null!=n)for(let o=0;o<e.length;++o){if(null==n[o])continue;const t=s[o];if(t.shape.length!==n[o].length)throw new xh(`Error when checking ${i}: expected ${e[o]} to have ${n[o].length} dimension(s). but got array with shape `+t.shape);for(let s=0;s<n[o].length;++s){if(0===s&&!r)continue;const a=t.shape[s],l=n[o][s];if(null!=l&&l>=0&&a!==l)throw new xh(`Error when checking ${i}: expected ${e[o]} to have shape [${n[o]}], but got array with shape [${t.shape}].`)}}return s}function Gp(t,e,n,r=!0,i=""){let s;if(Array.isArray(t)){if(t.length!==e.length)throw new xh(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${t.length} Tensors(s).`);s=t}else{if(e.length>1)throw new xh(`The model expects ${e.length} ${i} Tensors, but only received one Tensor. Found: array with shape `+JSON.stringify(t.shape)+".");s=[t]}if(null!=n)for(let o=0;o<e.length;++o){if(null==n[o])continue;const t=s[o];if(t.shape.length!==n[o].length)throw new xh(`Error when checking ${i}: expected ${e[o]} to have ${n[o].length} dimension(s), but got array with shape `+JSON.stringify(t.shape));for(let s=0;s<n[o].length;++s){if(0===s&&!r)continue;const a=t.shape[s],l=n[o][s];if(null!=l&&l!==a)throw new xh(`Error when checking ${i}: expected ${e[o]} to have shape ${JSON.stringify(n[o])} but got array with shape ${JSON.stringify(t.shape)}.`)}}}class Yp extends Op{constructor(t){super(t),this.isTraining=!1}summary(t,e,n=console.log){if(!this.built)throw new xh("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");!function(t,e,n,r=console.log){const i=function(t){let e=!0;const n=[],r=[];for(const i in t.nodesByDepth)n.push(t.nodesByDepth[i]);for(const i of n){if(i.length>1||1===i.length&&i[0].inboundLayers.length>1){e=!1;break}r.push(...i)}if(e)for(const i of t.layers){let t=!1;for(const n of i.inboundNodes)if(-1!==r.indexOf(n)){if(t){e=!1;break}t=!0}if(!e)break}return e}(t),s=["Layer (type)","Output shape","Param #"];let o;if(i?(e=e||65,n=n||[.45,.85,1]):(e=e||98,n=n||[.33,.55,.67,1]),n[n.length-1]<=1&&(n=n.map(t=>Math.floor(e*t))),!i){s.push("Receives inputs"),o=[];for(const e in t.nodesByDepth)o.push(...t.nodesByDepth[e])}r("_".repeat(e)),bp(s,n,r),r("=".repeat(e));const a=t.layers;for(let c=0;c<a.length;++c)i?xp(a[c],n,r):_p(a[c],n,o,r),r((c===a.length-1?"=":"_").repeat(e));t.checkTrainableWeightsConsistency();const l=function(t){let e;return e=Af(null!=t.collectedTrainableWeights?t.collectedTrainableWeights:t.trainableWeights),e}(t),u=Af(t.nonTrainableWeights);r("Total params: "+(l+u)),r("Trainable params: "+l),r("Non-trainable params: "+u),r("_".repeat(e))}(this,t,e,n)}compile(t){if(null==t.loss&&(t.loss=[]),this.loss=t.loss,"string"==typeof t.optimizer)this.optimizer_=function(t){const e={Adagrad:()=>Au.adagrad(.01),Adadelta:()=>Au.adadelta(1,.95,yh()),Adam:()=>Au.adam(.001,.9,.999,yh()),Adamax:()=>Au.adamax(.002,.9,.999,yh(),0),RMSProp:()=>Au.rmsprop(.001,.9,0,yh()),SGD:()=>Au.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,t in e)return e[t]();throw new xh("Unknown Optimizer "+t)}(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof vu))throw new xh("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}let e=[];if(Array.isArray(t.loss)||"string"==typeof t.loss||"function"==typeof t.loss)if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new xh(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${t.loss}.`);e=t.loss.map(t=>op(t))}else{const n=op(t.loss);this.outputs.forEach(t=>{e.push(n)})}else{t.loss=t.loss;for(const e in t.loss)if(-1===this.outputNames.indexOf(e))throw new xh(`Unknown entry in loss dictionary: "${e}". Only expected the following keys: `+this.outputNames);for(const n of this.outputNames)null==t.loss[n]&&console.warn(`Output "${n}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${n} during training`),e.push(op(t.loss[n]))}this.lossFunctions=e,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let s=0;s<this.outputs.length;++s){const t=this.internalOutputShapes[s];this.feedOutputNames.push(this.outputNames[s]),this.feedOutputShapes.push(t),this.feedLossFns.push(this.lossFunctions[s])}const n=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],ud("loss",()=>{for(let t=0;t<this.outputs.length;++t){if(-1!==n.indexOf(t))continue;const e=this.lossFunctions[t];this.outputs.length>1&&(this.metricsTensors.push([e,t]),this.metricsNames.push(this.outputNames[t]+"_loss"))}});const r=function(t,e){if(null==t||Array.isArray(t)&&0===t.length)return e.map(t=>[]);let n;if("string"==typeof t||"function"==typeof t)n=[t];else{if(!Array.isArray(t)&&"object"!=typeof t)throw new TypeError("Type of metrics argument not understood. Expected an string,function, Array, or Object, found: "+t);n=t}if(Array.isArray(n))return e.map(t=>n);{const t=[];for(const r of e){let e=n.hasOwnProperty(r)?n[r]:[];Array.isArray(e)||(e=[e]),t.push(e)}return t}}(t.metrics,this.outputNames),i=(t,e,n)=>{this.outputNames.length>1&&(e=this.outputNames[t]+"_"+e),this.metricsNames.push(e),this.metricsTensors.push([n,t])};ud("metric",()=>{for(let t=0;t<this.outputs.length;++t)-1===n.indexOf(t)&&(e=>{let n,r,s;for(const o of e){if("string"==typeof o&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(o)){const e=this.internalOutputShapes[t];let i;1===e[e.length-1]||this.lossFunctions[t]===rp?-1!==["accuracy","acc"].indexOf(o)?r=ap:-1!==["crossentropy","ce"].indexOf(o)&&(r=hp):this.lossFunctions[t]===np?-1!==["accuracy","acc"].indexOf(o)?r=dp:-1!==["crossentropy","ce"].indexOf(o)&&(r=pp):-1!==["accuracy","acc"].indexOf(o)?r=lp:-1!==["crossentropy","ce"].indexOf(o)&&(r=fp),-1!==["accuracy","acc"].indexOf(o)?i="acc":-1!==["crossentropy","ce"].indexOf(o)&&(i="ce"),s=r,n=""+i}else{const t=gp(o);s=t,n=""+yp(o)}let e;ud(n,()=>{e=s}),i(t,n,e)}})(r[t])}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(t,e,n={}){const r=null==n.batchSize?32:n.batchSize;zp(r);const i=this.standardizeUserDataXY(t,e,!0,r);try{const s=i[0].concat(i[1]);return this.makeTestFunction(),kh(this.testLoop(this.testFunction,s,r,n.verbose,n.steps))}finally{Vp(i[0],t),Vp(i[1],e)}}async evaluateDataset(t,e){return this.makeTestFunction(),async function(t,e,n){const i=null!=(n=n||{}).batches,s=t.testFunction;let o=[];if(n.verbose>0)throw new _h("Verbose mode is not implemented yet.");r.assert(!i||n.batches>0&&Number.isInteger(n.batches),()=>"Test loop expects `batches` to be a positive integer, but received "+JSON.stringify(n.batches));const a="function"==typeof e.next?e:await e.iterator();let l=0,u=0;for(;!i||u<n.batches;){const e=await a.next();if(o=Tn(()=>{if(e.value){const{xs:n,ys:r}=Mp(t,e.value),i=n.concat(r),a=Tn(()=>s(i));if(On(i),0===u)for(let t=0;t<a.length;++t)o.push(Si(0));const c=i[0].shape[0];for(let t=0;t<a.length;++t){const e=a[t],n=o[t];o[t]=Tn(()=>Le(o[t],Xn(c,e))),u>0&&On(n)}On(a),l+=c,++u}return o}),e.done){i&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let r=0;r<o.length;++r){const t=o[r];o[r]=Hr(o[r],l),On(t)}return kh(o)}(this,t,e)}checkNumSamples(t,e,n,r="steps"){let i;if(null!=n){if(i=null,null!=e)throw new xh(`If ${r} is set, batchSize must be null or undefined.Got batchSize = `+e)}else{if(null==t)throw new xh("Either the input data should have a defined shape, or "+r+" shoud be specified.");i=Array.isArray(t)?t[0].shape[0]:t.shape[0]}return i}execute(t,e){if(Array.isArray(e)&&0===e.length)throw new xh("`outputs` is an empty Array, which is not allowed.");const n=Array.isArray(e),r=this.retrieveSymbolicTensors(n?e:[e]),i=new Cp;if(t instanceof ue&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new xh(`The number of inputs provided (${t.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let e=0;e<this.inputs.length;++e)i.add(this.inputs[e],t[e])}else for(const o of this.inputs){const e=t[o.name];if(null==e)throw new xh("No value is provided for the model's input "+o.name);i.add(o,e)}const s=Ap(r,i);return n?s:s[0]}retrieveSymbolicTensors(t){const e=Sh(null,t.length);let n=t.length;for(const r of this.layers){const i=Array.isArray(r.output)?r.output:[r.output],s=i.map(t=>t.name);for(let r=0;r<t.length;++r){const o=s.indexOf(t[r]);if(-1!==o&&(e[r]=i[o],n--),0===n)break}if(0===n)break}if(n>0){const n=[];throw e.forEach((e,r)=>{null==e&&n.push(t[r])}),new xh("Cannot find SymbolicTensors for output name(s): "+JSON.stringify(n))}return e}predictLoop(t,e=32,n=!1){return Tn(()=>{const r=this.checkNumSamples(t);if(n)throw new _h("Verbose predictLoop() is not implemented yet.");const i=jp(r,e),s=this.outputs.map(t=>[]);for(let e=0;e<i.length;++e)Tn(()=>{const n=Lp(t,i[e][0],i[e][1]),r=[];if(Array.isArray(n))for(let t=0;t<n.length;++t)r.push({key:this.inputs[t],value:n[t]});else r.push({key:this.inputs[0],value:n});const s=new Cp(r);return Ap(this.outputs,s)}).forEach((t,e)=>s[e].push(t));return kh(s.map(t=>Yn(t,0)))})}predict(t,e={}){const n=Up(t);Gp(n,this.inputNames,this.feedInputShapes,!1);try{const r=null==e.batchSize?32:e.batchSize;return zp(r),this.predictLoop(n,r)}finally{Vp(n,t)}}predictOnBatch(t){Gp(t,this.inputNames,this.feedInputShapes,!0);const e=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,e)}standardizeUserDataXY(t,e,n=!0,i){if(null==this.optimizer_)throw new bh("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const s=[];for(let r=0;r<this.feedOutputShapes.length;++r){const t=this.feedOutputShapes[r];s.push(this.feedLossFns[r]===np?t.slice(0,t.length-1).concat([1]):t)}if(function(t,e,n){const i=Fh(t.map(t=>t.shape[0]));i.sort();const s=Fh(e.map(t=>t.shape[0]));if(s.sort(),i.length>1)throw new xh("All input Tensors (x) should have the same number of samples. Got array shapes: "+JSON.stringify(t.map(t=>t.shape)));if(s.length>1)throw new xh("All target Tensors (y) should have the same number of samples. Got array shapes: "+JSON.stringify(e.map(t=>t.shape)));if(i.length>0&&s.length>0&&!r.arraysEqual(i,s))throw new xh(`Input Tensors should have the same number of samples as target Tensors. Found ${i[0]} input sample(s) and ${s[0]} target sample(s).`)}(t=Hp(t,this.feedInputNames,this.feedInputShapes,!1,"input"),e=Hp(e,this.feedOutputNames,s,!1,"target")),function(t,e,n){const r=[Qf,rp,ep];for(let i=0;i<t.length;++i){const s=t[i],o=e[i],a=n[i];if(null!=o){if(o===ep&&1===s.shape[s.shape.length-1])throw new xh(`You are passing a target array of shape ${s.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(-1!==r.indexOf(o)){const t=s.shape.slice(1),e=a.slice(1);for(let n=0;n<t.length;++n){const r=t[n],i=e[n];if(null!=i&&r!==i)throw new xh(`A target Tensor with shape ${s.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}(e,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=i&&i>0&&t[0].shape[0]%i!=0)throw new xh(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${i}. Found: ${t[0].shape[0]} sample(s).`);return[t,e]}async standardizeUserData(t,e,n,r,i=!0,s){const[o,a]=this.standardizeUserDataXY(t,e,i,s);if(null!=n)throw new Error("sample weight is not supported yet.");let l=null;if(null!=r){const t=Ip(r,this.outputNames);l=[];for(let e=0;e<t.length;++e)l.push(await Rp(a[e],null,t[e]))}return[o,a,l]}testLoop(t,e,n,r=0,i){return Tn(()=>{const s=this.checkNumSamples(e,n,i,"steps"),o=[];if(r>0)throw new _h("Verbose mode is not implemented yet.");if(null!=i)throw new _h("steps mode in testLoop() is not implemented yet");{const r=jp(s,n),i=Gs(vd(0,s));for(let n=0;n<r.length;++n){const s=r[n][0],a=r[n][1],l=_d(i,s,a-s),u=Bp(e,l),c=t(u);if(0===n)for(let t=0;t<c.length;++t)o.push(Si(0));for(let t=0;t<c.length;++t)o[t]=Le(o[t],Xn(a-s,c[t]))}for(let t=0;t<o.length;++t)o[t]=Hr(o[t],s)}return o})}getDedupedMetricsNames(){const t=this.metricsNames,e=[];for(let n=0;n<t.length;++n){const r=t[n];let i=r;Eh(t,r)>1&&(i+="_"+Eh(t.slice(0,n),r)),e.push(i)}return e}makeTrainFunction(){return t=>{const e=[],n=t.slice(0,this.inputs.length),r=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=t.slice(this.inputs.length+this.outputs.length,this.inputs.length+2*this.outputs.length),s=[],o=this.collectedTrainableWeights.map(t=>t.read());return[this.optimizer_.minimize(()=>{const t=[];for(let e=0;e<this.inputs.length;++e)t.push({key:this.inputs[e],value:n[e]});const o=new Cp(t),a=Ap(this.outputs,o,{training:!0});let l;for(let n=0;n<this.lossFunctions.length;++n){let t=(0,this.lossFunctions[n])(r[n],a[n]);null!=i[n]&&(t=Fp(t,i[n]));const s=os(t);e.push(s),l=0===n?t:Le(l,t)}for(let n=0;n<this.metricsTensors.length;++n){let t;if(this.outputs.length>1&&n<this.outputs.length)t=e[n];else{const e=this.metricsTensors[n][1];t=os((0,this.metricsTensors[n][0])(r[e],a[e]))}In(t),s.push(t)}return l=os(l),this.calculateLosses().forEach(t=>{l=Le(l,t)}),l},!0,o)].concat(s)}}makeTestFunction(){this.testFunction=t=>Tn(()=>{const e=[];let n;const r=t.slice(0,this.inputs.length),i=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),s=[];for(let t=0;t<this.inputs.length;++t)s.push({key:this.inputs[t],value:r[t]});const o=new Cp(s),a=Ap(this.outputs,o);for(let t=0;t<this.lossFunctions.length;++t){const r=os((0,this.lossFunctions[t])(i[t],a[t]));n=0===t?r:Le(n,r),e.push(n)}for(let t=0;t<this.metricsTensors.length;++t){const n=this.metricsTensors[t][1],r=os((0,this.metricsTensors[t][0])(i[n],a[n]));e.push(r)}return e})}async fit(t,e,n={}){return async function(t,e,n,i={}){if(t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");let s,o,a,l,u,c,h;t.isTraining=!0;try{const d=null==i.batchSize?32:i.batchSize;zp(d);const f=!1,p=await t.standardizeUserData(e,n,i.sampleWeight,i.classWeight,f,d);s=p[0],o=p[1],h=p[2];let m,g=!1;if(null!=i.validationData&&i.validationData.length>0){if(g=!0,2!==i.validationData.length)throw 3===i.validationData.length?new _h("validationData including sample weights is not supported yet."):new xh("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+i.validationData+" is invalid.");a=i.validationData[0],l=i.validationData[1];const e=!0,n=await t.standardizeUserData(a,l,null,null,e,d);u=n[0],c=n[1],m=u.concat(c)}else if(null!=i.validationSplit&&i.validationSplit>0&&i.validationSplit<1){g=!0;const t=Math.floor(s[0].shape[0]*(1-i.validationSplit)),e=s[0].shape[0];u=Lp(s,t,e),s=Lp(s,0,t),c=Lp(o,t,e),o=Lp(o,0,t),m=u.concat(c)}else null!=i.validationSteps&&(g=!0);const y=s.concat(o).concat(h);t.checkTrainableWeightsConsistency();const v=t.makeTrainFunction(),b=t.getDedupedMetricsNames();let x,_;g?(t.makeTestFunction(),x=t.testFunction,_=b.slice().concat(b.map(t=>"val_"+t))):(x=null,m=[],_=b.slice());const w=Gf(i.callbacks,i.yieldEvery);return await async function(t,e,n,i,s,o,a,l,u,c,h,d,f,p,m){null==s&&(s=32),null==o&&(o=1),null==h&&(h=!0),null==f&&(f=0);let g=!1;null!=u&&null!=c&&(g=!0);const y=t.checkNumSamples(n,s,null,"steps_per_epoch");let v;null!=y&&(v=vd(0,y)),null==a&&(a=1);const{callbackList:b,history:x}=Kf(l,a,o,f,y,null,s,g,d);b.setModel(t),t.history=x,await b.onTrainBegin(),t.stopTraining_=!1;for(let _=f;_<o;++_){await b.onEpochBegin(_);const o={};{if("batch"===h)throw new _h("batch shuffling is not implemneted yet");h&&r.shuffle(v);const a=Gs(v),l=jp(y,s);for(let r=0;r<l.length;++r){const h={};if(await b.onBatchBegin(r,h),Tn(()=>{const d=l[r][0],f=l[r][1],p=_d(a,d,f-d);h.batch=r,h.size=f-d;const m=Bp(n,p),y=e(m);for(let t=0;t<i.length;++t){const e=y[t];h[i[t]]=e,In(e)}if(r===l.length-1&&g){const e=t.testLoop(u,c,s);for(let t=0;t<i.length;++t){const n=i[t],r=e[t];In(r),o["val_"+n]=r}}}),await b.onBatchEnd(r,h),Bf(h),t.stopTraining_)break}a.dispose()}if(await b.onEpochEnd(_,o),t.stopTraining_)break}return await b.onTrainEnd(),await t.history.syncData(),t.history}(t,v,y,b,d,i.epochs,i.verbose,w,x,m,i.shuffle,_,i.initialEpoch)}finally{t.isTraining=!1,Vp(s,e),Vp(o,n),Vp(u,a),Vp(c,l),null!=h&&On(h)}}(this,t,e,n)}async fitDataset(t,e){return async function(t,e,n){const i=null!=n.batchesPerEpoch;if(r.assert(null!=t.optimizer,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),r.assert(null!=n,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),r.assert(null!=n.epochs&&n.epochs>0&&Number.isInteger(n.epochs),()=>"For fitDataset(), config.epochs is expected to be a positive integer, but got "+n.epochs),r.assert(!i||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>"For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got "+n.batchesPerEpoch),r.assert(null==n.validationSplit,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;try{const s=null!=n.validationData;let o,a;if(s)if(Pp(n.validationData))r.assert(null==n.validationBatches||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got "+n.validationBatches);else{const t=function(t){if(3===t.length)throw new _h("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}(n.validationData);o=t.xs,a=t.ys}const l=t.makeTrainFunction(),u=t.getDedupedMetricsNames();let c;c=s?u.slice().concat(u.map(t=>"val_"+t)):u.slice();const h=Gf(n.callbacks,n.yieldEvery),d=null==n.verbose?1:n.verbose,{callbackList:f,history:p}=Kf(h,d,n.epochs,null,null,function(t,e){let n=null;return null!=e.batchesPerEpoch?n=e.batchesPerEpoch:Number.isFinite(t.size)&&(n=t.size),n}(e,n),null,s,c);f.setModel(t),t.history=p,await f.onTrainBegin(),t.stopTraining_=!1;let m=null==n.initialEpoch?0:n.initialEpoch,g=await e.iterator();for(;m<n.epochs;){const r={};await f.onEpochBegin(m);let c=0,h=0;for(i||(g=await e.iterator());!i||c<n.batchesPerEpoch;){const e=await g.next();if(i&&e.done){console.warn("You provided `batchesPerEpoch` as "+n.batchesPerEpoch+", but your dataset iterator ran out of data after "+c+" batches; interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+n.batchesPerEpoch*n.epochs+" batches). You may need to use the repeat() function when building your dataset.");break}if(null!=e.value){const{xs:r,ys:i}=Mp(t,e.value),s={};s.batch=h,s.size=r[0].shape[0],await f.onBatchBegin(h,s);const o=[];if(null!=n.classWeight){const e=Ip(n.classWeight,t.outputNames);for(let t=0;t<e.length;++t)o.push(await Rp(i[t],null,e[t]))}const a=r.concat(i).concat(o),d=l(a);On(a);for(let t=0;t<u.length;++t){const e=d[t];s[u[t]]=e,In(e)}await f.onBatchEnd(h,s),Bf(s),h++,c++}if(i?c>=n.batchesPerEpoch:e.done){if(s){let e;e=Pp(n.validationData)?Ah(await t.evaluateDataset(n.validationData,{batches:n.validationBatches})):Ah(t.evaluate(o,a,{batchSize:null==n.validationBatchSize?32:n.validationBatchSize,verbose:0}));for(let n=0;n<t.metricsNames.length;++n)r["val_"+t.metricsNames[n]]=e[n]}break}if(t.stopTraining_)break}if(await f.onEpochEnd(m,r),m++,t.stopTraining_)break}return await f.onTrainEnd(),await t.history.syncData(),t.history}finally{t.isTraining=!1}}(this,t,e)}async trainOnBatch(t,e){const n=await this.standardizeUserData(t,e),r=n[0],i=n[1],s=this.makeTrainFunction()(r.concat(i)),o=[];for(const a of s){const t=await a.data();o.push(t[0])}return On(s),kh(o)}getNamedWeights(t){const e=[],n=null!=t&&t.trainableOnly,r=n?this.trainableWeights:this.weights,i=this.getWeights(n);for(let s=0;s<r.length;++s)n&&!r[s].trainable||e.push({name:r[s].originalName,tensor:i[s]});return e}set stopTraining(t){this.stopTraining_=t}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)}dispose(){const t=super.dispose();if(0===t.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){const e=Dn().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=e-Dn().numTensors}return t}getLossIdentifiers(){let t;if("string"==typeof this.loss)t=Dh(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if("string"!=typeof t)throw new Error("Serialization of non-string loss is not supported.");t=this.loss.map(t=>Dh(t))}else{const e=Object.keys(this.loss);t={};const n=this.loss;for(const r of e){if("string"!=typeof n[r])throw new Error("Serialization of non-string loss is not supported.");t[r]=Dh(n[r])}}return t}getMetricIdentifiers(){if("string"==typeof this.metrics||"function"==typeof this.metrics)return[Dh(yp(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(t=>Dh(yp(t)));{const t={};for(const e in this.metrics)t[e]=Dh(yp(this.metrics[e]));return t}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(t){if(null!=t.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=t.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=t.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");const e=Xf(Sp(t.optimizer_config));let n,r;if("string"==typeof t.loss)n=Nh(t.loss);else if(Array.isArray(t.loss))n=t.loss.map(t=>Nh(t));else if(null!=t.loss){n={};for(const e in t.loss)n[e]=Nh(t.loss[e])}if(Array.isArray(t.metrics))r=t.metrics.map(t=>Nh(t));else if(null!=t.metrics){r={};for(const e in t.metrics)r[e]=Nh(t.metrics[e])}this.compile({loss:n,metrics:r,optimizer:e})}async save(t,e){if("string"==typeof t){const e=d.getSaveHandlers(t);if(0===e.length)throw new xh(`Cannot find any save handlers for URL '${t}'`);if(e.length>1)throw new xh(`Found more than one (${e.length}) save handlers for URL '${t}'`);t=e[0]}if(null==t.save)throw new xh("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const n=await d.encodeWeights(this.getNamedWeights(e)),r={modelTopology:this.toJSON(null,!1),format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v2.3.0",convertedBy:null};if(null!=e&&e.includeOptimizer&&null!=this.optimizer){r.trainingConfig=this.getTrainingConfig();const t="optimizer",{data:e,specs:i}=await d.encodeWeights(await this.optimizer.getWeights(),t);n.specs.push(...i),n.data=d.concatenateArrayBuffers([n.data,e])}return null!=this.userDefinedMetadata&&(vp(this.userDefinedMetadata,this.name,!0),r.userDefinedMetadata=this.userDefinedMetadata),r.weightData=n.data,r.weightSpecs=n.specs,t.save(r)}setUserDefinedMetadata(t){vp(t,this.name),this.userDefinedMetadata=t}getUserDefinedMetadata(){return this.userDefinedMetadata}}async function Kp(t,e){"modelTopology"in t||(t={modelTopology:t});let n=(t=t).modelTopology;null!=n.model_config&&(n=n.model_config);const r=Xf(Sp(n),e);if(null!=t.weightsManifest){const e=await d.loadWeights(t.weightsManifest,t.pathPrefix,r.weights.map(t=>t.originalName)),n={};for(const t of r.weights)n[t.originalName]=e[t.originalName];r.loadWeights(n),On(e)}return r}Yp.className="Model",g.registerClass(Yp);class Xp extends Yp{constructor(t){if(super({inputs:[],outputs:[]}),t=t||{},this.trainable=!0,this.built=!1,this.name=null!=t.name?t.name:wf("sequential_"),null!=t.layers)for(const e of t.layers)this.add(e)}checkShape(t){if(t.inboundNodes[0].outputTensors[0].shape.some(t=>t<0))throw new xh("Negative dimension size caused by adding layer "+t.name+" with input shape ["+t.inboundNodes[0].inputTensors[0].shape+"]")}add(t){const e=t instanceof Xp||t instanceof Yp;let n;if(e){if(n=t,1!==n.outputs.length)throw new xh("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==n.inputs.length)throw new xh("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===t.inboundNodes.length){if(null==t.batchInputShape)throw new xh("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const e=zf({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(e)}if(e)this.outputs=n.outputs,this.inputs=n.inputs;else{if(1!==t.inboundNodes.length)throw new xh(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${t.name} which has ${t.inboundNodes.length} pre-existing inbound connections.`);if(1!==t.inboundNodes[0].outputTensors.length)throw new xh("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=function t(e,n,r){if((null==n||null!=r&&r>0)&&(n=e.sourceLayer,r=e.nodeIndex),0===n.inboundNodes.length)return[e];{const e=n.inboundNodes[r];if(0===e.inboundLayers.length)return e.inputTensors;{const n=[];for(let r=0;r<e.inboundLayers.length;r++){const i=t(e.inputTensors[r],e.inboundLayers[r],e.nodeIndices[r]);for(const t of i)-1===n.indexOf(t)&&n.push(t)}return n}}}(this.outputs[0])}this.inboundNodes=[],new Ff({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Sh(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(t=>t.shape),outputShapes:this.outputs[0].shape})}else{const e=t.apply(this.outputs[0]);if(Array.isArray(e))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[e],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1}pop(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(t,e){return null==this.model&&this.build(),this.model.call(t,e)}build(t){if(kf(t),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Yp({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(t,e,n=console.log){this.built||this.build(),super.summary(t,e,n)}setWeights(t){null==this.model&&this.build(),this.model.setWeights(t)}evaluate(t,e,n={}){if(!this.built)throw new bh("The model needs to be compiled before being used.");return this.model.evaluate(t,e,n)}async evaluateDataset(t,e){if(!this.built)throw new bh("The model needs to be compiled before being used.");return this.model.evaluateDataset(t,e)}predict(t,e={}){return null==this.model&&this.build(),this.model.predict(t,e)}predictOnBatch(t){return null==this.model&&this.build(),this.model.predictOnBatch(t)}compile(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return null==this.model?void 0:this.model.optimizer}set optimizer(t){this.model.optimizer=t}async fit(t,e,n={}){if(!this.built)throw new bh("The model needs to be compiled before being used.");return this.model.fit(t,e,n)}async fitDataset(t,e){if(!this.built)throw new bh("The model needs to be compiled before being used.");return this.model.fitDataset(t,e)}async trainOnBatch(t,e){return this.model.trainOnBatch(t,e)}static fromConfig(t,e,n={},i=!1){let s,o={};if(e instanceof Array){if(null==e[0].className||"Merge"===e[0].className)throw new xh("Legacy serialization format not supported yet.");s=e}else r.assert(null!=e.layers,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),s=e.layers,delete e.layers,o=e;const a=new t(o);if(!(a instanceof Xp))throw new _h("Sequential.fromConfig called on non-Sequential input: "+a);for(const r of s){const t=Xf(r,void 0,i);i&&t.setFastWeightInitDuringBuild(!0),a.add(t)}return a}set stopTraining(t){if(null==this.model)throw new xh("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t}get stopTraining(){if(null==this.model)throw new xh("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const t=[];for(const e of this.layers){const n={};n.className=e.getClassName(),n.config=e.getConfig(),t.push(n)}return{name:this.name,layers:t}}}function Zp(t){return new Yp(t)}function Qp(t){return new Xp(t)}function Jp(t,e){return null==e&&(e={}),async function(t,e){if(null==e&&(e={}),"string"==typeof t){const n=d.getLoadHandlers(t,e);if(0===n.length)n.push(d.browserHTTPRequest(t,e));else if(n.length>1)throw new xh(`Found more than one (${n.length}) load handlers for URL '${t}'`);t=n[0]}return async function(t,e,n){if(null==n&&(n={}),null==t.load)throw new xh("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const r=await t.load();let i=r.modelTopology;null!=i.model_config&&(i=i.model_config);const s=null==n.strict||n.strict,o=null!=r.weightData&&null!=r.weightSpecs&&s,a=Xf(Sp(i),void 0,o),l=r.trainingConfig;if(null!=l&&a.loadTrainingConfig(l),null!=r.userDefinedMetadata&&a.setUserDefinedMetadata(r.userDefinedMetadata),null!=r.weightData){if(null==r.weightSpecs)throw new xh("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:t,optimizerWeights:e}=function(t,e){const n=d.decodeWeights(t,e),r={},i=[];return e.forEach(t=>{"optimizer"===t.group?i.push({name:t.name,tensor:n[t.name]}):r[t.name]=n[t.name]}),{modelWeights:r,optimizerWeights:i}}(r.weightData,r.weightSpecs);a.loadWeights(t,s),null!=a.optimizer&&e.length>0&&await a.optimizer.setWeights(e),On(t),On(e.map(t=>t.tensor))}return a}(t,0,e)}(t,e)}function tm(t){return zf(t)}function em(t,e){Yf.registerCallbackConstructor(t,e)}Xp.className="Sequential",g.registerClass(Xp);class nm extends g.Serializable{getConfig(){return{}}}class rm extends nm{apply(t,e=1){return function(t,e=1){if(1!==e)throw new _h(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return ei(t)}(t,e)}}rm.className="elu",g.registerClass(rm);class im extends nm{apply(t){return ao(t)}}im.className="selu",g.registerClass(im);class sm extends nm{apply(t){return Xs(t)}}sm.className="relu",g.registerClass(sm);class om extends nm{apply(t){return Tn(()=>ls(6,Xs(t)))}}om.className="relu6",g.registerClass(om);class am extends nm{apply(t){return t}}am.className="linear",g.registerClass(am);class lm extends nm{apply(t){return Zn(t)}}lm.className="sigmoid",g.registerClass(lm);class um extends nm{apply(t){return function(t){return Tn(()=>{const e=Le(.5,Xn(.2,t));return Er(e,0,1)})}(t)}}um.className="hardSigmoid",g.registerClass(um);class cm extends nm{apply(t){return Wi(t)}}cm.className="softplus",g.registerClass(cm);class hm extends nm{apply(t){return function(t){return Tn(()=>Hr(t,$e(t).add(1)))}(t)}}hm.className="softsign",g.registerClass(hm);class dm extends nm{apply(t){return fr(t)}}dm.className="tanh",g.registerClass(dm);class fm extends nm{apply(t,e=-1){return vo(t,e)}}fm.className="softmax",g.registerClass(fm);class pm extends nm{apply(t,e=-1){return Ki(t,e)}}function mm(t){return t.getClassName()}function gm(t,e={}){return Ih(t,g.SerializationMap.getMap().classNameMap,e,"activation")}function ym(t){if(null==t)return gm({className:"linear",config:{}});if("string"==typeof t){const e={};return e.className=t,e.config={},gm(e)}return t instanceof nm?t:gm(t)}function vm(t){if(null!=t&&"object"!=typeof t)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an object, but received: "+t)}pm.className="logSoftmax",g.registerClass(pm);class bm extends g.Serializable{}class xm extends bm{constructor(t){super(),vm(t),this.l1=null==t||null==t.l1?.01:t.l1,this.l2=null==t||null==t.l2?.01:t.l2,this.hasL1=0!==this.l1,this.hasL2=0!==this.l2}apply(t){return Tn(()=>{let e=is([1]);return this.hasL1&&(e=Le(e,Yi(Xn(this.l1,$e(t))))),this.hasL2&&(e=Le(e,Yi(Xn(this.l2,Td(t))))),e.asScalar()})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(t,e){return new t({l1:e.l1,l2:e.l2})}}xm.className="L1L2",g.registerClass(xm);const _m={l1l2:"L1L2"};function wm(t){return Oh(t)}function Sm(t,e={}){return Ih(t,g.SerializationMap.getMap().classNameMap,e,"regularizer")}function Cm(t){return null==t?null:"string"==typeof t?Sm({className:t in _m?_m[t]:t,config:{}}):t instanceof bm?t:Sm(t)}class Em extends $f{constructor(t){super(null==t?{}:t),this.supportsMasking=!0,null!=t&&(this.maxValue=t.maxValue)}call(t,e){t=Ef(t);let n=Xs(t);return null!=this.maxValue&&(n=Er(n,0,this.maxValue)),n}computeOutputShape(t){return t}getConfig(){const t={maxValue:this.maxValue},e=super.getConfig();return Object.assign(t,e),t}}Em.className="ReLU",g.registerClass(Em);class km extends $f{constructor(t){super(null==t?{}:t),this.DEFAULT_ALPHA=.3,null==t&&(t={}),this.alpha=null==t.alpha?this.DEFAULT_ALPHA:t.alpha}call(t,e){const n=Ef(t);return Ni(n,this.alpha)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},e=super.getConfig();return Object.assign(t,e),t}}km.className="LeakyReLU",g.registerClass(km);class Am extends $f{constructor(t){if(super(null==t?{}:t),this.DEFAULT_ALPHA_INITIALIZER="zeros",null==t&&(t={}),this.supportsMasking=!0,this.alphaInitializer=nf(t.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Cm(t.alphaRegularizer),this.alphaConstraint=Kh(t.alphaConstraint),null==t.sharedAxes)this.sharedAxes=null;else if(Array.isArray(t.sharedAxes))this.sharedAxes=t.sharedAxes;else{if("number"!=typeof t.sharedAxes)throw new xh("Expected sharedAxes to be a number or an array of numbers, but got "+t.sharedAxes);this.sharedAxes=[t.sharedAxes]}}build(t){const e=(t=kf(t)).slice(1);if(null!=this.sharedAxes)for(const r of this.sharedAxes)e[r-1]=1;this.alpha=this.addWeight("alpha",e,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const n={};if(null!=this.sharedAxes)for(let r=1;r<t.length;++r)n[r]=t[r];this.inputSpec=[new Of({ndim:t.length,axes:n})],this.built=!0}call(t,e){return t=Ef(t),ks(t,this.alpha.read())}getConfig(){const t={alphaInitializer:ef(this.alphaInitializer),alphaRegularizer:wm(this.alphaRegularizer),alphaConstraint:Gh(this.alphaConstraint),sharedAxes:this.sharedAxes},e=super.getConfig();return Object.assign(t,e),t}}Am.className="PReLU",g.registerClass(Am);class Dm extends $f{constructor(t){if(super(null==t?{}:t),this.DEFAULT_ALPHA=1,null==t&&(t={}),null!=t.alpha&&t.alpha!==this.DEFAULT_ALPHA)throw new _h(`Non-default alpha value (${t.alpha}) is not supported by the ELU layer yet.`);this.alpha=null==t.alpha?this.DEFAULT_ALPHA:t.alpha}call(t,e){const n=Ef(t);return ei(n)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},e=super.getConfig();return Object.assign(t,e),t}}Dm.className="ELU",g.registerClass(Dm);class Nm extends $f{constructor(t){super(null==t?{}:t),this.DEFAULT_THETA=1,null==t&&(t={}),this.theta=null==t.theta?this.DEFAULT_THETA:t.theta}call(t,e){const n=Ef(t);return n.mul(bd(n.greater(this.theta),"float32"))}computeOutputShape(t){return t}getConfig(){const t={theta:this.theta},e=super.getConfig();return Object.assign(t,e),t}}Nm.className="ThresholdedReLU",g.registerClass(Nm);class Tm extends $f{constructor(t){super(null==t?{}:t),this.DEFAULT_AXIS=1,null==t&&(t={}),this.softmax=(new fm).apply,this.axis=null==t.axis?this.DEFAULT_AXIS:t.axis}call(t,e){const n=Ef(t);return this.softmax(n,this.axis)}computeOutputShape(t){return t}getConfig(){const t={axis:this.axis},e=super.getConfig();return Object.assign(t,e),t}}function Om(t,e,n){if("number"==typeof t)return Sh(t,e);if(t.length!==e)throw new xh(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${t.length} elements.`);for(let i=0;i<e;++i){const s=t[i];if((r=s)!==parseInt(r.toString(),10))throw new xh(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(t)} including a non-integer number `+s)}return t;var r}function Im(t,e,n,r,i=1){if(null==t)return t;let s;return s="same"===n?t:t-(e+(e-1)*(i-1))+1,Math.floor((s+r-1)/r)}function Rm(t,e,n,r){if(null==t)return null;if("valid"===r)t=t*e+yd([n-e,0]);else{if("same"!==r)throw new xh(`Unsupport padding mode: ${r}.`);t*=e}return t}function Fm(t,e){return Tn(()=>(sd(e),"channelsFirst"===e?Xe(t,[0,2,3,1]):t))}function Mm(t,e){return Tn(()=>(sd(e),"channelsFirst"===e?Xe(t,[0,2,3,4,1]):t))}function $m(t,e,n,r=[1,1],i="valid",s,o,a=null){return Tn(()=>{if(null==s&&(s="channelsLast"),sd(s),3!==t.rank&&4!==t.rank)throw new xh(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${t.rank}.`);if(3!==e.rank&&4!==e.rank)throw new xh(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${t.rank}.`);let l=Fm(t,s);if("causal"===i)throw new _h("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=c.conv2d({x:l,filter:e,strides:r,pad:"same"===i?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:a}),"channelsFirst"===s&&(l=Xe(l,[0,3,1,2])),l})}Tm.className="Softmax",g.registerClass(Tm);class Pm extends $f{constructor(t,e){if(super(e),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",Pm.verifyArgs(e),this.rank=t,zh(this.rank,"rank"),1!==this.rank&&2!==this.rank&&3!==this.rank)throw new _h(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Om(e.kernelSize,t,"kernelSize"),this.strides=Om(null==e.strides?1:e.strides,t,"strides"),this.padding=null==e.padding?"valid":e.padding,od(this.padding),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,sd(this.dataFormat),this.activation=ym(e.activation),this.useBias=null==e.useBias||e.useBias,this.biasInitializer=nf(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Kh(e.biasConstraint),this.biasRegularizer=Cm(e.biasRegularizer),this.activityRegularizer=Cm(e.activityRegularizer),this.dilationRate=Om(null==e.dilationRate?1:e.dilationRate,t,"dilationRate"),1===this.rank&&Array.isArray(this.dilationRate)&&1!==this.dilationRate.length)throw new xh("dilationRate must be a number or an array of a single number for 1D convolution, but received "+JSON.stringify(this.dilationRate));if(2===this.rank){if("number"==typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate];else if(2!==this.dilationRate.length)throw new xh("dilationRate must be a number or array of two numbers for 2D convolution, but received "+JSON.stringify(this.dilationRate))}else if(3===this.rank)if("number"==typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(3!==this.dilationRate.length)throw new xh("dilationRate must be a number or array of three numbers for 3D convolution, but received "+JSON.stringify(this.dilationRate))}static verifyArgs(t){if(Ch("kernelSize"in t,"required key 'kernelSize' not in config"),"number"!=typeof t.kernelSize&&!Ph(t.kernelSize,"number",1,3))throw new xh(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(t.kernelSize)}.`)}getConfig(){const t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:mm(this.activation),useBias:this.useBias,biasInitializer:ef(this.biasInitializer),biasRegularizer:wm(this.biasRegularizer),activityRegularizer:wm(this.activityRegularizer),biasConstraint:Gh(this.biasConstraint)},e=super.getConfig();return Object.assign(t,e),t}}class zm extends Pm{constructor(t,e){super(t,e),this.kernel=null,zm.verifyArgs(e),this.filters=e.filters,zh(this.filters,"filters"),this.kernelInitializer=nf(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Kh(e.kernelConstraint),this.kernelRegularizer=Cm(e.kernelRegularizer)}build(t){t=kf(t);const e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e])throw new xh("The channel dimension of the input should be defined. Found "+t[e]);const n=t[e],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[e]:n}}],this.built=!0}call(t,e){return Tn(()=>{let e;t=Ef(t);const n=null==this.bias?null:this.bias.read(),r=Lh(this.activation.getClassName());if(null!=r&&2===this.rank)e=$m(t,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate,r);else{if(1===this.rank)e=function(t,e,n,r=1,i="valid",s,o=1){return Tn(()=>{if(null==s&&(s="channelsLast"),sd(s),3!==t.shape.length)throw new xh("The input of a conv1dWithBias operation should be 3, but is "+t.shape.length+" instead.");if(3!==e.shape.length)throw new xh("The kernel for a conv1dWithBias operation should be 3, but is "+e.shape.length+" instead");if(null!=n&&1!==n.shape.length)throw new xh("The bias for a conv1dWithBias operation should be 1, but is "+e.shape.length+" instead");if("channelsFirst"===s&&(t=Xe(t,[0,2,1])),"causal"===i)throw new _h("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=Ir(t,e,r,"same"===i?"same":"valid","NWC",o);return null!=n&&(a=Id(a,n)),a})}(t,this.kernel.read(),n,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(2===this.rank)e=$m(t,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate);else{if(3!==this.rank)throw new _h("convolutions greater than 3D are not implemented yet.");e=function(t,e,n,r=[1,1,1],i="valid",s,o){return Tn(()=>{if(null==s&&(s="channelsLast"),sd(s),4!==t.rank&&5!==t.rank)throw new xh("conv3dWithBias expects input to be of rank 4 or 5, but received "+t.rank+".");if(4!==e.rank&&5!==e.rank)throw new xh("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+t.rank+".");let a=Mm(t,s);if("causal"===i)throw new _h("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=Mr(a,e,r,"same"===i?"same":"valid","NDHWC",o),null!=n&&(a=Id(a,n)),"channelsFirst"===s&&(a=Xe(a,[0,4,1,2,3])),a})}(t,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate)}null!=this.activation&&(e=this.activation.apply(e))}return e})}computeOutputShape(t){t=kf(t);const e=[],n="channelsLast"===this.dataFormat?t.slice(1,t.length-1):t.slice(2);for(let i=0;i<n.length;++i){const t=Im(n[i],this.kernelSize[i],this.padding,this.strides[i],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[i]);e.push(t)}let r=[t[0]];return"channelsLast"===this.dataFormat?(r=r.concat(e),r.push(this.filters)):(r.push(this.filters),r=r.concat(e)),r}getConfig(){const t={filters:this.filters,kernelInitializer:ef(this.kernelInitializer),kernelRegularizer:wm(this.kernelRegularizer),kernelConstraint:Gh(this.kernelConstraint)},e=super.getConfig();return Object.assign(t,e),t}static verifyArgs(t){if(!("filters"in t)||"number"!=typeof t.filters||t.filters<1)throw new xh("Convolution layer expected config.filters to be a 'number' > 0 but got "+JSON.stringify(t.filters))}}class Lm extends zm{constructor(t){super(2,t),Lm.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if("number"!=typeof t.kernelSize&&!Ph(t.kernelSize,"number",1,2))throw new xh(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(t.kernelSize)}.`)}}Lm.className="Conv2D",g.registerClass(Lm);class Bm extends zm{constructor(t){super(3,t),Bm.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if("number"!=typeof t.kernelSize&&(!Array.isArray(t.kernelSize)||1!==t.kernelSize.length&&3!==t.kernelSize.length))throw new xh(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(t.kernelSize)}.`)}}Bm.className="Conv3D",g.registerClass(Bm);class jm extends Lm{constructor(t){if(super(t),this.inputSpec=[new Of({ndim:4})],"same"!==this.padding&&"valid"!==this.padding)throw new xh("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode "+this.padding)}build(t){if(4!==(t=kf(t)).length)throw new xh("Input should have rank 4; Received input shape: "+JSON.stringify(t));const e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e])throw new xh("The channel dimension of the inputs should be defined. Found `None`.");const n=t[e],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Of({ndim:4,axes:{[e]:n}})],this.built=!0}call(t,e){return Tn(()=>{let e=Ef(t);if(4!==e.shape.length)throw new xh("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-"+e.shape.length);const n=e.shape;let r,i;"channelsFirst"===this.dataFormat?(r=2,i=3):(r=1,i=2);const s=n[i],o=this.kernelSize[1],a=this.strides[1],l=[n[0],Rm(n[r],this.strides[0],this.kernelSize[0],this.padding),Rm(s,a,o,this.padding),this.filters];"channelsLast"!==this.dataFormat&&(e=Xe(e,[0,2,3,1]));let u=Fr(e,this.kernel.read(),l,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(u=Xe(u,[0,3,1,2])),null!=this.bias&&(u=Id(u,this.bias.read(),this.dataFormat)),null!=this.activation&&(u=this.activation.apply(u)),u})}computeOutputShape(t){const e=(t=kf(t)).slice();let n,r,i;"channelsFirst"===this.dataFormat?(n=1,r=2,i=3):(n=3,r=1,i=2);const s=this.kernelSize[0],o=this.kernelSize[1],a=this.strides[0],l=this.strides[1];return e[n]=this.filters,e[r]=Rm(e[r],a,s,this.padding),e[i]=Rm(e[i],l,o,this.padding),e}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}jm.className="Conv2DTranspose",g.registerClass(jm);class Um extends zm{constructor(t,e){if(super(t,e),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,null==e.filters)throw new xh("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=e.kernelInitializer||null!=e.kernelRegularizer||null!=e.kernelConstraint)throw new xh("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=e.padding&&"same"!==e.padding&&"valid"!==e.padding)throw new xh(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received `+JSON.stringify(e.padding));this.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,this.depthwiseInitializer=nf(e.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Cm(e.depthwiseRegularizer),this.depthwiseConstraint=Kh(e.depthwiseConstraint),this.pointwiseInitializer=nf(e.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Cm(e.pointwiseRegularizer),this.pointwiseConstraint=Kh(e.pointwiseConstraint)}build(t){if((t=kf(t)).length<this.rank+2)throw new xh(`Inputs to SeparableConv${this.rank}D should have rank `+(this.rank+2)+", but received input shape: "+JSON.stringify(t));const e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e]||t[e]<0)throw new xh("The channel dimension of the inputs should be defined, but found "+JSON.stringify(t[e]));const n=t[e],r=this.kernelSize.concat([n,this.depthMultiplier]),i=[];for(let s=0;s<this.rank;++s)i.push(1);i.push(n*this.depthMultiplier,this.filters),this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,!0,this.pointwiseConstraint),this.bias=this.useBias?this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.inputSpec=[new Of({ndim:this.rank+2,axes:{[e]:n}})],this.built=!0}call(t,e){return Tn(()=>{let e;if(t=Ef(t),1===this.rank)throw new _h("1D separable convolution is not implemented yet.");return 2===this.rank&&("channelsFirst"===this.dataFormat&&(t=Xe(t,[0,2,3,1])),e=lo(t,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(e=Id(e,this.bias.read(),this.dataFormat)),null!=this.activation&&(e=this.activation.apply(e)),"channelsFirst"===this.dataFormat&&(e=Xe(e,[0,3,1,2])),e})}getConfig(){const t=super.getConfig();return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=ef(this.depthwiseInitializer),t.pointwiseInitializer=ef(this.pointwiseInitializer),t.depthwiseRegularizer=wm(this.depthwiseRegularizer),t.pointwiseRegularizer=wm(this.pointwiseRegularizer),t.depthwiseConstraint=Gh(this.depthwiseConstraint),t.pointwiseConstraint=Gh(this.pointwiseConstraint),t}}Um.className="SeparableConv";class Vm extends Um{constructor(t){super(2,t)}}Vm.className="SeparableConv2D",g.registerClass(Vm);class Wm extends zm{constructor(t){super(1,t),Wm.verifyArgs(t),this.inputSpec=[{ndim:3}]}getConfig(){const t=super.getConfig();return delete t.rank,delete t.dataFormat,t}static verifyArgs(t){if("number"!=typeof t.kernelSize&&!Ph(t.kernelSize,"number",1,1))throw new xh(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(t.kernelSize)}.`)}}Wm.className="Conv1D",g.registerClass(Wm);class qm extends $f{constructor(t){super(t),this.cropping="number"==typeof t.cropping?[[t.cropping,t.cropping],[t.cropping,t.cropping]]:"number"==typeof t.cropping[0]?[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:t.cropping,this.dataFormat=void 0===t.dataFormat?"channelsLast":t.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(t){return"channelsFirst"===this.dataFormat?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]}call(t,e){return Tn(()=>{if(t=Ef(t),"channelsLast"===this.dataFormat){const e=Sd(t,this.cropping[0][0],t.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Sd(e,this.cropping[1][0],t.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}{const e=Sd(t,this.cropping[0][0],t.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Sd(e,this.cropping[1][0],t.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const t={cropping:this.cropping,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}qm.className="Cropping2D",g.registerClass(qm);class Hm extends $f{constructor(t){super(t),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=null==t.size?this.DEFAULT_SIZE:t.size,this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat}computeOutputShape(t){return"channelsFirst"===this.dataFormat?[t[0],t[1],null==t[2]?null:this.size[0]*t[2],null==t[3]?null:this.size[1]*t[3]]:[t[0],null==t[1]?null:this.size[0]*t[1],null==t[2]?null:this.size[1]*t[2],t[3]]}call(t,e){return Tn(()=>{let e=Ef(t);const n=e.shape;if("channelsFirst"===this.dataFormat){e=Xe(e,[0,2,3,1]);const t=e.resizeNearestNeighbor([this.size[0]*n[2],this.size[1]*n[3]]);return Xe(t,[0,3,1,2])}return e.resizeNearestNeighbor([this.size[0]*n[1],this.size[1]*n[2]])})}getConfig(){const t={size:this.size,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}Hm.className="UpSampling2D",g.registerClass(Hm);class Gm extends Pm{constructor(t){super(2,t),this.depthwiseKernel=null,this.depthMultiplier=null==t.depthMultiplier?1:t.depthMultiplier,this.depthwiseInitializer=nf(t.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Kh(t.depthwiseConstraint),this.depthwiseRegularizer=Cm(t.depthwiseRegularizer)}build(t){if((t=kf(t)).length<4)throw new xh(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(t)}.`);const e="channelsFirst"===this.dataFormat?1:3;if(null==t[e]||t[e]<0)throw new xh(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${t[e]}).`);const n=t[e];this.depthwiseKernel=this.addWeight("depthwise_kernel",[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier],null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.bias=this.useBias?this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.built=!0}call(t,e){return Tn(()=>{let e=function(t,e,n=[1,1],r="valid",i,s){return Tn(()=>{null==i&&(i="channelsLast"),sd(i);let o=Fm(t,i);if(4!==t.rank)throw new xh("Input for depthwiseConv2d is required to be 4-D, but is instead "+t.rank+"-D");if(4!==e.rank)throw new xh("depthwiseKernel is required to be 4-D, but is instead "+e.rank+"-D");return o=Ur(o,e,n,"same"===r?"same":"valid","NHWC",s),"channelsFirst"===i&&(o=Xe(o,[0,3,1,2])),o})}(t=Ef(t),this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(e=Id(e,this.bias.read(),this.dataFormat)),null!=this.activation&&(e=this.activation.apply(e)),e})}computeOutputShape(t){t=kf(t);const e="channelsFirst"===this.dataFormat?t[3]:t[2],n="channelsFirst"===this.dataFormat?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,r=Im("channelsFirst"===this.dataFormat?t[2]:t[1],this.kernelSize[0],this.padding,this.strides[0]),i=Im(e,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[t[0],n,r,i]:[t[0],r,i,n]}getConfig(){const t=super.getConfig();return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=ef(this.depthwiseInitializer),t.depthwiseRegularizer=wm(this.depthwiseRegularizer),t.depthwiseConstraint=Gh(this.depthwiseRegularizer),t}}Gm.className="DepthwiseConv2D",g.registerClass(Gm);class Ym extends $f{constructor(t){super(t),this.rate=Math.max(Math.min(t.rate,1),0),this.noiseShape=t.noiseShape,this.seed=t.seed,this.supportsMasking=!0}getNoiseShape(t){if(null==this.noiseShape)return this.noiseShape;const e=t.shape,n=[];for(let r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?e[r]:this.noiseShape[r]);return n}call(t,e){return Tn(()=>{this.invokeCallHook(t,e);const n=Ef(t);if(0<this.rate&&this.rate<1){const t=null!=e.training&&e.training,r=this.getNoiseShape(n);return Fd(()=>Rd(n,this.rate,r,this.seed),()=>n,t)}return t})}getConfig(){const t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},e=super.getConfig();return Object.assign(t,e),t}dispose(){return super.dispose()}}Ym.className="Dropout",g.registerClass(Ym);class Km extends Ym{constructor(t){super(t),this.inputSpec=[{ndim:3}]}getNoiseShape(t){const e=t.shape;return[e[0],1,e[2]]}}Km.className="SpatialDropout1D",g.registerClass(Km);class Xm extends $f{constructor(t){if(super(t),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",null==t.batchInputShape&&null==t.inputShape&&null!=t.inputDim){let e=null;null!=t.batchSize&&(e=t.batchSize),this.batchInputShape=[e,t.inputDim]}this.units=t.units,zh(this.units,"units"),this.activation=ym(t.activation),null!=t.useBias&&(this.useBias=t.useBias),this.kernelInitializer=nf(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=nf(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Kh(t.kernelConstraint),this.biasConstraint=Kh(t.biasConstraint),this.kernelRegularizer=Cm(t.kernelRegularizer),this.biasRegularizer=Cm(t.biasRegularizer),this.activityRegularizer=Cm(t.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(t){const e=(t=kf(t))[t.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[e,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:e}}],this.built=!0}computeOutputShape(t){const e=(t=kf(t)).slice();return e[e.length-1]=this.units,e}call(t,e){return Tn(()=>{this.invokeCallHook(t,e);const n=Ef(t),r=Lh(this.activation.getClassName());let i;return null!=r?i=Dd(n,this.kernel.read(),r,this.bias?this.bias.read():null):(i=Dd(n,this.kernel.read()),null!=this.bias&&(i=Id(i,this.bias.read())),null!=this.activation&&(i=this.activation.apply(i))),i})}getConfig(){const t={units:this.units,activation:mm(this.activation),useBias:this.useBias,kernelInitializer:ef(this.kernelInitializer),biasInitializer:ef(this.biasInitializer),kernelRegularizer:wm(this.kernelRegularizer),biasRegularizer:wm(this.biasRegularizer),activityRegularizer:wm(this.activityRegularizer),kernelConstraint:Gh(this.kernelConstraint),biasConstraint:Gh(this.biasConstraint)},e=super.getConfig();return Object.assign(t,e),t}}Xm.className="Dense",g.registerClass(Xm);class Zm extends $f{constructor(t){super(t=t||{}),this.inputSpec=[{minNDim:3}],this.dataFormat=t.dataFormat}computeOutputShape(t){t=kf(t);for(const e of t.slice(1))if(null==e)throw new xh(`The shape of the input to "Flatten" is not fully defined (got ${t.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[t[0],pd(t,1)]}call(t,e){return Tn(()=>{this.invokeCallHook(t,e);let n=Ef(t);if("channelsFirst"===this.dataFormat&&n.rank>1){const t=[0];for(let e=2;e<n.rank;++e)t.push(e);t.push(1),n=n.transpose(t)}return function(t){if(t.rank<=1)throw new xh(`batchFlatten requires a minimum rank of 2. Got rank: ${t.rank}.`);const e=[t.shape[0],pd(t.shape,1)];return t.reshape(e)}(n)})}getConfig(){const t={};null!=this.dataFormat&&(t.dataFormat=this.dataFormat);const e=super.getConfig();return Object.assign(t,e),t}}Zm.className="Flatten",g.registerClass(Zm);class Qm extends $f{constructor(t){super(t),this.supportsMasking=!0,this.activation=ym(t.activation)}call(t,e){return Tn(()=>{this.invokeCallHook(t,e);const n=Ef(t);return this.activation.apply(n)})}getConfig(){const t={activation:mm(this.activation)},e=super.getConfig();return Object.assign(t,e),t}}Qm.className="Activation",g.registerClass(Qm);class Jm extends $f{constructor(t){super(t),this.n=t.n,this.inputSpec=[{ndim:2}]}computeOutputShape(t){return[t[0],this.n,t[1]]}call(t,e){return Tn(()=>{return t=Ef(t),e=t,n=this.n,Tn(()=>{if(2!==e.shape.length)throw new xh(`repeat() expects a rank-2 tensor, but received a rank-${e.shape.length} tensor.`);return kd(xd(e,1),[1,n,1])});var e,n})}getConfig(){const t={n:this.n},e=super.getConfig();return Object.assign(t,e),t}}Jm.className="RepeatVector",g.registerClass(Jm);class tg extends $f{constructor(t){super(t),this.targetShape=t.targetShape;for(let e=0;e<this.targetShape.length;++e)this.isUnknown(this.targetShape[e])&&(this.targetShape[e]=null)}isUnknown(t){return t<0||null==t}fixUnknownDimension(t,e){const n="Total size of new array must be unchanged.",r=e.slice();let i=1,s=null;for(let a=0;a<r.length;++a){const t=r[a];if(this.isUnknown(t)){if(null!==s)throw new xh("Can only specifiy one unknown dimension.");s=a}else i*=t}const o=pd(t);if(null!==s){if(0===i||o%i!=0)throw new xh(n);r[s]=o/i}else if(o!==i)throw new xh(n);return r}computeOutputShape(t){let e=!1;for(let n=0;n<t.length;++n)if(this.isUnknown(t[n])){e=!0;break}return e?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))}call(t,e){return Tn(()=>{this.invokeCallHook(t,e);const n=Ef(t),r=n.shape,i=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return n.reshape(i)})}getConfig(){const t={targetShape:this.targetShape},e=super.getConfig();return Object.assign(t,e),t}}tg.className="Reshape",g.registerClass(tg);class eg extends $f{constructor(t){if(super(t),null==t.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+t.dims+" instead.");const e=vd(1,t.dims.length+1);if(!r.arraysEqual(t.dims.slice().sort(),e))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=t.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Of({ndim:this.dims.length+1})]}computeOutputShape(t){const e=(t=kf(t)).slice();return this.dims.forEach((n,r)=>{e[r+1]=t[n]}),e}call(t,e){return Xe(Ef(t),this.dimsIncludingBatch)}getConfig(){const t={dims:this.dims},e=super.getConfig();return Object.assign(t,e),t}}eg.className="Permute",g.registerClass(eg);class ng extends $f{constructor(t){super(null==t?{}:t),this.supportsMasking=!0,this.maskValue=null!=t?null==t.maskValue?0:t.maskValue:0}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={maskValue:this.maskValue};return Object.assign(e,t),e}computeMask(t,e){const n=Ef(t);return Qe(ps(n,this.maskValue),-1)}call(t,e){return Tn(()=>{this.invokeCallHook(t,e);const n=Ef(t),r=Qe(ps(n,this.maskValue),-1,!0);return n.mul(r.asType(n.dtype))})}}ng.className="Masking",g.registerClass(ng);class rg extends $f{constructor(t){if(super(t),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==t.batchInputShape&&null==t.inputShape){let e=null;null!=t.batchSize&&(e=t.batchSize),this.batchInputShape=null==t.inputLength?[e,null]:[e].concat(Ah(t.inputLength))}this.inputDim=t.inputDim,zh(this.inputDim,"inputDim"),this.outputDim=t.outputDim,zh(this.outputDim,"outputDim"),this.embeddingsInitializer=nf(t.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Cm(t.embeddingsRegularizer),this.activityRegularizer=Cm(t.activityRegularizer),this.embeddingsConstraint=Kh(t.embeddingsConstraint),this.maskZero=t.maskZero,this.supportsMasking=t.maskZero,this.inputLength=t.inputLength}build(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(t){}computeMask(t,e){return Tn(()=>this.maskZero?(t=Ef(t),ps(t,Qr(t))):null)}computeOutputShape(t){if(t=kf(t),null==this.inputLength)return[...t,this.outputDim];const e=Ah(this.inputLength);if(e.length!==t.length-1)throw new xh(`"inputLength" is ${this.inputLength}, but received input shape has shape `+t);{let n=0;for(let r=0;r<e.length;++r){const i=e[r],s=t[r+1];if(null!=i&&null!=s&&i!==s)throw new xh(`"inputLength" is ${this.inputLength}, but received input shape has shape `+t);null==i&&(e[n]=s),n++}}return[t[0],...e,this.outputDim]}call(t,e){return Tn(()=>{this.invokeCallHook(t,e);let n=Ef(t);return"int32"!==n.dtype&&(n=bd(n,"int32")),Nd(this.embeddings.read(),n.as1D()).reshape(kf(this.computeOutputShape(n.shape)))})}getConfig(){const t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:ef(this.embeddingsInitializer),embeddingsRegularizer:wm(this.embeddingsRegularizer),activityRegularizer:wm(this.activityRegularizer),embeddingsConstraint:Gh(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},e=super.getConfig();return Object.assign(t,e),t}}rg.className="Embedding",g.registerClass(rg);class ig extends $f{constructor(t){super(t||{}),this.supportsMasking=!0}mergeFunction(t){throw new _h}computeElementwiseOpOutputShape(t,e){if(null==t||null==e)return null;if(t.length<e.length)return this.computeElementwiseOpOutputShape(e,t);if(0===e.length)return t;const n=t.slice(0,t.length-e.length);for(let r=0;r<e.length;++r){const i=t[t.length-e.length+r],s=e[r];if(null==i||null==s||i<0||s<0)n.push(null);else if(1===i)n.push(s);else if(1===s)n.push(i);else{if(i!==s)throw new xh("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(e));n.push(i)}}return n}build(t){if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[kf(t)]),(t=t).length<2)throw new xh(`A merge layer should be called on an Array of at least 2 inputs. Got ${t.length} input(s).`);let e=[];for(const i of t)null!=i&&null!==i[0]&&e.push(i[0]);if(e=Fh(e),e.length>1)throw new xh(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(t)}.`);let n=null==t[0]?null:t[0].slice(1);for(let i=1;i<t.length;++i){const e=null==t[i]?null:t[i].slice(1);n=this.computeElementwiseOpOutputShape(n,e)}const r=t.map(t=>t.length);this.reshapeRequired=-1!==t.indexOf(null)||1!==Fh(r).length}call(t,e){return Tn(()=>{if(t=t,this.reshapeRequired){const e=[],n=t.map(t=>t.rank);if(-1===n.indexOf(null)){const r=yd(n);for(let n of t){const t=n.rank;for(let e=0;e<r-t;++e)n=xd(n,1);e.push(n)}return this.mergeFunction(e)}{let n=!1;for(const s of t){const t=s.rank;if(null==t){const t=s.shape,r=t[0],i=t.slice(1).concat([r]);let o=s.reshape([r].concat(pd(t.slice(1))));o=Xe(o,[1,0]),o=o.reshape(i),e.push(o),n=!0}else if(t>1){const r=vd(1,t).concat([0]);e.push(Xe(s,r)),n=!0}else e.push(s)}let r=this.mergeFunction(e);const i=r.rank;if(n)if(null==i){const t=r.shape,e=t[t.length-1],n=[e].concat(t.slice(0,t.length-1));r=Xe(r.reshape([-1,e]),[1,0]).reshape(n)}else if(i>1){const t=[i-1].concat(vd(0,i-1));r=Xe(r,t)}return r}}return this.mergeFunction(t)})}computeOutputShape(t){let e;e=null==(t=t)[0]?null:t[0].slice(1);for(let r=1;r<t.length;++r){const n=null==t[r]?null:t[r].slice(1);e=this.computeElementwiseOpOutputShape(e,n)}let n=[];for(const r of t)null!=r&&null!==r[0]&&n.push(r[0]);return n=Fh(n),e=1===n.length?n.concat(e):[null].concat(e),e}computeMask(t,e){return Tn(()=>{if(null==e)return null;if(!Array.isArray(e))throw new xh("`mask` should be an Array");if(!Array.isArray(t))throw new xh("`inputs` should be an Array");if(e.length!==t.length)throw new xh(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${t.length} vs ${e.length})`);if(e.every(t=>null==t))return null;let n=(e=e.map(t=>null==t?t:ii(t,0)))[0];for(let t=1;t<e.length-1;++t)n=Zi(n,e[t]);return n})}}class sg extends ig{constructor(t){super(t)}mergeFunction(t){return Tn(()=>{let e=t[0].clone();for(let n=1;n<t.length;++n)e=Le(e,t[n]);return e})}}sg.className="Add",g.registerClass(sg);class og extends ig{constructor(t){super(t)}mergeFunction(t){return Tn(()=>{let e=t[0].clone();for(let n=1;n<t.length;++n)e=Xn(e,t[n]);return e})}}og.className="Multiply",g.registerClass(og);class ag extends ig{constructor(t){super(t)}mergeFunction(t){return Tn(()=>{let e=t[0].clone();for(let n=1;n<t.length;++n)e=Le(e,t[n]);return Xn(1/t.length,e)})}}ag.className="Average",g.registerClass(ag);class lg extends ig{constructor(t){super(t)}mergeFunction(t){return Tn(()=>{let e=t[0];for(let n=1;n<t.length;++n)e=Di(e,t[n]);return e})}}lg.className="Maximum",g.registerClass(lg);class ug extends ig{constructor(t){super(t)}mergeFunction(t){return Tn(()=>{let e=t[0];for(let n=1;n<t.length;++n)e=ls(e,t[n]);return e})}}ug.className="Minimum",g.registerClass(ug);class cg extends ig{constructor(t){super(t),this.DEFAULT_AXIS=-1,null==t&&(t={}),this.axis=null==t.axis?this.DEFAULT_AXIS:t.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){if(!Array.isArray(t)||!Array.isArray(t[0])||1===t.length)throw new xh("A `Concatenate` layer should be called on a list of at least 2 inputs");t=t;let e=!0;for(const r of t)if(null!=r){e=!1;break}if(e)return;const n=[];for(let i=0;i<t.length;++i){const e=t[i].slice();e.splice(this.axis,1);let s=!1;for(const t of n)if(r.arraysEqual(t,e)){s=!0;break}s||n.push(e)}if(n.length>1)throw new xh("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}mergeFunction(t){return Tn(()=>Cd(t,this.axis))}computeOutputShape(t){if(!Array.isArray(t)||!Array.isArray(t[0]))throw new xh("A `Concatenate` layer should be called on a list of inputs.");const e=t,n=e[0].slice(),r=this.axis<0?n.length+this.axis:this.axis;for(const i of e.slice(1)){if(null==n[r]||null==i[r]){n[r]=null;break}n[r]+=i[r]}return n}computeMask(t,e){if(null==e)return null;if(!Array.isArray(e))throw new xh("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new xh("`inputs` should be an array for Concatenate");if(e.length!==t.length)throw new xh(`Mismatch in the length of mask (${e.length}) and the legnth of inputs (${t.length})`);return Tn(()=>{let n=!0;if(e.forEach(t=>{null==t||(n=!1)}),n)return null;const r=[];for(let s=0;s<t.length;++s)r.push(null==e[s]?gs(t[s]).asType("bool"):e[s].rank<t[s].rank?ii(e[s],-1):e[s]);const i=Yn(r,this.axis);return Ze(i,-1,!1)})}getConfig(){const t={axis:this.axis},e=super.getConfig();return Object.assign(t,e),t}}function hg(t,e){for(;t<0;)t+=e;return t}cg.className="Concatenate",g.registerClass(cg);class dg extends ig{constructor(t){super(t),this.axes=t.axes,this.normalize=null!=t.normalize&&t.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){r.assert(Array.isArray(t)&&2===t.length&&Array.isArray(t[0])&&Array.isArray(t[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const e=t[0],n=t[1];if(e.length>3||n.length>3)throw new _h("Dot layer does not support tensors of 4D or higher rank yet.");const i=this.interpretAxes(e,n);if(e[i[0]]!==n[i[1]])throw new xh(`Dimension incompatibility: ${e[i[0]]} !== ${n[i[1]]}`)}mergeFunction(t){if(2!==t.length)throw new xh(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${t.length} input(s).`);let e,n=t[0],i=t[1];return e=Array.isArray(this.axes)?this.axes.map((e,n)=>hg(e,t[n].shape.length)):[hg(this.axes,n.shape.length),hg(this.axes,i.shape.length)],this.normalize&&(n=Zf(n,e[0]),i=Zf(i,e[1])),function(t,e,n){if(t.shape.length>3||e.shape.length>3)throw new _h("batchDot is not implemented for tensors of 4D or higher rank yet");if(r.assert(t.shape.length>=2,()=>"batchDot requires the rank of x to be >= 2, but got "+t.shape.length),r.assert(t.shape.length>=2,()=>"batchDot requires the rank of y to be >= 2, but got "+e.shape.length),"number"==typeof n&&(n=[n,n]),"complex64"===t.dtype||"complex64"===e.dtype)throw new _h("batchDot is not implemented for complex64-type Tensors yet.");const i=t.shape.length,s=e.shape.length;null==n&&(n=[i-1,s-2]);const o=n;return Tn(()=>{let n,r;if(i>s){n=i-s;const t=[];for(let e=0;e<n;++e)t.push(1);e=e.reshape(e.shape.concat(t))}else if(s>i){n=s-i;const e=[];for(let t=0;t<n;++t)e.push(1);t=t.reshape(t.shape.concat(e))}else n=0;if(r=2===t.shape.length&&2===e.shape.length?o[0]===o[1]?t.mul(e).sum(o[0]):t.transpose([1,0]).mul(e).sum(o[1]):t.matMul(e,o[0]!==t.shape.length-1,o[1]===e.shape.length-1),n>0){let t;t=i>s?i+s-3:i-1;const e=[];for(let r=t;r<t+n;++r)e.push(r);r=r.squeeze(e)}return 1===r.shape.length&&(r=r.expandDims(1)),r})}(n,i,e)}interpretAxes(t,e){let n;return n=Array.isArray(this.axes)?this.axes:[hg(this.axes,t.length),hg(this.axes,e.length)],n}computeOutputShape(t){r.assert(Array.isArray(t)&&2===t.length&&Array.isArray(t[0])&&Array.isArray(t[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const e=t[0].slice(),n=t[1].slice();if(e.length>3||n.length>3)throw new _h("Dot layer does not support tensors of 4D or higher rank yet.");const i=this.interpretAxes(e,n);e.splice(i[0],1),n.splice(i[1],1),n.splice(0,1);const s=e.concat(n);return 1===s.length&&s.push(1),s}computeMask(t,e){return null}getConfig(){const t={axes:this.axes,normalize:this.normalize},e=super.getConfig();return Object.assign(t,e),t}}dg.className="Dot",g.registerClass(dg);class fg extends $f{constructor(t){super(t),this.supportsMasking=!0,this.stddev=t.stddev}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={stddev:this.stddev};return Object.assign(e,t),e}call(t,e){return Tn(()=>{this.invokeCallHook(t,e);const n=Ef(t);return Fd(()=>Ad(n.shape,0,this.stddev).add(n),()=>n,e.training||!1)})}}fg.className="GaussianNoise",g.registerClass(fg);class pg extends $f{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={rate:this.rate};return Object.assign(e,t),e}call(t,e){return Tn(()=>{this.invokeCallHook(t,e);const n=Ef(t);return this.rate>0&&this.rate<1?Fd(()=>{const t=Math.sqrt(this.rate/(1-this.rate));return n.mul(Ad(n.shape,1,t))},()=>n,e.training||!1):n})}}pg.className="GaussianDropout",g.registerClass(pg);class mg extends $f{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate,this.noiseShape=t.noiseShape}_getNoiseShape(t){return this.noiseShape||Ef(t).shape}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={rate:this.rate};return Object.assign(e,t),e}call(t,e){return Tn(()=>{if(this.rate<1&&this.rate>0){const n=this._getNoiseShape(t);return Fd(()=>{const e=Ef(t),r=-1.7580993408473766;let i=vi(Hs(n),this.rate);i=bd(i,"float32");const s=((1-this.rate)*(1+this.rate*r**2))**-.5,o=-s*r*this.rate;return e.mul(i).add(i.add(-1).mul(r)).mul(s).add(o)},()=>Ef(t),e.training||!1)}return t})}}function gg(t,e,n,r,i,s=.001){let o;if(2===t.rank)o=vr(t,e,n,r,i,s);else if(3===t.rank)o=br(t,e,n,r,i,s);else{if(4!==t.rank)throw new _h(`batchNormalization is not implemented for array of rank ${t.rank} yet`);o=xr(t,e,n,r,i,s)}return o}mg.className="AlphaDropout",g.registerClass(mg);class yg extends $f{constructor(t){null==t&&(t={}),super(t),this.supportsMasking=!0,this.axis=null==t.axis?-1:t.axis,this.momentum=null==t.momentum?.99:t.momentum,this.epsilon=null==t.epsilon?.001:t.epsilon,this.center=null==t.center||t.center,this.scale=null==t.scale||t.scale,this.betaInitializer=nf(t.betaInitializer||"zeros"),this.gammaInitializer=nf(t.gammaInitializer||"ones"),this.movingMeanInitializer=nf(t.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=nf(t.movingVarianceInitializer||"ones"),this.betaConstraint=Kh(t.betaConstraint),this.gammaConstraint=Kh(t.gammaConstraint),this.betaRegularizer=Cm(t.betaRegularizer),this.gammaRegularizer=Cm(t.gammaRegularizer)}build(t){t=kf(t);const e=this.axis>=0?this.axis:this.axis+t.length,n=t[e];if(null==n)throw new xh(`Axis ${e} of input tensor should have a defined dimension but the layer received an input with shape `+JSON.stringify(t)+".");this.inputSpec=[new Of({ndim:t.length,axes:{[e]:n}})];const r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(t,e){return Tn(()=>{const n=null!=e.training&&e.training,i=Ef(t),s=i.shape,o=s.length,a=vd(0,o),l=this.axis>=0?this.axis:this.axis+o;a.splice(l,1);const u=Sh(1,o);u[l]=s[l];const c=a.slice();c.sort();const h=!r.arraysEqual(c,vd(0,o).slice(0,o-1));if(!n)return(()=>{if(h){const t=this.movingMean.read().reshape(u),e=this.movingVariance.read().reshape(u),n=this.center?this.beta.read().reshape(u):null,r=this.scale?this.gamma.read().reshape(u):null;return gg(i,t,e,n,r,this.epsilon)}return gg(i,this.movingMean.read(),this.movingVariance.read(),null==this.beta?null:this.beta.read(),null==this.gamma?null:this.gamma.read(),this.epsilon)})();const[d,f,p]=function(t,e,n,i,s=.001){return r.arraysEqual(i.slice().sort(),vd(0,t.rank-1))?function(t,e,n,r,i=.001){return Tn(()=>{const s=hs(t,r),o=s.mean,a=s.variance;return[gg(t,o,a,n,e,i),o,a]})}(t,e,n,i,s):function(t,e,n,r,i=.001){return Tn(()=>{const s=hs(t,r),o=s.mean,a=s.variance,l=[];for(const e of vd(0,t.rank))-1!==r.indexOf(e)?l.push(1):l.push(t.shape[e]);const u=o.reshape(l),c=a.reshape(l),h=null==e?null:e.reshape(l),d=null==n?null:n.reshape(l);return[gg(t,u,c,d,h,i),o,a]})}(t,e,n,i,s)}(i,this.gamma.read(),this.beta.read(),a,this.epsilon),m=(t,e,n)=>{Tn(()=>{const r=1-n,i=t.read(),s=i.sub(e).mul(r);t.write(i.sub(s))})};return(()=>{m(this.movingMean,f,this.momentum),m(this.movingVariance,p,this.momentum)})(),d})}getConfig(){const t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:ef(this.betaInitializer),gammaInitializer:ef(this.gammaInitializer),movingMeanInitializer:ef(this.movingMeanInitializer),movingVarianceInitializer:ef(this.movingVarianceInitializer),betaRegularizer:wm(this.betaRegularizer),gammaRegularizer:wm(this.gammaRegularizer),betaConstraint:Gh(this.betaConstraint),gammaConstraint:Gh(this.gammaConstraint)},e=super.getConfig();return Object.assign(t,e),t}}yg.className="BatchNormalization",g.registerClass(yg);class vg extends $f{constructor(t){if(null==t&&(t={}),super(t),this.axis=null==t.axis?-1:t.axis,"number"==typeof this.axis){if(!Number.isInteger(this.axis))throw new Error("Expected axis to be an integer, but received "+this.axis)}else{if(!Array.isArray(this.axis))throw new Error("Expected axis to be an integer or an array of integers, but received "+JSON.stringify(this.axis));for(const t of this.axis)if(!Number.isInteger(t))throw new Error("Expected axis to be an array of integers, but received "+JSON.stringify(this.axis))}this.epsilon=null==t.epsilon?.001:t.epsilon,this.center=null==t.center||t.center,this.scale=null==t.scale||t.scale,this.betaInitializer=nf(t.betaInitializer||"zeros"),this.gammaInitializer=nf(t.gammaInitializer||"ones"),this.betaRegularizer=Cm(t.betaRegularizer),this.gammaRegularizer=Cm(t.gammaRegularizer),this.supportsMasking=!0}build(t){const e=(t=kf(t)).length;"number"==typeof this.axis&&(this.axis=[this.axis]);for(let r=0;r<this.axis.length;++r)this.axis[r]<0&&(this.axis[r]+=e);for(const r of this.axis)if(r<0||r>=e)throw new Error("Invalid axis: "+r);if(this.axis.length!==Fh(this.axis).length)throw new Error("Found duplicate axes in: "+this.axis);const n=this.axis.map(e=>t[e]);this.gamma=this.scale?this.addWeight("gamma",n,"float32",this.gammaInitializer,this.gammaRegularizer,!0):null,this.beta=this.center?this.addWeight("beta",n,"float32",this.betaInitializer,this.betaRegularizer,!0):null,this.built=!0}call(t,e){const n=Ef(t),r=n.shape,i=r.length;return Tn(()=>{let{mean:t,variance:e}=hs(n,this.axis,!0);const s=Sh(1,i);for(const n of this.axis)s[n]=r[n];const o=t=>null!=t&&t.shape.length!==i&&this.axis!==[i-1]?t.reshape(s):t;let a=o(this.gamma.read()),l=o(this.beta.read());const u=[],c=[];for(let n=0;n<i;++n)-1!==this.axis.indexOf(n)?(u.push(r[n]),c.push(1)):(u.push(1),c.push(r[n]));return t=t.tile(u),e=e.tile(u),a=a.tile(c),l=l.tile(c),gg(n,t,e,l,a,this.epsilon)})}getConfig(){const t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:ef(this.betaInitializer),gammaInitializer:ef(this.gammaInitializer),betaRegularizer:wm(this.betaRegularizer),gammaRegularizer:wm(this.gammaRegularizer)},e=super.getConfig();return Object.assign(t,e),t}}vg.className="LayerNormalization",g.registerClass(vg);class bg extends $f{constructor(t){if(null==t&&(t={}),super(t),this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,null==t.padding)this.padding=[[1,1],[1,1]];else if("number"==typeof t.padding)this.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,2!==t.padding.length)throw new xh(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${t.padding.length} array.`);let e,n;if("number"==typeof t.padding[0])e=[t.padding[0],t.padding[0]],n=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,2!==t.padding[0].length)throw new xh(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${t.padding[0].length} array.`);if(e=t.padding[0],2!==t.padding[1].length)throw new xh(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${t.padding[1].length} array.`);n=t.padding[1]}this.padding=[e,n]}this.inputSpec=[new Of({ndim:4})]}computeOutputShape(t){let e,n;return t=kf(t),"channelsFirst"===this.dataFormat?(e=null!=t[2]&&t[2]>=0?t[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=t[3]&&t[3]>=0?t[3]+this.padding[1][0]+this.padding[1][1]:null,[t[0],t[1],e,n]):(e=null!=t[1]&&t[1]>=0?t[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=t[2]&&t[2]>=0?t[2]+this.padding[1][0]+this.padding[1][1]:null,[t[0],e,n,t[3]])}call(t,e){return Tn(()=>{return e=Ef(t),n=this.padding,r=this.dataFormat,Tn(()=>{if(4!==e.rank)throw new xh("temporalPadding expects input tensor to be 4-D, but received a "+e.rank+"-D tensor.");if(null==n&&(n=[[1,1],[1,1]]),2!==n.length||2!==n[0].length||2!==n[1].length)throw new xh("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==r&&(r="channelsLast"),"channelsLast"!==r&&"channelsFirst"!==r)throw new xh(`Unknown data format: ${r}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let t;return t="channelsFirst"===r?[[0,0],[0,0],n[0],n[1]]:[[0,0],n[0],n[1],[0,0]],vs(e,t)});var e,n,r})}getConfig(){const t={padding:this.padding,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}function xg(t,e,n,r,i,s){return Tn(()=>{let o;sd(i),ad(s),od(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==i&&(i="channelsLast"),null==s&&(s="max"),t=Fm(t,i);const a="same"===r?"same":"valid";return o="max"===s?es(t,e,n,a):_n(t,e,n,a),"channelsFirst"===i&&(o=Xe(o,[0,3,1,2])),o})}function _g(t,e,n,r,i,s){return Tn(()=>{let o;sd(i),ad(s),od(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==i&&(i="channelsLast"),null==s&&(s="max"),t=Mm(t,i);const a="same"===r?"same":"valid";return o="max"===s?ns(t,e,n,a):Vn(t,e,n,a),"channelsFirst"===i&&(o=Xe(o,[0,4,1,2,3])),o})}bg.className="ZeroPadding2D",g.registerClass(bg);class wg extends $f{constructor(t){if(null==t.poolSize&&(t.poolSize=2),super(t),"number"==typeof t.poolSize)this.poolSize=[t.poolSize];else{if(!Array.isArray(t.poolSize)||1!==t.poolSize.length||"number"!=typeof t.poolSize[0])throw new xh("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(t.poolSize));this.poolSize=t.poolSize}if(zh(this.poolSize,"poolSize"),null==t.strides)this.strides=this.poolSize;else if("number"==typeof t.strides)this.strides=[t.strides];else{if(!Array.isArray(t.strides)||1!==t.strides.length||"number"!=typeof t.strides[0])throw new xh("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(t.strides));this.strides=t.strides}zh(this.strides,"strides"),this.padding=null==t.padding?"valid":t.padding,od(this.padding),this.inputSpec=[new Of({ndim:3})]}computeOutputShape(t){const e=Im((t=kf(t))[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],e,t[2]]}call(t,e){return Tn(()=>{this.invokeCallHook(t,e),t=xd(Ef(t),2);const n=this.poolingFunction(Ef(t),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return _o(n,[2])})}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},e=super.getConfig();return Object.assign(t,e),t}}class Sg extends wg{constructor(t){super(t)}poolingFunction(t,e,n,r,i){return sd(i),od(r),xg(t,e,n,r,i,"max")}}Sg.className="MaxPooling1D",g.registerClass(Sg);class Cg extends wg{constructor(t){super(t)}poolingFunction(t,e,n,r,i){return sd(i),od(r),xg(t,e,n,r,i,"avg")}}Cg.className="AveragePooling1D",g.registerClass(Cg);class Eg extends $f{constructor(t){if(null==t.poolSize&&(t.poolSize=[2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],null==t.strides)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(2!==t.strides.length)throw new xh("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+t.strides.length+".");this.strides=t.strides}else this.strides=[t.strides,t.strides];zh(this.poolSize,"poolSize"),zh(this.strides,"strides"),this.padding=null==t.padding?"valid":t.padding,this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,sd(this.dataFormat),od(this.padding),this.inputSpec=[new Of({ndim:4})]}computeOutputShape(t){t=kf(t);let e="channelsFirst"===this.dataFormat?t[2]:t[1],n="channelsFirst"===this.dataFormat?t[3]:t[2];return e=Im(e,this.poolSize[0],this.padding,this.strides[0]),n=Im(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[t[0],t[1],e,n]:[t[0],e,n,t[3]]}call(t,e){return Tn(()=>(this.invokeCallHook(t,e),this.poolingFunction(Ef(t),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class kg extends Eg{constructor(t){super(t)}poolingFunction(t,e,n,r,i){return sd(i),od(r),xg(t,e,n,r,i,"max")}}kg.className="MaxPooling2D",g.registerClass(kg);class Ag extends Eg{constructor(t){super(t)}poolingFunction(t,e,n,r,i){return sd(i),od(r),xg(t,e,n,r,i,"avg")}}Ag.className="AveragePooling2D",g.registerClass(Ag);class Dg extends $f{constructor(t){if(null==t.poolSize&&(t.poolSize=[2,2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],null==t.strides)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(3!==t.strides.length)throw new xh("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+t.strides.length+".");this.strides=t.strides}else this.strides=[t.strides,t.strides,t.strides];zh(this.poolSize,"poolSize"),zh(this.strides,"strides"),this.padding=null==t.padding?"valid":t.padding,this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,sd(this.dataFormat),od(this.padding),this.inputSpec=[new Of({ndim:5})]}computeOutputShape(t){t=kf(t);let e="channelsFirst"===this.dataFormat?t[2]:t[1],n="channelsFirst"===this.dataFormat?t[3]:t[2],r="channelsFirst"===this.dataFormat?t[4]:t[3];return e=Im(e,this.poolSize[0],this.padding,this.strides[0]),n=Im(n,this.poolSize[1],this.padding,this.strides[1]),r=Im(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[t[0],t[1],e,n,r]:[t[0],e,n,r,t[4]]}call(t,e){return Tn(()=>(this.invokeCallHook(t,e),this.poolingFunction(Ef(t),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class Ng extends Dg{constructor(t){super(t)}poolingFunction(t,e,n,r,i){return sd(i),od(r),_g(t,e,n,r,i,"max")}}Ng.className="MaxPooling3D",g.registerClass(Ng);class Tg extends Dg{constructor(t){super(t)}poolingFunction(t,e,n,r,i){return sd(i),od(r),_g(t,e,n,r,i,"avg")}}Tg.className="AveragePooling3D",g.registerClass(Tg);class Og extends $f{constructor(t){super(t),this.inputSpec=[new Of({ndim:3})]}computeOutputShape(t){return[t[0],t[2]]}call(t,e){throw new _h}}class Ig extends Og{constructor(t){super(t||{})}call(t,e){return Tn(()=>{const e=Ef(t);return os(e,1)})}}Ig.className="GlobalAveragePooling1D",g.registerClass(Ig);class Rg extends Og{constructor(t){super(t||{})}call(t,e){return Tn(()=>{const e=Ef(t);return Hi(e,1)})}}Rg.className="GlobalMaxPooling1D",g.registerClass(Rg);class Fg extends $f{constructor(t){super(t),this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,sd(this.dataFormat),this.inputSpec=[new Of({ndim:4})]}computeOutputShape(t){return t=t,"channelsLast"===this.dataFormat?[t[0],t[3]]:[t[0],t[1]]}call(t,e){throw new _h}getConfig(){const t={dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class Mg extends Fg{call(t,e){return Tn(()=>{const e=Ef(t);return os(e,"channelsLast"===this.dataFormat?[1,2]:[2,3])})}}Mg.className="GlobalAveragePooling2D",g.registerClass(Mg);class $g extends Fg{call(t,e){return Tn(()=>{const e=Ef(t);return Hi(e,"channelsLast"===this.dataFormat?[1,2]:[2,3])})}}function Pg(t,e,n,r){if(Array.isArray(t)){if(null!=e||null!=n)throw new xh("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=t.slice(t.length-r,t.length),t=t.slice(0,t.length-r)),t.length>1&&(e=t.slice(1,t.length)),t=t[0]}function i(t){return null==t||Array.isArray(t)?t:[t]}return{inputs:t,initialState:e=i(e),constants:n=i(n)}}function zg(t,e,n,r=!1,i,s,o=!1,a=!1){return Tn(()=>{const l=e.shape.length;if(l<3)throw new xh(`Input should be at least 3D, but is ${l}D.`);const u=[1,0].concat(vd(2,l));if(e=Xe(e,u),null!=s)throw new _h("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=i&&((i=i.asType("bool").asType("float32")).rank===l-1&&(i=ii(i,-1)),i=Xe(i,u)),r&&(e=wi(e,0),null!=i&&(i=wi(i,0)));const c=[];let h,d=n;const f=e.shape[0],p=Fo(e);let m,g;null!=i&&(m=Fo(i));for(let e=0;e<f;++e){const n=p[e],r=Tn(()=>t(n,d));if(null==i)h=r[0],d=r[1];else{const t=Tn(()=>{const t=m[e],n=gs(t).sub(t);return{output:r[0].mul(t).add(d[0].mul(n)),newStates:d.map((e,i)=>r[1][i].mul(t).add(e.mul(n)))}});h=t.output,d=t.newStates}a&&c.push(h)}return a&&(g=wo(c,1)),[h,g,d]})}$g.className="GlobalMaxPooling2D",g.registerClass($g);class Lg extends $f{constructor(t){let e;if(super(t),null==t.cell)throw new xh("cell property is missing for the constructor of RNN.");if(e=Array.isArray(t.cell)?new Gg({cells:t.cell}):t.cell,null==e.stateSize)throw new xh("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=e,this.returnSequences=null!=t.returnSequences&&t.returnSequences,this.returnState=null!=t.returnState&&t.returnState,this.goBackwards=null!=t.goBackwards&&t.goBackwards,this._stateful=null!=t.stateful&&t.stateful,this.unroll=null!=t.unroll&&t.unroll,this.supportsMasking=!0,this.inputSpec=[new Of({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){return null==this.states_?vd(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map(t=>null):this.states_}setStates(t){this.states_=t}computeOutputShape(t){Sf(t)&&(t=t[0]),t=t;let e=this.cell.stateSize;Array.isArray(e)||(e=[e]);const n=e[0];let r;if(r=this.returnSequences?[t[0],t[1],n]:[t[0],n],this.returnState){const n=[];for(const r of e)n.push([t[0],r]);return[r].concat(n)}return r}computeMask(t,e){return Tn(()=>{Array.isArray(e)&&(e=e[0]);const t=this.returnSequences?e:null;if(this.returnState){const e=this.states.map(t=>null);return[t].concat(e)}return t})}get states(){if(null==this.states_){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,e=[];for(let n=0;n<t;++n)e.push(null);return e}return this.states_}set states(t){this.states_=t}build(t){if(null!=this.numConstants)throw new _h("Constants support is not implemented in RNN yet.");Sf(t)&&(t=t[0]),t=t,this.inputSpec[0]=new Of({shape:[this.stateful?t[0]:null,null,t[t.length-1]]});const e=[t[0]].concat(t.slice(2));let n;if(this.cell.build(e),n=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!r.arraysEqual(this.stateSpec.map(t=>t.shape[t.shape.length-1]),n))throw new xh(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is `+this.cell.stateSize)}else this.stateSpec=n.map(t=>new Of({shape:[null,t]}));this.stateful&&this.resetStates()}resetStates(t,e=!1){Tn(()=>{if(!this.stateful)throw new vh("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape[0];if(null==n)throw new xh("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.states_)this.states_=Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(t=>is([n,t])):[is([n,this.cell.stateSize])];else if(null==t)On(this.states_),null!=this.keptStates&&(On(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(t=>is([n,t])):this.states_[0]=is([n,this.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new xh(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: `+t);!0===e?this.keptStates.push(this.states_.slice()):On(this.states_);for(let e=0;e<this.states_.length;++e){const i=t[e],s=Array.isArray(this.cell.stateSize)?this.cell.stateSize[e]:this.cell.stateSize,o=[n,s];if(!r.arraysEqual(i.shape,o))throw new xh(`State ${e} is incompatible with layer ${this.name}: expected shape=${o}, received shape=${i.shape}`);this.states_[e]=i}}this.states_=this.states_.map(t=>In(t.clone()))})}apply(t,e){let n=null==e?null:e.initialState,r=null==e?null:e.constants;null==e&&(e={});const i=Pg(t,n,r,this.numConstants);t=i.inputs,n=i.initialState,r=i.constants;let s=[],o=[];if(null!=n){e.initialState=n,s=s.concat(n),this.stateSpec=[];for(const t of n)this.stateSpec.push(new Of({shape:t.shape}));o=o.concat(this.stateSpec)}if(null!=r&&(e.constants=r,s=s.concat(r),this.numConstants=r.length),s[0]instanceof If){const n=[t].concat(s),r=this.inputSpec.concat(o),i=this.inputSpec;this.inputSpec=r;const a=super.apply(n,e);return this.inputSpec=i,a}return super.apply(t,e)}call(t,e){return Tn(()=>{const n=null==e?null:e.mask,r=null==e?null:e.training;let i=null==e?null:e.initialState;t=Ef(t),null==i&&(i=this.stateful?this.states_:this.getInitialState(t));const s=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==s)throw new xh(`RNN Layer has ${s} state(s) but was passed `+i.length+" initial state(s).");this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const o={training:r},a=zg((t,e)=>{const n=this.cell.call([t].concat(e),o);return[n[0],n.slice(1)]},t,i,this.goBackwards,n,null,this.unroll,this.returnSequences),l=a[0],u=a[1],c=a[2];this.stateful&&this.resetStates(c,r);const h=this.returnSequences?u:l;return this.returnState?[h].concat(c):h})}getInitialState(t){return Tn(()=>{let e=is(t.shape);return e=Yi(e,[1,2]),e=xd(e),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(t=>t>1?kd(e,[1,t]):e):this.cell.stateSize>1?[kd(e,[1,this.cell.stateSize])]:[e]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(t)}getConfig(){const t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);const e=this.cell.getConfig();t.cell={className:this.cell.getClassName(),config:e};const n=super.getConfig();return Object.assign(t,n),t}static fromConfig(t,e,n={}){const r=Xf(e.cell,n);return new t(Object.assign(e,{cell:r}))}}Lg.className="RNN",g.registerClass(Lg);class Bg extends $f{}class jg extends Bg{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,zh(this.units,"units"),this.activation=ym(null==t.activation?this.DEFAULT_ACTIVATION:t.activation),this.useBias=null==t.useBias||t.useBias,this.kernelInitializer=nf(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=nf(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=nf(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Cm(t.kernelRegularizer),this.recurrentRegularizer=Cm(t.recurrentRegularizer),this.biasRegularizer=Cm(t.biasRegularizer),this.kernelConstraint=Kh(t.kernelConstraint),this.recurrentConstraint=Kh(t.recurrentConstraint),this.biasConstraint=Kh(t.biasConstraint),this.dropout=gd([1,yd([0,null==t.dropout?0:t.dropout])]),this.recurrentDropout=gd([1,yd([0,null==t.recurrentDropout?0:t.recurrentDropout])]),this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=kf(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.bias=this.useBias?this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.built=!0}call(t,e){return Tn(()=>{if(2!==(t=t).length)throw new xh(`SimpleRNNCell expects 2 input Tensors, got ${t.length}.`);let n=t[1];t=t[0];const r=null!=e.training&&e.training;let i;0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=Yg(()=>gs(t),this.dropout,r)),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=Yg(()=>gs(n),this.recurrentDropout,r));const s=this.dropoutMask,o=this.recurrentDropoutMask;i=Dd(null!=s?Xn(t,s):t,this.kernel.read()),null!=this.bias&&(i=Id(i,this.bias.read())),null!=o&&(n=Xn(n,o));let a=Le(i,Dd(n,this.recurrentKernel.read()));return null!=this.activation&&(a=this.activation.apply(a)),[a,a]})}getConfig(){const t={units:this.units,activation:mm(this.activation),useBias:this.useBias,kernelInitializer:ef(this.kernelInitializer),recurrentInitializer:ef(this.recurrentInitializer),biasInitializer:ef(this.biasInitializer),kernelRegularizer:wm(this.kernelRegularizer),recurrentRegularizer:wm(this.recurrentRegularizer),biasRegularizer:wm(this.biasRegularizer),activityRegularizer:wm(this.activityRegularizer),kernelConstraint:Gh(this.kernelConstraint),recurrentConstraint:Gh(this.recurrentConstraint),biasConstraint:Gh(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},e=super.getConfig();return Object.assign(t,e),t}}jg.className="SimpleRNNCell",g.registerClass(jg);class Ug extends Lg{constructor(t){t.cell=new jg(t),super(t)}call(t,e){return Tn(()=>(null!=this.cell.dropoutMask&&(On(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(On(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),super.call(t,{mask:null==e?null:e.mask,training:null==e?null:e.training,initialState:null==e?null:e.initialState})))}get units(){return this.cell.units}get activation(){return this.cell.activation}get useBias(){return this.cell.useBias}get kernelInitializer(){return this.cell.kernelInitializer}get recurrentInitializer(){return this.cell.recurrentInitializer}get biasInitializer(){return this.cell.biasInitializer}get kernelRegularizer(){return this.cell.kernelRegularizer}get recurrentRegularizer(){return this.cell.recurrentRegularizer}get biasRegularizer(){return this.cell.biasRegularizer}get kernelConstraint(){return this.cell.kernelConstraint}get recurrentConstraint(){return this.cell.recurrentConstraint}get biasConstraint(){return this.cell.biasConstraint}get dropout(){return this.cell.dropout}get recurrentDropout(){return this.cell.recurrentDropout}getConfig(){const t={units:this.units,activation:mm(this.activation),useBias:this.useBias,kernelInitializer:ef(this.kernelInitializer),recurrentInitializer:ef(this.recurrentInitializer),biasInitializer:ef(this.biasInitializer),kernelRegularizer:wm(this.kernelRegularizer),recurrentRegularizer:wm(this.recurrentRegularizer),biasRegularizer:wm(this.biasRegularizer),activityRegularizer:wm(this.activityRegularizer),kernelConstraint:Gh(this.kernelConstraint),recurrentConstraint:Gh(this.recurrentConstraint),biasConstraint:Gh(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},e=super.getConfig();return delete e.cell,Object.assign(t,e),t}static fromConfig(t,e){return new t(e)}}Ug.className="SimpleRNN",g.registerClass(Ug);class Vg extends Bg{constructor(t){if(super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.resetAfter)throw new xh("GRUCell does not support reset_after parameter set to true.");this.units=t.units,zh(this.units,"units"),this.activation=ym(void 0===t.activation?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=ym(void 0===t.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=null==t.useBias||t.useBias,this.kernelInitializer=nf(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=nf(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=nf(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Cm(t.kernelRegularizer),this.recurrentRegularizer=Cm(t.recurrentRegularizer),this.biasRegularizer=Cm(t.biasRegularizer),this.kernelConstraint=Kh(t.kernelConstraint),this.recurrentConstraint=Kh(t.recurrentConstraint),this.biasConstraint=Kh(t.biasConstraint),this.dropout=gd([1,yd([0,null==t.dropout?0:t.dropout])]),this.recurrentDropout=gd([1,yd([0,null==t.recurrentDropout?0:t.recurrentDropout])]),this.implementation=t.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=kf(t),this.kernel=this.addWeight("kernel",[t[t.length-1],3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.bias=this.useBias?this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.built=!0}call(t,e){return Tn(()=>{if(2!==(t=t).length)throw new xh("GRUCell expects 2 input Tensors (inputs, h, c), got "+t.length+".");const n=null!=e.training&&e.training;let r=t[1];t=t[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=Yg(()=>gs(t),this.dropout,n,3)),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=Yg(()=>gs(r),this.recurrentDropout,n,3));const i=this.recurrentDropoutMask;let s,o,a;0<this.dropout&&this.dropout<1&&(t=Xn(t,this.dropoutMask[0]));let l=Dd(t,this.kernel.read());this.useBias&&(l=Id(l,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=Xn(r,i[0]));const u=this.recurrentKernel.read(),[c,h]=ro(u,[2*this.units,this.units],u.rank-1),d=Dd(r,c),[f,p,m]=ro(l,3,l.rank-1),[g,y]=ro(d,2,d.rank-1);s=this.recurrentActivation.apply(Le(f,g)),o=this.recurrentActivation.apply(Le(p,y));const v=Dd(Xn(o,r),h);a=this.activation.apply(Le(m,v));const b=Le(Xn(s,r),Xn(Le(1,Vi(s)),a));return[b,b]})}getConfig(){const t={units:this.units,activation:mm(this.activation),recurrentActivation:mm(this.recurrentActivation),useBias:this.useBias,kernelInitializer:ef(this.kernelInitializer),recurrentInitializer:ef(this.recurrentInitializer),biasInitializer:ef(this.biasInitializer),kernelRegularizer:wm(this.kernelRegularizer),recurrentRegularizer:wm(this.recurrentRegularizer),biasRegularizer:wm(this.biasRegularizer),activityRegularizer:wm(this.activityRegularizer),kernelConstraint:Gh(this.kernelConstraint),recurrentConstraint:Gh(this.recurrentConstraint),biasConstraint:Gh(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1},e=super.getConfig();return Object.assign(t,e),t}}Vg.className="GRUCell",g.registerClass(Vg);class Wg extends Lg{constructor(t){0===t.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new Vg(t),super(t)}call(t,e){return Tn(()=>(null!=this.cell.dropoutMask&&(On(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(On(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),super.call(t,{mask:null==e?null:e.mask,training:null==e?null:e.training,initialState:null==e?null:e.initialState})))}get units(){return this.cell.units}get activation(){return this.cell.activation}get recurrentActivation(){return this.cell.recurrentActivation}get useBias(){return this.cell.useBias}get kernelInitializer(){return this.cell.kernelInitializer}get recurrentInitializer(){return this.cell.recurrentInitializer}get biasInitializer(){return this.cell.biasInitializer}get kernelRegularizer(){return this.cell.kernelRegularizer}get recurrentRegularizer(){return this.cell.recurrentRegularizer}get biasRegularizer(){return this.cell.biasRegularizer}get kernelConstraint(){return this.cell.kernelConstraint}get recurrentConstraint(){return this.cell.recurrentConstraint}get biasConstraint(){return this.cell.biasConstraint}get dropout(){return this.cell.dropout}get recurrentDropout(){return this.cell.recurrentDropout}get implementation(){return this.cell.implementation}getConfig(){const t={units:this.units,activation:mm(this.activation),recurrentActivation:mm(this.recurrentActivation),useBias:this.useBias,kernelInitializer:ef(this.kernelInitializer),recurrentInitializer:ef(this.recurrentInitializer),biasInitializer:ef(this.biasInitializer),kernelRegularizer:wm(this.kernelRegularizer),recurrentRegularizer:wm(this.recurrentRegularizer),biasRegularizer:wm(this.biasRegularizer),activityRegularizer:wm(this.activityRegularizer),kernelConstraint:Gh(this.kernelConstraint),recurrentConstraint:Gh(this.recurrentConstraint),biasConstraint:Gh(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1},e=super.getConfig();return delete e.cell,Object.assign(t,e),t}static fromConfig(t,e){return 0===e.implmentation&&(e.implementation=1),new t(e)}}Wg.className="GRU",g.registerClass(Wg);class qg extends Bg{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,zh(this.units,"units"),this.activation=ym(void 0===t.activation?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=ym(void 0===t.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=null==t.useBias||t.useBias,this.kernelInitializer=nf(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=nf(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=nf(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=t.unitForgetBias,this.kernelRegularizer=Cm(t.kernelRegularizer),this.recurrentRegularizer=Cm(t.recurrentRegularizer),this.biasRegularizer=Cm(t.biasRegularizer),this.kernelConstraint=Kh(t.kernelConstraint),this.recurrentConstraint=Kh(t.recurrentConstraint),this.biasConstraint=Kh(t.biasConstraint),this.dropout=gd([1,yd([0,null==t.dropout?0:t.dropout])]),this.recurrentDropout=gd([1,yd([0,null==t.recurrentDropout?0:t.recurrentDropout])]),this.implementation=t.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){var e;let n;if(t=kf(t),this.kernel=this.addWeight("kernel",[t[t.length-1],4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){const t=this.biasInitializer,r=this.units;n=new((e=class extends Pd{apply(e,n){const i=t.apply([r]),s=(new Ld).apply([r]),o=t.apply([2*r]);return Ed(Ed(i,s),o)}}).className="CustomInit",e)}else n=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,n,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(t,e){return Tn(()=>{const n=null!=e.training&&e.training;if(3!==(t=t).length)throw new xh("LSTMCell expects 3 input Tensors (inputs, h, c), got "+t.length+".");let r=t[1];const i=t[2];t=t[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=Yg(()=>gs(t),this.dropout,n,4)),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=Yg(()=>gs(r),this.recurrentDropout,n,4));const s=this.recurrentDropoutMask;let o,a,l,u;0<this.dropout&&this.dropout<1&&(t=Xn(t,this.dropoutMask[0]));let c=Dd(t,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=Xn(r,s[0])),c=Le(c,Dd(r,this.recurrentKernel.read())),this.useBias&&(c=Id(c,this.bias.read()));const[h,d,f,p]=ro(c,4,c.rank-1);o=this.recurrentActivation.apply(h),a=this.recurrentActivation.apply(d),l=Le(Xn(a,i),Xn(o,this.activation.apply(f))),u=this.recurrentActivation.apply(p);const m=Xn(u,this.activation.apply(l));return[m,m,l]})}getConfig(){const t={units:this.units,activation:mm(this.activation),recurrentActivation:mm(this.recurrentActivation),useBias:this.useBias,kernelInitializer:ef(this.kernelInitializer),recurrentInitializer:ef(this.recurrentInitializer),biasInitializer:ef(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:wm(this.kernelRegularizer),recurrentRegularizer:wm(this.recurrentRegularizer),biasRegularizer:wm(this.biasRegularizer),activityRegularizer:wm(this.activityRegularizer),kernelConstraint:Gh(this.kernelConstraint),recurrentConstraint:Gh(this.recurrentConstraint),biasConstraint:Gh(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},e=super.getConfig();return Object.assign(t,e),t}}qg.className="LSTMCell",g.registerClass(qg);class Hg extends Lg{constructor(t){0===t.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new qg(t),super(t)}call(t,e){return Tn(()=>(null!=this.cell.dropoutMask&&(On(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(On(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),super.call(t,{mask:null==e?null:e.mask,training:null==e?null:e.training,initialState:null==e?null:e.initialState})))}get units(){return this.cell.units}get activation(){return this.cell.activation}get recurrentActivation(){return this.cell.recurrentActivation}get useBias(){return this.cell.useBias}get kernelInitializer(){return this.cell.kernelInitializer}get recurrentInitializer(){return this.cell.recurrentInitializer}get biasInitializer(){return this.cell.biasInitializer}get unitForgetBias(){return this.cell.unitForgetBias}get kernelRegularizer(){return this.cell.kernelRegularizer}get recurrentRegularizer(){return this.cell.recurrentRegularizer}get biasRegularizer(){return this.cell.biasRegularizer}get kernelConstraint(){return this.cell.kernelConstraint}get recurrentConstraint(){return this.cell.recurrentConstraint}get biasConstraint(){return this.cell.biasConstraint}get dropout(){return this.cell.dropout}get recurrentDropout(){return this.cell.recurrentDropout}get implementation(){return this.cell.implementation}getConfig(){const t={units:this.units,activation:mm(this.activation),recurrentActivation:mm(this.recurrentActivation),useBias:this.useBias,kernelInitializer:ef(this.kernelInitializer),recurrentInitializer:ef(this.recurrentInitializer),biasInitializer:ef(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:wm(this.kernelRegularizer),recurrentRegularizer:wm(this.recurrentRegularizer),biasRegularizer:wm(this.biasRegularizer),activityRegularizer:wm(this.activityRegularizer),kernelConstraint:Gh(this.kernelConstraint),recurrentConstraint:Gh(this.recurrentConstraint),biasConstraint:Gh(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},e=super.getConfig();return delete e.cell,Object.assign(t,e),t}static fromConfig(t,e){return 0===e.implmentation&&(e.implementation=1),new t(e)}}Hg.className="LSTM",g.registerClass(Hg);class Gg extends Bg{constructor(t){super(t),this.cells=t.cells}get stateSize(){const t=[];for(const e of this.cells.slice().reverse())Array.isArray(e.stateSize)?t.push(...e.stateSize):t.push(e.stateSize);return t}call(t,e){return Tn(()=>{let n=(t=t).slice(1);const r=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?r.push(n.splice(0,t.stateSize.length)):r.push(n.splice(0,1));r.reverse();const i=[];let s;for(let o=0;o<this.cells.length;++o){const a=this.cells[o];n=r[o],s=0===o?[t[0]].concat(n):[s[0]].concat(n),s=a.call(s,e),i.push(s.slice(1))}n=[];for(const t of i.slice().reverse())n.push(...t);return[s[0]].concat(n)})}build(t){let e;Sf(t)&&(t=t[0]),t=t,this.cells.forEach((n,r)=>{ud("RNNCell_"+r,()=>{n.build(t),e=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,t=[t[0],e]})}),this.built=!0}getConfig(){const t=[];for(const r of this.cells)t.push({className:r.getClassName(),config:r.getConfig()});const e={cells:t},n=super.getConfig();return Object.assign(e,n),e}static fromConfig(t,e,n={}){const r=[];for(const i of e.cells)r.push(Xf(i,n));return new t({cells:r})}get trainableWeights(){if(!this.trainable)return[];const t=[];for(const e of this.cells)t.push(...e.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const e of this.cells)t.push(...e.nonTrainableWeights);if(!this.trainable){const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e.concat(t)}return t}getWeights(){const t=[];for(const e of this.cells)t.push(...e.weights);return Nf(t)}setWeights(t){const e=[];for(const n of this.cells){const r=t.splice(n.weights.length);for(let t=0;t<n.weights.length;++t)e.push([n.weights[t],r[t]])}Tf(e)}}function Yg(t,e,n=null,r=1){function i(){return Rd(t(),e)}if(r>1){const e=[];for(let s=0;s<r;s++)e.push(Fd(i,t,n));return e.map(t=>In(t.clone()))}return In(Fd(i,t,n).clone())}Gg.className="StackedRNNCells",g.registerClass(Gg);class Kg extends $f{constructor(t){super(t),this.layer=t.layer}build(t){this.built=!0}get trainable(){return null!=this.layer&&this.layer.trainable}set trainable(t){null!=this.layer&&(this.layer.trainable=t)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(t){this.layer.setWeights(t)}getConfig(){const t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},e=super.getConfig();return Object.assign(t,e),t}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(t)}static fromConfig(t,e,n={}){const r=Xf(e.layer,n);delete e.layer;const i={layer:r};return Object.assign(i,e),new t(i)}}class Xg extends Kg{constructor(t){super(t),this.supportsMasking=!0}build(t){if((t=kf(t)).length<3)throw new xh("TimeDistributed layer expects an input shape >= 3D, but received input shape "+JSON.stringify(t));this.inputSpec=[{shape:t}];const e=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(e),this.layer.built=!0),super.build(t)}computeOutputShape(t){const e=[(t=kf(t))[0]].concat(t.slice(2)),n=this.layer.computeOutputShape(e);return[n[0],t[1]].concat(n.slice(1))}call(t,e){return Tn(()=>zg((t,n)=>[Ef(this.layer.call(t,e)),[]],t=Ef(t),[],!1,null,null,!1,!0)[1])}}Xg.className="TimeDistributed",g.registerClass(Xg);class Zg extends Kg{constructor(t){super(t);const e=t.layer.getConfig(),n={};n.className=t.layer.getClassName(),n.config=e,this.forwardLayer=Xf(n),e.goBackwards=!0!==e.goBackwards;const r={};if(r.className=t.layer.getClassName(),r.config=e,this.backwardLayer=Xf(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=void 0===t.mergeMode?"concat":t.mergeMode,$h(rd,"BidirectionalMergeMode",this.mergeMode),t.weights)throw new _h("weights support is not implemented for Bidirectional layer yet.");this._stateful=t.layer.stateful,this.returnSequences=t.layer.returnSequences,this.returnState=t.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=t.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(t){this._trainable=t,null!=this.forwardLayer&&(this.forwardLayer.trainable=t),null!=this.backwardLayer&&(this.backwardLayer.trainable=t)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(t){const e=Math.floor(t.length/2);this.forwardLayer.setWeights(t.slice(0,e)),this.backwardLayer.setWeights(t.slice(e))}computeOutputShape(t){let e,n,r,i=this.forwardLayer.computeOutputShape(t);return Array.isArray(i)&&Array.isArray(i[0])||(i=[i]),i=i,this.returnState?(r=i.slice(1),e=i[0]):e=i[0],e=e,"concat"===this.mergeMode?(e[e.length-1]*=2,n=[e]):n=null==this.mergeMode?[e,e.slice()]:[e],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[e].concat(r).concat(r.slice()):kh(n)}apply(t,e){let n=null==e?null:e.initialState,r=null==e?null:e.constants;null==e&&(e={});const i=Pg(t,n,r,this.numConstants);if(t=i.inputs,n=i.initialState,r=i.constants,Array.isArray(t)&&(n=t.slice(1),t=t[0]),(null==n||0===n.length)&&null==r)return super.apply(t,e);const s=[],o=[];if(null!=n){const t=n.length;if(t%2>0)throw new xh("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");e.initialState=n,s.push(...n);const r=n.map(t=>new Of({shape:t.shape}));this.forwardLayer.stateSpec=r.slice(0,t/2),this.backwardLayer.stateSpec=r.slice(t/2),o.push(...r)}if(null!=r)throw new _h("Support for constants in Bidirectional layers is not implemented yet.");const a=s[0]instanceof If;for(const l of s)if(l instanceof If!==a)throw new xh("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(a){const n=[t].concat(s),r=this.inputSpec.concat(o),i=this.inputSpec;this.inputSpec=r;const a=super.apply(n,e);return this.inputSpec=i,a}return super.apply(t,e)}call(t,e){return Tn(()=>{const n=e.initialState;let r,i,s,o;if(null==n)r=this.forwardLayer.call(t,e),i=this.backwardLayer.call(t,e);else{const s=n.slice(0,n.length/2),o=n.slice(n.length/2);r=this.forwardLayer.call(t,Object.assign(e,{initialState:s})),i=this.backwardLayer.call(t,Object.assign(e,{initialState:o}))}return this.returnState&&(Array.isArray(r)&&(s=r.slice(1).concat(i.slice(1))),r=r[0],i=i[0]),this.returnSequences&&(i=wi(i,1)),"concat"===this.mergeMode?o=Cd([r,i]):"sum"===this.mergeMode?o=Le(r,i):"ave"===this.mergeMode?o=Xn(.5,Le(r,i)):"mul"===this.mergeMode?o=Xn(r,i):null==this.mergeMode&&(o=[r,i]),this.returnState?null==this.mergeMode?o.concat(s):[o].concat(s):o})}resetStates(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(t){ud(this.forwardLayer.name,()=>{this.forwardLayer.build(t)}),ud(this.backwardLayer.name,()=>{this.backwardLayer.build(t)}),this.built=!0}computeMask(t,e){let n;if(Array.isArray(e)&&(e=e[0]),n=this.returnSequences?null==this.mergeMode?[e,e]:e:null==this.mergeMode?[null,null]:null,this.returnState){const t=this.forwardLayer.states.map(t=>null);return Array.isArray(n)?n.concat(t).concat(t):[n].concat(t).concat(t)}return n}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(t),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(t)}getConfig(){const t={mergeMode:this.mergeMode},e=super.getConfig();return Object.assign(t,e),t}static fromConfig(t,e){const n=Xf(e.layer);if(delete e.layer,null!=e.numConstants)throw new _h("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=e;return r.layer=n,new t(r)}}function Qg(t){return new Pf(t)}function Jg(t){return new Dm(t)}function ty(t){return new Em(t)}function ey(t){return new km(t)}function ny(t){return new Am(t)}function ry(t){return new Tm(t)}function iy(t){return new Nm(t)}function sy(t){return new Wm(t)}function oy(t){return new Lm(t)}function ay(t){return new jm(t)}function ly(t){return new Bm(t)}function uy(t){return new Vm(t)}function cy(t){return new qm(t)}function hy(t){return new Hm(t)}function dy(t){return new Gm(t)}function fy(t){return new Qm(t)}function py(t){return new Xm(t)}function my(t){return new Ym(t)}function gy(t){return new Km(t)}function yy(t){return new Zm(t)}function vy(t){return new Jm(t)}function by(t){return new tg(t)}function xy(t){return new eg(t)}function _y(t){return new rg(t)}function wy(t){return new sg(t)}function Sy(t){return new ag(t)}function Cy(t){return new cg(t)}function Ey(t){return new lg(t)}function ky(t){return new ug(t)}function Ay(t){return new og(t)}function Dy(t){return new dg(t)}function Ny(t){return new yg(t)}function Ty(t){return new vg(t)}function Oy(t){return new bg(t)}function Iy(t){return new Cg(t)}function Ry(t){return Iy(t)}function Fy(t){return Iy(t)}function My(t){return new Ag(t)}function $y(t){return My(t)}function Py(t){return My(t)}function zy(t){return new Tg(t)}function Ly(t){return zy(t)}function By(t){return zy(t)}function jy(t){return new Ig(t)}function Uy(t){return new Mg(t)}function Vy(t){return new Rg(t)}function Wy(t){return new $g(t)}function qy(t){return new Sg(t)}function Hy(t){return new kg(t)}function Gy(t){return new Ng(t)}function Yy(t){return new Wg(t)}function Ky(t){return new Vg(t)}function Xy(t){return new Hg(t)}function Zy(t){return new qg(t)}function Qy(t){return new Ug(t)}function Jy(t){return new jg(t)}function tv(t){return new Lg(t)}function ev(t){return new Gg(t)}function nv(t){return new Zg(t)}function rv(t){return new Xg(t)}Zg.className="Bidirectional",g.registerClass(Zg);const iv=Vy,sv=Wy,ov=qy,av=Hy;function lv(t){return new fg(t)}function uv(t){return new pg(t)}function cv(t){return new mg(t)}function hv(t){return new ng(t)}function dv(t,e){return ap(t,e)}function fv(t,e){return hp(t,e)}function pv(t,e){return dp(t,e)}function mv(t,e){return lp(t,e)}function gv(t,e){return fp(t,e)}function yv(t,e){return cp(t,e)}function vv(t,e){return function(t,e){return Tn(()=>{const n=up(t,e),r=function(t,e){return Tn(()=>Zi(t.equal(1),e.equal(0)).sum().cast("float32"))}(t,e),i=n.add(r);return Zr(yi(i,0),n.div(i),0).cast("float32")})}(t,e)}function bv(t,e){return ip(t,e)}function xv(t,e){return Jf(t,e)}function _v(t,e){return tp(t,e)}function wv(t,e){return tp(t,e)}function Sv(t,e){return tp(t,e)}function Cv(t,e){return Qf(t,e)}function Ev(t,e){return Qf(t,e)}function kv(t,e){return Qf(t,e)}function Av(t){return new xm(t)}function Dv(t){return vm(e=t),new xm({l1:null!=e?e.l1:null,l2:0});var e}function Nv(t){return vm(e=t),new xm({l2:null!=e?e.l2:null,l1:0});var e}class Tv extends Uf{constructor(){super(...arguments),this.model=null}setModel(t){if(!(t instanceof Yp))throw new Error("model must be a LayersModel, not some other Container");this.model=t}}function Ov(t,e){return t<e}function Iv(t,e){return t>e}class Rv extends Tv{constructor(t){if(super(),null==t&&(t={}),t.restoreBestWeights)throw new _h("restoreBestWeights = True is not implemented in EarlyStopping yet.");this.monitor=t.monitor||"val_loss",this.minDelta=Math.abs(t.minDelta||0),this.patience=t.patience||0,this.verbose=t.verbose||0,this.mode=t.mode||"auto",this.baseline=t.baseline,-1===["auto","min","max"].indexOf(this.mode)&&(console.warn(`EarlyStopping mode '${this.mode}' is invalid. Falling back to mode 'auto'.`),this.mode="auto"),this.monitorFunc="min"===this.mode?Ov:"max"===this.mode||-1!==this.monitor.indexOf("acc")?Iv:Ov,this.monitorFunc===Ov&&(this.minDelta*=-1)}async onTrainBegin(t){this.wait=0,this.stoppedEpoch=0,this.best=null!=this.baseline?this.baseline:this.monitorFunc===Ov?1/0:-1/0}async onEpochEnd(t,e){await Lf(e);const n=this.getMonitorValue(e);null!=n&&(this.monitorFunc(n-this.minDelta,this.best)?(this.best=n,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=t,this.model.stopTraining=!0)))}async onTrainEnd(t){this.stoppedEpoch>0&&this.verbose&&console.log(`Epoch ${this.stoppedEpoch}: early stopping.`)}getMonitorValue(t){null==t&&(t={});const e=t[this.monitor];return null==e&&console.warn(`Metric for EarlyStopping ${this.monitor} is not available. Available metrics are: `+Object.keys(t)),e}}const Fv={earlyStopping:function(t){return new Rv(t)}};var Mv,$v;!function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF"}(Mv||(Mv={})),function(t){let e;!function(t){t[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"}(e=t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))}($v||($v={}));const Pv={};function zv(t,e){Pv[t]={tfOpName:t,category:"custom",inputs:[],attrs:[],customExecutor:e}}function Lv(t){return Pv[t]}function Bv(t){delete Pv[t]}function jv(t,e,n,i){const s=e.inputParams[t];if(s&&void 0!==s.inputIndexStart){const t=s.inputIndexStart,o=0===s.inputIndexEnd?void 0:void 0===s.inputIndexEnd?t+1:s.inputIndexEnd;if("tensor"===s.type)return Uv(e.inputNames[s.inputIndexStart],n,i);if("tensors"===s.type)return e.inputNames.slice(t,o).map(t=>Uv(t,n,i));const a=Uv(e.inputNames.slice(t)[0],n,i),l=a.dataSync();return"number"===s.type?l[0]:r.toNestedArray(a.shape,l)}const o=e.attrParams[t];return o&&o.value}function Uv(t,e,n){const[r,i]=qv(t),s=n.currentContextIds.find(t=>!!e[Wv(r,t)]);return void 0!==s?e[Wv(r,s)][i]:void 0}function Vv(t,e){const[n,r]=qv(t);return[Wv(n,e&&e.currentContextId),r]}function Wv(t,e){return e?`${t}-${e}`:t}function qv(t){const e=t.split(":");return 1===e.length?[t,0]:[e[0],Number(e[e.length-1])]}function Hv(t,e,n){let r=jv("pad",t,e,n);if("explicit"===r){r=jv("explicitPaddings",t,e,n);const i=[[0,0],[0,0],[0,0],[0,0]];for(let t=0;t<4;t++)i[t][0]=r[2*t],i[t][1]=r[2*t+1];return i}return r}function Gv(t){return t.kept?t:_r(t)}const Yv=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Kv=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"clip_value_min",name:"clipValueMin",type:"number"},{tfName:"clip_value_max",name:"clipValueMax",type:"number"}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"clipValueMin",name:"clipValueMin",type:"number",defaultValue:0},{tfName:"clipValueMax",name:"clipValueMax",type:"number",defaultValue:6}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Xv=[{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]}],Zv=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],Qv=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],Jv=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],tb=[{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]}],eb=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],nb=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]}],rb=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],ib=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],sb=[{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}],ob=[{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],ab=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool",notSupported:!0}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}],lb=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],ub=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]}];function cb(t,e){const n=Array.isArray(t)?String.fromCharCode.apply(null,t):function(t){const e=W().global;if(void 0!==e.atob)return e.atob(t);if("undefined"!=typeof Buffer)return new Buffer(t,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(t);return e?n:n.toLowerCase()}function hb(t,e,n,r=!1){const i=t[e];return null!=i?cb(i.s,r):n}function db(t,e,n){const r=t[e];return r?r.b:n}function fb(t,e,n){const r=t[e]||{},i=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof i?i:parseInt(i,10)}function pb(t){switch("string"==typeof t&&(t=Mv[t]),t){case Mv.DT_FLOAT:return"float32";case Mv.DT_INT32:case Mv.DT_INT64:case Mv.DT_INT8:case Mv.DT_UINT8:return"int32";case Mv.DT_BOOL:return"bool";case Mv.DT_DOUBLE:return"float32";case Mv.DT_STRING:return"string";default:return null}}function mb(t,e,n){const r=t[e];return r&&r.func?r.func.name:n}function gb(t,e,n){const r=t[e];return r&&r.type?pb(r.type):n}function yb(t,e,n){const r=t[e];return r&&r.list&&r.list.type?r.list.type.map(t=>pb(t)):n}function vb(t){if(!t.unknownRank)return null!=t.dim?t.dim.map(t=>"number"==typeof t.size?t.size:parseInt(t.size,10)):[]}function bb(t,e,n){const r=t[e];return r&&r.shape?vb(r.shape):n}function xb(t,e,n){const r=t[e];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map(t=>"number"==typeof t?t:parseInt(t,10)):n}function _b(t,e,n,r=!1){const i=t[e];return i&&i.list&&i.list.s?i.list.s.map(t=>cb(t,r)):n}function wb(t,e,n){const r=t[e];return r&&r.list&&r.list.shape?r.list.shape.map(t=>vb(t)):n}function Sb(t,e,n){const r=t[e];return r&&r.list&&r.list.b?r.list.b:n}class Cb{constructor(t,e,n){this.node=t,this.tensorMap=e,this.context=n,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map(t=>this.getInput(t)),null!=t.rawAttrs&&(this.attrs=Object.keys(t.rawAttrs).reduce((t,e)=>(t[e]=this.getAttr(e),t),{}))}getInput(t){return Uv(t,this.tensorMap,this.context)}getAttr(t,e){const n=this.node.rawAttrs[t];if(null!=n.tensor)return Uv(t,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return fb(this.node.rawAttrs,t,e);if(null!=n.s)return hb(this.node.rawAttrs,t,e);if(null!=n.b)return db(this.node.rawAttrs,t,e);if(null!=n.shape)return bb(this.node.rawAttrs,t,e);if(null!=n.type)return gb(this.node.rawAttrs,t,e);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return xb(this.node.rawAttrs,t,e);if(null!=n.list.s)return _b(this.node.rawAttrs,t,e);if(null!=n.list.shape)return wb(this.node.rawAttrs,t,e);if(null!=n.list.b)return Sb(this.node.rawAttrs,t,e);if(null!=n.list.type)return yb(this.node.rawAttrs,t,e)}return e}}function Eb(t,e,n=""){r.assert(function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(-1!==t[n]&&-1!==e[n]&&t[n]!==e[n])return!1;return!0}(t,e),()=>n+` Shapes ${t} and ${e} must match`)}class kb{constructor(t,e,n,r,i,s,o){this.name=t,this.dtype=e,this.maxSize=n,this.elementShape=r,this.identicalElementShapes=i,this.dynamicSize=s,this.clearAfterRead=o,this.tensors=[],this.closed_=!1,this.idTensor=Si(0),In(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(){this.tensors.forEach(t=>t.tensor.dispose()),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||t>=this.size())throw new Error(`Tried to read from index ${t}, but array size is: ${this.size()}`);const e=this.tensors[t];if(e.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${t} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(e.cleared=!0),e.read=!0,e.tensor}readMany(t){return t.map(t=>this.read(t))}write(t,e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(t<0||!this.dynamicSize&&t>=this.maxSize)throw new Error(`Tried to write to index ${t}, but array is not resizeable and size is: ${this.maxSize}`);const n=this.tensors[t]||{};if(e.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t},\n          because the value dtype is ${e.dtype}, but TensorArray dtype is ${this.dtype}.`);if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=e.shape),Eb(this.elementShape,e.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${t}.`),n.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been read.`);if(n.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${t}, because it has already been written.`);n.tensor=e,In(e),n.written=!0,this.tensors[t]=n}writeMany(t,e){if(t.length!==e.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${t.length} is not the same as tensors size: ${e.length}.`);t.forEach((t,n)=>this.write(t,e[n]))}gather(t,e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${e}`);if(t)t=t.slice(0,this.size());else{t=[];for(let e=0;e<this.size();e++)t.push(e)}if(0===t.length)return Gn([],[0].concat(this.elementShape));const n=this.readMany(t);return Eb(this.elementShape,n[0].shape,"TensorArray shape mismatch: "),wo(n,0)}concat(t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${t}`);if(0===this.size())return Gn([],[0].concat(this.elementShape));const e=[];for(let r=0;r<this.size();r++)e.push(r);const n=this.readMany(e);return Eb(this.elementShape,n[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${n[0].shape})`),Yn(n,0)}scatter(t,e){if(e.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${e.dtype}`);if(t.length!==e.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${t.length} vs. ${e.shape[0]}`);const n=Math.max(...t);if(!this.dynamicSize&&n>=this.maxSize)throw new Error(`Max index must be < array size (${n}  vs. ${this.maxSize})`);this.writeMany(t,Fo(e,0))}split(t,e){if(e.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${e.dtype}`);let n=0;const r=t.map(t=>(n+=t,n));if(n!==e.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${n}, and tensor's shape is: ${e.shape}`);if(!this.dynamicSize&&t.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${t.length}), and the TensorArray is not marked as dynamically resizeable`);const i=0===n?0:e.size/n,s=[];Tn(()=>{e=e.reshape([1,n,i]);for(let n=0;n<t.length;++n)s[n]=dr(e,[0,0===n?0:r[n-1],0],[1,t[n],i]).reshape(this.elementShape);return s});const o=[];for(let a=0;a<t.length;a++)o[a]=a;this.writeMany(o,s)}}class Ab{constructor(t,e,n,r=-1){this.tensors=t,this.elementShape=e,this.elementDtype=n,null!=t&&t.forEach(t=>{if(n!==t.dtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${t.dtype}`);Eb(e,t.shape,"TensorList shape mismatch: "),In(t)}),this.idTensor=Si(0),this.maxNumElements=r,In(this.idTensor)}get id(){return this.idTensor.id}copy(){return new Ab([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(){this.tensors.forEach(t=>t.dispose()),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(t,e,n=-1){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);if(-1!==n&&this.tensors.length!==n)throw new Error(`Operation expected a list with ${n} elements but got a list with ${this.tensors.length} elements.`);return Eb(t,this.elementShape,"TensorList shape mismatch: "),Tn(()=>{const e=this.tensors.map(e=>e.reshape(t));return wo(e,0)})}popBack(t,e){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);if(0===this.size())throw new Error("Trying to pop from an empty list.");const n=this.tensors.pop();return Eb(n.shape,t,"TensorList shape mismatch: "),n.reshape(t)}pushBack(t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(Eb(t.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");In(t),this.tensors.push(t)}resize(t){if(t<0)throw new Error("TensorListResize expects size to be non-negative. Got: "+t);if(-1!==this.maxNumElements&&t>this.maxNumElements)throw new Error(`TensorListResize input size ${t} is greater maxNumElement ${this.maxNumElements}.`);this.tensors.length=t}getItem(t,e,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(t<0||t>this.tensors.length)throw new Error(`Trying to access element ${t} in a list with ${this.tensors.length} elements.`);if(null==this.tensors[t])throw new Error(`element at index ${t} is null.`);return Eb(this.tensors[t].shape,e,"TensorList shape mismatch: "),this.tensors[t]}setItem(t,e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(t<0||-1!==this.maxNumElements&&t>=this.maxNumElements)throw new Error(`Trying to set element ${t} in a list with max ${this.maxNumElements} elements.`);Eb(this.elementShape,e.shape,"TensorList shape mismatch: "),In(e),this.tensors[t]=e}gather(t,e,n){if(e!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e}, but list elements ${this.elementDtype}`);return Eb(this.elementShape,n,"TensorList shape mismatch: "),0===(t=t.slice(0,this.size())).length?Gn([],[0].concat(this.elementShape)):Tn(()=>{const e=t.map(t=>this.tensors[t].reshape(n));return wo(e,0)})}concat(t,e){if(t&&t!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${t}`);return Eb(this.elementShape,e,"TensorList shape mismatch: "),0===this.size()?Gn([],[0].concat(this.elementShape)):Tn(()=>{const t=this.tensors.map(t=>t.reshape(e));return Yn(t,0)})}}function Db(t,e,n){const[r,i]=jv("fusedOps",t,e,n),s="biasadd"===r,o="prelu"===i,a="fusedbatchnorm"===r,l=jv("numArgs",t,e,n);if(s){if(o&&2!==l)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!o&&1!==l)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(a)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported.");const u=jv("strides",t,e,n),c=Hv(t,e,n),h=jv("dataFormat",t,e,n).toUpperCase(),d=jv("dilations",t,e,n),[f,p]=jv("args",t,e,n);return{stride:u,pad:c,dataFormat:h,dilations:d,biasArg:f,preluArg:p,activationFunc:i}}function Nb(t,e,n){return{boxes:jv("boxes",t,e,n),scores:jv("scores",t,e,n),maxOutputSize:jv("maxOutputSize",t,e,n),iouThreshold:jv("iouThreshold",t,e,n),scoreThreshold:jv("scoreThreshold",t,e,n),softNmsSigma:jv("softNmsSigma",t,e,n)}}function Tb(t,e,n){const i=((t,e,n)=>{switch(t.category){case"arithmetic":return Tn(()=>((t,e,n)=>{switch(t.op){case"BiasAdd":case"AddV2":case"Add":return[Le(jv("a",t,e,n),jv("b",t,e,n))];case"AddN":return[Be(jv("tensors",t,e,n))];case"FloorMod":case"Mod":return[us(jv("a",t,e,n),jv("b",t,e,n))];case"Mul":return[Xn(jv("a",t,e,n),jv("b",t,e,n))];case"RealDiv":case"Div":return[Hr(jv("a",t,e,n),jv("b",t,e,n))];case"DivNoNan":return[Jr(jv("a",t,e,n),jv("b",t,e,n))];case"FloorDiv":return[qr(jv("a",t,e,n),jv("b",t,e,n))];case"Sub":return[Gi(jv("a",t,e,n),jv("b",t,e,n))];case"Minimum":return[ls(jv("a",t,e,n),jv("b",t,e,n))];case"Maximum":return[Di(jv("a",t,e,n),jv("b",t,e,n))];case"Pow":return[Es(jv("a",t,e,n),jv("b",t,e,n))];case"SquaredDifference":return[xo(jv("a",t,e,n),jv("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n));case"basic_math":return Tn(()=>((t,e,n)=>{switch(t.op){case"Abs":case"ComplexAbs":return[$e(jv("x",t,e,n))];case"Acos":return[Pe(jv("x",t,e,n))];case"Acosh":return[ze(jv("x",t,e,n))];case"Asin":return[en(jv("x",t,e,n))];case"Asinh":return[nn(jv("x",t,e,n))];case"Atan":return[rn(jv("x",t,e,n))];case"Atan2":return[sn(jv("x",t,e,n),jv("y",t,e,n))];case"Atanh":return[on(jv("x",t,e,n))];case"Ceil":return[Cr(jv("x",t,e,n))];case"Complex":return[kr(jv("real",t,e,n),jv("imag",t,e,n))];case"Cos":return[zr(jv("x",t,e,n))];case"Cosh":return[Lr(jv("x",t,e,n))];case"Elu":return[ei(jv("x",t,e,n))];case"Erf":return[ni(jv("x",t,e,n))];case"Exp":return[ri(jv("x",t,e,n))];case"Expm1":return[si(jv("x",t,e,n))];case"Floor":return[ci(jv("x",t,e,n))];case"Log":return[Fi(jv("x",t,e,n))];case"Log1p":return[Mi(jv("x",t,e,n))];case"Imag":return[xi(jv("x",t,e,n))];case"Neg":return[Vi(jv("x",t,e,n))];case"Reciprocal":return[Ks(jv("x",t,e,n))];case"Real":return[_i(jv("x",t,e,n))];case"Relu":return[Xs(jv("x",t,e,n))];case"Round":return[so(jv("x",t,e,n))];case"Selu":return[ao(jv("x",t,e,n))];case"Sigmoid":return[Zn(jv("x",t,e,n))];case"Sin":return[ho(jv("x",t,e,n))];case"Sign":return[co(jv("x",t,e,n))];case"Sinh":return[fo(jv("x",t,e,n))];case"Softplus":return[Wi(jv("x",t,e,n))];case"Sqrt":return[bo(jv("x",t,e,n))];case"Square":return[cs(jv("x",t,e,n))];case"Tanh":return[fr(jv("x",t,e,n))];case"Tan":return[Eo(jv("x",t,e,n))];case"Relu6":case"ClipByValue":return[Er(jv("x",t,e,n),jv("clipValueMin",t,e,n),jv("clipValueMax",t,e,n))];case"Rsqrt":return[oo(Uv(t.inputNames[0],e,n))];case"Prod":return[Ds(jv("x",t,e,n),jv("axes",t,e,n))];case"LeakyRelu":return[Ni(jv("x",t,e,n),jv("alpha",t,e,n))];case"Prelu":return[ks(jv("x",t,e,n),jv("alpha",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n));case"control":return(async(t,e,n)=>{switch(t.op){case"If":case"StatelessIf":{const r=jv("thenBranch",t,e,n),i=jv("elseBranch",t,e,n),s=jv("cond",t,e,n),o=jv("args",t,e,n);return(await s.data())[0]?n.functionMap[r].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap):n.functionMap[i].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{const r=jv("body",t,e,n),i=jv("cond",t,e,n),s=jv("args",t,e,n),o=await n.functionMap[i].executeFunctionAsync(s,n.tensorArrayMap,n.tensorListMap),a=s.map(t=>t.id);let l=await o[0].data();o.forEach(t=>{t.kept||-1!==a.indexOf(t.id)||t.dispose()});let u=s;for(;l[0];){const t=u;u=await n.functionMap[r].executeFunctionAsync(u,n.tensorArrayMap,n.tensorListMap);const e=u.map(t=>t.id);t.forEach(t=>{t.kept||-1!==a.indexOf(t.id)||-1!==e.indexOf(t.id)||t.dispose()});const s=await n.functionMap[i].executeFunctionAsync(u,n.tensorArrayMap,n.tensorListMap);l=await s[0].data(),s.forEach(t=>{t.kept||-1!==a.indexOf(t.id)||-1!==e.indexOf(t.id)||t.dispose()})}return u}case"LoopCond":return[Gv(jv("pred",t,e,n))];case"Switch":{const r=jv("pred",t,e,n);let i=jv("data",t,e,n);return i.kept||(i=Gv(i)),(await r.data())[0]?[void 0,i]:[i,void 0]}case"Merge":{const r=t.inputNames.find(t=>void 0!==Uv(t,e,n));return r?[Gv(Uv(r,e,n))]:void 0}case"Enter":{const r=jv("frameName",t,e,n),i=jv("tensor",t,e,n);return n.enterFrame(r),[Gv(i)]}case"Exit":{const r=jv("tensor",t,e,n);return n.exitFrame(),[Gv(r)]}case"NextIteration":{const r=jv("tensor",t,e,n);return n.nextIteration(),[Gv(r)]}case"TensorArrayV3":{const r=jv("size",t,e,n),i=jv("dtype",t,e,n),s=jv("elementShape",t,e,n),o=jv("dynamicSize",t,e,n),a=jv("clearAfterRead",t,e,n),l=jv("identicalElementShapes",t,e,n),u=jv("name",t,e,n),c=new kb(u,i,r,s,l,o,a);return n.addTensorArray(c),[c.idTensor,Si(1)]}case"TensorArrayWriteV3":{const r=jv("tensorArrayId",t,e,n),i=jv("index",t,e,n),s=jv("tensor",t,e,n),o=n.getTensorArray(r.id);return o.write(i,s),[o.idTensor]}case"TensorArrayReadV3":{const r=jv("tensorArrayId",t,e,n),i=jv("index",t,e,n);return[n.getTensorArray(r.id).read(i)]}case"TensorArrayGatherV3":{const r=jv("tensorArrayId",t,e,n),i=jv("indices",t,e,n),s=jv("dtype",t,e,n);return[n.getTensorArray(r.id).gather(i,s)]}case"TensorArrayScatterV3":{const r=jv("tensorArrayId",t,e,n),i=jv("indices",t,e,n),s=jv("tensor",t,e,n),o=n.getTensorArray(r.id);return o.scatter(i,s),[o.idTensor]}case"TensorArrayConcatV3":{const r=jv("tensorArrayId",t,e,n),i=n.getTensorArray(r.id),s=jv("dtype",t,e,n);return[i.concat(s)]}case"TensorArraySplitV3":{const r=jv("tensorArrayId",t,e,n),i=jv("tensor",t,e,n),s=jv("lengths",t,e,n),o=n.getTensorArray(r.id);return o.split(s,i),[o.idTensor]}case"TensorArraySizeV3":{const r=jv("tensorArrayId",t,e,n);return[Si(n.getTensorArray(r.id).size(),"int32")]}case"TensorArrayCloseV3":{const r=jv("tensorArrayId",t,e,n),i=n.getTensorArray(r.id);return i.clearAndClose(),[i.idTensor]}case"TensorListSetItem":{const r=jv("tensorListId",t,e,n),i=jv("index",t,e,n),s=jv("tensor",t,e,n),o=n.getTensorList(r.id);return o.setItem(i,s),[o.idTensor]}case"TensorListGetItem":{const r=jv("tensorListId",t,e,n),i=jv("index",t,e,n),s=jv("elementShape",t,e,n),o=jv("elementDType",t,e,n);return[n.getTensorList(r.id).getItem(i,s,o)]}case"TensorListScatterV2":case"TensorListScatter":{const r=jv("indices",t,e,n),i=function(t,e,n,r){if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const i=Math.max(...e);if(null!=r&&-1!==r&&i>=r)throw new Error(`Max index must be < array size (${i}  vs. ${r})`);const s=new Ab([],n,t.dtype,r),o=Fo(t,0);return e.forEach((t,e)=>{s.setItem(t,o[e])}),s}(jv("tensor",t,e,n),r,jv("elementShape",t,e,n),jv("numElements",t,e,n));return n.addTensorList(i),[i.idTensor]}case"TensorListReserve":{const o=(r=jv("elementShape",t,e,n),i=jv("elementDType",t,e,n),s=jv("numElements",t,e,n),new Ab([],r,i,s));return n.addTensorList(o),[o.idTensor]}case"TensorListGather":{const r=jv("tensorListId",t,e,n),i=jv("indices",t,e,n),s=jv("elementShape",t,e,n),o=jv("elementDType",t,e,n);return[n.getTensorList(r.id).gather(i,o,s)]}case"TensorListStack":{const r=jv("tensorListId",t,e,n),i=jv("elementShape",t,e,n),s=jv("elementDType",t,e,n),o=jv("numElements",t,e,n);return[n.getTensorList(r.id).stack(i,s,o)]}case"TensorListFromTensor":{const r=function(t,e,n){const r=t.dtype;if(t.shape.length<1)throw new Error("Tensor must be at least a vector, but saw shape: "+t.shape);if(t.dtype!==n)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${n}`);Eb(t.shape.slice(1),e,"TensorList shape mismatch: ");const i=t.unstack();return new Ab(i,e,r)}(jv("tensor",t,e,n),jv("elementShape",t,e,n),jv("elementDType",t,e,n));return n.addTensorList(r),[r.idTensor]}case"TensorListConcat":{const r=jv("tensorListId",t,e,n),i=n.getTensorList(r.id),s=jv("dtype",t,e,n),o=jv("elementShape",t,e,n);return[i.concat(s,o)]}case"TensorListPushBack":{const r=jv("tensorListId",t,e,n),i=jv("tensor",t,e,n),s=n.getTensorList(r.id);return s.pushBack(i),[s.idTensor]}case"TensorListPopBack":{const r=jv("tensorListId",t,e,n),i=jv("elementShape",t,e,n),s=jv("elementDType",t,e,n);return[n.getTensorList(r.id).popBack(i,s)]}case"TensorListSplit":{const r=jv("tensor",t,e,n),i=jv("elementShape",t,e,n),s=function(t,e,n){let r=0;const i=e.map(t=>(r+=t,r));if(r!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ${r}, and tensor's shape is: ${t.shape}`);const s=0===r?0:t.size/r,o=Tn(()=>{const o=[];t=t.reshape([1,r,s]);for(let r=0;r<e.length;++r)o[r]=dr(t,[0,0===r?0:i[r-1],0],[1,e[r],s]).reshape(n);return t.dispose(),o}),a=new Ab([],n,t.dtype,e.length);for(let l=0;l<o.length;l++)a.setItem(l,o[l]);return a}(r,jv("lengths",t,e,n),i);return n.addTensorList(s),[s.idTensor]}default:throw TypeError(`Node type ${t.op} is not implemented`)}var r,i,s})(t,e,n);case"convolution":return Tn(()=>((t,e,n)=>{switch(t.op){case"Conv1D":{const r=jv("stride",t,e,n),i=jv("pad",t,e,n),s=jv("dataFormat",t,e,n).toUpperCase(),o=jv("dilation",t,e,n);return[Ir(jv("x",t,e,n),jv("filter",t,e,n),r,i,s,o)]}case"Conv2D":{const r=jv("strides",t,e,n),i=Hv(t,e,n),s=jv("dataFormat",t,e,n).toUpperCase(),o=jv("dilations",t,e,n);return[Or(jv("x",t,e,n),jv("filter",t,e,n),[r[1],r[2]],i,s,[o[1],o[2]])]}case"_FusedConv2D":{const{stride:r,pad:i,dataFormat:s,dilations:o,biasArg:a,preluArg:l,activationFunc:u}=Db(t,e,n);return[c.conv2d({x:jv("x",t,e,n),filter:jv("filter",t,e,n),strides:[r[1],r[2]],pad:i,dataFormat:s,dilations:[o[1],o[2]],bias:a,activation:u,preluActivationWeights:l})]}case"FusedDepthwiseConv2dNative":{const{stride:r,pad:i,dataFormat:s,dilations:o,biasArg:a,preluArg:l,activationFunc:u}=Db(t,e,n);return[c.depthwiseConv2d({x:jv("x",t,e,n),filter:jv("filter",t,e,n),strides:[r[1],r[2]],pad:i,dataFormat:s,dilations:[o[1],o[2]],bias:a,activation:u,preluActivationWeights:l})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const r=jv("outputShape",t,e,n),i=jv("strides",t,e,n),s=Hv(t,e,n);return[Fr(jv("x",t,e,n),jv("filter",t,e,n),r,[i[1],i[2]],s)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const r=jv("strides",t,e,n),i=Hv(t,e,n),s=jv("dilations",t,e,n),o=jv("dataFormat",t,e,n).toUpperCase();return[Ur(jv("input",t,e,n),jv("filter",t,e,n),[r[1],r[2]],i,o,[s[1],s[2]])]}case"Conv3D":{const r=jv("strides",t,e,n),i=jv("pad",t,e,n),s=jv("dataFormat",t,e,n).toUpperCase(),o=jv("dilations",t,e,n);return[Mr(jv("x",t,e,n),jv("filter",t,e,n),[r[1],r[2],r[3]],i,s,[o[1],o[2],o[3]])]}case"AvgPool":{const r=jv("strides",t,e,n),i=jv("pad",t,e,n),s=jv("kernelSize",t,e,n);return[_n(jv("x",t,e,n),[s[1],s[2]],[r[1],r[2]],i)]}case"MaxPool":{const r=jv("strides",t,e,n),i=jv("pad",t,e,n),s=jv("kernelSize",t,e,n);return[es(jv("x",t,e,n),[s[1],s[2]],[r[1],r[2]],i)]}case"MaxPoolWithArgmax":{const r=jv("strides",t,e,n),i=jv("pad",t,e,n),s=jv("kernelSize",t,e,n),o=jv("includeBatchInIndex",t,e,n),{result:a,indexes:l}=rs(jv("x",t,e,n),[s[1],s[2]],[r[1],r[2]],i,o);return[a,l]}case"AvgPool3D":{const r=jv("strides",t,e,n),i=jv("pad",t,e,n),s=jv("kernelSize",t,e,n);return[Vn(jv("x",t,e,n),[s[1],s[2],s[3]],[r[1],r[2],r[3]],i)]}case"MaxPool3D":{const r=jv("strides",t,e,n),i=jv("pad",t,e,n),s=jv("kernelSize",t,e,n);return[ns(jv("x",t,e,n),[s[1],s[2],s[3]],[r[1],r[2],r[3]],i)]}case"Dilation2D":{const r=jv("strides",t,e,n),i=jv("pad",t,e,n),s=jv("dilations",t,e,n),o=r[1],a=r[2],l=s[1],u=s[2];return[Wr(jv("x",t,e,n),jv("filter",t,e,n),[o,a],i,[l,u],"NHWC")]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n));case"creation":return Tn(()=>((t,e,n)=>{switch(t.op){case"Fill":{const r=jv("shape",t,e,n),i=jv("dtype",t,e,n);return[ui(r,jv("value",t,e,n),i)]}case"LinSpace":return[Ii(jv("start",t,e,n),jv("stop",t,e,n),jv("num",t,e,n))];case"Multinomial":{const r=jv("logits",t,e,n),i=jv("numSamples",t,e,n),s=jv("seed",t,e,n);return[fs(r,i,s)]}case"OneHot":{const r=jv("indices",t,e,n),i=jv("depth",t,e,n),s=jv("onValue",t,e,n),o=jv("offValue",t,e,n);return[ms(r,i,s,o)]}case"Ones":return[ss(jv("shape",t,e,n),jv("dtype",t,e,n))];case"OnesLike":return[gs(jv("x",t,e,n))];case"RandomUniform":return[Hs(jv("shape",t,e,n),jv("minval",t,e,n),jv("maxval",t,e,n),jv("dtype",t,e,n))];case"Range":return[Ys(jv("start",t,e,n),jv("stop",t,e,n),jv("step",t,e,n),jv("dtype",t,e,n))];case"TruncatedNormal":{const r=jv("shape",t,e,n),i=jv("mean",t,e,n),s=jv("stdDev",t,e,n),o=jv("seed",t,e,n);return[Io(r,i,s,jv("dtype",t,e,n),o)]}case"Zeros":return[is(jv("shape",t,e,n),jv("dtype",t,e,n))];case"ZerosLike":return[Qr(jv("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n));case"dynamic":return(async(t,e,n)=>{switch(t.op){case"NonMaxSuppressionV5":{const{boxes:r,scores:i,maxOutputSize:s,iouThreshold:o,scoreThreshold:a,softNmsSigma:l}=Nb(t,e,n),u=await ol.nonMaxSuppressionWithScoreAsync(r,i,s,o,a,l);return[u.selectedIndices,u.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:r,scores:i,maxOutputSize:s,iouThreshold:o,scoreThreshold:a}=Nb(t,e,n),l=jv("padToMaxOutputSize",t,e,n),u=await ol.nonMaxSuppressionPaddedAsync(r,i,s,o,a,l);return[u.selectedIndices,u.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:r,scores:i,maxOutputSize:s,iouThreshold:o,scoreThreshold:a}=Nb(t,e,n);return[await ol.nonMaxSuppressionAsync(r,i,s,o,a)]}case"Where":{const r=jv("condition",t,e,n).asType("bool"),i=[await Po(r)];return r.dispose(),i}case"ListDiff":return uo(jv("x",t,e,n),jv("y",t,e,n));default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n);case"evaluation":return Tn(()=>((t,e,n)=>{switch(t.op){case"TopKV2":{const r=jv("x",t,e,n),i=jv("k",t,e,n),s=jv("sorted",t,e,n),o=Oo(r,i,s);return[o.values,o.indices]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n));case"image":return Tn(()=>((t,e,n)=>{switch(t.op){case"ResizeBilinear":{const r=jv("images",t,e,n),i=jv("size",t,e,n),s=jv("alignCorners",t,e,n);return[ol.resizeBilinear(r,[i[0],i[1]],s)]}case"ResizeNearestNeighbor":{const r=jv("images",t,e,n),i=jv("size",t,e,n),s=jv("alignCorners",t,e,n);return[ol.resizeNearestNeighbor(r,[i[0],i[1]],s)]}case"CropAndResize":{const r=jv("image",t,e,n),i=jv("boxes",t,e,n),s=jv("boxInd",t,e,n),o=jv("cropSize",t,e,n),a=jv("method",t,e,n),l=jv("extrapolationValue",t,e,n);return[ol.cropAndResize(r,i,s,o,a,l)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n));case"graph":return Tn(()=>((t,e,n)=>{switch(t.op){case"Const":return e[t.name];case"PlaceholderWithDefault":const r=jv("default",t,e,n);return[Uv(t.name,e,n)||r];case"Placeholder":return[Uv(t.name,e,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":return[Gv(jv("x",t,e,n))];case"IdentityN":return jv("x",t,e,n).map(t=>Gv(t));case"Snapshot":return[Gv(jv("x",t,e,n))];case"Shape":return[Gs(jv("x",t,e,n).shape,"int32")];case"ShapeN":return jv("x",t,e,n).map(t=>Gs(t.shape));case"Size":return[Si(jv("x",t,e,n).size,"int32")];case"Rank":return[Si(jv("x",t,e,n).rank,"int32")];case"NoOp":return[Si(1)];case"Print":const i=jv("x",t,e,n),s=jv("data",t,e,n),o=jv("message",t,e,n),a=jv("summarize",t,e,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(o);for(let t=0;t<s.length;t++)console.log(Array.prototype.slice.call(s[t].dataSync()).slice(0,a));return[i];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n));case"logical":return Tn(()=>((t,e,n)=>{switch(t.op){case"Equal":return[Xr(jv("a",t,e,n),jv("b",t,e,n))];case"NotEqual":return[ps(jv("a",t,e,n),jv("b",t,e,n))];case"Greater":return[yi(jv("a",t,e,n),jv("b",t,e,n))];case"GreaterEqual":return[vi(jv("a",t,e,n),jv("b",t,e,n))];case"Less":return[Ti(jv("a",t,e,n),jv("b",t,e,n))];case"LessEqual":return[Oi(jv("a",t,e,n),jv("b",t,e,n))];case"LogicalAnd":return[Zi(jv("a",t,e,n),jv("b",t,e,n))];case"LogicalNot":return[Qi(jv("a",t,e,n))];case"LogicalOr":return[Ji(jv("a",t,e,n),jv("b",t,e,n))];case"Select":case"SelectV2":return[Zr(jv("condition",t,e,n),jv("a",t,e,n),jv("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n));case"matrices":return Tn(()=>((t,e,n)=>{switch(t.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[Kn(jv("a",t,e,n),jv("b",t,e,n),jv("transposeA",t,e,n),jv("transposeB",t,e,n))];case"Transpose":return[Xe(jv("x",t,e,n),jv("perm",t,e,n))];case"_FusedMatMul":const[r,i]=jv("fusedOps",t,e,n),s="biasadd"===r,o="prelu"===i,a=jv("numArgs",t,e,n);if(s){if(o&&2!==a)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!o&&1!==a)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[l,u]=jv("args",t,e,n);return[c.matMul({a:jv("a",t,e,n),b:jv("b",t,e,n),transposeA:jv("transposeA",t,e,n),transposeB:jv("transposeB",t,e,n),bias:l,activation:i,preluActivationWeights:u})];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n));case"normalization":return Tn(()=>((t,e,n)=>{switch(t.op){case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[yr(jv("x",t,e,n),jv("mean",t,e,n),jv("variance",t,e,n),jv("offset",t,e,n),jv("scale",t,e,n),jv("epsilon",t,e,n))];case"LRN":return[Ri(jv("x",t,e,n),jv("radius",t,e,n),jv("bias",t,e,n),jv("alpha",t,e,n),jv("beta",t,e,n))];case"Softmax":return[vo(jv("x",t,e,n))];case"LogSoftmax":return[Ki(jv("x",t,e,n))];case"SparseToDense":return[oa(jv("sparseIndices",t,e,n),jv("outputShape",t,e,n),jv("sparseValues",t,e,n),jv("defaultValue",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n));case"reduction":return Tn(()=>((t,e,n)=>{switch(t.op){case"Max":{const r=jv("axis",t,e,n),i=jv("keepDims",t,e,n);return[Hi(jv("x",t,e,n),r,i)]}case"Mean":{const r=jv("axis",t,e,n),i=jv("keepDims",t,e,n);return[os(jv("x",t,e,n),r,i)]}case"Min":{const r=jv("axis",t,e,n),i=jv("keepDims",t,e,n);return[as(jv("x",t,e,n),r,i)]}case"Sum":{const r=jv("axis",t,e,n),i=jv("keepDims",t,e,n);return[Yi(jv("x",t,e,n),r,i)]}case"All":{const r=jv("axis",t,e,n),i=jv("keepDims",t,e,n);return[Ze(jv("x",t,e,n),r,i)]}case"Any":{const r=jv("axis",t,e,n),i=jv("keepDims",t,e,n);return[Qe(jv("x",t,e,n),r,i)]}case"ArgMax":{const r=jv("axis",t,e,n);return[Je(jv("x",t,e,n),r)]}case"ArgMin":{const r=jv("axis",t,e,n);return[tn(jv("x",t,e,n),r)]}case"Prod":{const r=jv("axis",t,e,n),i=jv("keepDims",t,e,n);return[Ds(jv("x",t,e,n),r,i)]}case"Cumsum":{const r=jv("axis",t,e,n),i=jv("exclusive",t,e,n),s=jv("reverse",t,e,n);return[Br(jv("x",t,e,n),r,i,s)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n));case"slice_join":return Tn(()=>((t,e,n)=>{switch(t.op){case"ConcatV2":case"Concat":{const r=jv("n",t,e,n),i=jv("axis",t,e,n);let s=jv("tensors",t,e,n);return s=s.slice(0,r),[Yn(s,i)]}case"GatherV2":case"Gather":{const r=jv("axis",t,e,n),i=jv("x",t,e,n),s=jv("indices",t,e,n);return[gi(i,s.asType("int32"),r)]}case"ReverseV2":case"Reverse":{const r=jv("axis",t,e,n),i=jv("x",t,e,n);return[wi(i,r)]}case"Slice":{const r=jv("begin",t,e,n),i=jv("size",t,e,n);return[dr(jv("x",t,e,n),r,i)]}case"StridedSlice":{const r=jv("begin",t,e,n),i=jv("end",t,e,n),s=jv("strides",t,e,n),o=jv("beginMask",t,e,n),a=jv("endMask",t,e,n),l=jv("ellipsisMask",t,e,n),u=jv("newAxisMask",t,e,n),c=jv("shrinkAxisMask",t,e,n),h=jv("x",t,e,n);return[Co(h,r,i,s,o,a,l,u,c)]}case"Pack":return Tn(()=>{const i=jv("axis",t,e,n),s=jv("tensors",t,e,n),o=s[0].shape,a=s[0].squeeze().shape,l=s.map(t=>{const e=r.arraysEqual(t.shape,o);if(!e&&!r.arraysEqual(t.squeeze().shape,a))throw new Error("the input tensors shape does not match");return e?t:t.reshape(o)});return[wo(l,i)]});case"Unpack":{const r=jv("axis",t,e,n),i=jv("tensor",t,e,n);return Fo(i,r)}case"Tile":{const r=jv("reps",t,e,n);return[oi(jv("x",t,e,n),r)]}case"Split":case"SplitV":{const r=jv("axis",t,e,n),i=jv("numOrSizeSplits",t,e,n),s=jv("x",t,e,n);return ro(s,i,r)}case"ScatterNd":{const r=jv("indices",t,e,n),i=jv("values",t,e,n),s=jv("shape",t,e,n);return[sa(r,i,s)]}case"GatherNd":{const r=jv("x",t,e,n),i=jv("indices",t,e,n);return[aa(r,i)]}case"SparseToDense":{const r=jv("sparseIndices",t,e,n),i=jv("outputShape",t,e,n),s=jv("sparseValues",t,e,n),o=jv("defaultValue",t,e,n);return[oa(r,s,i,s.dtype===o.dtype?o:o.asType(s.dtype))]}default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n));case"spectral":return Tn(()=>((t,e,n)=>{switch(t.op){case"FFT":return[li(jv("x",t,e,n))];case"IFFT":return[bi(jv("x",t,e,n))];case"RFFT":return[io(jv("x",t,e,n))];case"IRFFT":return[Ci(jv("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n));case"transformation":return Tn(()=>((t,e,n)=>{switch(t.op){case"Cast":return[an(jv("x",t,e,n),jv("dtype",t,e,n))];case"ExpandDims":{const r=jv("axis",t,e,n);return[ii(jv("x",t,e,n),r)]}case"Squeeze":{const r=jv("axis",t,e,n);return[_o(jv("x",t,e,n),r)]}case"Reshape":return[Ke(jv("x",t,e,n),jv("shape",t,e,n))];case"PadV2":case"Pad":return[vs(jv("x",t,e,n),jv("padding",t,e,n),jv("constantValue",t,e,n))];case"SpaceToBatchND":{const r=jv("blockShape",t,e,n),i=jv("paddings",t,e,n);return[Ss(jv("x",t,e,n),r,i)]}case"BatchToSpaceND":{const r=jv("blockShape",t,e,n),i=jv("crops",t,e,n);return[mr(jv("x",t,e,n),r,i)]}case"DepthToSpace":{const r=jv("blockSize",t,e,n),i=jv("dataFormat",t,e,n).toUpperCase();return[jr(jv("x",t,e,n),r,i)]}case"BroadcastTo":return[wr(jv("x",t,e,n),jv("shape",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}})(t,e,n));case"custom":const i=Lv(t.op);if(i&&i.customExecutor)return i.customExecutor(new Cb(t,e,n));throw TypeError(`Custom op ${t.op} is not registered.`);default:throw TypeError(`Unknown op '${t.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(t,e,n);return i instanceof Promise?i.then(t=>[].concat(t)):[].concat(i)}class Ob{constructor(t={},e={},n={},r={}){this.weightMap=t,this.tensorArrayMap=e,this.tensorListMap=n,this.functionMap=r,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(t,e){return{id:t,frameName:e,iterationId:0}}set currentContext(t){this.contexts!==t&&(this.contexts=t,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const t=[];for(let e=0;e<this.contexts.length-1;e++){const n=this.contexts.slice(0,this.contexts.length-e);t.push(this.contextIdforContexts(n))}t.push(""),this._currentContextIds=t}contextIdforContexts(t){return t?t.map(t=>0===t.id&&0===t.iterationId?"":`${t.frameName}-${t.iterationId}`).join("/"):""}enterFrame(t){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,t)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}nextIteration(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");{this.contexts=this.contexts.slice(),this.lastId++;const t=Object.assign({},this.contexts[this.contexts.length-1]);t.iterationId+=1,t.id=this.lastId,this.contexts.splice(-1,1,t),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}}getWeight(t){return this.weightMap[t]}addTensorArray(t){this.tensorArrayMap[t.id]=t}getTensorArray(t){return this.tensorArrayMap[t]}addTensorList(t){this.tensorListMap[t.id]=t}getTensorList(t){return this.tensorListMap[t]}dispose(){for(const t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose();for(const t in this.tensorListMap)this.tensorListMap[t].clearAndClose()}}function Ib(t,e,n){const r=new Set,i=[];let s=null,o=null;const a=new Set,l=Object.keys(t).map(t=>qv(t)[0]),u=[...e];for(;u.length>0;){const t=u.pop();(Mb(t)||$b(t))&&null==s&&(s=t,o=s.children.map(t=>t.name).filter(t=>r.has(t))),r.add(t.name),null==n[t.name]&&-1===l.indexOf(t.name)&&(0!==t.inputs.length?t.inputs.forEach(t=>{a.has(t.name)||(a.add(t.name),u.push(t))}):i.push(t.name))}return{inputs:t,outputs:e,usedNodes:r,missingInputs:i,dynamicNode:s,syncInputs:o}}const Rb=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],Fb=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"];function Mb(t){return Rb.indexOf(t.op)>=0}function $b(t){return Fb.indexOf(t.op)>=0}class Pb{constructor(t,e){this.graph=t,this.parent=e,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this._outputs=t.outputs,this._inputs=t.inputs,this._signature=t.signature,this._functions=t.functions,null!=t.functions&&Object.keys(t.functions).forEach(e=>{this._functionExecutorMap[e]=new Pb(t.functions[e],this)})}get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(t){const e=Object.keys(t).map(e=>t[e].map(t=>t.id));this._weightIds=[].concat(...e),this._weightMap=t}get inputs(){return this._inputs.map(t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0}))}get outputs(){return this._outputs.map(t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0}))}get inputNodes(){return this._inputs.map(t=>t.signatureKey||t.name)}get outputNodes(){return this._outputs.map(t=>{const e=t.signatureKey||t.name;return t.defaultOutput?`${e}:${t.defaultOutput}`:e})}get functions(){return Object.keys(this._functions).reduce((t,e)=>(t[e]=this._functions[e].signature,t),{})}getCompilationKey(t,e){const n=t.map(t=>t.name).sort(),r=e.map(t=>t.name).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)}compile(t,e){const n=Ib(t,e,this.weightMap),{missingInputs:r,dynamicNode:i,syncInputs:s}=n;if(null!=i)throw new Error(`This execution contains the node '${i.name}', which has the dynamic op '${i.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${s}]`);if(r.length>0){const n=e.map(t=>t.name),i=Object.keys(t);throw new Error(`Cannot compute the outputs [${n}] from the provided inputs [${i}]. Missing the following inputs: [${r}]`)}return function(t,e,n){const{usedNodes:r,inputs:i}=n,s=[];Object.keys(i).map(t=>qv(t)[0]).map(e=>t.nodes[e]).forEach(t=>{r.has(t.name)&&s.push(t)}),t.weights.forEach(t=>{r.has(t.name)&&s.push(t)});const o=new Set,a=[];for(;s.length>0;){const t=s.pop();o.add(t.name),e[t.name]||a.push(t),t.children.forEach(t=>{!o.has(t.name)&&r.has(t.name)&&t.inputs.every(t=>o.has(t.name))&&s.push(t)})}return a}(this.graph,this.weightMap,n)}execute(t,e){t=this.mapInputs(t);const n=Object.keys(t).sort();this.checkInputs(t),this.checkInputShapeAndType(t),e=this.mapOutputs(e),this.checkOutputs(e);const r=n.map(t=>this.graph.nodes[qv(t)[0]]),i=e.map(t=>this.graph.nodes[qv(t)[0]]),s=this.getCompilationKey(r,i);let o=this.compiledMap.get(s);null==o&&(o=this.compile(t,i),this.compiledMap.set(s,o));const a={},l={};return Tn(()=>{const n=new Ob(this.weightMap,a,l,this.functionExecutorMap),r=Object.assign({},this.weightMap);Object.keys(t).forEach(e=>{const[n,i]=qv(e),s=[];s[i]=t[e],r[n]=s});const i=this.getFrozenTensorIds(r),s={};for(let t=0;t<o.length;t++){const a=o[t];if(!r[a.name]){const t=Tb(a,r,n);if(t instanceof Promise)throw new Error(`The execution of the op '${a.op}' returned a promise. Please use model.executeAsync() instead.`);r[a.name]=t,this.checkTensorForDisposal(a.name,a,r,n,i,e,s)}}return null==this.parent&&n.dispose(),e.map(t=>Uv(t,r,n))})}getFrozenTensorIds(t){const e=[].concat.apply([],Object.keys(t).map(e=>t[e]).map(t=>t.map(t=>t.id)));return new Set(e)}checkTensorForDisposal(t,e,n,r,i,s,o){"control"!==e.category&&-1===s.indexOf(t)&&(n[t].forEach(t=>{null!=t&&(o[t.id]=(o[t.id]||0)+e.children.length)}),e.inputs.forEach(t=>{if("control"!==t.category){const e=function(t,e,n){return e[Wv(t,n.currentContextId)]}(t.name,n,r);null!=e&&e.forEach(t=>{if(t&&!i.has(t.id)){const e=o[t.id];1===e?(t.dispose(),delete o[t.id]):null!=e&&o[t.id]--}})}}))}async executeAsync(t,e){return this._executeAsync(t,e)}async _executeAsync(t,e,n=!1,r={},i={}){n||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),e=this.mapOutputs(e),this.checkOutputs(e));const s=new Ob(this.weightMap,r,i,this.functionExecutorMap),o=await this.executeWithControlFlow(t,s,e,n),a=e.map(t=>Uv(t,o,s)),l=new Set(a.map(t=>t.id)),u=new Set(Object.keys(t).map(e=>t[e].id));return Object.keys(o).forEach(t=>{o[t].forEach(t=>{!t||t.isDisposed||l.has(t.id)||u.has(t.id)||-1!==this.weightIds.indexOf(t.id)||t.dispose()})}),null==this.parent&&s.dispose(),a}async executeFunctionAsync(t,e,n){const r=t.reduce((t,e,n)=>(t[this.inputs[n].name]=e,t),{});return this._executeAsync(r,this.outputNodes,!0,e,n)}async executeWithControlFlow(t,e,n,r){const i=Object.keys(t),s=i.map(t=>this.graph.nodes[qv(t)[0]]),o=n.map(t=>this.graph.nodes[qv(t)[0]]),{usedNodes:a,missingInputs:l,dynamicNode:u,syncInputs:c}=Ib(t,o,this.weightMap),h=[...s,...this.graph.weights].map(t=>({node:t,contexts:e.currentContext})),d=Object.assign({},this.weightMap);Object.keys(t).forEach(e=>{const[n,r]=qv(e),i=[];i[r]=t[e],d[n]=i});const f={},p=this.getFrozenTensorIds(d),m={};for(;h.length>0;){const t=this.processStack(s,h,e,d,m,p,n,f,a);await Promise.all(t)}null!=u||r||console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const g=o.filter(t=>!Mb(t)&&!Uv(t.name,d,e)).map(t=>t.name);if(g.length>0){let t="";throw null!=u&&(t=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${c}]`),new Error(`Cannot compute the outputs [${g}] from the provided inputs [${i}]. Consider providing the following inputs: [${l}]. ${t}`)}return d}processStack(t,e,n,r,i,s,o,a,l){const u=[];for(;e.length>0;){const c=e.pop();n.currentContext=c.contexts;let h="";if("Enter"===c.node.op&&jv("isConstant",c.node,r,n)&&([h]=Vv(c.node.name,n)),-1===t.indexOf(c.node)){const t=Tb(c.node,r,n);h||([h]=Vv(c.node.name,n));const d=n.currentContext;t instanceof Promise?u.push(t.then(t=>(r[h]=t,n.currentContext=d,this.checkTensorForDisposal(h,c.node,r,n,s,o,a),this.processChildNodes(c.node,e,n,r,i,l),t))):(r[h]=t,this.checkTensorForDisposal(h,c.node,r,n,s,o,a),this.processChildNodes(c.node,e,n,r,i,l))}else this.processChildNodes(c.node,e,n,r,i,l)}return u}processChildNodes(t,e,n,r,i,s){t.children.forEach(t=>{const[o]=Vv(t.name,n);!i[o]&&s.has(t.name)&&("Merge"===t.op?t.inputNames.some(t=>!!Uv(t,r,n))&&(i[o]=!0,e.push({contexts:n.currentContext,node:t})):t.inputNames.every(t=>!!Uv(t,r,n))&&(i[o]=!0,e.push({contexts:n.currentContext,node:t})))})}dispose(){Object.keys(this.weightMap).forEach(t=>this.weightMap[t].forEach(t=>t.dispose()))}checkInputShapeAndType(t){Object.keys(t).forEach(e=>{const n=t[e],[i]=qv(e),s=this.graph.nodes[i];if(s.attrParams.shape&&s.attrParams.shape.value){const t=s.attrParams.shape.value,e=t.length===n.shape.length&&n.shape.every((e,n)=>-1===t[n]||t[n]===e);r.assert(e,()=>`The shape of dict['${s.name}'] provided in model.execute(dict) must be [${t}], but was [${n.shape}]`)}s.attrParams.dtype&&s.attrParams.dtype.value&&r.assert(n.dtype===s.attrParams.dtype.value,()=>`The dtype of dict['${s.name}'] provided in model.execute(dict) must be ${s.attrParams.dtype.value}, but was ${n.dtype}`)})}mapInputs(t){const e={};for(const n in t)null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[n]?e[this._signature.inputs[n].name]=t[n]:e[n]=t[n];return e}checkInputs(t){const e=Object.keys(t).filter(t=>{const[e]=qv(t);return null==this.graph.nodes[e]});if(e.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${e}] that are not part of graph`)}mapOutputs(t){return t.map(t=>null!=this._signature&&null!=this._signature.outputs&&null!=this._signature.outputs[t]?this._signature.outputs[t].name:t,{})}checkOutputs(t){t.forEach(t=>{const[e]=qv(t);if(!this.graph.nodes[e])throw new Error(`The output '${t}' is not found in the graph`)})}}class zb{constructor(t,e={}){this.modelUrl=t,this.loadOptions=e,this.version="n/a",null==e&&(this.loadOptions={})}get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}findIOHandler(){const t=this.modelUrl;if(null!=t.load)this.handler=t;else if(null!=this.loadOptions.requestInit)this.handler=d.browserHTTPRequest(t,this.loadOptions);else{const e=d.getLoadHandlers(t,this.loadOptions);if(0===e.length)e.push(d.browserHTTPRequest(t,this.loadOptions));else if(e.length>1)throw new Error(`Found more than one (${e.length}) load handlers for URL '${[t]}'`);this.handler=e[0]}}async load(){if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const t=await this.handler.load();return this.loadSync(t)}loadSync(t){this.artifacts=t;const e=this.artifacts.modelTopology;let n={};null!=this.artifacts.userDefinedMetadata&&(n=this.artifacts.userDefinedMetadata.signature),this.version=`${e.versions.producer}.${e.versions.minConsumer}`;const r=d.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);return this.executor=new Pb(class{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const t=[].concat(...[E,k,A,D,N,T,O,F,R,I,M,$,P,z,L,B].map(t=>t.json));this.opMappers=t.reduce((t,e)=>(t[e.tfOpName]=e,t),{})}transformGraph(t,e={}){const n=[],r=[],i=t.node.reduce((t,e)=>(t[e.name]=this.mapNode(e),e.op.startsWith("Placeholder")&&n.push(t[e.name]),"Const"===e.op&&r.push(t[e.name]),t),{});let s=[];const o=[];let a={},l={};null!=e&&(a=this.mapSignatureEntries(e.inputs),l=this.mapSignatureEntries(e.outputs));const u=Object.keys(i);u.forEach(t=>{const e=i[t];e.inputNames.forEach(t=>{const[n]=Vv(t);e.inputs.push(i[n]),i[n].children.push(e)})}),0===Object.keys(l).length?u.forEach(t=>{const e=i[t];0===e.children.length&&o.push(e)}):Object.keys(l).forEach(t=>{const[e]=Vv(t),n=i[e];null!=n&&(n.signatureKey=l[t],o.push(n))}),Object.keys(a).length>0?Object.keys(a).forEach(t=>{const[e]=Vv(t),n=i[e];n&&(n.signatureKey=a[t],s.push(n))}):s=n;let c={};return null!=t.library&&null!=t.library.function&&(c=t.library.function.reduce((t,e)=>(t[e.signature.name]=this.mapFunction(e),t),{})),{nodes:i,inputs:s,outputs:o,weights:r,placeholders:n,signature:e,functions:c}}mapSignatureEntries(t){return Object.keys(t||{}).reduce((e,n)=>(e[t[n].name]=n,e),{})}mapNode(t){const e=Lv(t.op)||this.opMappers[t.op]||{};null==t.attr&&(t.attr={});const n={name:t.name,op:t.op,category:e.category,inputNames:(t.input||[]).map(t=>t.startsWith("^")?t.substr(1):t),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:t.attr};return null!=e.inputs&&(n.inputParams=e.inputs.reduce((t,e)=>(t[e.name]={type:e.type,inputIndexStart:e.start,inputIndexEnd:e.end},t),{})),null!=e.attrs&&(n.attrParams=e.attrs.reduce((e,n)=>{const r=n.type;let i=void 0;switch(n.type){case"string":i=hb(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=hb(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":i=_b(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=_b(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":i=fb(t.attr,n.tfName,n.defaultValue||0),void 0===i&&n.tfDeprecatedName&&(i=fb(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":i=xb(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=xb(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":i=db(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=db(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":i=Sb(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=Sb(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":i=bb(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=bb(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":i=wb(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=wb(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":i=gb(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=gb(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":i=yb(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=yb(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":i=mb(t.attr,n.tfName,n.defaultValue),void 0===i&&n.tfDeprecatedName&&(i=mb(t.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${n.type} for op: ${t.op}`)}return e[n.name]={value:i,type:r},e},{})),n}mapFunction(t){const e=t.nodeDef,n=[];let r={};null!=e&&(r=e.reduce((t,e)=>(t[e.name]=this.mapNode(e),"Const"===e.op&&n.push(t[e.name]),t),{}));const i=[],s=[];t.signature.inputArg.forEach(t=>{const[e]=Vv(t.name),n={name:e,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:pb(t.type),type:"dtype"}},children:[]};n.signatureKey=t.name,i.push(n),r[e]=n}),Object.keys(r).forEach(t=>{const e=r[t];e.inputNames.forEach(t=>{const[n]=Vv(t);e.inputs.push(r[n]),r[n].children.push(e)})});const o=t.ret;t.signature.outputArg.forEach(t=>{const[e,n]=Vv(o[t.name]),i=r[e];null!=i&&(i.defaultOutput=n,s.push(i))});const a=this.mapArgsToSignature(t);return{nodes:r,inputs:i,outputs:s,weights:n,placeholders:[],signature:a}}mapArgsToSignature(t){return{methodName:t.signature.name,inputs:t.signature.inputArg.reduce((t,e)=>(t[e.name]=this.mapArgToTensorInfo(e),t),{}),outputs:t.signature.outputArg.reduce((e,n)=>(e[n.name]=this.mapArgToTensorInfo(n,t.ret),e),{})}}mapArgToTensorInfo(t,e){let n=t.name;return null!=e&&(n=e[n]),{name:n,dtype:t.type}}}.Instance.transformGraph(e,n)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),!0}async save(t,e){if("string"==typeof t){const e=d.getSaveHandlers(t);if(0===e.length)throw new Error(`Cannot find any save handlers for URL '${t}'`);if(e.length>1)throw new Error(`Found more than one (${e.length}) save handlers for URL '${t}'`);t=e[0]}if(null==t.save)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return t.save(this.artifacts)}predict(t,e){return this.execute(t,this.outputNodes)}normalizeInputs(t){if(!(t instanceof ue||Array.isArray(t)))return t;if((t=Array.isArray(t)?t:[t]).length!==this.inputNodes.length)throw new Error(`Input tensor count mismatch,the graph model has ${this.inputNodes.length} placeholders, while there are ${t.length} input tensors.`);return this.inputNodes.reduce((e,n,r)=>(e[n]=t[r],e),{})}normalizeOutputs(t){return t=t||this.outputNodes,Array.isArray(t)?t:[t]}execute(t,e){t=this.normalizeInputs(t),e=this.normalizeOutputs(e);const n=this.executor.execute(t,e);return n.length>1?n:n[0]}async executeAsync(t,e){t=this.normalizeInputs(t),e=this.normalizeOutputs(e);const n=await this.executor.executeAsync(t,e);return n.length>1?n:n[0]}convertTensorMapToTensorsMap(t){return Object.keys(t).reduce((e,n)=>(e[n]=[t[n]],e),{})}dispose(){this.executor.dispose()}}async function Lb(t,e={}){if(null==t)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");null==e&&(e={}),e.fromTFHub&&null==t.load&&(t.endsWith("/")||(t+="/"),t+="model.json?tfjs-format=file");const n=new zb(t,e);return await n.load(),n}function Bb(t,e,n=new Map,r=new Set){if(null==t)return null;if(r.has(t))throw new Error("Circular references are not supported.");if(n.has(t))return n.get(t);const i=e(t);if(i.recurse&&null!==i.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(i.recurse){if(Vb(t)){const i=Array.isArray(t)?[]:{};r.add(t);for(const s in t){const o=Bb(t[s],e,n,r);i[s]=o}return r.delete(t),i}throw new Error("Can't recurse into non-iterable type: "+t)}return n.set(t,i.value),i.value}function jb(t){return null===t?null:Vb(t[0])?{value:null,recurse:!0}:{value:t,recurse:!1}}async function Ub(t,e){const n=new Map;Bb(t,e,n);for(const r of Array.from(n.keys())){const t=n.get(r);if(t instanceof Promise){const e=await t;n.set(r,e)}}return Bb(t,e,n)}function Vb(t){return null!=t&&!ArrayBuffer.isView(t)&&(Array.isArray(t)||"object"==typeof t&&!(t instanceof ue))}function Wb(t){return t instanceof ue?{value:t.clone(),recurse:!1}:Vb(t)?{value:null,recurse:!0}:{value:t,recurse:!1}}class qb{constructor(t){if(this.capacity=t,this.begin=0,this.end=0,null==t)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}wrap(t){for(;t<0;)t+=this.doubledCapacity;return t%this.doubledCapacity}get(t){if(t<0)throw new RangeError("Can't get item at a negative index.");return this.data[t%this.capacity]}set(t,e){if(t<0)throw new RangeError("Can't set item at a negative index.");this.data[t%this.capacity]=e}length(){let t=this.end-this.begin;return t<0&&(t=this.doubledCapacity+t),t}isFull(){return this.length()===this.capacity}isEmpty(){return 0===this.length()}push(t){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,t),this.end=this.wrap(this.end+1)}pushAll(t){for(const e of t)this.push(e)}pop(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);const t=this.get(this.end);return this.set(this.end,void 0),t}unshift(t){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,t)}shift(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const t=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),t}shuffleExcise(t){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const e=this.wrap(this.begin+t),n=this.get(e);return this.set(e,this.pop()),n}}class Hb extends qb{constructor(){super(Hb.INITIAL_CAPACITY)}isFull(){return!1}push(t){super.isFull()&&this.expand(),super.push(t)}unshift(t){super.isFull()&&this.expand(),super.unshift(t)}expand(){const t=2*this.capacity,e=new Array(t),n=this.length();for(let r=0;r<n;r++)e[r]=this.get(this.wrap(this.begin+r));this.data=e,this.capacity=t,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}function Gb(t){return new Xb(t)}function Yb(t){return new Zb(t)}Hb.INITIAL_CAPACITY=32;class Kb{async toArray(){const t=[];let e=await this.next();for(;!e.done;)t.push(e.value),e=await this.next();return t}async toArrayForTest(){const t=this.prefetch(100),e=[];let n=await t.next();for(;!n.done;)e.push(n.value),n=await t.next();return e}async resolveFully(){let t=await this.next();for(;!t.done;)t=await this.next()}async resolveWhile(t){let e=await this.next(),n=t(e.value);for(;!e.done&&n;)e=await this.next(),n=t(e.value)}handleErrors(t){return new ix(this,t)}filter(t){return new nx(this,t)}map(t){return new rx(this,t)}mapAsync(t){return new sx(this,t)}serialMapAsync(t){return new sx(this,t).serial()}flatmap(t){return new ax(this,t)}async forEachAsync(t){return this.map(t).resolveFully()}async serialForEach(t){return this.serialMapAsync(t).resolveWhile(t=>!0===t)}rowMajorBatch(t,e=!0){return new ex(this,t,e)}columnMajorBatch(t,e=!0,n=jb){return this.rowMajorBatch(t,e).map(t=>function(t,e=jb){return function t(e,n,r=new Set){const i=e[0];if(r.has(i))throw new Error("Circular references are not supported.");const s=n(e);if(s.recurse&&null!==s.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(s.recurse){if(Vb(i)){const s=Array.isArray(i)?[]:{};r.add(i);for(const o in i){const i=t(e.map(t=>t[o]),n,r);s[o]=i}return r.delete(i),s}throw new Error("Can't recurse into non-iterable type: "+i)}return s.value}(t,e)}(t,n))}concatenate(t,e){return new lx(Gb([this,t]),e)}take(t){return t<0||null==t?this:new tx(this,t)}skip(t){return t<0||null==t?this:new Jb(this,t)}prefetch(t){return new hx(this,t)}shuffle(t,e){return new dx(this,t,e)}serial(){return new Qb(this)}}class Xb extends Kb{constructor(t){super(),this.items=t,this.trav=0}summary(){return`Array of ${this.items.length} items`}async next(){if(this.trav>=this.items.length)return{value:null,done:!0};const t=this.items[this.trav];return this.trav++,{value:(e=t,Bb(e,Wb)),done:!1};var e}}class Zb extends Kb{constructor(t){super(),this.nextFn=t}summary(){return"Function call"}async next(){try{return this.nextFn()}catch(t){throw t.message="Error thrown while iterating through a dataset: "+t.message,t}}}class Qb extends Kb{constructor(t){super(),this.upstream=t,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return this.upstream.summary()+" -> Serial"}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){return this.upstream.next()}}class Jb extends Kb{constructor(t,e){super(),this.upstream=t,this.maxCount=e,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return this.upstream.summary()+" -> Skip"}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.count++<this.maxCount;){const t=await this.upstream.next();if(t.done)return t;On(t.value)}return this.upstream.next()}}class tx extends Kb{constructor(t,e){super(),this.upstream=t,this.maxCount=e,this.count=0}summary(){return this.upstream.summary()+" -> Take"}async next(){return this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next()}}class ex extends Kb{constructor(t,e,n=!0){super(),this.upstream=t,this.batchSize=e,this.enableSmallLastBatch=n,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return this.upstream.summary()+" -> RowMajorBatch"}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){const t=[];for(;t.length<this.batchSize;){const e=await this.upstream.next();if(e.done)return this.enableSmallLastBatch&&t.length>0?{value:t,done:!1}:{value:null,done:!0};t.push(e.value)}return{value:t,done:!1}}}class nx extends Kb{constructor(t,e){super(),this.upstream=t,this.predicate=e,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return this.upstream.summary()+" -> Filter"}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;){const t=await this.upstream.next();if(t.done||this.predicate(t.value))return t;On(t.value)}}}class rx extends Kb{constructor(t,e){super(),this.upstream=t,this.transform=e}summary(){return this.upstream.summary()+" -> Map"}async next(){const t=await this.upstream.next();if(t.done)return{value:null,done:!0};const e=i.getTensorsInContainer(t.value),n=this.transform(t.value),r=i.getTensorsInContainer(n);for(const s of e)i.isTensorInList(s,r)||s.dispose();return{value:n,done:!1}}}class ix extends Kb{constructor(t,e){super(),this.upstream=t,this.handler=e,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return this.upstream.summary()+" -> handleErrors"}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;)try{return await this.upstream.next()}catch(t){if(!this.handler(t))return{value:null,done:!0}}}}class sx extends Kb{constructor(t,e){super(),this.upstream=t,this.transform=e}summary(){return this.upstream.summary()+" -> AsyncMap"}async next(){const t=await this.upstream.next();if(t.done)return{value:null,done:!0};const e=i.getTensorsInContainer(t.value),n=await this.transform(t.value),r=i.getTensorsInContainer(n);for(const s of e)i.isTensorInList(s,r)||s.dispose();return{value:n,done:!1}}}class ox extends Kb{constructor(){super(),this.outputQueue=new Hb,this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;0===this.outputQueue.length();)if(!(await this.pump()))return{value:null,done:!0};return{value:this.outputQueue.shift(),done:!1}}}class ax extends ox{constructor(t,e){super(),this.upstream=t,this.transform=e}summary(){return this.upstream.summary()+" -> Flatmap"}async pump(){const t=await this.upstream.next();if(t.done)return!1;const e=i.getTensorsInContainer(t.value),n=this.transform(t.value),r=i.getTensorsInContainer(n);this.outputQueue.pushAll(n);for(const s of e)i.isTensorInList(s,r)||s.dispose();return!0}}class lx extends Kb{constructor(t,e){super(),this.baseErrorHandler=e,this.lastRead=null,this.iterator=null,this.moreIterators=t}summary(){return"TODO: fill in upstream of chained summaries -> Chained"}async next(){return this.lastRead=this.readFromChain(this.lastRead),this.lastRead}async readFromChain(t){if(await t,null==this.iterator){const t=await this.moreIterators.next();if(t.done)return{value:null,done:!0};this.iterator=t.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler))}const e=await this.iterator.next();return e.done?(this.iterator=null,this.readFromChain(t)):e}}var ux;!function(t){t[t.FAIL=0]="FAIL",t[t.SHORTEST=1]="SHORTEST",t[t.LONGEST=2]="LONGEST"}(ux||(ux={}));class cx extends Kb{constructor(t,e=ux.FAIL){super(),this.iterators=t,this.mismatchMode=e,this.count=0,this.currentPromise=null}summary(){return"{TODO: fill in upstream of zip summaries} -> Zip"}async nextState(t){await t;let e=0,n=0;const r=await Ub(this.iterators,(function(t){return t instanceof Kb?{value:t.next().then(t=>(e++,t.done&&n++,t.value)),recurse:!1}:{value:null,recurse:!0}}));if(e===n)return{value:null,done:!0};if(n>0)switch(this.mismatchMode){case ux.FAIL:throw new Error(`Zipped streams should have the same length. Mismatched at element ${this.count}.`);case ux.SHORTEST:return{value:null,done:!0}}return this.count++,{value:r,done:!1}}async next(){return this.currentPromise=this.nextState(this.currentPromise),this.currentPromise}}class hx extends Kb{constructor(t,e){super(),this.upstream=t,this.bufferSize=e,this.buffer=new qb(e)}summary(){return this.upstream.summary()+" -> Prefetch"}refill(){for(;!this.buffer.isFull();){const t=this.upstream.next();this.buffer.push(t)}}next(){return this.refill(),this.buffer.shift()}}class dx extends hx{constructor(t,e,n){super(t,e),this.upstream=t,this.windowSize=e,this.upstreamExhausted=!1,this.random=Ts.alea(n||r.now().toString()),this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}randomInt(t){return Math.floor(this.random()*t)}chooseIndex(){return this.randomInt(this.buffer.length())}async serialNext(){for(this.upstreamExhausted||this.refill();!this.buffer.isEmpty();){const t=this.chooseIndex(),e=await this.buffer.shuffleExcise(t);if(!e.done)return this.refill(),e;this.upstreamExhausted=!0}return{value:null,done:!0}}}class fx{constructor(){this.size=null}batch(t,e=!0){const n=this;let i;return r.assert(t>0,()=>"batchSize needs to be positive, but it is\n      "+t),i=this.size===1/0||null==this.size?this.size:e?Math.ceil(this.size/t):Math.floor(this.size/t),px(async()=>(await n.iterator()).columnMajorBatch(t,e,yx),i)}concatenate(t){const e=this;let n;return n=this.size===1/0||t.size===1/0?1/0:null!=this.size&&null!=t.size?this.size+t.size:null,px(async()=>(await e.iterator()).concatenate(await t.iterator()),n)}filter(t){const e=this;let n;return n=this.size===1/0?1/0:null,px(async()=>(await e.iterator()).filter(e=>Tn(()=>t(e))),n)}async forEachAsync(t){return(await this.iterator()).forEachAsync(t)}map(t){const e=this;return px(async()=>(await e.iterator()).map(e=>Tn(()=>t(e))),this.size)}mapAsync(t){const e=this;return px(async()=>(await e.iterator()).mapAsync(t),this.size)}prefetch(t){if(null==t)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");const e=this;return px(async()=>(await e.iterator()).prefetch(t),this.size)}repeat(t){const e=this;let n;return n=null!=this.size&&t>0?this.size*t:0===t?0:null!=this.size&&(void 0===t||t<0)?1/0:null,px(async()=>{return n=Yb(async()=>({value:await e.iterator(),done:!1})).take(t),new lx(n,void 0);var n},n)}skip(t){const e=this;let n;return n=null!=this.size&&t>=0&&this.size>=t?this.size-t:null!=this.size&&(this.size<t||void 0===t||t<0)?0:null,px(async()=>(await e.iterator()).skip(t),n)}shuffle(t,e,n=!0){if(null==t||t<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError(`\`Dataset.shuffle()\` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for \`tf.Tensor\`s), consider setting bufferSize to the dataset size (${this.size} elements)`);const i=this,s=Ts.alea(e||r.now().toString());return px(async()=>{let e=s.int32();return n&&(e+=s.int32()),(await i.iterator()).shuffle(t,e.toString())},this.size)}take(t){const e=this;let n;return n=null!=this.size&&this.size>t?t:null!=this.size&&this.size<=t?this.size:null,px(async()=>(await e.iterator()).take(t),n)}async toArray(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArray()}async toArrayForTest(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArrayForTest()}}function px(t,e=null){return new class extends fx{constructor(){super(...arguments),this.size=e}async iterator(){return t()}}}function mx(t){return px(async()=>Gb(t),t.length)}function gx(t){if(!Vb(t))throw new Error("The argument to zip() must be an object or array.");let e;if(Array.isArray(t))for(let n=0;n<t.length;n++)e=null==e?t[n].size:Math.min(e,t[n].size);else if(t instanceof Object)for(const n in t)e=null==e?t[n].size:Math.min(e,t[n].size);return px(async()=>function(t,e=ux.FAIL){return new cx(t,e)}(await Ub(t,t=>{if(t instanceof fx)return{value:t.iterator(),recurse:!1};if(Vb(t))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")}),ux.SHORTEST),e)}function yx(t){return null===t?null:null==(e=t[0])||null===(n=e)||"object"!=typeof n&&"function"!=typeof n||Array.isArray(e)||"object"==typeof e&&e instanceof ue||r.isTypedArray(e)?{value:function(t){if(0===t.length)throw new Error("Can't make a batch of zero elements.");return t[0]instanceof ue?wo(t):Gn(t)}(t),recurse:!1}:{value:null,recurse:!0};var e,n}fx.MAX_BUFFER_SIZE=1e4;class vx extends fx{constructor(t){super(),this.input=t}async iterator(){return(await this.input.iterator()).decodeUTF8().split("\n").map(t=>(t.endsWith("\r")&&(t=t.slice(0,-1)),t))}}const bx=Symbol("out"),xx=Symbol("field"),_x=Symbol("quote"),wx=Symbol("quoteafterquote"),Sx=Symbol("quoteinquote");class Cx extends fx{constructor(t,e){super(),this.input=t,this.hasHeader=!0,this.fullColumnNames=null,this.columnNamesValidated=!1,this.columnConfigs=null,this.configuredColumnsOnly=!1,this.delimiter=",",this.delimWhitespace=!1,this.base=new vx(t),e||(e={}),this.hasHeader=!1!==e.hasHeader,this.fullColumnNames=e.columnNames,this.columnConfigs=e.columnConfigs,this.configuredColumnsOnly=e.configuredColumnsOnly,e.delimWhitespace?(r.assert(null==e.delimiter,()=>"Delimiter should not be provided when delimWhitespace is true."),this.delimWhitespace=!0,this.delimiter=" "):this.delimiter=e.delimiter?e.delimiter:","}async columnNames(){return this.columnNamesValidated||await this.setColumnNames(),this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames}async setColumnNames(){const t=await this.maybeReadHeaderLine();if(!this.fullColumnNames&&!t)throw new Error("Column names must be provided if there is no header line.");this.fullColumnNames&&t&&r.assert(t.length===this.fullColumnNames.length,()=>"The length of provided columnNames ("+this.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+t.length.toString()+")."),this.fullColumnNames||(this.fullColumnNames=t);const e=this.fullColumnNames.reduce((t,e)=>(t[e]=t[e]+1||1,t),{}),n=Object.keys(e).filter(t=>e[t]>1);if(r.assert(0===n.length,()=>"Duplicate column names found: "+n.toString()),this.columnConfigs)for(const r of Object.keys(this.columnConfigs))if(-1===this.fullColumnNames.indexOf(r))throw new Error('The key "'+r+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").");this.columnNamesValidated=!0}async maybeReadHeaderLine(){if(this.hasHeader){const t=await this.base.iterator(),e=await t.next();if(e.done)throw new Error("No data was found for CSV parsing.");return this.parseRow(e.value,!1)}return null}async iterator(){this.columnNamesValidated||await this.setColumnNames();let t=await this.base.iterator();return this.hasHeader&&(t=t.skip(1)),t.map(t=>this.makeDataElement(t))}makeDataElement(t){const e=this.parseRow(t),n={},r={};for(let i=0;i<this.fullColumnNames.length;i++){const s=this.fullColumnNames[i],o=this.columnConfigs?this.columnConfigs[s]:null;if(!this.configuredColumnsOnly||o){const a=e[i];let l=null;if(""===a)if(o&&void 0!==o.default)l=o.default;else{if(o&&(o.required||o.isLabel))throw new Error(`Required column ${s} is empty in this line: ${t}`);l=void 0}else{const t=Number(a);if(isNaN(t))l=o&&"bool"===o.dtype?this.getBoolean(a):a;else if(o&&o.dtype)switch(o.dtype){case"float32":l=t;break;case"int32":l=Math.floor(t);break;case"bool":l=this.getBoolean(a);break;default:l=t}else l=t}o&&o.isLabel?r[s]=l:n[s]=l}}return 0===Object.keys(r).length?n:{xs:n,ys:r}}getBoolean(t){return"1"===t||"true"===t.toLowerCase()?1:0}parseRow(t,e=!0){const n=[];let r=0;const i=t.length;let s=bx;for(let o=0;o<i;o++)switch(s){case bx:switch(t.charAt(o)){case'"':r=o+1,s=_x;break;case this.delimiter:if(r=o+1," "===this.delimiter&&this.delimWhitespace)break;n.push(""),s=bx;break;default:s=xx,r=o}break;case xx:switch(t.charAt(o)){case this.delimiter:n.push(t.substring(r,o)),s=bx,r=o+1}break;case _x:switch(t.charAt(o)){case'"':s=wx}break;case wx:switch(t.charAt(o)){case this.delimiter:n.push(t.substring(r,o-1)),s=bx,r=o+1;break;case'"':s=_x;break;default:s=Sx}break;case Sx:switch(t.charAt(o)){case'"':s=_x}}if(n.push(s===wx?t.substring(r,i-1):t.substring(r)),e&&n.length!==this.fullColumnNames.length)throw new Error(`Invalid row in csv file. Should have ${this.fullColumnNames.length} elements in a row, but got ${n}`);return n}}class Ex extends Kb{constructor(t){super(),this.microphoneConfig=t,this.isClosed=!1,this.fftSize=t.fftSize||1024;const e=Math.log2(this.fftSize);if(this.fftSize<0||e<4||e>14||!Number.isInteger(e))throw new Error("Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got "+this.fftSize);if(this.numFrames=t.numFramesPerSpectrogram||43,this.sampleRateHz=t.sampleRateHz,this.columnTruncateLength=t.columnTruncateLength||this.fftSize,this.audioTrackConstraints=t.audioTrackConstraints,this.smoothingTimeConstant=t.smoothingTimeConstant||0,this.includeSpectrogram=!1!==t.includeSpectrogram,this.includeWaveform=!0===t.includeWaveform,!this.includeSpectrogram&&!this.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.")}summary(){return"microphone"}static async create(t={}){if(W().get("IS_NODE"))throw new Error("microphone API is only supported in browser environment.");const e=new Ex(t);return await e.start(),e}async start(){try{this.stream=await navigator.mediaDevices.getUserMedia({audio:null==this.audioTrackConstraints||this.audioTrackConstraints,video:!1})}catch(n){throw new Error("Error thrown while initializing video stream: "+n.message)}if(!this.stream)throw new Error("Could not obtain audio from microphone.");const t=window.AudioContext||window.webkitAudioContext;if(this.audioContext=new t,this.sampleRateHz){if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error(`Mismatch in sampling rate: Expected: ${this.sampleRateHz}; Actual: `+this.audioContext.sampleRate)}else this.sampleRateHz=this.audioContext.sampleRate;const e=this.audioContext.createMediaStreamSource(this.stream);this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,e.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize)}async next(){if(this.isClosed)return{value:null,done:!0};let t,e;const n=await this.getAudioData();if(this.includeSpectrogram){const e=this.flattenQueue(n.freqDataQueue);t=this.getTensorFromAudioDataArray(e,[this.numFrames,this.columnTruncateLength,1])}if(this.includeWaveform){const t=this.flattenQueue(n.timeDataQueue);e=this.getTensorFromAudioDataArray(t,[this.numFrames*this.fftSize,1])}return{value:{spectrogram:t,waveform:e},done:!1}}async capture(){return(await this.next()).value}async getAudioData(){const t=[],e=[];let n=0;return new Promise(r=>{const i=setInterval(()=>{this.includeSpectrogram&&(this.analyser.getFloatFrequencyData(this.freqData),this.freqData[0]===-1/0&&r({freqDataQueue:t,timeDataQueue:e}),t.push(this.freqData.slice(0,this.columnTruncateLength))),this.includeWaveform&&(this.analyser.getFloatTimeDomainData(this.timeData),e.push(this.timeData.slice())),++n===this.numFrames&&(clearInterval(i),r({freqDataQueue:t,timeDataQueue:e}))},this.fftSize/this.sampleRateHz*1e3)})}stop(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),null!=this.stream&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())}toArray(){throw new Error("Can not convert infinite audio stream to array.")}getSampleRate(){return this.sampleRateHz}flattenQueue(t){const e=t[0].length,n=new Float32Array(t.length*e);return t.forEach((t,r)=>n.set(t,r*e)),n}getTensorFromAudioDataArray(t,e){const n=new Float32Array(r.sizeFromShape(e));return n.set(t,n.length-t.length),Gn(n,e)}}class kx extends Kb{constructor(t,e){if(super(),this.webcamVideoElement=t,this.webcamConfig=e,this.isClosed=!0,this.resize=!1,this.needToResize())if(this.resize=!0,this.cropSize=[this.webcamConfig.resizeHeight,this.webcamConfig.resizeWidth],this.cropBoxInd=Gs([0],"int32"),this.webcamConfig.centerCrop){const t=1*this.webcamConfig.resizeWidth/this.webcamVideoElement.width,e=1*this.webcamConfig.resizeHeight/this.webcamVideoElement.height,n=(1-t)/2,r=(1-e)/2;this.cropBox=ko([r,n,e+r,n+t],[1,4])}else this.cropBox=ko([0,0,1,1],[1,4])}summary(){return"webcam"}static async create(t,e={}){if(W().get("IS_NODE"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!t){if(t=document.createElement("video"),!e.resizeWidth||!e.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");t.width=e.resizeWidth,t.height=e.resizeHeight}const n=new kx(t,e);return await n.start(),n}async start(){this.webcamConfig.facingMode&&r.assert("user"===this.webcamConfig.facingMode||"environment"===this.webcamConfig.facingMode,()=>`Invalid webcam facing mode: ${this.webcamConfig.facingMode}. Please provide 'user' or 'environment'`);try{this.stream=await navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})}catch(t){throw t.message="Error thrown while initializing video stream: "+t.message,t}if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(e){console.log(e),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,new Promise(t=>{this.webcamVideoElement.onloadedmetadata=()=>{t()}})}async next(){if(this.isClosed)return{value:null,done:!0};let t;try{t=p.fromPixels(this.webcamVideoElement)}catch(e){throw new Error("Error thrown converting video to pixels: "+JSON.stringify(e))}if(!this.resize)return{value:t,done:!1};try{return{value:this.cropAndResizeFrame(t),done:!1}}catch(e){throw new Error("Error thrown cropping the video: "+e.message)}finally{t.dispose()}}needToResize(){return!(!this.webcamConfig.resizeWidth||!this.webcamConfig.resizeHeight||this.webcamVideoElement.width===this.webcamConfig.resizeWidth&&this.webcamVideoElement.height===this.webcamConfig.resizeHeight)}cropAndResizeFrame(t){return Tn(()=>{const e=t.toFloat().expandDims(0);let n;return n=ol.cropAndResize(e,this.cropBox,this.cropBoxInd,this.cropSize,"bilinear"),n.reshape(n.shape.slice(1))})}async capture(){return(await this.next()).value}stop(){this.stream.getTracks().forEach(t=>t.stop());try{this.webcamVideoElement.srcObject=null}catch(t){console.log(t),this.webcamVideoElement.src=null}this.isClosed=!0}toArray(){throw new Error("Can not convert infinite video stream to array.")}}class Ax{}class Dx extends Kb{split(t){return new Nx(this,t)}}class Nx extends Dx{constructor(t,e){super(),this.upstream=t,this.impl=new Tx(t,e)}summary(){return this.impl.summary()}async next(){return this.impl.next()}}class Tx extends ox{constructor(t,e){super(),this.upstream=t,this.separator=e,this.carryover=""}summary(){return`${this.upstream.summary()} -> Split('${this.separator}')`}async pump(){const t=await this.upstream.next();if(t.done)return""!==this.carryover&&(this.outputQueue.push(this.carryover),this.carryover="",!0);const e=t.value.split(this.separator);e[0]=this.carryover+e[0];for(const n of e.slice(0,-1))this.outputQueue.push(n);return this.carryover=e[e.length-1],!0}}class Ox extends Kb{decodeUTF8(){return new Ix(this)}}class Ix extends Dx{constructor(t){super(),this.upstream=t,this.impl=new Rx(t)}summary(){return this.impl.summary()}async next(){return this.impl.next()}}class Rx extends ox{constructor(t){if(super(),this.upstream=t,W().get("IS_BROWSER"))this.decoder=new TextDecoder("utf-8");else{const{StringDecoder:t}=n(4);this.decoder=new t("utf8")}}summary(){return this.upstream.summary()+" -> Utf8"}async pump(){const t=await this.upstream.next();let e,n;return!t.done&&(e=t.value,n=W().get("IS_BROWSER")?this.decoder.decode(e,{stream:!0}):this.decoder.write(Buffer.from(e.buffer)),this.outputQueue.push(n),!0)}}class Fx extends Ox{constructor(t,e={}){super(),this.file=t,this.options=e,r.assert(t instanceof Uint8Array||!!W().get("IS_BROWSER")&&(t instanceof File||t instanceof Blob),()=>"FileChunkIterator only supports File, Blob and Uint8Array right now."),this.offset=e.offset||0,this.chunkSize=e.chunkSize||1048576}summary(){return"FileChunks "+this.file}async next(){if(this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size))return{value:null,done:!0};const t=new Promise((t,e)=>{const n=this.offset+this.chunkSize;if(this.file instanceof Uint8Array)t(new Uint8Array(this.file.slice(this.offset,n)));else{const r=new FileReader;r.onload=n=>{let i=r.result;if(i instanceof ArrayBuffer&&(i=new Uint8Array(i)),!(i instanceof Uint8Array))return e(new TypeError("FileReader returned unknown type."));t(i)},r.onabort=t=>e(new Error("Aborted")),r.onerror=t=>e(new Error(t.type));const i=this.file.slice(this.offset,n);r.readAsArrayBuffer(i)}this.offset=n});return{value:await t,done:!1}}}function Mx(t){return"string"==typeof t&&"file://"===t.substr(0,7)}class $x extends Ax{constructor(t,e={}){super(),this.input=t,this.options=e}async iterator(){if(Mx(this.input)&&W().get("IS_NODE")){const t=n(5);this.input=t.readFileSync(this.input.substr(7))}return new Fx(this.input,this.options)}}class Px extends Ax{constructor(t,e={}){super(),this.url=t,this.fileOptions=e}async iterator(){return Mx(this.url)?new $x(this.url,this.fileOptions).iterator():async function(t,e={}){let n,i;var s;"string"==typeof t?n=t:(n=t.url,i={method:(s=t).method,headers:s.headers,body:s.body,mode:s.mode,credentials:s.credentials,cache:s.cache,redirect:s.redirect,referrer:s.referrer,integrity:s.integrity});const o=await r.fetch(n,i);if(o.ok){const t=new Uint8Array(await o.arrayBuffer());return new Fx(t,e)}throw new Error(o.statusText)}(this.url,this.fileOptions)}}function zx(t,e={}){return new Cx(new Px(t),e)}function Lx(t){const e=Yb(t);return px(async()=>e)}function Bx(t){return px(async()=>{const e=await t();return Yb(()=>e.next())})}async function jx(t,e){return kx.create(t,e)}async function Ux(t){return Ex.create(t)}const Vx="2.3.0";function Wx(t,e){Array.isArray(t)||(t=[t]),t.forEach(t=>{null!=t&&r.assert("complex64"!==t.dtype,()=>e+" does not support complex64 tensors in the CPU backend.")})}function qx(t,e,n,r,i,s){const o=i.strideHeight,a=i.strideWidth,l=i.dilationHeight,u=i.dilationWidth,c=i.effectiveFilterHeight,h=i.effectiveFilterWidth,d=i.padInfo.top,f=i.padInfo.left,p="max"===s?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=Sr(i.outShape,n),g=m.values,y=i.outShape[1]*i.outShape[2]*i.outShape[3],v=i.outShape[2]*i.outShape[3],b=i.outShape[3];for(let x=0;x<i.batchSize;++x){const e=x*y,n=x*r[0];for(let m=0;m<i.inChannels;++m)for(let y=0;y<i.outHeight;++y){const x=y*o-d,_=Math.max(0,x),w=Math.min(i.inHeight,c+x),S=e+y*v;for(let e=0;e<i.outWidth;++e){const o=e*a-f,c=Math.max(0,o),d=Math.min(i.inWidth,h+o);let y=p,v=0,x=0;for(let e=_;e<w;e+=l){const i=n+e*r[1];for(let e=c;e<d;e+=u){const n=t[i+e*r[2]+m];"max"===s&&n>y?y=n:"avg"===s&&(v+=n,x++)}if(isNaN(y))break}g[S+e*b+m]="avg"===s?v/x:y}}}return m}function Hx(t,e,n,r,i=!1,s=!1){const o=Sr(r.outShape,"int32"),a=r.strideHeight,l=r.strideWidth,u=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterHeight,d=r.effectiveFilterWidth,f=r.padInfo.top,p=r.padInfo.left,m=Sr(e,n,t);for(let g=0;g<r.batchSize;++g)for(let t=0;t<r.inChannels;++t)for(let e=0;e<r.outHeight;++e){const n=e*a-f;let y=n;for(;y<0;)y+=u;const v=Math.min(r.inHeight,h+n);for(let a=0;a<r.outWidth;++a){const h=a*l-p;let f=h;for(;f<0;)f+=c;const b=Math.min(r.inWidth,d+h);let x=Number.NEGATIVE_INFINITY,_=-1;for(let e=y;e<v;e+=u){const o=e-n;for(let n=f;n<b;n+=c){const a=n-h,l=m.get(g,e,n,t);l>x&&(x=l,_=i?s?((g*r.inHeight+e)*r.inWidth+n)*r.inChannels+t:(e*r.inWidth+n)*r.inChannels+t:o*d+a)}}o.set(_,g,e,a,t)}}return o}const Gx=v.nonMaxSuppressionV3Impl,Yx=v.split,Kx=v.tile,Xx=v.topkImpl,Zx=v.whereImpl;function Qx(t,e,n,r){if("linear"===n)return t.linear(e);if("relu"===n)return t.relu(e);if("elu"===n)return t.elu(e);if("relu6"===n)return t.relu6(e);if("prelu"===n)return t.prelu(e,r);throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}class Jx extends ac{constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new oc(this,An())}write(t,e,n){this.firstUse&&(this.firstUse=!1,W().get("IS_NODE")&&y.warn("\n============================\nHi there \u{1f44b}. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));const r={};return this.data.set(r,{values:t,dtype:n}),r}move(t,e,n,r){this.data.set(t,{values:e,dtype:r})}numDataIds(){return this.data.numDataIds()}async read(t){return this.readSync(t)}readSync(t){const{dtype:e,complexTensors:n}=this.data.get(t);if("complex64"===e){const t=this.readSync(n.real.dataId),e=this.readSync(n.imag.dataId);return y.mergeRealAndImagArrays(t,e)}return this.data.get(t).values}bufferSync(t){const e=this.readSync(t.dataId);let n=e;if("string"===t.dtype)try{n=e.map(t=>r.decodeString(t))}catch(i){throw new Error("Failed to decode encoded string bytes into utf-8")}return Sr(t.shape,t.dtype,n)}makeOutput(t,e,n){const r=this.write(t,e,n);return An().makeTensorFromDataId(r,e,n,this)}disposeData(t){if(this.data.has(t)){const{complexTensors:e}=this.data.get(t);null!=e&&(e.real.dispose(),e.imag.dispose()),this.data.delete(t)}}async time(t){const e=r.now();return t(),{kernelMs:r.now()-e}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}complex(t,e){const n=this.makeOutput(null,t.shape,"complex64");return this.data.get(n.dataId).complexTensors={real:An().keep(t.clone()),imag:An().keep(e.clone())},n}real(t){return this.data.get(t.dataId).complexTensors.real.clone()}imag(t){return this.data.get(t.dataId).complexTensors.imag.clone()}slice(t,e,n){if(Wx(t,"slice"),o.isSliceContinous(t.shape,e,n)){const i=o.computeFlatOffset(e,t.strides),s=r.sizeFromShape(n);return Gn(this.readSync(t.dataId).subarray(i,i+s),n,t.dtype)}const i=Sr(n,t.dtype),s=this.bufferSync(t);for(let r=0;r<i.size;++r){const t=i.indexToLoc(r).map((t,n)=>t+e[n]);i.values[r]=s.get(...t)}return i.toTensor()}stridedSlice(t,e,n,r){Wx(t,"stridedSlice");const i=o.computeOutShape(e,n,r);if(i.some(t=>0===t))return Gn([],i);const s=Sr(i,t.dtype),a=this.bufferSync(t);for(let o=0;o<s.size;o++){const t=s.indexToLoc(o),n=new Array(t.length);for(let i=0;i<n.length;i++)n[i]=t[i]*r[i]+e[i];s.set(a.get(...n),...t)}return s.toTensor()}diag(t){const e=this.readSync(t.dataId),n=Sr([t.size,t.size],t.dtype),r=n.values;for(let i=0;i<e.length;i++)r[i*t.size+i]=e[i];return n.toTensor()}unstack(t,e){const n=t.shape[e],r=new Array(t.rank-1);let i=0;for(let l=0;l<t.rank;l++)l!==e&&(r[i++]=t.shape[l]);const s=new Array(t.rank).fill(0),o=t.shape.slice();o[e]=1;const a=new Array(n);for(let l=0;l<a.length;l++)s[e]=l,a[l]=this.slice(t,s,o).reshape(r);return a}reverse(t,e){Wx(t,"reverse");const n=Sr(t.shape,t.dtype),r=this.bufferSync(t);for(let i=0;i<n.size;i++){const s=n.indexToLoc(i),o=s.slice();e.forEach(e=>o[e]=t.shape[e]-1-o[e]),n.set(r.get(...o),...s)}return n.toTensor()}concat(t,e){if("complex64"===t[0].dtype){const n=t.map(t=>_i(t)),r=t.map(t=>xi(t));return kr(this.concat(n,e),this.concat(r,e))}const n=t.map(t=>{const n=r.sizeFromShape(t.shape.slice(e));return t.as2D(-1,n)}),i=y.computeOutShape(n.map(t=>t.shape),1),s=Sr(i,t[0].dtype).values;if(1===n[0].shape[0]){let t=0;n.forEach(e=>{s.set(this.readSync(e.dataId),t),t+=e.size})}else{let t=0;n.forEach(e=>{const n=this.readSync(e.dataId);let r=0;for(let o=0;o<e.shape[0];++o){const a=o*i[1]+t;for(let t=0;t<e.shape[1];++t)s[a+t]=n[r++]}t+=e.shape[1]})}const o=y.computeOutShape(t.map(t=>t.shape),e);return Gn(s,o,t[0].dtype)}neg(t){return Wx(t,"neg"),this.multiply(Si(-1),t)}add(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),(t,e,n,r)=>({real:t+n,imag:e+r})):this.broadcastedBinaryOp(t,e,ye(t.dtype,e.dtype),(t,e)=>t+e)}addN(t){Wx(t,"addN");const e=t.map(t=>this.readSync(t.dataId)),n=Sr(t[0].shape,t[0].dtype),r=n.values;for(let i=0;i<t.length;i++){const t=e[i];for(let e=0;e<r.length;e++)r[e]+=t[e]}return n.toTensor()}softmax(t,e){const n=r.parseAxisParam([e],t.shape),i=Hi(t,n),s=y.expandShapeToKeepDim(i.shape,n),o=this.subtract(t,i.reshape(s)),a=this.exp(o),l=this.sum(a,n).reshape(s);return Hr(a,l)}subtract(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),(t,e,n,r)=>({real:t-n,imag:e-r})):this.broadcastedBinaryOp(t,e,ye(t.dtype,e.dtype),(t,e)=>t-e)}pow(t,e){return Wx([t,e],"pow"),this.broadcastedBinaryOp(t,e,t.dtype,(t,e)=>Math.pow(t,e))}batchMatMul(t,e,n,r){Wx([t,e],"matMul");const i=n?t.shape[1]:t.shape[2],s=n?t.shape[2]:t.shape[1],o=r?e.shape[1]:e.shape[2],a=t.shape[0],l=this.readSync(t.dataId),u=this.readSync(e.dataId),[c,h,d]=n?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],[f,p,m]=r?[1,e.strides[1],e.strides[0]]:[e.strides[1],1,e.strides[0]],g=s*o,y=Sr([a,s,o],t.dtype),v=y.values,b=this.blockSize;for(let x=0;x<a;x++)for(let t=0;t<s;t+=b)for(let e=0;e<o;e+=b)for(let n=0;n<i;n+=b){const r=Math.min(t+b,s),a=Math.min(e+b,o),y=Math.min(n+b,i);for(let i=t;i<r;i++)for(let t=e;t<a;t++){let e=0;for(let r=n;r<y;r++)e+=l[x*c+i*h+r*d]*u[r*f+t*p+x*m];v[x*g+(i*o+t)]+=e}}return y.toTensor()}fusedBatchMatMul({a:t,b:e,transposeA:n,transposeB:r,bias:i,activation:s,preluActivationWeights:o}){let a=this.batchMatMul(t,e,n,r);return i&&(a=this.add(a,i)),s&&(a=Qx(this,a,s,o)),a}multiply(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),(t,e,n,r)=>({real:t*n-e*r,imag:t*r+e*n})):this.broadcastedBinaryOp(t,e,ye(t.dtype,e.dtype),(t,e)=>t*e)}floorDiv(t,e){return Wx([t,e],"floorDiv"),this.broadcastedBinaryOp(t,e,"int32",(t,e)=>Math.floor(t/e))}sum(t,e){Wx(t,"sum"),y.assertAxesAreInnerMostDims("sum",e,t.rank);const[n,i]=y.computeOutAndReduceShapes(t.shape,e),s=is(n,ye(t.dtype,"int32")),o=r.sizeFromShape(i),a=this.readSync(s.dataId),l=this.readSync(t.dataId);for(let r=0;r<a.length;++r){const t=r*o;let e=0;for(let n=0;n<o;++n)e+=l[t+n];a[r]=e}return s}prod(t,e){Wx(t,"sum");const[n,i]=y.computeOutAndReduceShapes(t.shape,e),s=is(n,ye(t.dtype,"int32")),o=r.sizeFromShape(i),a=this.readSync(s.dataId),l=this.readSync(t.dataId);for(let r=0;r<a.length;++r){const t=r*o;let e=1;for(let n=0;n<o;++n)e*=l[t+n];a[r]=e}return s}unsortedSegmentSum(t,e,n){Wx(t,"unsortedSegmentSum");const r=[],i=t.rank-e.rank;for(let s=0;s<i;++s)e=e.expandDims(s+1);for(let s=0;s<n;++s){const n=Si(s,"int32"),i=Xr(n,e).asType("float32").mul(t).sum(0);r.push(i)}return wo(r)}argMin(t,e){Wx(t,"argMin");const n=[e];y.assertAxesAreInnerMostDims("argMin",n,t.rank);const[i,s]=y.computeOutAndReduceShapes(t.shape,n),o=is(i,"int32"),a=r.sizeFromShape(s),l=this.readSync(o.dataId),u=this.readSync(t.dataId);for(let r=0;r<l.length;++r){const t=r*a;let e=u[t],n=0;for(let r=0;r<a;++r){const i=u[t+r];i<e&&(e=i,n=r)}l[r]=n}return o}argMax(t,e){Wx(t,"argMax");const n=[e];y.assertAxesAreInnerMostDims("argMax",n,t.rank);const[i,s]=y.computeOutAndReduceShapes(t.shape,n),o=is(i,"int32"),a=r.sizeFromShape(s),l=this.readSync(o.dataId),u=this.readSync(t.dataId);for(let r=0;r<l.length;++r){const t=r*a;let e=u[t],n=0;for(let r=0;r<a;++r){const i=u[t+r];i>e&&(e=i,n=r)}l[r]=n}return o}cumsum(t,e,n,r){if(Wx(t,"cumsum"),e!==t.rank-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${t.rank-1} but got axis=`+e);const i=ye(t.dtype,"int32"),s=is(t.shape,i),o=this.readSync(s.dataId),a=this.readSync(t.dataId),l=t.shape[t.rank-1],u=r?(t,e)=>t+l-e-1:(t,e)=>t+e;for(let c=0;c<a.length;c+=l)for(let t=0;t<l;t++){const e=u(c,t);if(0===t)o[e]=n?0:a[e];else{const r=u(c,t-1);o[e]=n?a[r]+o[r]:a[e]+o[r]}}return s}equal(t,e){return Wx([t,e],"equal"),this.broadcastedBinaryOp(t,e,"bool",(t,e)=>t===e?1:0)}notEqual(t,e){return Wx([t,e],"notEqual"),this.broadcastedBinaryOp(t,e,"bool",(t,e)=>t!==e?1:0)}less(t,e){return Wx([t,e],"less"),this.broadcastedBinaryOp(t,e,"bool",(t,e)=>t<e?1:0)}lessEqual(t,e){return Wx([t,e],"lessEqual"),this.broadcastedBinaryOp(t,e,"bool",(t,e)=>t<=e?1:0)}greater(t,e){return Wx([t,e],"greater"),this.broadcastedBinaryOp(t,e,"bool",(t,e)=>t>e?1:0)}greaterEqual(t,e){return Wx([t,e],"greaterEqual"),this.broadcastedBinaryOp(t,e,"bool",(t,e)=>t>=e?1:0)}logicalNot(t){Wx(t,"logicalNot");const e=this.readSync(t.dataId),n=new Uint8Array(e.length);for(let r=0;r<e.length;++r)n[r]=e[r]?0:1;return this.makeOutput(n,t.shape,"bool")}logicalAnd(t,e){return Wx([t,e],"logicalAnd"),this.broadcastedBinaryOp(t,e,"bool",(t,e)=>t&&e)}logicalOr(t,e){return Wx([t,e],"logicalOr"),this.broadcastedBinaryOp(t,e,"bool",(t,e)=>t||e)}select(t,e,n){Wx([t,e,n],"select");const i=this.readSync(t.dataId),s=this.readSync(e.dataId),o=this.readSync(n.dataId),a=is(e.shape,ye(e.dtype,n.dtype)),l=this.readSync(a.dataId);let u=0;const c=0===t.rank||t.rank>1||1===e.rank?1:r.sizeFromShape(e.shape.slice(1));for(let r=0;r<i.length;r++)for(let t=0;t<c;t++)l[u++]=1===i[r]?s[r]:o[r];return a}where(t){Wx([t],"where");const e=this.readSync(t.dataId);return Zx(t.shape,e)}topk(t,e,n){Wx(t,"topk");const r=this.readSync(t.dataId);return Xx(r,t.shape,t.dtype,e,n)}min(t,e){Wx(t,"min"),y.assertAxesAreInnerMostDims("min",e,t.rank);const[n,i]=y.computeOutAndReduceShapes(t.shape,e),s=is(n,t.dtype),o=r.sizeFromShape(i),a=this.readSync(s.dataId),l=this.readSync(t.dataId);for(let r=0;r<a.length;++r){const t=r*o;let e=l[t];for(let n=0;n<o;++n){const r=l[t+n];r<e&&(e=r)}a[r]=e}return s}minimum(t,e){return Wx([t,e],"minimum"),this.broadcastedBinaryOp(t,e,t.dtype,(t,e)=>Math.min(t,e))}mod(t,e){return Wx([t,e],"mod"),this.broadcastedBinaryOp(t,e,t.dtype,(t,e)=>{const n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e})}maximum(t,e){return Wx([t,e],"maximum"),this.broadcastedBinaryOp(t,e,t.dtype,(t,e)=>Math.max(t,e))}all(t,e){Wx(t,"all"),y.assertAxesAreInnerMostDims("all",e,t.rank);const[n,i]=y.computeOutAndReduceShapes(t.shape,e),s=is(n,t.dtype),o=r.sizeFromShape(i),a=this.readSync(s.dataId),l=this.readSync(t.dataId);for(let r=0;r<a.length;++r){const t=r*o;let e=l[t];for(let n=0;n<o;++n){const r=l[t+n];e=e&&r}a[r]=e}return s}any(t,e){Wx(t,"any"),y.assertAxesAreInnerMostDims("any",e,t.rank);const[n,i]=y.computeOutAndReduceShapes(t.shape,e),s=is(n,t.dtype),o=r.sizeFromShape(i),a=this.readSync(s.dataId),l=this.readSync(t.dataId);for(let r=0;r<a.length;++r){const t=r*o;let e=l[t];for(let n=0;n<o;++n){const r=l[t+n];e=e||r}a[r]=e}return s}squaredDifference(t,e){return Wx([t,e],"squaredDifference"),this.broadcastedBinaryOp(t,e,t.dtype,(t,e)=>{const n=t-e;return n*n})}ceil(t){Wx(t,"ceil");const e=this.readSync(t.dataId),n=new Float32Array(e.length);for(let r=0;r<e.length;++r)n[r]=Math.ceil(e[r]);return this.makeOutput(n,t.shape,"float32")}floor(t){Wx(t,"floor");const e=this.readSync(t.dataId),n=new Float32Array(e.length);for(let r=0;r<e.length;++r)n[r]=Math.floor(e[r]);return this.makeOutput(n,t.shape,"float32")}sign(t){Wx(t,"x");const e=this.readSync(t.dataId),n=new Float32Array(e.length);for(let r=0;r<e.length;++r)n[r]=e[r]<0?-1:e[r]>0?1:0;return this.makeOutput(n,t.shape,"float32")}isNaN(t){Wx(t,"x");const e=this.readSync(t.dataId),n=new Uint8Array(e.length);for(let r=0;r<e.length;++r)Number.isNaN(e[r])&&(n[r]=1);return this.makeOutput(n,t.shape,"bool")}isInf(t){Wx(t,"x");const e=this.readSync(t.dataId),n=new Uint8Array(e.length);for(let r=0;r<e.length;++r)Math.abs(e[r])===1/0&&(n[r]=1);return this.makeOutput(n,t.shape,"bool")}isFinite(t){Wx(t,"x");const e=this.readSync(t.dataId),n=new Uint8Array(e.length);for(let r=0;r<e.length;++r)Number.isFinite(e[r])&&(n[r]=1);return this.makeOutput(n,t.shape,"bool")}round(t){Wx(t,"round");const e=this.readSync(t.dataId),n=new Float32Array(e.length);for(let r=0;r<e.length;++r){const t=Math.floor(e[r]);n[r]=e[r]-t<.5?Math.floor(e[r]):e[r]-t>.5?Math.ceil(e[r]):t%2==0?t:t+1}return this.makeOutput(n,t.shape,"float32")}exp(t){Wx(t,"exp");const e=this.readSync(t.dataId),n=new Float32Array(e.length);for(let r=0;r<e.length;++r)n[r]=Math.exp(e[r]);return this.makeOutput(n,t.shape,"float32")}expm1(t){Wx(t,"expm1");const e=this.readSync(t.dataId),n=new Float32Array(e.length);for(let r=0;r<e.length;++r)n[r]=Math.expm1(e[r]);return this.makeOutput(n,t.shape,"float32")}log(t){Wx(t,"log");const e=this.readSync(t.dataId),n=new Float32Array(e.length);for(let r=0;r<e.length;++r)n[r]=Math.log(e[r]);return this.makeOutput(n,t.shape,"float32")}log1p(t){Wx(t,"log1p");const e=this.readSync(t.dataId),n=new Float32Array(e.length);for(let r=0;r<e.length;++r)n[r]=Math.log1p(e[r]);return this.makeOutput(n,t.shape,"float32")}sqrt(t){Wx(t,"sqrt");const e=this.readSync(t.dataId),n=new Float32Array(e.length);for(let r=0;r<e.length;++r)n[r]=Math.sqrt(e[r]);return this.makeOutput(n,t.shape,"float32")}rsqrt(t){Wx(t,"rsqrt");const e=this.readSync(t.dataId),n=new Float32Array(e.length);for(let r=0;r<e.length;++r)n[r]=1/Math.sqrt(e[r]);return this.makeOutput(n,t.shape,"float32")}reciprocal(t){Wx(t,"reciprocal");const e=this.readSync(t.dataId),n=new Float32Array(e.length);for(let r=0;r<e.length;++r)n[r]=1/e[r];return this.makeOutput(n,t.shape,"float32")}linear(t){return t}relu(t){Wx(t,"relu");const e=is(t.shape,t.dtype),n=this.readSync(e.dataId),r=this.readSync(t.dataId);for(let i=0;i<r.length;++i)n[i]=Math.max(0,r[i]);return e}relu6(t){Wx(t,"relu");const e=is(t.shape,t.dtype),n=this.readSync(e.dataId),r=this.readSync(t.dataId);for(let i=0;i<r.length;++i)n[i]=Math.min(Math.max(0,r[i]),6);return e}prelu(t,e){return Wx([t,e],"prelu"),this.broadcastedBinaryOp(t,e,t.dtype,(t,e)=>t<0?e*t:t)}elu(t){Wx(t,"elu");const e=new Float32Array(t.size),n=this.readSync(t.dataId);for(let r=0;r<n.length;++r){const t=n[r];e[r]=t>=0?t:Math.exp(t)-1}return this.makeOutput(e,t.shape,"float32")}eluDer(t,e){Wx([t,e],"eluDer");const n=new Float32Array(e.size),r=this.readSync(e.dataId),i=this.readSync(t.dataId);for(let s=0;s<r.length;++s){const t=r[s];n[s]=t>=1?i[s]:i[s]*(t+1)}return this.makeOutput(n,e.shape,"float32")}selu(t){Wx(t,"selu");const e=y.SELU_SCALEALPHA,n=y.SELU_SCALE,r=new Float32Array(t.size),i=this.readSync(t.dataId);for(let s=0;s<i.length;++s){const t=i[s];r[s]=t>=0?n*t:e*(Math.exp(t)-1)}return this.makeOutput(r,t.shape,"float32")}clip(t,e,n){Wx(t,"clip");const r=new Float32Array(t.size),i=this.readSync(t.dataId);for(let s=0;s<i.length;++s){const t=i[s];r[s]=t>n?n:t<e?e:t}return this.makeOutput(r,t.shape,"float32")}abs(t){const e=new Float32Array(t.size),n=this.readSync(t.dataId);for(let r=0;r<n.length;++r)e[r]=Math.abs(n[r]);return this.makeOutput(e,t.shape,"float32")}complexAbs(t){const e=new Float32Array(t.size),n=this.readSync(t.dataId);for(let r=0;r<t.size;++r)e[r]=Math.hypot(n[2*r],n[2*r+1]);return this.makeOutput(e,t.shape,"float32")}int(t){Wx(t,"int");const e=new Int32Array(t.size),n=this.readSync(t.dataId);for(let r=0;r<n.length;++r)e[r]=n[r];return this.makeOutput(e,t.shape,"int32")}sigmoid(t){Wx(t,"sigmoid");const e=new Float32Array(t.size),n=this.readSync(t.dataId);for(let r=0;r<n.length;++r)e[r]=1/(1+Math.exp(-n[r]));return this.makeOutput(e,t.shape,"float32")}softplus(t){Wx(t,"softplus");const e=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(t.size),r=this.readSync(t.dataId);for(let i=0;i<r.length;++i){const t=r[i]>-e,s=r[i]<e,o=Math.exp(r[i]);let a;a=s?o:t?r[i]:Math.log(1+o),n[i]=a}return this.makeOutput(n,t.shape,"float32")}sin(t){Wx(t,"sin");const e=new Float32Array(t.size),n=this.readSync(t.dataId);for(let r=0;r<n.length;++r)e[r]=Math.sin(n[r]);return this.makeOutput(e,t.shape,"float32")}cos(t){Wx(t,"cos");const e=new Float32Array(t.size),n=this.readSync(t.dataId);for(let r=0;r<n.length;++r)e[r]=Math.cos(n[r]);return this.makeOutput(e,t.shape,"float32")}tan(t){Wx(t,"tan");const e=new Float32Array(t.size),n=this.readSync(t.dataId);for(let r=0;r<n.length;++r)e[r]=Math.tan(n[r]);return this.makeOutput(e,t.shape,"float32")}asin(t){Wx(t,"asin");const e=new Float32Array(t.size),n=this.readSync(t.dataId);for(let r=0;r<n.length;++r)e[r]=Math.asin(n[r]);return this.makeOutput(e,t.shape,"float32")}acos(t){Wx(t,"acos");const e=new Float32Array(t.size),n=this.readSync(t.dataId);for(let r=0;r<n.length;++r)e[r]=Math.acos(n[r]);return this.makeOutput(e,t.shape,"float32")}atan(t){Wx(t,"atan");const e=new Float32Array(t.size),n=this.readSync(t.dataId);for(let r=0;r<n.length;++r)e[r]=Math.atan(n[r]);return this.makeOutput(e,t.shape,"float32")}atan2(t,e){return Wx([t,e],"atan2"),this.broadcastedBinaryOp(t,e,t.dtype,(t,e)=>Math.atan2(t,e))}sinh(t){Wx(t,"sinh");const e=new Float32Array(t.size),n=this.readSync(t.dataId);for(let r=0;r<n.length;++r)e[r]=Math.sinh(n[r]);return this.makeOutput(e,t.shape,"float32")}cosh(t){Wx(t,"cosh");const e=new Float32Array(t.size),n=this.readSync(t.dataId);for(let r=0;r<n.length;++r)e[r]=Math.cosh(n[r]);return this.makeOutput(e,t.shape,"float32")}tanh(t){Wx(t,"tanh");const e=new Float32Array(t.size),n=this.readSync(t.dataId);for(let i=0;i<n.length;++i)e[i]=r.tanh(n[i]);return this.makeOutput(e,t.shape,"float32")}asinh(t){Wx(t,"asinh");const e=new Float32Array(t.size),n=this.readSync(t.dataId);for(let r=0;r<n.length;++r)e[r]=Math.asinh(n[r]);return this.makeOutput(e,t.shape,"float32")}acosh(t){Wx(t,"acosh");const e=new Float32Array(t.size),n=this.readSync(t.dataId);for(let r=0;r<n.length;++r)e[r]=Math.acosh(n[r]);return this.makeOutput(e,t.shape,"float32")}atanh(t){Wx(t,"atanh");const e=new Float32Array(t.size),n=this.readSync(t.dataId);for(let r=0;r<n.length;++r)e[r]=Math.atanh(n[r]);return this.makeOutput(e,t.shape,"float32")}erf(t){Wx(t,"erf");const e=new Float32Array(t.size),n=this.readSync(t.dataId),r=y.ERF_P,i=y.ERF_A1,s=y.ERF_A2,o=y.ERF_A3,a=y.ERF_A4,l=y.ERF_A5;for(let u=0;u<n.length;++u){const t=Math.sign(n[u]),c=Math.abs(n[u]),h=1/(1+r*c);e[u]=t*(1-((((l*h+a)*h+o)*h+s)*h+i)*h*Math.exp(-c*c))}return this.makeOutput(e,t.shape,"float32")}step(t,e=0){Wx(t,"step");const n=new Float32Array(t.size),r=this.readSync(t.dataId);for(let i=0;i<r.length;++i){const t=r[i];n[i]=isNaN(t)?NaN:t>0?1:e}return this.makeOutput(n,t.shape,"float32")}fusedConv2d({input:t,filter:e,convInfo:n,bias:r,activation:i,preluActivationWeights:s}){let o=this.conv2d(t,e,n);return r&&(o=this.add(o,r)),i&&(o=Qx(this,o,i,s)),o}conv2d(t,e,n){Wx([t,e],"conv2d");const r=n.filterHeight,i=n.filterWidth,s=n.dilationHeight,o=n.dilationWidth,a=n.padInfo.left,l=n.padInfo.top,u="channelsLast"===n.dataFormat,c=Sr(n.outShape,t.dtype),h=t.strides[0],d=u?t.strides[1]:t.strides[2],f=u?t.strides[2]:1,p=u?1:t.strides[1],m=c.strides[0],g=u?c.strides[1]:c.strides[2],y=u?c.strides[2]:1,v=u?1:c.strides[1],b=this.readSync(t.dataId),x=this.readSync(e.dataId),_=c.values;for(let w=0;w<n.batchSize;++w){const t=w*h,u=w*m;for(let c=0;c<n.outHeight;++c){const h=u+c*g,m=c*n.strideHeight-l;for(let l=0;l<r;l++){const r=m+l*s;if(r<0||r>=n.inHeight)continue;const u=l*e.strides[0],c=t+r*d;for(let t=0;t<n.outWidth;++t){const r=h+t*y,s=t*n.strideWidth-a;for(let t=0;t<i;t++){const i=s+t*o;if(i<0||i>=n.inWidth)continue;const a=c+i*f;let l=u+t*e.strides[1];for(let t=0;t<n.inChannels;++t){const e=b[a+t*p];for(let t=0;t<n.outChannels;++t)_[r+t*v]+=e*x[l+t];l+=n.outChannels}}}}}}return c.toTensor()}conv3d(t,e,n){const r=n.filterDepth,i=n.filterHeight,s=n.filterWidth,o=n.dilationDepth,a=n.dilationHeight,l=n.dilationWidth,u=n.padInfo.front,c=n.padInfo.left,h=n.padInfo.top,d=Sr(n.outShape,t.dtype),f=this.readSync(t.dataId),p=this.readSync(e.dataId),m=d.values;for(let g=0;g<n.batchSize;++g){const y=g*t.strides[0],v=g*d.strides[0];for(let g=0;g<n.outDepth;++g){const b=v+g*d.strides[1],x=g*n.strideDepth-u;for(let u=0;u<r;u++){const r=x+u*o;if(r<0||r>=n.inDepth)continue;const g=u*e.strides[0],v=y+r*t.strides[1];for(let o=0;o<n.outHeight;++o){const r=b+o*d.strides[2],u=o*n.strideHeight-h;for(let o=0;o<i;o++){const i=u+o*a;if(i<0||i>=n.inHeight)continue;const h=g+o*e.strides[1],d=v+i*t.strides[2];for(let t=0;t<n.outWidth;++t){const i=r+t*n.outChannels,o=t*n.strideWidth-c;for(let t=0;t<s;t++){const r=o+t*l;if(r<0||r>=n.inWidth)continue;const s=d+r*n.inChannels;let a=h+t*e.strides[2];for(let t=0;t<n.inChannels;++t){const e=f[s+t];for(let t=0;t<n.outChannels;++t)m[i+t]+=e*p[a+t];a+=n.outChannels}}}}}}}}return d.toTensor()}conv2dDerInput(t,e,n){Wx([t,e],"conv2dDerInput");const r=Sr(n.inShape,"float32"),i=r.values,s=this.readSync(t.dataId),o=this.readSync(e.dataId),[a,l,u]=e.strides,{batchSize:c,filterHeight:h,filterWidth:d,inChannels:f,inHeight:p,inWidth:m,outChannels:g,outHeight:y,outWidth:v,strideHeight:b,strideWidth:x,dataFormat:_}=n,w=h-1-n.padInfo.top,S=d-1-n.padInfo.left,C="channelsLast"===_,E=r.strides[0],k=C?r.strides[1]:r.strides[2],A=C?r.strides[2]:1,D=C?1:r.strides[1],N=t.strides[0],T=C?t.strides[1]:t.strides[2],O=C?t.strides[2]:1,I=C?1:t.strides[1];for(let R=0;R<c;++R)for(let t=0;t<f;++t)for(let e=0;e<p;++e){const n=e-w,r=Math.max(0,Math.ceil(n/b)),c=Math.min(y,(h+n)/b);for(let f=0;f<m;++f){const p=f-S,m=Math.max(0,Math.ceil(p/x)),y=Math.min(v,(d+p)/x);let _=0;for(let e=r;e<c;++e){const r=e*b-n;for(let n=m;n<y;++n){const i=N*R+T*e+O*n,c=a*(h-1-r)+l*(d-1-(n*x-p))+u*t;for(let t=0;t<g;++t)_+=s[i+I*t]*o[c+t]}}i[E*R+k*e+A*f+D*t]=_}}return r.toTensor()}conv3dDerInput(t,e,n){const r=Sr(n.inShape,"float32"),i=r.values,[s,o,a,l]=r.strides,u=this.readSync(t.dataId),[c,h,d,f]=t.strides,p=this.readSync(e.dataId),[m,g,y,v]=e.strides,{batchSize:b,filterDepth:x,filterHeight:_,filterWidth:w,inChannels:S,inDepth:C,inHeight:E,inWidth:k,outChannels:A,outDepth:D,outHeight:N,outWidth:T,strideDepth:O,strideHeight:I,strideWidth:R}=n,F=x-1-n.padInfo.front,M=_-1-n.padInfo.top,$=w-1-n.padInfo.left;for(let P=0;P<b;++P)for(let t=0;t<S;++t)for(let e=0;e<C;++e){const n=e-F,r=Math.max(0,Math.ceil(n/O)),b=Math.min(D,(x+n)/O);for(let S=0;S<E;++S){const C=S-M,E=Math.max(0,Math.ceil(C/I)),D=Math.min(N,(_+C)/I);for(let N=0;N<k;++N){const k=N-$,F=Math.max(0,Math.ceil(k/R)),M=Math.min(T,(w+k)/R);let z=0;for(let e=r;e<b;++e){const r=e*O-n;for(let n=E;n<D;++n){const i=n*I-C;for(let s=F;s<M;++s){const o=c*P+h*e+d*n+f*s,a=m*(x-1-r)+g*(_-1-i)+y*(w-1-(s*R-k))+v*t;for(let t=0;t<A;++t)z+=u[o+t]*p[a+t]}}}i[s*P+o*e+a*S+l*N+t]=z}}}return r.toTensor()}conv2dDerFilter(t,e,n){Wx([t,e],"conv2dDerFilter");const r=n.strideHeight,i=n.strideWidth,s=n.filterHeight,o=n.filterWidth,a="channelsLast"===n.dataFormat,l=Sr(n.filterShape,"float32"),u=n.padInfo.left,c=n.padInfo.top,h=this.bufferSync(t),d=this.bufferSync(e);for(let f=0;f<s;++f){const t=Math.max(0,Math.ceil((c-f)/r)),e=Math.min(n.outHeight,(n.inHeight+c-f)/r);for(let s=0;s<o;++s){const o=Math.max(0,Math.ceil((u-s)/i)),p=Math.min(n.outWidth,(n.inWidth+u-s)/i);for(let m=0;m<n.inChannels;++m)for(let g=0;g<n.outChannels;++g){let y=0;for(let l=0;l<n.batchSize;++l)for(let n=t;n<e;++n){const t=f+n*r-c;for(let e=o;e<p;++e){const r=s+e*i-u;y+=a?h.get(l,t,r,m)*d.get(l,n,e,g):h.get(l,m,t,r)*d.get(l,g,n,e)}}l.set(y,f,s,m,g)}}}return l.toTensor()}conv3dDerFilter(t,e,n){const r=n.strideDepth,i=n.strideHeight,s=n.strideWidth,o=n.filterDepth,a=n.filterHeight,l=n.filterWidth,u=Sr(n.filterShape,"float32"),c=u.values,[h,d,f,p]=u.strides,m=this.readSync(e.dataId),[g,y,v,b]=e.strides,x=this.readSync(t.dataId),[_,w,S,C]=t.strides,E=n.padInfo.front,k=n.padInfo.left,A=n.padInfo.top;for(let D=0;D<o;++D){const t=Math.max(0,Math.ceil((E-D)/r)),e=Math.min(n.outDepth,(n.inDepth+E-D)/r),o=D*h;for(let u=0;u<a;++u){const a=Math.max(0,Math.ceil((A-u)/i)),h=Math.min(n.outHeight,(n.inHeight+A-u)/i),N=u*d+o;for(let o=0;o<l;++o){const l=Math.max(0,Math.ceil((k-o)/s)),d=Math.min(n.outWidth,(n.inWidth+k-o)/s),T=o*f+N;for(let f=0;f<n.inChannels;++f){const N=f*p+T;for(let p=0;p<n.outChannels;++p){let T=0;for(let c=0;c<n.batchSize;++c){const n=c*_,N=c*g;for(let c=t;c<e;++c){const t=(D+c*r-E)*w+n,e=c*y+N;for(let n=a;n<h;++n){const r=(u+n*i-A)*S+t,a=n*v+e;for(let t=l;t<d;++t)T+=x[(o+t*s-k)*C+r+f]*m[t*b+a+p]}}}c[N+p]=T}}}}}return u.toTensor()}fusedDepthwiseConv2D({input:t,filter:e,convInfo:n,bias:r,activation:i,preluActivationWeights:s}){let o=this.depthwiseConv2D(t,e,n);return r&&(o=this.add(o,r)),i&&(o=Qx(this,o,i,s)),o}depthwiseConv2D(t,e,n){Wx([t,e],"depthwiseConv2D");const r=n.filterHeight,i=n.filterWidth,s=n.dilationHeight,o=n.dilationWidth,a=n.padInfo.left,l=n.padInfo.top,u=n.outChannels/n.inChannels,c=Sr(n.outShape,t.dtype),h=this.readSync(t.dataId),d=this.readSync(e.dataId),f=c.values;for(let p=0;p<n.batchSize;++p){const m=p*t.strides[0],g=p*c.strides[0];for(let p=0;p<n.outHeight;++p){const y=g+p*c.strides[1],v=p*n.strideHeight-a;for(let a=0;a<r;++a){const r=v+a*s;if(r<0||r>=n.inHeight)continue;const p=a*e.strides[0],g=m+r*t.strides[1];for(let t=0;t<n.outWidth;++t){const r=y+t*c.strides[2],s=t*n.strideWidth-l;for(let t=0;t<i;++t){const i=s+t*o;if(i<0||i>=n.inWidth)continue;const a=g+i*n.inChannels;let l=r,c=p+t*e.strides[1];for(let t=0;t<n.inChannels;++t){const e=h[a+t];for(let t=0;t<u;++t)f[l+t]+=e*d[c+t];l+=u,c+=u}}}}}}return c.toTensor()}depthwiseConv2DDerInput(t,e,n){Wx([t,e],"depthwiseConv2DDerInput");const r=Sr(n.inShape,"float32"),i=r.values,[s,o,a]=r.strides,l=this.readSync(t.dataId),[u,c,h]=t.strides,d=this.readSync(e.dataId),[f,p,m]=e.strides,{batchSize:g,filterHeight:y,filterWidth:v,inChannels:b,inHeight:x,inWidth:_,outChannels:w,outHeight:S,outWidth:C,strideHeight:E,strideWidth:k}=n,A=y-1-n.padInfo.top,D=v-1-n.padInfo.left,N=w/b;for(let T=0;T<g;++T)for(let t=0;t<b;++t)for(let e=0;e<x;++e){const n=e-A,r=Math.max(0,Math.ceil(n/E)),g=Math.min(S,(y+n)/E);for(let b=0;b<_;++b){const x=b-D,_=Math.max(0,Math.ceil(x/k)),w=Math.min(C,(v+x)/k);let S=0;for(let e=r;e<g;++e){const r=e*E-n;for(let n=_;n<w;++n){const i=u*T+c*e+h*n,s=f*(y-1-r)+p*(v-1-(n*k-x))+m*t;for(let e=0;e<N;++e)S+=l[i+(t*N+e)]*d[s+e]}}i[s*T+o*e+a*b+t]=S}}return r.toTensor()}depthwiseConv2DDerFilter(t,e,n){Wx([t,e],"depthwiseConv2DDerFilter");const r=n.strideHeight,i=n.strideWidth,s=n.filterHeight,o=n.filterWidth,a=Sr(n.filterShape,"float32"),l=n.padInfo.left,u=n.padInfo.top,c=n.outChannels/n.inChannels,h=this.bufferSync(t),d=this.bufferSync(e);for(let f=0;f<s;++f){const t=Math.max(0,Math.ceil((u-f)/r)),e=Math.min(n.outHeight,(n.inHeight+u-f)/r);for(let s=0;s<o;++s){const o=Math.max(0,Math.ceil((l-s)/i)),p=Math.min(n.outWidth,(n.inWidth+l-s)/i);for(let m=0;m<n.outChannels;++m){const g=Math.trunc(m/c),y=m%c;let v=0;for(let a=0;a<n.batchSize;++a)for(let n=t;n<e;++n){const t=f+n*r-u;for(let e=o;e<p;++e)v+=h.get(a,t,s+e*i-l,g)*d.get(a,n,e,m)}a.set(v,f,s,g,y)}}}return a.toTensor()}tile(t,e){return Wx(t,"tile"),Kx(this.bufferSync(t),e)}pad(t,e,n){Wx(t,"pad");const r=e.map((e,n)=>e[0]+t.shape[n]+e[1]),i=e.map(t=>t[0]),s=this.bufferSync(t),o=Sr(r,t.dtype);0!==n&&o.values.fill(n);for(let a=0;a<t.size;a++){const t=s.indexToLoc(a),e=t.map((t,e)=>t+i[e]);o.set(s.get(...t),...e)}return o.toTensor()}gather(t,e,n){Wx([t,e],"gather");const r=t.shape.slice(),i=this.readSync(e.dataId);r[n]=i.length;const s=Sr(r,t.dtype),o=this.bufferSync(t);for(let a=0;a<s.size;++a){const t=s.indexToLoc(a),e=t.slice();e[n]=i[t[n]];const r=o.locToIndex(e);s.values[a]=o.values[r]}return s.toTensor()}batchToSpaceND(t,e,n){Wx([t],"batchToSpaceND");const r=e.reduce((t,e)=>t*e),i=y.getReshaped(t.shape,e,r),s=y.getPermuted(i.length,e.length),o=y.getReshapedPermuted(t.shape,e,r),a=y.getSliceBeginCoords(n,e.length),l=y.getSliceSize(o,n,e.length);return Xe(t.reshape(i),s).reshape(o).slice(a,l)}spaceToBatchND(t,e,n){Wx([t],"spaceToBatchND");const r=e.reduce((t,e)=>t*e),i=[[0,0]];i.push(...n);for(let c=1+e.length;c<t.shape.length;++c)i.push([0,0]);const s=t.pad(i),o=y.getReshaped(s.shape,e,r,!1),a=y.getPermuted(o.length,e.length,!1),l=y.getReshapedPermuted(s.shape,e,r,!1),u=Xe(s.reshape(o),a);return Ke(u,l)}maxPool(t,e){return Wx(t,"maxPool"),qx(this.readSync(t.dataId),0,t.dtype,t.strides,e,"max").toTensor()}maxPoolBackprop(t,e,n,r){Wx([e,n],"maxPoolBackprop");const i=this.readSync(e.dataId),s=Sr(r.outShape,e.dtype,Hx(i,e.shape,e.dtype,r).values),o=r.strideHeight,a=r.strideWidth,l=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,h=r.effectiveFilterWidth,d=h-1-r.padInfo.left,f=c-1-r.padInfo.top,p=Sr(e.shape,"float32"),m=this.bufferSync(t);for(let g=0;g<r.batchSize;++g)for(let t=0;t<r.inChannels;++t)for(let e=0;e<r.inHeight;++e)for(let n=0;n<r.inWidth;++n){const i=e-f,y=n-d;let v=0;for(let e=0;e<c;e+=l){const n=(i+e)/o;if(!(n<0||n>=r.outHeight||Math.floor(n)!==n))for(let i=0;i<h;i+=u){const o=(y+i)/a;if(o<0||o>=r.outWidth||Math.floor(o)!==o)continue;const l=c*h-1-s.get(g,n,o,t)===e*h+i?1:0;0!==l&&(v+=m.get(g,n,o,t)*l)}}p.set(v,g,e,n,t)}return p.toTensor()}avgPoolBackprop(t,e,n){Wx([t,e],"avgPoolBackprop");const r=n.strideHeight,i=n.strideWidth,s=n.filterHeight,o=n.filterWidth,a=n.dilationHeight,l=n.dilationWidth,u=n.effectiveFilterHeight,c=n.effectiveFilterWidth,h=c-1-n.padInfo.left,d=u-1-n.padInfo.top,f=Sr(e.shape,"float32"),p=1/(s*o),m=this.bufferSync(t);for(let g=0;g<n.batchSize;++g)for(let t=0;t<n.inChannels;++t)for(let e=0;e<n.inHeight;++e)for(let s=0;s<n.inWidth;++s){const o=e-d,y=s-h;let v=0;for(let e=0;e<u;e+=a){const s=(o+e)/r;if(!(s<0||s>=n.outHeight||Math.floor(s)!==s))for(let e=0;e<c;e+=l){const r=(y+e)/i;r<0||r>=n.outWidth||Math.floor(r)!==r||(v+=m.get(g,s,r,t))}}f.set(v*p,g,e,s,t)}return f.toTensor()}pool3d(t,e,n){Wx(t,"pool3d");const r=e.strideDepth,i=e.strideHeight,s=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,u=e.effectiveFilterDepth,c=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=e.padInfo.front,f=e.padInfo.top,p=e.padInfo.left,m="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=this.readSync(t.dataId),y=Sr(e.outShape,t.dtype),v=y.values,b=e.outShape[1]*e.outShape[2]*e.outShape[3]*e.outShape[4],x=e.outShape[2]*e.outShape[3]*e.outShape[4],_=e.outShape[3]*e.outShape[4],w=e.outShape[4];for(let S=0;S<e.batchSize;++S){const y=S*b,C=S*t.strides[0];for(let b=0;b<e.inChannels;++b)for(let S=0;S<e.outDepth;++S){const E=S*r-d;let k=E;for(;k<0;)k+=o;const A=Math.min(e.inDepth,u+E),D=y+S*x;for(let r=0;r<e.outHeight;++r){const u=r*i-f;let d=u;for(;d<0;)d+=a;const y=Math.min(e.inHeight,c+u),x=D+r*_;for(let r=0;r<e.outWidth;++r){const i=r*s-p;let u=i;for(;u<0;)u+=l;const c=Math.min(e.inWidth,h+i),f=x+r*w;let _=m,S=0,E=0;for(let e=k;e<A;e+=o){const r=C+e*t.strides[1];for(let e=d;e<y;e+=a){const i=r+e*t.strides[2];for(let e=u;e<c;e+=l){const r=g[i+e*t.strides[3]+b];if("max"===n&&r>_?_=r:"avg"===n&&(S+=r,E++),isNaN(_))break}if(isNaN(_))break}if(isNaN(_))break}v[f+b]="avg"===n?S/E:_}}}}return y.toTensor()}avgPool3d(t,e){return Wx(t,"avgPool3d"),this.pool3d(t,e,"avg").toFloat()}avgPool3dBackprop(t,e,n){Wx([t,e],"avgPool3dBackprop");const r=n.strideDepth,i=n.strideHeight,s=n.strideWidth,o=n.filterDepth,a=n.filterHeight,l=n.filterWidth,u=n.dilationDepth,c=n.dilationHeight,h=n.dilationWidth,d=n.effectiveFilterDepth,f=n.effectiveFilterHeight,p=n.effectiveFilterWidth,m=d-1-n.padInfo.front,g=p-1-n.padInfo.left,y=f-1-n.padInfo.top,v=Sr(e.shape,"float32"),b=1/(o*a*l),x=this.bufferSync(t);for(let _=0;_<n.batchSize;++_)for(let t=0;t<n.inChannels;++t)for(let e=0;e<n.inDepth;++e)for(let o=0;o<n.inHeight;++o)for(let a=0;a<n.inWidth;++a){const l=e-m,w=o-y,S=a-g;let C=0;for(let e=0;e<d;e+=u){const o=(l+e)/r;if(!(o<0||o>=n.outDepth||Math.floor(o)!==o))for(let e=0;e<f;e+=c){const r=(w+e)/i;if(!(r<0||r>=n.outHeight||Math.floor(r)!==r))for(let e=0;e<p;e+=h){const i=(S+e)/s;i<0||i>=n.outWidth||Math.floor(i)!==i||(C+=x.get(_,o,r,i,t))}}}v.set(C*b,_,e,o,a,t)}return v.toTensor()}maxPool3d(t,e){return Wx(t,"maxPool3d"),this.pool3d(t,e,"max").toFloat()}maxPool3dPositions(t,e){const n=Sr(e.outShape,"int32"),r=e.strideDepth,i=e.strideHeight,s=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,u=e.effectiveFilterDepth,c=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=e.padInfo.front,f=e.padInfo.top,p=e.padInfo.left,m=this.bufferSync(t);for(let g=0;g<e.batchSize;++g)for(let t=0;t<e.inChannels;++t)for(let y=0;y<e.outDepth;++y){const v=y*r-d;let b=v;for(;b<0;)b+=o;const x=Math.min(e.inDepth,u+v);for(let r=0;r<e.outHeight;++r){const u=r*i-f;let d=u;for(;d<0;)d+=a;const _=Math.min(e.inHeight,c+u);for(let i=0;i<e.outWidth;++i){const f=i*s-p;let w=f;for(;w<0;)w+=l;const S=Math.min(e.inWidth,h+f);let C=Number.NEGATIVE_INFINITY,E=-1;for(let e=b;e<x;e+=o){const n=e-v;for(let r=d;r<_;r+=a){const i=r-u;for(let s=w;s<S;s+=l){const o=s-f,a=m.get(g,e,r,s,t);a>=C&&(C=a,E=n*c*h+i*c+o)}}}n.set(E,g,y,r,i,t)}}}return n.toTensor()}maxPool3dBackprop(t,e,n,r){Wx([e,n],"maxPool3dBackprop");const i=this.maxPool3dPositions(e,r),s=r.strideDepth,o=r.strideHeight,a=r.strideWidth,l=r.dilationDepth,u=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterDepth,d=r.effectiveFilterHeight,f=r.effectiveFilterWidth,p=h-1-r.padInfo.front,m=f-1-r.padInfo.left,g=d-1-r.padInfo.top,y=Sr(e.shape,"float32"),v=this.bufferSync(i),b=this.bufferSync(t);for(let x=0;x<r.batchSize;++x)for(let t=0;t<r.inChannels;++t)for(let e=0;e<r.inDepth;++e)for(let n=0;n<r.inHeight;++n)for(let i=0;i<r.inWidth;++i){const _=e-p,w=n-g,S=i-m;let C=0;for(let e=0;e<h;e+=l){const n=(_+e)/s;if(!(n<0||n>=r.outDepth||Math.floor(n)!==n))for(let i=0;i<d;i+=u){const s=(w+i)/o;if(!(s<0||s>=r.outHeight||Math.floor(s)!==s))for(let o=0;o<f;o+=c){const l=(S+o)/a;if(l<0||l>=r.outWidth||Math.floor(l)!==l)continue;const u=h*d*f-1-v.get(x,n,s,l,t)===e*d*f+i*f+o?1:0;0!==u&&(C+=b.get(x,n,s,l,t)*u)}}}y.set(C,x,e,n,i,t)}return y.toTensor()}cast(t,e){return y.castTensor(t,e,this)}reshape(t,e){return y.reshapeTensor(t,e)}avgPool(t,e){return Wx(t,"avgPool"),Wx(t,"maxPool"),qx(this.readSync(t.dataId),0,t.dtype,t.strides,e,"avg").toTensor().toFloat()}resizeBilinear(t,e,n,i){Wx(t,"resizeBilinear");const[s,o,a,l]=t.shape,u=this.readSync(t.dataId),c=new Float32Array(r.sizeFromShape([s,e,n,l])),h=[i&&e>1?o-1:o,i&&n>1?a-1:a],d=[i&&e>1?e-1:e,i&&n>1?n-1:n];let f=0;const p=h[0]/d[0],m=h[1]/d[1];for(let r=0;r<s;r++)for(let i=0;i<e;i++){const e=p*i,s=Math.floor(e),h=e-s,d=Math.min(o-1,Math.ceil(e)),g=r*t.strides[0]+s*t.strides[1],y=r*t.strides[0]+d*t.strides[1];for(let r=0;r<n;r++){const e=m*r,n=Math.floor(e),i=e-n,s=Math.min(a-1,Math.ceil(e)),o=g+n*t.strides[2],d=y+n*t.strides[2],p=g+s*t.strides[2],v=y+s*t.strides[2];for(let t=0;t<l;t++){const e=u[o+t],n=u[d+t],r=e+(u[p+t]-e)*i;c[f++]=r+(n+(u[v+t]-n)*i-r)*h}}}return Gn(c,[s,e,n,l])}resizeBilinearBackprop(t,e,n){Wx([t,e],"resizeBilinearBackprop");const[r,i,s,o]=e.shape,[,a,l]=t.shape,u=new Float32Array(r*i*s*o),c=[n&&a>1?i-1:i,n&&l>1?s-1:s],h=[n&&a>1?a-1:a,n&&l>1?l-1:l],d=c[0]/h[0],f=c[1]/h[1],p=this.readSync(t.dataId);let m=0;for(let g=0;g<r;g++){const t=g*e.strides[0];for(let n=0;n<a;n++){const r=n*d,a=Math.floor(r),c=Math.min(Math.ceil(r),i-1),h=t+a*e.strides[1],g=t+c*e.strides[1],y=r-a,v=1-y;for(let t=0;t<l;t++){const n=t*f,r=Math.floor(n),i=Math.min(Math.ceil(n),s-1),a=n-r,l=1-a,c=h+r*e.strides[2],d=h+i*e.strides[2],b=g+r*e.strides[2],x=g+i*e.strides[2],_=v*l,w=v*a,S=y*l,C=y*a;for(let t=0;t<o;t++){const e=p[m++];u[c+t]+=e*_,u[d+t]+=e*w,u[b+t]+=e*S,u[x+t]+=e*C}}}}return Do(u,[r,s,i,o],e.dtype)}resizeNearestNeighbor(t,e,n,r){Wx(t,"resizeNearestNeighbor");const[i,s,o,a]=t.shape,l=this.readSync(t.dataId),u=new Float32Array(i*e*n*a),c=[r&&e>1?s-1:s,r&&n>1?o-1:o],h=[r&&e>1?e-1:e,r&&n>1?n-1:n],d=c[0]/h[0],f=c[1]/h[1];let p=0;for(let m=0;m<i;m++){const i=m*t.strides[0];for(let c=0;c<e;c++){const e=d*c,h=i+Math.min(s-1,r?Math.round(e):Math.floor(e))*t.strides[1];for(let i=0;i<n;i++){const e=f*i,n=h+Math.min(o-1,r?Math.round(e):Math.floor(e))*t.strides[2];for(let t=0;t<a;t++)u[p++]=l[n+t]}}}return Gn(u,[i,e,n,a],t.dtype)}resizeNearestNeighborBackprop(t,e,n){Wx([t,e],"resizeNearestNeighborBackprop");const[r,i,s,o]=e.shape,[,a,l]=t.shape,u=new Float32Array(r*i*s*o),c=this.readSync(t.dataId),h=[n&&a>1?i-1:i,n&&l>1?s-1:s],d=[n&&a>1?a-1:a,n&&l>1?l-1:l],f=h[0]/d[0],p=h[1]/d[1],m=1/f,g=1/p,y=2*Math.ceil(m)+2,v=2*Math.ceil(g)+2;for(let b=0;b<r;b++){const r=b*e.strides[0];for(let h=0;h<i;h++){const d=r+h*e.strides[1],b=Math.floor(h*m),x=Math.floor(b-y/2);for(let m=0;m<s;m++){const b=d+m*e.strides[2],_=Math.floor(m*g),w=Math.floor(_-v/2);for(let e=0;e<o;e++){let o=0;for(let u=0;u<y;u++){const d=u+x;if(d<0||d>=a)continue;const g=r+d*t.strides[1],y=d*f;if(h===Math.min(i-1,n?Math.round(y):Math.floor(y)))for(let r=0;r<v;r++){const i=r+w;if(i<0||i>=l)continue;const a=g+i*t.strides[2],u=i*p;m===Math.min(s-1,n?Math.round(u):Math.floor(u))&&(o+=c[a+e])}}u[b+e]=o}}}}return Do(u,e.shape,e.dtype)}batchNorm(t,e,n,r,i,s){Wx([t,e,n,i,r],"batchNorm");const o=this.readSync(t.dataId),a=this.readSync(e.dataId),l=this.readSync(n.dataId),u=i?this.readSync(i.dataId):new Float32Array([1]),c=r?this.readSync(r.dataId):new Float32Array([0]),h=new Float32Array(o.length),d=c.length,f=u.length,p=l.length,m=a.length;let g=0,y=0,v=0,b=0;for(let x=0;x<o.length;++x)h[x]=c[g++]+(o[x]-a[y++])*u[v++]/Math.sqrt(l[b++]+s),g>=d&&(g=0),y>=m&&(y=0),v>=f&&(v=0),b>=p&&(b=0);return Do(h,t.shape)}localResponseNormalization4D(t,e,n,r,i){Wx(t,"localResponseNormalization4D");const s=t.shape[3],o=s-1,a=this.readSync(t.dataId),l=t.size,u=new Float32Array(l);function c(t){const n=t%s;let r=t-n+Math.max(0,n-e);const i=t-n+Math.min(n+e,o);let l=0;for(;r<=i;r++){const t=a[r];l+=t*t}return l}for(let h=0;h<l;h++){const t=c(h),e=a[h]*Math.pow(n+r*t,-i);u[h]=e}return Do(u,t.shape)}LRNGrad(t,e,n,r,i,s,o){Wx(t,"LRNGrad");const a=t.shape[3],l=this.readSync(t.dataId),u=this.readSync(e.dataId),c=this.readSync(n.dataId),h=new Float32Array(t.size),d=t.size;for(let f=0;f<d;f++){const t=f%a,e=f-t+Math.max(0,t-r),n=f-t+Math.min(a,t+r+1);let d=0;for(let r=e;r<n;r++)d+=Math.pow(u[r],2);d=s*d+i;for(let r=e;r<n;r++){let t=-2*s*o*u[r]*c[f]/d;f===r&&(t+=Math.pow(d,-o)),t*=l[f],h[r]+=t}}return Do(h,t.shape)}multinomial(t,e,n,r){Wx(t,"multinomial");const i=e?t:vo(t),s=i.shape[0],o=i.shape[1],a=is([s,n],"int32"),l=this.readSync(a.dataId),u=this.readSync(i.dataId);for(let c=0;c<s;++c){const t=c*o,e=new Float32Array(o-1);e[0]=u[t];for(let n=1;n<e.length;++n)e[n]=e[n-1]+u[t+n];const i=Ts.alea(r.toString()),s=c*n;for(let r=0;r<n;++r){const t=i();l[s+r]=e.length;for(let n=0;n<e.length;n++)if(t<e[n]){l[s+r]=n;break}}}return a}oneHot(t,e,n,r){Wx(t,"oneHot");const i=new Float32Array(t.size*e);i.fill(r);const s=this.readSync(t.dataId);for(let o=0;o<t.size;++o)s[o]>=0&&s[o]<e&&(i[o*e+s[o]]=n);return ko(i,[t.size,e],"int32")}nonMaxSuppression(t,e,n,r,i){Wx(t,"nonMaxSuppression");const s=this.readSync(t.dataId),o=this.readSync(e.dataId);return Gx(s,o,n,r,i)}fft(t){return this.fftBatch(t,!1)}ifft(t){return this.fftBatch(t,!0)}fftBatch(t,e){const n=t.shape[0],r=t.shape[1],i=Sr(t.shape,"float32"),s=Sr(t.shape,"float32"),o=_i(t).as2D(n,r),a=xi(t).as2D(n,r);for(let l=0;l<n;l++){const t=o.slice([l,0],[1,r]),n=a.slice([l,0],[1,r]),u=kr(t,n),c=this.readSync(this.fftImpl(u,e).dataId);for(let e=0;e<r;e++){const t=y.getComplexWithIndex(c,e);i.values[l*r+e]=t.real,s.values[l*r+e]=t.imag}}return kr(i.toTensor(),s.toTensor()).as2D(n,r)}fftImpl(t,e){const n=t.as1D(),r=n.size;if(this.isExponentOf2(r)){let i=this.fftRadix2(n,r,e).as2D(t.shape[0],t.shape[1]);return e&&(i=kr(_i(i).div(Si(r)),xi(i).div(Si(r)))),i}{const n=this.readSync(t.dataId),i=this.fourierTransformByMatmul(n,r,e),s=y.splitRealAndImagArrays(i);return kr(s.real,s.imag).as2D(t.shape[0],t.shape[1])}}isExponentOf2(t){return 0==(t&t-1)}fftRadix2(t,e,n){if(1===e)return t;const r=this.readSync(t.dataId),i=e/2,s=y.complexWithEvenIndex(r);let o=kr(s.real,s.imag).as1D();const a=y.complexWithOddIndex(r);let l=kr(a.real,a.imag).as1D();o=this.fftRadix2(o,i,n),l=this.fftRadix2(l,i,n);const u=y.exponents(e,n),c=kr(u.real,u.imag).mul(l),h=o.add(c),d=o.sub(c),f=_i(h).concat(_i(d)),p=xi(h).concat(xi(d));return kr(f,p).as1D()}fourierTransformByMatmul(t,e,n){const r=new Float32Array(2*e);for(let i=0;i<e;i++){let s=0,o=0;for(let r=0;r<e;r++){const a=y.exponent(i*r,e,n),l=y.getComplexWithIndex(t,r);s+=l.real*a.real-l.imag*a.imag,o+=l.real*a.imag+l.imag*a.real}n&&(s/=e,o/=e),y.assignToTypedArray(r,s,o,i)}return r}depthToSpace(t,e,n){r.assert("NHWC"===n,()=>"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n),r.assert(e>1,()=>"blockSize should be > 1 for depthToSpace, but was: "+e);const i=t.shape[0],s=t.shape[1],o=t.shape[2],a=t.shape[3],l=s*e,u=o*e,c=a/(e*e),h=this.readSync(t.dataId),d=new Float32Array(i*l*u*c);let f=0;for(let r=0;r<i;++r)for(let t=0;t<l;++t){const n=Math.floor(t/e),i=t%e;for(let t=0;t<u;++t){const l=Math.floor(t/e),u=(i*e+t%e)*c;for(let t=0;t<c;++t)d[f++]=h[t+u+a*(l+o*(n+s*r))]}}return Do(d,[i,l,u,c])}broadcastedBinaryOp(t,e,n,r){const i=y.assertAndGetBroadcastShape(t.shape,e.shape),s=Sr(i,n),o=this.readSync(t.dataId),a=this.readSync(e.dataId),l=y.getBroadcastDims(t.shape,i),u=y.getBroadcastDims(e.shape,i),c=s.values;if(l.length+u.length===0)for(let h=0;h<c.length;++h)c[h]=r(o[h%o.length],a[h%a.length]);else{const n=this.bufferSync(t),i=this.bufferSync(e);for(let h=0;h<c.length;++h){const d=s.indexToLoc(h),f=d.slice(-t.rank);l.forEach(t=>f[t]=0);const p=n.locToIndex(f),m=d.slice(-e.rank);u.forEach(t=>m[t]=0);const g=i.locToIndex(m);c[h]=r(o[p],a[g])}}return s.toTensor()}broadcastedBinaryComplexOp(t,e,n){const r=y.assertAndGetBroadcastShape(t.shape,e.shape),i=Sr(r,"float32"),s=Sr(r,"float32"),o=this.readSync(t.dataId),a=this.readSync(e.dataId),l=y.getBroadcastDims(t.shape,r),u=y.getBroadcastDims(e.shape,r),c=i.values,h=s.values;if(l.length+u.length===0)for(let d=0;d<c.length;d++){const t=d%o.length,e=d%a.length,r=n(o[2*t],o[2*t+1],a[2*e],a[2*e+1]);c[d]=r.real,h[d]=r.imag}else{const r=this.bufferSync(this.data.get(t.dataId).complexTensors.real),s=this.bufferSync(this.data.get(e.dataId).complexTensors.real);for(let d=0;d<c.length;d++){const f=i.indexToLoc(d),p=f.slice(-t.rank);l.forEach(t=>p[t]=0);const m=r.locToIndex(p),g=f.slice(-e.rank);u.forEach(t=>g[t]=0);const y=s.locToIndex(g),v=n(o[2*m],o[2*m+1],a[2*y],a[2*y+1]);c[d]=v.real,h[d]=v.imag}}return this.complex(i.toTensor(),s.toTensor())}split(t,e,n){return Yx(t,e,n)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}cropAndResize(t,e,n,r,i,s){const[o,a,l,u]=t.shape,c=e.shape[0],[h,d]=r,f=Sr([c,h,d,u],"float32"),p=this.readSync(e.dataId),m=this.readSync(n.dataId),g=this.readSync(t.dataId),y=t.strides,v=f.strides;for(let b=0;b<c;b++){const t=4*b,e=p[t],n=p[t+1],r=p[t+2],c=p[t+3],x=m[b];if(x>=o)continue;const _=h>1?(r-e)*(a-1)/(h-1):0,w=d>1?(c-n)*(l-1)/(d-1):0;for(let o=0;o<h;o++){const t=h>1?e*(a-1)+o*_:.5*(e+r)*(a-1);if(t<0||t>a-1)for(let e=0;e<d;e++)for(let t=0;t<u;t++)f.values[t+e*v[2]+o*v[1]+b*v[0]]=s;else if("bilinear"===i){const e=Math.floor(t),r=Math.ceil(t),i=t-e;for(let t=0;t<d;t++){const a=d>1?n*(l-1)+t*w:.5*(n+c)*(l-1);if(a<0||a>l-1){for(let e=0;e<u;e++)f.values[e+t*v[2]+o*v[1]+b*v[0]]=s;continue}const h=Math.floor(a),p=Math.ceil(a),m=a-h;for(let n=0;n<u;n++){let s=n+h*y[2]+e*y[1]+x*y[0];const a=g[s];s=n+p*y[2]+e*y[1]+x*y[0];const l=g[s];s=n+h*y[2]+r*y[1]+x*y[0];const u=g[s];s=n+p*y[2]+r*y[1]+x*y[0];const c=g[s],d=a+(l-a)*m;s=n+t*v[2]+o*v[1]+b*v[0],f.values[s]=d+(u+(c-u)*m-d)*i}}}else for(let e=0;e<d;++e){const r=d>1?n*(l-1)+e*w:.5*(n+c)*(l-1);if(r<0||r>l-1){for(let t=0;t<u;t++)f.values[t+e*v[2]+o*v[1]+b*v[0]]=s;continue}const i=Math.round(r),a=Math.round(t);for(let t=0;t<u;t++)f.values[t+e*v[2]+o*v[1]+b*v[0]]=g[t+i*y[2]+a*y[1]+x*y[0]]}}}return f.toTensor()}sparseToDense(t,e,n,r){const{sliceRank:i,numUpdates:s,sliceSize:o,strides:a,outputSize:l}=y.calculateShapes(e,t,n);return this.scatter(t,e,n,l,o,s,i,a,r,!1)}gatherND(t,e){const n=e.shape,r=n[n.length-1],[i,s,o,a]=y.prepareAndValidate(t,e);if(0===s)return Gn([],i,t.dtype);const l=new se([s,o],t.dtype),u=this.readSync(e.dataId),c=this.readSync(t.dataId);for(let h=0;h<s;h++){const e=[];let n=0;for(let t=0;t<r;t++){const i=u[h*r+t];n+=i*a[t],e.push(i)}if(n<0||n>=t.size/o)throw new Error(`Invalid indices: ${e} does not index into ${t.shape}`);for(let t=0;t<o;t++)l.values[h*o+t]=c[n*o+t]}return l.toTensor().reshape(i)}scatterND(t,e,n){const{sliceRank:r,numUpdates:i,sliceSize:s,strides:o,outputSize:a}=y.calculateShapes(e,t,n),l=Si(0);return this.scatter(t,e,n,a,s,i,r,o,l,!0)}fill(t,e,n){n=n||r.inferDtype(e);const i=r.getArrayFromDType(n,r.sizeFromShape(t));return i.fill(e),An().makeTensor(i,t,n,this)}onesLike(t){if("string"===t.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)}zerosLike(t){const e=r.getArrayFromDType(t.dtype,r.sizeFromShape(t.shape));return this.makeOutput(e,t.shape,t.dtype)}linspace(t,e,n){return y.linspaceImpl(t,e,n)}scatter(t,e,n,r,i,s,o,a,l,u){const c=[r/i,i],h=this.readSync(t.dataId),d=this.readSync(e.dataId);if(0===r)return Gn([],n,e.dtype);const f=new se(c,e.dtype);f.values.fill(this.readSync(l.dataId)[0]);for(let p=0;p<s;p++){const t=[];let s=0;for(let e=0;e<o;e++){const n=h[p*o+e];t.push(n),s+=n*a[e]}if(s<0||s>=r/i)throw new Error(`Invalid indices: ${t} does not index into ${n}`);for(let n=0;n<i;n++)u?f.values[s*i+n]+=d[p*i+n]:f.values[s*i+n]=0===e.rank?d[0]:d[p*i+n]}return f.toTensor().reshape(n)}}Bn("cpu",()=>new Jx,1);const t_={kernelName:"Dilation2D",backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:i,filter:s}=t,{strides:o,pad:a,dilations:l}=n,u=e,c=r.toNestedArray(i.shape,u.data.get(i.dataId).values),h=r.toNestedArray(s.shape,u.data.get(s.dataId).values),{batchSize:d,inHeight:f,inWidth:p,inChannels:m,outHeight:g,outWidth:v,padInfo:b,strideHeight:x,strideWidth:_,filterHeight:w,filterWidth:S,dilationHeight:C,dilationWidth:E,outShape:k}=y.computeDilation2DInfo(i.shape,s.shape,o,a,"NHWC",l),A=r.makeZerosNestedTypedArray(k,i.dtype);for(let r=0;r<d;++r)for(let t=0;t<g;++t){const e=t*x-b.top;for(let n=0;n<v;++n){const i=n*_-b.left;for(let s=0;s<m;++s){let o=Number.MIN_SAFE_INTEGER;for(let t=0;t<w;++t){const n=e+t*C;if(n>=0&&n<f)for(let e=0;e<S;++e){const a=i+e*E;if(a>=0&&a<p){const i=c[r][n][a][s]+h[t][e][s];i>o&&(o=i)}}}A[r][t][n][s]=o}}}return{dataId:u.write(r.toTypedArray(A,i.dtype),k,i.dtype),shape:k,dtype:i.dtype}}},e_={kernelName:"Dilation2DBackpropFilter",backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:i,filter:s,dy:o}=t,{strides:a,pad:l,dilations:u}=n,c=e,h=r.toNestedArray(i.shape,c.data.get(i.dataId).values),d=r.toNestedArray(s.shape,c.data.get(s.dataId).values),{batchSize:f,inHeight:p,inWidth:m,inChannels:g,outHeight:v,outWidth:b,padInfo:x,strideHeight:_,strideWidth:w,filterHeight:S,filterWidth:C,dilationHeight:E,dilationWidth:k,outShape:A}=y.computeDilation2DInfo(i.shape,s.shape,a,l,"NHWC",u);r.assert(o.rank===A.length,()=>`Error in Dilation2DBackpropFilter, dy must have the same rank as output ${A.length}, but got `+o.rank);const D=r.toNestedArray(A,c.data.get(o.dataId).values),N=r.makeZerosNestedTypedArray(s.shape,s.dtype);for(let r=0;r<f;++r)for(let t=0;t<v;++t){const e=t*_-x.top;for(let n=0;n<b;++n){const i=n*w-x.left;for(let s=0;s<g;++s){let o=Number.MIN_SAFE_INTEGER,a=0,l=0;for(let t=0;t<S;++t){const n=e+t*E;if(n>=0&&n<p)for(let e=0;e<C;++e){const u=i+e*k;if(u>=0&&u<m){const i=h[r][n][u][s]+d[t][e][s];i>o&&(o=i,a=t,l=e)}}}N[a][l][s]+=D[r][t][n][s]}}}return{dataId:c.write(r.toTypedArray(N,i.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}},n_={kernelName:"Dilation2DBackpropInput",backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:i,filter:s,dy:o}=t,{strides:a,pad:l,dilations:u}=n,c=e,h=r.toNestedArray(i.shape,c.data.get(i.dataId).values),d=r.toNestedArray(s.shape,c.data.get(s.dataId).values),{batchSize:f,inHeight:p,inWidth:m,inChannels:g,outHeight:v,outWidth:b,padInfo:x,strideHeight:_,strideWidth:w,filterHeight:S,filterWidth:C,dilationHeight:E,dilationWidth:k,outShape:A}=y.computeDilation2DInfo(i.shape,s.shape,a,l,"NHWC",u);r.assert(o.rank===A.length,()=>`Error in Dilation2DBackpropInput, dy must have the same rank as output ${A.length}, but got `+o.rank);const D=r.toNestedArray(A,c.data.get(o.dataId).values),N=r.makeZerosNestedTypedArray(i.shape,i.dtype);for(let r=0;r<f;++r)for(let t=0;t<v;++t){const e=t*_-x.top;for(let n=0;n<b;++n){const i=n*w-x.left;for(let s=0;s<g;++s){let o=Number.MIN_SAFE_INTEGER,a=e<0?0:e,l=i<0?0:i;for(let t=0;t<S;++t){const n=e+t*E;if(n>=0&&n<p)for(let e=0;e<C;++e){const u=i+e*k;if(u>=0&&u<m){const i=h[r][n][u][s]+d[t][e][s];i>o&&(o=i,a=n,l=u)}}}N[r][a][l][s]+=D[r][t][n][s]}}}return{dataId:c.write(r.toTypedArray(N,i.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}};function r_(t,e){return{kernelName:t,backendName:"cpu",kernelFunc:({inputs:n,backend:r})=>{const{a:i,b:s}=n,o=r;Wx([i,s],t);const a=o.data.get(i.dataId).values,l=o.data.get(s.dataId).values,[u,c]=e(i.shape,s.shape,a,l,i.dtype);return{dataId:o.write(u,c,i.dtype),shape:c,dtype:i.dtype}}}}function i_(t){return(e,n,i,s,o)=>{const a=y.assertAndGetBroadcastShape(e,n),l=a.length,u=r.computeStrides(a),c=r.sizeFromShape(a),h=r.getTypedArrayFromDType(o,c),d=e.length,f=n.length,p=r.computeStrides(e),m=r.computeStrides(n),g=y.getBroadcastDims(e,a),v=y.getBroadcastDims(n,a);if(g.length+v.length===0)for(let r=0;r<h.length;++r)h[r]=t(i[r%i.length],s[r%s.length]);else for(let y=0;y<h.length;++y){const e=r.indexToLoc(y,l,u),n=e.slice(-d);g.forEach(t=>n[t]=0);const o=r.locToIndex(n,d,p),a=e.slice(-f);v.forEach(t=>a[t]=0);const c=r.locToIndex(a,f,m);h[y]=t(i[o],s[c])}return[h,a]}}const s_=r_("Div",i_((t,e)=>t/e));function o_(t,e,n,i){const s=r.getTypedArrayFromDType(i,r.sizeFromShape(n));for(let r=0;r<s.length;++r){const n=r*e;let i=t[n];for(let r=0;r<e;++r){const e=t[n+r];e>i&&(i=e)}s[r]=i}return s}function a_(t,e,n,i,s){const o=e.length,a=r.sizeFromShape(e),l=r.computeStrides(e),u=r.computeStrides(s),c=r.getTypedArrayFromDType(n,r.sizeFromShape(s));for(let h=0;h<a;++h){const e=r.indexToLoc(h,o,l),n=new Array(e.length);for(let t=0;t<n.length;t++)n[t]=e[i[t]];c[r.locToIndex(n,o,u)]=t[h]}return c}const l_=v.nonMaxSuppressionV4Impl,u_=v.nonMaxSuppressionV5Impl,c_=[t_,n_,e_,s_,{kernelName:"FlipLeftRight",backendName:"cpu",kernelFunc:({inputs:t,backend:e})=>{const{image:n}=t,i=e,s=r.getTypedArrayFromDType(n.dtype,r.sizeFromShape(n.shape)),[o,a,l,u]=n.shape,c=i.data.get(n.dataId).values;for(let r=0;r<o;r++){const t=r*l*a*u;for(let e=0;e<a;e++){const n=e*(l*u);for(let r=0;r<l;r++){const i=r*u;for(let a=0;a<u;a++){const h=Math.round(l-[o,e,r,a][2]),d=t+n+i+a;let f=c[d];h>=0&&h<l&&(f=c[t+n+h*u+a]),s[d]=f}}}}return{dataId:i.write(s,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}},{kernelName:"MaxPoolWithArgmax",backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:i}=t,{filterSize:s,strides:o,pad:a,includeBatchInIndex:l}=e,u=n;Wx(i,"MaxPoolWithArgmax");const c=u.data.get(i.dataId).values,h=y.computePool2DInfo(i.shape,s,o,[1,1],a),[d,f]=function(t,e,n,i,s){const o=qx(t,0,n,r.computeStrides(e),s,"max"),a=Hx(t,e,n,s,!0,i);return[o.values,a.values]}(c,i.shape,i.dtype,l,h),p=u.write(d,h.outShape,i.dtype),m=u.write(f,h.outShape,i.dtype);return[{dataId:p,shape:h.outShape,dtype:i.dtype},{dataId:m,shape:h.outShape,dtype:"int32"}]}},{kernelName:"Max",backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:i}=t,{reductionIndices:s,keepDims:o}=e,a=n;let l=i.shape;const u=l.length,c=r.parseAxisParam(s,l);let h=c;const d=y.getAxesPermutation(h,u);let f=a.data.get(i.dataId).values;if(null!=d){const t=new Array(u);for(let e=0;e<t.length;e++)t[e]=l[d[e]];f=a_(f,l,i.dtype,d,t),h=y.getInnerMostAxes(h.length,u),l=t}Wx(i,"max"),y.assertAxesAreInnerMostDims("max",h,u);const[p,m]=y.computeOutAndReduceShapes(l,h),g=o_(f,r.sizeFromShape(m),p,i.dtype),v=a.write(g,p,i.dtype);let b=p;return o&&(b=y.expandShapeToKeepDim(p,c)),{dataId:v,shape:b,dtype:i.dtype}}},{kernelName:"NonMaxSuppressionV4",backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{boxes:r,scores:i}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:a,padToMaxOutputSize:l}=n,u=e;Wx(r,"NonMaxSuppressionPadded");const c=u.data.get(r.dataId).values,h=u.data.get(i.dataId).values,{selectedIndices:d,validOutputs:f}=l_(c,h,s,o,a,l);return[d,f]}},{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{boxes:r,scores:i}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:a,softNmsSigma:l}=n,u=e;Wx(r,"NonMaxSuppressionWithScore");const c=u.data.get(r.dataId).values,h=u.data.get(i.dataId).values,d=s,f=o,p=a,m=l,{selectedIndices:g,selectedScores:y}=u_(c,h,d,f,p,m);return[g,y]}},{kernelName:"RotateWithOffset",backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:i}=t,{radians:s,fillValue:o,center:a}=e,l=n,u=r.getTypedArrayFromDType(i.dtype,r.sizeFromShape(i.shape)),[c,h,d,f]=i.shape,[p,m]=y.getImageCenter(a,h,d),g=Math.sin(s),v=Math.cos(s),b=l.data.get(i.dataId).values;for(let r=0;r<c;r++){const t=r*d*h*f;for(let e=0;e<h;e++){const n=e*(d*f);for(let r=0;r<d;r++){const i=r*f;for(let s=0;s<f;s++){const a=[c,e,r,s],l=a[2],y=a[1];let x=(l-p)*v-(y-m)*g,_=(l-p)*g+(y-m)*v;x=Math.round(x+p),_=Math.round(_+m);let w=o;"number"!=typeof o&&(w=3===s?255:o[s]),x>=0&&x<d&&_>=0&&_<h&&(w=b[t+_*(d*f)+x*f+s]),u[t+n+i+s]=w}}}}return{dataId:l.write(u,i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},{kernelName:"Square",backendName:"cpu",kernelFunc:({inputs:t,backend:e})=>{const{x:n}=t,r=e;Wx(n,"square");const i=r.data.get(n.dataId).values,s=new Float32Array(i.length);for(let o=0;o<i.length;++o){const t=i[o];s[o]=t*t}return{dataId:r.write(s,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}},r_("SquaredDifference",i_((t,e)=>{const n=t-e;return n*n})),{kernelName:"Transpose",backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:r}=t,{perm:i}=e,s=n;Wx(r,"transpose");const o=new Array(r.shape.length);for(let l=0;l<o.length;l++)o[l]=r.shape[i[l]];const a=a_(s.data.get(r.dataId).values,r.shape,r.dtype,i,o);return{dataId:s.write(a,o,r.dtype),shape:o,dtype:r.dtype}}}];for(const $C of c_)tt($C);const h_={},d_={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function f_(t){t in h_||(h_[t]=function(t){if(1!==t&&2!==t)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const e=function(t){if("undefined"!=typeof OffscreenCanvas&&2===t)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(t);return e.addEventListener("webglcontextlost",e=>{e.preventDefault(),delete h_[t]},!1),1===t?e.getContext("webgl",d_)||e.getContext("experimental-webgl",d_):e.getContext("webgl2",d_)}(t));const e=h_[t];return e.isContextLost()?(delete h_[t],f_(t)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),h_[t])}var p_,m_,g_;function y_(t,e){return[e,t]}function v_(t){const e=r.sizeFromShape(t),n=Math.ceil(e/4);return r.sizeToSquarishShape(n)}function b_(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function x_(t,e){const n=t;let r,i,s,o,a,l,u,c,h,d;return 2===W().getNumber("WEBGL_VERSION")?(r=n.R32F,i=n.R16F,s=n.RGBA16F,o=n.RGBA32F,a=n.RED,u=4,c=1,h=n.HALF_FLOAT,d=n.FLOAT):(r=t.RGBA,i=t.RGBA,s=t.RGBA,o=n.RGBA,a=t.RGBA,u=4,c=4,h=null!=e?e.HALF_FLOAT_OES:null,d=t.FLOAT),l=t.RGBA,{internalFormatFloat:r,internalFormatHalfFloat:i,internalFormatPackedHalfFloat:s,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:h,textureTypeFloat:d}}function __(t,e){const n=e();return W().getBool("DEBUG")&&function(t){const e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+function(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}(t,e))}(t),n}function w_(t){return!!(W().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===t||5.96e-8<Math.abs(t)&&Math.abs(t)<65504)}function S_(t,e){return T_(t,()=>t.getExtension(e),'Extension "'+e+'" not supported on this browser.')}!function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"}(p_||(p_={})),function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"}(m_||(m_={})),function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(g_||(g_={}));const C_=/ERROR: [0-9]+:([0-9]+):/g;function E_(t,e){if(__(t,()=>t.validateProgram(e)),!1===t.getProgramParameter(e,t.VALIDATE_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function k_(t,e,n,r,i,s,o){const a=t.getAttribLocation(e,n);return-1!==a&&(__(t,()=>t.bindBuffer(t.ARRAY_BUFFER,r)),__(t,()=>t.vertexAttribPointer(a,i,t.FLOAT,!1,s,o)),__(t,()=>t.enableVertexAttribArray(a)),!0)}function A_(t,e,n){__(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,n)),__(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0))}function D_(t,e){__(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,e)),__(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0))}function N_(t){const e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}(t,e))}function T_(t,e,n){const r=__(t,()=>e());if(null==r)throw new Error(n);return r}function O_(t,e=2){return r.sizeFromShape(t.slice(0,t.length-e))}function I_(t){if(0===t.length)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function R_(t){let e=[1,1,1];return 0===t.length||1===t.length&&1===t[0]||(e=[O_(t),...I_(t)]),e}function F_(t){return t%2==0}function M_(t,e){if(t=t.slice(-2),e=e.slice(-2),r.arraysEqual(t,e))return!0;if(!t.length||!e.length)return!0;if(0===t[0]||0===t[1]||0===e[0]||0===e[1])return!0;if(t.length!==e.length){const n=t.slice(-1)[0],r=e.slice(-1)[0];if(n===r)return!0;if(F_(n)&&F_(r)&&(1===t[0]||1===e[0]))return!0}return t[1]===e[1]&&F_(t[0])&&F_(e[0])}let $_,P_;function z_(t,e){return null!=t.getExtension(e)}function L_(t){try{if(null!=f_(t))return!0}catch(e){return!1}return!1}function B_(t){const e=x_(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);const i=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(r),i}const j_=W();j_.registerFlag("HAS_WEBGL",()=>j_.getNumber("WEBGL_VERSION")>0),j_.registerFlag("WEBGL_VERSION",()=>L_(2)?2:L_(1)?1:0),j_.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1),j_.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>2===j_.get("WEBGL_VERSION")),j_.registerFlag("WEBGL_CPU_FORWARD",()=>!0),j_.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1),j_.registerFlag("WEBGL_PACK",()=>j_.getBool("HAS_WEBGL")),j_.registerFlag("WEBGL_PACK_NORMALIZATION",()=>j_.getBool("WEBGL_PACK")),j_.registerFlag("WEBGL_PACK_CLIP",()=>j_.getBool("WEBGL_PACK")),j_.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>!1),j_.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>j_.getBool("WEBGL_PACK")),j_.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>j_.getBool("WEBGL_PACK")),j_.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>j_.getBool("WEBGL_PACK")),j_.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>j_.getBool("WEBGL_PACK")),j_.registerFlag("WEBGL_PACK_REDUCE",()=>j_.getBool("WEBGL_PACK")),j_.registerFlag("WEBGL_LAZILY_UNPACK",()=>j_.getBool("WEBGL_PACK")),j_.registerFlag("WEBGL_CONV_IM2COL",()=>j_.getBool("WEBGL_PACK")),j_.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>function(t){if(null==$_){const e=f_(t);$_=e.getParameter(e.MAX_TEXTURE_SIZE)}return $_}(j_.getNumber("WEBGL_VERSION"))),j_.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>function(t){if(null==P_){const e=f_(t);P_=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,P_)}(j_.getNumber("WEBGL_VERSION"))),j_.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const t=j_.getNumber("WEBGL_VERSION");return 0===t?0:function(t){if(0===t)return 0;let e;const n=f_(t);return e=z_(n,"EXT_disjoint_timer_query_webgl2")&&2===t?2:z_(n,"EXT_disjoint_timer_query")?1:0,e}(t)}),j_.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>j_.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!s.isMobile()),j_.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>function(t){if(0===t)return!1;const e=f_(t);if(1===t){if(!z_(e,"OES_texture_float"))return!1}else if(!z_(e,"EXT_color_buffer_float"))return!1;return B_(e)}(j_.getNumber("WEBGL_VERSION"))),j_.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>!j_.getBool("WEBGL_FORCE_F16_TEXTURES")&&j_.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")),j_.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>function(t){if(0===t)return!1;const e=f_(t);if(1!==t){if(z_(e,"EXT_color_buffer_float"))return B_(e);const t="EXT_color_buffer_half_float";if(z_(e,t)){const n=e.getExtension(t);return function(t,e){const n=x_(t,e),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);const s=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(r),t.deleteFramebuffer(i),s}(e,n)}return!1}return!!z_(e,"OES_texture_float")&&!!z_(e,"WEBGL_color_buffer_float")&&B_(e)}(j_.getNumber("WEBGL_VERSION"))),j_.registerFlag("WEBGL_FENCE_API_ENABLED",()=>{return 2===(t=j_.getNumber("WEBGL_VERSION"))&&null!=f_(t).fenceSync;var t}),j_.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>j_.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0),j_.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,t=>{if(t<0&&-1!==t)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)});class U_{constructor(t,e){this.outputShape=[],this.outputShape=t,this.variableNames=e.map((t,e)=>"T"+e);const n=[];this.variableNames.forEach(t=>{n.push(`float v${t} = get${t}AtOutCoords();`)});const r=this.variableNames.map(t=>"v"+t).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        float result = ${r};\n        setOutput(result);\n      }\n    `}}class V_{constructor(t,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=e.map((t,e)=>"T"+e);const n=[];this.variableNames.forEach(t=>{n.push(`vec4 v${t} = get${t}AtOutCoords();`)});const r=this.variableNames.map(t=>"v"+t).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        vec4 result = ${r};\n        setOutput(result);\n      }\n    `}}class W_{constructor(t,e,n){this.variableNames=["A"];const r=t.windowSize,i=t.batchSize,s=Math.ceil(t.inSize/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,s],this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${r};\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ${r}; i++) {\n          int inIdx = ${n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));"};\n          float candidate = getA(batch, inIdx);\n          if (candidate ${"max"===e?">":"<"} bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    `}}function q_(t,e){return["x","y","z","w","u","v"].slice(0,e).map(e=>`${t}.${e}`)}function H_(t,e){return 1===e?[t]:q_(t,e)}function G_(){let t,e,n,r,i,s,o,a,l,u;return 2===W().getNumber("WEBGL_VERSION")?(t="#version 300 es",e="in",n="out",r="in",i="texture",s="outputColor",o="out vec4 outputColor;",a="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",l="",u="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(t="",e="attribute",n="varying",r="varying",i="texture2D",s="gl_FragColor",o="",a="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",l="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",u="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:t,attribute:e,varyingVs:n,varyingFs:r,texture2D:i,output:s,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:l,defineRound:u}}function Y_(t,e,n="index"){const i=r.computeStrides(e);return i.map((e,r)=>`int ${t[r]} = ${n} / ${e}; ${r===i.length-1?`int ${t[r+1]} = ${n} - ${t[r]} * ${e}`:`index -= ${t[r]} * ${e}`};`).join("")}function K_(t){const e=r.computeStrides(t).map(t=>t.toString());return`\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;\n  }\n`}const X_="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",{getBroadcastDims:Z_}=y;const Q_="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",J_="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",tw="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",ew="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function nw(t){return"offset"+t}function rw(t){const e=t.name,n=r.sizeFromShape(t.shapeInfo.logicalShape);return n<2?`return ${e};`:`\n    for (int i = 0; i < ${n}; i++) {\n      if (i == index) {\n        return ${e}[i];\n      }\n    }\n  `}function iw(t){if(t<=1)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";if(5===t)return"ivec5";if(6===t)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function sw(t,e){const n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function ow(t,e){return e.map(e=>t[e]).join(", ")}class aw{constructor(t,e,n,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,r.assert(t.length>2,()=>`Packed arg${n.charAt(0).toUpperCase()+n.slice(1)} supports only inputs with rank above 2.`);const s=Math.ceil(t[t.length-1]/e);this.outputShape=t.slice(0,-1),s>1&&this.outputShape.push(s),i||this.variableNames.push("bestIndicesA");const o=this.outputShape,a=o.length,l=iw(a),u=H_("coords",a);let c,h;if(1===s){h=a+1;const t=iw(h);c=`\n        ${t} sourceLocR = ${t}(${u.join()}, 0);\n        ++${u[a-1]};\n        ${t} sourceLocG = ${t}(${u.join()}, 0);\n        ++${u[a-2]};\n        ${t} sourceLocA = ${t}(${u.join()}, 0);\n        --${u[a-1]};\n        ${t} sourceLocB = ${t}(${u.join()}, 0);\n        --${u[a-2]};`}else h=a,c=`\n        ${l} sourceLocR = coords;\n        ++${u[a-1]};\n        ${l} sourceLocG = coords;\n        ++${u[a-2]};\n        ${l} sourceLocA = coords;\n        --${u[a-1]};\n        ${l} sourceLocB = coords;\n        --${u[a-2]};`;const d=["x","y","z","w","u","v"].slice(0,h),f="."+d[h-1],p=d.map(t=>"int "+t),m=H_("sourceLocR",h-1).concat("inIdx.r"),g=H_("sourceLocG",h-1).concat("inIdx.g"),y=H_("sourceLocB",h-1).concat("inIdx.b"),v=H_("sourceLocA",h-1).concat("inIdx.a"),b="max"===n?"greaterThan":"lessThan",x=i?"":`\n          inIdx = round(vec4(getBestIndicesAChannel(${m.join()}),\n                             getBestIndicesAChannel(${g.join()}),\n                             getBestIndicesAChannel(${y.join()}),\n                             getBestIndicesAChannel(${v.join()})));`,_=`vec4(\n            getAChannel(${m.join()}),\n            hasNextCol ? getAChannel(${g.join()}) : 0.,\n            hasNextRow ? getAChannel(${y.join()}) : 0.,\n            hasNextRow && hasNextCol ? getAChannel(${v.join()}) : 0.)`,w=i?"":`\n      float getBestIndicesAChannel(${p.join()}) {\n        return getChannel(getBestIndicesA(${d.join()}),\n                                          vec2(${d.slice(-2).join()}));\n      }`;this.userCode=`\n      float getAChannel(${p.join()}) {\n        return getChannel(getA(${d.join()}),\n                               vec2(${d.slice(-2).join()}));\n      }\n      ${w}\n      void main() {\n        ${l} coords = getOutputCoords();\n        bool hasNextCol = ${u[a-1]} < ${o[a-1]-1};\n        bool hasNextRow = ${u[a-2]} < ${o[a-2]-1};\n        ${c}\n        ivec4 srcIdx = ivec4(sourceLocR${f}, sourceLocG${f},\n          sourceLocB${f}, sourceLocA${f}) * ${e};\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ${_};\n\n        for (int i = 0; i < ${e}; i++) {\n          inIdx = srcIdx;\n          ${x}\n          vec4 candidate = ${_};\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(${b}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    `}}class lw{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const e=t.effectiveFilterHeight,n=t.effectiveFilterWidth;this.userCode=`\n      const ivec2 pads = ivec2(${e-1-t.padInfo.top}, ${n-1-t.padInfo.left});\n      const float avgMultiplier = float(${1/(t.filterHeight*t.filterWidth)});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${e};\n            wR += ${t.dilationHeight}) {\n          float dyR = float(dyRCorner + wR) / ${t.strideHeight}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${n};\n            wC+= ${t.dilationWidth}) {\n            float dyC = float(dyCCorner + wC) / ${t.strideWidth}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class uw{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const e=t.effectiveFilterDepth,n=t.effectiveFilterHeight,r=t.effectiveFilterWidth;this.userCode=`\n      const ivec3 pads = ivec3(${e-1-t.padInfo.front}, ${n-1-t.padInfo.top}, ${r-1-t.padInfo.left});\n      const float avgMultiplier = float(${1/(t.filterDepth*t.filterHeight*t.filterWidth)});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${e};\n            wD += ${t.dilationDepth}) {\n          float dyD = float(dyDCorner + wD) / ${t.strideDepth}.0;\n\n          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${n};\n              wR += ${t.dilationHeight}) {\n            float dyR = float(dyRCorner + wR) / ${t.strideHeight}.0;\n\n            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${r};\n                wC += ${t.dilationWidth}) {\n              float dyC = float(dyCCorner + wC) / ${t.strideWidth}.0;\n\n              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class cw{constructor(t,e,n,r,i,s){this.outputShape=[],this.variableNames=["x","mean","variance"],y.assertAndGetBroadcastShape(t,e),y.assertAndGetBroadcastShape(t,n);let o="0.0";null!=r&&(y.assertAndGetBroadcastShape(t,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");let a="1.0";null!=i&&(y.assertAndGetBroadcastShape(t,i),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ${o};\n        float scale = ${a};\n        float inv = scale * inversesqrt(variance + float(${s}));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    `}}class hw{constructor(t,e,n,r,i,s){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],y.assertAndGetBroadcastShape(t,e),y.assertAndGetBroadcastShape(t,n);let o="vec4(0.0)";null!=r&&(y.assertAndGetBroadcastShape(t,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");let a="vec4(1.0)";null!=i&&(y.assertAndGetBroadcastShape(t,i),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`\n      void main() {\n        vec4 offset = ${o};\n        vec4 scale = ${a};\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(${s}));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    `}}class dw{constructor(t,e,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=y.assertAndGetBroadcastShape(e,n),this.userCode=`\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ${t}\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    `}}const fw="return a + b;",pw="return a - b;",mw="return a * b;",gw="return (a < 0.) ? b * a : a;";class yw{constructor(t,e,n){this.variableNames=["A","B"],this.outputShape=y.assertAndGetBroadcastShape(e,n),this.userCode=`\n      float binaryOperation(float a, float b) {\n        ${t}\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    `}}const vw="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";class bw{constructor(t,e,n,i=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=y.assertAndGetBroadcastShape(e,n);const s=this.outputShape.length;let o="";if(i)if(0===s||1===r.sizeFromShape(this.outputShape))o="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(o=`\n          ${iw(s)} coords = getOutputCoords();\n        `,1===s)o+=`\n            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          `;else{const t=H_("coords",s);o+=`\n            bool nextRowOutOfBounds =\n              (${t[s-2]} + 1) >= ${this.outputShape[s-2]};\n            bool nextColOutOfBounds =\n              (${t[s-1]} + 1) >= ${this.outputShape[s-1]};\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `}this.userCode=`\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ${t}\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ${o}\n\n        setOutput(result);\n      }\n    `}}class xw{constructor(t){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}getCustomSetupFunc(t,e){return(n,r)=>{null==this.minLoc&&(this.minLoc=n.getUniformLocationNoThrow(r,"minVal"),this.maxLoc=n.getUniformLocationNoThrow(r,"maxVal")),n.gl.uniform1f(this.minLoc,t),n.gl.uniform1f(this.maxLoc,e)}}}class _w{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}getCustomSetupFunc(t,e){return(n,r)=>{null==this.minLoc&&(this.minLoc=n.getUniformLocationNoThrow(r,"minVal"),this.maxLoc=n.getUniformLocationNoThrow(r,"maxVal")),n.gl.uniform1f(this.minLoc,t),n.gl.uniform1f(this.maxLoc,e)}}}class ww{constructor(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}}class Sw{constructor(t){this.outputShape=[],this.outputShape=y.computeOutShape(t,1),this.variableNames=t.map((t,e)=>"T"+e);const e=new Array(t.length-1);e[0]=t[0][1];for(let r=1;r<e.length;r++)e[r]=e[r-1]+t[r][1];const n=[`if (yC < ${e[0]}) setOutput(getT0(yR, yC));`];for(let r=1;r<e.length;r++)n.push(`else if (yC < ${e[r]}) setOutput(getT${r}(yR, yC-${e[r-1]}));`);n.push(`else setOutput(getT${e.length}(yR, yC-${e[e.length-1]}));`),this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ${n.join("\n        ")}\n      }\n    `}}class Cw{constructor(t,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=y.computeOutShape(t,e);const n=this.outputShape,r=n.length,i=iw(r),s=H_("coords",r),o=["x","y","z","w","u","v"].slice(0,r);this.variableNames=t.map((t,e)=>"T"+e);const a=new Array(t.length-1);a[0]=t[0][e];for(let f=1;f<a.length;f++)a[f]=a[f-1]+t[f][e];const l=o[e],u=o.slice(-2),c=o.join();let h=`if (${l} < ${a[0]}) {\n        return getChannel(\n            getT0(${c}), vec2(${u.join()}));\n        }`;for(let f=1;f<a.length;f++){const t=a[f-1];h+=`\n        if (${l} < ${a[f]}  && ${l} >= ${a[f-1]}) {\n          return getChannel(\n            getT${f}(${Ew(o,l,t)}),\n            vec2(${Ew(u,l,t)}));\n        }`}const d=a[a.length-1];h+=`\n        return getChannel(\n          getT${a.length}(${Ew(o,l,d)}),\n          vec2(${Ew(u,l,d)}));`,this.userCode=`\n      float getValue(${o.map(t=>"int "+t)}) {\n        ${h}\n      }\n\n      void main() {\n        ${i} coords = getOutputCoords();\n        vec4 result = vec4(getValue(${s}), 0., 0., 0.);\n\n        ${s[r-1]} = ${s[r-1]} + 1;\n        if (${s[r-1]} < ${n[r-1]}) {\n          result.g = getValue(${s});\n        }\n\n        ${s[r-2]} = ${s[r-2]} + 1;\n        if (${s[r-2]} < ${n[r-2]}) {\n          result.a = getValue(${s});\n        }\n\n        ${s[r-1]} = ${s[r-1]} - 1;\n        if (${s[r-2]} < ${n[r-2]} &&\n            ${s[r-1]} < ${n[r-1]}) {\n          result.b = getValue(${s});\n        }\n        setOutput(result);\n      }\n    `}}function Ew(t,e,n){const r=t.indexOf(e);return t.map((t,e)=>e===r?`${t} - ${n}`:t).join()}class kw{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${t.batchSize}; b++) {\n          for (int yR = 0; yR < ${t.outHeight}; yR++) {\n            int xR = wR + yR * ${t.strideHeight} - ${t.padInfo.top};\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${t.outWidth}; yC++) {\n              int xC = wC + yC * ${t.strideWidth} - ${t.padInfo.left};\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              if (${"channelsLast"===t.dataFormat}) {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class Aw{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterHeight,n=t.filterWidth,r="channelsLast"===t.dataFormat;this.userCode=`\n      const ivec2 pads = ivec2(${e-1-t.padInfo.top}, ${n-1-t.padInfo.left});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[${r?3:1}];\n\n        ivec2 dyCorner = ivec2(coords[${r?1:2}], coords[${r?2:3}]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${e}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${t.strideHeight}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${e} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${t.strideWidth}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            for (int d2 = 0; d2 < ${t.outChannels}; d2++) {\n\n              if (${r}) {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class Dw{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode=`\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${t.batchSize}; b++) {\n          for (int yF = 0; yF < ${t.outDepth}; yF++) {\n            int xF = wF + yF * ${t.strideDepth} - ${t.padInfo.front};\n\n            if (xF < 0 || xF >= ${t.inDepth}) {\n              continue;\n            }\n\n            for (int yR = 0; yR < ${t.outHeight}; yR++) {\n              int xR = wR + yR * ${t.strideHeight} - ${t.padInfo.top};\n\n              if (xR < 0 || xR >= ${t.inHeight}) {\n                continue;\n              }\n\n              for (int yC = 0; yC < ${t.outWidth}; yC++) {\n                int xC = wC + yC * ${t.strideWidth} - ${t.padInfo.left};\n\n                if (xC < 0 || xC >= ${t.inWidth}) {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class Nw{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterDepth,n=t.filterHeight,r=t.filterWidth;this.userCode=`\n      const ivec3 pads = ivec3(${e-1-t.padInfo.front}, ${n-1-t.padInfo.top}, ${r-1-t.padInfo.left});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${e}; wF++) {\n          float dyF = float(dyFCorner + wF) / ${t.strideDepth}.0;\n\n          if (dyF < 0.0 || dyF >= ${t.outDepth}.0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ${e} - 1 - wF;\n\n          for (int wR = 0; wR < ${n}; wR++) {\n            float dyR = float(dyRCorner + wR) / ${t.strideHeight}.0;\n\n            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ${n} - 1 - wR;\n\n            for (int wC = 0; wC < ${r}; wC++) {\n              float dyC = float(dyCCorner + wC) / ${t.strideWidth}.0;\n\n              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ${r} - 1 - wC;\n\n              for (int d2 = 0; d2 < ${t.outChannels}; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class Tw{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ${t.outChannels/t.inChannels} + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ${t.batchSize}; b++) {\n          for (int yR = 0; yR < ${t.outHeight}; yR++) {\n            int xR = wR + yR * ${t.strideHeight} - ${t.padInfo.top};\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${t.outWidth}; yC++) {\n              int xC = wC + yC * ${t.strideWidth} - ${t.padInfo.left};\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class Ow{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterHeight,n=t.filterWidth,r=t.outChannels/t.inChannels;this.userCode=`\n      const ivec2 pads = ivec2(${e-1-t.padInfo.top}, ${n-1-t.padInfo.left});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ${e}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${t.strideHeight}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${e} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${t.strideWidth}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ${r}; dm++) {\n              int d2 = d1 * ${r} + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class Iw{constructor(t,e=!1,n=null,r=!1){this.variableNames=["x","W"],this.outputShape=t.outShape;const i=t.padInfo.top,s=t.padInfo.left,o=t.strideHeight,a=t.strideWidth,l=t.dilationHeight,u=t.dilationWidth,c=t.filterHeight,h=t.filterWidth,d=4*Math.floor(t.inChannels/4),f=t.inChannels%4,p="channelsLast"===t.dataFormat,m=p?1:2,g=p?2:3,y=p?3:1;let v="",b="";n&&(v=r?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,b="result = activation(result);");const x=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`\n      ${v}\n\n      const ivec2 strides = ivec2(${o}, ${a});\n      const ivec2 pads = ivec2(${i}, ${s});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[${y}];\n\n        ivec2 xRCCorner =\n            ivec2(coords[${m}], coords[${g}]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${c}; wR++) {\n          int xR = xRCorner + wR * ${l};\n\n          if (xR < 0 || xR >= ${t.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${h}; wC++) {\n            int xC = xCCorner + wC * ${u};\n\n            if (xC < 0 || xC >= ${t.inWidth}) {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ${d}; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (${p}) {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (${1===f}) {\n\n              if (${p}) {\n                dotProd +=\n                    getX(batch, xR, xC, ${d}) *\n                    getW(wR, wC, ${d}, d2);\n              } else {\n                dotProd +=\n                    getX(batch, ${d}, xR, xC) *\n                    getW(wR, wC, ${d}, d2);\n              }\n\n            } else if (${2===f}) {\n              vec2 wValues = vec2(\n                getW(wR, wC, ${d}, d2),\n                getW(wR, wC, ${d} + 1, d2)\n              );\n\n              if (${p}) {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ${d}),\n                  getX(batch, xR, xC, ${d} + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ${d}, xR, xC),\n                  getX(batch, ${d} + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (${3===f}) {\n              vec3 wValues = vec3(\n                getW(wR, wC, ${d}, d2),\n                getW(wR, wC, ${d} + 1, d2),\n                getW(wR, wC, ${d} + 2, d2)\n              );\n\n              if (${p}) {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ${d}),\n                  getX(batch, xR, xC, ${d} + 1),\n                  getX(batch, xR, xC, ${d} + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ${d}, xR, xC),\n                  getX(batch, ${d} + 1, xR, xC),\n                  getX(batch, ${d} + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ${x}\n        ${b}\n        setOutput(result);\n      }\n    `}}class Rw{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const e=t.padInfo.front,n=t.padInfo.top,r=t.padInfo.left,i=t.strideDepth,s=t.strideHeight,o=t.strideWidth,a=t.dilationDepth,l=t.dilationHeight,u=t.dilationWidth,c=t.filterDepth,h=t.filterHeight,d=t.filterWidth,f=4*Math.floor(t.inChannels/4),p=t.inChannels%4;this.userCode=`\n      const ivec3 strides = ivec3(${i}, ${s}, ${o});\n      const ivec3 pads = ivec3(${e}, ${n}, ${r});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${c}; wF++) {\n          int xF = xFCorner + wF * ${a};\n\n          if (xF < 0 || xF >= ${t.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${h}; wR++) {\n            int xR = xRCorner + wR * ${l};\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${d}; wC++) {\n              int xC = xCCorner + wC * ${u};\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ${f}; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (${1===p}) {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ${f}) *\n                  getW(wF, wR, wC, ${f}, d2);\n              } else if (${2===p}) {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ${f}),\n                  getX(batch, xF, xR, xC, ${f} + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ${f}, d2),\n                  getW(wF, wR, wC, ${f} + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (${3===p}) {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ${f}),\n                  getX(batch, xF, xR, xC, ${f} + 1),\n                  getX(batch, xF, xR, xC, ${f} + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ${f}, d2),\n                  getW(wF, wR, wC, ${f} + 1, d2),\n                  getW(wF, wR, wC, ${f} + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class Fw{constructor(t,e=!1,n=null,r=!1){this.variableNames=["x","W"],this.outputShape=t.outShape;const i=t.inHeight,s=t.inWidth,o=t.padInfo.top,a=t.padInfo.left,l=t.strideHeight,u=t.strideWidth,c=t.dilationHeight,h=t.dilationWidth,d=t.filterHeight,f=t.filterWidth,p=t.outChannels/t.inChannels;let m="",g="";n&&(m=r?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,g="result = activation(result);");const y=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`\n      ${m}\n\n      const ivec2 strides = ivec2(${l}, ${u});\n      const ivec2 pads = ivec2(${o}, ${a});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${p};\n        int q = d2 - d1 * ${p};\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ${d}; wR++) {\n          int xR = xRCorner + wR * ${c};\n\n          if (xR < 0 || xR >= ${i}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${f}; wC++) {\n            int xC = xCCorner + wC * ${h};\n\n            if (xC < 0 || xC >= ${s}) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ${y}\n        ${g}\n        setOutput(result);\n      }\n    `}}class Mw{constructor(t,e=!1,n=null,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.outShape;const s=t.inHeight,o=t.inWidth,a=t.padInfo.top,l=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,h=t.dilationHeight,d=t.dilationWidth,f=t.filterHeight,p=t.filterWidth,m=p;let g="int xR; int xC; int xCOffset;";for(let r=0;r<f;r++)for(let t=0;t<p;t++)g+=`\n          vec4 xTexelR${r}C${2*t} = vec4(0.);\n          vec4 wR${r}C${t} = vec4(0.);\n          vec4 xR${r}C${t} = vec4(0.);`;for(let x=0;x<f;x++)for(let t=0;t<m;t++){const e=2*t;if(g+=`\n          xR = xRCorner + ${x*h};\n          xC = xCCorner + ${e*d};\n        `,1===c){if(e<p&&(g+=l%2==1?`\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < ${s} && xCOffset >= 0 && xCOffset < ${o}) {\n                  xTexelR${x}C${e} = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= ${o}) {\n                    xTexelR${x}C${e}.zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR${x}C${e} = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < ${s} && xCOffset >= 0 && xCOffset < ${o}) {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= ${o}) {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR${x}C${e} = vec4(previous.zw, xTexelR${x}C${e}.xy);\n                } else {\n                  xR${x}C${e} = vec4(0, 0, xTexelR${x}C${e}.xy);\n                }\n              `:`\n                if(xR >= 0 && xR < ${s} && xC >= 0 && xC < ${o}) {\n                  xTexelR${x}C${e} = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR${x}C${e} = vec4(0.);\n                }\n\n                xR${x}C${e} = xTexelR${x}C${e};\n              `,e+1<p)){const t=l%2==0?r.nearestLargerEven(d):d;d%2==0&&l%2==1||d%2!=0&&l%2!=1?(g+=`\n                  xCOffset = xC + ${l%2} + ${t};\n\n                  if(xR >= 0 && xR < ${s} &&\n                    xCOffset >= 0 && xCOffset < ${o}) {\n                    xTexelR${x}C${e+2} = getX(batch, xR, xCOffset, d1);\n                  }\n                `,d>1&&(g+=`\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < ${s} &&\n                      xCOffset >= 0 && xCOffset < ${o}) {\n                      xTexelR${x}C${e} = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR${x}C${e} = vec4(0.);\n                    }\n                  `),g+=`\n                  xR${x}C${e+1} = vec4(\n                    xTexelR${x}C${e}.zw, xTexelR${x}C${e+2}.xy);\n                `):g+=`\n                  xCOffset = xC + ${t};\n\n                  if(xR >= 0 && xR < ${s} &&\n                    xCOffset >= 0 && xCOffset < ${o}) {\n                    xTexelR${x}C${e+2} = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR${x}C${e+1} = xTexelR${x}C${e+2};\n                `}}else e<p&&(g+=`\n              if(xR >= 0 && xR < ${s}) {\n            `,l%2==1?(g+=`\n                xCOffset = xC + 1 - ${c};\n                if(xCOffset >= 0 && xCOffset < ${o}) {\n                  xTexelR${x}C${e} = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR${x}C${e} = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < ${o}) {\n                  xTexelR${x}C${e+2} = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR${x}C${e+2} = vec4(0.);\n                }\n\n                xR${x}C${e} = vec4(\n                  xTexelR${x}C${e}.zw, xTexelR${x}C${e+2}.zw);\n              `,e+1<p&&(g+=`\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + ${c};\n                  if(xCOffset >= 0 && xCOffset < ${o}) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR${x}C${e+1} = vec4(xTexelR${x}C${e+2}.xy, final.xy);\n                `)):(g+=`\n                if(xC >= 0 && xC < ${o}) {\n                  xTexelR${x}C${e} = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR${x}C${e} = vec4(0.);\n                }\n\n                xCOffset = xC + ${c};\n                if(xCOffset >= 0 && xCOffset < ${o}) {\n                  xTexelR${x}C${e+2} = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR${x}C${e+2} = vec4(0.);\n                }\n\n                xR${x}C${e} = vec4(\n                  xTexelR${x}C${e}.xy, xTexelR${x}C${e+2}.xy);\n              `,e+1<p&&(g+=`\n                  xR${x}C${e+1} = vec4(\n                    xTexelR${x}C${e}.zw, xTexelR${x}C${e+2}.zw);\n                `)),g+="}");e<p&&(g+=`\n            vec4 wTexelR${x}C${e} = getW(${x}, ${e}, d1, q);\n            wR${x}C${e} = vec4(wTexelR${x}C${e}.xz, wTexelR${x}C${e}.xz);\n          `,e+1<p&&(g+=`\n              vec4 wTexelR${x}C${e+1} = getW(${x}, ${e+1}, d1, q);\n              wR${x}C${e+1} =\n                vec4(wTexelR${x}C${e+1}.xz, wTexelR${x}C${e+1}.xz);`))}for(let r=0;r<f;r++)for(let t=0;t<p;t++)g+=`dotProd += xR${r}C${t} * wR${r}C${t};`;let y="",v="";n&&(y=i?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:`vec4 activation(vec4 x) {\n          ${n}\n        }`,v="result = activation(result);");const b=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),this.userCode=`\n      ${y}\n\n      const ivec2 strides = ivec2(${u}, ${c});\n      const ivec2 pads = ivec2(${a}, ${l});\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        ${g}\n\n        vec4 result = dotProd;\n        ${b}\n        ${v}\n        setOutput(result);\n      }\n    `}}class $w{constructor(t,e,n,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[s,o,a,l]=t,[u]=e,[c,h]=n;this.outputShape=[u,c,h,l];const d="bilinear"===r?1:0,[f,p]=[o-1+".0",a-1+".0"],[m,g,y]=c>1?[""+(o-1)/(c-1),"(y2-y1) * height_ratio",`y1*${f} + float(y)*(height_scale)`]:["0.0","0.0","0.5 * (y1+y2) * "+f],[v,b,x]=h>1?[""+(a-1)/(h-1),"(x2-x1) * width_ratio",`x1*${p} + float(x)*(width_scale)`]:["0.0","0.0","0.5 * (x1+x2) * "+p];this.userCode=`\n      const float height_ratio = float(${m});\n      const float width_ratio = float(${v});\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ${s}) {\n          return;\n        }\n\n        float height_scale = ${g};\n        float width_scale = ${b};\n\n        float in_y = ${y};\n        if( in_y < 0.0 || in_y > ${f} ) {\n          setOutput(float(${i}));\n          return;\n        }\n        float in_x = ${x};\n        if( in_x < 0.0 || in_x > ${p} ) {\n          setOutput(float(${i}));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(${d} == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    `}}class Pw{constructor(t,e,n){this.variableNames=["x"],this.outputShape=t;const r=t.length,i=e?"0.0":`getX(${zw(r,"coords")})`,s=t[t.length-1];let o="",a="";e?(o=n?"end != "+(s-1):"end != 0",a=n?"end + 1":"end - 1"):(o=n?"end + pow2 < "+s:"end >= pow2",a=n?"end + pow2":"end - pow2"),this.userCode=`\n      uniform float index;\n      void main() {\n        ${iw(r)} coords = getOutputCoords();\n        int end = ${Lw(r,"coords")};\n        float val = ${i};\n        int pow2 = int(pow(2.0, index));\n        if (${o}) {\n          int idx = ${a};\n          ${Lw(r,"coords")} = idx;\n          val += getX(${zw(r,"coords")});\n        }\n        setOutput(val);\n      }\n    `}getCustomSetupFunc(t){return(e,n)=>{null==this.index&&(this.index=e.getUniformLocation(n,"index")),e.gl.uniform1f(this.index,t)}}}function zw(t,e){if(1===t)return""+e;if(2===t)return`${e}.x, ${e}.y`;if(3===t)return`${e}.x, ${e}.y, ${e}.z`;if(4===t)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw Error(`Cumulative sum for rank ${t} is not yet supported`)}function Lw(t,e){if(1===t)return""+e;if(2===t)return e+".y";if(3===t)return e+".z";if(4===t)return e+".w";throw Error(`Cumulative sum for rank ${t} is not yet supported`)}class Bw{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=p_.DENSE;const e=v_(t),n=G_();this.outputShape=t,this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${Y_(["r","c","d"],t)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2(${e[0]}, ${e[1]}));\n        int index = 4 * (resTexRC.x * ${e[1]} + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ${n.output} = result;\n      }\n    `}}class jw{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=p_.DENSE;const e=v_(t),n=G_();this.outputShape=t,this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${Y_(["r","c","d"],t)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2(${e[0]}, ${e[1]}));\n        int index = 4 * (resTexRC.x * ${e[1]} + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ${n.output} = result;\n      }\n    `}}class Uw{constructor(t,e,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=n,this.userCode=`\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ${this.getHeightCoordString()};\n      int w = ${this.getWidthCoordString()};\n      int d = ${this.getDepthCoordString()};\n\n      int in_h = h / ${e};\n      int offset_h = imod(h, ${e});\n      int in_w = w / ${e};\n      int offset_w = imod(w, ${e});\n      int offset_d = (offset_h * ${e} + offset_w) *\n        ${this.getOutputDepthSize()};\n      int in_d = d + offset_d;\n\n      float result = ${this.getInputSamplingString()};\n      setOutput(result);\n    }\n  `}getHeightCoordString(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}getWidthCoordString(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}getDepthCoordString(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}getOutputDepthSize(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}class Vw{constructor(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}}class Ww{constructor(t){this.variableNames=["A"],this.outTexUsage=m_.DOWNLOAD;const e=G_();this.outputShape=t,this.userCode=`\n      ${X_}\n\n      void main() {\n        float x = getAAtOutCoords();\n        ${e.output} = encode_float(x);\n      }\n    `}}class qw{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=m_.DOWNLOAD;const e=G_();this.outputShape=t,this.userCode=`\n      ${X_}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ${e.output} = encode_float(x);\n      }\n    `}}class Hw{constructor(t,e,n=!1){this.variableNames=["A"];const r=G_(),[i,s]=e;this.outputShape=t;let o="result";n&&(o="floor(result * 255. + 0.5)"),this.userCode=`\n      ${K_(t)}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n\n        int r = flatIndex / ${s};\n        int c = imod(flatIndex, ${s});\n        vec2 uv = (vec2(c, r) + halfCR) / vec2(${s}.0, ${i}.0);\n        vec4 values = ${r.texture2D}(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        ${r.output} = vec4(${o}, 0., 0., 0.);\n      }\n    `}}class Gw{constructor(t,e,n=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const r=G_(),[i,s]=e;this.outputShape=t;let o="",a="result";n&&(a="floor(result * 255. + 0.5)");for(let l=0;l<=1;l++)for(let e=0;e<=1;e++){const n=2*l+e;o+=`\n          localCoords = coords;\n          if(localCoords[2] + ${e} < ${t[2]}) {\n            localCoords[2] += ${e};\n            if(localCoords[1] + ${l} < ${t[1]}) {\n              localCoords[1] += ${l};\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / ${s};\n              c = imod(flatIndex, ${s});\n              uv = (vec2(c, r) + halfCR) / vec2(${s}.0, ${i}.0);\n              values = ${r.texture2D}(A, uv);\n\n              if(offset == 0) {\n                result[${n}] = values[0];\n              } else if(offset == 1) {\n                result[${n}] = values[1];\n              } else if(offset == 2) {\n                result[${n}] = values[2];\n              } else {\n                result[${n}] = values[3];\n              }\n            }\n          }\n        `}this.userCode=`\n      ${K_(t)}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        ${o}\n\n        ${r.output} = ${a};\n      }\n    `}}class Yw{constructor(t,e,n){this.variableNames=["real","imag"];const r=e[1];this.outputShape=e;const i=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI;this.userCode=`\n      const float exponentMultiplier = ${i};\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ${t}\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(${r});\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ${r}; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ${n?r+".0":"1.0"};\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    `}}class Kw{constructor(t,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}getCustomSetupFunc(t){return(e,n)=>{null==this.valueLoc&&(this.valueLoc=e.getUniformLocationNoThrow(n,"value")),e.gl.uniform1f(this.valueLoc,t)}}}class Xw{constructor(t,e,n){this.variableNames=["A","indices"];const r=t.slice();r[n]=e,this.outputShape=r,this.rank=r.length;const i=iw(this.rank),s=function(t,e){const n=t.length;if(n>4)throw Error(`Gather for rank ${n} is not yet supported`);if(1===n)return"int(getIndices(resRC))";const r=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[];for(let s=0;s<t.length;s++)i.push(s===e?`int(getIndices(${r[s]}))`:""+r[s]);return i.join()}(t,n);this.userCode=`\n      void main() {\n        ${i} resRC = getOutputCoords();\n        setOutput(getA(${s}));\n      }\n    `}}class Zw{constructor(t,e,n){this.sliceDim=t,this.strides=e,this.variableNames=["x","indices"],this.outputShape=n;const r=iw(e.length),i=iw(n.length);this.userCode=`\n        ${r} strides = ${r}(${this.strides});\n         void main() {\n          ${i} coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < ${this.sliceDim}; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * ${this.sliceDim>1?"strides[j]":"strides"};\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      `}}function Qw(t,e,n,r,i,s){!function(t,e){const n=W().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0)throw new Error(`Requested texture size [${t}x${e}] is invalid.`);if(t>n||e>n)throw new Error(`Requested texture size [${t}x${e}] greater than WebGL maximum on this browser / GPU [${n}x${n}].`)}(e,n);const o=function(t){return T_(t,()=>t.createTexture(),"Unable to create WebGLTexture.")}(t),a=t.TEXTURE_2D;return __(t,()=>t.bindTexture(a,o)),__(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)),__(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),__(t,()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST)),__(t,()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST)),__(t,()=>t.texImage2D(a,0,r,e,n,0,i,s,null)),__(t,()=>t.bindTexture(t.TEXTURE_2D,null)),o}function Jw(t){return t.internalFormatFloat}function tS(t){return t.internalFormatHalfFloat}function eS(t){return t.downloadTextureFormat}function nS(t){return t.internalFormatPackedFloat}function rS(t){return t.internalFormatPackedHalfFloat}class iS{constructor(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];const e=W().getNumber("WEBGL_VERSION");null!=t?(this.gl=t,function(t,e){h_[t]=e}(e,t)):this.gl=f_(e);let n="WEBGL_color_buffer_float";if(1===W().getNumber("WEBGL_VERSION")){const t="OES_texture_half_float";if(this.textureFloatExtension=S_(this.gl,"OES_texture_float"),z_(this.gl,t))this.textureHalfFloatExtension=S_(this.gl,t);else if(W().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),z_(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=S_(this.gl,"EXT_color_buffer_half_float");else if(W().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",z_(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!z_(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=function(t){return function(t,e){const n=T_(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return __(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),__(t,()=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)),n}(t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}(this.gl),this.indexBuffer=function(t){return function(t,e){const n=T_(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return __(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n)),__(t,()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)),n}(t,new Uint16Array([0,1,2,2,1,3]))}(this.gl),this.framebuffer=function(t){return T_(t,()=>t.createFramebuffer(),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=x_(this.gl,this.textureHalfFloatExtension)}get debug(){return W().getBool("DEBUG")}dispose(){if(this.disposed)return;null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const t=this.gl;__(t,()=>t.finish()),__(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,null)),__(t,()=>t.deleteFramebuffer(this.framebuffer)),__(t,()=>t.bindBuffer(t.ARRAY_BUFFER,null)),__(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)),__(t,()=>t.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,r){const[i,s]=y_(e,n);return Qw(t,i,s,Jw(r),r.textureFormatFloat,t.FLOAT)}(this.gl,t,e,this.textureConfig)}createFloat16MatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,r){const[i,s]=y_(e,n);return Qw(t,i,s,tS(r),r.textureFormatFloat,r.textureTypeHalfFloat)}(this.gl,t,e,this.textureConfig)}createUnsignedBytesMatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,r){const[i,s]=y_(e,n);return Qw(t,i,s,eS(r),t.RGBA,t.UNSIGNED_BYTE)}(this.gl,t,e,this.textureConfig)}uploadPixelDataToTexture(t,e){this.throwIfDisposed(),function(t,e,n){__(t,()=>t.bindTexture(t.TEXTURE_2D,e)),n.data instanceof Uint8Array?__(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data)):__(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)),__(t,()=>t.bindTexture(t.TEXTURE_2D,null))}(this.gl,t,e)}uploadDenseMatrixToTexture(t,e,n,r){this.throwIfDisposed(),function(t,e,n,r,i,s){let o,a,l;__(t,()=>t.bindTexture(t.TEXTURE_2D,e)),i instanceof Uint8Array?(o=new Uint8Array(n*r*4),a=t.UNSIGNED_BYTE,l=t.RGBA):(o=new Float32Array(n*r*4),a=t.FLOAT,l=s.internalFormatPackedFloat),o.set(i),__(t,()=>t.texImage2D(t.TEXTURE_2D,0,l,n,r,0,t.RGBA,a,o)),__(t,()=>t.bindTexture(t.TEXTURE_2D,null))}(this.gl,t,e,n,r,this.textureConfig)}createFloat16PackedMatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,r){const[i,s]=b_(e,n);return Qw(t,i,s,rS(r),t.RGBA,r.textureTypeHalfFloat)}(this.gl,t,e,this.textureConfig)}createPackedMatrixTexture(t,e){return this.throwIfDisposed(),function(t,e,n,r){const[i,s]=b_(e,n);return Qw(t,i,s,nS(r),t.RGBA,t.FLOAT)}(this.gl,t,e,this.textureConfig)}deleteMatrixTexture(t){this.throwIfDisposed(),this.outputTexture===t&&(D_(this.gl,this.framebuffer),this.outputTexture=null),__(this.gl,()=>this.gl.deleteTexture(t))}downloadByteEncodedFloatMatrixFromOutputTexture(t,e,n){return this.downloadMatrixDriver(t,()=>function(t,e,n,r){const[i,s]=y_(e,n),o=new Uint8Array(e*n*4);return __(t,()=>t.readPixels(0,0,i,s,r.downloadTextureFormat,t.UNSIGNED_BYTE,o)),new Float32Array(o.buffer)}(this.gl,e,n,this.textureConfig))}downloadPackedMatrixFromBuffer(t,e,n,r,i,s){return function(t,e,n,r,i,s,o,a){const l=t,u=new Float32Array(function(t,e){const[n,r]=b_(t,e);return n*r*4}(s,o));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,u),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),u}(this.gl,t,0,0,0,i,s)}downloadFloat32MatrixFromBuffer(t,e){return function(t,e,n){const r=t,i=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}(this.gl,t,e)}createBufferFromTexture(t,e,n){this.bindTextureToFrameBuffer(t);const r=function(t,e,n,r){const i=t.createBuffer();__(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,i));const s=16*e*n;return __(t,()=>t.bufferData(t.PIXEL_PACK_BUFFER,s,t.STREAM_READ)),__(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,0)),__(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null)),i}(this.gl,e,n);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const t=this.createFence(this.gl);return this.pollFence(t)}createFence(t){let e,n;if(W().getBool("WEBGL_FENCE_API_ENABLED")){const r=t,i=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),n=()=>{const t=r.clientWaitSync(i,0,0);return t===r.ALREADY_SIGNALED||t===r.CONDITION_SATISFIED},e=i}else W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(e,W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:e,isFencePassed:n}}downloadMatrixFromPackedTexture(t,e,n){return this.downloadMatrixDriver(t,()=>function(t,e,n){const r=new Float32Array(e*n*4);return __(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,r)),r}(this.gl,e,n))}createProgram(t){this.throwIfDisposed();const e=this.gl,n=function(t,e){const n=T_(t,()=>t.createShader(t.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(__(t,()=>t.shaderSource(n,e)),__(t,()=>t.compileShader(n)),!1===t.getShaderParameter(n,t.COMPILE_STATUS))throw function(t,e){const n=C_.exec(e);if(null==n)return console.log("Couldn't parse line number in error: "+e),void console.log(t);const i=+n[1],s=t.split("\n"),o=s.length.toString().length+2,a=s.map((t,e)=>r.rightPad((e+1).toString(),o)+t);let l=0;for(let r=0;r<a.length;r++)l=Math.max(a[r].length,l);const u=a.slice(0,i-1),c=a.slice(i-1,i),h=a.slice(i);console.log(u.join("\n")),console.log(e.split("\n")[0]),console.log("%c "+r.rightPad(c[0],l),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(h.join("\n"))}(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}(e,t),i=function(t){const e=G_();return function(t,e){const n=T_(t,()=>t.createShader(t.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(__(t,()=>t.shaderSource(n,e)),__(t,()=>t.compileShader(n)),!1===t.getShaderParameter(n,t.COMPILE_STATUS))throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(t,`${e.version}\n    precision highp float;\n    ${e.attribute} vec3 clipSpacePos;\n    ${e.attribute} vec2 uv;\n    ${e.varyingVs} vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }`)}(e),s=function(t){return T_(t,()=>t.createProgram(),"Unable to create WebGLProgram.")}(e);return __(e,()=>e.attachShader(s,i)),__(e,()=>e.attachShader(s,n)),function(t,e){if(__(t,()=>t.linkProgram(e)),!1===t.getProgramParameter(e,t.LINK_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}(e,s),this.debug&&E_(e,s),this.vertexAttrsAreBound||(this.setProgram(s),this.vertexAttrsAreBound=function(t,e,n){return __(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),k_(t,e,"clipSpacePos",n,3,20,0)&&k_(t,e,"uv",n,2,20,12)}(e,this.program,this.vertexBuffer)),s}deleteProgram(t){this.throwIfDisposed(),t===this.program&&(this.program=null),null!=t&&__(this.gl,()=>this.gl.deleteProgram(t))}setProgram(t){this.throwIfDisposed(),this.program=t,null!=this.program&&this.debug&&E_(this.gl,this.program),__(this.gl,()=>this.gl.useProgram(t))}getUniformLocation(t,e,n=!0){return this.throwIfDisposed(),n?function(t,e,n){return T_(t,()=>t.getUniformLocation(e,n),'uniform "'+n+'" not present in program.')}(this.gl,t,e):function(t,e,n){return t.getUniformLocation(e,n)}(this.gl,t,e)}getAttributeLocation(t,e){return this.throwIfDisposed(),__(this.gl,()=>this.gl.getAttribLocation(t,e))}getUniformLocationNoThrow(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)}setInputMatrixTexture(t,e,n){this.throwIfDisposed(),this.throwIfNoProgram(),function(t,e,n,r){__(t,()=>function(t,e,n){(function(t,e){const n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+t.TEXTURE0;if(r<t.TEXTURE0||r>n)throw new Error(`textureUnit must be in [gl.TEXTURE0, gl.TEXTURE${n}].`)})(t,n),__(t,()=>t.activeTexture(t.TEXTURE0+n)),__(t,()=>t.bindTexture(t.TEXTURE_2D,e))}(t,e,r)),__(t,()=>t.uniform1i(n,r))}(this.gl,t,e,n)}setOutputMatrixTexture(t,e,n){this.setOutputMatrixTextureDriver(t,n,e)}setOutputPackedMatrixTexture(t,e,n){this.throwIfDisposed();const[r,i]=b_(e,n);this.setOutputMatrixTextureDriver(t,r,i)}setOutputMatrixWriteRegion(t,e,n,r){this.setOutputMatrixWriteRegionDriver(n,t,r,e)}setOutputPackedMatrixWriteRegion(t,e,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){null!=this.program&&E_(this.gl,this.program),N_(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const t=this.gl;this.debug&&this.debugValidate(),__(t,()=>t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),__(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=S_(this.gl,2===W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(2===W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const t=this.gl,e=this.getQueryTimerExtensionWebGL2(),n=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,n),n}const t=this.getQueryTimerExtensionWebGL1(),e=t.createQueryEXT();return t.beginQueryEXT(t.TIME_ELAPSED_EXT,e),e}endQuery(){if(2===W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const t=this.gl,e=this.getQueryTimerExtensionWebGL2();return void t.endQuery(e.TIME_ELAPSED_EXT)}const t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(t){return await r.repeatedTry(()=>this.disposed||this.isQueryAvailable(t,W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(t,W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(t,e){if(0===e)return null;if(2===e){const e=this.gl;return e.getQueryParameter(t,e.QUERY_RESULT)/1e6}{const e=this.getQueryTimerExtensionWebGL1();return e.getQueryObjectEXT(t,e.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(t,e){if(0===e)return!0;if(2===e){const e=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=e.getQueryParameter(t,e.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),r&&!this.disjoint}{const e=this.getQueryTimerExtensionWebGL1(),n=e.getQueryObjectEXT(t,e.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(e.GPU_DISJOINT_EXT)),n&&!this.disjoint}}pollFence(t){return new Promise(e=>{this.addItemToPoll(()=>t.isFencePassed(),()=>e())})}pollItems(){const t=function(t){let e=0;for(;e<t.length&&t[e]();++e);return e-1}(this.itemsToPoll.map(t=>t.isDoneFn));for(let e=0;e<=t;++e){const{resolveFn:t}=this.itemsToPoll[e];t()}this.itemsToPoll=this.itemsToPoll.slice(t+1)}addItemToPoll(t,e){this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1||r.repeatedTry(()=>(this.pollItems(),0===this.itemsToPoll.length))}bindTextureToFrameBuffer(t){this.throwIfDisposed(),A_(this.gl,t,this.framebuffer),this.debug&&N_(this.gl)}unbindTextureToFrameBuffer(){null!=this.outputTexture?(A_(this.gl,this.outputTexture,this.framebuffer),this.debug&&N_(this.gl)):D_(this.gl,this.framebuffer)}downloadMatrixDriver(t,e){this.bindTextureToFrameBuffer(t);const n=e();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(t,e,n){this.throwIfDisposed();const r=this.gl;A_(r,t,this.framebuffer),this.debug&&N_(r),this.outputTexture=t,__(r,()=>r.viewport(0,0,e,n)),__(r,()=>r.scissor(0,0,e,n))}setOutputMatrixWriteRegionDriver(t,e,n,r){this.throwIfDisposed(),__(this.gl,()=>this.gl.scissor(t,e,n,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(null==this.program)throw new Error("No GPU program is currently set.")}}function sS(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach((t,n)=>{const i=t.logicalShape,s=e[n],o=s.shape;if(!r.arraysEqual(i,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${i} and ${o} must match`);if(t.isUniform&&s.isUniform)return;const a=t.texShape,l=s.isUniform?null:s.texData.texShape;if(!r.arraysEqual(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}class oS{constructor(t,e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;const{filterWidth:r,inChannels:i,strideWidth:s,strideHeight:o,padInfo:a,outWidth:l,dilationWidth:u,dilationHeight:c,dataFormat:h}=n,{left:d,top:f}=a,p=i*r,m=G_(),g="channelsLast"===h,y=g?0:1,v=g?1:2;let b="";for(let x=0;x<=1;x++)for(let n=0;n<=1;n++)b+=`\n          blockIndex = rc.y + ${n};\n          pos = rc.x + ${x};\n\n          if(blockIndex < ${t[1]} && pos < ${t[0]}) {\n            offsetY = int(blockIndex / (${l})) * ${o} - ${f};\n            d0 = offsetY + ${c} * (pos / ${p});\n\n            if(d0 < ${e[y]} && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), ${l}.) * ${s}. - ${d}.);\n              d1 = offsetX + ${u} * (int(mod(float(pos), ${p}.) / ${i}.));\n\n              if(d1 < ${e[v]} && d1 >= 0) {\n\n                ch = int(mod(float(pos), ${i}.));\n\n                if (${g}) {\n                  innerDims = vec2(d1, ch);\n                  result[${2*x+n}] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[${2*x+n}] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        `;this.userCode=`\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ${b}\n\n        ${m.output} = result;\n      }\n    `}}class aS{constructor(t,e,n,r,i){this.variableNames=["x"],this.outputShape=[];const s=e,o=t[3]-1;let a;this.outputShape=t;const l=`float(${n}) + float(${r}) * sum`;a=.5===i?`inversesqrt(${l})`:1===i?`1.0/(${l})`:`exp(log(${l}) * float(-${i}));`,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -${s}; j <= ${s}; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ${o}) {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ${a};\n        setOutput(val);\n      }\n    `}}class lS{constructor(t,e,n,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=e,this.bias=n,this.alpha=r,this.beta=i,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ${this.depth}; ++d) {\n          int depthBegin = int(max(0.0, float(d - ${e})));\n          int depthEnd = int(min(float(${this.depth}),\n              float(d + ${e} + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ${this.depth};\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(${r}) * norm + float(${n});\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(${r})\n                * float(${i})\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ${i});\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    `}}class uS{constructor(t,e,n,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const s=e,o=t[3]-1;let a;this.outputShape=t;const l=`float(${n}) + float(${r}) * sum`;a=.5===i?`inversesqrt(${l})`:1===i?`1.0/(${l})`:`exp(log(${l}) * float(-${i}));`,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ${this.outputShape[3]};\n        bool hasNextRow = c < ${this.outputShape[2]};\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ${s};\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ${s}; j <= ${s}; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${o}));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ${a};\n        setOutput(result);\n      }\n    `}}class cS{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const e=t.effectiveFilterHeight,n=t.effectiveFilterWidth;this.userCode=`\n      const ivec2 pads = ivec2(${e-1-t.padInfo.top}, ${n-1-t.padInfo.left});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${e};\n          wR += ${t.dilationHeight}) {\n          float dyR = float(dyRCorner + wR) / ${t.strideHeight}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${t.strideWidth}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ${e*n-1} - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ${n} + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class hS{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const e=t.effectiveFilterDepth,n=t.effectiveFilterHeight,r=t.effectiveFilterWidth;this.userCode=`\n      const ivec3 pads = ivec3(${e-1-t.padInfo.front}, ${n-1-t.padInfo.top}, ${r-1-t.padInfo.left});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${e};\n           wD += ${t.dilationDepth}) {\n          float dyD = float(dyDCorner + wD) / ${t.strideDepth}.0;\n\n          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${n};\n              wR += ${t.dilationHeight}) {\n            float dyR = float(dyRCorner + wR) / ${t.strideHeight}.0;\n\n            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${r};\n                wC += ${t.dilationWidth}) {\n              float dyC = float(dyCCorner + wC) / ${t.strideWidth}.0;\n\n              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ${e*n*r-1} -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ${n} * ${r} +\n                  wR * ${r} + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class dS{constructor(t,e,n=!1,r=!1,i=!1,s=null,o=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;const a=Math.ceil((n?t[1]:t[2])/2),l=n?"i * 2, rc.y":"rc.y, i * 2",u=r?"rc.z, i * 2":"i * 2, rc.z",c=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],h=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let d="",f="";s&&(d=o?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${s}\n        }`:`vec4 activation(vec4 x) {\n          ${s}\n        }`,f="result = activation(result);");const p=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),this.userCode=`\n      ${d}\n\n      const float sharedDimension = ${a}.0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < ${a}; i++) {\n          vec4 a = getMatrixA(rc.x, ${l});\n          vec4 b = getMatrixB(rc.x, ${u});\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (${c[0]} * ${h[0]});\n          result += (${c[1]} * ${h[1]});\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ${p}\n\n        ${f}\n\n        setOutput(result);\n      }\n    `}}class fS{constructor(t,e,n){this.variableNames=["probs"],this.outputShape=[t,n],this.userCode=`\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ${e-1}; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(${e-1}));\n      }\n    `}getCustomSetupFunc(t){return(e,n)=>{null==this.seedLoc&&(this.seedLoc=e.getUniformLocation(n,"seed")),e.gl.uniform1f(this.seedLoc,t)}}}class pS{constructor(t,e,n,r){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(${r}), float(${n}),\n                      float(index == coords.y)));\n      }\n    `}}class mS{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t;const e=t.length;if(0===e)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{const n=H_("rc",e),r=iw(e),i=function(t,e,n){if(1===t)return"rc > "+e[0];let r="";for(let i=t-2;i<t;i++)r+=`${n[i]} >= ${e[i]}`,i<t-1&&(r+="||");return r}(e,t,n),s=function(t,e,n,r){if(1===t)return"";const i=r.slice(-2);return`\n    int r = ${i[0]};\n    int c = ${i[1]};\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= ${e};\n    bool rEdge = rp1 >= ${n};\n  `}(e,t[t.length-1],t[t.length-2],n),o=function(t,e){const n=t.length,r=function(t,e){const n=[];for(let r=0;r<=1;r++)for(let i=0;i<=1;i++){let s=`${0===r?"r":"rp1"}, ${0===i?"c":"cp1"}`;for(let n=2;n<t;n++)s=e[e.length-1-n]+","+s;n.push(s)}return n}(n,e);return 1===n?`getA(rc),\n            rc + 1 >= ${t[0]} ? 0. : getA(rc + 1),\n            0, 0`:`getA(${r[0]}),\n          cEdge ? 0. : getA(${r[1]}),\n          rEdge ? 0. : getA(${r[2]}),\n          rEdge || cEdge ? 0. : getA(${r[3]})`}(t,n);this.userCode=`\n        void main() {\n          ${r} rc = getOutputCoords();\n\n          if(${i}) {\n            setOutput(vec4(0));\n          } else {\n            ${s}\n\n            setOutput(vec4(${o}));\n          }\n        }\n      `}}}class gS{constructor(t,e,n){this.variableNames=["x"],this.outputShape=e.map((e,n)=>e[0]+t[n]+e[1]);const r=t.length,i=iw(r),s=e.map(t=>t[0]).join(","),o=e.map((e,n)=>e[0]+t[n]).join(","),a=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?`\n      ${i} start = ${i}(${s});\n      ${i} end = ${i}(${o});\n\n      void main() {\n        ${i} outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float(${n}));\n        } else {\n          ${i} coords = outC - start;\n          setOutput(getX(${a}));\n        }\n      }\n    `:`\n        int start = ${s};\n        int end = ${o};\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float(${n}));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      `}}class yS{constructor(t,e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map((e,n)=>e[0]+t[n]+e[1]);const r=t.length,i=iw(r),s=e.map(t=>t[0]).join(","),o=e.map((e,n)=>e[0]+t[n]).join(","),a=H_("rc",r),l=H_("source",r),u=`${a[r-1]} < ${this.outputShape[r-1]}`,c=1===r?"source":`vec2(${l.slice(-2).join()})`,h=[i+" rc = outputLoc;",`${a[r-1]} += 1;\n       if(${u}) {\n      `,1===r?"":`}\n       rc = outputLoc;\n       ${a[r-2]} += 1;\n       if(${a[r-2]} < ${this.outputShape[r-2]}) {`,1===r?"":`  ${a[r-1]} += 1;\n         if(${u}) {`],d=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let f="";for(let p=0,m=1===r?2:4;p<m;p++)f+=`\n        ${h[p]}\n        if (${d}) {\n          result[${p}] = float(${n});\n        } else {\n          ${i} source = rc - start;\n          result[${p}] = getChannel(getX(${l.join()}), ${c});\n        }\n      `;f+=1===r?"} ":"}}",this.userCode=`\n      const ${i} start = ${i}(${s});\n      const ${i} end = ${i}(${o});\n\n      void main() {\n        ${i} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${f}\n        setOutput(result);\n      }\n    `}}class vS{constructor(t,e,n,r=!1,i=!1){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");const s=t.filterWidth,o=t.strideHeight,a=t.strideWidth,l=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=t.padInfo.top,f=t.padInfo.left;this.outputShape=t.outShape;const p="avg"===e;let m="0.0";if(p||(m="-1.0 / 1e-20"),n)return void(this.userCode=`\n        const ivec2 strides = ivec2(${o}, ${a});\n        const ivec2 pads = ivec2(${d}, ${f});\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ${c};\n              wR += ${l}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${h};\n                wC += ${u}) {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ${r?i?`((batch  * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + d`:`(xR * ${t.inWidth} + xC) * ${t.inChannels} + d`:`wR * ${h} + wC`};\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `);let g=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===e&&(g="avgValue / count");const y=4*Math.floor(s/4),v=s%4,b=`\n      if (${p}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec2 strides = ivec2(${o}, ${a});\n      const ivec2 pads = ivec2(${d}, ${f});\n      const float initializationValue = ${m};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ${t.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${m});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ${c};\n            wR += ${l}) {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ${t.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${y}; wC += 4) {\n            int xC = xCCorner + wC * ${u};\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${u}, d),\n              getValue(batch, xR, xC + 2 * ${u}, d),\n              getValue(batch, xR, xC + 3 * ${u}, d)\n            );\n\n            ${b}\n          }\n\n          int xC = xCCorner + ${y};\n          if (${1===v}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ${b}\n          } else if (${2===v}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${u}, d),\n              initializationValue,\n              initializationValue\n            );\n\n            ${b}\n          } else if (${3===v}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${u}, d),\n              getValue(batch, xR, xC + 2 * ${u}, d),\n              initializationValue\n            );\n\n            ${b}\n          }\n        }\n        setOutput(${g});\n      }\n    `}}class bS{constructor(t,e,n,r=!1,i=!1){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");const s=t.filterWidth,o=t.strideDepth,a=t.strideHeight,l=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,h=t.dilationWidth,d=t.effectiveFilterDepth,f=t.effectiveFilterHeight,p=t.effectiveFilterWidth,m=t.padInfo.front,g=t.padInfo.top,y=t.padInfo.left;this.outputShape=t.outShape;const v="avg"===e;let b="0.0";if(v||(b="-1.0 / 1e-20"),n)return void(this.userCode=`\n        const ivec3 strides =\n            ivec3(${o}, ${a}, ${l});\n        const ivec3 pads = ivec3(${m}, ${g}, ${y});\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ${d};\n              wD += ${u}) {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ${t.inDepth}) {\n              continue;\n            }\n\n            for (int wR = 0; wR < ${f};\n                wR += ${c}) {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ${t.inHeight}) {\n                continue;\n              }\n\n              for (int wC = 0; wC < ${p};\n                  wC += ${h}) {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ${t.inWidth}) {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ${r?i?`(((batch * ${t.inDepth} + xD) * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`((xD * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`wD * ${f} * ${p} +\n                      wR * ${p} + wC`};\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `);let x=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===e&&(x="avgValue / count");const _=4*Math.floor(s/4),w=s%4,S=`\n      if (${v}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec3 strides =\n        ivec3(${o}, ${a}, ${l});\n      const ivec3 pads = ivec3(${m}, ${g}, ${y});\n      const float initializationValue = ${b};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ${t.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${b});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ${d};\n            wD += ${u}) {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ${t.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${f};\n            wR += ${c}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${_}; wC += 4) {\n              int xC = xCCorner + wC * ${h};\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${h}, ch),\n                getValue(batch, xD, xR, xC + 2 * ${h}, ch),\n                getValue(batch, xD, xR, xC + 3 * ${h}, ch)\n              );\n\n              ${S}\n            }\n\n            int xC = xCCorner + ${_};\n            if (${1===w}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ${S}\n            } else if (${2===w}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${h}, ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ${S}\n            } else if (${3===w}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${h}, ch),\n                getValue(batch, xD, xR, xC + 2 * ${h}, ch),\n                initializationValue\n              );\n\n              ${S}\n            }\n          }\n          setOutput(${x});\n        }\n      }\n    `}}class xS{constructor(t,e){this.variableNames=["x"];const n=t.windowSize,r=t.batchSize,i=t.inSize,s=Math.ceil(i/n);this.outputShape=[r,s];let o="0.0",a="";"prod"===e?o="1.0":"min"===e?(o="1.0 / 1e-20",a="min"):"max"===e&&(o="-1.0 / 1e-20",a="max");let l=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"sum"===e?l="sumValue":"prod"===e?l="prodValue":"all"===e?l="allValue":"any"===e&&(l="anyValue");const u=4*Math.floor(n/4),c=n%4;let h=`\n      if (${"sum"===e}) {\n        sumValue += dot(values, ones);\n      } else if (${"prod"===e}) {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ${a}(values, minMaxValue);\n      }\n    `,d="vec4";"all"===e?(o="1.0",h="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===e&&(o="0.0",h="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");let f="";i%n>0&&(f=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return initializationValue;\n        }\n      `),this.userCode=`\n      const float initializationValue = ${o};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${f}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        vec4 minMaxValue = vec4(${o});\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ${u}; i += 4) {\n          int inIdx = inOffset + i;\n          ${d} values = ${d}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${h}\n        }\n\n        int inIdx = inOffset + ${u};\n        if (${1===c}) {\n          ${d} values = ${d}(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ${h}\n        } else if (${2===c}) {\n          ${d} values = ${d}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ${h}\n        } else if (${3===c}) {\n          ${d} values = ${d}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ${h}\n        }\n        setOutput(${l});\n      }\n    `}}class _S{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;let n="";for(let i=0;i<4;i++){let t="thisRC = rc;";i%2==1&&(t+="thisRC.z += 1;"),i>1&&(t+="thisRC.y += 1;"),n+=`\n        ${t}\n        ${i>0?"if(thisRC.y < rows && thisRC.z < cols){":""}\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[${i}] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ${i>0?"}":""}\n      `}var r;this.userCode=`\n      ${r=e,`\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ${Y_(["r","c","d"],r)}\n      return ivec3(r, c, d);\n    }\n  `}\n      ${K_(t)}\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ${t[1]};\n        int cols = ${t[2]};\n\n        ${n}\n\n        setOutput(result);\n      }\n    `}}class wS{constructor(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;const[,r,i]=e.shape,[,s,o]=t.shape,a=[n&&s>1?r-1:r,n&&o>1?i-1:i],l=[n&&s>1?s-1:s,n&&o>1?o-1:o],u=a[0]/l[0],c=a[1]/l[1],h=1/u,d=1/c,f=2*Math.ceil(h)+2,p=2*Math.ceil(d)+2;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${u});\n        const float widthScale = float(${c});\n\n        const float invHeightScale = float(${h});\n        const float invWidthScale = float(${d});\n\n        const int winHeight = int(${f});\n        const int winWidth = int(${p});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${s}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${o}) {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `}}class SS{constructor(t,e,n,r){this.variableNames=["A"],this.outputShape=[];const[i,s,o,a]=t;this.outputShape=[i,e,n,a];const l=[r&&e>1?s-1:s,r&&n>1?o-1:o],u=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${l[0]/u[0]},\n          ${l[1]/u[1]});\n      const vec2 inputShapeRC = vec2(${s}.0, ${o}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    `}}class CS{constructor(t,e,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,s,o,a]=t;this.outputShape=[i,e,n,a];const l=[r&&e>1?s-1:s,r&&n>1?o-1:o],u=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode=`\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ${l[0]/u[0]},\n          ${l[1]/u[1]},\n          ${l[1]/u[1]});\n      const vec3 inputShapeRC = vec3(${s}.0, ${o}.0,\n                                     ${o}.0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ${a-1};\n        bool hasNextRow = coords.z < ${n-1};\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    `}}class ES{constructor(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;const[,r,i]=e.shape,[,s,o]=t.shape,a=[n&&s>1?r-1:r,n&&o>1?i-1:i],l=[n&&s>1?s-1:s,n&&o>1?o-1:o],u=a[0]/l[0],c=a[1]/l[1],h=1/u,d=1/c,f=2*Math.ceil(h)+2,p=2*Math.ceil(d)+2;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${u});\n        const float widthScale = float(${c});\n\n        const float invHeightScale = float(${h});\n        const float invWidthScale = float(${d});\n\n        const int winHeight = int(${f});\n        const int winWidth = int(${p});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${s}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${o}) {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(${a[0]}) *\n                (float(dyR) / float(${l[0]}));\n\n            float sourceFracCol =\n                float(${a[1]}) *\n                  (float(dyC) / float(${l[1]}));\n\n            int sourceNearestRow = int(min(\n                float(int(${r}) - 1),\n                ${n} ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(${i}) - 1),\n                ${n} ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `}}class kS{constructor(t,e,n,r){this.variableNames=["A"],this.outputShape=[];const[i,s,o,a]=t;this.outputShape=[i,e,n,a];const l=[r&&e>1?s-1:s,r&&n>1?o-1:o],u=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${l[0]/u[0]},\n          ${l[1]/u[1]});\n      const vec2 inputShapeRC = vec2(${s}.0, ${o}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${r?"0.5":"0.0"})));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    `}}class AS{constructor(t,e){this.variableNames=["x"];const n=t.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);if(this.outputShape=t,1===n)return void(this.userCode=`\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(${t[0]} - coord - 1));\n        }\n      `);const r=t.map((n,r)=>(n=>-1!==e.indexOf(n)&&1!==t[n]?`${t[n]} - coords[${n}] - 1`:`coords[${n}]`)(r)).join(","),i=iw(n);this.userCode=`\n      void main() {\n        ${i} coords = getOutputCoords();\n        setOutput(getX(${r}));\n      }\n    `}}class DS{constructor(t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const n=t.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);this.outputShape=t;const r=H_("rc",n),i=`${r[n-1]} + 1 < ${this.outputShape[n-1]}`,s=`${r[n-2]} + 1 < ${this.outputShape[n-2]}`,o=iw(n);function a(n){const r=t.map((r,i)=>function(n,r){return-1!==e.indexOf(n)&&1!==t[n]?`${t[n]} - ${r[n]} - 1`:""+r[n]}(i,n));return`getChannel(getX(${r.join(",")}), vec2(${r.slice(-2).join(",")}))`}this.userCode=1===n?`\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(${t[0]} - rc - 1),\n            ${t[0]} - rc - 1);\n          if(${i}){\n              result.g = getChannel(getX(${t[0]} - (rc  + 1) - 1),\n                ${t[0]} - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      `:`\n        void main() {\n          ${o} rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ${function(t){return a(t)}(r.slice())};\n          if(${i}){\n            result.g = ${function(t){return t[n-1]="("+t[n-1]+" + 1)",a(t)}(r.slice())};\n          }\n          if(${s}) {\n            result.b = ${function(t){return t[n-2]="("+t[n-2]+" + 1)",a(t)}(r.slice())};\n            if(${i}) {\n              result.a = ${function(t){return t[n-1]="("+t[n-1]+" + 1)",t[n-2]="("+t[n-2]+" + 1)",a(t)}(r.slice())};\n            }\n          }\n          setOutput(result);\n        }\n    `}}class NS{constructor(t,e,n,r,i,s,o=!0){this.variableNames=["updates","indices","defaultValue"],this.outputShape=s;const a=iw(i.length),l=iw(s.length);let u="";1===n?u="i":2===n&&(u="i, j");let c="";1===r?c="i":2===r&&(c="i, coords[1]"),this.userCode=`\n        ${a} strides = ${a}(${i});\n\n        void main() {\n          ${l} coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ${t}; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ${e}; j++) {\n              int index = round(getIndices(${u}));\n              flattenedIndex += index * ${e>1?"strides[j]":"strides"};\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += getUpdates(${c});\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      `}}class TS{constructor(t,e){this.variableNames=["x","segmentIds"];const n=t.windowSize,r=t.batchSize,i=t.inSize,s=t.numSegments,o=s*Math.ceil(i/n);this.outputShape=[r,o];const a=4*Math.floor(n/4),l=n%4,u="\n        sumValue += dot(values, segFilter);\n    ";let c="";i%n>0&&(c=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return initializationValue;\n        }\n      `);let h="";i%n>0&&(h=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return -1.0;\n        }\n      `),this.userCode=`\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        ${c}\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ${h}\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ${s})) * float(${n}));\n        int currentSeg = int(mod(float(outIdx), float(${s})));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${a}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ${u}\n        }\n\n        int inIdx = inOffset + ${a};\n        if (${1===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ${u}\n        } else if (${2===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ${u}\n        } else if (${3===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ${u}\n        }\n        setOutput(sumValue);\n      }\n    `}}class OS{constructor(t,e,n){let r,i;if(this.variableNames=["c","a","b"],this.outputShape=e,n>4)throw Error(`Where for rank ${n} is not yet supported`);if(1===n)i="resRC",r="resRC";else{const n=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],o=[];for(let r=0;r<e.length;r++)o.push(""+n[r]),r<t&&s.push(""+n[r]);r=s.join(),i=o.join()}const s=iw(n);this.userCode=`\n      void main() {\n        ${s} resRC = getOutputCoords();\n        float cVal = getC(${r});\n        if (cVal >= 1.0) {\n          setOutput(getA(${i}));\n        } else {\n          setOutput(getB(${i}));\n        }\n      }\n    `}}class IS{constructor(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;const e=iw(this.rank),n=`uniform int start[${this.rank}];`,r=function(t){if(1===t)return"sourceLoc";if(t<=6)return RS.slice(0,t).map(t=>"sourceLoc."+t).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}(this.rank);let i;i=`\n        ${e} sourceLoc;\n        ${e} coords = getOutputCoords();\n        ${t.map((t,e)=>`sourceLoc.${RS[e]} = start[${e}] + coords.${RS[e]};`).join("\n")}\n      `,this.userCode=`\n      ${n}\n      void main() {\n        ${i}\n        setOutput(getSource(${r}));\n      }\n    `}getCustomSetupFunc(t){if(t.length!==this.rank)throw Error(`The rank (${this.rank}) of the program must match the length of start (${t.length})`);return(e,n)=>{null==this.startLoc&&(this.startLoc=e.getUniformLocationNoThrow(n,"start"),null==this.startLoc)||e.gl.uniform1iv(this.startLoc,t)}}}const RS=["x","y","z","w","u","v"];class FS{constructor(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;const e=iw(this.rank),n=H_("coords",this.rank),r=H_("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":`vec2(${r.slice(-2).join()})`,s=`getChannel(getSource(${r.join()}), ${i})`,o=`\n      result.x = ${s};\n      if (++${n[this.rank-1]} < ${t[this.rank-1]}) {\n        ++${r[this.rank-1]};\n        result.y = ${s};\n        --${r[this.rank-1]};\n      }\n    `,a=1===this.rank?"":`\n      --${n[this.rank-1]};\n      if (++${n[this.rank-2]} < ${t[this.rank-2]}) {\n        ++${r[this.rank-2]};\n        result.z = ${s};\n        if (++${n[this.rank-1]} < ${t[this.rank-1]}) {\n          ++${r[this.rank-1]};\n          result.w = ${s};\n        }\n      }\n    `,l=this.rank<=4?`sourceLoc = coords +\n            ${e}(${t.map((t,e)=>`start[${e}]`).join()});`:t.map((t,e)=>`${r[e]} = ${n[e]} + start[${e}];`).join("\n");this.userCode=`\n      uniform int start[${this.rank}];\n      void main() {\n        ${e} coords = getOutputCoords();\n        ${e} sourceLoc;\n        ${l}\n        vec4 result = vec4(0.);\n        ${o}\n        ${a}\n        setOutput(result);\n      }\n    `}getCustomSetupFunc(t){if(t.length!==this.rank)throw Error(`The rank (${this.rank}) of the program must match the length of start (${t.length})`);return(e,n)=>{null==this.startLoc&&(this.startLoc=e.getUniformLocationNoThrow(n,"start"),null==this.startLoc)||e.gl.uniform1iv(this.startLoc,t)}}}class MS{constructor(t,e,n){this.variableNames=["x"],this.outputShape=n;const r=n.length,i=iw(n.length),s=iw(n.length);let o="";if(1===r)o="coords * strides + begin";else{let t=0;o=n.map((e,r)=>(t++,1===n.length?`coords * strides[${r}] + begin[${r}]`:`coords[${t-1}] * strides[${r}] + begin[${r}]`)).join(",")}this.userCode=`\n      ${i} begin = ${i}(${t});\n      ${i} strides = ${i}(${e});\n\n      void main() {\n        ${s} coords = getOutputCoords();\n        setOutput(getX(${o}));\n      }\n    `}}class $S{constructor(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}acquireTexture(t,e,n){const r=zS(e,n),i=LS(t,r,n);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const s=PS(t,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=s,this.log();const t=this.freeTextures[i].shift();return this.usedTextures[i].push(t),t}let o;return r===g_.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):r===g_.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):r===g_.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):r===g_.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):r===g_.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[i].push(o),this.numUsedTextures++,this._numBytesAllocated+=s,this.log(),o}releaseTexture(t,e,n,r){if(null==this.freeTextures)return;const i=zS(n,r),s=LS(e,i,r);s in this.freeTextures||(this.freeTextures[s]=[]);const o=PS(e,i,this.gpgpu.gl,this.gpgpu.textureConfig,r),a=W().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==a&&this._numBytesAllocated>a?(this.gpgpu.deleteMatrixTexture(t),this._numBytesAllocated-=o):(this.freeTextures[s].push(t),this.numFreeTextures++,this._numBytesFree+=o),this.numUsedTextures--;const l=this.usedTextures[s],u=l.indexOf(t);if(u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l.splice(u,1),this.log()}log(){if(!this.logEnabled)return;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${this.numFreeTextures+this.numUsedTextures})`);const t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: "+this._numBytesAllocated),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(null!=this.freeTextures){for(const t in this.freeTextures)this.freeTextures[t].forEach(t=>{this.gpgpu.deleteMatrixTexture(t)});for(const t in this.usedTextures)this.usedTextures[t].forEach(t=>{this.gpgpu.deleteMatrixTexture(t)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function PS(t,e,n,r,i){const s=function(t,e){switch(t){case g_.PACKED_2X2_FLOAT32:return nS(e);case g_.PACKED_2X2_FLOAT16:return rS(e);case g_.UNPACKED_FLOAT32:return Jw(e);case g_.UNPACKED_FLOAT16:return tS(e);case g_.PACKED_4X1_UNSIGNED_BYTE:return eS(e);default:throw new Error("Unknown physical texture type "+t)}}(e,r);let o;if(i){const[e,n]=b_(t[0],t[1]);o=e*n}else{const[e,n]=y_(t[0],t[1]);o=e*n}return o*function(t,e){if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===t.RGBA)return 16;if(e===t.RGBA16F)return 8;throw new Error("Unknown internal format "+e)}(n,s)}function zS(t,e){if(t===m_.UPLOAD)return g_.PACKED_2X2_FLOAT32;if(t===m_.RENDER||null==t)return function(t){return W().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?g_.PACKED_2X2_FLOAT32:g_.UNPACKED_FLOAT32:t?g_.PACKED_2X2_FLOAT16:g_.UNPACKED_FLOAT16}(e);if(t===m_.DOWNLOAD||t===m_.PIXELS)return g_.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+t)}function LS(t,e,n){return`${t[0]}_${t[1]}_${e}_${n}`}class BS{constructor(t,e){this.variableNames=["A"];const n=new Array(t.length);for(let s=0;s<n.length;s++)n[s]=t[s]*e[s];this.outputShape=n,this.rank=n.length;const r=iw(this.rank),i=function(t){const e=t.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(1===e)return`imod(resRC, ${t[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let i=0;i<t.length;i++)r.push(`imod(${n[i]}, ${t[i]})`);return r.join()}(t);this.userCode=`\n      void main() {\n        ${r} resRC = getOutputCoords();\n        setOutput(getA(${i}));\n      }\n    `}}class jS{constructor(t,e){this.variableNames=["A"],this.outputShape=t,this.userCode=`\n      float unaryOperation(float x) {\n        ${e}\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}const US="return abs(x);",VS="if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n",WS="if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",qS=`\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ${y.SELU_SCALEALPHA};\n  float scale = ${y.SELU_SCALE};\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n`,HS="return -x;",GS="return ceil(x);",YS="return floor(x);",KS="return exp(x);",XS="return exp(x) - 1.0;",ZS=`\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = ${y.ERF_P};\n  float a1 = ${y.ERF_A1};\n  float a2 = ${y.ERF_A2};\n  float a3 = ${y.ERF_A3};\n  float a4 = ${y.ERF_A4};\n  float a5 = ${y.ERF_A5};\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n`,QS="return x;",JS="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",tC="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",eC="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n";class nC{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode=`\n      vec4 unaryOperation(vec4 x) {\n        ${e}\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}class rC{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t;const e=t.length,n=H_("rc",e),r=iw(e),i=function(t,e){if(1===t)return"rc";let n="";for(let r=0;r<t;r++)n+=e[r],r<t-1&&(n+=",");return n}(e,n),s=n.slice(-2),o=e<=1?"rc":`vec2(${s.join(",")})`;this.userCode=`\n      void main() {\n        ${r} rc = getOutputCoords();\n        vec4 packedInput = getA(${i});\n\n        setOutput(getChannel(packedInput, ${o}));\n      }\n    `}}const{segment_util:iC}=y,sC=v.split,oC=v.tile,aC=v.topkImpl,lC=v.whereImpl,uC={};function cC(t,e=!1){if("linear"===t)return"return x;";if("relu"===t)return e?JS:VS;if("elu"===t)return e?eC:"return (x >= 0.0) ? x : (exp(x) - 1.0);";if("relu6"===t)return e?tC:WS;if("prelu"===t)return e?vw:gw;throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}class hC extends ac{constructor(t){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.warnedAboutMemory=!1,this.warnedAboutCPUBackend=!1,this.pendingDeletes=0,this.disposed=!1,!W().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==t){const t=f_(W().getNumber("WEBGL_VERSION"));this.binaryCache=((e=W().getNumber("WEBGL_VERSION"))in uC||(uC[e]={}),uC[e]),this.gpgpu=new iS(t),this.canvas=t.canvas,this.gpgpuCreatedLocally=!0}else this.gpgpu=t,this.binaryCache={},this.gpgpuCreatedLocally=!1,this.canvas=t.gl.canvas;var e;this.textureManager=new $S(this.gpgpu),this.numMBBeforeWarning=null==W().global.screen?1024:W().global.screen.height*W().global.screen.width*window.devicePixelRatio*600/1024/1024,this.texData=new oc(this,An())}numDataIds(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes}write(t,e,n){if((W().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||W().getBool("DEBUG"))&&this.checkNumericalProblems(t),"complex64"===n&&null!=t)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={};return this.texData.set(r,{shape:e,dtype:n,values:t,usage:m_.UPLOAD}),r}move(t,e,n,r){if(W().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:n,dtype:r,values:e,usage:m_.UPLOAD})}readSync(t){const e=this.texData.get(t),{values:n,dtype:i,complexTensors:s,slice:o,shape:a,isPacked:l}=e;if(null!=o){let e;e=l?new nC(a,QS):new jS(a,QS);const n=this.runWebGLProgram(e,[{dataId:t,shape:a,dtype:i}],i),r=this.readSync(n.dataId);return this.disposeData(n.dataId),r}if(null!=n)return this.convertAndCacheOnCPU(t);if("string"===i)return n;const u=null!=this.activeTimers;let c,h;if(u&&(c=r.now()),"complex64"===i){const t=s.real.dataSync(),e=s.imag.dataSync();h=y.mergeRealAndImagArrays(t,e)}else h=this.getValuesFromTexture(t);return u&&(this.downloadWaitMs+=r.now()-c),this.convertAndCacheOnCPU(t,h)}async read(t){if(this.pendingRead.has(t)){const e=this.pendingRead.get(t);return new Promise(t=>e.push(t))}const e=this.texData.get(t),{values:n,shape:i,slice:s,dtype:o,complexTensors:a,isPacked:l}=e;if(null!=s){let e;e=l?new nC(i,QS):new jS(i,QS);const n=this.runWebGLProgram(e,[{dataId:t,shape:i,dtype:o}],o),r=this.read(n.dataId);return this.disposeData(n.dataId),r}if(null!=n)return this.convertAndCacheOnCPU(t);if(!W().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===W().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u,c,h=null;if("complex64"!==o&&W().get("WEBGL_BUFFER_SUPPORTED")){u=this.decode(t);const e=this.texData.get(u.dataId);h=this.gpgpu.createBufferFromTexture(e.texture,...v_(i))}if(this.pendingRead.set(t,[]),"complex64"!==o&&await this.gpgpu.createAndWaitForFence(),"complex64"===o){const t=await Promise.all([a.real.data(),a.imag.data()]);c=y.mergeRealAndImagArrays(t[0],t[1])}else if(null==h)c=this.getValuesFromTexture(t);else{const t=r.sizeFromShape(i);c=this.gpgpu.downloadFloat32MatrixFromBuffer(h,t)}null!=u&&this.disposeData(u.dataId);const d=this.convertAndCacheOnCPU(t,c),f=this.pendingRead.get(t);return this.pendingRead.delete(t),f.forEach(t=>t(d)),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),d}checkNumericalProblems(t){if(null!=t)for(let e=0;e<t.length;e++){const n=t[e];if(!w_(n)){if(W().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error(`The value ${n} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`);throw Error(`The value ${n} cannot be represented on this device.`)}}}getValuesFromTexture(t){const{shape:e,dtype:n,isPacked:i}=this.texData.get(t),s=r.sizeFromShape(e);if(W().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const n=this.decode(t),r=this.texData.get(n.dataId),i=this.gpgpu.downloadMatrixFromPackedTexture(r.texture,...v_(e)).subarray(0,s);return this.disposeData(n.dataId),i}const o=W().getBool("WEBGL_PACK")&&!0===i,a=o?R_(e):e,l=o?new qw(a):new Ww(a),u=this.runWebGLProgram(l,[{shape:a,dtype:n,dataId:t}],"float32"),c=this.texData.get(u.dataId),h=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(c.texture,c.texShape[0],c.texShape[1]).subarray(0,s);return this.disposeData(u.dataId),h}async time(t){const e=this.activeTimers,n=[];let i=!1;null==this.programTimersStack?(this.programTimersStack=n,i=!0):this.activeTimers.push(n),this.activeTimers=n,t();const s=r.flatten(this.activeTimers.map(t=>t.query)).filter(t=>null!=t),o=r.flatten(this.activeTimers.map(t=>t.name)).filter(t=>null!=t);this.activeTimers=e,i&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};if(W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const t=await Promise.all(s);a.kernelMs=r.sum(t),a.getExtraProfileInfo=()=>t.map((t,e)=>({name:o[e],ms:t})).map(t=>`${t.name}: ${t.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:r.now(),endMs:null}}endTimer(t){return W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=r.now(),t)}async getQueryTime(t){return W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.waitForQueryAndGetTime(t):t.endMs-t.startMs}disposeData(t){if(this.pendingDisposal.has(t))return;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(!this.texData.has(t))return;this.releaseGPUData(t);const{complexTensors:e}=this.texData.get(t);null!=e&&(e.real.dispose(),e.imag.dispose()),this.texData.delete(t)}releaseGPUData(t){const{texture:e,dtype:n,texShape:r,usage:i,isPacked:s,slice:o}=this.texData.get(t),a=o&&o.origDataId||t,l=this.dataRefCount.get(a);l>1?this.dataRefCount.set(a,l-1):(this.dataRefCount.delete(a),null!=e&&(this.numBytesInGPU-=this.computeBytes(r,n),this.textureManager.releaseTexture(e,r,i,s)));const u=this.texData.get(t);u.texture=null,u.texShape=null,u.isPacked=!1,u.slice=null}getTexture(t){return this.uploadToGPU(t),this.texData.get(t).texture}getDataInfo(t){return this.texData.get(t)}getCPUBackend(){return W().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=An().findBackend("cpu")),this.cpuBackend):null}shouldExecuteOnCPU(t,e=128){const n=this.getCPUBackend();return this.warnedAboutCPUBackend||null!=n||W().getBool("IS_TEST")||(console.warn("Your application contains ops that are small enough to be executed on the CPU backend, however the CPU backend cannot be found. Consider importing the CPU backend (@tensorflow/tfjs-backend-cpu) for better performance."),this.warnedAboutCPUBackend=!0),null!=n&&t.every(t=>null==this.texData.get(t.dataId).texture&&r.sizeFromShape(t.shape)<e)}getGPGPUContext(){return this.gpgpu}complex(t,e){const n=this.makeOutput(t.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:An().keep(t.clone()),imag:An().keep(e.clone())},n}real(t){return this.texData.get(t.dataId).complexTensors.real.clone()}imag(t){return this.texData.get(t.dataId).complexTensors.imag.clone()}slice(t,e,n){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,e,n);if(0===r.sizeFromShape(n))return Gn([],n,t.dtype);const{isPacked:i}=this.texData.get(t.dataId),s=o.isSliceContinous(t.shape,e,n);if(i||!s){const r=W().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new FS(n):new IS(n),i=r.getCustomSetupFunc(e);return this.compileAndRun(r,[t],null,i)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,e,n)}shallowSlice(t,e,n){const r=this.texData.get(t.dataId),i=this.makeOutput(n,t.dtype),s=this.texData.get(i.dataId);Object.assign(s,r),s.shape=n,s.dtype=t.dtype;let a=o.computeFlatOffset(e,t.strides);r.slice&&(a+=r.slice.flatOffset),s.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||t.dataId};const l=this.dataRefCount.get(s.slice.origDataId)||1;return this.dataRefCount.set(s.slice.origDataId,l+1),i}stridedSlice(t,e,n,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,e,n,r);const i=o.computeOutShape(e,n,r);if(i.some(t=>0===t))return Gn([],i);const s=new MS(e,r,i);return this.compileAndRun(s,[t])}reverse(t,e){const n=W().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new DS(t.shape,e):new AS(t.shape,e);return this.compileAndRun(n,[t])}concat(t,e){if("complex64"===t[0].dtype){const n=t.map(t=>_i(t)),r=t.map(t=>xi(t));return kr(this.concat(n,e),this.concat(r,e))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,e);if(1===t.length)return t[0];if(t.length>W().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const n=Math.floor(t.length/2),r=this.concat(t.slice(0,n),e),i=this.concat(t.slice(n),e);return this.concat([r,i],e)}if(W().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){const n=new Cw(t.map(t=>t.shape),e);return this.compileAndRun(n,t)}const n=y.computeOutShape(t.map(t=>t.shape),e),i=t.map(t=>t.as2D(-1,r.sizeFromShape(t.shape.slice(e)))),s=new Sw(i.map(t=>t.shape));return this.compileAndRun(s,i).reshape(n)}neg(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(W().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,HS,t.dtype);const e=new jS(t.shape,HS);return this.compileAndRun(e,[t])}batchMatMul(t,e,n,r){const i=n?t.shape[2]:t.shape[1],s=r?e.shape[1]:e.shape[2],o=n?t.shape[1]:t.shape[2],[a,,]=t.shape;if((1===i||1===s)&&o>1e3){n&&(t=Xe(t,[0,2,1])),r&&(e=Xe(e,[0,2,1]));const i=1===s?t:t.as3D(a,o,1),l=1===s?2:1,u=1===s?e.as3D(a,1,o):e;return this.multiply(i,u).sum(l,!0)}const l=ye(t.dtype,e.dtype),u=new dS(t.shape,[a,i,s],n,r);return this.compileAndRun(u,[t,e],l)}fusedBatchMatMul({a:t,b:e,transposeA:n,transposeB:r,bias:i,activation:s,preluActivationWeights:o}){const a=n?t.shape[2]:t.shape[1],l=r?e.shape[1]:e.shape[2],[u,,]=t.shape,c=ye(t.dtype,e.dtype),h=null!=i,d=null!=o,f=s?cC(s,!0):null,p=new dS(t.shape,[u,a,l],n,r,h,f,d),m=[t,e];return i&&m.push(i),o&&m.push(o),this.compileAndRun(p,m,c)}multiply(t,e){if("complex64"===t.dtype){const n=this.texData.get(t.dataId),r=this.texData.get(e.dataId),i=new dw("return areal * breal - aimag * bimag;",t.shape,e.shape),s=new dw("return areal * bimag + aimag * breal;",t.shape,e.shape),o=[this.makeComplexComponentTensorInfo(t,n.complexTensors.real),this.makeComplexComponentTensorInfo(t,n.complexTensors.imag),this.makeComplexComponentTensorInfo(e,r.complexTensors.real),this.makeComplexComponentTensorInfo(e,r.complexTensors.imag)],a=this.compileAndRun(i,o),l=this.compileAndRun(s,o),u=this.complex(a,l);return a.dispose(),l.dispose(),u}if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.multiply(t,e);if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,mw,t.dtype);const n=new yw(mw,t.shape,e.shape);return this.compileAndRun(n,[t,e],t.dtype)}batchNorm(t,e,n,r,i,s){const o=[t,e,n];let a=null;null!=r&&(a=r.shape,o.push(r));let l=null;if(null!=i&&(l=i.shape,o.push(i)),W().getBool("WEBGL_PACK_NORMALIZATION")){const r=new hw(t.shape,e.shape,n.shape,a,l,s);return this.compileAndRun(r,o)}const u=new cw(t.shape,e.shape,n.shape,a,l,s);return this.compileAndRun(u,o)}localResponseNormalization4D(t,e,n,r,i){const s=W().getBool("WEBGL_PACK_NORMALIZATION")?new uS(t.shape,e,n,r,i):new aS(t.shape,e,n,r,i);return this.compileAndRun(s,[t])}LRNGrad(t,e,n,r,i,s,o){const a=new lS(e.shape,r,i,s,o);return this.compileAndRun(a,[e,n,t])}tile(t,e){if("string"===t.dtype){const n=this.readSync(t.dataId).map(t=>r.decodeString(t)),i=Sr(t.shape,t.dtype,n);return oC(i,e)}const n=new BS(t.shape,e);return this.compileAndRun(n,[t])}pad(t,e,n){const r=W().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new yS(t.shape,e,n):new gS(t.shape,e,n);return this.compileAndRun(r,[t])}gather(t,e,n){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.gather(t,e,n);const r=new Xw(t.shape,e.size,n);return this.compileAndRun(r,[t,e])}batchToSpaceND(t,e,n){r.assert(t.rank<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const i=e.reduce((t,e)=>t*e),s=y.getReshaped(t.shape,e,i),o=y.getPermuted(s.length,e.length),a=y.getReshapedPermuted(t.shape,e,i),l=y.getSliceBeginCoords(n,e.length),u=y.getSliceSize(a,n,e.length);return Xe(t.reshape(s),o).reshape(a).slice(l,u)}spaceToBatchND(t,e,n){r.assert(t.rank<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const i=e.reduce((t,e)=>t*e),s=[[0,0]];s.push(...n);for(let r=1+e.length;r<t.shape.length;++r)s.push([0,0]);const o=t.pad(s),a=y.getReshaped(o.shape,e,i,!1),l=y.getPermuted(a.length,e.length,!1),u=y.getReshapedPermuted(o.shape,e,i,!1),c=Xe(o.reshape(a),l);return Ke(c,u)}reduce(t,e,n){const r=t.shape[0],i=t.shape[1],s=y.computeOptimalWindowSize(i),o=new xS({windowSize:s,inSize:i,batchSize:r},e),a=this.compileAndRun(o,[t],n);return 1===a.shape[1]?a:this.reduce(a,e,n)}argReduce(t,e,n=null){let r=t.shape[0],i=t.shape[1];null!=n&&(r=n.shape[0],i=n.shape[1]);const s=y.computeOptimalWindowSize(i),o=new W_({windowSize:s,inSize:i,batchSize:r},e,null==n),a=[t];null!=n&&a.push(n);const l=this.compileAndRun(o,a,"int32");return 1===l.shape[1]?l:this.argReduce(t,e,l)}argReducePacked(t,e,n=null){const r=null!=n?n.shape:t.shape,i=y.computeOptimalWindowSize(r[r.length-1]),s=new aw(r,i,e,null==n),o=this.compileAndRun(s,null==n?[t]:[t,n],"int32");return o.rank===t.rank?this.argReducePacked(t,e,o):o}sum(t,e){y.assertAxesAreInnerMostDims("sum",e,t.rank);const[n,i]=y.computeOutAndReduceShapes(t.shape,e),s=r.sizeFromShape(i),o=t.as2D(-1,s),a=ve(t.dtype);return this.reduce(o,"sum",a).reshape(n)}prod(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,e);const[n,i]=y.computeOutAndReduceShapes(t.shape,e),s=r.sizeFromShape(i),o=t.as2D(-1,s),a=ve(t.dtype);return this.reduce(o,"prod",a).reshape(n)}unsortedSegmentSum(t,e,n){let i=0;const s=y.getAxesPermutation([i],t.rank);let o=t;null!=s&&(o=Xe(t,s),i=y.getInnerMostAxes(1,t.rank)[0]);const a=iC.computeOutShape(o.shape,i,n),l=r.sizeFromShape([o.shape[i]]),u=o.as2D(-1,l),c=ve(t.dtype);let h=this.segOpCompute(u,"unsortedSegmentSum",e,c,n).reshape(a);return null!=s&&(h=Xe(h,y.getUndoAxesPermutation(s))),h}segOpCompute(t,e,n,r,i){const s=t.shape[0],o=t.shape[1],a=iC.segOpComputeOptimalWindowSize(o,i),l=new TS({windowSize:a,inSize:o,batchSize:s,numSegments:i},e),u=this.compileAndRun(l,[t,n],r);return u.shape[1]===i?u:(n=Ys(0,i).tile([o/a]),this.segOpCompute(u,e,n,r,i))}argMinMaxReduce(t,e,n){const i=[e];if(y.assertAxesAreInnerMostDims("arg"+n.charAt(0).toUpperCase()+n.slice(1),i,t.rank),!W().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){const[e,s]=y.computeOutAndReduceShapes(t.shape,i),o=r.sizeFromShape(s),a=t.as2D(-1,o);return this.argReduce(a,n).reshape(e)}return this.argReducePacked(t,n)}argMin(t,e){return this.argMinMaxReduce(t,e,"min")}argMax(t,e){return this.argMinMaxReduce(t,e,"max")}cumsum(t,e,n,r){if(e!==t.rank-1)throw new Error(`WebGL cumsum shader expects an inner-most axis=${t.rank-1} but got axis=`+e);const i=t.shape[e];let s=t;for(let o=0;o<=Math.ceil(Math.log2(i))-1;o++){const e=new Pw(t.shape,!1,r),n=e.getCustomSetupFunc(o),i=s;s=this.compileAndRun(e,[s],s.dtype,n),i.dispose()}if(n){const e=new Pw(t.shape,n,r),i=s;s=this.compileAndRun(e,[s]),i.dispose()}return s}equal(t,e){if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(equal(a, b));\n","bool");const n=new yw("return float(a == b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")}notEqual(t,e){if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(notEqual(a, b));\n","bool");const n=new yw("return float(a != b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")}less(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.less(t,e);if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(lessThan(a, b));\n","bool");const n=new yw("return float(a < b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")}lessEqual(t,e){if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(lessThanEqual(a, b));\n","bool");const n=new yw("return float(a <= b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")}greater(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.greater(t,e);if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(greaterThan(a, b));\n","bool");const n=new yw("return float(a > b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")}greaterEqual(t,e){if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(greaterThanEqual(a, b));\n","bool");const n=new yw("return float(a >= b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")}logicalNot(t){const e=new jS(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(e,[t])}logicalAnd(t,e){if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");const n=new yw("return float(a >= 1.0 && b >= 1.0);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")}logicalOr(t,e){if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");const n=new yw("return float(a >= 1.0 || b >= 1.0);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")}select(t,e,n){const r=new OS(t.rank,e.shape,e.rank);return this.compileAndRun(r,[t,e,n],ye(e.dtype,n.dtype))}where(t){y.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const e=t.dataSync();return lC(t.shape,e)}topk(t,e,n){const r=t.dataSync();return aC(r,t.shape,t.dtype,e,n)}min(t,e){y.assertAxesAreInnerMostDims("min",e,t.rank);const[n,i]=y.computeOutAndReduceShapes(t.shape,e),s=r.sizeFromShape(i),o=t.as2D(-1,s);return this.reduce(o,"min",o.dtype).reshape(n)}minimum(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.minimum(t,e);const n=W().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new bw("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new yw("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])}mod(t,e){const n=W().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new bw("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new yw("if (b == 0.0) return NAN;\n  return mod(a, b);",t.shape,e.shape);return this.compileAndRun(n,[t,e])}maximum(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.maximum(t,e);const n=W().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new bw("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new yw("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])}all(t,e){y.assertAxesAreInnerMostDims("all",e,t.rank);const[n,i]=y.computeOutAndReduceShapes(t.shape,e),s=r.sizeFromShape(i),o=t.as2D(-1,s);return this.reduce(o,"all",o.dtype).reshape(n)}any(t,e){y.assertAxesAreInnerMostDims("any",e,t.rank);const[n,i]=y.computeOutAndReduceShapes(t.shape,e),s=r.sizeFromShape(i),o=t.as2D(-1,s);return this.reduce(o,"any",o.dtype).reshape(n)}floorDiv(t,e){if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");const n=new yw("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",t.shape,e.shape);return this.compileAndRun(n,[t,e],"int32")}add(t,e){if("complex64"===t.dtype&&"complex64"===e.dtype)return this.complexSeparableBinaryOp(t,e,fw);if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.add(t,e);const n=ye(t.dtype,e.dtype);if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,fw,n);const r=new yw(fw,t.shape,e.shape);return this.compileAndRun(r,[t,e],n)}packedUnaryOp(t,e,n){const r=new nC(t.shape,e);return this.compileAndRun(r,[t],n)}packedBinaryOp(t,e,n,r,i=!1){const s=new bw(n,t.shape,e.shape,i);return this.compileAndRun(s,[t,e],r)}complexSeparableBinaryOp(t,e,n){const r=this.texData.get(t.dataId),i=this.texData.get(e.dataId),[s,o]=[[r.complexTensors.real,i.complexTensors.real],[r.complexTensors.imag,i.complexTensors.imag]].map(r=>{const[i,s]=r,o=this.makeComplexComponentTensorInfo(t,i),a=this.makeComplexComponentTensorInfo(e,s),l=new yw(n,t.shape,e.shape);return this.compileAndRun(l,[o,a],ye(i.dtype,s.dtype))}),a=this.complex(s,o);return s.dispose(),o.dispose(),a}makeComplexComponentTensorInfo(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}addN(t){if(1===t.length)return t[0];if(t.length>W().get("WEBGL_MAX_TEXTURES_IN_SHADER")){const e=Math.floor(t.length/2),n=this.addN(t.slice(0,e)),r=this.addN(t.slice(e));return this.addN([n,r])}const e=t.map(t=>t.dtype).reduce((t,e)=>ye(t,e)),n=t.map(t=>t.shape),r=W().getBool("WEBGL_PACK")?new V_(t[0].shape,n):new U_(t[0].shape,n);return this.compileAndRun(r,t,e)}subtract(t,e){if("complex64"===t.dtype&&"complex64"===e.dtype)return this.complexSeparableBinaryOp(t,e,pw);if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.subtract(t,e);const n=ye(t.dtype,e.dtype);if(W().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,pw,t.dtype);const r=new yw(pw,t.shape,e.shape);return this.compileAndRun(r,[t,e],n)}pow(t,e){const n=W().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new bw("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new yw("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",t.shape,e.shape),r=ye(t.dtype,e.dtype);return this.compileAndRun(n,[t,e],r)}ceil(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(W().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,GS,t.dtype);const e=new jS(t.shape,GS);return this.compileAndRun(e,[t])}floor(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(W().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,YS,t.dtype);const e=new jS(t.shape,YS);return this.compileAndRun(e,[t])}sign(t){const e=new jS(t.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(e,[t])}isNaN(t){const e=new jS(t.shape,"return float(isnan(x));");return this.compileAndRun(e,[t],"bool")}isInf(t){const e=new jS(t.shape,"return float(isinf(x));");return this.compileAndRun(e,[t],"bool")}isFinite(t){const e=new jS(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(e,[t],"bool")}round(t){const e=new jS(t.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(e,[t])}exp(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(W().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,KS,t.dtype);const e=new jS(t.shape,KS);return this.compileAndRun(e,[t])}expm1(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(W().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,XS,t.dtype);const e=new jS(t.shape,XS);return this.compileAndRun(e,[t])}softmax(t,e){const n=r.parseAxisParam([e],t.shape),i=Hi(t,n),s=y.expandShapeToKeepDim(i.shape,n),o=this.subtract(t,i.reshape(s)),a=this.exp(o),l=this.sum(a,n).reshape(s);return Hr(a,l)}log(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(W().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",t.dtype);const e=new jS(t.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(e,[t])}log1p(t){const e=new jS(t.shape,"return log(1.0 + x);");return this.compileAndRun(e,[t])}sqrt(t){const e=new jS(t.shape,"return sqrt(x);");return this.compileAndRun(e,[t])}rsqrt(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);const e=new jS(t.shape,"return inversesqrt(x);");return this.compileAndRun(e,[t])}reciprocal(t){const e=new jS(t.shape,"return 1.0 / x;");return this.compileAndRun(e,[t])}relu(t){let e;return e=W().getBool("WEBGL_PACK")?new nC(t.shape,JS):new jS(t.shape,VS),this.compileAndRun(e,[t])}relu6(t){let e;return e=W().getBool("WEBGL_PACK")?new nC(t.shape,tC):new jS(t.shape,WS),this.compileAndRun(e,[t])}prelu(t,e){const n=W().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new bw(vw,t.shape,e.shape):new yw(gw,t.shape,e.shape);return this.compileAndRun(n,[t,e])}elu(t){if(W().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,eC,t.dtype);const e=new jS(t.shape,"return (x >= 0.0) ? x : (exp(x) - 1.0);");return this.compileAndRun(e,[t])}eluDer(t,e){const n=W().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new bw("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",t.shape,e.shape):new yw("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,e.shape);return this.compileAndRun(n,[t,e])}selu(t){const e=new jS(t.shape,qS);return this.compileAndRun(e,[t])}int(t){const e=new jS(t.shape,"return float(int(x));");return this.compileAndRun(e,[t],"int32")}clip(t,e,n){let r;r=W().getBool("WEBGL_PACK_CLIP")?new _w(t.shape):new xw(t.shape);const i=r.getCustomSetupFunc(e,n);return this.compileAndRun(r,[t],null,i)}abs(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(W().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,US,t.dtype);const e=new jS(t.shape,US);return this.compileAndRun(e,[t])}complexAbs(t){const e=this.texData.get(t.dataId),n=new ww(t.shape),r=[this.makeComplexComponentTensorInfo(t,e.complexTensors.real),this.makeComplexComponentTensorInfo(t,e.complexTensors.imag)];return this.compileAndRun(n,r)}sigmoid(t){const e=new jS(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(e,[t])}softplus(t){const e=new jS(t.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(e,[t])}sin(t){const e=new jS(t.shape,"if (isnan(x)) return x;\n  return sin(x);\n");return this.compileAndRun(e,[t])}cos(t){const e=new jS(t.shape,"if (isnan(x)) return x;\n  return cos(x);\n");return this.compileAndRun(e,[t])}tan(t){const e=new jS(t.shape,"return tan(x);");return this.compileAndRun(e,[t])}asin(t){const e=new jS(t.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n");return this.compileAndRun(e,[t])}acos(t){const e=new jS(t.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n");return this.compileAndRun(e,[t])}atan(t){const e=new jS(t.shape,"if (isnan(x)) return x;\n  return atan(x);\n");return this.compileAndRun(e,[t])}atan2(t,e){const n=W().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new bw("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new yw("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])}sinh(t){const e=new jS(t.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(e,[t])}cosh(t){const e=new jS(t.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(e,[t])}tanh(t){const e=new jS(t.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(e,[t])}asinh(t){const e=new jS(t.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(e,[t])}acosh(t){const e=new jS(t.shape,"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));");return this.compileAndRun(e,[t])}atanh(t){const e=new jS(t.shape,"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;");return this.compileAndRun(e,[t])}erf(t){const e=new jS(t.shape,ZS);return this.compileAndRun(e,[t])}step(t,e){const n=new jS(t.shape,function(t=0){return`if (isnan(x)) return x;\n    return x > 0.0 ? 1.0 : float(${t});\n  `}(e));return this.compileAndRun(n,[t])}conv2dByMatMul(t,e,n,i,s,o){const a=t.shape,l=this.texData.get(t.dataId),u="channelsLast"===n.dataFormat,c=a[2]%2!=0&&!!l.isPacked;if((1==a[0]*a[1]*a[2]||1===n.outChannels)&&n.inChannels>1e3||!W().getBool("WEBGL_LAZILY_UNPACK")||!W().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!c){const r=this.reshape(t,[1,u?a[0]*a[1]*a[2]:a[0]*a[2]*a[3],n.inChannels]),l=this.reshape(e,[1,n.inChannels,n.outChannels]);return this.reshape(this.fusedBatchMatMul({a:r,b:l,transposeA:!1,transposeB:!1,bias:i,activation:s,preluActivationWeights:o}),n.outShape)}const h={dataId:t.dataId,shape:[1,u?a[0]*a[1]*(a[2]+1):a[0]*a[2]*(a[3]+1),n.inChannels],dtype:t.dtype},d=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,r.assert(M_(l.shape,h.shape),()=>`packed reshape ${l.shape} to ${h.shape} isn't free`);const f=this.reshape(e,[1,n.inChannels,n.outChannels]),p=this.fusedBatchMatMul({a:h,b:f,transposeA:!1,transposeB:!1,bias:i,activation:s,preluActivationWeights:o}),m=this.texData.get(p.dataId);return r.assert(m.isPacked,()=>"batchMatMul result is expected to be packed"),l.shape=d,m.shape=n.outShape,An().makeTensorFromDataId(p.dataId,n.outShape,p.dtype)}conv2dWithIm2Row(t,e,n,r,i,s){const{filterWidth:o,filterHeight:a,inChannels:l,outWidth:u,outHeight:c,dataFormat:h}=n,d="channelsLast"===h,f=o*a*l,p=c*u,m=[f,p],g=t.squeeze([0]),y=e.reshape([1,f,-1]),v=new oS(m,g.shape,n),b=this.compileAndRun(v,[g]).reshape([1,m[0],m[1]]),x=null!=r,_=null!=s,w=i?cC(i,!0):null,S=new dS(b.shape,[1,p,n.outChannels],!0,!1,x,w,_),C=[b,y];return r&&C.push(r),_&&C.push(s),this.compileAndRun(S,C).reshape(d?[1,c,u,n.outChannels]:[1,n.outChannels,c,u])}fusedConv2d({input:t,filter:e,convInfo:n,bias:r,activation:i,preluActivationWeights:s}){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(t,e,n,r,i,s);if(W().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,e,n,r,i,s);const o=null!=r,a=null!=s,l=i?cC(i,!1):null,u=new Iw(n,o,l,a),c=[t,e];return r&&c.push(r),s&&c.push(s),this.compileAndRun(u,c)}conv2d(t,e,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(t,e,n);if(W().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,e,n);const r=new Iw(n);return this.compileAndRun(r,[t,e])}conv2dDerInput(t,e,n){const r=new Aw(n);return this.compileAndRun(r,[t,e])}conv2dDerFilter(t,e,n){const r=new kw(n);return this.compileAndRun(r,[t,e])}fusedDepthwiseConv2D({input:t,filter:e,convInfo:n,bias:r,activation:i,preluActivationWeights:s}){const o=W().getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1,a=i?cC(i,o):null,l=[t,e],u=null!=r,c=null!=s;let h;return u&&l.push(r),c&&l.push(s),o?(h=new Mw(n,u,a,c),this.compileAndRun(h,l)):(h=new Fw(n,u,a,c),this.compileAndRun(h,l))}depthwiseConv2D(t,e,n){let r;return W().getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new Mw(n),this.compileAndRun(r,[t,e])):(r=new Fw(n),this.compileAndRun(r,[t,e]))}depthwiseConv2DDerInput(t,e,n){const r=new Ow(n);return this.compileAndRun(r,[t,e])}depthwiseConv2DDerFilter(t,e,n){const r=new Tw(n);return this.compileAndRun(r,[t,e])}conv3d(t,e,n){const r=new Rw(n);return this.compileAndRun(r,[t,e])}conv3dDerInput(t,e,n){const r=new Nw(n);return this.compileAndRun(r,[t,e])}conv3dDerFilter(t,e,n){const r=new Dw(n);return this.compileAndRun(r,[t,e])}maxPool(t,e){const n=new vS(e,"max",!1);return this.compileAndRun(n,[t])}avgPool(t,e){const n=new vS(e,"avg",!1);return this.compileAndRun(n,[t],"float32")}maxPoolBackprop(t,e,n,r){const i=new vS(r,"max",!0),s=this.compileAndRun(i,[e]),o=new cS(r),a=this.compileAndRun(o,[t,s],e.dtype);return s.dispose(),a}avgPoolBackprop(t,e,n){const r=new lw(n);return this.compileAndRun(r,[t],e.dtype)}cast(t,e){return y.castTensor(t,e,this)}unstack(t,e){const n=t.shape[e],r=new Array(t.rank-1);let i=0;for(let l=0;l<t.rank;l++)l!==e&&(r[i++]=t.shape[l]);const s=new Array(t.rank).fill(0),o=t.shape.slice();o[e]=1;const a=new Array(n);for(let l=0;l<a.length;l++)s[e]=l,a[l]=this.slice(t,s,o).reshape(r);return a}avgPool3d(t,e){const n=new bS(e,"avg",!1);return this.compileAndRun(n,[t],"float32")}avgPool3dBackprop(t,e,n){const r=new uw(n);return this.compileAndRun(r,[t],e.dtype)}maxPool3d(t,e){const n=new bS(e,"max",!1);return this.compileAndRun(n,[t],"float32")}maxPool3dBackprop(t,e,n,r){const i=new bS(r,"max",!0),s=this.compileAndRun(i,[e]),o=new hS(r),a=this.compileAndRun(o,[t,s],e.dtype);return s.dispose(),a}reshape(t,e){const n=this.texData.get(t.dataId);if(n.isPacked&&!M_(t.shape,e)&&(null===n.texture||!M_(n.shape,e))){const n=this.packedReshape(t,e);return An().makeTensorFromDataId(n.dataId,n.shape,n.dtype)}return y.reshapeTensor(t,e)}resizeBilinear(t,e,n,r){const i=W().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new CS(t.shape,e,n,r):new SS(t.shape,e,n,r);return this.compileAndRun(i,[t],"float32")}resizeBilinearBackprop(t,e,n){const r=new wS(t,e,n);return this.compileAndRun(r,[t])}resizeNearestNeighbor(t,e,n,r){const i=new kS(t.shape,e,n,r);return this.compileAndRun(i,[t])}resizeNearestNeighborBackprop(t,e,n){const r=new ES(t,e,n);return this.compileAndRun(r,[t])}multinomial(t,e,n,r){const i=e?t:vo(t),s=new fS(i.shape[0],i.shape[1],n),o=s.getCustomSetupFunc(r);return this.compileAndRun(s,[i],"int32",o)}oneHot(t,e,n,r){const i=new pS(t.size,e,n,r);return this.compileAndRun(i,[t])}diag(t){const e=new Vw(t.size);return this.compileAndRun(e,[t])}cropAndResize(t,e,n,r,i,s){const o=new $w(t.shape,e.shape,r,i,s);return this.compileAndRun(o,[t,e,n],"float32")}depthToSpace(t,e,n){r.assert(e>1,()=>"blockSize should be > 1 for depthToSpace, but was: "+e);const i=t.shape[0],s=("NHWC"===n?t.shape[1]:t.shape[2])*e,o=("NHWC"===n?t.shape[2]:t.shape[3])*e,a=("NHWC"===n?t.shape[3]:t.shape[1])/(e*e),l=new Uw("NHWC"===n?[i,s,o,a]:[i,a,s,o],e,n);return this.compileAndRun(l,[t])}split(t,e,n){return sC(t,e,n)}scatterND(t,e,n){const{sliceRank:r,numUpdates:i,sliceSize:s,strides:o,outputSize:a}=y.calculateShapes(e,t,n),l=[a/s,s],u=t.reshape([i,r]),c=e.reshape([i,s]);if(0===a)return y.reshapeTensor(Gn([]),n);const h=Si(0),d=new NS(i,r,u.rank,c.rank,o,l);return this.compileAndRun(d,[c,u,h]).reshape(n)}sparseToDense(t,e,n,r){const{sliceRank:i,numUpdates:s,strides:o,outputSize:a}=y.calculateShapes(e,t,n),l=new NS(s,i,t.rank,e.rank,o,[a,1],!1);return this.compileAndRun(l,[e,t,r]).reshape(n)}fft(t){return this.fftImpl(t,!1)}ifft(t){return this.fftImpl(t,!0)}fftImpl(t,e){const n=this.texData.get(t.dataId),r=new Yw("return real * expR - imag * expI;",t.shape,e),i=new Yw("return real * expI + imag * expR;",t.shape,e),s=[this.makeComplexComponentTensorInfo(t,n.complexTensors.real),this.makeComplexComponentTensorInfo(t,n.complexTensors.imag)],o=this.compileAndRun(r,s),a=this.compileAndRun(i,s),l=this.complex(o,a).as2D(t.shape[0],t.shape[1]);return o.dispose(),a.dispose(),l}gatherND(t,e){const n=e.shape,r=n[n.length-1],[i,s,o,a]=y.prepareAndValidate(t,e),l=e.reshape([s,r]),u=t.reshape([t.size/o,o]),c=new Zw(r,a,[s,o]);return this.compileAndRun(c,[u,l]).reshape(i)}fill(t,e,n){if("string"===(n=n||r.inferDtype(e))){const i=r.getArrayFromDType(n,r.sizeFromShape(t));return i.fill(e),An().makeTensor(i,t,n,this)}{const r=new Kw(t,e),i=r.getCustomSetupFunc(e);return this.compileAndRun(r,[],n,i)}}onesLike(t){if("string"===t.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)}zerosLike(t){return this.fill(t.shape,"string"===t.dtype?"":0,t.dtype)}linspace(t,e,n){return y.linspaceImpl(t,e,n)}makeTensorInfo(t,e){const n=this.write(null,t,e);return this.texData.get(n).usage=null,{dataId:n,shape:t,dtype:e}}makeOutput(t,e){const{dataId:n}=this.makeTensorInfo(t,e);return An().makeTensorFromDataId(n,t,e,this)}unpackTensor(t){const e=new rC(t.shape);return this.runWebGLProgram(e,[t],t.dtype)}packTensor(t){const e=new mS(t.shape);return this.runWebGLProgram(e,[t],t.dtype,null,!0)}packedReshape(t,e){const n=[O_(t.shape),...I_(t.shape)],r={dtype:t.dtype,shape:n,dataId:t.dataId},i=[O_(e),...I_(e)],s=new _S(i,n),o=this.runWebGLProgram(s,[r],t.dtype,null,!0);return{dataId:o.dataId,shape:e,dtype:o.dtype}}decode(t){const e=this.texData.get(t),{isPacked:n,shape:r,dtype:i}=e,s=R_(r);let o;return o=n?new jw(s):new Bw(s),{dtype:i,shape:r,dataId:this.runWebGLProgram(o,[{shape:s,dtype:i,dataId:t}],i,null,!0).dataId}}runWebGLProgram(t,e,n,i,s=!1){const o=this.makeTensorInfo(t.outputShape,n),a=this.texData.get(o.dataId);if(t.packedOutput&&(a.isPacked=!0),t.outPackingScheme===p_.DENSE){const e=v_(t.outputShape);a.texShape=e.map(t=>2*t)}if(null!=t.outTexUsage&&(a.usage=t.outTexUsage),0===r.sizeFromShape(o.shape))return a.values=r.getTypedArrayFromDType(o.dtype,0),o;const l=[],u=e.map(e=>{if("complex64"===e.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let n=this.texData.get(e.dataId);if(null==n.texture){if(!t.packedInputs&&r.sizeFromShape(e.shape)<=W().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:e.shape,texData:null,isUniform:!0,uniformValues:n.values};t.packedInputs&&(n.isPacked=!0,n.shape=e.shape)}else if(!!n.isPacked!=!!t.packedInputs)e=n.isPacked?this.unpackTensor(e):this.packTensor(e),l.push(e),n=this.texData.get(e.dataId);else if(n.isPacked&&!M_(n.shape,e.shape)){const t=e,r=e.shape;e.shape=n.shape,e=this.packedReshape(e,r),l.push(e),n=this.texData.get(e.dataId),t.shape=r}return this.uploadToGPU(e.dataId),{shape:e.shape,texData:n,isUniform:!1}});this.uploadToGPU(o.dataId);const c={shape:o.shape,texData:a,isUniform:!1},h=function(t,e,n){let r="";e.concat(n).forEach(t=>{r+=`${t.shape}_${t.isUniform?"uniform":t.texData.texShape}_${null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0}`});let i=t.constructor.name;return i+="_"+r+"_"+t.userCode,i}(t,u,c),d=this.getAndSaveBinary(h,()=>function(t,e,n,i){const s=e.userCode,o=n.map((t,n)=>{const r={logicalShape:t.shape,texShape:t.isUniform?null:t.texData.texShape,isUniform:t.isUniform,isPacked:!t.isUniform&&t.texData.isPacked,flatOffset:null};return null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0&&(r.flatOffset=t.texData.slice.flatOffset),{name:e.variableNames[n],shapeInfo:r}}),a=o.map(t=>t.shapeInfo),l={logicalShape:i.shape,texShape:i.texData.texShape,isUniform:!1,isPacked:i.texData.isPacked,flatOffset:null},u=function(t,e,n,i){const s=[];t.forEach(t=>{const e=r.sizeFromShape(t.shapeInfo.logicalShape);t.shapeInfo.isUniform?s.push(`uniform float ${t.name}${e>1?`[${e}]`:""};`):(s.push(`uniform sampler2D ${t.name};`),s.push(`uniform int offset${t.name};`))});const o=s.join("\n"),a=t.map(t=>function(t,e,n=!1){let i="";return i+=n?function t(e){switch(e.shapeInfo.logicalShape.length){case 0:return function(t){const e=t.name;return`\n    vec4 ${"get"+e.charAt(0).toUpperCase()+e.slice(1)}() {\n      return ${G_().texture2D}(${e}, halfCR);\n    }\n  `}(e);case 1:return function(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),r=t.shapeInfo.texShape,i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],s=G_();return`\n    vec4 ${n}(int index) {\n      vec2 uv = packedUVfrom1D(\n        ${i[0]}, ${i[1]}, index);\n      return ${s.texture2D}(${e}, uv);\n    }\n  `}(e);case 2:return function(t){const e=t.shapeInfo.logicalShape,n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1),s=t.shapeInfo.texShape,o=s[0],a=s[1],l=G_();if(null!=s&&r.arraysEqual(e,s))return`\n      vec4 ${i}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);\n\n        return ${l.texture2D}(${n}, uv);\n      }\n    `;const u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];return`\n    vec4 ${i}(int row, int col) {\n      vec2 uv = packedUVfrom2D(${Math.ceil(e[1]/2)}, ${u[0]}, ${u[1]}, row, col);\n      return ${l.texture2D}(${n}, uv);\n    }\n  `}(e);case 3:return function(e){const n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=e.shapeInfo.texShape,o=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];if(1===n[0]){const r=[1,2],s=sw(e,n.slice(1)),o=["b","row","col"];return`\n        ${t(s)}\n        vec4 ${i}(int b, int row, int col) {\n          return ${i}(${ow(o,r)});\n        }\n      `}const a=o[0],l=o[1],u=Math.ceil(n[2]/2);return`\n    vec4 ${i}(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ${a}, ${l}, ${u*Math.ceil(n[1]/2)}, ${u}, b, row, col);\n      return ${G_().texture2D}(${r}, uv);\n    }\n  `}(e);default:return function(t){const e=t.shapeInfo.logicalShape,n=e.length,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=t.shapeInfo.texShape,o=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],a=o[0],l=o[1],u=Math.ceil(e[n-1]/2);let c=u*Math.ceil(e[n-2]/2),h="int b, int row, int col",d=`b * ${c} + (row / 2) * ${u} + (col / 2)`;for(let f=2;f<n-1;f++)h=`int b${f}, `+h,c*=e[n-f-1],d=`b${f} * ${c} + `+d;return`\n    vec4 ${i}(${h}) {\n      int index = ${d};\n      int texR = index / ${l};\n      int texC = index - texR * ${l};\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${l}, ${a});\n      return ${G_().texture2D}(${r}, uv);\n    }\n  `}(e)}}(t):function t(e){const n=e.shapeInfo.logicalShape;switch(n.length){case 0:return function(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1);if(t.shapeInfo.isUniform)return`float ${n}() {return ${e};}`;const[r,i]=t.shapeInfo.texShape;if(1===r&&1===i)return`\n      float ${n}() {\n        return sampleTexture(${e}, halfCR);\n      }\n    `;const[s,o]=t.shapeInfo.texShape;return`\n    float ${n}() {\n      vec2 uv = uvFromFlat(${s}, ${o}, ${nw(e)});\n      return sampleTexture(${e}, uv);\n    }\n  `}(e);case 1:return function(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1);if(t.shapeInfo.isUniform)return`\n      float ${n}(int index) {\n        ${rw(t)}\n      }\n    `;const r=t.shapeInfo.texShape,i=r[0],s=r[1];if(1===s&&1===i)return`\n      float ${n}(int index) {\n        return sampleTexture(${e}, halfCR);\n      }\n    `;const o=nw(e);return 1===s?`\n      float ${n}(int index) {\n        vec2 uv = vec2(0.5, (float(index + ${o}) + 0.5) / ${i}.0);\n        return sampleTexture(${e}, uv);\n      }\n    `:1===i?`\n      float ${n}(int index) {\n        vec2 uv = vec2((float(index + ${o}) + 0.5) / ${s}.0, 0.5);\n        return sampleTexture(${e}, uv);\n      }\n    `:`\n    float ${n}(int index) {\n      vec2 uv = uvFromFlat(${i}, ${s}, index + ${o});\n      return sampleTexture(${e}, uv);\n    }\n  `}(e);case 2:return function(e){const n=e.shapeInfo.logicalShape,i=e.name,s="get"+i.charAt(0).toUpperCase()+i.slice(1),o=e.shapeInfo.texShape;if(null!=o&&r.arraysEqual(n,o))return`\n    float ${s}(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(${o[1]}.0, ${o[0]}.0);\n      return sampleTexture(${i}, uv);\n    }\n  `;const{newShape:a,keptDims:l}=r.squeezeShape(n);if(a.length<n.length){const n=sw(e,a),r=["row","col"];return`\n      ${t(n)}\n      float ${s}(int row, int col) {\n        return ${s}(${ow(r,l)});\n      }\n    `}if(e.shapeInfo.isUniform)return`\n      float ${s}(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));\n        ${rw(e)}\n      }\n    `;const u=o[0],c=o[1],h=nw(i);return 1===c?`\n    float ${s}(int row, int col) {\n      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ${u}.0);\n      return sampleTexture(${i}, uv);\n    }\n  `:1===u?`\n    float ${s}(int row, int col) {\n      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));\n      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);\n      return sampleTexture(${i}, uv);\n    }\n  `:`\n  float ${s}(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ${n[1]} + col + ${h};\n    vec2 uv = uvFromFlat(${u}, ${c}, index);\n    return sampleTexture(${i}, uv);\n  }\n`}(e);case 3:return function(e){const n=e.shapeInfo.logicalShape,i=e.name,s="get"+i.charAt(0).toUpperCase()+i.slice(1),o=n[1]*n[2],a=n[2],{newShape:l,keptDims:u}=r.squeezeShape(n);if(l.length<n.length){const n=sw(e,l),r=["row","col","depth"];return`\n        ${t(n)}\n        float ${s}(int row, int col, int depth) {\n          return ${s}(${ow(r,u)});\n        }\n      `}if(e.shapeInfo.isUniform)return`\n      float ${s}(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(${o}, ${a}, 1)));\n        ${rw(e)}\n      }\n    `;const c=e.shapeInfo.texShape,h=c[0],d=c[1],f=e.shapeInfo.flatOffset;return d===o&&null==f?`\n        float ${s}(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(${a}, 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(${d}.0, ${h}.0);\n          return sampleTexture(${i}, uv);\n        }\n      `:d===a&&null==f?`\n    float ${s}(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}.0, ${h}.0);\n      return sampleTexture(${i}, uv);\n    }\n  `:`\n      float ${s}(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ${o} + col * ${a} + depth + ${nw(i)};\n        vec2 uv = uvFromFlat(${h}, ${d}, index);\n        return sampleTexture(${i}, uv);\n      }\n  `}(e);case 4:return function(e){const n=e.shapeInfo.logicalShape,i=e.name,s="get"+i.charAt(0).toUpperCase()+i.slice(1),o=n[3],a=n[2]*o,l=n[1]*a,{newShape:u,keptDims:c}=r.squeezeShape(n);if(u.length<n.length){const n=sw(e,u),r=["row","col","depth","depth2"];return`\n      ${t(n)}\n      float ${s}(int row, int col, int depth, int depth2) {\n        return ${s}(${ow(r,c)});\n      }\n    `}if(e.shapeInfo.isUniform)return`\n      float ${s}(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(${l}, ${a}, ${o}, 1)));\n        ${rw(e)}\n      }\n    `;const h=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,f=d[0],p=d[1];return p===l&&null==h?`\n      float ${s}(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(${a}, ${o}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${p}.0, ${f}.0);\n        return sampleTexture(${i}, uv);\n      }\n    `:p===o&&null==h?`\n      float ${s}(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(${n[1]*n[2]}, ${n[2]}, 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${p}.0, ${f}.0);\n        return sampleTexture(${i}, uv);\n      }\n    `:`\n    float ${s}(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${l} + col * ${a} +\n          depth * ${o} + depth2;\n      vec2 uv = uvFromFlat(${f}, ${p}, index + ${nw(i)});\n      return sampleTexture(${i}, uv);\n    }\n  `}(e);case 5:return function(e){const n=e.shapeInfo.logicalShape,i=e.name,s="get"+i.charAt(0).toUpperCase()+i.slice(1),o=n[4],a=n[3]*o,l=n[2]*a,u=n[1]*l,{newShape:c,keptDims:h}=r.squeezeShape(n);if(c.length<n.length){const n=sw(e,c),r=["row","col","depth","depth2","depth3"];return`\n      ${t(n)}\n      float ${s}(int row, int col, int depth, int depth2, int depth3) {\n        return ${s}(${ow(r,h)});\n      }\n    `}if(e.shapeInfo.isUniform)return`\n      float ${s}(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${u}, ${l}, ${a}, ${o})) +\n          depth3;\n        ${rw(e)}\n      }\n    `;const d=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,p=f[0],m=f[1];return m===u&&null==d?`\n      float ${s}(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(${l}, ${a}, ${o}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${m}.0, ${p}.0);\n        return sampleTexture(${i}, uv);\n      }\n    `:m===o&&null==d?`\n      float ${s}(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${n[1]*n[2]*n[3]},\n               ${n[2]*n[3]}, ${n[3]}, 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${m}.0, ${p}.0);\n        return sampleTexture(${i}, uv);\n      }\n    `:`\n    float ${s}(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${u} + col * ${l} + depth * ${a} +\n          depth2 * ${o} + depth3 + ${nw(i)};\n      vec2 uv = uvFromFlat(${p}, ${m}, index);\n      return sampleTexture(${i}, uv);\n    }\n  `}(e);case 6:return function(e){const n=e.shapeInfo.logicalShape,i=e.name,s="get"+i.charAt(0).toUpperCase()+i.slice(1),{newShape:o,keptDims:a}=r.squeezeShape(n);if(o.length<n.length){const n=sw(e,o),r=["row","col","depth","depth2","depth3","depth4"];return`\n      ${t(n)}\n      float ${s}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ${s}(${ow(r,a)});\n      }\n    `}const l=n[5],u=n[4]*l,c=n[3]*u,h=n[2]*c,d=n[1]*h;if(e.shapeInfo.isUniform)return`\n      float ${s}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(${d}, ${h}, ${c}, ${u})) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(${l}, 1)));\n        ${rw(e)}\n      }\n    `;const f=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,m=p[0],g=p[1];return g===d&&null==f?`\n      float ${s}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(${h}, ${c}, ${u}, ${l})) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${g}.0, ${m}.0);\n        return sampleTexture(${i}, uv);\n      }\n    `:g===l&&null==f?`\n      float ${s}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(${n[1]*n[2]*n[3]*n[4]},\n               ${n[2]*n[3]*n[4]},\n               ${n[3]*n[4]},\n               ${n[4]})) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${g}.0, ${m}.0);\n        return sampleTexture(${i}, uv);\n      }\n    `:`\n    float ${s}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${d} + col * ${h} + depth * ${c} +\n          depth2 * ${u} + depth3 * ${l} + depth4 + ${nw(i)};\n      vec2 uv = uvFromFlat(${m}, ${g}, index);\n      return sampleTexture(${i}, uv);\n    }\n  `}(e);default:throw new Error(n.length+"-D input sampling is not yet supported")}}(t),t.shapeInfo.logicalShape.length<=e.logicalShape.length&&(i+=n?function(t,e){const n=t.name,i=n.charAt(0).toUpperCase()+n.slice(1),s="get"+i+"AtOutCoords",o=t.shapeInfo.logicalShape.length,a=e.logicalShape.length,l=Z_(t.shapeInfo.logicalShape,e.logicalShape),u=iw(a),c=a-o;let h;const d=["x","y","z","w","u","v"];h=0===o?"":a<2&&l.length>=1?"coords = 0;":l.map(t=>`coords.${d[t+c]} = 0;`).join("\n");let f="";f=a<2&&o>0?"coords":t.shapeInfo.logicalShape.map((t,e)=>"coords."+d[e+c]).join(", ");let p="return outputValue;";const m=1===r.sizeFromShape(t.shapeInfo.logicalShape),g=1===r.sizeFromShape(e.logicalShape);if(1!==o||m||g){if(m&&!g)p=1===a?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(l.length){const t=o-2,e=o-1;l.indexOf(t)>-1&&l.indexOf(e)>-1?p="return vec4(outputValue.x);":l.indexOf(t)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":l.indexOf(e)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}}else p="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return`\n    vec4 ${s}() {\n      ${u} coords = getOutputCoords();\n      ${h}\n      vec4 outputValue = get${i}(${f});\n      ${p}\n    }\n  `}(t,e):function(t,e){const n=t.name,i=n.charAt(0).toUpperCase()+n.slice(1),s="get"+i+"AtOutCoords",o=t.shapeInfo.logicalShape.length,a=e.logicalShape.length;if(!t.shapeInfo.isUniform&&o===a&&null==t.shapeInfo.flatOffset&&r.arraysEqual(t.shapeInfo.texShape,e.texShape))return`\n      float ${s}() {\n        return sampleTexture(${n}, resultUV);\n      }\n    `;const l=iw(a),u=Z_(t.shapeInfo.logicalShape,e.logicalShape),c=a-o;let h;const d=["x","y","z","w","u","v"];h=0===o?"":a<2&&u.length>=1?"coords = 0;":u.map(t=>`coords.${d[t+c]} = 0;`).join("\n");let f="";return f=a<2&&o>0?"coords":t.shapeInfo.logicalShape.map((t,e)=>"coords."+d[e+c]).join(", "),`\n    float ${s}() {\n      ${l} coords = getOutputCoords();\n      ${h}\n      return get${i}(${f});\n    }\n  `}(t,e)),i}(t,e,i)).join("\n"),l=e.texShape,u=G_(),c=function(t){return`\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ${t.texture2D}(textureSampler, uv).r;\n    }\n  `}(u);let h,d,f=function(t){return`${t.version}\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ${t.varyingFs} vec2 resultUV;\n    ${t.defineOutput}\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ${t.defineSpecialNaN}\n    ${t.defineSpecialInf}\n    ${t.defineRound}\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ${Q_}\n    ${J_}\n    ${tw}\n  `}(u);return e.isPacked?(h=function(t,e){switch(t.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(t,e){const n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return 1===n[0]?`\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ${n[1]}.0);\n      }\n    `:1===n[1]?`\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ${n[0]}.0);\n      }\n    `:`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${n[0]}, ${n[1]}));\n      return 2 * (resTexRC.x * ${n[1]} + resTexRC.y);\n    }\n  `}(0,e);case 2:return function(t,e){const n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(r.arraysEqual(t,e))return`\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(${n[0]}, ${n[1]}));\n      }\n    `;const i=Math.ceil(t[1]/2);return`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${n[0]}, ${n[1]}));\n\n      int index = resTexRC.x * ${n[1]} + resTexRC.y;\n      int r = 2 * (index / ${i});\n      int c = imod(index, ${i}) * 2;\n\n      return ivec2(r, c);\n    }\n  `}(t,e);case 3:return function(t,e){const n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[2]/2),i=r*Math.ceil(t[1]/2);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${n[0]}, ${n[1]}));\n      int index = resTexRC.x * ${n[1]} + resTexRC.y;\n\n      int b = index / ${i};\n      index -= b * ${i};\n\n      int r = 2 * (index / ${r});\n      int c = imod(index, ${r}) * 2;\n\n      return ivec3(b, r, c);\n    }\n  `}(t,e);default:return function(t,e){const n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[t.length-1]/2),i=r*Math.ceil(t[t.length-2]/2);let s=i,o="",a="b, r, c";for(let l=2;l<t.length-1;l++)s*=t[t.length-l-1],o=`\n      int b${l} = index / ${s};\n      index -= b${l} * ${s};\n    `+o,a=`b${l}, `+a;return`\n    ivec${t.length} getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${n[0]}, ${n[1]}));\n      int index = resTexRC.x * ${n[1]} + resTexRC.y;\n\n      ${o}\n\n      int b = index / ${i};\n      index -= b * ${i};\n\n      int r = 2 * (index / ${r});\n      int c = imod(index, ${r}) * 2;\n\n      return ivec${t.length}(${a});\n    }\n  `}(t,e)}}(e.logicalShape,l),d=function(t){return`\n    void setOutput(vec4 val) {\n      ${t.output} = val;\n    }\n  `}(u)):(h=function(t,e){switch(t.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return 1===(n=e)[0]?`\n      int getOutputCoords() {\n        return int(resultUV.x * ${n[1]}.0);\n      }\n    `:1===n[1]?`\n      int getOutputCoords() {\n        return int(resultUV.y * ${n[0]}.0);\n      }\n    `:`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${n[0]}, ${n[1]}));\n      return resTexRC.x * ${n[1]} + resTexRC.y;\n    }\n  `;case 2:return function(t,e){return r.arraysEqual(t,e)?`\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));\n      }\n    `:1===t[1]?`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${e[0]}, ${e[1]}));\n        int index = resTexRC.x * ${e[1]} + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    `:1===t[0]?`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${e[0]}, ${e[1]}));\n        int index = resTexRC.x * ${e[1]} + resTexRC.y;\n        return ivec2(0, index);\n      }\n    `:`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n      int r = index / ${t[1]};\n      int c = index - r * ${t[1]};\n      return ivec2(r, c);\n    }\n  `}(t,e);case 3:return function(t,e){const n=Y_(["r","c","d"],t);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n      ${n}\n      return ivec3(r, c, d);\n    }\n  `}(t,e);case 4:return function(t,e){const n=Y_(["r","c","d","d2"],t);return`\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n      ${n}\n      return ivec4(r, c, d, d2);\n    }\n  `}(t,e);case 5:return function(t,e){const n=Y_(["r","c","d","d2","d3"],t);return`\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},\n                             ${e[1]}));\n\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  `}(t,e);case 6:return function(t,e){const n=Y_(["r","c","d","d2","d3","d4"],t);return`\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  `}(t,e);default:throw new Error(t.length+"-D output sampling is not yet supported")}var n}(e.logicalShape,l),d=function(t){return`\n    void setOutput(float val) {\n      ${t.output} = vec4(val, 0, 0, 0);\n    }\n  `}(u)),i&&(f+=ew),[f,c,d,o,h,a,n].join("\n")}(o,l,s,e.packedInputs),c=t.createProgram(u);let h=null;const d=t.getUniformLocation(c,"NAN",!1);1===W().getNumber("WEBGL_VERSION")&&(h=t.getUniformLocation(c,"INFINITY",!1));const f={};for(let r=0;r<e.variableNames.length;r++){const n=e.variableNames[r],i=!1;f[n]=t.getUniformLocation(c,n,i),f["offset"+n]=t.getUniformLocation(c,"offset"+n,i)}return{program:e,source:u,webGLProgram:c,uniformLocations:f,inShapeInfos:a,outShapeInfo:l,infLoc:h,nanLoc:d}}(this.gpgpu,t,u,c)),f=null!=this.activeTimers;let p;if(f&&(p=this.startTimer()),function(t,e,n,i,s){sS(e.inShapeInfos,n),sS([e.outShapeInfo],[i]);const o=i.texData.texture,a=i.texData.texShape;i.texData.isPacked?t.setOutputPackedMatrixTexture(o,a[0],a[1]):t.setOutputMatrixTexture(o,a[0],a[1]),t.setProgram(e.webGLProgram),1===W().getNumber("WEBGL_VERSION")&&null!==e.infLoc&&t.gl.uniform1f(e.infLoc,1/0),null!==e.nanLoc&&t.gl.uniform1f(e.nanLoc,NaN),n.forEach((n,i)=>{const s=e.program.variableNames[i],o=e.uniformLocations[s],a=e.uniformLocations["offset"+s];if(null!=o)if(n.isUniform)if(r.sizeFromShape(n.shape)<2)t.gl.uniform1f(o,n.uniformValues[0]);else{let e=n.uniformValues;e instanceof Float32Array||(e=new Float32Array(e)),t.gl.uniform1fv(o,e)}else null!=n.texData.slice&&null!=a&&t.gl.uniform1i(a,n.texData.slice.flatOffset),t.setInputMatrixTexture(n.texData.texture,o,i)}),null!=s&&s(t,e.webGLProgram),t.executeProgram()}(this.gpgpu,d,u,c,i),l.forEach(t=>this.disposeData(t.dataId)),f&&(p=this.endTimer(p),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(p)})),!W().getBool("WEBGL_LAZILY_UNPACK")&&a.isPacked&&!1===s){const t=this.unpackTensor(o);return this.disposeData(o.dataId),t}return o}compileAndRun(t,e,n,r,i=!1){const s=this.runWebGLProgram(t,e,n=n||e[0].dtype,r,i);return An().makeTensorFromDataId(s.dataId,s.shape,s.dtype)}getAndSaveBinary(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(W().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Tn(()=>{if(!W().get("WEBGL_RENDER_FLOAT32_ENABLED")){const t=W().getBool("DEBUG");W().set("DEBUG",!1);const e=this.abs(Si(1e-8)).dataSync()[0];if(W().set("DEBUG",t),e>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}uploadToGPU(t){const e=this.texData.get(t),{shape:n,dtype:i,values:s,texture:o,usage:a,isPacked:l}=e;if(null!=o)return;const u=null!=this.activeTimers;let c;u&&(c=r.now());let h=e.texShape;if(null==h&&(h=function(t,e=!1){let n=W().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(n*=2,1===(t=t.map((e,n)=>n>=t.length-2?r.nearestLargerEven(t[n]):t[n])).length&&(t=[2,t[0]])),2!==t.length){const e=r.squeezeShape(t);t=e.newShape}let i=r.sizeFromShape(t);if(t.length<=1&&i<=n)return[1,i];if(2===t.length&&t[0]<=n&&t[1]<=n)return t;if(3===t.length&&t[0]*t[1]<=n&&t[2]<=n)return[t[0]*t[1],t[2]];if(3===t.length&&t[0]<=n&&t[1]*t[2]<=n)return[t[0],t[1]*t[2]];if(4===t.length&&t[0]*t[1]*t[2]<=n&&t[3]<=n)return[t[0]*t[1]*t[2],t[3]];if(4===t.length&&t[0]<=n&&t[1]*t[2]*t[3]<=n)return[t[0],t[1]*t[2]*t[3]];if(e){const e=O_(t);let n=2,s=2;return t.length&&([n,s]=I_(t)),i=e*(n/2)*(s/2),r.sizeToSquarishShape(i).map(t=>2*t)}return r.sizeToSquarishShape(i)}(n,l),e.texShape=h),null!=s){const t=R_(n);let o,a=h[1],d=h[0];const f=s instanceof Uint8Array;l?([a,d]=b_(h[0],h[1]),o=new Gw(t,[d,a],f)):o=new Hw(t,[d,a],f);const p=this.makeTensorInfo([d,a],i);this.texData.get(p.dataId).usage=f?m_.PIXELS:m_.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(p.dataId),a,d,s);const m=this.runWebGLProgram(o,[p],i,null,!0),g=this.texData.get(m.dataId);e.texture=g.texture,e.texShape=g.texShape,e.isPacked=g.isPacked,e.usage=g.usage,this.disposeData(p.dataId),this.texData.delete(m.dataId),e.values=null,u&&(this.uploadWaitMs+=r.now()-c)}else{const t=this.acquireTexture(h,a,i,l);e.texture=t}}convertAndCacheOnCPU(t,e){const n=this.texData.get(t),{dtype:r}=n;return this.releaseGPUData(t),null!=e&&(n.values=function(t,e){if("float32"===e||"complex64"===e)return t;if("int32"===e||"bool"===e){const n="int32"===e?new Int32Array(t.length):new Uint8Array(t.length);for(let e=0;e<n.length;++e)n[e]=Math.round(t[e]);return n}throw new Error("Unknown dtype "+e)}(e,r)),n.values}acquireTexture(t,e,n,r){if(this.numBytesInGPU+=this.computeBytes(t,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){const t=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${t} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(t,e,r)}computeBytes(t,e){return t[0]*t[1]*r.bytesPerElement(e)}}s.isBrowser()&&Bn("webgl",()=>new hC,2);const dC={kernelName:"Div",backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{a:n,b:r}=t;return function(t,e,n){let r=new yw("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",t.shape,e.shape);return W().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&(r=new bw("\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",t.shape,e.shape,!0)),n.runWebGLProgram(r,[t,e],"float32")}(n,r,e)}};class fC{constructor(t){this.variableNames=["Image"],this.outputShape=[];const e=t[2];this.outputShape=t,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ${e} - x;\n          float outputValue;\n          if(coordX >= 0 && coordX < ${e}) {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}const pC={kernelName:"FlipLeftRight",backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{image:n}=t,r=e,i=new fC(n.shape);return r.runWebGLProgram(i,[n],n.dtype)}};class mC{constructor(t){this.variableNames=["A"];const e=G_(),[n,r]=t;this.outputShape=t,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${n}.0);\n\n        vec4 values = ${e.texture2D}(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    `}}class gC{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const e=G_(),[n,r]=t;this.outputShape=t,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(${r}.0, ${n}.0);\n            vec4 values = ${e.texture2D}(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ${e.output} = result;\n      }\n    `}}const yC={kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(t){const{inputs:e,backend:n,attrs:r}=t;let{pixels:i}=e;const{numChannels:s}=r,o="undefined"!=typeof HTMLVideoElement&&i instanceof HTMLVideoElement,a="undefined"!=typeof HTMLImageElement&&i instanceof HTMLImageElement,[l,u]=o?[i.videoWidth,i.videoHeight]:[i.width,i.height],c=[u,l],h=[u,l,s];(a||o)&&(null==vC&&(vC=document.createElement("canvas").getContext("2d")),vC.canvas.width=l,vC.canvas.height=u,vC.drawImage(i,0,0,l,u),i=vC.canvas);const d=n.makeTensorInfo(c,"int32");n.texData.get(d.dataId).usage=m_.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(d.dataId),i);const f=W().getBool("WEBGL_PACK")?new gC(h):new mC(h),p=n.runWebGLProgram(f,[d],"int32");return n.disposeData(d.dataId),p}};let vC;const{maxImpl:bC,transposeImpl:xC}=U;function _C(t,e,n){const r=n.texData.get(t.dataId);return!r.isPacked||M_(t.shape,e)||null!==r.texture&&M_(r.shape,e)?{dataId:t.dataId,shape:e,dtype:t.dtype}:function(t,e,n){const r=[O_(t.shape),...I_(t.shape)],i={dtype:t.dtype,shape:r,dataId:t.dataId},s=[O_(e),...I_(e)],o=new _S(s,r),a=n.runWebGLProgram(o,[i],t.dtype,null,!0);return{dataId:a.dataId,shape:e,dtype:a.dtype}}(t,e,n)}class wC{constructor(t,e){this.variableNames=["A"];const n=new Array(t.length);for(let s=0;s<n.length;s++)n[s]=t[e[s]];this.outputShape=n,this.rank=n.length;const r=iw(this.rank),i=function(t){const e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e);for(let i=0;i<t.length;i++)r[t[i]]=n[i];return r.join()}(e);this.userCode=`\n    void main() {\n      ${r} resRC = getOutputCoords();\n      setOutput(getA(${i}));\n    }\n    `}}class SC{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const n=new Array(t.length);for(let u=0;u<n.length;u++)n[u]=t[e[u]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=iw(this.rank),i=q_("rc",this.rank),s=new Array(this.rank);for(let u=0;u<e.length;u++)s[e[u]]=i[u];const o=`vec2(${s.slice(-2).join()})`,a=`++${i[this.rank-1]} < ${n[this.rank-1]}`,l=`getChannel(getA(${s.join()}), ${o})`;this.userCode=`\n    void main() {\n      ${r} rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ${l};\n      if(${a}) {\n        result[1] = ${l};\n      }\n      --${i[this.rank-1]};\n      if(++${i[this.rank-2]} < ${n[this.rank-2]}) {\n        result[2] = ${l};\n        if(${a}) {\n          result[3] = ${l};\n        }\n      }\n      setOutput(result);\n    }\n    `}}function CC(t,e,n){const r=W().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new SC(t.shape,e):new wC(t.shape,e);return n.runWebGLProgram(r,[t],t.dtype)}const EC={kernelName:"Max",backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:i}=t,{reductionIndices:s,keepDims:o}=e,a=n,l=i.shape.length,u=r.parseAxisParam(s,i.shape);let c=u;const h=y.getAxesPermutation(c,l),d=null!=h,f=a.shouldExecuteOnCPU([i]);let p=i;if(d){if(f){const t=a.texData.get(p.dataId).values,e=new Array(l);for(let r=0;r<e.length;r++)e[r]=i.shape[h[r]];const n=xC(t,i.shape,i.dtype,h,e);p=a.makeTensorInfo(e,i.dtype),a.texData.get(p.dataId).values=n}else p=CC(i,h,a);c=y.getInnerMostAxes(c.length,l)}y.assertAxesAreInnerMostDims("max",c,l);const[m,g]=y.computeOutAndReduceShapes(p.shape,c);let v,b=m;if(o&&(b=y.expandShapeToKeepDim(m,u)),f){const t=a.texData.get(p.dataId),e=bC(t.values,r.sizeFromShape(g),b,i.dtype);v=a.makeTensorInfo(b,i.dtype),a.texData.get(v.dataId).values=e}else v=function(t,e,n,i){const s=r.sizeFromShape(e),o=_C(t,[r.sizeFromShape(t.shape)/s,s],i),a=function t(e,n,r,i){const[s,o]=e.shape,a=y.computeOptimalWindowSize(o),l=new xS({windowSize:a,inSize:o,batchSize:s},r),u=i.runWebGLProgram(l,[e],n);return 1===u.shape[1]?u:t(u,n,r,i)}(o,t.dtype,"max",i);return o.dataId!==t.dataId&&i.disposeData(o.dataId),_C(a,n,i)}(p,g,b,a);return d&&a.disposeData(p.dataId),v}},kC={kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:i}=t,{filterSize:s,strides:o,pad:a,includeBatchInIndex:l}=e,u=n;r.assert(4===i.shape.length,()=>`Error in maxPool: input must be rank 4 but got rank ${i.shape.length}.`);const c=[1,1];r.assert(y.eitherStridesOrDilationsAreOne(o,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const h=y.computePool2DInfo(i.shape,s,o,c,a),[d,f]=function(t,e,n,r){let i=new vS(n,"max",!1);const s=r.runWebGLProgram(i,[t],"float32");return i=new vS(n,"max",!0,!0,e),[s,r.runWebGLProgram(i,[t],"float32")]}(i,l,h,u);return[d,f]}},AC={kernelName:"NonMaxSuppressionV3",backendName:"webgl",kernelFunc:({inputs:t,backend:e,attrs:n})=>{y.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{boxes:r,scores:i}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:a}=n,l=e,u=l.readSync(r.dataId),c=l.readSync(i.dataId);return v.nonMaxSuppressionV3Impl(u,c,s,o,a)}},DC=v.nonMaxSuppressionV4Impl,NC={kernelName:"NonMaxSuppressionV4",backendName:"webgl",kernelFunc:({inputs:t,backend:e,attrs:n})=>{y.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{boxes:r,scores:i}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:a,padToMaxOutputSize:l}=n,u=e,c=u.readSync(r.dataId),h=u.readSync(i.dataId),{selectedIndices:d,validOutputs:f}=DC(c,h,s,o,a,l);return[d,f]}},TC=v.nonMaxSuppressionV5Impl,OC={kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:({inputs:t,backend:e,attrs:n})=>{y.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{boxes:r,scores:i}=t,{maxOutputSize:s,iouThreshold:o,scoreThreshold:a,softNmsSigma:l}=n,u=e,c=u.readSync(r.dataId),h=u.readSync(i.dataId),d=s,f=o,p=a,m=l,{selectedIndices:g,selectedScores:v}=TC(c,h,d,f,p,m);return[g,v]}};class IC{constructor(t,e,n,r){this.variableNames=["Image"],this.outputShape=[];const i=t[1],s=t[2],o=Math.sin(e).toFixed(3),a=Math.cos(e).toFixed(3);this.outputShape=t;const[l,u]=y.getImageCenter(r,i,s),c=l.toFixed(3),h=u.toFixed(3);let d="";d="number"==typeof n?`float outputValue = ${n.toFixed(2)};`:`\n        vec3 fill = vec3(${n.join(",")});\n        float outputValue = fill[coords[3]];`,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - ${c}) * ${a} - (float(y) - ${h}) * ${o};\n          float coordYFloat = (float(x) - ${c}) * ${o} + (float(y) - ${h}) * ${a};\n          int coordX = int(round(coordXFloat + ${c}));\n          int coordY = int(round(coordYFloat + ${h}));\n          ${d}\n          if(coordX >= 0 && coordX < ${s} && coordY >= 0 && coordY < ${i}) {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}const RC=[EC,pC,yC,dC,kC,AC,NC,OC,{kernelName:"RotateWithOffset",backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:r}=t,{radians:i,fillValue:s,center:o}=e,a=n,l=new IC(r.shape,i,s,o);return a.runWebGLProgram(l,[r],r.dtype)}},{kernelName:"Square",backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{x:n}=t,r=e,i=new jS(n.shape,"return x * x;");return r.runWebGLProgram(i,[n],n.dtype)}},{kernelName:"SquaredDifference",backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{a:n,b:r}=t,i=e,s=W().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new bw("return (a - b) * (a - b);",n.shape,r.shape):new yw("return (a - b) * (a - b);",n.shape,r.shape);return i.compileAndRun(s,[n,r])}},{kernelName:"Transpose",backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:r}=t,{perm:i}=e,s=n,o=new Array(r.shape.length);for(let l=0;l<o.length;l++)o[l]=r.shape[i[l]];let a;if(s.shouldExecuteOnCPU([r])){const t=s.texData.get(r.dataId),e=xC(t.values,r.shape,r.dtype,i,o);a=s.makeTensorInfo(o,r.dtype),s.texData.get(a.dataId).values=e}else a=CC(r,i,s);return a}}];for(const $C of RC)tt($C);n.d(e,"version",(function(){return FC})),n.d(e,"AdadeltaOptimizer",(function(){return bu})),n.d(e,"AdagradOptimizer",(function(){return xu})),n.d(e,"AdamOptimizer",(function(){return _u})),n.d(e,"AdamaxOptimizer",(function(){return wu})),n.d(e,"MomentumOptimizer",(function(){return Cu})),n.d(e,"Optimizer",(function(){return vu})),n.d(e,"RMSPropOptimizer",(function(){return Eu})),n.d(e,"SGDOptimizer",(function(){return Su})),n.d(e,"Tensor",(function(){return ue})),n.d(e,"TensorBuffer",(function(){return se})),n.d(e,"Variable",(function(){return ce})),n.d(e,"Rank",(function(){return he})),n.d(e,"sumOutType",(function(){return ve})),n.d(e,"upcastType",(function(){return ye})),n.d(e,"Reduction",(function(){return Ya})),n.d(e,"customGrad",(function(){return ji})),n.d(e,"grad",(function(){return $i})),n.d(e,"grads",(function(){return Pi})),n.d(e,"valueAndGrad",(function(){return zi})),n.d(e,"valueAndGrads",(function(){return Li})),n.d(e,"variableGrads",(function(){return Bi})),n.d(e,"Environment",(function(){return V})),n.d(e,"env",(function(){return W})),n.d(e,"ENV",(function(){return H})),n.d(e,"version_core",(function(){return"2.3.0"})),n.d(e,"nextFrame",(function(){return Nu})),n.d(e,"browser",(function(){return p})),n.d(e,"io",(function(){return d})),n.d(e,"math",(function(){return f})),n.d(e,"serialization",(function(){return g})),n.d(e,"test_util",(function(){return l})),n.d(e,"util",(function(){return r})),n.d(e,"backend_util",(function(){return y})),n.d(e,"tensor_util",(function(){return i})),n.d(e,"slice_util",(function(){return o})),n.d(e,"gather_util",(function(){return m})),n.d(e,"scatter_util",(function(){return u})),n.d(e,"device_util",(function(){return s})),n.d(e,"kernel_impls",(function(){return v})),n.d(e,"KernelBackend",(function(){return ac})),n.d(e,"DataStorage",(function(){return oc})),n.d(e,"abs",(function(){return $e})),n.d(e,"acos",(function(){return Pe})),n.d(e,"acosh",(function(){return ze})),n.d(e,"add",(function(){return Le})),n.d(e,"addN",(function(){return Be})),n.d(e,"all",(function(){return Ze})),n.d(e,"any",(function(){return Qe})),n.d(e,"argMax",(function(){return Je})),n.d(e,"argMin",(function(){return tn})),n.d(e,"asin",(function(){return en})),n.d(e,"asinh",(function(){return nn})),n.d(e,"atan",(function(){return rn})),n.d(e,"atan2",(function(){return sn})),n.d(e,"atanh",(function(){return on})),n.d(e,"avgPool",(function(){return _n})),n.d(e,"avgPool3d",(function(){return Vn})),n.d(e,"basicLSTMCell",(function(){return pr})),n.d(e,"batchToSpaceND",(function(){return mr})),n.d(e,"batchNorm",(function(){return yr})),n.d(e,"batchNorm2d",(function(){return vr})),n.d(e,"batchNorm3d",(function(){return br})),n.d(e,"batchNorm4d",(function(){return xr})),n.d(e,"broadcastTo",(function(){return wr})),n.d(e,"buffer",(function(){return Sr})),n.d(e,"cast",(function(){return an})),n.d(e,"ceil",(function(){return Cr})),n.d(e,"clipByValue",(function(){return Er})),n.d(e,"clone",(function(){return _r})),n.d(e,"complex",(function(){return kr})),n.d(e,"concat",(function(){return Yn})),n.d(e,"concat1d",(function(){return Ar})),n.d(e,"concat2d",(function(){return Dr})),n.d(e,"concat3d",(function(){return Nr})),n.d(e,"concat4d",(function(){return Tr})),n.d(e,"conv1d",(function(){return Ir})),n.d(e,"conv2d",(function(){return Or})),n.d(e,"conv2dTranspose",(function(){return Fr})),n.d(e,"conv3d",(function(){return Mr})),n.d(e,"conv3dTranspose",(function(){return Pr})),n.d(e,"cos",(function(){return zr})),n.d(e,"cosh",(function(){return Lr})),n.d(e,"cumsum",(function(){return Br})),n.d(e,"depthToSpace",(function(){return jr})),n.d(e,"depthwiseConv2d",(function(){return Ur})),n.d(e,"diag",(function(){return Vr})),n.d(e,"dilation2d",(function(){return Wr})),n.d(e,"div",(function(){return Hr})),n.d(e,"divNoNan",(function(){return Jr})),n.d(e,"dot",(function(){return ti})),n.d(e,"elu",(function(){return ei})),n.d(e,"equal",(function(){return Xr})),n.d(e,"erf",(function(){return ni})),n.d(e,"exp",(function(){return ri})),n.d(e,"expandDims",(function(){return ii})),n.d(e,"expm1",(function(){return si})),n.d(e,"eye",(function(){return ai})),n.d(e,"fft",(function(){return li})),n.d(e,"fill",(function(){return ui})),n.d(e,"floor",(function(){return ci})),n.d(e,"floorDiv",(function(){return qr})),n.d(e,"gather",(function(){return gi})),n.d(e,"greater",(function(){return yi})),n.d(e,"greaterEqual",(function(){return vi})),n.d(e,"ifft",(function(){return bi})),n.d(e,"imag",(function(){return xi})),n.d(e,"irfft",(function(){return Ci})),n.d(e,"isFinite",(function(){return Ei})),n.d(e,"isInf",(function(){return ki})),n.d(e,"isNaN",(function(){return Ai})),n.d(e,"leakyRelu",(function(){return Ni})),n.d(e,"less",(function(){return Ti})),n.d(e,"lessEqual",(function(){return Oi})),n.d(e,"linspace",(function(){return Ii})),n.d(e,"localResponseNormalization",(function(){return Ri})),n.d(e,"log",(function(){return Fi})),n.d(e,"log1p",(function(){return Mi})),n.d(e,"logSigmoid",(function(){return qi})),n.d(e,"logSoftmax",(function(){return Ki})),n.d(e,"logSumExp",(function(){return Xi})),n.d(e,"logicalAnd",(function(){return Zi})),n.d(e,"logicalNot",(function(){return Qi})),n.d(e,"logicalOr",(function(){return Ji})),n.d(e,"logicalXor",(function(){return ts})),n.d(e,"matMul",(function(){return Kn})),n.d(e,"max",(function(){return Hi})),n.d(e,"maxPool",(function(){return es})),n.d(e,"maxPool3d",(function(){return ns})),n.d(e,"maxPoolWithArgmax",(function(){return rs})),n.d(e,"maximum",(function(){return Di})),n.d(e,"mean",(function(){return os})),n.d(e,"min",(function(){return as})),n.d(e,"minimum",(function(){return ls})),n.d(e,"mod",(function(){return us})),n.d(e,"moments",(function(){return hs})),n.d(e,"mul",(function(){return Xn})),n.d(e,"multiRNNCell",(function(){return ds})),n.d(e,"multinomial",(function(){return fs})),n.d(e,"neg",(function(){return Vi})),n.d(e,"notEqual",(function(){return ps})),n.d(e,"oneHot",(function(){return ms})),n.d(e,"ones",(function(){return ss})),n.d(e,"onesLike",(function(){return gs})),n.d(e,"outerProduct",(function(){return ys})),n.d(e,"pad",(function(){return vs})),n.d(e,"pad1d",(function(){return bs})),n.d(e,"pad2d",(function(){return xs})),n.d(e,"pad3d",(function(){return _s})),n.d(e,"pad4d",(function(){return ws})),n.d(e,"pool",(function(){return Cs})),n.d(e,"pow",(function(){return Es})),n.d(e,"prelu",(function(){return ks})),n.d(e,"print",(function(){return As})),n.d(e,"prod",(function(){return Ds})),n.d(e,"rand",(function(){return Ns})),n.d(e,"randomGamma",(function(){return Ws})),n.d(e,"randomNormal",(function(){return qs})),n.d(e,"randomUniform",(function(){return Hs})),n.d(e,"range",(function(){return Ys})),n.d(e,"real",(function(){return _i})),n.d(e,"reciprocal",(function(){return Ks})),n.d(e,"relu",(function(){return Xs})),n.d(e,"relu6",(function(){return Zs})),n.d(e,"reshape",(function(){return Ke})),n.d(e,"reverse",(function(){return wi})),n.d(e,"reverse1d",(function(){return Qs})),n.d(e,"reverse2d",(function(){return Js})),n.d(e,"reverse3d",(function(){return to})),n.d(e,"reverse4d",(function(){return eo})),n.d(e,"rfft",(function(){return io})),n.d(e,"round",(function(){return so})),n.d(e,"rsqrt",(function(){return oo})),n.d(e,"scalar",(function(){return Si})),n.d(e,"selu",(function(){return ao})),n.d(e,"separableConv2d",(function(){return lo})),n.d(e,"setdiff1dAsync",(function(){return uo})),n.d(e,"sigmoid",(function(){return Zn})),n.d(e,"sign",(function(){return co})),n.d(e,"sin",(function(){return ho})),n.d(e,"sinh",(function(){return fo})),n.d(e,"slice",(function(){return dr})),n.d(e,"slice1d",(function(){return po})),n.d(e,"slice2d",(function(){return mo})),n.d(e,"slice3d",(function(){return go})),n.d(e,"slice4d",(function(){return yo})),n.d(e,"softmax",(function(){return vo})),n.d(e,"softplus",(function(){return Wi})),n.d(e,"spaceToBatchND",(function(){return Ss})),n.d(e,"split",(function(){return ro})),n.d(e,"sqrt",(function(){return bo})),n.d(e,"square",(function(){return cs})),n.d(e,"squaredDifference",(function(){return xo})),n.d(e,"squeeze",(function(){return _o})),n.d(e,"stack",(function(){return wo})),n.d(e,"step",(function(){return So})),n.d(e,"stridedSlice",(function(){return Co})),n.d(e,"sub",(function(){return Gi})),n.d(e,"sum",(function(){return Yi})),n.d(e,"tan",(function(){return Eo})),n.d(e,"tanh",(function(){return fr})),n.d(e,"tensor",(function(){return Gn})),n.d(e,"tensor1d",(function(){return Gs})),n.d(e,"tensor2d",(function(){return ko})),n.d(e,"tensor3d",(function(){return Ao})),n.d(e,"tensor4d",(function(){return Do})),n.d(e,"tensor5d",(function(){return No})),n.d(e,"tensor6d",(function(){return To})),n.d(e,"tile",(function(){return oi})),n.d(e,"topk",(function(){return Oo})),n.d(e,"truncatedNormal",(function(){return Io})),n.d(e,"unsortedSegmentSum",(function(){return Ro})),n.d(e,"unstack",(function(){return Fo})),n.d(e,"variable",(function(){return Mo})),n.d(e,"where",(function(){return Zr})),n.d(e,"whereAsync",(function(){return Po})),n.d(e,"zeros",(function(){return is})),n.d(e,"zerosLike",(function(){return Qr})),n.d(e,"op",(function(){return Me})),n.d(e,"image",(function(){return ol})),n.d(e,"linalg",(function(){return al})),n.d(e,"losses",(function(){return ll})),n.d(e,"spectral",(function(){return il})),n.d(e,"fused",(function(){return c})),n.d(e,"signal",(function(){return sl})),n.d(e,"train",(function(){return Au})),n.d(e,"enableProdMode",(function(){return wn})),n.d(e,"enableDebugMode",(function(){return Sn})),n.d(e,"disableDeprecationWarnings",(function(){return Cn})),n.d(e,"deprecationWarn",(function(){return En})),n.d(e,"disposeVariables",(function(){return kn})),n.d(e,"engine",(function(){return An})),n.d(e,"memory",(function(){return Dn})),n.d(e,"profile",(function(){return Nn})),n.d(e,"tidy",(function(){return Tn})),n.d(e,"dispose",(function(){return On})),n.d(e,"keep",(function(){return In})),n.d(e,"time",(function(){return Rn})),n.d(e,"setBackend",(function(){return Fn})),n.d(e,"ready",(function(){return Mn})),n.d(e,"getBackend",(function(){return $n})),n.d(e,"removeBackend",(function(){return Pn})),n.d(e,"findBackend",(function(){return zn})),n.d(e,"findBackendFactory",(function(){return Ln})),n.d(e,"registerBackend",(function(){return Bn})),n.d(e,"backend",(function(){return jn})),n.d(e,"setPlatform",(function(){return Un})),n.d(e,"getKernel",(function(){return Z})),n.d(e,"getGradient",(function(){return Q})),n.d(e,"getKernelsForBackend",(function(){return J})),n.d(e,"registerKernel",(function(){return tt})),n.d(e,"registerGradient",(function(){return et})),n.d(e,"unregisterKernel",(function(){return nt})),n.d(e,"unregisterGradient",(function(){return rt})),n.d(e,"Abs",(function(){return"Abs"})),n.d(e,"Acos",(function(){return"Acos"})),n.d(e,"Acosh",(function(){return"Acosh"})),n.d(e,"Add",(function(){return"Add"})),n.d(e,"AddN",(function(){return"AddN"})),n.d(e,"All",(function(){return"All"})),n.d(e,"Any",(function(){return"Any"})),n.d(e,"ArgMax",(function(){return"ArgMax"})),n.d(e,"ArgMin",(function(){return"ArgMin"})),n.d(e,"Asin",(function(){return"Asin"})),n.d(e,"Asinh",(function(){return"Asinh"})),n.d(e,"Atan",(function(){return"Atan"})),n.d(e,"Atanh",(function(){return"Atanh"})),n.d(e,"Atan2",(function(){return"Atan2"})),n.d(e,"AvgPool",(function(){return"AvgPool"})),n.d(e,"AvgPoolBackprop",(function(){return"AvgPoolBackprop"})),n.d(e,"AvgPool3D",(function(){return"AvgPool3D"})),n.d(e,"AvgPool3DBackprop",(function(){return"AvgPool3DBackprop"})),n.d(e,"BatchMatMul",(function(){return"BatchMatMul"})),n.d(e,"BatchToSpaceND",(function(){return"BatchToSpaceND"})),n.d(e,"BroadcastTo",(function(){return"BroadcastTo"})),n.d(e,"Cast",(function(){return"Cast"})),n.d(e,"Ceil",(function(){return"Ceil"})),n.d(e,"ClipByValue",(function(){return"ClipByValue"})),n.d(e,"Complex",(function(){return"Complex"})),n.d(e,"Concat",(function(){return"Concat"})),n.d(e,"Conv2D",(function(){return"Conv2D"})),n.d(e,"Conv2DBackpropFilter",(function(){return"Conv2DBackpropFilter"})),n.d(e,"Conv2DBackpropInput",(function(){return"Conv2DBackpropInput"})),n.d(e,"Conv3D",(function(){return"Conv3D"})),n.d(e,"Conv3DBackpropFilterV2",(function(){return"Conv3DBackpropFilterV2"})),n.d(e,"Conv3DBackpropInputV2",(function(){return"Conv3DBackpropInputV2"})),n.d(e,"Cos",(function(){return"Cos"})),n.d(e,"Cosh",(function(){return"Cosh"})),n.d(e,"Cumsum",(function(){return"Cumsum"})),n.d(e,"CropAndResize",(function(){return"CropAndResize"})),n.d(e,"DepthToSpace",(function(){return"DepthToSpace"})),n.d(e,"DepthwiseConv2dNative",(function(){return"DepthwiseConv2dNative"})),n.d(e,"DepthwiseConv2dNativeBackpropFilter",(function(){return"DepthwiseConv2dNativeBackpropFilter"})),n.d(e,"DepthwiseConv2dNativeBackpropInput",(function(){return"DepthwiseConv2dNativeBackpropInput"})),n.d(e,"Diag",(function(){return"Diag"})),n.d(e,"Dilation2D",(function(){return"Dilation2D"})),n.d(e,"Dilation2DBackpropInput",(function(){return"Dilation2DBackpropInput"})),n.d(e,"Dilation2DBackpropFilter",(function(){return"Dilation2DBackpropFilter"})),n.d(e,"Div",(function(){return"Div"})),n.d(e,"Elu",(function(){return"Elu"})),n.d(e,"EluGrad",(function(){return"EluGrad"})),n.d(e,"Erf",(function(){return"Erf"})),n.d(e,"Equal",(function(){return"Equal"})),n.d(e,"Exp",(function(){return"Exp"})),n.d(e,"Expm1",(function(){return"Expm1"})),n.d(e,"FFT",(function(){return"FFT"})),n.d(e,"Fill",(function(){return"Fill"})),n.d(e,"FlipLeftRight",(function(){return"FlipLeftRight"})),n.d(e,"Floor",(function(){return"Floor"})),n.d(e,"FloorDiv",(function(){return"FloorDiv"})),n.d(e,"FusedBatchNorm",(function(){return"FusedBatchNorm"})),n.d(e,"GatherV2",(function(){return"GatherV2"})),n.d(e,"GatherNd",(function(){return"GatherNd"})),n.d(e,"Greater",(function(){return"Greater"})),n.d(e,"GreaterEqual",(function(){return"GreaterEqual"})),n.d(e,"Identity",(function(){return"Identity"})),n.d(e,"IFFT",(function(){return"IFFT"})),n.d(e,"Imag",(function(){return"Imag"})),n.d(e,"IsFinite",(function(){return"IsFinite"})),n.d(e,"IsInf",(function(){return"IsInf"})),n.d(e,"IsNan",(function(){return"IsNan"})),n.d(e,"Less",(function(){return"Less"})),n.d(e,"LessEqual",(function(){return"LessEqual"})),n.d(e,"LinSpace",(function(){return"LinSpace"})),n.d(e,"Log",(function(){return"Log"})),n.d(e,"Log1p",(function(){return"Log1p"})),n.d(e,"LogicalAnd",(function(){return"LogicalAnd"})),n.d(e,"LogicalNot",(function(){return"LogicalNot"})),n.d(e,"LogicalOr",(function(){return"LogicalOr"})),n.d(e,"LogSoftmax",(function(){return"LogSoftmax"})),n.d(e,"LRN",(function(){return"LRN"})),n.d(e,"LRNBackprop",(function(){return"LRNBackprop"})),n.d(e,"Max",(function(){return"Max"})),n.d(e,"Maximum",(function(){return"Maximum"})),n.d(e,"MaxPool",(function(){return"MaxPool"})),n.d(e,"MaxPoolBackprop",(function(){return"MaxPoolBackprop"})),n.d(e,"MaxPool3D",(function(){return"MaxPool3D"})),n.d(e,"MaxPool3DBackprop",(function(){return"MaxPool3DBackprop"})),n.d(e,"MaxPoolWithArgmax",(function(){return"MaxPoolWithArgmax"})),n.d(e,"Mean",(function(){return"Mean"})),n.d(e,"Min",(function(){return"Min"})),n.d(e,"Minimum",(function(){return"Minimum"})),n.d(e,"Mod",(function(){return"Mod"})),n.d(e,"Multiply",(function(){return"Multiply"})),n.d(e,"Negate",(function(){return"Negate"})),n.d(e,"NotEqual",(function(){return"NotEqual"})),n.d(e,"NonMaxSuppressionV3",(function(){return"NonMaxSuppressionV3"})),n.d(e,"NonMaxSuppressionV4",(function(){return"NonMaxSuppressionV4"})),n.d(e,"NonMaxSuppressionV5",(function(){return"NonMaxSuppressionV5"})),n.d(e,"OnesLike",(function(){return"OnesLike"})),n.d(e,"OneHot",(function(){return"OneHot"})),n.d(e,"PadV2",(function(){return"PadV2"})),n.d(e,"Pool",(function(){return"Pool"})),n.d(e,"Pow",(function(){return"Pow"})),n.d(e,"Prelu",(function(){return"Prelu"})),n.d(e,"Prod",(function(){return"Prod"})),n.d(e,"Range",(function(){return"Range"})),n.d(e,"Real",(function(){return"Real"})),n.d(e,"Reciprocal",(function(){return"Reciprocal"})),n.d(e,"Relu",(function(){return"Relu"})),n.d(e,"Reshape",(function(){return"Reshape"})),n.d(e,"ResizeNearestNeighbor",(function(){return"ResizeNearestNeighbor"})),n.d(e,"ResizeNearestNeighborGrad",(function(){return"ResizeNearestNeighborGrad"})),n.d(e,"ResizeBilinear",(function(){return"ResizeBilinear"})),n.d(e,"ResizeBilinearGrad",(function(){return"ResizeBilinearGrad"})),n.d(e,"Relu6",(function(){return"Relu6"})),n.d(e,"Reverse",(function(){return"Reverse"})),n.d(e,"Round",(function(){return"Round"})),n.d(e,"Rsqrt",(function(){return"Rsqrt"})),n.d(e,"ScatterNd",(function(){return"ScatterNd"})),n.d(e,"SelectV2",(function(){return"SelectV2"})),n.d(e,"Selu",(function(){return"Selu"})),n.d(e,"Slice",(function(){return"Slice"})),n.d(e,"Sin",(function(){return"Sin"})),n.d(e,"Sinh",(function(){return"Sinh"})),n.d(e,"Sign",(function(){return"Sign"})),n.d(e,"Sigmoid",(function(){return"Sigmoid"})),n.d(e,"Softplus",(function(){return"Softplus"})),n.d(e,"Sqrt",(function(){return"Sqrt"})),n.d(e,"Sum",(function(){return"Sum"})),n.d(e,"SpaceToBatchND",(function(){return"SpaceToBatchND"})),n.d(e,"SplitV",(function(){return"SplitV"})),n.d(e,"Softmax",(function(){return"Softmax"})),n.d(e,"SquaredDifference",(function(){return"SquaredDifference"})),n.d(e,"Square",(function(){return"Square"})),n.d(e,"Sub",(function(){return"Sub"})),n.d(e,"SparseToDense",(function(){return"SparseToDense"})),n.d(e,"StridedSlice",(function(){return"StridedSlice"})),n.d(e,"Tan",(function(){return"Tan"})),n.d(e,"Tanh",(function(){return"Tanh"})),n.d(e,"Tile",(function(){return"Tile"})),n.d(e,"TopK",(function(){return"TopK"})),n.d(e,"Transpose",(function(){return"Transpose"})),n.d(e,"Unpack",(function(){return"Unpack"})),n.d(e,"UnsortedSegmentSum",(function(){return"UnsortedSegmentSum"})),n.d(e,"ZerosLike",(function(){return"ZerosLike"})),n.d(e,"Step",(function(){return"Step"})),n.d(e,"FromPixels",(function(){return"FromPixels"})),n.d(e,"RotateWithOffset",(function(){return"RotateWithOffset"})),n.d(e,"_FusedMatMul",(function(){return"_FusedMatMul"})),n.d(e,"FusedConv2D",(function(){return"FusedConv2D"})),n.d(e,"FusedDepthwiseConv2D",(function(){return"FusedDepthwiseConv2D"})),n.d(e,"booleanMaskAsync",(function(){return zo})),n.d(e,"equalStrict",(function(){return Lo})),n.d(e,"greaterEqualStrict",(function(){return Bo})),n.d(e,"greaterStrict",(function(){return jo})),n.d(e,"lessEqualStrict",(function(){return Uo})),n.d(e,"lessStrict",(function(){return Vo})),n.d(e,"notEqualStrict",(function(){return Wo})),n.d(e,"addStrict",(function(){return qo})),n.d(e,"divStrict",(function(){return Ho})),n.d(e,"maximumStrict",(function(){return Go})),n.d(e,"minimumStrict",(function(){return Yo})),n.d(e,"modStrict",(function(){return Ko})),n.d(e,"mulStrict",(function(){return Xo})),n.d(e,"powStrict",(function(){return Zo})),n.d(e,"squaredDifferenceStrict",(function(){return Qo})),n.d(e,"subStrict",(function(){return Jo})),n.d(e,"transpose",(function(){return Xe})),n.d(e,"norm",(function(){return ta})),n.d(e,"movingAverage",(function(){return ea})),n.d(e,"scatterND",(function(){return sa})),n.d(e,"sparseToDense",(function(){return oa})),n.d(e,"gatherND",(function(){return aa})),n.d(e,"dropout",(function(){return la})),n.d(e,"enclosingPowerOfTwo",(function(){return ua})),n.d(e,"cosineWindow",(function(){return ca})),n.d(e,"inTopKAsync",(function(){return ha})),n.d(e,"CallbackList",(function(){return Vf})),n.d(e,"CustomCallback",(function(){return Hf})),n.d(e,"History",(function(){return qf})),n.d(e,"Callback",(function(){return Tv})),n.d(e,"callbacks",(function(){return Fv})),n.d(e,"EarlyStopping",(function(){return Rv})),n.d(e,"InputSpec",(function(){return Of})),n.d(e,"SymbolicTensor",(function(){return If})),n.d(e,"LayersModel",(function(){return Yp})),n.d(e,"input",(function(){return tm})),n.d(e,"loadLayersModel",(function(){return Jp})),n.d(e,"model",(function(){return Zp})),n.d(e,"registerCallbackConstructor",(function(){return em})),n.d(e,"sequential",(function(){return Qp})),n.d(e,"RNN",(function(){return Lg})),n.d(e,"Sequential",(function(){return Xp})),n.d(e,"LayerVariable",(function(){return Df})),n.d(e,"version_layers",(function(){return"2.3.0"})),n.d(e,"constraints",(function(){return b})),n.d(e,"initializers",(function(){return x})),n.d(e,"layers",(function(){return _})),n.d(e,"metrics",(function(){return w})),n.d(e,"models",(function(){return S})),n.d(e,"regularizers",(function(){return C})),n.d(e,"GraphModel",(function(){return zb})),n.d(e,"loadGraphModel",(function(){return Lb})),n.d(e,"deregisterOp",(function(){return Bv})),n.d(e,"registerOp",(function(){return zv})),n.d(e,"version_converter",(function(){return"2.3.0"})),n.d(e,"data",(function(){return j}));const FC={"tfjs-core":"2.3.0","tfjs-backend-cpu":"2.3.0","tfjs-backend-webgl":"2.3.0","tfjs-data":Vx,"tfjs-layers":"2.3.0","tfjs-converter":"2.3.0",tfjs:"2.3.0"}},zn8P:function(t,e){function n(t){return Promise.resolve().then((function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}))}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id="zn8P"}},[[0,0]]]);